<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:20:10 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>IPSEC.CONF(5) Executable programs IPSEC.CONF(5)</p>

<p>NAME ipsec.conf - IPsec configuration and
connections</p>

<p>DESCRIPTION The optional ipsec.conf file specifies most
configuration and control information for the Libreswan
IPsec subsystem. (The major exception is secrets for
authentication; see ipsec.secrets(5).) Its contents are not
security-sensitive.</p>

<p>The file is a text file, consisting of one or more
sections. White space followed by # followed by anything to
the end of the line is a comment and is ignored, as are
empty lines which are not within a section.</p>

<p>A line which contains include and a file name, separated
by white space, is replaced by the contents of that file,
preceded and followed by empty lines. If the file name is
not a full pathname, it is considered to be relative to the
directory containing the including file. Such inclusions can
be nested. Only a single filename may be supplied, and it
may not contain white space, but it may include shell
wildcards (see sh(1)); for example:</p>

<p>include /etc/ipsec.d/*.conf</p>

<p>The intention of the include facility is mostly to
permit keeping information on connections, or sets of
connections, separate from the main configuration file. This
permits such connection descriptions to be changed, copied
to the other security gateways involved, etc., without
having to constantly extract them from the configuration
file and then insert them back into it. Note also the also
and alsoflip parameters (described below) which permit
splitting a single logical section (e.g. a connection
description) into several actual sections.</p>

<p>The first significant line of the file may specify a
version of this specification for backwards compatibility
with freeswan and openswan. It is ignored and unused. For
compatibility with openswan, specify:</p>

<p>version 2</p>

<p>A section begins with a line of the form:</p>

<p>type name</p>

<p>where type indicates what type of section follows, and
name is an arbitrary name which distinguishes the section
from others of the same type. (Names must start with a
letter and may contain only letters, digits, periods,
underscores, and hyphens.) All subsequent non-empty lines
which begin with white space are part of the section;
comments within a section must begin with white space too.
There may be only one section of a given type with a given
name.</p>

<p>Lines within the section are generally of the form</p>

<p>parameter=value</p>

<p>(note the mandatory preceding white space). There can be
white space on either side of the =. Parameter names follow
the same syntax as section names, and are specific to a
section type. Unless otherwise explicitly specified, no
parameter name may appear more than once in a section.</p>

<p>An empty value stands for the system default value (if
any) of the parameter, i.e. it is roughly equivalent to
omitting the parameter line entirely. A value may contain
white space only if the entire value is enclosed in double
quotes (&quot;); a value cannot itself contain a double
quote, nor may it be continued across more than one
line.</p>

<p>Numeric values are specified to be either an integer (a
sequence of digits) or a decimal number (sequence of digits
optionally followed by .&acute; and another sequence of
digits).</p>

<p>There is currently one parameter which is available in
any type of section:</p>

<p>also the value is a section name; the parameters of that
section are appended to this section, as if they had been
written as part of it. The specified section must exist,
must follow the current one, and must have the same section
type. (Nesting is permitted, and there may be more than one
also in a single section, although it is forbidden to append
the same section more than once.) This allows, for example,
keeping the encryption keys for a connection in a separate
file from the rest of the description, by using both an also
parameter and an include line. (Caution, see BUGS below for
some restrictions.)</p>

<p>alsoflip can be used in a conn section. It acts like an
also that flips the referenced section&acute;s entries
left-for-right.</p>

<p>Parameter names beginning with x- (or X-, or x_, or X_)
are reserved for user extensions and will never be assigned
meanings by IPsec. Parameters with such names must still
observe the syntax rules (limits on characters used in the
name; no white space in a non-quoted value; no newlines or
double quotes within the value). All other as-yet-unused
parameter names are reserved for future IPsec
improvements.</p>

<p>A section with name %default specifies defaults for
sections of the same type. For each parameter in it, any
section of that type which does not have a parameter of the
same name gets a copy of the one from the %default section.
There may be multiple %default sections of a given type, but
only one default may be supplied for any specific parameter
name, and all %default sections of a given type must precede
all non-%default sections of that type. %default sections
may not contain also or alsoflip parameters.</p>

<p>Currently there are two types of section: a config
section specifies general configuration information for
IPsec, while a conn section specifies an IPsec
connection.</p>

<p>CONN SECTIONS A conn section contains a connection
specification, defining a network connection to be made
using IPsec. The name given is arbitrary, and is used to
identify the connection to ipsec_auto(8) Here&acute;s a
simple example:</p>

<p>conn snt left=10.11.11.1 leftsubnet=10.0.1.0/24
leftnexthop=172.16.55.66 leftsourceip=10.0.1.1
right=192.168.22.1 rightsubnet=10.0.2.0/24
rightnexthop=172.16.88.99 rightsourceip=10.0.2.1
keyingtries=%forever</p>

<p>A note on terminology... In automatic keying, there are
two kinds of communications going on: transmission of user
IP packets, and gateway-to-gateway negotiations for keying,
rekeying, and general control. The data path (a set of IPsec
SAs) used for user packets is herein referred to as the
connection; the path used for negotiations (built with
ISAKMP SAs) is referred to as the keying channel.</p>

<p>To avoid trivial editing of the configuration file to
suit it to each system involved in a connection, connection
specifications are written in terms of left and right
participants, rather than in terms of local and remote.
Which participant is considered left or right is arbitrary;
IPsec figures out which one it is being run on based on
internal information. This permits using identical
connection specifications on both ends. There are cases
where there is no symmetry; a good convention is to use left
for the local side and right for the remote side (the first
letters are a good mnemonic).</p>

<p>Many of the parameters relate to one participant or the
other; only the ones for left are listed here, but every
parameter whose name begins with left has a right
counterpart, whose description is the same but with left and
right reversed.</p>

<p>Parameters are optional unless marked (required)</p>

<p>CONN PARAMETERS: GENERAL The following parameters are
relevant to IKE automatic keying. Unless otherwise noted,
for a connection to work, in general it is necessary for the
two ends to agree exactly on the values of these
parameters.</p>

<p>connaddrfamily the connection address family of the
connection; currently the accepted values are ipv4 (the
default); or ipv6. This option is confusing, especially when
doing IPv4-in-IPv6 or IPv6-in-IPv4 tunnels. The developers
hope to remove this option in the near future for proper
auto-detection. For now, set connaddrfamily= to the family
of the *subnet= options, and if those are not defined, to
the family of the left=/right= options.</p>

<p>IPv6 is supported with NETKEY and with KLIPS in all
Libreswan versions</p>

<p>type the type of the connection; currently the accepted
values are tunnel (the default) signifying a host-to-host,
host-to-subnet, or subnet-to-subnet tunnel; transport,
signifying host-to-host transport mode; passthrough,
signifying that no IPsec processing should be done at all;
drop, signifying that packets should be discarded; and
reject, signifying that packets should be discarded and a
diagnostic ICMP returned.</p>

<p>left (required) the IP address of the left
participant&acute;s public-network interface, in any form
accepted by ipsec_ttoaddr(3). Currently, IPv4 and IPv6 IP
addresses are supported. There are several magic values. If
it is %defaultroute, and the config setup section&acute;s,
interfaces specification contains %defaultroute, left will
be filled in automatically with the local address of the
default-route interface (as determined at IPsec startup
time); this also overrides any value supplied for
leftnexthop. (Either left or right may be %defaultroute, but
not both.) The value %any signifies an address to be filled
in (by automatic keying) during negotiation. The value
%opportunistic signifies that both left and leftnexthop are
to be filled in (by automatic keying) from DNS data for
left&acute;s client. The value can also contain the
interface name, which will then later be used to obtain the
IP address from to fill in. For example %ppp0 The values
%group and %opportunisticgroup makes this a policy group
conn: one that will be instantiated into a regular or
opportunistic conn for each CIDR block listed in the policy
group file with the same name as the conn.</p>

<p>If using IP addresses in combination with NAT, always
use the actual local machine&acute;s (NATed) IP address, and
if the remote (eg right=) is NATed as well, the
remote&acute;s public (not NATed) IP address. Note that this
makes the configuration no longer symmetrical on both sides,
so you cannot use an identical configuration file on both
hosts.</p>

<p>leftsubnet private subnet behind the left participant,
expressed as network/netmask (actually, any form acceptable
to ipsec_ttosubnet(3)); Currently, IPv4 and IPv6 ranges are
supported. if omitted, essentially assumed to be left/32,
signifying that the left end of the connection goes to the
left participant only</p>

<p>It supports two magic shorthands vhost: and vnet:, which
can list subnets in the same syntax as virtual-private. The
value %priv expands to the networks specified in
virtual-private. The value %no means no subnet. A common use
for allowing roadwarriors to come in on public IPs or via
accepted NATed networks from RFC1918 is to use
leftsubnet=vhost:%no,%priv. The vnet: option can be used to
allow RFC1918 subnets without hardcoding them. When using
vnet the connection will instantiate, allowing for multiple
tunnels with different subnets.</p>

<p>leftsubnets specify multiple private subnets behind the
left participant, expressed as { networkA/netmaskA
networkB/netmaskB [...] } If both a leftsubnets= and
rightsubnets= are defined, all combinations of subnet
tunnels will be established as IPsec tunnels. You cannot use
leftsubnet= and leftsubnets= together. For examples see
testing/pluto/multinet-*.</p>

<p>leftaddresspool address pool from with the XAUTH server
can assign IP addresses to clients. When configured as an
XAUTH server, using leftxauthserver=yes this option
specifies the address pool from which IP addresses are taken
to assign the the XAUTH clients. The syntax of the address
pool specifies a range (not a CIDR), in the following
syntax: rightaddresspool=192.168.1.100-192.168.1.200.
Generally, the rightaddresspool= option will be accompanied
by rightxauthclient=yes, leftxauthserver=yes and
leftsubnet=0.0.0.0/0 option.</p>

<p>When leftaddresspool= is specified, the connection may
not specify either leftsubnet= or leftsubnets=. Address
pools are fully allocated when the connection is loaded, so
the ranges should be sane. For example, specifying a range
rightaddresspool=10.0.0.0-11.0.0.0 will lead to massive
memory allocation. Address pools specifying the exact same
range are shared between different connections. Different
addresspools should not be defined to partially overlap.</p>

<p>leftprotoport allowed protocols and ports over
connection, also called Port Selectors. The argument is in
the form protocol, which can be a number or a name that will
be looked up in /etc/protocols, such as leftprotoport=icmp,
or in the form of protocol/port, such as tcp/smtp. Ports can
be defined as a number (eg. 25) or as a name (eg smtp) which
will be looked up in /etc/services. A special keyword %any
can be used to allow all ports of a certain protocol. The
most common use of this option is for L2TP connections to
only allow l2tp packets (UDP port 1701), eg:
leftprotoport=17/1701.</p>

<p>To filter on specific icmp type and code, use the higher
8 bits for type and the lower 8 bits for port. For example,
to allow icmp echo packets (type 8, code 0) the
&acute;port&acute; would be 0x0800, or 2048 in decimal, so
you configure leftprotoport=icmp/2048. Similarly, to allow
ipv6-icmp Neighbour Discovery which has type 136 (0x88) and
code 0(0x00) this becomes 0x8800 or in decimal 34816
resulting in leftprotoport=ipv6-icmp/34816 .</p>

<p>Some clients, notably older Windows XP and some Mac OSX
clients, use a random high port as source port. In those
cases rightprotoport=17/%any can be used to allow all UDP
traffic on the connection. Note that this option is part of
the proposal, so it cannot be arbitrarily left out if one
end does not care about the traffic selection over this
connection - both peers have to agree. The Port Selectors
show up in the output of ipsec eroute and ipsec auto
--status eg:&quot;l2tp&quot;:
193.110.157.131[@aivd.libreswan.org]:7/1701...%any:17/1701
This option only filters outbound traffic. Inbound traffic
selection must still be based on firewall rules activated by
an updown script. The variables $PLUTO_MY_PROTOCOL,
$PLUTO_PEER_PROTOCOL, $PLUTO_MY_PORT, and $PLUTO_PEER_PORT
are available for use in updown scripts. Older workarounds
for bugs involved a setting of 17/0 to denote any single UDP
port (not UDP port 0). Some clients, most notably OSX, uses
a random high port, instead of port 1701 for L2TP.</p>

<p>leftnexthop next-hop gateway IP address for the left
participant&acute;s connection to the public network;
defaults to %direct (meaning right). If the value is to be
overridden by the left=%defaultroute method (see above), an
explicit value must not be given. If that method is not
being used, but leftnexthop is %defaultroute, and
interfaces=%defaultroute is used in the config setup
section, the next-hop gateway address of the default-route
interface will be used. The magic value %direct signifies a
value to be filled in (by automatic keying) with the
peer&acute;s address. Relevant only locally, other end need
not agree on it.</p>

<p>leftsourceip the IP address for this host to use when
transmitting a packet to the other side of this link.
Relevant only locally, the other end need not agree. This
option is used to make the gateway itself use its internal
IP, which is part of the leftsubnet, to communicate to the
rightsubnet or right. Otherwise, it will use its nearest IP
address, which is its public IP address. This option is
mostly used when defining subnet-subnet connections, so that
the gateways can talk to each other and the subnet at the
other end, without the need to build additional host-subnet,
subnet-host and host-host tunnels. Both IPv4 and IPv6
addresses are supported.</p>

<p>leftupdown what updown script to run to adjust routing
and/or firewalling when the status of the connection changes
(default ipsec _updown). May include positional parameters
separated by white space (although this requires enclosing
the whole string in quotes); including shell metacharacters
is unwise. An example to enable routing when using the
NETKEY stack, one can use:</p>

<p>leftupdown=&quot;ipsec _updown --route yes&quot;</p>

<p>See ipsec_pluto(8) for details. Relevant only locally,
other end need not agree on it.</p>

<p>leftfirewall This option is obsolete and should not used
anymore.</p>

<p>If one or both security gateways are doing forwarding
firewalling (possibly including masquerading), and this is
specified using the firewall parameters, tunnels established
with IPsec are exempted from it so that packets can flow
unchanged through the tunnels. (This means that all subnets
connected in this manner must have distinct, non-overlapping
subnet address blocks.) This is done by the default updown
script (see ipsec_pluto(8)).</p>

<p>The implementation of this makes certain assumptions
about firewall setup, and the availability of the Linux
Advanced Routing tools. In situations calling for more
control, it may be preferable for the user to supply his own
updown script, which makes the appropriate adjustments for
his system.</p>

<p>CONN PARAMETERS: AUTOMATIC KEYING The following
parameters are relevant to automatic keying via IKE. Unless
otherwise noted, for a connection to work, in general it is
necessary for the two ends to agree exactly on the values of
these parameters.</p>

<p>auto what operation, if any, should be done
automatically at IPsec startup; currently-accepted values
are add (signifying an ipsec auto --add), ondemand
(signifying that plus an ipsec auto --ondemand), start
(signifying that plus an ipsec auto --up), and ignore (also
the default) (signifying no automatic startup operation).
See the config setup discussion below. Relevant only
locally, other end need not agree on it (but in general, for
an intended-to-be-permanent connection, both ends should use
auto=start to ensure that any reboot causes immediate
renegotiation).</p>

<p>The option ondemand used to be called route</p>

<p>authby how the two security gateways should authenticate
each other; acceptable values are rsasig (the default) for
RSA digital signatures based authentication, secret for
shared secrets (PSK) authentication, secret|rsasig for
either, never if negotiation is never to be attempted or
accepted (useful for shunt-only conns), and null for
null-authentication.</p>

<p>Digital signatures are superior in every way to shared
secrets. Especially IKEv1 in Aggressive Mode is vulnerable
to offline dictionary attacks and is performed routinely by
at least the NSA on monitored internet traffic globally. The
never option is only used for connections that do not
actually start an IKE negotiation, such as type=passthrough
connections. The auth method null is used for
&quot;anonymous opportunistic IPsec&quot; and should not be
used for regular pre-configured IPsec VPNs.</p>

<p>ike IKE encryption/authentication algorithm to be used
for the connection (phase 1 aka ISAKMP SA). The format is
&quot;cipher-hash;modpgroup, cipher-hash;modpgroup,
...&quot; Any left out option will be filled in with all
allowed default options. Multiple proposals are separated by
a comma. If an ike= line is specified, no other received
proposals will be accepted. Formerly there was a distinction
(by using a &quot;!&quot; symbol) between &quot;strict
mode&quot; or not. That mode has been obsoleted. If an ike=
option is specified, the mode is always strict, meaning no
other received proposals will be accepted. Some examples are
ike=3des-sha1,aes-sha1, ike=aes, ike=aes_ctr,
ike=aes_gcm256-sha2, ike=aes128-md5;modp2048,
ike=aes128-sha1;dh22,
ike=3des-md5;modp1024,aes-sha1;modp1536. The options must be
suitable as a value of ipsec_spi(8)&acute;s --ike option.
The default is to use IKE, and to allow all combinations
of:</p>

<p>cipher: 3des or aes128 or aes256 hash: sha1 or md5
pfsgroup (DHgroup): modp1024 or modp1536 or modp2048</p>

<p>Note that AES-GCM is an AEAD algorithm, meaning that it
performs encryption+authentication in one step. This means
that AES-GCM must not specify an authentication algorithm.
However, it does require a PRF function, so the second
argument to an AEAD algorithm denotes the PRF. So
ike=aes_gcm-sha2 means propose AES_GCM with no
authentication and using SHA2 as the prf. Note that for
phase2alg, there is no prf, so AES-GCM is specified for ESP
as phase2alg=aes_gcm-null. The AES-GCM and AES-CCM
algorithms support 8,12 and 16 byte ICV&acute;s. These can
be specified using a postfix, for example aes_gcm_a (for 8),
aes_gcm_b (for 12) and aes_gcm_c (for 16). The default
(aes_gcm without postfix) refers to the 16 byte ICV version.
It is strongly recommended to NOT use the 8 or 12 byte
versions of GCM or CCM.</p>

<p>Weak algorithms are regularly removed from libreswan.
Currently, 1DES and modp768 have been removed and modp1024
will be removed in the near future. Additionally, md5 and
sha1 will be removed within the next few years. Null
encryption is available, and should only be used for testing
or benchmarking purposes. Please do not request for insecure
algorithms to be re-added to libreswan.</p>

<p>Diffie-Hellman groups 22, 23 and 24 are also implemented
as per RFC-5114. Instead of the modp key syntax, use the
&quot;dh&quot; keyword, for example ike=3des-sha1;dh23</p>

<p>The modp syntax will be removed in favour of the dh
syntax.</p>

<p>phase2 Sets the type of SA that will be produced. Valid
options are: esp for encryption (the default), ah for
authentication only.</p>

<p>The very first IPsec designs called for use of AH plus
ESP to offer authentication, integrity and confidentiality.
That dual protocol use was a significant burden, so ESP was
extended to offer all three services, and AH remained as an
auth/integ. Only broken configurations (often used with
racoon) require the strange double authentication using
ah+esp. Additionally, AH does not play well with NATs, so it
is strongly recommended to use ESP with the null cipher if
you require unencrypted authenticated transport.</p>

<p>phase2alg Specifies the algorithms that will be
offered/accepted for a phase2 negotiation. If not specified,
a secure set of defaults will be used. Sets are separated
using comma&acute;s.</p>

<p>The default values are the same as for ike= Note also
that not all ciphers available to the kernel (eg through
CryptoAPI) are necessarily supported here.</p>

<p>The format for ESP is ENC-AUTH followed by an optional
PFSgroup. For instance, &quot;3des-md5&quot; or
&quot;aes256-sha1;modp2048&quot; or
&quot;aes-sha1,aes-md5&quot;.</p>

<p>For RFC-5114 DH groups, use the &quot;dh&quot; keyword,
eg &quot;aes256-sha1;dh23&quot;</p>

<p>The format for AH is AUTH followed by an optional
PFSgroup. For instance, &quot;md5&quot; or
&quot;sha1;modp1536&quot;.</p>

<p>AEAD algorithms such as AES-GCM and AES-CCM require null
for the authentication algorithm, for example
phase2alg=aes_ccm-null or phase2alg=aes_gcm-null. Note that
the ike= syntax for aes_gcm does not specify a null
authentication but specifies the prf instead. The supported
key sizes are 128, 192 and 256, which are specified
similarly to plain aes, i.e. phase2alg=aes_gcm256. A
subscript of _c, _b or _a can be used to refer to the
different ICV variants where a means 8 bytes, b means 12
bytes and c means 16 bytes. The default when not using a
subscript is the 16 byte ICV, the recommended value by
RFC-4106. Therefor phase2alg=aes_gcm256-null is equivalent
to phase2alg=aes_gcm_c256-null. It is recommended to migrate
to the _c versions (without specifying _c), as support for
smaller ICV&acute;s might be removed in the near future.</p>

<p>The supported algorithms depend on the libreswan
version, OS and kernel stack used. Possible ciphers are aes,
3des, aes_ctr, aes_gcm, aes_ccm, camellia, serpent and
twofish.</p>

<p>Note that openswan and versions of libreswan up to 3.6
require manually adding the salt size to the key size.
Therefor, to configure an older version of openswan or
libreswan, use: &quot;phase2alg=aes_ccm_c-280-null&quot; to
interop with a new libreswan using
&quot;phase2alg=aes_ccm256&quot;. For CCM, the
&acute;keysize&acute; needs to be increased by 24, resulted
in valid keysizes of 152, 215 and 280. For GCM the
&acute;keysize&acute; needs to be increased by 32, resulting
valid &acute;keysizes&acute; of 160, 224 and 288.</p>

<p>sha2-truncbug The default ESP hash truncation for
sha2_256 is 128 bits. Some IPsec implementations (Linux
before 2.6.33, some Cisco (2811?) routers) implement the
draft version which stated 96 bits. If a draft
implementation communicates with an RFC implementation, both
ends will reject encrypted packets from each other.</p>

<p>This option enables using the draft 96 bits version to
interop with those implementations. Currently the accepted
values are no, (the default) signifying default RFC
truncation of 128 bits, or yes, signifying the draft 96 bits
truncation.</p>

<p>Another workaround is to switch from sha2_256 to
sha2_128 or sha2_512.</p>

<p>nat-ikev1-method NAT Traversal in IKEv1 is negotiated
via Vendor ID options as specified in RFC 3947. However,
many implementations only support the draft version of the
RFC. Libreswan sends both the RFC and the most common draft
versions (02, 02_n and 03) to maximize interoperability.
Unfortunately, there are known broken implementations of RFC
3947, notably Cisco routers that have not been updated to
the latest firmware. As the NAT-T payload is sent in the
very first packet of the initiator, there is no method to
auto-detect this problem and initiate a workaround.</p>

<p>This option allows fine tuning which of the NAT-T
payloads to consider for sending and processing. Currently
the accepted values are drafts, rfc or both (the default).
To interoperate with known broken devices, use
nat-ikev1-method=drafts.</p>

<p>esp This option is obsolete. Please use phase2alg
instead.</p>

<p>ah AH authentication algorithm to be used for the
connection, e.g here. hmac-md5 The options must be suitable
as a value of ipsec_spi(8)&acute;s --ah option. The default
is not to use AH. If for some (invalid) reason you still
think you need AH, please use esp with the null encryption
cipher instead. Note also that not all ciphers available to
the kernel (eg through CryptoAPI) are necessarily supported
here.</p>

<p>fragmentation Whether or not to allow IKE fragmentation.
Valid values are are yes, (the default), no or force.</p>

<p>IKEv1 fragmentation capabilities are negotiated via a
well-known private vendor id. IKEv2 fragmentation support is
implemented using RFC 7383. If pluto does not receive the
fragmentation payload, no IKE fragments will be sent,
regardless of the fragmentation= setting. When set to yes,
IKE fragmentation will be attempted on the first re-transmit
of an IKE packet of a size larger then 576 bytes for IPv4
and 1280 bytes for IPv6. If fragmentation is set to force,
IKE fragmentation is used on initial transmits of such sized
packets as well. When we have received IKE fragments for a
connection, pluto behaves as if in force mode.</p>

<p>ikepad Whether or not to pad IKEv1 messages to a
multiple of 4 bytes. Valid values are are yes, (the default)
and no.</p>

<p>IKE padding is allowed in IKEv1 but it is known to cause
interoperability issues. The ikepad= option can be used to
disable IKEv1 padding. This is required for some devices
(such as Checkpoint in Aggressive Mode) that reject padded
IKEv1 packets. In IKEv2, no padding is allowed, and this
option has no effect. If you find a device that seems to
require IKE padding in IKEv2, please contact the libreswan
developers. This option should almost never be enabled.</p>

<p>ikev2 IKEv2 (RFC4309) settings to be used. Currently the
accepted values are permit, (the default) signifying no
IKEv2 should be transmitted, but will be accepted if the
other ends initiates to us with IKEv2; never or no
signifying no IKEv2 negotiation should be transmitted or
accepted; propose or yes signifying that we permit IKEv2,
and also use it as the default to initiate; insist,
signifying we only accept and receive IKEv2 - IKEv1
negotiations will be rejected.</p>

<p>If the ikev2= setting is set to permit or propose,
Libreswan will try and detect a &quot;bid down&quot; attack
from IKEv2 to IKEv1. Since there is no standard for
transmitting the IKEv2 capability with IKEv1, Libreswan uses
a special Vendor ID &quot;CAN-IKEv2&quot;. If a fall back
from IKEv2 to IKEv1 was detected, and the IKEv1 negotiation
contains Vendor ID &quot;CAN-IKEv2&quot;, Libreswan will
immediately attempt and IKEv2 rekey and refuse to use the
IKEv1 connection. With an ikev2= setting of insist, no IKEv1
negotiation is allowed, and no bid down attack is
possible.</p>

<p>narrowing IKEv2 (RFC5996) Section 2.9 Traffic Selector
narrowing options. Currently the accepted values are no,
(the default) signifying no narrowing will be proposed or
accepted, or yes, signifying IKEv2 negotiation may allow
establishing an IPsec connection with narrowed down traffic
selectors. This option is ignored for IKEv1.</p>

<p>There are security implications in allowing narrowing
down the proposal. For one, what should be done with packets
that we hoped to tunnel, but cannot. Should these be dropped
or send in the clear? Second, this could cause thousands of
narrowed down Child SAs to be created if the conn has a
broad policy (eg 0/0 to 0/0). One possible good use case
scenario is that a remote end (that you fully trust) allows
you to define a 0/0 to them, while adjusting what traffic
you route via them, and what traffic remains outside the
tunnel. However, it is always preferred to setup the exact
tunnel policy you want, as this will be much clearer to the
user.</p>

<p>sareftrack Set the method of tracking reply packets with
SArefs when using an SAref compatible stack. Currently only
the mast stack supports this. Acceptable values are yes (the
default), no or conntrack. This option is ignored when
SArefs are not supported. This option is passed as
PLUTO_SAREF_TRACKING to the updown script which makes the
actual decisions whether to perform any
iptables/ip_conntrack manipulation. A value of yes means
that an IPSEC mangle table will be created. This table will
be used to match reply packets. A value of conntrack means
that additionally, subsequent packets using this connection
will be marked as well, reducing the lookups needed to find
the proper SAref by using the ip_conntrack state. A value of
no means no IPSEC mangle table is created, and SAref
tracking is left to a third-party (kernel) module. In case
of a third party module, the SArefs can be relayed using the
statsbin= notification helper.</p>

<p>leftid how the left participant should be identified for
authentication; defaults to left. Can be an IP address (in
any ipsec_ttoaddr(3) syntax) or a fully-qualified domain
name which will be resolved. If preceded by @, the value is
used as a literal string and will not be resolved. To
support opaque identifiers (usually of type ID_KEY_ID, such
as used by Cisco to specify Group Name, use square brackets,
eg rightid=@[GroupName]. The magic value %fromcert causes
the ID to be set to a DN taken from a certificate that is
loaded. Prior to 2.5.16, this was the default if a
certificate was specified. The magic value %none sets the ID
to no ID. This is included for completeness, as the ID may
have been set in the default conn, and one wishes for it to
default instead of being explicitly set. The magic value
%myid stands for the current setting of myid. This is set in
config setup or by ipsec_whack(8)), or, if not set, it is
the IP address in %defaultroute (if that is supported by a
TXT record in its reverse domain), or otherwise it is the
system&acute;s hostname (if that is supported by a TXT
record in its forward domain), or otherwise it is
undefined.</p>

<p>When using certificate based ID&acute;s, one need to
specify the full RDN, optionally using wildcard matching (eg
CN=&acute;*&acute;). If the RDN contains a comma, this can
be masked using a comma (eg OU=&acute;Foo,, Bar and
associates&acute;)</p>

<p>leftrsasigkey the left participant&acute;s public key
for RSA signature authentication, in RFC 2537 format using
ipsec_ttodata(3) encoding. The magic value %none means the
same as not specifying a value (useful to override a
default). The value %dnsondemand (the default) means the key
is to be fetched from DNS at the time it is needed. The
value %dnsonload means the key is to be fetched from DNS at
the time the connection description is read from ipsec.conf;
currently this will be treated as %none if right=%any or
right=%opportunistic. The value %dns is currently treated as
%dnsonload but will change to %dnsondemand in the future.
The identity used for the left participant must be a
specific host, not %any or another magic value. The value
%cert will load the information required from a certificate
defined in %leftcert and automatically define leftid for
you. Caution: if two connection descriptions specify
different public keys for the same leftid, confusion and
madness will ensue.</p>

<p>leftrsasigkey2 if present, a second public key. Either
key can authenticate the signature, allowing for key
rollover.</p>

<p>leftcert If you are using leftrsasigkey=%cert this
defines the certificate nickname of your certificate in the
NSS database. This can be on software or hardware security
device.</p>

<p>leftca specifies the authorized Certificate Authority
(CA) that signed the certificate of the peer. If undefined,
it defaults to the CA that signed the certificate specified
in leftcert. The special rightca=%same is implied when not
specifying a rightca and means that only peers with
certificates signed by the same CA as the leftca will be
allowed. This option is only useful in complex multi CA
certificate situations. When using a single CA, it can be
safely omitted for both left and right.</p>

<p>leftsendcert This option configures when Libreswan will
send X.509 certificates to the remote host. Acceptable
values are yes|always (signifying that we should always send
a certificate), sendifasked (signifying that we should send
a certificate if the remote end asks for it), and no|never
(signifying that we will never send a X.509 certificate).
The default for this option is sendifasked which may break
compatibility with other vendor&acute;s IPsec
implementations, such as Cisco and SafeNet. If you find that
you are getting errors about no ID/Key found, you likely
need to set this to always. This per-conn option replaces
the obsolete global nocrsend option.</p>

<p>leftxauthserver Left is an XAUTH server. This can use
PAM for authentication or md5 passwords in
/etc/ipsec.d/passwd. These are additional credentials to
verify the user identity, and should not be confused with
the XAUTH group secret, which is just a regular PSK defined
in ipsec.secrets. The other side of the connection should be
configured as rightxauthclient. XAUTH connections cannot
rekey, so rekey=no should be specified in this conn. For
further details on how to compile and use XAUTH, see
README.XAUTH. Acceptable values are yes or no (the
default).</p>

<p>leftxauthclient Left is an XAUTH client. The xauth
connection will have to be started interactively and cannot
be configured using auto=start. Instead, it has to be
started from the commandline using ipsec auto --up connname.
You will then be prompted for the username and password. To
setup an XAUTH connection non-interactively, which defeats
the whole purpose of XAUTH, but is regularly requested by
users, it is possible to use a whack command - ipsec whack
--name baduser --ipsecgroup-xauth --xauthname badusername
--xauthpass password --initiate The other side of the
connection should be configured as rightxauthserver.
Acceptable values are yes or no (the default).</p>

<p>leftxauthusername The XAUTH username associated with
this XAUTH connection. The XAUTH password can be configured
in the ipsec.secrets file.</p>

<p>leftmodecfgserver Left is a Mode Config server. It can
push network configuration to the client. Acceptable values
are yes or no (the default).</p>

<p>leftmodecfgclient Left is a Mode Config client. It can
receive network configuration from the server. Acceptable
values are yes or no (the default).</p>

<p>xauthby When IKEv1 XAUTH support is available, set the
method used by XAUTH to authenticate the user with IKEv1.
The currently supported values are file (the default), pam
or alwaysok. The password file is located at
/etc/ipsec.d/passwd, and follows a syntax similar to the
Apache htpasswd file, except an additional connection name
argument (and optional static IP address) are also
present:</p>

<p>username:password:conname:ipaddress</p>

<p>For supported password hashing methods, see crypt(3). If
pluto is running in FIPS mode, some hash methods, such as
MD5, might not be available. Threads are used to launch an
xauth authentication helper for file as well as PAM
methods.</p>

<p>The alwaysok should only be used if the XAUTH user
authentication is not really used, but is required for
interoperability, as it defeats the whole point of XAUTH
which is to rely on a secret only known by a human. See also
pam-authorize=yes</p>

<p>xauthfail When XAUTH support is available, set the
failure method desired when authentication has failed. The
currently supported values are hard (the default) and soft.
A soft failure means the IPsec SA is allowed to be
established, as if authentication had passed successfully,
but the XAUTH_FAILED environment variable will be set to 1
for the updown script, which can then be used to redirect
the user into a walled garden, for example a payment
portal.</p>

<p>pam-authorize IKEv1 supports PAM authorization via XAUTH
using xauthby=pam. IKEv2 does not support receiveing a
plaintext username and password. Libreswan does not yet
support EAP authentication methods for IKE. The
pam-authorize=yes option performs an authorization call via
PAM, but only includes the remote ID (not username or
password). This allows for backends to disallow an ID based
on non-password situations, such as &quot;user
disabled&quot; or &quot;user over quota&quot;. See also
xauthby=pam</p>

<p>modecfgpull Pull the Mode Config network information
from the server. Acceptable values are yes or no (the
default).</p>

<p>modecfgdns1, modecfgdns2, modecfgdomain, modecfgbanner
When configured as modecfg server, specifying any of these
options will cause those options and values to be sent to
the modecfg client during the XAUTH+ModeCFG phase (phase
1.5).</p>

<p>When we are an XAUTH client, these options will be
treated as defaults. If the remote XAUTH server did not pass
us one of these options, the configured defaults are used to
reconfigure the local DNS setup.</p>

<p>The split tunneling directive will be sent automatically
if the xauth server side has configured a network other than
0.0.0.0/0</p>

<p>remote-peer-type Set the remote peer type. This can
enable additional processing during the IKE negotiation.
Acceptable values are cisco or ietf (the default). When set
to cisco, support for Cisco IPsec gateway redirection and
Cisco obtained DNS and domainname are enabled. This includes
automatically updating (and restoring) /etc/resolv.conf.
These options require that XAUTH is also enabled on this
connection.</p>

<p>nm-configured Mark this connection as controlled by
Network Manager. Acceptable values are yes or no (the
default). Currently, setting this to yes will cause
libreswan to skip reconfiguring resolv.conf when used with
XAUTH and ModeConfig.</p>

<p>forceencaps In some cases, for example when ESP packets
are filtered or when a broken IPsec peer does not properly
recognise NAT, it can be useful to force RFC-3948
encapsulation. forceencaps=yes forces the NAT detection code
to lie and tell the remote peer that RFC-3948 encapsulation
(ESP in UDP port 4500 packets) is required. Acceptable
values are yes or no (the default).</p>

<p>nat-keepalive whether to send any NAT-T keep-alives.
These one byte packets are send to prevent the NAT router
from closing its port when there is not enough traffic on
the IPsec connection. Acceptable values are: yes (the
default) and no.</p>

<p>initial-contact whether to send an INITIAL_CONTACT
payload to the peer we are initiating to, if we currently
have no IPsec SAs up with that peer. Acceptable values are:
no (the default) and yes. It is recommended to leave this
option unset, unless the remote peer requires it to allow
reconnects. The only known peer at this time is Cisco, which
will not allow a reconnect (despite authentication) to
replace an existing IPsec SA unless it receives an
INITIAL_CONTACT payload. Receiving this payload is ignored
and the choice to replace or add an IPsec SA when libreswan
is a responder is purely based on the uniqueids setting,
which should be left enabled unless libreswan acts as an
XAUTH server using PSK (&quot;group secret&quot;). This
option can cause a few seconds of downtime on the IPsec
tunnel between the time the remote clears the old IPsec SA
in response to our INITIAL_CONTACT message, and the time we
finish setting up the new IPsec SA. If there is an XAUTH
step in between, and especially when XAUTH requires the use
of some two-factor token, this downtime could be even
longer.</p>

<p>cisco-unity whether to send a CISCO_UNITY payload to the
peer. Acceptable values are: no (the default) and yes. It is
recommended to leave this option unset, unless the remote
peer (Cisco client or server) requires it. This option does
not modify local behaviour. It can be needed to connect as a
client to a Cisco server. It can also be needed to act as a
server for a Cisco client, which otherwise might send back
an error DEL_REASON_NON_UNITY_PEER.</p>

<p>send-vendorid whether to send our Vendor ID during IKE.
Acceptable values are: no (the default) and yes. The vendor
id sent can be configured using the &quot;config setup&quot;
option myvendorid=. It defaults to OE-Libreswan-VERSION.</p>

<p>Vendor ID&acute;s can be useful in tracking
interoperability problems. However, specific vendor
identification and software versions can be useful to an
attacker when there are known vulnerabilities to a specific
vendor/version.</p>

<p>The prefix OE stands for &quot;Opportunistic
Encryption&quot;. This prefix was historically used by The
FreeS/WAN Project and The Openswan Project (openswan up to
version 2.6.38) and in one Xeleranized openswan versions
(2.6.39). Further Xeleranized openswan&acute;s use the
prefix OSW.</p>

<p>overlapip a boolean (yes/no) that determines, when
*subnet=vhost: is used, if the virtual IP claimed by this
states created from this connection can with states created
from other connections.</p>

<p>Note that connection instances created by the
Opportunistic Encryption or PKIX (x.509) instantiation
system are distinct internally. They will inherit this
policy bit.</p>

<p>The default is no.</p>

<p>This feature is only available with kernel drivers that
support SAs to overlapping conns. At present only the
(klips) mast protocol stack supports this feature.</p>

<p>reqid a unique identifier used to match IPsec SAs using
iptables with NETKEY/XFRM. This identifier is normally
automatically allocated in groups of 4. It is exported to
the _updown script as REQID. On Linux, reqids are supported
with IP Connection Tracking and NAT (iptables).
Automatically generated values use the range 16380 and
higher. Manually specified reqid values therefor must be
between 1 and 16379.</p>

<p>Automatically generated reqids use a range of 0-3 (eg
16380-16383 for the first reqid). These are used depending
on the exact policy (AH, AH+ESP, IPCOMP, etc). Manually
assigned reqids are all identical. Instantiations of
connections (those using %any wildcards) will all use the
same reqid.</p>

<p>For KLIPS, when using the MAST variant, a different
mechanism called SAref is in use. See overlapip and
sareftrack.</p>

<p>dpddelay Set the delay (in seconds) between Dead Peer
Detection (RFC 3706) keepalives (R_U_THERE, R_U_THERE_ACK)
that are sent for this connection (default 30 seconds). If
dpddelay is set, dpdtimeout also needs to be set.</p>

<p>dpdtimeout Set the length of time (in seconds) we will
idle without hearing either an R_U_THERE poll from our peer,
or an R_U_THERE_ACK reply. After this period has elapsed
with no response and no traffic, we will declare the peer
dead, and remove the SA (default 120 seconds). If dpdtimeout
is set, dpdaction also needs to be set.</p>

<p>dpdaction When a DPD enabled peer is declared dead, what
action should be taken. hold (default) means the eroute will
be put into %hold status, while clear means the eroute and
SA with both be cleared. restart means that ALL SAs to the
dead peer will renegotiated.</p>

<p>dpdaction=clear is really only useful on the server of a
Road Warrior config.</p>

<p>The value restart_by_peer has been obsoleted and its
functionality moved into the regular restart action.</p>

<p>pfs whether Perfect Forward Secrecy of keys is desired
on the connection&acute;s keying channel (with PFS,
penetration of the key-exchange protocol does not compromise
keys negotiated earlier); Since there is no reason to ever
refuse PFS, Libreswan will allow a connection defined with
pfs=no to use PFS anyway. Acceptable values are yes (the
default) and no.</p>

<p>pfsgroup This option is obsoleted, please use phase2alg
if you need the PFS to be different from phase1 (the
default) using: phase2alg=aes128-md5;modp1024</p>

<p>aggrmode Use IKEv1 Aggressive Mode instead of IKEv1 Main
Mode. This option has no effect when IKEv2 is used.
Acceptable values are no (the default) or yes. When this
option is enabled, IKEv1 Main Mode will no longer be allowed
for this connection.</p>

<p>Aggressive Mode is less secure, and more vulnerable to
Denial Of Service attacks. It is also vulnerable to brute
force attacks with software such as ikecrack. It should not
be used, and it should especially not be used with XAUTH and
group secrets (PSK). If the remote system administrator
insists on staying irresponsible, enable this option.</p>

<p>Aggressive Mode is further limited to only proposals
with one DH group as there is no room to negotiate the DH
group. Therefor it is mandatory for Aggressive Mode
connections that both ike= and phase2alg= options are
specified with only one fully specified proposal using one
DH group.</p>

<p>The KE payload is created in the first exchange packet
when using aggressive mode. The KE payload depends on the DH
group used. This is why there cannot be multiple DH groups
in IKEv1 aggressive mode. In IKEv2, which uses a similar
method to IKEv1 Aggressive Mode, there is an INVALID_KE
response payload that can inform the initiator of the
responder&acute;s desired DH group and so an IKEv2
connection can actually recover from picking the wrong DH
group by restarting its negotiation.</p>

<p>salifetime how long a particular instance of a
connection (a set of encryption/authentication keys for user
packets) should last, from successful negotiation to expiry;
acceptable values are an integer optionally followed by s (a
time in seconds) or a decimal number followed by m, h, or d
(a time in minutes, hours, or days respectively) (default
8h, maximum 24h). Normally, the connection is renegotiated
(via the keying channel) before it expires. The two ends
need not exactly agree on salifetime, although if they do
not, there will be some clutter of superseded connections on
the end which thinks the lifetime is longer.</p>

<p>The keywords &quot;keylife&quot; and
&quot;lifetime&quot; are obsoleted aliases for
&quot;salifetime.&quot; Change your configs to use
&quot;salifetime&quot; instead.</p>

<p>rekey whether a connection should be renegotiated when
it is about to expire; acceptable values are yes (the
default) and no. The two ends need not agree, but while a
value of no prevents Pluto from requesting renegotiation, it
does not prevent responding to renegotiation requested from
the other end, so no will be largely ineffective unless both
ends agree on it.</p>

<p>rekeymargin how long before connection expiry or
keying-channel expiry should attempts to negotiate a
replacement begin; acceptable values as for salifetime
(default 9m). Relevant only locally, other end need not
agree on it.</p>

<p>rekeyfuzz maximum percentage by which rekeymargin should
be randomly increased to randomize rekeying intervals
(important for hosts with many connections); acceptable
values are an integer, which may exceed 100, followed by a
%&acute; (default set by ipsec_pluto(8), currently 100%).
The value of rekeymargin, after this random increase, must
not exceed salifetime. The value 0% will suppress time
randomization. Relevant only locally, other end need not
agree on it.</p>

<p>keyingtries how many attempts (a whole number or
%forever) should be made to negotiate a connection, or a
replacement for one, before giving up (default %forever).
The value %forever means never give up (obsolete: this can
be written 0). Relevant only locally, other end need not
agree on it.</p>

<p>ikelifetime how long the keying channel of a connection
(buzzphrase: ISAKMP SA) should last before being
renegotiated; acceptable values as for salifetime (default
set by ipsec_pluto(8), currently 1h, maximum 24h). The
two-ends-disagree case is similar to that of salifetime.</p>

<p>retransmit-timeout how long a single packet, including
retransmits of that packet, may take before the IKE attempt
is aborted. If rekeying is enabled, a new IKE attempt is
started. The default set by ipsec_pluto(8), currently is
60s. See also: retransmit-interval, rekey and
keyingtries.</p>

<p>retransmit-interval the initial interval time period,
specified in msecs, that pluto waits before retransmitting
an IKE packet. This interval is doubled for each attempt
(exponential back-off). The default set by ipsec_pluto(8),
currently is 500. See also: retransmit-timeout, rekey and
keyingtries.</p>

<p>compress whether IPComp compression of content is
proposed on the connection (link-level compression does not
work on encrypted data, so to be effective, compression must
be done before encryption); acceptable values are yes and no
(the default).</p>

<p>As of libreswan 3.1, both ends must agree. In previous
versions of libreswan, openswan and freeswan, compression
was always accepted even if not configured. In light of the
BEAST attacks on TLS, using compression and encryptions has
come under more scrutiny, and it was decided that it should
be possible for the local policy of an endpoint to disallow
compression. A value of yes causes pluto to propose
compression and reject proposals without it. A value of no
prevents pluto from proposing compression; a proposal to
compress will be rejected.</p>

<p>metric Set the metric for the routes to the ipsecX or
mastX interface. This makes it possible to do host failover
from another interface to ipsec using route management. This
value is passed to the _updown scripts as PLUTO_METRIC. This
option is only available with KLIPS or MAST on Linux.
Acceptable values are positive numbers, with the default
being 1.</p>

<p>mtu Set the MTU for the route(s) to the remote endpoint
and/or subnets. This is sometimes required when the overhead
of the IPsec encapsulation would cause the packet the become
too big for a router on the path. Since IPsec cannot trust
any unauthenticated ICMP messages, PATH MTU discovery does
not work. This can also be needed when using
&quot;6to4&quot; IPV6 deployments, which adds another header
on the packet size. Acceptable values are positive numbers.
There is no default.</p>

<p>nflog If set, the NFLOG group number to log this
connection&acute;s pre-crypt and post-decrypt traffic to.
The default value of 0 means no logging at all. This option
is only available on linux kernel 2.6.14 and later. It
allows common network utilities such as tcpdump, wireshark
and dumpcap, to use nflog:XXX pseudo interfaces where XXX is
the nflog group number. During the updown phase of a
connection, iptables will be used to add and remove the
source/destination pair to the nflog group specified. The
rules are setup with the nflog-prefix matching the
connection name. See also the global nflog-all option.</p>

<p>priority The priority in the kernel SPD/SAD database,
when matching up packets. Each kernel (NETKEY, KLIPS, OSX,
etc) has its own mechanism for setting the priority. Setting
this option to non-zero passes the priority to the kernel
stack unmodified. The maximum value depends on the stack. It
is recommended not to exceed 65536</p>

<p>KLIPS and NETKEY use a priority system based on
&quot;most specific match first&quot;. It uses an internal
algorithm to calculate these based on network prefix length,
protocol and port selectors. A lower value means a higher
priority.</p>

<p>Typical values are about the 2000 range. These can be
seen on the NETKEY stack using ip xfrm policy when the
connection is up. For &quot;anonymous IPsec&quot; or
Opportunistic Encryption based connections, a much lower
priority (65535) is used to ensure administrator configured
IPsec always takes precedence over opportunistic IPsec.</p>

<p>sendca How much of our available X.509 trust chain to
send with the End certificate, excluding any root
CA&acute;s. Specifying issuer sends just the issuing
intermediate CA, while all will send the entire chain of
intermediate CA&acute;s.none (the default) will not send any
CA certs.</p>

<p>disablearrivalcheck whether KLIPS&acute;s normal
tunnel-exit check (that a packet emerging from a tunnel has
plausible addresses in its header) should be disabled;
acceptable values are yes and no (the default). Tunnel-exit
checks improve security and do not break any normal
configuration. Relevant only locally, other end need not
agree on it.</p>

<p>labeled-ipsec Whether labeled IPsec should be enabled or
not; acceptable values are no (the default) and yes. See
also policy-label= and secctx-attr-type=</p>

<p>policy-label The string representation of an access
control security label that is interpreted by the LSM (e.g.
SELinux) for use with Labeled IPsec. See also loopback=,
labeled-ipsec= and secctx-attr-type=. For example,
policy-label=system_u:object_r:ipsec_spd_t:s0-s15:c0.c1023</p>

<p>failureshunt what to do with packets when negotiation
fails. The default is none: no shunt; passthrough, drop, and
reject have the obvious meanings.</p>

<p>negotiationshunt What to do with packets during the IKE
negotiation. Valid options are hold (the default) or
passthrough. This should almost always be left to the
default hold value to avoid cleartext packet leaking. The
only reason to set this to passthrough is if plaintext
service availability is more important than service security
or privacy, a scenario that also implies
failureshunt=passthrough and most likely authby=%null using
Opportunistic Encryption.</p>

<p>CONFIG SECTIONS At present, the only config section
known to the IPsec software is the one named setup, which
contains information used when the software is being started
(see ipsec_setup(8)). Here&acute;s an example:</p>

<p>config setup interfaces=&quot;ipsec0=eth1
ipsec1=ppp0&quot; klipsdebug=none plutodebug=control
protostack=auto</p>

<p>Parameters are optional unless marked (required).</p>

<p>The currently-accepted parameter names in a config setup
section are:</p>

<p>myid the identity to be used for %myid. %myid is used in
the implicit policy group conns and can be used as an
identity in explicit conns. If unspecified, %myid is set to
the IP address in %defaultroute (if that is supported by a
TXT record in its reverse domain), or otherwise the
system&acute;s hostname (if that is supported by a TXT
record in its forward domain), or otherwise it is undefined.
An explicit value generally starts with @&acute;&acute;.</p>

<p>protostack decide which protocol stack is going to be
used. Valid values are &quot;klips&quot;, &quot;netkey&quot;
(the default) and &quot;mast&quot;. The &quot;mast&quot;
stack is a variation for the KLIPS stack. The value
&quot;auto&quot; has been obsoleted.</p>

<p>interfaces virtual and physical interfaces for IPsec to
use: a single virtual=physical pair, a (quoted!) list of
pairs separated by white space, or %none. One of the pairs
may be written as %defaultroute, which means: find the
interface d that the default route points to, and then act
as if the value was ipsec0=d&acute;&acute;. %defaultroute is
the default; %none must be used to denote no interfaces, or
when using the NETKEY stack. If %defaultroute is used
(implicitly or explicitly) information about the default
route and its interface is noted for use by
ipsec_auto(8).)</p>

<p>listen IP address to listen on (default depends on
interfaces= setting). Currently only accepts one IP
address.</p>

<p>ikeport The IKE port to listen on. The default value is
500. As IKE is an internet standard, changing this means
pluto will no longer be able to interop with other devices,
unless they have also been explicitly configured to use a
non-standard IKE port. There might also be other subtle
assumptions within the kernel that port 500 is used.
Changing this port is strongly discouraged, and should
probably only be done for testing or when required to
circumvent VPN blocking technologies as employed by certain
commercial companies and national governments. See also
nat-ikeport.</p>

<p>nflog-all If set, the NFLOG group number to log all
pre-crypt and post-decrypt traffic to. The default value of
0 means no logging at all. This option is only available on
linux kernel 2.6.14 and later. It allows common network
utilities such as tcpdump, wireshark and dumpcap, to use
nflog:XXX pseudo interfaces where XXX is the nflog group
number. During startup and shutdown of the IPsec service,
iptables commands will be used to add or remove the global
NFLOG table rules. The rules are setup with the nflog-prefix
all-ipsec. See also the per-connection nflog option.</p>

<p>nat_traversal OBSOLETE. Support for NAT Traversal is
always enabled.</p>

<p>disable_port_floating OBSOLETE</p>

<p>force_keepalive This option has been obsoleted since
libreswan version 3.2. See the nat-keepalive option.</p>

<p>nat-ikeport The IKE NAT Traversal floating port (see
RFC-3947) to listen on. The default value is 4500. As
IKE/NATT is an internet standard, changing this means pluto
will no longer be able to interoperate with other devices,
unless they have also been explicitly configured to use a
non-standard IKE/NATT port. There might also be other subtle
assumptions within the kernel that port 4500 is used.
Changing this port is strongly discouraged, and should
probably only be done for testing or when required to
circumvent VPN blocking technologies as employed by certain
commercial companies and national governments. See also
ikeport.</p>

<p>keep-alive The delay (in seconds) for NAT-T keep-alive
packets, if these are enabled using nat-keepalive This
parameter may eventually become per-connection.</p>

<p>virtual-private contains the networks that are allowed
as subnet= for the remote clients when using the vhost: or
vnet: keywords in the subnet= parameters. In other words,
the address ranges that may live behind a NAT router through
which a client connects. This value is usually set to all
the RFC-1918 address space, excluding the space used in the
local subnet behind the NAT (An IP address cannot live at
two places at once). IPv4 address ranges are denoted as
%v4:a.b.c.d/mm and IPv6 is denoted as
%v6:aaaa::bbbb:cccc:dddd:eeee/mm. One can exclude subnets by
using the !. For example, if the VPN server is giving access
to 192.168.1.0/24, this option should be set to:
virtual-private=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%v4:172.16.0.0/12,%v4:!192.168.1.0/24.
This parameter is only needed on the server side and not on
the client side that resides behind the NAT router, as the
client will just use its IP address for the inner IP
setting. This parameter may eventually become
per-connection. See also leftsubnet=</p>

<p>Note: It seems that T-Mobile in the US and Rogers/Fido
in Canada have started using 25.0.0.0/8 as their pre-NAT
range. This range technically belongs to the Defence
Interoperable Network Services Authority (DINSA), an agency
of the Ministry of Defence of the United Kingdom. The
network range seems to not have been announced for decades,
which is probably why these organisations
&quot;borrowed&quot; this range. To support roadwarriors on
these 3G networks, you might have to add it to the
virtual-private= line.</p>

<p>myvendorid The string to use as our vendor id (VID) when
send-vendorid=yes. The default is OE-Libreswan-VERSION.</p>

<p>oe This option is ignored for now. It used to determine
if Opportunistic Encryption will be enabled. Opportunistic
Encryption is the term to describe using IPsec tunnels
without prearrangement. It uses IPSECKEY or TXT records to
announce public RSA keys for certain IP&acute;s or
identities. However, this feature is going to be moved
outside of the pluto IKE daemon into a separate process,
more closely tied with a local DNS(SEC) server. The default
value used to be no, so this should not affect anyone.
Contact the developers if you are interested in working on
the re-implementation of OE.</p>

<p>nhelpers how many pluto helpers are started to help with
cryptographic operations. Pluto will start (n-1) of them,
where n is the number of CPU&acute;s you have (including
hypherthreaded CPU&acute;s). A value of 0 forces pluto to do
all operations in the main process. A value of -1 tells
pluto to perform the above calculation. Any other value
forces the number to that amount.</p>

<p>seedbits Pluto uses the NSS crypto library as its random
source. Some government Three Letter Agencies require that
pluto reads additional bits from /dev/random and feed these
into the NSS RNG before drawing random from the NSS library,
despite the NSS library itself already seeding its internal
state. This process can block pluto for an extended time
during startup, depending on the entropy of the system.
Therefor, the default is to not perform this redundant
seeding. If specifying a value, it is recommended to specify
at least 460 bits (for FIPS) or 440 bits (for BSI).</p>

<p>secctx-attr-type The value for the IPsec SA security
context attribute identifier which is used for Labeled
IPsec. Defaults to the private use IANA value 32001 from the
IPsec SA attributes registry. Old openswan versions might
still be using the (stolen) value 10, which has since been
assigned by IANA for something else. Other values are not
recommended unless IANA assigns an actual value for this.
See also labeled-ipsec=, loopback= and policy-label=</p>

<p>plutofork Whetherpluto will turn into a daemon by
forking in the background, or whether it will remain on the
foreground. Valid options are yes (the default) or no. Older
init systems, such as sysv initscripts, require that pluto
forks into the background. Newer init systems, such as
systemd or upstart prefer the process remains in the
foreground. The current default reflects the fact that most
systems are still based on sysv init scripts. Init systems
can override this configuration option by starting pluto
specifically with --nofork specified on the command line to
start the pluto daemon after specifying the --config
/etc/ipsec.conf option.</p>

<p>crlcheckinterval interval expressed in second units, for
example crlcheckinterval=60 for 60 seconds, after which
pluto will verify loaded X.509 CRL&acute;s for expiration.
If any of the CRL&acute;s is expired, or if they previously
failed to get updated, a new attempt at updating the CRL is
made. The first attempt to update a CRL is started at two
times the crlcheckinterval. If set to 0, which is also the
default value if this option is not specified, CRL updating
is disabled.</p>

<p>strictcrlpolicy if not set, pluto is tolerant about
missing or expired X.509 Certificate Revocation Lists
(CRL&acute;s), and will allow peer certificates as long as
they do not appear on an expired CRL. When this option is
enabled, all connections with an expired or missing CRL will
be denied. Active connections will be terminated at rekey
time. This setup is more secure, but also dangerous. If the
CRL is fetched through an IPsec tunnel with a CRL that
expired, the entire VPN server will be dead in the water
until a new CRL is manually transferred to the machine (if
it allows non-IPsec connections). Acceptable values are yes
or no (the default).</p>

<p>ocsp-enable Whether to perform Online Certificate Store
Protocol (&quot;OCSP&quot;) checks on those certificates
that have an OCSP URI defined. Acceptable values are yes or
no (the default).</p>

<p>ocsp-strict if set to no, pluto is tolerant about
failing to obtain an OCSP responses and a certificate is not
rejected when the OCSP request fails, only when the OCSP
request succeeds and lists the certificate as revoked. If
set to yes, any failure on obtaining an OCSP status for a
certificate will be fatal and the certificate will be
rejected. Acceptable values are yes or no (the default).</p>

<p>The strict mode refers to the NSS
ocspMode_FailureIsVerificationFailure mode, while non-strict
mode refers to the NSS
ocspMode_FailureIsNotAVerificationFailure mode.</p>

<p>ocsp-timeout The time until an OCSP request is aborted
and considered failed. The default value is 2 seconds.</p>

<p>ocsp-uri The URI to use for OCSP requests instead of the
default OCSP URI listed in the CA certificate. This requires
the ocsp-trustname option to be set to the nick (friendly
name) of the OCSP server certificate, which needs to be
present in the NSS database. These option combined with the
next option sets the OCSP default responder.</p>

<p>ocsp-trustname The nickname of the certificate that has
been imported into the NSS database of the server handling
the OCSP requests. This requires the ocsp-uri option to be
set as well. This option and the previous options sets the
OCSP default responder.</p>

<p>forwardcontrol This option is obsolete and ignored.
Please use net.ipv4.ip_forward = 0 in /etc/sysctl.conf
instead to control the ip forwarding behaviour.</p>

<p>rp_filter This option is obsolete and ignored. Please
use the net.ipv4.conf/[iface]/rp_filter = 0 options in
/etc/sysctl.conf instead. This option is badly documented;
it must be 0 in many cases for ipsec to function.</p>

<p>syslog the syslog(2) facility name and priority to use
for startup/shutdown log messages, default daemon.error.</p>

<p>klipsdebug how much KLIPS debugging output should be
logged. An empty value, or the magic value none, means no
debugging output (the default). The magic value all means
full output. Otherwise only the specified types of output (a
quoted list, names separated by white space) are enabled;
for details on available debugging types, see
ipsec_klipsdebug(8). This KLIPS option has no effect on
NETKEY, Windows or BSD stacks.</p>

<p>plutodebug how much Pluto debugging output should be
logged. An empty value, or the magic value none, means no
debugging output (the default). The magic value all means
full output. Otherwise only the specified types of output (a
quoted list, names without the --debug- prefix, separated by
white space) are enabled; for details on available debugging
types, see ipsec_pluto(8).</p>

<p>uniqueids whether a particular participant ID should be
kept unique, with any new (automatically keyed) connection
using an ID from a different IP address deemed to replace
all old ones using that ID. Acceptable values are yes (the
default) and no. Participant IDs normally are unique, so a
new (automatically-keyed) connection using the same ID is
almost invariably intended to replace an old one.</p>

<p>plutorestartoncrash prevent pluto from restarting after
it crashed. This option should only be used by developers
when debugging a crasher. It will prevent overwriting a core
file on a new start, or a cascade of core files. This option
is also required if used with plutostderrlog= to avoid
clearing the logs of the crasher. Values can be yes (the
default) or no.</p>

<p>This option is ignored on modern init systems such as
systemd(1) and upstart. For systemd, change the
ipsec.service file to contain Restart=no. See
systemd.service(5)</p>

<p>logfile do not use syslog, but rather log to stderr, and
direct stderr to the argument file. This option used to be
called plutostderrlog=</p>

<p>logappend If pluto is instructed to log to a file using
logfile=, this option determines whether the log file should
be appended to or overwritten. Valid options are yes (the
default) to append and no to overwrite. Since on modern
systems, pluto is restarted by other daemons, such as
systemd, this option should be left at its default yes value
to preserve the log entries of previous runs of pluto. The
option is mainly of use for running the test suite, which
needs to create new log files from scratch.</p>

<p>logtime When pluto is directed to log to a file using
logfile=, this option determines whether or not to log the
current timestamp as prefix. Values are yes (the default) or
no. The no value can be used to create logs without
ephemeral timestamps, such as those created when running the
test suite. This option used to be called
plutostderrlogtime=</p>

<p>force-busy This option has been obsoleted, please see
ddos-mode.</p>

<p>ddos-mode The startup mode of the DDOS defense
mechanism. Acceptable values are busy, unlimited or auto
(the default). This option can also be given to the IKE
daemon while running, for example by issuing ipsec whack
--ddos--busy. When in busy mode, pluto activates anti-DDoS
counter measures. Currently, counter measures consist of
requiring IKEv2 anti-DDoS cookies on new incoming IKE
requests, and a more aggressive cleanup of partially
established or AUTH_NULL connections.</p>

<p>ddos-ike-treshold The number of half-open IKE SAs before
the pluto IKE daemon will be placed in busy mode. When in
busy mode, pluto activates anti-DDoS counter measures. The
default is 25000. See also ddos-mode and ipsec whack
--ddos-XXX.</p>

<p>max-halfopen-ike The number of half-open IKE SAs before
the IKE daemon starts refusing all new IKE attempts.
Established IKE peers are not affected. The default value is
50000.</p>

<p>shuntlifetime The time until bare shunts (kernel
policies not associated with connections) are deleted from
the kernel. The default value is 15m. When using
Opportunistic Encryption to a specific host fails, the
system will either install a %pass or %hold shunt to let the
traffic out clear text or block it. During the the
shuntlifetime, no new Opportunistic Encryption attempt will
be started, although the system will still respond to
incoming OE requests from the remote IP. See also
failureshunt and negotiationshunt</p>

<p>xfrmlifetime The time in seconds until the NETKEY/XFRM
acquire state times out. The default value is 300 seconds.
For auto=ondemand connections and Opportunistic connections
an IPsec policy is installed in the kernel. If an incoming
or outgoing packet matches this policy, a state is created
in the kernel and the kernel sends an ACQUIRE message to the
IKE daemon pluto. While this state is in place, no new
acquires will come in for this connection. The default
should be fine for most people. One use case of shortening
these is if opportunistc encryption is used towards cloud
instances that can quickly re-use IP addresses. This value
is only used during the libreswan startup process by the
ipsec _stackmanager helper. See also failureshunt and
negotiationshunt</p>

<p>dumpdir in what directory should things started by setup
(notably the Pluto daemon) be allowed to dump core? The
default value is /var/run/pluto. When SELinux runs in
enforced mode, changing this requires a similar change in
the SELinux policy for the pluto daemon.</p>

<p>statsbin This option specifies an optional external
program to report tunnel state changes too. The default is
not to report tunnel state changes. This program can be used
to notify the user&acute;s desktop (dbus, NetworkManager) or
to report tunnel changes to a central logging server.</p>

<p>ipsecdir in what directory the X509, NSS and OE related
files should be stored. The default value is /etc/ipsec.d.
When SELinux runs in enforced mode, changing this requires a
similar change in the SELinux policy for the pluto daemon.
Note that NSS generated db files contain their location
within their files, so you cannot move this directory
without re-creating the NSS files.</p>

<p>secretsfile in which file the secret credentials such as
preshared keys (PSKs) are stored. See man ipsec.secrets for
the syntax. The default value is /etc/ipsec.secrets.</p>

<p>perpeerlog if pluto should split the logs in a per-peer
directory. Valid options are no(the default) and yes. When
enabled, logging is split into directories based on IP
address. When disabled, logging is done via syslog or a
single log file, as defined by logfile=</p>

<p>perpeerlogdir in what directory the per-peer log should
be created, if enabled via the perpeerlog option. This will
result in sub directories in the structure /192/0/2. The
default value is /var/log/pluto/peer/. When SELinux runs in
enforced mode, changing this requires a similar change in
the SELinux policy for the pluto daemon.</p>

<p>fragicmp whether a tunnel&acute;s need to fragment a
packet should be reported back with an ICMP message, in an
attempt to make the sender lower his PMTU estimate;
acceptable values are no (the default) and yes. This KLIPS
option has no effect on NETKEY, Windows or BSD stacks.</p>

<p>hidetos whether a tunnel packet&acute;s TOS field should
be set to 0 rather than copied from the user packet inside;
acceptable values are yes (the default) and no. This KLIPS
option has no effect on NETKEY, Windows or BSD stacks.</p>

<p>overridemtu value that the MTU of the ipsecn
interface(s) should be set to, overriding IPsec&acute;s
(large) default. This parameter is needed only in special
situations. This KLIPS option has no effect on NETKEY,
Windows or BSD stacks.</p>

<p>IMPLICIT CONNS The system automatically defines several
conns to implement default policy groups. Each can be
overridden by explicitly defining a new conn with the same
name. If the new conn has auto=ignore, the definition is
suppressed.</p>

<p>Here are the automatically supplied definitions.</p>

<p>conn clear type=passthrough authby=never
left=%defaultroute right=%group auto=route</p>

<p>conn clear-or-private type=passthrough
left=%defaultroute leftid=%myid right=%opportunisticgroup
failureshunt=passthrough keyingtries=3 ikelifetime=1h
salifetime=1h rekey=no auto=route</p>

<p>conn private-or-clear type=tunnel left=%defaultroute
leftid=%myid right=%opportunisticgroup
failureshunt=passthrough keyingtries=3 ikelifetime=1h
salifetime=1h rekey=no auto=route</p>

<p>conn private type=tunnel left=%defaultroute leftid=%myid
right=%opportunisticgroup failureshunt=drop keyingtries=3
ikelifetime=1h salifetime=1h rekey=no auto=route</p>

<p>conn block type=reject authby=never left=%defaultroute
right=%group auto=route</p>

<p># default policy conn packetdefault type=tunnel
left=%defaultroute leftid=%myid left=0.0.0.0/0
right=%opportunistic failureshunt=passthrough keyingtries=3
ikelifetime=1h salifetime=1h rekey=no auto=route</p>

<p>These conns are not affected by anything in conn
%default. They will only work if %defaultroute works. The
leftid will be the interfaces IP address; this requires that
reverse DNS records be set up properly.</p>

<p>The implicit conns are defined after all others. It is
appropriate and reasonable to use also=private-or-clear (for
example) in any other opportunistic conn.</p>

<p>POLICY GROUP FILES The optional files under
/etc/ipsec.d/policy, including</p>

<p>/etc/ipsec.d/policies/clear
/etc/ipsec.d/policies/clear-or-private
/etc/ipsec.d/policies/private-or-clear
/etc/ipsec.d/policies/private
/etc/ipsec.d/policies/block</p>

<p>may contain policy group configuration information to
supplement ipsec.conf. Their contents are not
security-sensitive.</p>

<p>These files are text files. Each consists of a list of
CIDR blocks, one per line. White space followed by #
followed by anything to the end of the line is a comment and
is ignored, as are empty lines.</p>

<p>A connection in ipsec.conf which has right=%group or
right=%opportunisticgroup is a policy group connection. When
a policy group file of the same name is loaded, with</p>

<p>ipsec auto --rereadgroups</p>

<p>or at system start, the connection is instantiated such
that each CIDR block serves as an instance&acute;s right
value. The system treats the resulting instances as normal
connections.</p>

<p>For example, given a suitable connection definition
private, and the file /etc/ipsec.d/policy/private with an
entry 192.0.2.3, the system creates a connection instance
private#192.0.2.3. This connection inherits all details from
private, except that its right client is 192.0.2.3.</p>

<p>DEFAULT POLICY GROUPS The standard Libreswan install
includes several policy groups which provide a way of
classifying possible peers into IPsec security classes:
private (talk encrypted only), private-or-clear (prefer
encryption), clear-or-private (respond to requests for
encryption), clear and block. Implicit policy groups apply
to the local host only, and are implemented by the IMPLICIT
CONNECTIONS described above.</p>

<p>OBSOLETE Various options have recently been obsoleted
and are ignored. The options prepluto= and plutopost= have
been obsoleted because these were used by the (obsoleted)
shell wrappers launching the pluto daemon. If this
functionality is needed, look at your initsystem for
support. For example, the systemd initsystem has the options
ExecStartPre= and ExecStopPost= to accomplish the same. The
option plutoopts= has also been obsoleted for this reason. A
replacement can be found in the PLUTO_OPTS environment
variable in the file /etc/sysconfig/pluto (Fedora/RHEL) or
/etc/defaults/pluto (Debian/Ubuntu). The last two options
obsoleted by the removal of the old shell scripts are pluto=
and plutowait=.</p>

<p>The following ipsec commands have been obsoleted: ipsec
_confread, ipsec _include, ipsec _plutoload, ipsec
_realsetup, ipsec _startklips and ipsec _startnetkey due to
the new parsing and startup methods and ipsec copyright,
ipsec lwdnsq, ipsec mailkey, ipsec policy, ipsec
showdefaults and ipsec showpolicy because they were no
longer needed or current.</p>

<p>CHOOSING A CONNECTION [THIS SECTION IS EXTREMELY OUT OF
DATE When choosing a connection to apply to an outbound
packet caught with a %trap, the system prefers the one with
the most specific eroute that includes the packet&acute;s
source and destination IP addresses. Source subnets are
examined before destination subnets. For initiating, only
routed connections are considered. For responding, unrouted
but added connections are considered.</p>

<p>When choosing a connection to use to respond to a
negotiation which doesn&acute;t match an ordinary conn, an
opportunistic connection may be instantiated. Eventually,
its instance will be /32 -&gt; /32, but for earlier stages
of the negotiation, there will not be enough information
about the client subnets to complete the instantiation.</p>

<p>FILES /etc/ipsec.conf /etc/ipsec.d/policies/clear
/etc/ipsec.d/policies/clear-or-private
/etc/ipsec.d/policies/private-or-clear
/etc/ipsec.d/policies/private
/etc/ipsec.d/policies/block</p>

<p>SEE ALSO ipsec(8), ipsec_ttoaddr(8), ipsec_auto(8),
ipsec_rsasigkey(8)</p>

<p>HISTORY Designed for the FreeS/WAN project
&lt;http://www.freeswan.org&gt; by Henry Spencer.</p>

<p>BUGS Before reporting new bugs, please ensure you are
using the latest version of Libreswan, and if not using
KLIPS, please ensure you are using the latest kernel code
for your IPsec stack.</p>

<p>When type or failureshunt is set to drop or reject,
Libreswan blocks outbound packets using eroutes, but assumes
inbound blocking is handled by the firewall. Libreswan
offers firewall hooks via an updown script. However, the
default ipsec _updown provides no help in controlling a
modern firewall.</p>

<p>Including attributes of the keying channel
(authentication methods, ikelifetime, etc.) as an attribute
of a connection, rather than of a participant pair, is
dubious and incurs limitations.</p>

<p>The use of %any with the protoport= option is ambiguous.
Should the SA permits any port through or should the SA
negotiate any single port through? The first is a basic conn
with a wildcard. The second is a template. The second is the
current behaviour, and it&acute;s wrong for quite a number
of uses involving TCP. The keyword %one may be introduced in
the future to separate these two cases.</p>

<p>It would be good to have a line-continuation syntax,
especially for the very long lines involved in RSA signature
keys.</p>

<p>First packet caching is only implemented for the
KLIPS(NG) and MAST stacks. NETKEY returns POSIX-breaking
responses, visible as connect: Resource temporarily
unavailable errors. This affects Opportunistic Encryption
and DPD. Functionality on the BSD and Windows stacks is
unknown.</p>

<p>Some state information is only available when using
KLIPS, and will return errors on other IPsec stacks. These
include ipsec eroute, ipsec spi and ipsec look.</p>

<p>Multiple L2TP clients behind the same NAT router, and
multiple L2TP clients behind different NAT routers using the
same Virtual IP is currently only working for the KLIPSNG
stack.</p>

<p>The ability to specify different identities, authby, and
public keys for different automatic-keyed connections
between the same participants is misleading; this
doesn&acute;t work dependably because the identity of the
participants is not known early enough. This is especially
awkward for the Road Warrior case, where the remote IP
address is specified as 0.0.0.0, and that is considered to
be the participant for such connections.</p>

<p>In principle it might be necessary to control MTU on an
interface-by-interface basis, rather than with the single
global override that overridemtu provides. This feature is
planned for a future release.</p>

<p>If conns are to be added before DNS is available,
left=FQDN, leftnextop=FQDN, and leftrsasigkey=%dnsonload
will fail. ipsec_pluto(8) does not actually use the public
key for our side of a conn but it isn&acute;t generally
known at a add-time which side is ours (Road Warrior and
Opportunistic conns are currently exceptions).</p>

<p>The myid option does not affect explicit ipsec auto
--add or ipsec auto --replace commands for implicit
conns.</p>

<p>AUTHOR Paul Wouters documenter</p>

<p>libreswan 03/07/2016 IPSEC.CONF(5)</p>
<hr>
</body>
</html>
