<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:35:21 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>SNMP_AGENT_API(3) Net-SNMP SNMP_AGENT_API(3)</p>

<p>NAME snmp_agent_api - embedding an agent into a external
application</p>

<p>SYNOPSIS #include &lt;net-snmp/net-snmp-config.h&gt;
#include &lt;net-snmp/net-snmp-includes.h&gt; #include
&lt;net-snmp/agent/net-snmp-agent-includes.h&gt;</p>

<p>int main (int argc, char *argv[]) { int agentx_subagent
= 1; /* Change this if youre a master agent. */</p>

<p>snmp_enable_stderrlog();</p>

<p>/* If were an AgentX subagent... */ if (agentx_subagent)
{ /* ...make us an AgentX client. */
netsnmp_ds_set_boolean(NETSNMP_DS_APPLICATION_ID,
NETSNMP_DS_AGENT_ROLE, 1); }</p>

<p>init_agent(&quot;yourappname&quot;);</p>

<p>/* Initialize your MIB code here. */
init_my_mib_code();</p>

<p>/* yourappname will be used to read yourappname.conf
files. */ init_snmp(&quot;yourappname&quot;);</p>

<p>/* If were going to be a SNMP master agent... */ if
(!agentx_subagent) init_master_agent(); /* Listen on default
port (161). */</p>

<p>/* Your main loop here... */ while (whatever) { /* if
you use select(), see snmp_api(3) */ /* --- OR --- */
agent_check_and_process(0); /* 0 == dont block */ }</p>

<p>/* At shutdown time: */
snmp_shutdown(&quot;yourappname&quot;); }</p>

<p>Then: $(CC) ... net-snmp-config --agent-libs</p>

<p>DESCRIPTION Our goal is to create a easy to use
interface to the Net-SNMP package such that you can take
code that you have written that has been designed to be a
Net-SNMP MIB module and embed it into an external
application where you can either chose to be a SNMP master
agent or an AgentX sub-agent using the same MIB module code.
Our suggestion is that you use our (or another) SNMP agent
as the AgentX master agent and chose to become an AgentX
subagent which then attaches to the master.</p>

<p>The Net-SNMP package provides a pair of libraries that
enables easy embedding of an SNMP or AgentX agent into an
external software package. AgentX is an extensible protocol
designed to allow multiple SNMP sub- agents all run on one
machine under a single SNMP master agent. It is defined in
RFC 2741.</p>

<p>You will need to perform a few tasks in order to
accomplish this. First off, you will need to initialize both
the SNMP library and the SNMP agent library. As indicated
above, this is done slightly differently depending on
whether or not you are going to perform as a master agent or
an AgentX sub-agent.</p>

<p>CONFIGURATION If you intend to operate as an AgentX
sub-agent, you will have to con- figured the Net-SNMP
package with agentx support (which is turned on by default,
so just dont turn it off)</p>

<p>Additionally, you will need to link against the net-snmp
libraries (use the output of &quot;net-snmp-config
--agent-libs&quot; to get a library list) and call
subagent_pre_init() as indicated above.</p>

<p>COMPILING In order to make use of any of the above API,
you will need to link against at least the four libraries
listed above.</p>

<p>FUNCTIONS where to find out more information on them. It
is certainly not a com- plete list of what is available
within all the net-snmp libraries.</p>

<p>snmp_enable_stderrlog() Logs error output from the SNMP
agent to the standard error stream.</p>

<p>netsnmp_ds_set_boolean() Please see the default_store(3)
manual page for more information about this API.</p>

<p>init_agent(char *name) Initializes the embedded agent.
This should be called before the init_snmp() call. name is
used to dictate what .conf file to read when init_snmp() is
called later.</p>

<p>init_snmp(char *name) Initializes the SNMP library. Note
that one of the things this will do will be to read
configuration files in an effort to con- figure your
application. It will attempt to read the configura- tion
files named by the name string that you passed in. It can be
used to configure access control, for instance. Please see
the read_config(3), snmp_config(5), and snmpd.conf(5) manual
pages for further details on this subject.</p>

<p>init_master_agent(void) Initializes the master agent and
causes it to listen for SNMP requests on its default UDP
port of 161.</p>

<p>agent_check_and_process(int block) This checks for
packets arriving on the SNMP port and processes them if some
are found. If block is non-zero, the function call will
block until a packet arrives or an alarm must be run (see
snmp_alarm(3)). The return value from this function is a
posi- tive integer if packets were processed, zero if an
alarm occurred and -1 if an error occured.</p>

<p>snmp_shutdown(char *name); This shuts down the agent,
saving any needed persistent storage, etc.</p>

<p>SEE ALSO http://www.net-snmp.org/tutorial-5/toolkit/,
select(2), snmp_api(3), default_store(3), snmp_alarm(3),
read_config(3), snmp_config(5), snmpd.conf(5)</p>

<p>4.2 Berkeley Distribution 02 Apr 2001
SNMP_AGENT_API(3)</p>
<hr>
</body>
</html>
