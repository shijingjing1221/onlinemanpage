<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:43:56 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>VIRT-V2V(1) User Contributed Perl Documentation
VIRT-V2V(1)</p>

<p>NAME virt-v2v - Convert a guest to use KVM</p>

<p>SYNOPSIS virt-v2v -i libvirtxml -os imported --network
default guest-domain.xml</p>

<p>virt-v2v -ic esx://esx.server/ -os imported --network
default esx_guest</p>

<p>virt-v2v -ic esx://esx.server/ -o rhev -os
rhev.nfs.storage:/export_domain --network rhevm
esx_guest</p>

<p>DESCRIPTION virt-v2v converts guests from a foreign
hypervisor to run on KVM, managed by libvirt or Red Hat
Enterprise Virtualisation (RHEV) version 2.2 or later. It
can currently convert Red Hat Enterprise Linux and Windows
guests running on Xen, VirtualBox, and VMware ESX. It will
enable VirtIO drivers in the converted guest if
possible.</p>

<p>OPTIONS -i input Specifies what input method to use to
obtain the guest for conversion. The default is
&quot;libvirt&quot;. Supported options are:</p>

<p>libvirt Guest argument is the name of a libvirt
domain.</p>

<p>libvirtxml Guest argument is the path to an XML file
containing a libvirt domain.</p>

<p>-ic URI Specifies the connection to use when using the
libvirt input method. If omitted, this defaults to
qemu:///system when virt-v2v runs as root, or
qemu:///session when virt-v2v runs as a regular user.</p>

<p>N.B. virt-v2v can currently automatically obtain guest
storage from local libvirt connections, ESX connections, and
connections over SSH. Other types of connection are not
supported.</p>

<p>-o method Specifies the output method. Supported output
methods are:</p>

<p>libvirt Create a libvirt guest. -os must specify a
libvirt storage pool for the libvirt output method.</p>

<p>Also see the -oc option.</p>

<p>rhev Create a guest on a RHEV Export storage domain,
which can later be imported into RHEV using the UI. -os must
specify the location of a RHEV export storage domain for the
RHEV output method.</p>

<p>If no output type is specified, it defaults to
libvirt.</p>

<p>-oc URI Specifies the libvirt connection to use to
create the converted guest. If omitted, this defaults to
qemu:///system when virt-v2v runs as root, or
qemu:///session when virt-v2v runs as a regular user.</p>

<p>N.B. virt-v2v must be able to write directly to storage
described by this libvirt connection. This makes writing to
a remote connection impractical at present.</p>

<p>-os storage The output method dependent location where
new storage will be created for the converted guest.</p>

<p>For the libvirt output method, this must be the name of
a storage pool.</p>

<p>For the rhev output method, this specifies the NFS path
to a RHEV Export storage domain. Note that the storage
domain must have been previously initialised by RHEV. The
domain must be in the format &lt;host&gt;:&lt;path&gt;,
eg:</p>

<p>rhev-storage.example.com:/rhev/export</p>

<p>The nfs export must be mountable and writable by the
machine running virt-v2v.</p>

<p>-op pool See -os for the libvirt output method.</p>

<p>DEPRECATED Use -os instead.</p>

<p>-osd domain See -os for the rhev output method.</p>

<p>DEPRECATED Use -os instead.</p>

<p>-of format Specifies the on-disk format which will be
used for the converted guest. Currently supported options
are raw and qcow2. If not specified, the converted guest
will use the same format as the source guest.</p>

<p>-oa allocation Specifies whether the converted guest
should be sparse or preallocated. If not specified, the
converted guest will use the same allocation scheme as the
source.</p>

<p>-on outputname Rename the guest.</p>

<p>If this option is not given, then the output name is the
same as the input name.</p>

<p>--vmtype type Specify the type of guest which will be
created on a RHEV target. Options are desktop or server. If
this option is not specified, a default option will be
chosen based on the detected guest operating system:</p>

<p>Desktop &middot; Fedora</p>

<p>&middot; RHEL Client/Workstation/Desktop</p>

<p>&middot; Windows XP/Vista/7</p>

<p>Server &middot; RHEL Server/AS/ES</p>

<p>&middot; Windows 2003/2003r2/2008/2008r2</p>

<p>If the guest OS is not detected as any of the above, it
will default to server.</p>

<p>-f file | --config file Load a virt-v2v configuration
from file. Multiple configuration files can be specified,
which will be searched in the order they are specified on
the command line. If no configuration is specified, defaults
to /etc/virt-v2v.conf and /var/lib/virt-v2v/virt-v2v.db in
that order.</p>

<p>When overriding the default config file it is
recommended that /var/lib/virt-v2v/virt-v2v.db is also
specified, as it contains default configuration data
required for conversions.</p>

<p>-n network | --network network Map all guest bridges or
networks which dont have a mapping in the configuration file
to network.</p>

<p>This option cannot be used in conjunction with
--bridge.</p>

<p>-b bridge | --bridge bridge Map all guest bridges or
networks which dont have a mapping in the configuration file
to bridge.</p>

<p>This option cannot be used in conjunction with
--network.</p>

<p>-p profile | --profile profile Take default values for
output method, output storage and network mappings from
profile in the configuration file.</p>

<p>--root=ask --root=single --root=first --root=/dev/sdX
Choose the root filesystem to be converted.</p>

<p>In the case where the virtual machine is dual-boot or
multi-boot, or where the VM has other filesystems that look
like operating systems, this option can be used to select
the root filesystem (a.k.a. &quot;C: drive&quot; or
&quot;/&quot;) of the operating system that is to be
converted. The Windows Recovery Console, certain attached
DVD drives, and bugs in libguestfs inspection heuristics,
can make a guest look like a multi-boot operating
system.</p>

<p>The default in virt-v2v X 0.7.1 was --root=single, which
causes virt-v2v to die if a multi-boot operating system is
found.</p>

<p>Since virt-v2v X 0.7.2 the default is now --root=ask: If
the VM is found to be multi-boot, then virt-v2v will stop
and list the possible root filesystems and ask the user
which to use. This requires that virt-v2v is run
interactively.</p>

<p>--root=first means to choose the first root device in
the case of a multi-boot operating system. Since this is a
heuristic, it may sometimes choose the wrong one.</p>

<p>You can also name a specific root device, eg.
--root=/dev/sda2 would mean to use the second partition on
the first hard drive. If the named root device does not
exist or was not detected as a root device, then virt-v2v
will fail.</p>

<p>Note that there is a bug in grub which prevents it from
successfully booting a multiboot system if VirtIO is
enabled. Grub is only able to boot an operating system from
the first VirtIO disk. Specifically, /boot must be on the
first VirtIO disk, and it cannot chainload an OS which is
not in the first VirtIO disk.</p>

<p>--list-profiles Display a list of target profile names
specified in the configuration file.</p>

<p>--help Display brief help.</p>

<p>--version Display version number and exit.</p>

<p>PREPARING TO CONVERT A GUEST Local storage requirements
Whenever possible, virt-v2v copies a guest s storage
directly from the source hypervisor to the target hypervisor
without using any local storage. However, this is not
possible in all circumstances. Specifically when
transferring a guests storage over SSH and also either doing
a format conversion, or changing the allocation policy of
qcow2 storage, virt-v2v will cache a local copy of the
guests storage. By default, this local cache will be created
in /tmp. If /tmp does not have sufficient storage space, it
can be written to another directory by setting the TMPDIR
environment variable.</p>

<p>Local Xen guests N.B. The following is required when
converting guests on a host which used to run Xen, but has
been updated to run KVM. It is not required when converting
a Xen guest imported directly from a running libvirt/Xen
instance.</p>

<p>virt-v2v uses a libvirt domain description to determine
the current configuration of the guest, including the
location of its storage. This should be obtained from the
host running the guest pre-conversion by running:</p>

<p>virsh dumpxml &lt;domain&gt; &gt; &lt;domain&gt;.xml</p>

<p>This will require a reboot if the host running Xen is
the same host that will run KVM. This is because libvirt
needs to connect to a running xen hypervisor to obtain its
metadata.</p>

<p>Local VirtualBox guests The following is required when
converting guests which used to run VirtualBox and are being
converted to KVM. The conversion needs a guest XML
definition file which needs to be adjusted for the guest to
be converted (at least name, uuid, image path, image type,
and MAC address):</p>

<p>qemu-img convert -O qcow2 /tmp/v-rhel.vdi
/var/lib/libvirt/images/v-rhel.img virsh --connect
qemu:///system pool-refresh default virt-cat
/var/lib/libvirt/images/v-rhel.img
/etc/sysconfig/network-scripts/ifcfg-eth0 | grep ^HWADDR #
Replace the MAC address in the guest XML definition file or
adjust # ifcfg-eth0 after booting up the guest to match the
MAC address defined in # XML file virt-v2v -i libvirtxml -os
default /tmp/v-rhel.xml</p>

<p>N.B. For the time being when converting VirtualBox
Windows guests the VirtualBox Guest Additions need to be
manually uninstalled on the guest when still running on
VirtualBox.</p>

<p>Converting to run on libvirt/KVM Create a local storage
pool for transferred storage</p>

<p>virt-v2v copies the guest storage to the local machine
during import. When converting to run on libvirt, it creates
new storage in a locally defined libvirt pool. This pool can
be defined using any libvirt tool, and can be of any
type.</p>

<p>The simplest way to create a new pool is with
virt-manager(1). Pools can be defined from the Storage tab
under Host Details.</p>

<p>Create local network interfaces</p>

<p>The local machine must have an appropriate network for
the converted guest to connect to. This is likely to be a
bridge interface. A bridge interface can be created using
standard tools on the host.</p>

<p>Since version 0.8.3, virt-manager(1) can also create and
manage bridges.</p>

<p>Converting to run on RHEV Create an NFS export
domain</p>

<p>virt-v2v can convert guests to run on RHEV 2.2 or later.
It does this by writing the converted guest directly to an
Export NFS storage domain. The guest can later be imported
into a RHEV Data Center through the UI.</p>

<p>In RHEV 2.2, a new Export storage domain is created by
clicking on New Domain in the Storage tab. Ensure that the
Domain function is Export and the Storage type is NFS. See
the RHEV documentation for details. The NFS storage domain
must be mountable by the machine running virt-v2v.</p>

<p>N.B. When exporting to RHEV, virt-v2v must run as
root.</p>

<p>Import the appropriate Guest Tools ISO</p>

<p>When converting Windows guests, it is strongly
recommended that the Guest Tools ISO is installed before the
guest is converted. This must be done using the ISO
Uploader, which can be found on your RHEV-M system under
Start-&gt;Red Hat-&gt;RHEV Manager-&gt;ISO Uploader. This
will allow RHEV to automatically update the guests drivers
to the latest versions and install any required agents.</p>

<p>CONVERTING A LOCAL XEN GUEST The following requires that
the domain XML is available locally, and that the storage
referred to in the domain XML is available locally at the
same paths.</p>

<p>To perform the conversion, run:</p>

<p>virt-v2v -i libvirtxml -os &lt;pool&gt; [--network
&lt;network name&gt;] &lt;domain&gt;.xml</p>

<p>where &quot;&lt;domain&gt;.xml&quot; is the path to the
exported guest domains xml, and &quot;&lt;pool&gt;&quot; is
the local storage pool where copies of the guests disks will
be created.</p>

<p>The --network option may be provided for simple network
mappings. For more complex mappings, see
virt-v2v.conf(5).</p>

<p>If it is not possible to provide software updates over
the network in your environment, software will be installed
as specified in virt-v2v.conf. See virt-v2v.conf(5) for
details.</p>

<p>It is possible to avoid specifying replacement kernels
in the virt-v2v config file by ensuring that the guest has
an appropriate kernel installed prior to conversion. If your
guest uses a Xen paravirtualised kernel (it would be called
something like kernel-xen or kernel-xenU), you can install a
regular kernel, which wont reference a hypervisor in its
name, alongside it. You shouldnt make this newly installed
kernel your default kernel because Xen may not boot it.
virt-v2v will make it the default during conversion.</p>

<p>CONVERTING A GUEST FROM VMWARE ESX N.B. libvirt version
0.7.0 or greater is required to connect to ESX.</p>

<p>virt-v2v can convert a guest from VMware ESX, including
transferring its storage.</p>

<p>N.B. virt-v2v does not transfer snapshots from ESX. Only
the latest flat storage is transferred.</p>

<p>The guest MUST be shut down in ESX before conversion
starts. virt-v2v will not proceed if the guest is still
running. To convert the guest, run:</p>

<p>virt-v2v -ic esx://&lt;esx.server&gt;/ -os &lt;pool&gt;
[--network &lt;network name&gt;] &lt;domain&gt;</p>

<p>where:</p>

<p>&middot; &lt;esx.server&gt; is the hostname of the ESX
server hosting the guest to be converted.</p>

<p>N.B. This hostname must match the hostname reported in
the ESX servers SSL certificate, or verification will
fail.</p>

<p>&middot; &lt;pool&gt; is the name of the local storage
pool where copies of the guests storage will be created.</p>

<p>&middot; &lt;domain&gt; is the name of the guest on the
ESX server which is to be converted.</p>

<p>The --network option may be provided for simple network
mappings. For more complex mappings, see
virt-v2v.conf(5).</p>

<p>Authenticating to the ESX server Connecting to the ESX
server will require authentication. virt-v2v supports
password authentication when connecting to ESX. It reads
passwords from $HOME/.netrc. The format of this file is
described in netrc(5). An example entry is:</p>

<p>machine esx01.example.com login root password s3cr3t</p>

<p>N.B. The permissions of .netrc MUST be set to 0600, or
it will be ignored.</p>

<p>Connecting to an ESX server with an invalid certificate
In non-production environments, the ESX server may have an
invalid certificate, for example a self-signed certificate.
In this case, certificate checking can be explicitly
disabled by adding ?no_verify=1 to the connection URI as
shown below:</p>

<p>... -ic esx://&lt;esx.server&gt;/?no_verify=1 ...</p>

<p>EXPORTING A GUEST TO RHEV virt-v2v can export to RHEV
any guest that it can convert. This includes:</p>

<p>&middot; Local Xen guests</p>

<p>&middot; ESX guests</p>

<p>&middot; Local libvirt/KVM guests</p>

<p>To export to RHEV, specify -o rhev on the command line,
and ensure -os specifies the location of a RHEV export
storage domain as in the following examples:</p>

<p>Exporting a local Xen guest to RHEV virt-v2v -i
libvirtxml -o rhev -os &lt;export_sd&gt; [--network
&lt;network name&gt;] &lt;domain&gt;.xml</p>

<p>Export a VMware ESX guest to RHEV virt-v2v -ic
esx://&lt;esx.server&gt;/ -o rhev -os &lt;export_sd&gt;
[--network &lt;network name&gt;] &lt;domain&gt;</p>

<p>Export a local libvirt/KVM guest to RHEV virt-v2v -o
rhev -os &lt;export_sd&gt; [--network &lt;network name&gt;]
&lt;domain&gt;</p>

<p>RUNNING THE CONVERTED GUEST Libvirt output method On
successful completion, virt-v2v will create a new libvirt
domain for the converted guest with the same name as the
original guest. It can be started as usual using libvirt
tools, for example virt-manager(1).</p>

<p>RHEV output method On successful completion virt-v2v
will have written the new guest to the export storage
domain, but it will not yet be ready to run. It must be
imported into RHEV using the UI before it can be used.</p>

<p>In RHEV 2.2 this is done from the Storage tab. Select
the export domain the guest was written to. A pane will
appear underneath the storage domain list displaying several
tabs, one of which is VM Import. The converted guest will be
listed here. Select the appropriate guest an click Import .
See the RHEV documentation for additional details.</p>

<p>POST-CONVERSION TASKS Guest network configuration
virt-v2v cannot currently reconfigure a guest s network
configuration. If the converted guest is not connected to
the same subnet as the source, its network configuration may
have to be updated.</p>

<p>Converting a Windows guest When converting a Windows
guests, the conversion process is split into 2 stages:</p>

<p>1. Offline conversion.</p>

<p>2. First boot.</p>

<p>The guest will be bootable after the offline conversion
stage, but will not yet have all necessary drivers installed
to work correctly. These will be installed automatically the
first time the guest boots.</p>

<p>N.B. Take care not to interrupt the automatic driver
installation process when logging in to the guest for the
first time, as this may prevent the guest from subsequently
booting correctly.</p>

<p>Windows Recovery Console virt-v2v does not support
conversion of the Windows Recovery Console. If a guest has a
recovery console installed and VirtIO was enabled during
conversion, attempting to boot the recovery console will
result in a BSOD.</p>

<p>Windows XP x86 does not support the Windows Recovery
Console on VirtIO systems, so there is no resolution to
this. However, on Windows XP AMD64 and Windows 2003 (x86 and
AMD64), the recovery console can be re- installed after
conversion. The re-installation procedure is the same as the
initial installation procedure. It is not necessary to
remove the recovery console first. Following
re-installation, the recovery console will work as
intended.</p>

<p>GUEST CONFIGURATION CHANGES As well as configuring
libvirt appropriately, virt-v2v will make certain changes to
a guest to enable it support running under a KVM host either
with or without virtio driver. These changes are guest OS
specific. Currently only Red Hat based Linux distributions
are supported.</p>

<p>Linux virt-v2v will make the following changes to a
Linux guest:</p>

<p>Kernel Un-bootable, i.e. xen paravirtualised, kernels
will be uninstalled. No new kernel will be installed if
there is a remaining kernel which supports virtio. If no
remaining kernel supports virtio and the configuration file
specifies a new kernel it will be installed and configured
as the default.</p>

<p>X reconfiguration If the guest has X configured, its
display driver will be updated. See &quot;GUEST
DRIVERS&quot; for which driver will be used.</p>

<p>Rename block devices If changes have caused block
devices to change name, these changes will be reflected in
/etc/fstab.</p>

<p>Configure device drivers Whether virtio or non-virtio
drivers are configured, virt-v2v will ensure that the
correct network and block drivers are specified in the
modprobe configuration.</p>

<p>initrd virt-v2v will ensure that the initrd for the
default kernel supports booting the root device, whether it
is using virtio or not.</p>

<p>SELinux virt-v2v will initiate a relabel of the guest on
the next boot. This ensures that any changes it has made are
correctly labelled according to the guests local policy.</p>

<p>LINUX GUEST DRIVERS Virt-v2v will configure the
following drivers in a Linux guest:</p>

<p>VirtIO X display cirrus Block virtio_blk Network
virtio_net</p>

<p>Additionally, initrd will preload the virtio_pci
driver.</p>

<p>Non-VirtIO X display cirrus Block IDE Network e1000</p>

<p>WINDOWS GUEST DRIVERS Virt-v2v will configure the
following drivers in a Windows guest:</p>

<p>VirtIO X display cirrus Block viostor Network netkvm</p>

<p>Non-VirtIO X display cirrus Block IDE Network
rtl8139</p>

<p>BUGS To get a list of bugs against virt-v2v use this
link:</p>


<p>&lt;https://bugzilla.redhat.com/buglist.cgi?component=virt-v2v&amp;product=Virtualization+Tools&gt;</p>

<p>To report a new bug against virt-v2v use this link:</p>


<p>&lt;https://bugzilla.redhat.com/enter_bug.cgi?component=virt-v2v&amp;product=Virtualization+Tools&gt;</p>

<p>When reporting a bug, please check:</p>

<p>&middot; That the bug hasnt been reported already.</p>

<p>&middot; That you are testing a recent version.</p>

<p>&middot; Describe the bug accurately, and give a way to
reproduce it.</p>

<p>SEE ALSO virt-v2v.conf(5), virt-manager(1),
&lt;http://libguestfs.org/&gt;.</p>

<p>AUTHOR Richard W.M. Jones
&lt;http://et.redhat.com/~rjones/&gt;</p>

<p>Matthew Booth &lt;mbooth@redhat.com&gt;</p>

<p>COPYRIGHT Copyright (C) 2009-2012 Red Hat Inc.</p>

<p>This program is free software; you can redistribute it
and/or modify it under the terms of the GNU General Public
License as published by the Free Software Foundation; either
version 2 of the License, or (at your option) any later
version.</p>

<p>This program is distributed in the hope that it will be
useful, but WITHOUT ANY WARRANTY; without even the implied
warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
PURPOSE. See the GNU General Public License for more
details.</p>

<p>You should have received a copy of the GNU General
Public License along with this program; if not, write to the
Free Software Foundation, Inc., 51 Franklin Street, Fifth
Floor, Boston, MA 02110-1301 USA.</p>

<p>perl v5.10.1 2013-11-12 VIRT-V2V(1)</p>
<hr>
</body>
</html>
