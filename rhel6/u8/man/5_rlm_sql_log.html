<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:31:55 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>rlm_sql_log(5) FreeRADIUS Module rlm_sql_log(5)</p>

<p>NAME rlm_sql_log - FreeRADIUS Module</p>

<p>DESCRIPTION The rlm_sql_log module appends the SQL
queries in a log file which is read later by the
scripts/radsqlrelay Perl program.</p>

<p>The purpose of this module is to de-couple the storage
of long-term accounting data in SQL from &quot;live&quot;
information needed by the RADIUS server as its running. If
you are not using SQL for simultaneous login restrictions
(i.e. &quot;sql&quot; is not listed in the
&quot;session&quot; section of &quot;radiusd.conf&quot;),
then this module allows you to log SQL queries to a file,
and then process them at your leisure.</p>

<p>The benefit of this approach is that for a busy server,
the overhead of performing SQL qeuries may be significant.
Also, if the SQL databases are large (as is typical for ones
storing months of data), the INSERTs and UPDATEs may take a
relatively long time. Rather than slowing down the RADIUS
server by having it interact with a database, you can just
log the queries to a file, and then run those queries on
another machine, or at a time when the RADIUS server is
typically lightly loaded.</p>

<p>If the &quot;sql&quot; module is listed in the
&quot;session&quot; section of &quot;radiusd.conf&quot;,
then a similar system can still be used. In that case, one
database would be used to maintain &quot;live&quot; session
information. That database would be small, fast, and
information would be deleted from it when a user logs out. A
second database would store long-term accounting
information, as described above.</p>

<p>LIMITATIONS This module only performs the dynamic
expansion of the variables found in the SQL statements. No
operation is executed on the database server. (this would be
done later by an external program) That means the module is
useful only with non-&quot;SELECT&quot; statements.</p>

<p>CONFIGURATION The main configuration items to be aware
of are the path of the log file and the different SQL
queries.</p>

<p>path An entry named &quot;path&quot; sets the full path
of the file where the SQL queries are recorded. (this
variable is run through dynamic string expansion, and can
include FreeRADIUS variables to create a dynamic
filename)</p>

<p>Accounting queries When a accounting record is
processed, the module searches a config entry keyed by the
Acct-Status-Type attribute present in the packet. For
example, the SQL to be run on an accounting start must be
named &quot;Start&quot; in the configuration for the module.
Other usual values for Acct-Status-Type are
&quot;Stop&quot;, &quot;Alive&quot;,
&quot;Accounting-On&quot;, etc. See the VALUEs for
Acct-Status-Type in the dictionary.rfc2866 file.</p>

<p>Post-Auth query An entry named &quot;Post-Auth&quot;
sets the query to run during the post-authentication stage.
This query is mainly used to log sessions where there may
not be a later accounting packet.</p>

<p>modules { ... sql_log { path =
&quot;${radacctdir}/sql-relay&quot; acct_table =
&quot;radacct&quot; postauth_table = &quot;radpostauth&quot;
sql_user_name = &quot;%{%{User-Name}:-DEFAULT}&quot;</p>

<p>Start = &quot;INSERT INTO ${acct_table} ...&quot; Stop =
&quot;UPDATE ${acct_table} SET ...&quot; Alive =
&quot;UPDATE ${acct_table} SET ...&quot;</p>

<p>Post-Auth = &quot;INSERT INTO ${postauth_table}
...&quot; } ... }</p>

<p>accounting { ... sql_log ... }</p>

<p>post-auth { ... sql_log ... }</p>

<p>SECTIONS accounting, post-auth</p>

<p>FILES /etc/raddb/radiusd.conf</p>

<p>SEE ALSO radsqlrelay(8), radiusd(8), radiusd.conf(5)</p>

<p>AUTHOR Nicolas Baradakis
&lt;nicolas.baradakis@cegetel.net&gt;</p>

<p>28 May 2005 rlm_sql_log(5)</p>
<hr>
</body>
</html>
