<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:20:47 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>JOURNAL_GET_UNDO_ACC(9) The Linux Journalling API
JOURNAL_GET_UNDO_ACC(9)</p>

<p>NAME journal_get_undo_access - Notify intent to modify
metadata with non-rewindable consequences</p>

<p>SYNOPSIS int journal_get_undo_access(handle_t * handle,
struct buffer_head * bh);</p>

<p>ARGUMENTS handle transaction</p>

<p>bh buffer to undo</p>

<p>DESCRIPTION Sometimes there is a need to distinguish
between metadata which has been committed to disk and that
which has not. The ext3fs code uses this for freeing and
allocating space, we have to make sure that we do not reuse
freed space until the deallocation has been committed, since
if we overwrote that space we would make the delete
un-rewindable in case of a crash.</p>

<p>To deal with that, journal_get_undo_access requests
write access to a buffer for parts of non-rewindable
operations such as delete operations on the bitmaps. The
journaling code must keep a copy of the buffer&acute;s
contents prior to the undo_access call until such time as we
know that the buffer has definitely been committed to
disk.</p>

<p>We never need to know which transaction the committed
data is part of, buffers touched here are guaranteed to be
dirtied later and so will be committed to a new transaction
in due course, at which point we can discard the old
committed data pointer.</p>

<p>Returns error number or 0 on success.</p>

<p>AUTHORS Roger Gammans
&lt;rgammans@computer-surgery.co.uk&gt; Author.</p>

<p>Stephen Tweedie &lt;sct@redhat.com&gt; Author.</p>

<p>COPYRIGHT Kernel Hackers Manual 2.6. April 2016
JOURNAL_GET_UNDO_ACC(9)</p>
<hr>
</body>
</html>
