<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:10:26 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>DMSTATS(8) MAINTENANCE COMMANDS DMSTATS(8)</p>

<p>NAME dmstats device-mapper statistics management</p>

<p>SYNOPSIS dmsetup stats command [options]</p>

<p>dmstats command [device_name |--uuid uuid|--major major
--minor minor] dmstats clear device_name
[--allprograms|--programid id] [--allregions|--regionid id]
dmstats create device_name [--alldevices] [--areas
nr_areas|--areasize area_size] [--bounds
histogram_boundaries] [--precise] [--start start_sector
--length length|--segments] [--auxdata data] [--programid
id] dmstats delete [device_name] [--alldevices]
[--allprograms|--programid id] [--allregions|--regionid id]
dmstats help [-c|-C|--columns] dmstats list [device_name]
[--histogram] [--allprograms|--programid id] [--units units]
[--nosuffix] [--notimesuffix] [-v|--verbose[-v|--verbose]]
dmstats print [device_name] [--clear]
[--allprograms|--programid id] [--allregions|--regionid id]
dmstats report [device_name] [--interval seconds] [--count
count] [--units units] [--histogram]
[--allprograms|--programid id] [--allregions|--regionid id]
[-O|--sort sort_fields] [-S|--select selection] [--units
units] [--nosuffix] [--notimesuffix]</p>

<p>DESCRIPTION The dmstats program manages IO statistics
regions for devices that use the device-mapper driver.
Statistics regions may be created, deleted, listed and
reported on using the tool.</p>

<p>The first argument to dmstats is a command.</p>

<p>The second argument is the device name, uuid or major
and minor num- bers.</p>

<p>Further options permit the selection of regions, output
format control, and reporting behaviour.</p>

<p>When the program is run using the dmstats alias, the
command must be the first argument and any switches and
options should be specified following the command itself.
This limitation is not present when run as dmsetup
stats.</p>

<p>When no device argument is given dmstats will by default
operate on all device-mapper devices present. The create and
delete commands require the use of --alldevices when used in
this way.</p>

<p>OPTIONS --alldevices If no device arguments are given
allow operation on all devices when creating or deleting
regions.</p>

<p>--allprograms Include regions from all program IDs for
list and report opera- tions.</p>

<p>--allregions Include all present regions for commands
that normally accept a single region identifier.</p>

<p>--areas nr_areas Specify the number of statistics areas
to create within a new region.</p>

<p>--areasize area_size[b|B|s|S|k|K|m|M|g|G|t|T|p|P|e|E]
Specify the size of areas into which a new region should be
divided. An optional suffix selects units of: (b)ytes,
(s)ectors, (k)ilobytes, (m)egabytes, (g)igabytes,
(t)erabytes, (p)etabytes, (e)xabytes. Capitalise to use
multiples of 1000 (S.I.) instead of 1024.</p>

<p>--auxdata aux_data Specify auxilliary data (a string) to
be stored with a new region.</p>

<p>--clear When printing statistics counters, also
atomically reset them to zero.</p>

<p>--count count Specify the iteration count for repeating
reports. If the count argument is zero reports will continue
to repeat until inter- rupted.</p>

<p>--bounds histogram_boundaries[ns|us|ms|s] Specify the
boundaries of a latency histogram to be tracked for the
region as a comma separated list of latency values. Latency
values are given in nanoseconds. An optional unit suffix of
ns, us, ms, or s may be given after each value to specify
units of nanoseconds, microseconds, miliseconds or seconds
respectively.</p>

<p>--histogram When used with the report and list commands
select default fields that emphasize latency histogram
data.</p>

<p>--interval seconds Specify the interval in seconds
between successive iterations for repeating reports. If
--interval is specified but --count is not, reports will
continue to repeat until interrupted.</p>

<p>--length length[b|B|s|S|k|K|m|M|g|G|t|T|p|P|e|E] Specify
the length of a new statistics region in sectors. An
optional suffix selects units of: (b)ytes, (s)ectors,
(k)ilobytes, (m)egabytes, (g)igabytes, (t)erabytes,
(p)etabytes, (e)xabytes. Capitalise to use multiples of 1000
(S.I.) instead of 1024.</p>

<p>-j|--major major Specify the major number.</p>

<p>-m|--minor minor Specify the minor number.</p>

<p>--nosuffix Suppress the suffix on output sizes. Use with
--units (except h and H) if processing the output.</p>

<p>--notimesuffix Suppress the suffix on output time
values. Histogram boundary values will be reported in units
of nanoseconds.</p>

<p>-o|--options Specify which report fields to display.</p>

<p>-O|--sort sort_fields Sort output according to the list
of fields given. Precede any sort field with - for a reverse
sort on that column.</p>

<p>--precise Attempt to use nanosecond precision counters
when creating new statistics regions.</p>

<p>--programid id Specify a program ID string. When
creating new statistics regions this string is stored with
the region. Subsequent opera- tions may supply a program ID
in order to select only regions with a matching value. The
default program ID for dmstats-man- aged regions is
&quot;dmstats&quot;.</p>

<p>--regionid id Specify the region to operate on.</p>

<p>--relative If displaying the histogram report show
relative (percentage) values instead of absolute counts.</p>

<p>-S|--select selection Display only rows that match
selection criteria. All rows with the additional
&quot;selected&quot; column (-o selected) showing 1 if the
row matches the selection and 0 otherwise. The selection
crite- ria are defined by specifying column names and their
valid val- ues while making use of supported comparison
operators.</p>

<p>--start start[b|B|s|S|k|K|m|M|g|G|t|T|p|P|e|E] Specify
the start offset of a new statistics region in sectors. An
optional suffix selects units of: (b)ytes, (s)ectors,
(k)ilobytes, (m)egabytes, (g)igabytes, (t)erabytes,
(p)etabytes, (e)xabytes. Capitalise to use multiples of 1000
(S.I.) instead of 1024.</p>

<p>--segments Create a new statistics region for each
target contained in the target device. This causes a
separate region to be allocated for each segment of the
device.</p>

<p>--units [units][h|H|b|B|s|S|k|K|m|M|g|G|t|T|p|P|e|E] Set
the display units for report output. All sizes are output in
these units: (h)uman-readable, (b)ytes, (s)ectors,
(k)ilobytes, (m)egabytes, (g)igabytes, (t)erabytes,
(p)etabytes, (e)xabytes. Capitalise to use multiples of 1000
(S.I.) instead of 1024. Can also specify custom units e.g.
--units 3M.</p>

<p>-u|--uuid Specify the uuid.</p>

<p>-v|--verbose [-v|--verbose] Produce additional
output.</p>

<p>COMMANDS clear device_name [--allprograms|--programid
id] [--allregions|--regionid id] Instructs the kernel to
clear statistics counters for the spefi- cied regions (with
the exception of in-flight IO counters).</p>

<p>create device_name [--alldevices] [--areas
nr_areas|--areasize area_size] [--bounds
histogram_boundaries] [--precise] [--start start_sector
--length length|--segments] [--auxdata data] [--programid
id] Creates one or more new statistics regions on the
specified device(s).</p>

<p>The region will span the entire device unless --start
and --length or --target are given. The --start and --length
options allow a region of arbitrary length to be placed at
an arbitrary offset into the device. The --segments option
causes a new region to be created for each target in the
corresponding device-mapper devices table.</p>

<p>If the --precise option is used the command will attempt
to cre- ate a region using nanosecond precision
counters.</p>

<p>If --bounds is given a latency histogram will be tracked
for the new region. The boundaries of the histogram bins are
given as a comma separated list of latency values. There is
an implicit lower bound of zero on the first bin and an
implicit upper bound of infinity (or the configured interval
duration) on the final bin.</p>

<p>Latencies are given in nanoseconds. An optional unit
suffix of ns, us, ms, or s may be given after each value to
specify units of nanoseconds, microseconds, miliseconds or
seconds respec- tively, so for example, 10ms is equivalent
to 10000000. Latency values with a precision of less than
one milisecond can only be used when precise timestamps are
enabled: if --precise is not given and values less than one
milisecond are used it will be enabled automatically.</p>

<p>An optional program_id or aux_data string may be
associated with the region. A program_id may then be used to
select regions for subsequent list, print, and report
operations. The aux_data stores an arbitrary string and is
not used by dmstats or the device-mapper kernel statistics
subsystem.</p>

<p>By default dmstats creates regions with a program_id of
&quot;dmstats&quot;.</p>

<p>On success the region_id of the newly created region is
printed to stdout.</p>

<p>delete [device_name] [--alldevices]
[--allprograms|--programid id] [--allregions|--regionid id]
Delete the specified statistics region. All counters and
resources used by the region are released and the region
will not appear in the output of subsequent list, print, or
report operations.</p>

<p>All regions registered on a device may be removed using
--allre- gions.</p>

<p>To remove all regions on all devices both --allregions
and --alldevices must be used.</p>

<p>help [-c|-C|--columns] Outputs a summary of the commands
available, optionally includ- ing the list of report
fields.</p>

<p>list [device_name] [--histogram]
[--allprograms|--programid id] [--units units] [--nosuffix]
[--notimesuffix] [-v|--verbose[-v|--verbose]] List the
statistics regions registered on the device. If the
--allprograms switch is given all regions will be listed
regard- less of region program ID values.</p>

<p>If -v or --verbose is given the report will include a
row of information for each area contained in each region
displayed.</p>

<p>If --histogram is given the report will include the bin
count and latency boundary values for any configured
histograms.</p>

<p>print [device_name] [--clear] [--allprograms|--programid
id] [--allregions|--regionid id] Print raw statistics
counters for the specified region or for all present
regions.</p>

<p>report [device_name] [--interval seconds] [--count
count] [--units units] [--histogram]
[--allprograms|--programid id] [--allregions|--regionid id]
[-O|--sort sort_fields] [-S|--select selection] [--units
units] [--nosuffix] [--notimesuffix] Start a report for the
specified region or for all present regions. If the count
argument is specified, the report will repeat at a fixed
interval set by the --interval option. The default interval
is one second.</p>

<p>If the --allprograms switch is given, all regions will
be listed, regardless of region program ID values.</p>

<p>If the --histogram is given the report will include the
his- togram values and latency boundaries.</p>

<p>If the --relative is used the default histogram field
displays bin values as a percentage of the total number of
I/Os.</p>

<p>REGIONS AND AREAS The device-mapper statistics facility
allows separate performance coun- ters to be maintained for
arbitrary regions of devices. A region may span any range:
from a single sector to the whole device. A region may be
further sub-divided into a number of distinct areas (one or
more), each with its own counter set.</p>

<p>By default new regions span the entire device. The
--start and --length options allows a region of any size to
be placed at any location on the device.</p>

<p>A region may be either divided into the specified number
of equal-sized areas, or into areas of the given size by
specifying one of --areas or --areasize when creating a
region with the create command. Depending on the size of the
areas and the device region the final area within the region
may be smaller than requested.</p>

<p>Region identifiers</p>

<p>Each region is assigned an identifier when it is created
that is used to reference the region in subsequent
operations. Region identifiers are unique within a given
device (including across different program_id values).</p>

<p>Depending on the sequence of create and delete
operations, gaps may exist in the sequence of region_id
values for a particular device.</p>

<p>REPORT FIELDS The dmstats report provides several types
of field that may be added to the default field set, or used
to create custom reports.</p>

<p>All performance counters and metrics are calculated
per-area.</p>

<p>Derived metrics A number of metrics fields are included
that provide high level perfor- mance indicators. These are
based on the fields provided by the conven- tional Linux
iostat program and are derived from the basic counter val-
ues provided by the kernel for each area.</p>

<p>reads_merged_per_sec Reads merged per second.</p>

<p>writes_merged_per_sec Writes merged per second.</p>

<p>reads_per_sec Reads completed per second.</p>

<p>writes_per_sec Writes completed per second.</p>

<p>read_size_per_sec Size of data read per second.</p>

<p>write_size_per_sec Size of data written per second.</p>

<p>avg_request_size Average request size.</p>

<p>queue_size Average queue size.</p>

<p>await The average wait time for read and write
operations.</p>

<p>r_await The average wait time for read operations.</p>

<p>w_await The average wait time for write operations.</p>

<p>throughput The device throughput in operations per
second.</p>

<p>service_time The average service time (in milliseconds)
for operations issued to the device.</p>

<p>util Percentage of CPU time during which I/O requests
were issued to the device (bandwidth utilization for the
device). Device satu- ration occurs when this value is close
to 100%.</p>

<p>Region and area meta fields Meta fields provide
information about the region or area that the statistics
values relate to. This includes the region and area identi-
fier, start, length, and counts, as well as the program ID
and auxil- iary data values.</p>

<p>region_id Region identifier. This is a non-negative
integer returned by the kernel when a statistics region is
created.</p>

<p>region_start The region start location. Display units
are selected by the --units option.</p>

<p>region_len The length of the region. Display units are
selected by the --units option.</p>

<p>area_id Area identifier. Area identifiers are assigned
by the device- mapper statistics library and uniquely
identify each area within a region. Each ID corresponds to a
distinct set of performance counters for that area of the
statistics region. Area identi- fiers are always
monotonically increasing within a region so that higher ID
values correspond to greater sector addresses within the
area and no gaps in the sequence of identifiers exist.</p>

<p>area_start The area start location. Display units are
selected by the --units option.</p>

<p>area_len The length of the area. Display units are
selected by the --units option.</p>

<p>area_count The number of areas in this region.</p>

<p>program_id The program ID value associated with this
region.</p>

<p>aux_data The auxiliary data value associated with this
region.</p>

<p>interval_ns The estimated interval over which the
current counter values have accumulated. The value is
reported as an interger expressed in units of
nanoseconds.</p>

<p>interval The estimated interval over which the current
counter values have accumulated. The value is reported as a
real number in units of seconds.</p>

<p>Basic counters Basic counters provide access to the raw
counter data from the kernel, allowing further processing to
be carried out by another program.</p>

<p>The kernel provides thirteen separate counters for each
statistics area. The first eleven of these match the
counters provided in /proc/diskstats or /sys/block/*/*/stat.
The final pair provide separate counters for read and write
time.</p>

<p>read_count Count of reads completed this interval.</p>

<p>reads_merged_count Count of reads merged this
interval.</p>

<p>read_sector_count Count of 512 byte sectors read this
interval.</p>

<p>read_time Accumulated duration of all read requests
(ns).</p>

<p>write_count Count of writes completed this interval.</p>

<p>writes_merged_count Count of writes merged this
interval.</p>

<p>write_sector_count Count of 512 byte sectors written
this interval.</p>

<p>write_nsecs Accumulated duration of all write requests
(ns).</p>

<p>in_progress_count Count of requests currently in
progress.</p>

<p>io_ticks Nanoseconds spent servicing requests.</p>

<p>queue_ticks This field is incremented at each I/O start,
I/O completion, I/O merge, or read of these stats by the
number of I/Os in progress multiplied by the number of
milliseconds spent doing I/O since the last update of this
field. This can provide an easy measure of both I/O
completion time and the backlog that may be accumu-
lating.</p>

<p>read_ticks Nanoseconds spent servicing reads.</p>

<p>write_ticks Nanoseconds spent servicing writes.</p>

<p>Histogram fields Histograms measure the frequency
distribution of user specified I/O latency intervals.
Histogram bin boundaries are specified when a region is
created.</p>

<p>A brief representation of the histogram values and
latency intervals can be included in the report using these
fields.</p>

<p>hist_count A list of the histogram counts for the
current statistics area in order of ascending latency value.
Each value represents the number of I/Os with latency times
falling into that bins time range during the sample
period.</p>

<p>hist_count_bounds A list of the histogram counts for the
current statistics area in order of ascending latency value
including bin boundaries: each count is prefixed by the
lower bound of the corresponding histogram bin.</p>

<p>hist_count_ranges A list of the histogram counts for the
current statistics area in order of ascending latency value
including bin boundaries: each count is prefixed by both the
lower and upper bounds of the corresponding histogram
bin.</p>

<p>hist_percent A list of the relative histogram values for
the current statis- tics area in order of ascending latency
value, expressed as a percentage. Each value represents the
proportion of I/Os with latency times falling into that bins
time range during the sam- ple period.</p>

<p>hist_percent_bounds A list of the relative histogram
values for the current statis- tics area in order of
ascending latency value, expressed as a percentage and
including bin boundaries. Each value represents the
proportion of I/Os with latency times falling into that bins
time range during the sample period and is prefixed with the
corresponding bins lower bound.</p>

<p>hist_percent_ranges A list of the relative histogram
values for the current statis- tics area in order of
ascending latency value, expressed as a percentage and
including bin boundaries. Each value represents the
proportion of I/Os with latency times falling into that bin
s time range during the sample period and is prefixed with
the corresponding bins lower and upper bounds.</p>

<p>hist_bounds A list of the histogram boundary values for
the current statis- tics area in order of ascending latency
value. The values are expressed in whole units of seconds,
miliseconds, microseconds or nanoseconds with a suffix
indicating the unit.</p>

<p>hist_ranges A list of the histogram bin ranges for the
current statistics area in order of ascending latency value.
The values are expressed as &quot;LOWER-UPPER&quot; in whole
units of seconds, milisec- onds, microseconds or nanoseconds
with a suffix indicating the unit.</p>

<p>hist_bins The number of latency histogram bins
configured for the area.</p>

<p>EXAMPLES Create a whole-device region with one area on
vg00/lvol1 # dmstats create vg00/lvol1 vg00/lvol1: Created
new region with 1 area(s) as region ID 0</p>

<p>Create a 32M region 1G into device d0 # dmstats create
--start 1G --length 32M d0 d0: Created new region with 1
area(s) as region ID 0</p>

<p>Create a whole-device region with 8 areas on every
device # dmstats create --areas 8 vg00-lvol1: Created new
region with 8 area(s) as region ID 0 vg00-lvol2: Created new
region with 8 area(s) as region ID 0 vg00-lvol3: Created new
region with 8 area(s) as region ID 0 vg01-lvol0: Created new
region with 8 area(s) as region ID 2 vg01-lvol1: Created new
region with 8 area(s) as region ID 0 vg00-lvol2: Created new
region with 8 area(s) as region ID 1</p>

<p>Delete all regions on all devices # dmstats delete
--alldevices --allregions</p>

<p>Create a whole-device region with areas 10GiB in size on
vg00/lvol1 using dmsetup # dmsetup stats create --areasize
10G vg00/lvol1 vg00-lvol1: Created new region with 5 area(s)
as region ID 1</p>

<p>Create a 1GiB region with 16 areas at the start of
vg00/lvol1 # dmstats create --start 0 --len 1G --areas=16
vg00/lvol1 vg00-lvol1: Created new region with 16 area(s) as
region ID 0</p>

<p>List the statistics regions registered on vg00/lvol1 #
dmstats list vg00/lvol1 Name RgID RStart RSize #Areas ASize
ProgID vg00-lvol1 0 0 61.00g 1 61.00g dmstats vg00-lvol1 1
61.00g 19.20g 1 19.20g dmstats vg00-lvol1 2 80.20g 2.14g 1
2.14g dmstats</p>

<p>Display five statistics reports for vg00/lvol1 at an
interval of one second # dmstats report --interval 1 --count
5 vg00/lvol1 # dmstats report Name RgID ArID AStart ASize
RRqM/s WRqM/s R/s W/s RSz/s WSz/s AvRqSz QSize Util% AWait
RdAWa WrAWa vg_hex-lv_home 0 0 0 61.00g 0.00 0.00 0.00
218.00 0 1.04m 4.50k 2.97 81.70 13.62 0.00 13.62
vg_hex-lv_home 1 0 61.00g 19.20g 0.00 0.00 0.00 5.00 0
548.00k 109.50k 0.14 11.00 27.40 0.00 27.40 vg_hex-lv_home 2
0 80.20g 2.14g 0.00 0.00 0.00 14.00 0 1.15m 84.00k 0.39
18.70 27.71 0.00 27.71</p>

<p>Create one region for reach target contained in device
vg00/lvol1 # dmstats create --segments vg00/lvol1
vg00-lvol1: Created new region with 1 area(s) as region ID 0
vg00-lvol1: Created new region with 1 area(s) as region ID 1
vg00-lvol1: Created new region with 1 area(s) as region ID
2</p>

<p>Print raw counters for region 4 on device d0 # dmstats
print --regionid 4 d0 2097152+65536 0 0 0 0 29 0 264 701 0
41 701 0 41</p>

<p>AUTHORS Bryn M. Reeves &lt;bmr@redhat.com&gt;</p>

<p>SEE ALSO dmsetup(8)</p>

<p>LVM2 resource page: https://www.sourceware.org/lvm2/
Device-mapper resource page:
http://sources.redhat.com/dm/</p>

<p>Device-mapper statistics kernel documentation
Documentation/device-mapper/statistics.txt</p>

<p>Linux Jul 25 2015 DMSTATS(8)</p>
<hr>
</body>
</html>
