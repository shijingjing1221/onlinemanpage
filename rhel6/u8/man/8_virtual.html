<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:43:56 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>VIRTUAL(8) VIRTUAL(8)</p>

<p>NAME virtual - Postfix virtual domain mail delivery
agent</p>

<p>SYNOPSIS virtual [generic Postfix daemon options]</p>

<p>DESCRIPTION The virtual(8) delivery agent is designed
for virtual mail hosting ser- vices. Originally based on the
Postfix local(8) delivery agent, this agent looks up
recipients with map lookups of their full recipient address,
instead of using hard-coded unix password file lookups of
the address local part only.</p>

<p>This delivery agent only delivers mail. Other features
such as mail forwarding, out-of-office notifications, etc.,
must be configured via virtual_alias maps or via similar
lookup mechanisms.</p>

<p>MAILBOX LOCATION The mailbox location is controlled by
the virtual_mailbox_base and vir- tual_mailbox_maps
configuration parameters (see below). The vir-
tual_mailbox_maps table is indexed by the recipient address
as described under TABLE SEARCH ORDER below.</p>

<p>The mailbox pathname is constructed as follows:</p>


<p>$virtual_mailbox_base/$virtual_mailbox_maps(recipient)</p>

<p>where recipient is the full recipient address.</p>

<p>UNIX MAILBOX FORMAT When the mailbox location does not
end in /, the message is delivered in UNIX mailbox format.
This format stores multiple messages in one textfile.</p>

<p>The virtual(8) delivery agent prepends a &quot;From
sender time_stamp&quot; enve- lope header to each message,
prepends a Delivered-To: message header with the envelope
recipient address, prepends an X-Original-To: header with
the recipient address as given to Postfix, prepends a
Return-Path: message header with the envelope sender
address, prepends a &gt; character to lines beginning with
&quot;From &quot;, and appends an empty line.</p>

<p>The mailbox is locked for exclusive access while
delivery is in progress. In case of problems, an attempt is
made to truncate the mail- box to its original length.</p>

<p>QMAIL MAILDIR FORMAT When the mailbox location ends in
/, the message is delivered in qmail maildir format. This
format stores one message per file.</p>

<p>The virtual(8) delivery agent prepends a Delivered-To:
message header with the final envelope recipient address,
prepends an X-Original-To: header with the recipient address
as given to Postfix, and prepends a Return-Path: message
header with the envelope sender address.</p>

<p>By definition, maildir format does not require
application-level file locking during mail delivery or
retrieval.</p>

<p>MAILBOX OWNERSHIP Mailbox ownership is controlled by the
virtual_uid_maps and vir- tual_gid_maps lookup tables, which
are indexed with the full recipient address. Each table
provides a string with the numerical user and group ID,
respectively.</p>

<p>The virtual_minimum_uid parameter imposes a lower bound
on numerical user ID values that may be specified in any
virtual_uid_maps.</p>

<p>CASE FOLDING All delivery decisions are made using the
full recipient address, folded to lower case. See also the
next section for a few exceptions with optional address
extensions.</p>

<p>TABLE SEARCH ORDER Normally, a lookup table is specified
as a text file that serves as input to the postmap(1)
command. The result, an indexed file in dbm or db format, is
used for fast searching by the mail system.</p>

<p>The search order is as follows. The search stops upon
the first suc- cessful lookup.</p>

<p>&middot; When the recipient has an optional address
extension the user+extension@domain.tld address is looked up
first.</p>

<p>With Postfix versions before 2.1, the optional address
extension is always ignored.</p>

<p>&middot; The user@domain.tld address, without address
extension, is looked up next.</p>

<p>&middot; Finally, the recipient @domain is looked
up.</p>

<p>When the table is provided via other means such as NIS,
LDAP or SQL, the same lookups are done as for ordinary
indexed files.</p>

<p>Alternatively, a table can be provided as a
regular-expression map where patterns are given as regular
expressions. In that case, only the full recipient address
is given to the regular-expression map.</p>

<p>SECURITY The virtual(8) delivery agent is not security
sensitive, provided that the lookup tables with recipient
user/group ID information are ade- quately protected. This
program is not designed to run chrooted.</p>

<p>The virtual(8) delivery agent disallows regular
expression substitution of $1 etc. in regular expression
lookup tables, because that would open a security hole.</p>

<p>The virtual(8) delivery agent will silently ignore
requests to use the proxymap(8) server. Instead it will open
the table directly. Before Postfix version 2.2, the virtual
delivery agent will terminate with a fatal error.</p>

<p>STANDARDS RFC 822 (ARPA Internet Text Messages)</p>

<p>DIAGNOSTICS Mail bounces when the recipient has no
mailbox or when the recipient is over disk quota. In all
other cases, mail for an existing recipient is deferred and
a warning is logged.</p>

<p>Problems and transactions are logged to syslogd(8).
Corrupted message files are marked so that the queue manager
can move them to the corrupt queue afterwards.</p>

<p>Depending on the setting of the notify_classes
parameter, the postmas- ter is notified of bounces and of
other trouble.</p>

<p>BUGS This delivery agent supports address extensions in
email addresses and in lookup table keys, but does not
propagate address extension information to the result of
table lookup.</p>

<p>Postfix should have lookup tables that can return
multiple result attributes. In order to avoid the
inconvenience of maintaining three tables, use an LDAP or
MYSQL database.</p>

<p>CONFIGURATION PARAMETERS Changes to main.cf are picked
up automatically, as virtual(8) processes run for only a
limited amount of time. Use the command &quot;postfix
reload&quot; to speed up a change.</p>

<p>The text below provides only a parameter summary. See
postconf(5) for more details including examples.</p>

<p>MAILBOX DELIVERY CONTROLS virtual_mailbox_base (empty) A
prefix that the virtual(8) delivery agent prepends to all
pathname results from $virtual_mailbox_maps table
lookups.</p>

<p>virtual_mailbox_maps (empty) Optional lookup tables with
all valid addresses in the domains that match
$virtual_mailbox_domains.</p>

<p>virtual_minimum_uid (100) The minimum user ID value that
the virtual(8) delivery agent accepts as a result from
$virtual_uid_maps table lookup.</p>

<p>virtual_uid_maps (empty) Lookup tables with the
per-recipient user ID that the virtual(8) delivery agent
uses while writing to the recipients mailbox.</p>

<p>virtual_gid_maps (empty) Lookup tables with the
per-recipient group ID for virtual(8) mailbox delivery.</p>

<p>Available in Postfix version 2.0 and later:</p>

<p>virtual_mailbox_domains ($virtual_mailbox_maps) Postfix
is final destination for the specified list of domains; mail
is delivered via the $virtual_transport mail delivery
transport.</p>

<p>virtual_transport (virtual) The default mail delivery
transport and next-hop destination for final delivery to
domains listed with $virtual_mailbox_domains.</p>

<p>Available in Postfix version 2.5.3 and later:</p>

<p>strict_mailbox_ownership (yes) Defer delivery when a
mailbox file is not owned by its recipi- ent.</p>

<p>LOCKING CONTROLS virtual_mailbox_lock (seepostconf
-doutput) How to lock a UNIX-style virtual(8) mailbox before
attempting delivery.</p>

<p>deliver_lock_attempts (20) The maximal number of
attempts to acquire an exclusive lock on a mailbox file or
bounce(8) logfile.</p>

<p>deliver_lock_delay (1s) The time between attempts to
acquire an exclusive lock on a mailbox file or bounce(8)
logfile.</p>

<p>stale_lock_time (500s) The time after which a stale
exclusive mailbox lockfile is removed.</p>

<p>RESOURCE AND RATE CONTROLS
virtual_destination_concurrency_limit
($default_destination_concur- rency_limit) The maximal
number of parallel deliveries to the same destina- tion via
the virtual message delivery transport.</p>

<p>virtual_destination_recipient_limit
($default_destination_recipi- ent_limit) The maximal number
of recipients per message for the virtual message delivery
transport.</p>

<p>virtual_mailbox_limit (51200000) The maximal size in
bytes of an individual mailbox or maildir file, or zero (no
limit).</p>

<p>MISCELLANEOUS CONTROLS config_directory (seepostconf
-doutput) The default location of the Postfix main.cf and
master.cf con- figuration files.</p>

<p>daemon_timeout (18000s) How much time a Postfix daemon
process may take to handle a request before it is terminated
by a built-in watchdog timer.</p>

<p>delay_logging_resolution_limit (2) The maximal number of
digits after the decimal point when log- ging sub-second
delay values.</p>

<p>ipc_timeout (3600s) The time limit for sending or
receiving information over an internal communication
channel.</p>

<p>max_idle (100s) The maximum amount of time that an idle
Postfix daemon process waits for an incoming connection
before terminating voluntarily.</p>

<p>max_use (100) The maximal number of incoming connections
that a Postfix daemon process will service before
terminating voluntarily.</p>

<p>process_id (read-only) The process ID of a Postfix
command or daemon process.</p>

<p>process_name (read-only) The process name of a Postfix
command or daemon process.</p>

<p>queue_directory (seepostconf -doutput) The location of
the Postfix top-level queue directory.</p>

<p>syslog_facility (mail) The syslog facility of Postfix
logging.</p>

<p>syslog_name (seepostconf -doutput) The mail system name
that is prepended to the process name in syslog records, so
that &quot;smtpd&quot; becomes, for example, &quot;post-
fix/smtpd&quot;.</p>

<p>SEE ALSO qmgr(8), queue manager bounce(8), delivery
status reports postconf(5), configuration parameters
syslogd(8), system logging</p>

<p>README_FILES Use &quot;postconf readme_directory&quot;
or &quot;postconf html_directory&quot; to locate this
information. VIRTUAL_README, domain hosting howto</p>

<p>LICENSE The Secure Mailer license must be distributed
with this software.</p>

<p>HISTORY This delivery agent was originally based on the
Postfix local delivery agent. Modifications mainly consisted
of removing code that either was not applicable or that was
not safe in this context: aliases, ~user/.forward files,
delivery to &quot;|command&quot; or to /file/name.</p>

<p>The Delivered-To: message header appears in the qmail
system by Daniel Bernstein.</p>

<p>The maildir structure appears in the qmail system by
Daniel Bernstein.</p>

<p>AUTHOR(S) Wietse Venema IBM T.J. Watson Research P.O.
Box 704 Yorktown Heights, NY 10598, USA</p>

<p>Andrew McNamara andrewm@connect.com.au connect.com.au
Pty. Ltd. Level 3, 213 Miller St North Sydney 2060, NSW,
Australia</p>

<p>VIRTUAL(8)</p>
<hr>
</body>
</html>
