<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:30:34 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>PTP4l(8) PTP4l(8)</p>

<p>NAME ptp4l - PTP Boundary/Ordinary Clock</p>

<p>SYNOPSIS ptp4l [ -AEP246HSLmqsv ] [ -f config ] [ -p
phc-device ] [ -l print- level ] [ -i interface ] ...</p>

<p>DESCRIPTION ptp4l is an implementation of the Precision
Time Protocol (PTP) accord- ing to IEEE standard 1588 for
Linux. It implements Boundary Clock (BC) and Ordinary Clock
(OC).</p>

<p>OPTIONS -A Select the delay mechanism automatically.
Start with E2E and switch to P2P when a peer delay request
is received.</p>

<p>-E Select the delay request-response (E2E) mechanism.
This is the default mechanism. All clocks on single PTP
communication path must use the same mechanism. A warning
will be printed when a peer delay request is received on
port using the E2E mechanism.</p>

<p>-P Select the peer delay (P2P) mechanism. A warning will
be printed when a delay request is received on port using
the P2P mecha- nism.</p>

<p>-2 Select the IEEE 802.3 network transport.</p>

<p>-4 Select the UDP IPv4 network transport. This is the
default transport.</p>

<p>-6 Select the UDP IPv6 network transport.</p>

<p>-H Select the hardware time stamping. All ports
specified by the -i option and in the configuration file
must be attached to the same PTP hardware clock (PHC). This
is the default time stamp- ing.</p>

<p>-S Select the software time stamping.</p>

<p>-L Select the legacy hardware time stamping.</p>

<p>-f config Read configuration from the specified file. No
configuration file is read by default.</p>

<p>-i interface Specify a PTP port, it may be used multiple
times. At least one port must be specified by this option or
in the configuration file.</p>

<p>-p phc-device With hardware time stamping, force which
PHC device (e.g. /dev/ptp0) should be used.</p>

<p>-s Enable the slaveOnly mode.</p>

<p>-l print-level Set the maximum syslog level of messages
which should be printed or sent to the system logger. The
default is 6 (LOG_INFO).</p>

<p>-m Print messages to the standard output.</p>

<p>-q Dont send messages to the system logger.</p>

<p>-v Prints the software version and exits.</p>

<p>-h Display a help message.</p>

<p>CONFIGURATION FILE The configuration file is divided
into sections. Each section starts with a line containing
its name enclosed in brackets and it follows with settings.
Each setting is placed on a separate line, it contains the
name of the option and the value separated by whitespace
charac- ters. Empty lines and lines starting with # are
ignored.</p>

<p>The global section (indicated as [global]) sets the
program options, clock options and default port options.
Other sections are port spe- cific sections and they
override the default port options. The name of the section
is the name of the configured port (e.g. [eth0]). Ports
specified in the configuration file don t need to be
specified by the -i option. An empty port section can be
used to replace the command line option.</p>

<p>PORT OPTIONS delayAsymmetry The time difference in
nanoseconds of the transmit and receive paths. This value
should be positive when the master-to-slave propagation time
is longer and negative when the slave-to-master time is
longer. The default is 0 nanoseconds.</p>

<p>logAnnounceInterval The mean time interval between
Announce messages. A shorter interval makes ptp4l react
faster to the changes in the master- slave hierarchy. The
interval should be the same in the whole domain. It s
specified as a power of two in seconds. The default is 1 (2
seconds).</p>

<p>logSyncInterval The mean time interval between Sync
messages. A shorter interval may improve accuracy of the
local clock. Its specified as a power of two in seconds. The
default is 0 (1 second).</p>

<p>logMinDelayReqInterval The minimum permitted mean time
interval between Delay_Req mes- sages. A shorter interval
makes ptp4l react faster to the changes in the path delay.
Its specified as a power of two in seconds. The default is 0
(1 second).</p>

<p>logMinPdelayReqInterval The minimum permitted mean time
interval between Pdelay_Req mes- sages. Its specified as a
power of two in seconds. The default is 0 (1 second).</p>

<p>announceReceiptTimeout The number of missed Announce
messages before the last Announce messages expires. The
default is 3.</p>

<p>syncReceiptTimeout The number of sync/follow up messages
that may go missing before triggering a Best Master Clock
election. This option is used for running in gPTP mode
according to the 802.1AS-2011 standard. Setting this option
to zero will disable the sync message time- out. The default
is 0 or disabled.</p>

<p>transportSpecific The transport specific field. Must be
in the range 0 to 255. The default is 0.</p>

<p>path_trace_enabled Enable the mechanism used to trace
the route of the Announce messages. The default is 0
(disabled).</p>

<p>follow_up_info Include the 802.1AS data in the Follow_Up
messages if enabled. The default is 0 (disabled).</p>

<p>fault_reset_interval The time in seconds between the
detection of a port s fault and the fault being reset. This
value is expressed as a power of two. Setting this value to
-128 or to the special key word &quot;ASAP&quot; will let
the fault be reset immediately. The default is 4 (16
seconds).</p>

<p>fault_badpeernet_interval The time in seconds between
the detection of a peer network mis- configuration and the
fault being reset. The port is disabled for the duration of
the interval. The value is in seconds and the special key
word ASAP will let the fault be reset immedi- ately. The
default is 16 seconds.</p>

<p>delay_mechanism Select the delay mechanism. Possible
values are E2E, P2P and Auto. The default is E2E.</p>

<p>network_transport Select the network transport. Possible
values are UDPv4, UDPv6 and L2. The default is UDPv4.</p>

<p>neighborPropDelayThresh Upper limit for peer delay in
nanoseconds. If the estimated peer delay is greater than
this value the port is marked as not 802.1AS capable.</p>

<p>min_neighbor_prop_delay Lower limit for peer delay in
nanoseconds. If the estimated peer delay is smaller than
this value the port is marked as not 802.1AS capable.</p>

<p>delay_filter Select the algorithm used to filter the
measured delay and peer delay. Possible values are
moving_average and moving_median. The default is
moving_median.</p>

<p>delay_filter_length The length of the delay filter in
samples. The default is 10.</p>

<p>egressLatency Specifies the difference in nanoseconds
between the actual transmission time at the reference plane
and the reported trans- mit time stamp. This value will be
added to egress time stamps obtained from the hardware. The
default is 0.</p>

<p>ingressLatency Specifies the difference in nanoseconds
between the reported receive time stamp and the actual
reception time at reference plane. This value will be
subtracted from ingress time stamps obtained from the
hardware. The default is 0.</p>

<p>boundary_clock_jbod When running as a boundary clock
(that is, when more than one network interface is
configured), ptp4l performs a sanity check to make sure that
all of the ports share the same hardware clock device. This
option allows ptp4l to work as a boundary clock using
&quot;just a bunch of devices&quot; that are not
synchronized to each other. For this mode, the collection of
clocks must be syn- chronized by an external program, for
example phc2sys(8) in &quot;automatic&quot; mode. The
default is 0 (disabled).</p>

<p>PROGRAM AND CLOCK OPTIONS twoStepFlag Enable two-step
mode for sync messages. One-step mode can be used only with
hardware time stamping. The default is 1 (enabled).</p>

<p>slaveOnly The local clock is a slave-only clock if
enabled. This option is only for use with 1588 clocks and
should not be enabled for 802.1AS clocks. The default is 0
(disabled).</p>

<p>gmCapable If this option is enabled, then the local
clock is able to become grand master. This is only for use
with 802.1AS clocks and has no effect on 1588 clocks. The
default is 1 (enabled).</p>

<p>priority1 The priority1 attribute of the local clock. It
is used in the best master selection algorithm, lower values
take precedence. Must be in the range 0 to 255. The default
is 128.</p>

<p>priority2 The priority2 attribute of the local clock. It
is used in the best master selection algorithm, lower values
take precedence. Must be in the range 0 to 255. The default
is 128.</p>

<p>clockClass The clockClass attribute of the local clock.
It denotes the traceability of the time distributed by the
grandmaster clock. The default is 248.</p>

<p>clockAccuracy The clockAccuracy attribute of the local
clock. It is used in the best master selection algorithm.
The default is 0xFE.</p>

<p>offsetScaledLogVariance The offsetScaledLogVariance
attribute of the local clock. It characterizes the stability
of the clock. The default is 0xFFFF.</p>

<p>domainNumber The domain attribute of the local clock.
The default is 0.</p>

<p>free_running Dont adjust the local clock if enabled. The
default is 0 (dis- abled).</p>

<p>freq_est_interval The time interval over which is
estimated the ratio of the local and peer clock frequencies.
It is specified as a power of two in seconds. The default is
1 (2 seconds).</p>

<p>assume_two_step Treat one-step responses as two-step if
enabled. It is used to work around buggy 802.1AS switches.
The default is 0 (dis- abled).</p>

<p>tx_timestamp_timeout The number of milliseconds to poll
waiting for the tx time stamp from the kernel when a message
has recently been sent. The default is 1.</p>

<p>check_fup_sync Because of packet reordering that can
occur in the network, in the hardware, or in the networking
stack, a follow up message can appear to arrive in the
application before the matching sync message. As this is a
normal occurrence, and the sequenceID mes- sage field
ensures proper matching, the ptp4l program accepts out of
order packets. This option adds an additional check using
the software time stamps from the networking stack to verify
that the sync message did arrive first. This option is only
use- ful if you do not trust the sequence IDs generated by
the mas- ter. The default is 0 (disabled).</p>

<p>clock_servo The servo which is used to synchronize the
local clock. Valid values are pi for a PI controller, linreg
for an adaptive con- troller using linear regression, and
ntpshm for the NTP SHM ref- erence clock to allow another
process to synchronize the local clock (the SHM segment
number is set to the domain number). The default is pi.</p>

<p>pi_proportional_const The proportional constant of the
PI controller. When set to 0.0, the proportional constant
will be set by the following formula from the current sync
interval. The default is 0.0.</p>

<p>kp = min(kp_scale * sync^kp_exponent, kp_norm_max /
sync))</p>

<p>pi_integral_const The integral constant of the PI
controller. When set to 0.0, the integral constant will be
set by the following formula from the current sync interval.
The default is 0.0.</p>

<p>ki = min(ki_scale * sync^ki_exponent, ki_norm_max /
sync)</p>

<p>pi_proportional_scale The kp_scale constant in the
formula used to set the propor- tional constant of the PI
controller from the sync interval. When set to 0.0, the
value will be selected from 0.7 and 0.1 for the hardware and
software time stamping respectively. The default is 0.0.</p>

<p>pi_proportional_exponent The kp_exponent constant in the
formula used to set the propor- tional constant of the PI
controller from the sync interval. The default is -0.3.</p>

<p>pi_proportional_norm_max The kp_norm_max constant in the
formula used to set the propor- tional constant of the PI
controller from the sync interval. The default is 0.7</p>

<p>pi_integral_scale The ki_scale constant in the formula
used to set the integral constant of the PI controller from
the sync interval. When set to 0.0, the value will be
selected from 0.3 and 0.001 for the hardware and software
time stamping respectively. The default is 0.0.</p>

<p>pi_integral_exponent The ki_exponent constant in the
formula used to set the integral constant of the PI
controller from the sync interval. The default is 0.4.</p>

<p>pi_integral_norm_max The ki_norm_max constant in the
formula used to set the integral constant of the PI
controller from the sync interval. The default is 0.3.</p>

<p>step_threshold The maximum offset the servo will correct
by changing the clock frequency instead of stepping the
clock. When set to 0.0, the servo will never step the clock
except on start. Its specified in seconds. The default is
0.0. This option used to be called pi_offset_const.</p>

<p>first_step_threshold The maximum offset the servo will
correct by changing the clock frequency instead of stepping
the clock. This is only applied on the first update. Its
specified in seconds. When set to 0.0, the servo won t step
the clock on start. The default is 0.00002 (20
microseconds). This option used to be called pi_f_off-
set_const.</p>

<p>max_frequency The maximum allowed frequency adjustment
of the clock in parts per billion (ppb). This is an
additional limit to the maximum allowed by the hardware.
When set to 0, the hardware limit will be used. The default
is 900000000 (90%). This option used to be called
pi_max_frequency.</p>

<p>sanity_freq_limit The maximum allowed frequency offset
between uncorrected clock and the system monotonic clock in
parts per billion (ppb). This is used as a sanity check of
the synchronized clock. When a larger offset is measured, a
warning message will be printed and the servo will be reset.
When set to 0, the sanity check is dis- abled. The default
is 200000000 (20%).</p>

<p>ntpshm_segment The number of the SHM segment used by
ntpshm servo. The default is 0.</p>

<p>ptp_dst_mac The MAC address where should be PTP messages
sent. Relevant only with L2 transport. The default is
01:1B:19:00:00:00.</p>

<p>p2p_dst_mac The MAC address where should be peer delay
messages the PTP peer. Relevant only with L2 transport. The
default is 01:80:C2:00:00:0E.</p>

<p>udp6_scope Specifies the desired scope for the IPv6
multicast messages. This will be used as the second byte of
the primary address. This option is only relevant with IPv6
transport. See RFC 4291. The default is 0x0E for the global
scope.</p>

<p>uds_address Specifies the address of the UNIX domain
socket for receiving local management messages. The default
is /var/run/ptp4l.</p>

<p>logging_level The maximum logging level of messages
which should be printed. The default is 6 (LOG_INFO).</p>

<p>verbose Print messages to the standard output if
enabled. The default is 0 (disabled).</p>

<p>use_syslog Print messages to the system log if enabled.
The default is 1 (enabled).</p>

<p>summary_interval The time interval in which are printed
summary statistics of the clock. It is specified as a power
of two in seconds. The statistics include offset root mean
square (RMS), maximum abso- lute offset, frequency offset
mean and standard deviation, and path delay mean and
standard deviation. The units are nanosec- onds and parts
per billion (ppb). If there is only one clock update in the
interval, the sample will be printed instead of the
statistics. The messages are printed at the LOG_INFO level.
The default is 0 (1 second).</p>

<p>time_stamping The time stamping method. The allowed
values are hardware, soft- ware and legacy. The default is
hardware.</p>

<p>productDescription The product description string.
Allowed values must be of the form
manufacturerName;modelNumber;instanceIdentifier and contain
at most 64 utf8 symbols. The default is &quot;;;&quot;.</p>

<p>revisionData The revision description string which
contains the revisions for node hardware (HW), firmware
(FW), and software (SW). Allowed values are of the form
HW;FW;SW and contain at most 32 utf8 sym- bols. The default
is an &quot;;;&quot;.</p>

<p>userDescription The user description string. Allowed
values are of the form name;location and contain at most 128
utf8 symbols. The default is an empty string.</p>

<p>manufacturerIdentity The manufacturer id which should be
an OUI owned by the manufac- turer. The default is
00:00:00.</p>

<p>kernel_leap When a leap second is announced, let the
kernel apply it by stepping the clock instead of correcting
the one-second offset with servo, which would correct the
one-second offset slowly by changing the clock frequency
(unless the step_threshold option is set to correct such
offset by stepping). Relevant only with software time
stamping. The default is 1 (enabled).</p>

<p>timeSource The time source is a single byte code that
gives an idea of the kind of local clock in use. The value
is purely informational, having no effect on the outcome of
the Best Master Clock algo- rithm, and is advertised when
the clock becomes grand master.</p>

<p>TIME SCALE USAGE ptp4l as domain master either uses PTP
or UTC time scale depending on time stamping mode. In
software and legacy time stamping modes it announces
Arbitrary time scale mode, which is effectively UTC here, in
hardware time stamping mode it announces use of PTP time
scale.</p>

<p>When ptp4l is the domain master using hardware time
stamping, it is up to phc2sys to maintain the correct offset
between UTC and PTP times. See phc2sys(8) manual page for
more details.</p>

<p>SEE ALSO pmc(8), phc2sys(8)</p>

<p>linuxptp December 2014 PTP4l(8)</p>
<hr>
</body>
</html>
