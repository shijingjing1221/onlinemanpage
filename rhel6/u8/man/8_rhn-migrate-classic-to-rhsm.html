<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:31:40 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>rhn-migrate-classic-to-rhsm(8) Migration Tool
rhn-migrate-classic-to-rhsm(8)</p>

<p>NAME rhn-migrate-classic-to-rhsm - Migrates a system
profile from Red Hat Network Classic Hosted to Customer
Portal Subscription Management (hosted) or Subscription
Asset Manager (on-premise).</p>

<p>SYNOPSIS rhn-migrate-classic-to-rhsm [--force] |
[--no-auto] [--keep] | [--ser- vicelevel=SERVICE_LEVEL] |
[--destination-url=URL] | [--legacy- user=LEGACY_USER] |
[--legacy-password=LEGACY_PASSWORD] | [--destina-
tion-user=DESTINATION_USER] |
[--destination-password=DESTINATION_PASS- WORD] |
[--org=ORG] | [--environment=ENVIRONMENT] | [--no-proxy]
[--activation-key=ACTIVATION_KEY] | [--help]</p>

<p>DESCRIPTION rhn-migrate-classic-to-rhsm migrates a
system profile which is regis- tered with Red Hat Network
Classic to Customer Portal Subscription Man- agement. This
is intended for migrating from the host service, not for
migrating from a Satellite system.</p>

<p>This script migrates configuration, from a channel-based
subscription framework to a certificate-based subscription
framework. While the rhn- migrate-classic-to-rhsm script
performs the migration operation, the data used to map the
channels to the corresponding product certificates is
defined in the subscription-manager-migration-data package.
The sub- scription-manager-migration-data package must be
installed before the rhn-migrate-classic-to-rhsm script can
be run successfully.</p>

<p>BACKGROUND Access to support and updates for products is
determined through sub- scriptions. Subscriptions are
attached to a system, which means that the system has the
right to install and update a product with full sup- port.
Subscriptions for an entire account are tracked through a
sub- scription management service.</p>

<p>With the channel-based framework, a subscription
management service was either an on-premise Satellite or
hosted Red Hat Network Classic. With the new
certificate-based subscriptions, the subscription management
service is either Customer Portal Subscription Management or
Subscrip- tion Asset Manager. The differences between the
two types of subscrip- tion management services are
described in this Knowledgebase article:
&lt;https://access.redhat.com/knowledge/articles/63269&gt;</p>

<p>The system registers with the subscription management
service and receives an inventory ID number. When
subscriptions are attached to a system, that association is
noted in the subscription management ser- vice.</p>

<p>Registering with a subscription management service is
exclusive. If a system is registered with Red Hat Network
Classic, it cannot simultane- ously be registered with
Customer Portal Subscription Management. The
rhn-migrate-classic-to-rhsm tool is provided specifically so
that there is a way to transition from the deprecated Red
Hat Network Classic to Customer Portal Subscription
Management or an on-premise Subscription Asset Manager.</p>

<p>OPTIONS -h, --help Prints the specific help information
for the given command.</p>

<p>-f, --force Ignore channels not available through
Customer Portal Subscrip- tion Management (or Subscription
Asset Manager). The channels in Red Hat Network Classic are
mapped to the product certificates used by the Customer
Portal Subscription Management. However, not every channel
has a certificate mapping, which can cause errors during
migration. Using this option skips any channels which are
not mapped to Customer Portal Subscription Management.</p>

<p>-n, --no-auto Deletes the system from Red Hat Network
Classic and registers it to Customer Portal Subscription
Management, but does not attach any subscriptions to the
system.</p>

<p>-s SERVICE_LEVEL, --servicelevel=SERVICE_LEVEL Sets a
preferred service level for the system, such as premium or
standard. This service-level preference is then used as one
of the criteria for auto-attaching subscriptions to the
system.</p>

<p>--org=ORG Sets the organization within the account
structure to which to register the system. Every account is
divided into subgroups called organizations, which represent
some kind of organiza- tional or logical division in the
infrastructure. Organizations are further divided into
environments, which organize content streams.</p>

<p>--environment=ENVIRONMENT Sets which environment within
the organization the system belongs to. Every account is
divided into subgroups called orga- nizations, which are
further divided into environments Environ- ments define
different content streams.</p>

<p>--activation-key=ACTIVATION_KEY Sets an activation key
to use during registration to the sub- scription management
service. Use of an activation key requires the user to
supply the organization that the system will be reg- istered
to. This option may be supplied multiple times.</p>

<p>--keep Leaves the system profile on the legacy system.
Normally the system profile on the legacy system is
deleted.</p>

<p>--no-proxy Disables or ignores any previous RHN proxy
settings when migrat- ing to the new subscription management
service.</p>

<p>--legacy-user=LEGACY_USER Specifies the user name on the
legacy server.</p>

<p>--legacy-password=LEGACY_PASSWORD Specifies the password
for the user on the legacy server.</p>

<p>--destination-url=URL Specifies the URL of the
subscription management service to which to register the
system. This is used for environments which have an
on-premise subscription management service such as
Subscription Asset Manager. If no URL is given, the
migration tool uses the Customer Portal Subscription
Management Service.</p>

<p>--destination-user=DESTINATION_USER Specifies the user
name on the destination server.</p>

<p>--destination-password=DESTINATION_PASSWORD Specifies
the password for the user on the destination server.</p>

<p>USAGE The migration process moves the system from the
inventory in one sub- scription management service (Red Hat
Network Classic) to the new sub- scription management
service (Customer Portal Subscription Management), and then
re-applies the subscriptions to the system. The script runs
through these steps:</p>

<p>1. Authenticate to both Red Hat Network Classic and
Customer Portal Subscription Management to verify the
account settings.</p>

<p>2. Get a channel list for the system.</p>

<p>3. Match each channel to a corresponding certificate
map.</p>

<p>4. Copy over the product certificates for the old
channels.</p>

<p>5. Unregister from Red Hat Network Classic.</p>

<p>6. Register with Customer Portal Subscription Management
and auto-attach the best-matched subscriptions.</p>

<p>After migration, the system facts maintained by
Subscription Manager display what script was used for
migration and what the previous system ID was. [root@server
~]# subscription-manager facts --list | grep migr
migration.classic_system_id: 09876 migration.migrated_from:
rhn_hosted_classic migration.migration_date:
2012-09-14T14:55:29.280519</p>

<p>MIGRATION AND AUTOSUBSCRIBE The
rhn-migrate-classic-to-rhsm tool, by default, auto-attaches
the best-matching subscriptions to the system. This allows
migrations to be automated. [root@server ~]#
rhn-migrate-classic-to-rhsm Legacy username:
jsmith@rhn.example.com Legacy password:</p>

<p>Retrieving existing legacy subscription
information...</p>

<p>+-----------------------------------------------------+
System is currently subscribed to these legacy channels:
+-----------------------------------------------------+
rhel-x86_64-server-6</p>

<p>+-----------------------------------------------------+
Installing product certificates for these legacy channels:
+-----------------------------------------------------+
rhel-x86_64-server-6</p>

<p>Product certificates installed successfully to
/etc/pki/product.</p>

<p>Preparing to unregister system from legacy server...
System successfully unregistered from legacy server.</p>

<p>Attempting to register system to destination server...
The system has been registered with ID:
e6876d95-3564-4506-a44e-cb0c1b651434</p>

<p>Installed Product Current Status: Product Name: Red Hat
Enterprise Linux Server Status: Subscribed</p>

<p>System jsmith.rhn.example.com successfully
registered.</p>

<p>The script prompts for a username and password to use to
register the system; this same account is used to
authenticate with both Red Hat Network Classic and Customer
Portal Subscription Management.</p>

<p>Optionally, the --servicelevel argument sets an SLA
preference to use with the system. The SLA associated with a
subscription is then evalu- ated when determining what
subscriptions to auto-attach to the system, along with other
factors like installed products, existing channel
assignments, and architecture.</p>

<p>[root@server ~]# rhn-migrate-classic-to-rhsm
--servicelevel=premium Legacy username:
jsmith@rhn.example.com Legacy password:</p>

<p>MIGRATION TO ON-PREMISE SERVICES The
rhn-migrate-classic-to-rhsm tool migrates the system to
Customer Portal Subscription Management (hosted) services by
default. This uses the default configuration for
Subscription Manager, which points to the subscription
management services for the Customer Portal. For infras-
tructures which have an on-premise subscription management
service such as Subscription Asset Manager, this
configuration can be changed so that the migration process
registers the systems to the on-premise sub- scription
management service and attaches the appropriate subscrip-
tions.</p>

<p>This is done by using the --destination-url option,
which specifies the URL of the on-premise service. In this
case, the authorization creden- tials must also be given for
the on-premise subscription management service account
(which is independent of the RHN classic account).</p>

<p>[root@server ~]# rhn-migrate-classic-to-rhsm
--destination-url=sam.example.com Legacy username:
jsmith@rhn.example.com Legacy password: Destination
username: jsmith@sam.example.com Destination password:</p>

<p>FILES /etc/sysconfig/rhn/systemid The digital server ID
for this machine if the system has been registered with Red
Hat Network Classic. This file does not exist otherwise.</p>

<p>/etc/sysconfig/rhn/up2date The common configuration file
used by RHN client programs.</p>

<p>/var/log/rhsm/rhsm.log The Subscription Manager log
file. This contains any errors reg- istering the system to
Customer Portal Subscription Management or with attaching
subscriptions to the system.</p>

<p>subscription-manager-migration-data.rpm The package
which contains the mappings for the migration script to
migrate channels to the appropriate product
certificates.</p>

<p>SEE ALSO install-num-migrate-to-rhsm(8),
subscription-manager(8).</p>

<p>AUTHORS Deon Lackey &lt;dlackey@redhat.com&gt;, Paresh
Mutha &lt;pmutha@redhat.com&gt;, Mark Huth
&lt;mhuth@redhat.com&gt;, Tasos Papaioannou
&lt;tpapaioa@redhat.com&gt;</p>

<p>BUGS This script is part of the Red Hat Subscription
Manager tool. Report bugs to
&lt;http://bugzilla.redhat.com&gt;, using the Red Hat
Enterprise Linux product and the subscription-manager
component.</p>

<p>COPYRIGHT Copyright &copy; 2012 Red Hat, Inc.</p>

<p>This is free software; see the source for copying
conditions. There is NO warranty; not even for
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p>

<p>rhn-migrate-classic-to-rhsm(8)</p>
<hr>
</body>
</html>
