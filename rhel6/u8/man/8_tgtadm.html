<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:40:44 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>TGTADM(8) [FIXME: manual] TGTADM(8)</p>

<p>NAME tgtadm - Linux SCSI Target Administration
Utility</p>

<p>SYNOPSIS tgtadm [OPTIONS]... [-C --control-port
&lt;port&gt;] [-L --lld &lt;driver&gt;] [-o --op
&lt;operation&gt;] [-m --mode &lt;mode&gt;] [-t --tid
&lt;id&gt;] [-T --targetname &lt;targetname&gt;] [-Y
--device-type &lt;type&gt;] [-l --lun &lt;lun&gt;] [-b
--backing-store &lt;path&gt;] [-E --bstype &lt;type&gt;] [-I
--initiator-address &lt;address&gt;] [-Q --initiator-name
&lt;name&gt;] [-n --name &lt;parameter&gt;] [-v --value
&lt;value&gt;] [-P --params
&lt;param=value[,param=value...]&gt;] [-F --force] [-h
--help]</p>

<p>DESCRIPTION tgtadm is used to monitor and modify
everything about Linux SCSI target software: targets,
volumes, etc.</p>

<p>OPTIONS -C, --control-port &lt;port&gt; It is possible
to run multiple concurrent instances of tgtd on a host. This
argument is used to control which instance the tgtadm
command will operate on.</p>

<p>-Y, --device-type &lt;type&gt; When creating a LUN, this
parameter specifies the type of device to create. Default is
disk.</p>

<p>Possible device-types are: disk : emulate a disk device
tape : emulate a tape reader ssc : same as tape cd : emulate
a DVD drive changer : emulate a media changer device pt :
passthrough type to export a /dev/sg device</p>

<p>-E, --bstype &lt;type&gt; When creating a LUN, this
parameter specifies the type of backend storage to to
use.</p>

<p>Possible backend types are: rdwr : Use normal file I/O.
This is the default for disk devices aio : Use Asynchronous
I/O</p>

<p>sg : Special backend type for passthrough devices ssc :
Special backend type for tape emulation</p>

<p>--lld &lt;driver&gt; --op new --mode target --tid
&lt;id&gt; --targetname &lt;name&gt; Add a new target with
&lt;id&gt; and &lt;name&gt;.</p>

<p>--lld &lt;driver&gt; --op delete --mode target --tid
&lt;id&gt; Delete specific target with &lt;id&gt;. The
target must have no active I_T nexus.</p>

<p>--lld &lt;driver&gt; --op delete --force --mode target
--tid &lt;id&gt; Delete specific target forcibly with
&lt;id&gt;.</p>

<p>--lld &lt;driver&gt; --op show --mode target Show all
the targets.</p>

<p>--lld &lt;driver&gt; --op show --mode target --tid
&lt;id&gt; Show target parameters of a target with
&lt;id&gt;.</p>

<p>--lld &lt;driver&gt; --op new --mode logicalunit --tid
&lt;id&gt; --lun &lt;lun&gt; --backing-store &lt;path&gt;
Add a new logical unit with &lt;lun&gt; to specific target
with &lt;id&gt;. The logical unit is offered to the
initiators. &lt;path&gt; must be block device files
(including LVM and RAID devices) or regular files. lun0 is
reserved for a special device automatically created.</p>

<p>--lld &lt;driver&gt; --op delete --mode logicalunit
--tid &lt;id&gt; --lun &lt;lun&gt; Delete specific logical
unit with &lt;lun&gt; that the target with &lt;id&gt;
has.</p>

<p>--lld &lt;driver&gt; --op bind --mode target --tid
&lt;id&gt; --initiator-address &lt;address&gt; Add the
address to the access lists of the target with &lt;id&gt;.
Initiators with the address can access to the target.
&acute;ALL&acute; is a special address to allow all
initiators to access to a target.</p>

<p>--lld &lt;driver&gt; --op bind --mode target --tid
&lt;id&gt; --initiator-name &lt;name&gt; Add the
initiator&acute;s name to the access lists of the target
with &lt;id&gt;. Initiators with the names can access to the
target.</p>

<p>--lld &lt;driver&gt; --op unbind --mode target --tid
&lt;id&gt; --initiator-address &lt;address&gt; Delete the
address from the access lists of the target with
&lt;id&gt;.</p>

<p>--lld &lt;driver&gt; --op unbind --mode target --tid
&lt;id&gt; --initiator-name &lt;name&gt; Delete the
initiator&acute;s name from the access lists of the target
with &lt;id&gt;.</p>

<p>--lld &lt;driver&gt; --op update --mode target --tid
&lt;id&gt; --name=&lt;parameter&gt; --value=&lt;value&gt;
Change the value of &lt;parameter&gt; of the target with
&lt;id&gt; to &lt;value&gt;.</p>

<p>--lld &lt;driver&gt; --op update --mode target --tid
&lt;id&gt; --params parameter=value&lt;,...&gt; Sets/changes
the value of one or more parameters.</p>

<p>--help Display a list of available options and
exits.</p>

<p>LUN PARAMETERS These parameters are only applicable for
&quot;--mode logicalunit&quot;.</p>

<p>vendor_id=&lt;string&gt; This parameter sets the Vendor
Identification string that a LUN will report in INQURY
data.</p>

<p>product_id=&lt;string&gt; This parameter sets the
Product Identification string that a LUN will report in
INQURY data.</p>

<p>product_rev=&lt;string&gt; This parameter sets the
Product Revision string that a LUN will report in INQURY
data.</p>

<p>Example:</p>

<p>tgtadm --lld iscsi --mode logicalunit --op update --tid
&lt;TID&gt; --lun &lt;LUN&gt; --params
vendor_id=TGTD,product_id=VirtualHD,product_rev=0103</p>

<p>removable=&lt;0|1&gt; This can be used to
override/change the default setting for the removable flag.
Disk devices default to non-removable while DVD and TAPE
devices default to removable.</p>

<p>sense_format=&lt;0|1&gt; This flag controls the format
of sense data that the device will return. 0 = Clasic sense
format, 1 = Support descriptor format.</p>

<p>online=&lt;0|1&gt; This controls whether a device is
online or not.</p>

<p>Devices default to be online when created but can be
brought offline using this parameter. Behaviour of offline
devices depend on device type. An MMC/DVD device that is
offline will report that there is no disk in the unit but
the actual MMC/DVD unit itself can still be communicated
with. All other device types will fail all I/O with a sense
code of Not Ready.</p>

<p>Example:</p>

<p>tgtadm --lld iscsi --mode logicalunit --op update --tid
1 --lun 1 --params removable=1,sense_format=1,online=1</p>

<p>mode_page=&lt;byte-string&gt; This parameter is used to
set specific mode pages for the device and the mode page
contents. Most devices default to reasonable default mode
pages automatically when the LUN is created, but this allows
special settings.</p>

<p>Examples:</p>

<p>Create mode page &acute;2&acute;, subpage 0 and 14 bytes
of data. This is Disconnect-Reconnect mode page.</p>

<p>tgtadm --mode logicalunit --op update --tid 1 --lun 2
--params
mode_page=2:0:14:0x80:0x80:0:0xa:0:0:0:0:0:0:0:0:0:0</p>

<p>Create mode page &acute;10&acute;, subpage 0 and 10
bytes of data. This is Control Extension mode page.</p>

<p>tgtadm --lld iscsi --mode logicalunit --op update --tid
1 --lun 2 --params mode_page=10:0:10:2:0:0:0:0:0:0:0:2:0</p>

<p>Create mode page &acute;0x1c&acute;, subpage 0 and 10
bytes of data. This is Informational Exceptions Control mode
page.</p>

<p>tgtadm --lld iscsi --mode logicalunit --op update --tid
1 --lun 2 --params
mode_page=0x1c:0:10:8:0:0:0:0:0:0:0:0:0</p>

<p>readonly=&lt;0|1&gt; This sets the read-only flag of a
LUN. A read-only LUN will refuse any attempts to write data
to it.</p>

<p>This parameter only applies to DISK devices.</p>

<p>tgtadm --lld iscsi --mode logicalunit --op update --tid
1 --lun 1 --params readonly=1</p>

<p>SMC SPECIFIC LUN PARAMETERS These parameters are only
applicable for luns that are of type &quot;changer&quot;
i.e. the media changer device for a DVD Jukebox or a Virtual
Tape Library.</p>

<p>element_type=&lt;1|2|3|4&gt; This controls which type of
element a certain slot in the jukebox/vtl is.</p>

<p>Slot types: 1 -&gt; Medium Transport (picker arm) 2
-&gt; Storage Element 3 -&gt; Import/Export Element 4 -&gt;
Data Transfer device (CD drive, tape drive, MO drive
etc)</p>

<p>address=&lt;1-65535&gt; This is used to create/operate
on a single slot. Address specifies the slot on which to
perform the operation.</p>

<p>start_address=&lt;1-65535&gt;,quantity=&lt;1--65535&gt;
This is used to create/operate on an entire range of slots
at once. Start_address specifies the first address to
operate on and quantity specifies the number of consequtive
slots.</p>

<p>sides=&lt;1|2&gt; When creating storage elements, i.e.
&quot;element_type=2&quot;, this parameter specifies if the
media has 1 or two sides to hold data.</p>

<p>clear_slot=&lt;1&gt; This option is used to clear a
storage element and remove any media that may be present.
Once this command completes the storage element will show up
as &quot;Empty&quot;.</p>

<p>barcode=&lt;string&gt; This is used to assign a barcode
to an element.</p>

<p>media_home=&lt;string&gt; This parameter specifies a
directory where all virtual media for the dvd/tape device
elements are stored.</p>

<p>To assign a media image file to a storage element slot,
you assign &quot;barcode&quot; to be the name of the image
file in the &quot;media_home&quot; directory.</p>

<p>Example: How to create a DVD jukebox with eight disk
trays and two empty DVD-R disks.</p>

<p># Create a target tgtadm --lld iscsi --mode target --op
new --tid 1 --targetname
iqn.2007-03:virtual-dvd:hostname</p>

<p># Create a DVD drive and give it a nice name # The dvd
starts out without a backing store file, i.e. no disk loaded
tgtadm --op new --mode logicalunit --tid 1 --lun 1
--device-type cd tgtadm --lld iscsi --mode logicalunit --op
update --tid 1 --lun 1 --params
vendor_id=STGT_DVD,product_id=DVD101,product_rev=0010,scsi_sn=STGTDVD01,removable=1</p>

<p># We need a backend store file for the media changer if
[ ! -f $HOME/smc ]; then dd if=/dev/zero of=$HOME/smc bs=1k
count=1 fi</p>

<p># Create the SMC device and give it a nice name tgtadm
--lld iscsi --mode logicalunit --op new --tid 1 --lun 2
--backing-store $HOME/smc --device-type changer tgtadm --lld
iscsi --mode logicalunit --op update --tid 1 --lun 2
--params
vendor_id=STK,product_id=L700,product_rev=0010,scsi_sn=XYZZY_0,removable=1</p>

<p># Add a Data Transfer devices (1 drive) tgtadm --lld
iscsi --mode logicalunit --op update --tid 1 --lun 2
--params element_type=4,start_address=1,quantity=1</p>

<p># Specify that the DVD above (LUN 1) is the data
transfer device we created tgtadm --lld iscsi --mode
logicalunit --op update --tid 1 --lun 2 --params
element_type=4,address=1,tid=1,lun=1</p>

<p># Medium Transport Elements (robot arm / picker) tgtadm
--lld iscsi --mode logicalunit --op update --tid 1 --lun 2
--params element_type=1,start_address=16,quantity=1</p>

<p># define path to virtual media VTL=${HOME}/vtl mkdir -p
${VTL} tgtadm --lld iscsi --mode logicalunit --op update
--tid 1 --lun 2 --params media_home=${VTL}</p>

<p># Storage Elements - 8 starting at addr 1024 tgtadm
--lld iscsi --mode logicalunit --op update --tid 1 --lun 2
--params element_type=2,start_address=1024,quantity=8</p>

<p># Add &acute;media&acute; to slots 1 and 2 and leave the
other 6 slots empty # slot 1 # Create empty writeable
virtual DVD-R media tgtimg --op new --device-type cd --type
dvd+r --file ${VTL}/DISK_001 tgtadm --lld iscsi --mode
logicalunit --op update --tid 1 --lun 2 --params
element_type=2,address=1024,barcode=DISK_001,sides=1</p>

<p># slot 2 tgtimg --op new --device-type cd --type dvd+r
--file ${VTL}/DISK_002 tgtadm --lld iscsi --mode logicalunit
--op update --tid 1 --lun 2 --params
element_type=2,address=1025,barcode=DISK_002,sides=1</p>

<p># Allow ALL initiators to connect to this target tgtadm
--lld iscsi --mode target --op bind --tid 1
--initiator-address ALL</p>

<p># Show all our good work. tgtadm --lld iscsi --mode
target --op show</p>

<p>PASSTHROUGH DEVICES In addition to device emulation TGTD
also supports utilizing existing SG devices on the host and
exporting these through a special passthrough device
type.</p>

<p>--bstype=sg This specifies that an SG devices is
used.</p>

<p>--device-type=pt This specifies that passthrough device
type is used.</p>

<p>--backing-store=&lt;/dev/sg4&gt; This specifies which
device to export through TGTD.</p>

<p>Example: Make /dev/sg4 available to initiators
connecting to TGTD.</p>

<p>tgtadm --lld iscsi --op new --mode logicalunit --tid 1
--lun 1 --bstype=sg --device-type=pt
--backing-store=/dev/sg4</p>

<p>HEADER DIGEST AND DATA DIGEST Header and data digests
can be set on a per target parameter. TGTD supports two
modes, None and CRC32C. When the digest is set to None, TDTD
will negotiate that digests will not be used, and when
CRC32C is set, TGTD will force the connection to use
digest.</p>

<p>Viewing the current settings This command is used to
view the current settings for header/data digest.</p>

<p>tgtadm --op show --mode target --tid 1 ...
HeaderDigest=None DataDigest=None ...</p>

<p>Setting digest Set header digest to CRC32C: tgtadm --op
update --mode target --tid 1 -n HeaderDigest -v CRC32C</p>

<p>Set data digest to None: tgtadm --op update --mode
target --tid 1 -n DataDigest -v None</p>

<p>CHAP AUTHENTICATION CHAP authentication is supported to
require authentication before an initiator is allowed to log
in and access devices.</p>

<p>CHAP main-phase authentication is set on the target
level. To set up CHAP authentication we first need to create
an account and its associated password, then we bind the
account to one or more targets.</p>

<p>Setting CHAP on a target These two commands create a
user account and binds it to target 1.</p>

<p>tgtadm --lld iscsi --op new --mode account --user ronnie
--password password tgtadm --lld iscsi --op bind --mode
account --tid 1 --user ronnie</p>

<p>List all accounts This command is used to list all
accounts that have been created.</p>

<p>tgtadm --lld iscsi --op show --mode account Account
list: ronnie</p>

<p>Show if a target requires authentication When listing
the targets, each target that has authantication enabled
will contain a listing of all accoutns bound to that
target.</p>

<p>tgtadm --lld iscsi --op show --mode target Target 1:
iqn.ronnie.test ... Account information: ronnie ...</p>

<p>ISCSI PORTALS iSCSI portals can be viewed, added and
removed at runtime.</p>

<p>List portals This command is used to list the current
iSCSI portals defined on the target:</p>

<p>tgtadm --lld iscsi --op show --mode portal Portal:
10.1.1.101:3260,1 Portal: 127.0.0.1:3260,1</p>

<p>Add portal This command is used to add a portal to the
target :</p>

<p>tgtadm --lld iscsi --op new --mode portal --param
portal=10.1.1.101:3260</p>

<p>Remove portal This command is used to remove a portal
from the target :</p>

<p>tgtadm --lld iscsi --op delete --mode portal --param
portal=10.1.1.101:3260</p>

<p>ISCSI CONNECTIONS iSCSI connections can be viewed and
forced closed at runtime.</p>

<p>List all active connections for a target This command is
used to list the all the active iSCSI connections to the
target with connection id, initiator name and ip address for
the initiator :</p>

<p>tgtadm --lld iscsi --op show --mode conn --tid 1
Session: 2 Connection: 0 Initiator:
iqn.2008-11.org.linux-kvm: IP Address: 127.0.0.1</p>

<p>Close an existing connection This command is used to
close an iSCSI connection. Note that forcibly closing iSCSI
connections can lead to data-loss.</p>

<p>tgtadm --lld iscsi --op delete --mode conn --tid 1 --sid
2 --cid 0</p>

<p>ONLINE/OFFLINE STATUS Tgtd LUNs can be in online or
offline status. LUNs that are Offline behave slightly
different depending on the device type. Offline devices
behave as if there is no media available and any operations
that access media will fail with an check-condition
error.</p>

<p>Devices can not be set to Offline mode while there are
&quot;PREVENT ALLOW MEDIUM REMOVAL&quot; locks on the
device. Similarly media in Online devices can not be
software ejected while there are such locks on the device
(the &acute;eject&acute; command will fail).</p>

<p>Show Online/Offline status Finding the Online/Offline
status of a LUN is done through the tgtd command. If
&quot;Prevent removal&quot; is &quot;Yes&quot; this
indicates that an application holds a &quot;prevent media
removal&quot; lock on the device.</p>

<p>tgtadm --lld iscsi --mode target --op show ... LUN: 2
Type: cd/dvd SCSI ID: IET 00010002 SCSI SN: beaf12 Size:
3432 MB, Block size: 1 Online: Yes Removable media: Yes
Prevent removal: Yes ...</p>

<p>Changing a LUN to Offline A LUN is changed to Offline
status using the tgtadm command. When devices are set
Offline these devices will behave as if there is no media
loaded into the drive.</p>

<p>Change a LUN to become offline. (no disk in the
drive)</p>

<p>tgtadm --tid 1 --lun 2 --op update --mode logicalunit -P
Online=No</p>

<p>ISNS PARAMETERS iSNS configuration for a target is by
using the tgtadm command.</p>

<p>iSNSServerIP This specifies the IP address of the iSNS
server. TGTD only supprots one iSNS server.</p>

<p>Example:</p>

<p>tgtadm --op update --mode sys --name iSNSServerIP
--value 192.168.11.133</p>

<p>iSNS This setting enables(on)/disables(off) iSNS.</p>

<p>Example:</p>

<p>tgtadm --op update --mode sys --name iSNS --value On</p>

<p>iSNSServerPort This setting specifies the port to use
for iSNS.</p>

<p>Example:</p>

<p>tgtadm --op update --mode sys --name iSNSServerPort
--value 3205</p>

<p>iSNSAccessControl Enable/disable access control for
iSNS.</p>

<p>Example:</p>

<p>tgtadm --op update --mode sys --name iSNSAccessControl
--value Off</p>

<p>SEE ALSO tgtd(8), tgt-admin(8), tgtimg(8),
tgt-setup-lun(8). http://stgt.sourceforge.net/</p>

<p>REPORTING BUGS Report bugs to
&lt;stgt@vger.kernel.org&gt;</p>

<p>[FIXME: source] 01/19/2016 TGTADM(8)</p>
<hr>
</body>
</html>
