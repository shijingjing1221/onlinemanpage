<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:07:04 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>CANONICAL(5) CANONICAL(5)</p>

<p>NAME canonical - Postfix canonical table format</p>

<p>SYNOPSIS postmap /etc/postfix/canonical</p>

<p>postmap -q &quot;string&quot; /etc/postfix/canonical</p>

<p>postmap -q - /etc/postfix/canonical &lt;inputfile</p>

<p>DESCRIPTION The optional canonical(5) table specifies an
address mapping for local and non-local addresses. The
mapping is used by the cleanup(8) daemon, before mail is
stored into the queue. The address mapping is recur-
sive.</p>

<p>Normally, the canonical(5) table is specified as a text
file that serves as input to the postmap(1) command. The
result, an indexed file in dbm or db format, is used for
fast searching by the mail system. Execute the command
&quot;postmap /etc/postfix/canonical&quot; to rebuild an
indexed file after changing the corresponding text file.</p>

<p>When the table is provided via other means such as NIS,
LDAP or SQL, the same lookups are done as for ordinary
indexed files.</p>

<p>Alternatively, the table can be provided as a
regular-expression map where patterns are given as regular
expressions, or lookups can be directed to TCP-based server.
In those cases, the lookups are done in a slightly different
way as described below under &quot;REGULAR EXPRESSION
TABLES&quot; or &quot;TCP-BASED TABLES&quot;.</p>

<p>By default the canonical(5) mapping affects both message
header addresses (i.e. addresses that appear inside
messages) and message envelope addresses (for example, the
addresses that are used in SMTP protocol commands). This is
controlled with the canonical_classes parameter.</p>

<p>NOTE: Postfix versions 2.2 and later rewrite message
headers from remote SMTP clients only if the client matches
the local_header_rewrite_clients parameter, or if the
remote_header_rewrite_domain configuration parameter
specifies a non- empty value. To get the behavior before
Postfix 2.2, specify &quot;local_header_rewrite_clients =
static:all&quot;.</p>

<p>Typically, one would use the canonical(5) table to
replace login names by Firstname.Lastname, or to clean up
addresses produced by legacy mail systems.</p>

<p>The canonical(5) mapping is not to be confused with
virtual alias sup- port or with local aliasing. To change
the destination but not the headers, use the virtual(5) or
aliases(5) map instead.</p>

<p>CASE FOLDING The search string is folded to lowercase
before database lookup. As of Postfix 2.3, the search string
is not case folded with database types such as regexp: or
pcre: whose lookup fields can match both upper and lower
case.</p>

<p>TABLE FORMAT The input format for the postmap(1) command
is as follows:</p>

<p>pattern result When pattern matches a mail address,
replace it by the corre- sponding result.</p>

<p>blank lines and comments Empty lines and whitespace-only
lines are ignored, as are lines whose first non-whitespace
character is a #.</p>

<p>multi-line text A logical line starts with
non-whitespace text. A line that starts with whitespace
continues a logical line.</p>

<p>TABLE SEARCH ORDER With lookups from indexed files such
as DB or DBM, or from networked tables such as NIS, LDAP or
SQL, patterns are tried in the order as listed below:</p>

<p>user@domain address Replace user@domain by address. This
form has the highest prece- dence.</p>

<p>This is useful to clean up addresses produced by legacy
mail systems. It can also be used to produce
Firstname.Lastname style addresses, but see below for a
simpler solution.</p>

<p>user address Replace user@site by address when site is
equal to $myorigin, when site is listed in $mydestination,
or when it is listed in $inet_interfaces or
$proxy_interfaces.</p>

<p>This form is useful for replacing login names by
Firstname.Last- name.</p>

<p>@domain address Replace other addresses in domain by
address. This form has the lowest precedence.</p>

<p>Note: @domain is a wild-card. When this form is applied
to recipient addresses, the Postfix SMTP server accepts mail
for any recipient in domain, regardless of whether that
recipient exists. This may turn your mail system into a
backscatter source: Postfix first accepts mail for
non-existent recipients and then tries to return that mail
as &quot;undeliverable&quot; to the often forged sender
address.</p>

<p>RESULT ADDRESS REWRITING The lookup result is subject to
address rewriting:</p>

<p>&middot; When the result has the form @otherdomain, the
result becomes the same user in otherdomain.</p>

<p>&middot; When &quot;append_at_myorigin=yes&quot;, append
&quot;@$myorigin&quot; to addresses without
&quot;@domain&quot;.</p>

<p>&middot; When &quot;append_dot_mydomain=yes&quot;,
append &quot;.$mydomain&quot; to addresses without
&quot;.domain&quot;.</p>

<p>ADDRESS EXTENSION When a mail address localpart contains
the optional recipient delimiter (e.g., user+foo@domain),
the lookup order becomes: user+foo@domain, user@domain,
user+foo, user, and @domain.</p>

<p>The propagate_unmatched_extensions parameter controls
whether an unmatched address extension (+foo) is propagated
to the result of table lookup.</p>

<p>REGULAR EXPRESSION TABLES This section describes how the
table lookups change when the table is given in the form of
regular expressions. For a description of regular expression
lookup table syntax, see regexp_table(5) or
pcre_table(5).</p>

<p>Each pattern is a regular expression that is applied to
the entire address being looked up. Thus, user@domain mail
addresses are not bro- ken up into their user and @domain
constituent parts, nor is user+foo broken up into user and
foo.</p>

<p>Patterns are applied in the order as specified in the
table, until a pattern is found that matches the search
string.</p>

<p>Results are the same as with indexed file lookups, with
the additional feature that parenthesized substrings from
the pattern can be interpo- lated as $1, $2 and so on.</p>

<p>TCP-BASED TABLES This section describes how the table
lookups change when lookups are directed to a TCP-based
server. For a description of the TCP client/server lookup
protocol, see tcp_table(5). This feature is not available up
to and including Postfix version 2.4.</p>

<p>Each lookup operation uses the entire address once.
Thus, user@domain mail addresses are not broken up into
their user and @domain con- stituent parts, nor is user+foo
broken up into user and foo.</p>

<p>Results are the same as with indexed file lookups.</p>

<p>BUGS The table format does not understand quoting
conventions.</p>

<p>CONFIGURATION PARAMETERS The following main.cf
parameters are especially relevant. The text below provides
only a parameter summary. See postconf(5) for more details
including examples.</p>

<p>canonical_classes What addresses are subject to
canonical address mapping.</p>

<p>canonical_maps List of canonical mapping tables.</p>

<p>recipient_canonical_maps Address mapping lookup table
for envelope and header recipient addresses.</p>

<p>sender_canonical_maps Address mapping lookup table for
envelope and header sender addresses.</p>

<p>propagate_unmatched_extensions A list of address
rewriting or forwarding mechanisms that propa- gate an
address extension from the original address to the result.
Specify zero or more of canonical, virtual, alias, for-
ward, include, or generic.</p>

<p>Other parameters of interest:</p>

<p>inet_interfaces The network interface addresses that
this system receives mail on. You need to stop and start
Postfix when this parameter changes.</p>

<p>local_header_rewrite_clients Rewrite message header
addresses in mail from these clients and update incomplete
addresses with the domain name in $myorigin or $mydomain;
either dont rewrite message headers from other clients at
all, or rewrite message headers and update incomplete
addresses with the domain specified in the
remote_header_rewrite_domain parameter.</p>

<p>proxy_interfaces Other interfaces that this machine
receives mail on by way of a proxy agent or network address
translator.</p>

<p>masquerade_classes List of address classes subject to
masquerading: zero or more of envelope_sender,
envelope_recipient, header_sender, header_recipient.</p>

<p>masquerade_domains List of domains that hide their
subdomain structure.</p>

<p>masquerade_exceptions List of user names that are not
subject to address masquerading.</p>

<p>mydestination List of domains that this mail system
considers local.</p>

<p>myorigin The domain that is appended to locally-posted
mail.</p>

<p>owner_request_special Give special treatment to
owner-xxx and xxx-request addresses.</p>

<p>remote_header_rewrite_domain Dont rewrite message
headers from remote clients at all when this parameter is
empty; otherwise, rewrite message headers and append the
specified domain name to incomplete addresses.</p>

<p>SEE ALSO cleanup(8), canonicalize and enqueue mail
postmap(1), Postfix lookup table manager postconf(5),
configuration parameters virtual(5), virtual aliasing</p>

<p>README FILES Use &quot;postconf readme_directory&quot;
or &quot;postconf html_directory&quot; to locate this
information. DATABASE_README, Postfix lookup table overview
ADDRESS_REWRITING_README, address rewriting guide</p>

<p>LICENSE The Secure Mailer license must be distributed
with this software.</p>

<p>AUTHOR(S) Wietse Venema IBM T.J. Watson Research P.O.
Box 704 Yorktown Heights, NY 10598, USA</p>

<p>CANONICAL(5)</p>
<hr>
</body>
</html>
