<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:23:55 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>MRTG-NT-GUIDE(1) mrtg MRTG-NT-GUIDE(1)</p>

<p>NAME mrtg-nt-guide - The MRTG 2.16.2 Windows
Installation Guide</p>

<p>SYNOPSIS Installing MRTG on a Windows box is not quite
as &quot;click and point&quot; as some might want it to be.
But then again, it is not all that difficult if you follow
the instructions below.</p>

<p>PREREQUISITES To get MRTG to work on Windows you need
the following:</p>

<p>&middot; A current copy of Perl. For Example ActivePerl
5.8.8 from ActiveS- tate
http://www.activestate.com/store/activeperl/download/</p>

<p>&middot; The latest version of MRTG from
http://oss.oetiker.ch/mrtg/pub. Look for mrtg-2.16.2.zip or
better. The archive also contains a precompiled copy of
rateup.exe for Win32.</p>

<p>INSTALLING I suggest you do the following from the
machine that will be running MRTG, which, in this case, is
also a web server. All examples are for doing things to a
LOCAL machine.</p>

<p>First Unzip MRTG to C:tg-2.16.2 on the Windows machine
of your choice.</p>

<p>Next Install Perl on the same Windows machine. You might
want to make sure that the Perl binary directory is listed
in your system path.</p>

<p>n ; % S y s t e m R o o t % t e m 3 C:Perl2 ; % S y s t
e m R o o t % ; . . .</p>

<p>You can manually check this by going to [Control
Panel]-&gt;[Sys- tem]-&gt;[Environment]</p>

<p>To see if everything is installed properly you can open
a Command Shell and go into c:mrtg-2.16.2bin. Type:</p>

<p>perl mrtg</p>

<p>This should give you a friendly error message
complaining about the missing MRTG configuration file. Now,
you have successfully installed MRTG and Perl.</p>

<p>CONFIGURING MRTG Now it is time to create a
configuration for MRTG. But before we begin you need to know
a few things. Take an opportunity to gather the fol- lowing
information:</p>

<p>&middot; The IP address or hostname and the SNMP port
number, (if non stan- dard), of the device you want to
monitor.</p>

<p>&middot; If you want to monitor something other than
bytes in and out, you must also know the SNMPOID of what you
want to monitor.</p>

<p>&middot; Finally you need to know the read-only SNMP
community string for your device. If you dont know it, try
public, that is the default.</p>

<p>For the rest of this document we will be using device
10.10.10.1 ( a CISCO Catalyst 5000) with Community string
public. We are interested in monitoring traffic, and the CPU
load. Lets begin.</p>

<p>The first thing we do in setting up MRTG is making a
default config file. Get to a cmd prompt and change to the
c:mrtg-2.16.2bin direc- tory. Type the following
command:</p>

<p>perl cfgmaker public@10.10.10.1 --global &quot;WorkDir:
c:0tg&quot; --output mrtg.cfg</p>

<p>This creates an initial MRTG config file for you. Note
that in this file all interfaces of your router will be
stored by number. Unfortu- nately, these numbers are likely
to change whenever you reconfigure your router. In order to
work around this you can get cfgmaker to pro- duce a
configuration which is based on Ip numbers, or even
Interface Descriptions. Check cfgmaker</p>

<p>If you get an error message complaining about no such
name or no response, your community name is probably
wrong.</p>

<p>Now, lets take a look at the mrtg.cfg file that was
created.</p>

<p>In Perl, a &quot;#&quot; is a comment, synonymous with
&quot;REM&quot; in DOS.</p>

<p>Add the following to the top of the mrtg.cfg file:</p>

<p>WorkDir: c:0tg</p>

<p>This is where the web pages are created, usually a web
root.</p>


<p>######################################################################
# Description: LCP SUWGB # Contact: Administrator # System
Name: LC-Bridge # Location: Here
#.....................................................................</p>

<p>TargetDevice s IP Address:Interface Number:Community:IP
Address</p>

<p>Target[10.10.10.1.1]: 1:public@10.10.10.1</p>

<p>This is the interface speed (Default is 10 megabits; for
100Mbit devices use 12500000 and so on...)</p>

<p>MaxBytes[10.10.10.1.1]: 1250000</p>

<p>Title[10.10.10.1.1]: LC-Bridge (sample.device):
ether0</p>

<p>This section determines how the web page headers will
look</p>

<p>PageTop[10.10.10.1.1]: &lt;H1&gt;Traffic Analysis for
ether0&lt;/H1&gt; &lt;TABLE&gt;
&lt;TR&gt;&lt;TD&gt;System:&lt;/TD&gt;&lt;TD&gt;LC-Bridge
inAndover&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Maintainer:&lt;/TD&gt;&lt;TD&gt;Administrator&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Interface:&lt;/TD&gt;&lt;TD&gt;ether0(1)&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;IP:&lt;/TD&gt;&lt;TD&gt;sample.device(10.10.10.1)&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Max Speed:&lt;/TD&gt; &lt;TD&gt;1250.0
kBytes/s (ethernetCsmacd)&lt;/TD&gt;&lt;/TR&gt;
&lt;/TABLE&gt;</p>

<p>Target[10.10.10.1.2]: 2:public@10.10.10.1
MaxBytes[10.10.10.1.2]: 1250000 Title[10.10.10.1.2]:
LC-Bridge (): ulink0 PageTop[10.10.10.1.2]:
&lt;H1&gt;Traffic Analysis for ulink0&lt;/H1&gt;
&lt;TABLE&gt;
&lt;TR&gt;&lt;TD&gt;System:&lt;/TD&gt;&lt;TD&gt;LC-Bridge
inAndover&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Maintainer:&lt;/TD&gt;&lt;TD&gt;Administrator&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Interface:&lt;/TD&gt;&lt;TD&gt;ulink0(2)&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;IP:&lt;/TD&gt;&lt;TD&gt;()&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Max Speed:&lt;/TD&gt; &lt;TD&gt;1250.0
kBytes/s (ethernetCsmacd)&lt;/TD&gt;&lt;/TR&gt;
&lt;/TABLE&gt;</p>


<p>#---------------------------------------------------------------</p>

<p>And thats a very basic MRTG config file. You can run
this and see your results by going into the c:mrtg-2.16.2bin
directory and typing:</p>

<p>perl mrtg mrtg.cfg</p>

<p>It is normal to get errors for the first two times you
run this com- mand. The errors will alert you about the fact
that there have not been any log files in existence
before.</p>

<p>If you take a look at those web pages they are not very
exciting (yet). You need to have the MRTG files run every
five minutes to produce the desired results. Just run it
again after a few minutes. You should now be able to see the
first lines in your graphs.</p>

<p>MAKE MRTG RUN ALL THE TIME Starting MRTG by hand every
time you want to run it is not going to make you happy I
guess.</p>

<p>There is a special option you can set in the MRTG
configuration file so so that MRTG will not terminate after
it was started. Instead it will wait for 5 minutes and then
run again.</p>

<p>Add the option</p>

<p>RunAsDaemon: yes</p>

<p>to your mrtg.cfg file and start it with:</p>

<p>n w p e r l m r start /Dc:tg-2.16.2tng=eventlog mrtg.cfg
g - - l o g g</p>

<p>If you use wperl instead of perl, no console window will
show. MRTG is now running in the background. If it runs into
problems it will tell you so over the EventLog. To stop
MRTG, open the Task Manager and ter- minate the wperl.exe
process. If mrtg has anything to tell you these messages can
be found in the event log.</p>

<p>If you put a shortcut with</p>

<p>Target: wperl mrtg --logging=eventlog mrtg.cfg Start in:
c:tg-2.16.2n</p>

<p>into your start-up folder, MRTG will now start whenever
you login to your NT box.</p>

<p>If you do not want to log into your box just to start
MRTG. Have a look at
http://www.firedaemon.com/mrtg-howto.html which describes a
free tool to start any program as a Service. The pages gives
specific instructions for MRTG users.</p>

<p>HOW TO SETUP MRTG AS A WINDOWS SERVICE Additional
Prerequisites</p>

<p>&middot; MRTG must be installed and fully configured on
the target system. In the following exercise the assumption
is that MRTG is installed under c:tg and all the sample
files use this location.</p>

<p>&middot; Microsoft Tools SRVANY.exe (Applications as
Services Utility) and INSTSRV.exe (Service Installer) -
Those files can be downloaded from Microsoft as a part of
Windows 2000 Resource Kit at
&lt;http://www.microsoft.com/windows2000/tech-
info/reskit/tools/default.asp&gt;. They are also available
from other locations such as
&lt;http://www.electrasoft.com/srvany/srvany.htm&gt;,
&lt;http://www.iopus.com/guides/srvany.htm&gt;, etc.
Detailed instruc- tions on how to use this package are
available at &lt;http://sup-
port.microsoft.com/kb/q137890/&gt;. In order to follow the
steps in this HOW-TO you MUST obtain both executables.</p>

<p>&middot; You must have administrative rights on the
target system.</p>

<p>Preparation</p>

<p>Please complete the following steps before starting the
installation:</p>

<p>n ( y o u &middot; Copy srvany.exe and instsrv.exe to
c:tgrn M R T G b directory).</p>

<p>&middot; Create a file called mrtg.reg anywhere on your
system and paste the following content into it:</p>

<p>Windows Registry Editor Version 5.00</p>

<p>[HKEY_LOCAL_MACHINETEM
&quot;Application&quot;=&quot;c:\perl\bin\wperl.exe&quot;
&quot;AppParameters&quot;=&quot;c:\mrtg\bin\mrtg
--logging=eventlog c:\mrtg\bin\mrtg.cfg&quot;
&quot;AppDirectory&quot;=&quot;c:\mrtg\bin\&quot;</p>

<p>Service Installation</p>

<p>Once again, assuming that MRTG is already fully
installed and config- ured on the target system under c:tg
the following steps are neces- sary to setup MRTG as a
service.</p>

<p>Using the command prompt go into the temporary directory
where you unzipped the package. When there type the
following command to create a service named &quot;MRTG&quot;
in the Windows Services management console:</p>

<p>n a n y instsrv MRTG c:tg. e x e</p>

<p>Now you need to create the App* entries required for the
new service. You can do this by either right-clicking on the
mrtg.reg file and selecting merge or by running the
following command:</p>

<p>regedit /s mrtg.reg</p>

<p>After setting up the registry entry it is time to point
it to your MRTG installation. If you have installed MRTG
under c:mrtg_you can skip this step. Open your registry
editor (Start -&gt; Run -&gt; regedt32), and locate the
[HKEY_LOCAL_MACHINYSTEurrentControlSeerviceMRTG] key. Make
sure that the ImagePath variable is correctly pointing to
srvany.exe located in your MRTG bin directory (for example n
a n y . e x e ) . N e x t y o u h a v e t o c:tge x p a n d
t h e M R T G t r e e , a n d g o to the
[HKEY_LOCAL_MACHINYSTEurrentControlSeer- viceMRTParameters]
key. Under Parameters make sure that all the Application
variables are setup properly.</p>

<p>At this point you are ready to run the service. The only
thing left to do is to start the MRTG service in the
Services management console. After you do this, you should
see two new processes running on your system: srvany.exe and
wperl.exe. Make sure to stop any previously running MRTG
processes to avoid conflict.</p>

<p>Note that it is imperative to set the RunAsDaemon: yes
option or the service will stop after just one single
run!</p>

<p>EXAMPLE Now lets look at a config file to monitor what
we wanted to on our mythical Cisco Cat 5000 -- utilization
on ports 3, 5, 10, and 24, and the CPU Load, which will show
us nonstandard mrtg configurations as well as more
options..</p>

<p>WorkDir: c:0tg RunAsDaemon: yes</p>


<p>######################################################################
# Description: LCP SUWGB # Contact: Administrator # System
Name: LC-Bridge # Location: Here
#.....................................................................</p>

<p>Target[10.10.10.1.1]: 3:public@10.10.10.1
MaxBytes[10.10.10.1.1]: 1250000 Title[10.10.10.1.1]:
LC-Bridge (sample-device): ether0 PageTop[10.10.10.1.1]:
&lt;H1&gt;Traffic Analysis for ether0&lt;/H1&gt;
&lt;TABLE&gt;
&lt;TR&gt;&lt;TD&gt;System:&lt;/TD&gt;&lt;TD&gt;LC-Bridge
inAndover&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Maintainer:&lt;/TD&gt;&lt;TD&gt;Administrator&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Interface:&lt;/TD&gt;&lt;TD&gt;ether0(3)&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;IP:&lt;/TD&gt;&lt;TD&gt;sample-device(10.10.10.1)&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Max Speed:&lt;/TD&gt; &lt;TD&gt;1250.0
kBytes/s (ethernetCsmacd)&lt;/TD&gt;&lt;/TR&gt;
&lt;/TABLE&gt;</p>


<p>#---------------------------------------------------------------</p>

<p>Target[10.10.10.1.2]: 5:public@10.10.10.1
MaxBytes[10.10.10.1.2]: 1250000 Title[10.10.10.1.2]:
LC-Bridge (): ulink0 PageTop[10.10.10.1.2]:
&lt;H1&gt;Traffic Analysis for ulink0&lt;/H1&gt;
&lt;TABLE&gt;
&lt;TR&gt;&lt;TD&gt;System:&lt;/TD&gt;&lt;TD&gt;LC-Bridge
inAndover&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Maintainer:&lt;/TD&gt;&lt;TD&gt;Administrator&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Interface:&lt;/TD&gt;&lt;TD&gt;ulink0(5)&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;IP:&lt;/TD&gt;&lt;TD&gt;()&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Max Speed:&lt;/TD&gt; &lt;TD&gt;1250.0
kBytes/s (ethernetCsmacd)&lt;/TD&gt;&lt;/TR&gt;
&lt;/TABLE&gt;</p>


<p>#---------------------------------------------------------------</p>

<p>Target[10.10.10.1.1]: 10:public@10.10.10.1
MaxBytes[10.10.10.1.1]: 1250000 Title[10.10.10.1.1]:
LC-Bridge (sample-device): ether0 PageTop[10.10.10.1.1]:
&lt;H1&gt;Traffic Analysis for ether0&lt;/H1&gt;
&lt;TABLE&gt;
&lt;TR&gt;&lt;TD&gt;System:&lt;/TD&gt;&lt;TD&gt;LC-Bridge
inAndover&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Maintainer:&lt;/TD&gt;&lt;TD&gt;Administrator&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Interface:&lt;/TD&gt;&lt;TD&gt;ether0(10)&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;IP:&lt;/TD&gt;&lt;TD&gt;sample-device(10.10.10.1)&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Max Speed:&lt;/TD&gt; &lt;TD&gt;1250.0
kBytes/s (ethernetCsmacd)&lt;/TD&gt;&lt;/TR&gt;
&lt;/TABLE&gt;</p>


<p>#---------------------------------------------------------------</p>

<p>Target[10.10.10.1.2]: 24:public@10.10.10.1
MaxBytes[10.10.10.1.2]: 1250000 Title[10.10.10.1.2]:
LC-Bridge (): ulink0 PageTop[10.10.10.1.2]:
&lt;H1&gt;Traffic Analysis for ulink0&lt;/H1&gt;
&lt;TABLE&gt;
&lt;TR&gt;&lt;TD&gt;System:&lt;/TD&gt;&lt;TD&gt;LC-Bridge
inAndover&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Maintainer:&lt;/TD&gt;&lt;TD&gt;Administrator&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Interface:&lt;/TD&gt;&lt;TD&gt;ulink0(24)&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;IP:&lt;/TD&gt;&lt;TD&gt;()&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;Max Speed:&lt;/TD&gt; &lt;TD&gt;1250.0
kBytes/s (ethernetCsmacd)&lt;/TD&gt;&lt;/TR&gt;
&lt;/TABLE&gt;</p>


<p>#---------------------------------------------------------------</p>

<p># Router CPU load %
Target[cpu.1]:1.3.6.1.4.1.9.2.1.58.0&amp;1.3.6.1.4.1.9.2.1.58.0:public@10.10.10.1
RouterUptime[cpu.1]: public@10.10.10.1 MaxBytes[cpu.1]: 100
Title[cpu.1]: CPU LOAD PageTop[cpu.1]: &lt;H1&gt;CPU Load
%&lt;/H1&gt; Unscaled[cpu.1]: ymwd ShortLegend[cpu.1]: %
XSize[cpu.1]: 380 YSize[cpu.1]: 100 YLegend[cpu.1]: CPU
Utilization Legend1[cpu.1]: CPU Utilization in % (Load)
Legend2[cpu.1]: CPU Utilization in % (Load) Legend3[cpu.1]:
Legend4[cpu.1]: LegendI[cpu.1]: LegendO[cpu.1]:
&amp;nbsp;Usage Options[cpu.1]: gauge</p>

<p>This is a nice example of how to monitor any SNMP device
if you know what OID you want to use. Once again, for an
explanation of the more advance features of mrtg, please see
the rest of the documentation.</p>

<p>AUTHORS Tobi Oetiker &lt;tobi@oetiker.ch&gt;, David S.
Divins &lt;ddivins@moon.jic.com&gt;, Steve Pierce
&lt;MRTG@HDL.com&gt;, Artyom Adjemov
&lt;one.bofh@gmail.com&gt;, Ilja Ivanov
&lt;ivanov@bseu.by&gt; Karel Fajkus
&lt;http://fajkus.cz/&gt;</p>

<p>2.16.2 2008-05-16 MRTG-NT-GUIDE(1)</p>
<hr>
</body>
</html>
