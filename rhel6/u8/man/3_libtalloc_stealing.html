<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:21:58 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>libtalloc_stealing(3) talloc libtalloc_stealing(3)</p>

<p>NAME libtalloc_stealing - Chapter 2: Stealing a
context</p>

<p>Stealing a context Talloc has the ability to change the
parent of a talloc context to another one. This operation is
commonly referred to as stealing and it is one of the most
important actions performed with talloc contexts.</p>

<p>Stealing a context is necessary if we want the pointer
to outlive the context it is created on. This has many
possible use cases, for instance stealing a result of a
database search to an in-memory cache context, changing the
parent of a field of a generic structure to a more specific
one or vice-versa. The most common scenario, at least in
Samba, is to steal output data from a function-specific
context to the output context given as an argument of that
function.</p>

<p>struct foo { char *a1; char *a2; char *a3; };</p>

<p>struct bar { char *wurst; struct foo *foo; };</p>

<p>struct foo *foo = talloc_zero(ctx, struct foo);
foo-&gt;a1 = talloc_strdup(foo, a1); foo-&gt;a2 =
talloc_strdup(foo, a2); foo-&gt;a3 = talloc_strdup(foo,
a3);</p>

<p>struct bar *bar = talloc_zero(NULL, struct bar); /*
change parent of foo from ctx to bar */ bar-&gt;foo =
talloc_steal(bar, foo);</p>

<p>/* or do the same but assign foo = NULL */ bar-&gt;foo =
talloc_move(bar, &amp;foo);</p>

<p>The talloc_move() function is similar to the
talloc_steal() function but additionally sets the source
pointer to NULL.</p>

<p>In general, the source pointer itself is not changed (it
only replaces the parent in the meta data). But the common
usage is that the result is assigned to another variable,
thus further accessing the pointer from the original
variable should be avoided unless it is necessary. In this
case talloc_move() is the preferred way of stealing a
context. Additionally sets the source pointer to NULL,
thus.protects the pointer from being accidentally freed and
accessed using the old variable after its parent has been
changed.</p>

<p>Version 2.0 1 Apr 2016 libtalloc_stealing(3)</p>
<hr>
</body>
</html>
