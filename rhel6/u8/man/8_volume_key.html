<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:44:00 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>volume_key(8) volume_key(8)</p>

<p>NAME volume_key - work with volume encryption secrets
and escrow packets</p>

<p>SYNOPIS volume_key [OPTION]... OPERAND...</p>

<p>DESCRIPTION volume_key extracts &quot;secrets&quot; used
for volume encryption (for example keys or passphrases) and
stores them into separate encrypted &quot;escrow
packets&quot;, uses a previously created escrow packet to
restore access to a volume (e.g. if the user forgets a
passphrase), or manipulates the information in escrow
packets.</p>

<p>The mode of operation and operands of volume_key are
determined by specifying one of the --save, --restore,
--setup-volume, --reencrypt, --dump or --secrets options.
See the OPTIONS sections for details.</p>

<p>OPTIONS In all options described below, VOLUME is a LUKS
device, not the plain- text device containted within: blkid
-s TYPE VOLUME should report
TYPE=&quot;crypto_LUKS&quot;.</p>

<p>The following options determine the mode of operation
and expected operands of volume_key:</p>

<p>--save Expects operands VOLUME [PACKET]. Open VOLUME. If
PACKET is provided, load the secrets from it. Otherwise,
extract secrets from VOLUME, prompting the user if
necessary. In any case, store secrets in one or more output
packets.</p>

<p>--restore Expects operands VOLUME PACKET. Open VOLUME
and use the secrets in PACKET to make VOLUME accessible
again, prompting the user if necessary (e.g. by letting the
user enter a new passphrase).</p>

<p>--setup-volume Expects operands VOLUME PACKET NAME. Open
VOLUME and use the secrets in PACKET to set up VOLUME for
use of the decrypted data as NAME.</p>

<p>Currently NAME is a name of a dm-crypt volume, and this
opera- tion makes the decrypted volume available as
/dev/mapper/NAME.</p>

<p>This operation should not permanently alter VOLUME (e.g.
by adding a new passphrase); the user can of course access
and mod- ify the decrypted volume, modifying VOLUME in the
process.</p>

<p>--reencrypt Expects operand PACKET. Open PACKET,
decrypting it if neces- sary, and store the information in
one or more new output pack- ets.</p>

<p>--dump Expects operand PACKET. Open PACKET, decrypting
it if neces- sary, and output the contents of PACKET. The
secrets are not output by default.</p>

<p>--secrets Expects operand PACKET. Open PACKET,
decrypting it if neces- sary, and output secrets contained
in PACKET.</p>

<p>--help Show usage information.</p>

<p>--version Show version of volume_key.</p>

<p>The following options alter the behavior of the
specified operation:</p>

<p>-b, --batch Run in batch mode. Read passwords and
passphrases from standard input, each terminated by a NUL
character. If a packet does not match a volume exactly, fail
instead of prompting the user.</p>

<p>-d, --nss-dir DIR Use private keys in NSS database in
DIR to decrypt public key- encrypted packets.</p>

<p>-o, --output PACKET Write the default secret to
PACKET.</p>

<p>Which secret is the default depends on volume format: it
should not be likely to expire, and it should allow
restoring access to the volume using --restore.</p>

<p>--output-data-encryption-key PACKET Write the data
encryption key (the key directly used to encrypt the actual
volume data) to PACKET.</p>

<p>--output-passphrase PACKET Write a passphrase that can
be used to access the volume to PACKET.</p>

<p>--create-random-passphrase PACKET Generate a random
alphanumeric passphrase, add it to VOLUME (without affecting
other passphrases) and store the random passphrase into
PACKET.</p>

<p>-c, --certificate CERT Load a certificate from the file
specified by CERT and encrypt all output packets using the
public key contained in the cer- tificate. If this option is
not specified, all output packets are encrypted using a
passphrase.</p>

<p>Note that CERT is a certificate file name, not a NSS
certificate nickname.</p>

<p>--output-format FORMAT Use FORMAT for all output
packets. FORMAT can currently be one of asymmetric (use CMS
to encrypt the whole packet, requires a certificate),
asymmetric_wrap_secret_only (wrap only the secret, requires
a certificate), passphrase (use GPG to encrypt the whole
packet, requires a passphrase).</p>

<p>--with-secrets Include secrets in the output of
--dump</p>

<p>EXIT STATUS volume_key returns with exit status 0 on
success, 1 on error.</p>

<p>NOTES The only currently supported volume format is
LUKS.</p>

<p>EXAMPLE Typical usage of volume_key proceeds as follows.
During system instal- lation or soon after, back up the
default secret of a volume, and add a system-specific random
passphrase. Encrypt both using a certificate: volume_key
--save VOLUME -c CERT -o PACKET_DEFAULT --create-ran-
dom-passphrase PACKET_PASSPHRASE Store PACKET_DEFAULT and
PACKET_PASSPHRASE outside of the computer.</p>

<p>If the user forgets a passphrase, and you can access the
computer, decrypt PACKET_DEFAULT using the certificate
private key (which should never leave a secure machine):
volume_key --reencrypt -d NSS_DB PACKET_DEFAULT -o
PACKET_DEFAULT_PW Then boot the computer (e.g. using a
&quot;rescue mode&quot;), copy PACKET_DEFAULT_PW to it, and
restore access to the volume: volume_key --restore VOLUME
PACKET_DEFAULT_PW</p>

<p>If the user forgets the passphrase, and you cannot
access the computer, decrypt the backup passphrase:
volume_key --secrets PACKET_PASSPHRASE and tell the backup
passphrase to the user. (You can later generate a new backup
passphrase.)</p>

<p>volume_key Sep 2010 volume_key(8)</p>
<hr>
</body>
</html>
