<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:20:00 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>ipa-replica-manage(1) FreeIPA Manual Pages
ipa-replica-manage(1)</p>

<p>NAME ipa-replica-manage - Manage an IPA replica</p>

<p>SYNOPSIS ipa-replica-manage [OPTION]...
[connect|disconnect|del|list|re-ini- tialize|force-sync]</p>

<p>DESCRIPTION Manages the replication agreements of an IPA
server.</p>

<p>connect [SERVER_A] &lt;SERVER_B&gt; - Adds a new
replication agreement between SERVER_A/localhost and
SERVER_B</p>

<p>disconnect [SERVER_A] &lt;SERVER_B&gt; - Removes a
replication agreement between SERVER_A/localhost and
SERVER_B</p>

<p>del &lt;SERVER&gt; - Removes all replication agreements
and data about SERVER</p>

<p>list [SERVER] - Lists all the servers or the list of
agreements of SERVER</p>

<p>re-initialize - Forces a full re-initialization of the
IPA server retrieving data from the server specified with
the --from option</p>

<p>force-sync - Immediately flush any data to be replicated
from a server specified with the --from option</p>

<p>list-ruv - List the replication IDs on this server.</p>

<p>clean-ruv [REPLICATION_ID] - Run the CLEANALLRUV task to
remove a replication ID.</p>

<p>abort-clean-ruv [REPLICATION_ID] - Abort a running
CLEANALLRUV task.</p>

<p>list-clean-ruv - List all running CLEANALLRUV and abort
CLEANALLRUV tasks.</p>

<p>The connect and disconnect options are used to manage
the replication topology. When a replica is created it is
only connected with the mas- ter that created it. The
connect option may be used to connect it to other existing
replicas.</p>

<p>The disconnect option cannot be used to remove the last
link of a replica. To remove a replica from the topology use
the del option.</p>

<p>If a replica is deleted and then re-added within a short
time-frame then the 389-ds instance on the master that
created it should be restarted before re-installing the
replica. The master will have the old service principals
cached which will cause replication to fail.</p>

<p>Each IPA master server has a unique replication ID. This
ID is used by 389-ds-base when storing information about
replication status. The out- put consists of the masters and
their respective replication ID. See clean-ruv</p>

<p>When a master is removed, all other masters need to
remove its replica- tion ID from the list of masters.
Normally this occurs automatically when a master is deleted
with ipa-replica-manage. If one or more mas- ters was down
or unreachable when ipa-replica-manage was executed then
this replica ID may still exist. The clean-ruv command may
be used to clean up an unused replication ID.</p>

<p>NOTE: clean-ruv is VERY DANGEROUS. Execution against the
wrong replica- tion ID can result in inconsistent data on
that master. The master should be re-initialized from
another if this happens.</p>

<p>The replication topology is examined when a master is
deleted and will attempt to prevent a master from being
orphaned. For example, if your topology is A &lt;-&gt; B
&lt;-&gt; C and you attempt to delete master B it will fail
because that would leave masters and A and C orphaned.</p>

<p>The list of masters is stored in
cn=masters,cn=ipa,cn=etc,dc=exam- ple,dc=com. This should be
cleaned up automatically when a master is deleted. If it
occurs that you have deleted the master and all the
agreements but these entries still exist then you will not
be able to re-install IPA on it, the installation will fail
with:</p>

<p>An IPA master host cannot be deleted or disabled using
standard com- mands (host-del, for example).</p>

<p>An orphaned master may be cleaned up using the del
directive with the --cleanup option. This will remove the
entries from cn=mas- ters,cn=ipa,cn=etc that otherwise
prevent host-del from working, its dna profile, s4u2proxy
configuration, service principals and remove it from the
default DUA profile defaultServerList.</p>

<p>OPTIONS -H HOST, --host=HOST The IPA server to manage.
The default is the machine on which the command is run Not
honoured by the re-initialize command.</p>

<p>-p DM_PASSWORD, --password=DM_PASSWORD The Directory
Manager password to use for authentication</p>

<p>-v, --verbose Provide additional information</p>

<p>-f, --force Ignore some types of errors, don t prompt
when deleting a master</p>

<p>-c, --cleanup When deleting a master with the --force
flag, remove leftover references to an already deleted
master.</p>

<p>--binddn=ADMIN_DN Bind DN to use with remote server
(default is cn=Directory Man- ager) - Be careful to quote
this value on the command line</p>

<p>--bindpw=ADMIN_PWD Password for Bind DN to use with
remote server (default is the DM_PASSWORD above)</p>

<p>--winsync Specifies to create/use a Windows Sync
Agreement</p>

<p>--cacert=/path/to/cacertfile Full path and filename of
CA certificate to use with TLS/SSL to the remote server -
this CA certificate will be installed in the directory
servers certificate database</p>

<p>--win-subtree=cn=Users,dc=example,dc=com DN of Windows
subtree containing the users you want to sync (default
cn=Users,&lt;domain suffix&gt; - this is typically what
Windows AD uses as the default value) - Be careful to quote
this value on the command line</p>

<p>--passsync=PASSSYNC_PWD Password for the IPA system user
used by the Windows PassSync plugin to synchronize
passwords. Required when using --winsync. This does not mean
you have to use the PassSync service.</p>

<p>--from=SERVER The server to pull the data from, used by
the re-initialize and force-sync commands.</p>

<p>EXAMPLES List all masters: # ipa-replica-manage list
srv1.example.com srv2.example.com srv3.example.com
srv4.example.com</p>

<p>List a servers replication agreements. #
ipa-replica-manage list srv1.example.com srv2.example.com
srv3.example.com</p>

<p>Re-initialize a replica: # ipa-replica-manage
re-initialize --from srv2.example.com</p>

<p>This will re-initialize the data on the server where you
execute the command, retrieving the data from the
srv2.example.com replica</p>

<p>Add a new replication agreement: # ipa-replica-manage
connect srv2.example.com srv4.example.com</p>

<p>Remove an existing replication agreement: #
ipa-replica-manage disconnect srv1.example.com srv3.exam-
ple.com</p>

<p>Completely remove a replica: # ipa-replica-manage del
srv4.example.com</p>

<p>Using connect/disconnect you can manage the replication
topology.</p>

<p>List the replication IDs in use: # ipa-replica-manage
list-ruv srv1.example.com:389: 7 srv2.example.com:389: 4</p>

<p>Remove references to an orphaned and deleted master: #
ipa-replica-manage del --force --cleanup
master.example.com</p>

<p>WINSYNC Creating a Windows AD Synchronization agreement
is similar to creating an IPA replication agreement, there
are just a couple of extra steps.</p>

<p>A special user entry is created for the PassSync
service. The DN of this entry is
uid=passsync,cn=sysaccounts,cn=etc,&lt;basedn&gt;. You are
not required to use PassSync to use a Windows
synchronization agreement but setting a password for the
user is required.</p>

<p>The following examples use the AD administrator account
as the synchro- nization user. This is not mandatory but the
user must have read-access to the subtree.</p>

<p>1. Transfer the base64-encoded Windows AD CA Certificate
to your IPA Server</p>

<p>2. Remove any existing kerberos credentials #
kdestroy</p>

<p>3) Add the winsync replication agreement #
ipa-replica-manage connect --winsync --passsync=&lt;bind-
pwd_for_syncuser_that will_be_used_for_agreement&gt; --cac-
ert=/path/to/adscacert/WIN-CA.cer --binddn
&quot;cn=administra-
tor,cn=users,dc=ad,dc=example,dc=com&quot; --bindpw
&lt;ads_administra- tor_password&gt; -v
&lt;adserver.fqdn&gt;</p>

<p>You will be prompted to supply the Directory Manager s
password.</p>

<p>Create a winsync replication agreement:</p>

<p># ipa-replica-manage connect --winsync
--passsync=MySecret --cacert=/root/WIN-CA.cer --binddn
&quot;cn=administra-
tor,cn=users,dc=ad,dc=example,dc=com&quot; --bindpw MySecret
-v win- dows.ad.example.com</p>

<p>Remove a winsync replication agreement: #
ipa-replica-manage disconnect windows.ad.example.com</p>

<p>PASSSYNC PassSync is a Windows service that runs on AD
Domain Controllers to intercept password changes. It sends
these password changes to the IPA LDAP server over TLS.
These password changes bypass normal IPA password policy
settings and the password is not set to immediately expire.
This is because by the time IPA receives the password change
it has already been accepted by AD so it is too late to
reject it.</p>

<p>IPA maintains a list of DNs that are excempt from
password policy. A special user is added automatically when
a winsync replication agree- ment is created. The DN of this
user is added to the excemption list stored in
passSyncManagersDNs in the entry cn=ipa_pwd_extop,cn=plug-
ins,cn=config.</p>

<p>EXIT STATUS 0 if the command was successful</p>

<p>1 if an error occurred</p>

<p>FreeIPA Mar 14 2008 ipa-replica-manage(1)</p>
<hr>
</body>
</html>
