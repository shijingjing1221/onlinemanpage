<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:10:38 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>ENC2XS(1) Perl Programmers Reference Guide ENC2XS(1)</p>

<p>NAME enc2xs -- Perl Encode Module Generator</p>

<p>SYNOPSIS enc2xs -[options] enc2xs -M ModName mapfiles...
enc2xs -C</p>

<p>DESCRIPTION enc2xs builds a Perl extension for use by
Encode from either Unicode Character Mapping files (.ucm) or
Tcl Encoding Files (.enc). Besides being used internally
during the build process of the Encode module, you can use
enc2xs to add your own encoding to perl. No knowledge of XS
is necessary.</p>

<p>Quick Guide If you want to know as little about Perl as
possible but need to add a new encoding, just read this
chapter and forget the rest.</p>

<p>0. Have a .ucm file ready. You can get it from somewhere
or you can write your own from scratch or you can grab one
from the Encode distribution and customize it. For the UCM
format, see the next Chapter. In the example below, I ll
call my theoretical encoding myascii, defined in my.ucm.
&quot;$&quot; is a shell prompt.</p>

<p>$ ls -F my.ucm</p>

<p>1. Issue a command as follows;</p>

<p>$ enc2xs -M My my.ucm generating Makefile.PL generating
My.pm generating README generating Changes</p>

<p>Now take a look at your current directory. It should
look like this.</p>

<p>$ ls -F Makefile.PL My.pm my.ucm t/</p>

<p>The following files were created.</p>

<p>Makefile.PL - MakeMaker script My.pm - Encode submodule
t/My.t - test file</p>

<p>1.1. If you want *.ucm installed together with the
modules, do as follows;</p>

<p>$ mkdir Encode $ mv *.ucm Encode $ enc2xs -M My
Encode/*ucm</p>

<p>2. Edit the files generated. You dont have to if you
have no time AND no intention to give it to someone else.
But it is a good idea to edit the pod and to add more
tests.</p>

<p>3. Now issue a command all Perl Mongers love:</p>

<p>$ perl Makefile.PL Writing Makefile for Encode::My</p>

<p>4. Now all you have to do is make.</p>

<p>$ make cp My.pm blib/lib/Encode/My.pm
/usr/local/bin/perl /usr/local/bin/enc2xs -Q -O -o
encode_t.c -f encode_t.fnm Reading myascii (myascii) Writing
compiled form 128 bytes in string tables 384 bytes (75%)
saved spotting duplicates 1 bytes (0.775%) saved using
substrings .... chmod 644 blib/arch/auto/Encode/My/My.bs
$</p>

<p>The time it takes varies depending on how fast your
machine is and how large your encoding is. Unless you are
working on something big like euc-tw, it wont take too
long.</p>

<p>5. You can &quot;make install&quot; already but you
should test first.</p>

<p>$ make test PERL_DL_NONLAZY=1 /usr/local/bin/perl
-Iblib/arch -Iblib/lib -e &rsquo;use Test::Harness
qw(&amp;runtests $verbose); $verbose=0; runtests
@ARGV;&rsquo; t/*.t t/My....ok All tests successful.
Files=1, Tests=2, 0 wallclock secs ( 0.09 cusr + 0.01 csys =
0.09 CPU)</p>

<p>6. If you are content with the test result, just
&quot;make install&quot;</p>

<p>7. If you want to add your encoding to Encode s
demand-loading list (so you dont have to &quot;use
Encode::YourEncoding&quot;), run</p>

<p>enc2xs -C</p>

<p>to update Encode::ConfigLocal, a module that controls
local settings. After that, &quot;use Encode;&quot; is
enough to load your encodings on demand.</p>

<p>The Unicode Character Map Encode uses the Unicode
Character Map (UCM) format for source character mappings.
This format is used by IBMs ICU package and was adopted by
Nick Ing-Simmons for use with the Encode module. Since UCM
is more flexible than Tcl s Encoding Map and far more
user-friendly, this is the recommended format for Encode
now.</p>

<p>A UCM file looks like this.</p>

<p># # Comments # &lt;code_set_name&gt;
&quot;US-ascii&quot; # Required &lt;code_set_alias&gt;
&quot;ascii&quot; # Optional &lt;mb_cur_min&gt; 1 #
Required; usually 1 &lt;mb_cur_max&gt; 1 # Max. # of
bytes/char &lt;subchar&gt; F # Substitution char # CHARMAP
&lt;U0000&gt; 0 |0 # &lt;control&gt; &lt;U0001&gt; 1 |0 #
&lt;control&gt; &lt;U0002&gt; 2 |0 # &lt;control&gt; ....
&lt;U007C&gt; C |0 # VERTICAL LINE &lt;U007D&gt; D |0 #
RIGHT CURLY BRACKET &lt;U007E&gt; E |0 # TILDE &lt;U007F&gt;
F |0 # &lt;control&gt; END CHARMAP</p>

<p>&middot; Anything that follows &quot;#&quot; is treated
as a comment.</p>

<p>&middot; The header section continues until a line
containing the word CHARMAP. This section has a form of
&lt;keyword&gt; value, one pair per line. Strings used as
values must be quoted. Barewords are treated as numbers. xXX
represents a byte.</p>

<p>Most of the keywords are self-explanatory. subchar means
substitution character, not subcharacter. When you decode a
Unicode sequence to this encoding but no matching character
is found, the byte sequence defined here will be used. For
most cases, the value here is F; in ASCII, this is a
question mark.</p>

<p>&middot; CHARMAP starts the character map section. Each
line has a form as follows:</p>

<p>&lt;UXXXX&gt; .. |0 # comment ^ ^ ^ | | +- Fallback flag
| +-------- Encoded byte sequence +-------------- Unicode
Character ID in hex</p>

<p>The format is roughly the same as a header section
except for the fallback flag: | followed by 0..3. The
meaning of the possible values is as follows:</p>

<p>|0 Round trip safe. A character decoded to Unicode
encodes back to the same byte sequence. Most characters have
this flag.</p>

<p>|1 Fallback for unicode -&gt; encoding. When seen,
enc2xs adds this character for the encode map only.</p>

<p>|2 Skip sub-char mapping should there be no code
point.</p>

<p>|3 Fallback for encoding -&gt; unicode. When seen,
enc2xs adds this character for the decode map only.</p>

<p>&middot; And finally, END OF CHARMAP ends the
section.</p>

<p>When you are manually creating a UCM file, you should
copy ascii.ucm or an existing encoding which is close to
yours, rather than write your own from scratch.</p>

<p>When you do so, make sure you leave at least U0000 to
U0020 as is, unless your environment is EBCDIC.</p>

<p>CAVEAT: not all features in UCM are implemented. For
example, icu:state is not used. Because of that, you need to
write a perl module if you want to support algorithmical
encodings, notably the ISO-2022 series. Such modules include
Encode::JP::2022_JP, Encode::KR::2022_KR, and
Encode::TW::HZ.</p>

<p>Coping with duplicate mappings When you create a map,
you SHOULD make your mappings round-trip safe. That is,
&quot;encode(&rsquo;your-encoding&rsquo;,
decode(&rsquo;your-encoding&rsquo;, $data)) eq $data&quot;
stands for all characters that are marked as &quot;|0&quot;.
Here is how to make sure:</p>

<p>&middot; Sort your map in Unicode order.</p>

<p>&middot; When you have a duplicate entry, mark either
one with |1 or |3.</p>

<p>&middot; And make sure the |1 or |3 entry FOLLOWS the |0
entry.</p>

<p>Here is an example from big5-eten.</p>

<p>&lt;U2550&gt; |0 &lt;U2550&gt; |3</p>

<p>Internally Encoding -&gt; Unicode and Unicode -&gt;
Encoding Map looks like this;</p>

<p>E to U U to E --------------------------------------
=&gt; U2550 U2550 =&gt; =&gt; U2550</p>

<p>So it is round-trip safe for But if the line above is
upside down, here is what happens.</p>

<p>E to U U to E --------------------------------------
=&gt; U2550 U2550 =&gt; (=&gt; U2550 is now
overwritten!)</p>

<p>The Encode package comes with ucmlint, a crude but
sufficient utility to check the integrity of a UCM file.
Check under the Encode/bin directory for this.</p>

<p>When in doubt, you can use ucmsort, yet another utility
under Encode/bin directory.</p>

<p>Bookmarks &middot; ICU Home Page
&lt;http://www.icu-project.org/&gt;</p>

<p>&middot; ICU Character Mapping Tables
&lt;http://www.icu-project.org/charset/&gt;</p>

<p>&middot; ICU:Conversion Data
&lt;http://www.icu-project.org/userguide/conversion-data.html&gt;</p>

<p>SEE ALSO Encode, perlmod, perlpod</p>

<p>perl v5.10.1 2015-03-13 ENC2XS(1)</p>
<hr>
</body>
</html>
