<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:28:08 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>PMGENMAP(1) PMGENMAP(1)</p>

<p>NAME pmgenmap - generate C code to simplify handling of
performance metrics</p>

<p>SYNOPSIS pmgenmap [infile]</p>

<p>DESCRIPTION Given one or more lists of metric names in
infile or on standard input, pmgenmap generates C
declarations and cpp(1) macros suitable for use across the
Performance Metrics Programming Interface (PMAPI) on stan-
dard output.</p>

<p>The declarations produced by pmgenmap simplify the
coding for client applications using the PMAPI.</p>

<p>The input should consist of one or more lists of metric
names of the form</p>

<p>listname { metricname1 symbolname1 metricname2
symbolname2 ... }</p>

<p>which will generate C and cpp(1) declarations of the
form</p>

<p>char *listname[] = { #define symbolname1 0
&quot;metricname1&quot;, #define symbolname2 1
&quot;metricname2&quot;, ... };</p>

<p>The array declarations produced are suitable as
parameters to pmLookup- Name(3) and the #defined constants
may be used to index the vsets in the pmResult structure
returned by a pmFetch(3) call.</p>

<p>Obviously, listname must conform to the C identifier
naming rules, each symbolname must conform to the cpp(1)
macro naming rules, and each met- ricname is expected to be
a valid performance metrics name (see pmns(5) for more
details).</p>

<p>The input may include sh-style comment lines, i.e. with
a # as the first non-blank character of a line, and these
are translated on output to either single line or multi-line
C comments in the K&amp;R style. For example, the input:</p>

<p># leading block of multi-line comments # initialization
group foo { a.b.c ONE d.e.f.g TWO # embedded block of
multi-lines # comments and boring pad text xx.yy.zz THREE
}</p>

<p># trailing single line comment</p>

<p>Produces the output:</p>

<p>/* * leading block of multi-line comments *
initialization group */ char *foo[] = { #define ONE 0
&quot;a.b.c&quot;, #define TWO 1 &quot;d.e.f.g&quot;, /* *
embedded block of multi-lines * comments and boring pad text
*/ #define THREE 2 &quot;xx.yy.zz&quot;,</p>

<p>};</p>

<p>/* trailing single line comment */</p>

<p>EXAMPLE For brevity we have removed the error handling
code, and assumed the chosen metrics do not have multiple
values.</p>

<p>The input file</p>

<p>mystats { kernel.percpu.cpu.idle IDLE
kernel.percpu.cpu.sys SYS kernel.percpu.cpu.user USER
hinv.ncpu NCPU }</p>

<p>produces the following C code, suitable for
#include-ing</p>

<p>/* * Performance Metrics Name Space Map * Built by
pmgenmap from the file * mystats.metrics * on Wed Dec 28
19:44:17 EST 1994 * * Do not edit this file! */</p>

<p>char *mystats[] = { #define IDLE 0
&quot;kernel.percpu.cpu.idle&quot;, #define SYS 1
&quot;kernel.percpu.cpu.sys&quot;, #define USER 2
&quot;kernel.percpu.cpu.user&quot;, #define NCPU 3
&quot;hinv.ncpu&quot;,</p>

<p>};</p>

<p>Using the code generated by pmgenmap, we are now able to
easily obtain metrics from the Performance Metrics
Collection Subsystem (PMCS) as follows:</p>

<p>#define MAX_PMID 4</p>

<p>int trip = 0; int numpmid =
sizeof(mystats)/sizeof(mystats[0]); double duration;
pmResult *resp; pmResult *prev; pmID pmidlist[MAX_PMID];</p>

<p>pmNewContext(PM_CONTEXT_HOST, &quot;localhost&quot;);
pmLookupName(numpmid, mystats, pmidlist); pmFetch(numpmid,
pmidlist, &amp;resp);</p>

<p>printf(&quot;%d CPUs: %d usr %d sys %d idle0,
resp-&gt;vset[NCPU]-&gt;vlist[0].value.lval,
resp-&gt;vset[USER]-&gt;vlist[0].value.lval,
resp-&gt;vset[SYS]-&gt;vlist[0].value.lval,
resp-&gt;vset[IDLE]-&gt;vlist[0].value.lval);</p>

<p>Some calls to ensure portability have been removed from
the code above for the sake of clarity - the example above
should not be used as a template for programming. In
particular, the raw values of the metrics were used when
pmLookupDesc(3) should have been called to determine the
semantics of each metric.</p>

<p>More complete examples that demonstrate the use of
pmgenmap which may be used as a basis for program
development are included in the PCP demos, e.g.
$PCP_DEMOS_DIR/pmclient.</p>

<p>FILES $PCP_VAR_DIR/pmns/* default PMNS specification
files</p>

<p>PCP ENVIRONMENT Environment variables with the prefix
PCP_ are used to parameterize the file and directory names
used by PCP. On each installation, the file /etc/pcp.conf
contains the local values for these variables. The $PCP_CONF
variable may be used to specify an alternative configuration
file, as described in pcp.conf(5).</p>

<p>SEE ALSO cpp(1), PMAPI(3), pmFetch(3), pmLookupName(3),
pmNewContext(3), pcp.conf(5), pcp.env(5) and pmns(5).</p>

<p>Performance Co-Pilot PCP PMGENMAP(1)</p>
<hr>
</body>
</html>
