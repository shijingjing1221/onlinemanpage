<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:28:09 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>PMIECONF(5) PMIECONF(5)</p>

<p>PMIECONF(5) PMIECONF(5)</p>

<p>NAME pmieconf - generalized pmie rules and
customizations</p>

<p>DESCRIPTION The pmieconf file formats are used by the
pmieconf(1) tool as a way to generalize pmie(1) rule sets
such that they can be easily configured for different
systems and different environments. There are two com-
pletely different (although closely related) file formats
discussed here, namely pmieconf-rules and pmieconf-pmie.</p>

<p>The directory $PCP_VAR_DIR/config/pmieconf contains
information about all the default system pmie generalized
rules and variables, including default values for all
variables. These files are in the pmieconf- rules format.
Although new pmieconf-rules files can be added, the files in
this directory should never be changed. Instead, use the
pmieconf utility to change variable values in the pmie
configuration file.</p>

<p>The pmieconf-pmie format allows site specific
customizations of the rules contained in pmieconf-rules
files and their associated variables. The pmieconf-pmie
format is generated by pmieconf and should not be edited by
hand. This generated file is in the pmie format, with some
additional information held at the head of the file - thus,
the pmieconf-pmie format is a superset of the pmie file
format (extended to hold customizations to the generalized
rules, but also containing the actual performance rules for
pmie to evaluate) which can also be parsed by pmie (all
extensions are hidden within comments, and are thus mean-
ingless to pmie itself).</p>

<p>The file $PCP_VAR_DIR/config/pmieconf/config.pmie
contains local system settings for pmieconf configurable
variables. The variable settings in this file replace the
default values specified in $PCP_VAR_DIR/con-
fig/pmieconf/*/*.</p>

<p>PMIECONF-PMIE SYNTAX All rule customization lines in a
valid pmieconf-pmie specification are prefixed by // and are
located at the head of the file - this allows files
containing a pmieconf-pmie specification to be success-
fully parsed by pmie. A pmieconf-pmie must always have the
first line in the form:</p>

<p>// pmieconf-pmie version pmieconf_path</p>

<p>The version specifies which version of the pmieconf-pmie
syntax should be used to parse this file. Currently the only
supported version is 1. The pmieconf_path specifies the path
to the pmieconf-rules files which were used, by pmieconf, to
generate this file. This is discussed in the pmieconf(1) man
page (see the -r option).</p>

<p>The remainder of the specification consists of one line
entries for each of the modified variables. The syntax for
each line is:</p>

<p>// rule_version rule_name rule_variable = value</p>

<p>The rule_version and rule_name are used to identify the
rule with which to associate the customization. These are
followed by the rule_variable name (i.e. the variable of
rule rule_name which has been changed) for which the new
value is to be used.</p>

<p>A pmieconf-pmie specification must be terminated with
the end key- word. This is used by pmieconf to distinguish
where the customizations ends, and the actual pmie rule
component begins.</p>

<p>PMIECONF-PMIE EXAMPLE The following example is a valid
pmieconf-pmie format file, as gener- ated by pmieconf. In
order to make changes by hand which are preserved by
pmieconf, see the comments contained in the generated file
(below) as to where such changes should be made.</p>

<p>// pmieconf-pmie 1 $PCP_VAR_DIR/config/pmieconf // 1
memory.exhausted delta = &quot;4 minutes&quot; // 1
memory.exhausted enabled = yes // 1 memory.exhausted
pcplog_action = yes // end // // --- START GENERATED SECTION
(do not change this section) --- // generated by pmieconf
on: [DATESTAMP] //</p>

<p>// 1 memory.exhausted delta = 4 minutes; some_host ( (
avg_sample (swap.pagesout @0..9 ) ) &gt; 0 &amp;&amp; 30
%_sample swap.pagesout &gt;= 5 ) -&gt; shell 10 min
&quot;$PCP_BINADM_DIR/pmpost Severe demand for real
memory&quot; &quot; %vpgsout/s@%h&quot;;</p>

<p>// --- END GENERATED SECTION (changes below will be
preserved) ---</p>

<p>To see how this all works, you can generate this file as
follows:</p>

<p># cat - | pmieconf -f /tmp/pmieconf.out -r
$PCP_VAR_DIR/config/pmieconf/memory:$PCP_VAR_DIR/config/pmieconf/global
modify memory.exhausted delta &quot;4 minutes&quot; modify
memory.exhausted enabled yes modify memory.exhausted
pcplog_action yes ^D #</p>

<p>Then verify that the generated file is a valid pmie
configuration file using:</p>

<p># pmie -C /tmp/pmieconf.out</p>

<p>This parses the file, and then exits after reporting any
syntax errors. Now replace -C with -v (above), and watch
pmie do its work!</p>

<p>PMIECONF-RULES SYNTAX A pmieconf-rules specification
consists of a number of separate data objects which together
form a complete rule specification (note that a
specification may span multiple files and even multiple
subdirecto- ries). Each object must have an identifier
string and a data type, followed by an (optional) list of
attributes.</p>

<p>The generic specification of a pmieconf-rules object is
thus:</p>

<p>type identifier [ attribute = value ]* ;</p>

<p>The set of valid types is: &quot;rule&quot; (rule
definition), &quot;string&quot; (arbi- trary, double-quote
enclosed string), &quot;double&quot;, &quot;integer&quot;,
&quot;unsigned&quot;, &quot;percent&quot; (real number
between 0 and 100), &quot;hostlist&quot; (space separated
list of host names), &quot;instlist&quot; (space separated
list of metric instance names), and the four pmie action
types, namely &quot;print&quot;, &quot;shell&quot;,
&quot;alarm&quot;, and &quot;syslog&quot;.</p>

<p>Rule names use the . character to introduce the concept
of a rule group, e.g. &quot;memory.exhausted&quot;
associates this rule with the &quot;memory&quot; group.
pmieconf can operate at either the level of rule groups or
individual rules. The group name &quot;global&quot; is
reserved and may not be used with any rule.</p>

<p>Usually when an object is created it is associated with
the current rule. However, if an objects name is preceded by
the reserved group name &quot;global&quot;, then that object
is visible to all rules.</p>

<p>The set of valid attributes is: &quot;help&quot;
(descriptive text about this object), &quot;modify&quot;
(value is yes/no, flags whether pmieconf should allow
changes), &quot;enabled&quot; (value is yes/no, flags
whether this is on or off - only meaningful for rules and
actions), &quot;display&quot; (yes/no - flags whether
pmieconf should show this object), &quot;default&quot;
(value determined by type, and is the default value for this
object), and specific to objects of rule type are the
&quot;version&quot;, &quot;predicate&quot;, and
&quot;enumerate&quot; attributes. &quot;version&quot; and
&quot;predicate&quot; are fairly self explanatory
(&quot;predicate&quot; must equate to a valid pmie rule when
expanded), but &quot;enu- merate&quot; requires further
discussion.</p>

<p>The &quot;enumerate&quot; clause is useful when you wish
to generate multiple, similar pmie rules from a single
predicate. This is most useful for rule definitions wishing
to use the &quot;some_inst&quot; clause in the pmie lan-
guage across multiple hosts. For a rule to use these
together, it must be certain that the instance list is the
same on all of the monitored hosts. This is rarely true, so
the &quot;enumerate&quot; attribute allows us to generate
multiple rules, expanded over variables of either type
&quot;instlist&quot; or &quot;hostlist&quot;. These
variables make up the value for the &quot;enumerate&quot;
attribute - which is a space-separated list of
&quot;instlist&quot; or &quot;hostlist&quot; variable
names.</p>

<p>Objects can be incorporated into other object
definitions using the $identifier$ syntax. See the example
later for more insight into how this is useful.</p>

<p>When pmieconf is generating the pmie configuration file,
it looks at each enabled rule with N enabled actions (where
N &gt; 0) and expands the string:</p>

<p>// &quot;version&quot; identifier delta = $delta$;
&quot;predicate&quot; -&gt; $threshold$ $action1$ &amp; ...
&amp; $actionN$ ;</p>

<p>The delta, threshold, and action variables are defined
globally (using the &quot;global&quot; keyword) for all
rules, but can, of course, be changed at the level of an
individual rule or rule group.</p>

<p>PMIECONF-RULES EXAMPLE The following is an example of a
single pmieconf-rules specification, showing a number of
different aspects of the language discussed above. The
example defines a rule (&quot;memory.exhausted&quot;) and a
string (&quot;rule&quot;).</p>

<p>rule memory.exhausted default = &quot;$rule$&quot;
predicate = &quot;some_host ( ( avg_sample (swap.pagesout
$hosts$ @0..9 ) ) &gt; 0 &amp;&amp; $pct$ %_sample
swap.pagesout $hosts$ @0..9 &gt;= $threshold$ )&quot;
enabled = yes version = 1 help = &quot;The system is
swapping modified pages out of main memory to the swap
partitions, and has been doing this on at least pct of the
last 10 evaluations of this rule. There appears to be
insufficient main memory to meet the resident demands of the
current workload.&quot;;</p>

<p>string rule default = &quot;Severe demand for real
memory&quot; modify = no display = no;</p>

<p>Note that for the above rule to be complete,
&quot;threshold&quot; and &quot;pct&quot; would also need to
be defined - for the full expression of this rule, refer to
$PCP_VAR_DIR/config/pmieconf/memory/exhausted.</p>

<p>FILES $PCP_VAR_DIR/config/pmieconf/*/* generalized
system resource monitoring rules
$PCP_VAR_DIR/config/pmieconf/config.pmie default super-user
settings for system resource monitoring rules
$HOME/.pcp/pmie/config.pmie default user settings for system
resource monitoring rules</p>

<p>SEE ALSO pmie(1) and pmieconf(1).</p>

<p>Performance Co-Pilot PCP PMIECONF(5)</p>
<hr>
</body>
</html>
