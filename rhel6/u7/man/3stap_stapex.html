<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:35:56 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>STAPEX(3stap) STAPEX(3stap)</p>

<p>NAME stapex - systemtap examples</p>

<p>LANGUAGE BASICS These examples give a feel for basic
systemtap syntax and control structures.</p>

<p>global odds, evens</p>

<p>probe begin { # &quot;no&quot; and &quot;ne&quot; are
local integers for (i=0; i&lt;10; i++) { if (i % 2) odds
[no++] = i else evens [ne++] = i } delete odds[2] delete
evens[3] exit () }</p>

<p>probe end { foreach (x+ in odds) { printf
(&quot;odds[%d] = %d0, x, odds[x]) } foreach (x in evens-) {
printf (&quot;evens[%d] = %d0, x, evens[x]) } }</p>

<p>This prints:</p>

<p>odds[1] = 1 odds[3] = 5 odds[4] = 7 odds[5] = 9 evens[5]
= 8 evens[4] = 6 evens[2] = 2 evens[1] = 0</p>

<p>Note that all variables types are inferred, and that all
locals and globals are automatically initialized.</p>

<p>This script prints the primes between 0 and 49.</p>

<p>function isprime (x) { if (x &lt; 2) return 0 for (i=2;
i&lt;x; i++) { if (x % i == 0) return 0 if (i * i &gt; x)
break } return 1 } probe begin { for (i=0; i&lt;50; i++) if
(isprime (i)) printf(&quot;%d0, i) exit() }</p>

<p>This script demonstrates recursive functions.</p>

<p>function fibonacci(i) { if (i &lt; 1) error (&quot;bad
number&quot;) if (i == 1) return 1 if (i == 2) return 2
return fibonacci (i-1) + fibonacci (i-2) } probe begin {
printf (&quot;11th fibonacci number: %d0, fibonacci (11))
exit () }</p>

<p>Any larger number may exceed the MAXACTION or MAXNESTING
limits, and result in an error.</p>

<p>PROBING To trace entry and exit from a function, use a
pair of probes:</p>

<p>probe kernel.function(&quot;sys_mkdir&quot;) { println
(&quot;enter&quot;) } probe
kernel.function(&quot;sys_mkdir&quot;).return { println
(&quot;exit&quot;) }</p>

<p>To list the probeable functions in the kernel, use the
listings mode.</p>

<p>% stap -l
&rsquo;kernel.function(&quot;*&quot;)&rsquo;</p>

<p>To list the probeable functions and local variables in
the kernel, use another listings mode.</p>

<p>% stap -L
&rsquo;kernel.function(&quot;*&quot;)&rsquo;</p>

<p>MORE EXAMPLES The directory to find more examples can be
found in the stappaths (7) manual page, and online at
http://sourceware.org/systemtap/examples/</p>

<p>SEE ALSO stap(1) stapprobes(3stap) stappaths(7)</p>

<p>STAPEX(3stap)</p>
<hr>
</body>
</html>
