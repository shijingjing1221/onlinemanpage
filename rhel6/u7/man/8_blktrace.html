<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:06:06 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>BLKTRACE(8) BLKTRACE(8)</p>

<p>NAME blktrace - generate traces of the i/o traffic on
block devices</p>

<p>SYNOPSIS blktrace -d dev [ -r debugfs_path ] [ -o output
] [-k ] [ -w time ] [ -a action ] [ -A action_mask ] [ -v
]</p>

<p>DESCRIPTION blktrace is a block layer IO tracing
mechanism which provides detailed information about request
queue operations up to user space. There are three major
components: a kernel component, a utility to record the i/o
trace information for the kernel to user space, and
utilities to anal- yse and view the trace information. This
man page describes blktrace, which records the i/o event
trace information for a specific block device to a file.</p>

<p>The blktrace utility extracts event traces from the
kernel (via the relaying through the debug file system).
Some background details con- cerning the run-time behaviour
of blktrace will help to understand some of the more arcane
command line options:</p>

<p>- blktrace receives data from the kernel in buffers
passed up through the debug file system (relay). Each device
being traced has a file created in the mounted directory for
the debugfs, which defaults to /sys/kernel/debug -- this can
be overridden with the -r command line argument.</p>

<p>- blktrace defaults to collecting all events that can be
traced. To limit the events being captured, you can specify
one or more filter masks via the -a option.</p>

<p>Alternatively, one may specify the entire mask utilising
a hexadeci- mal value that is version-specific. (Requires
understanding of the internal representation of the filter
mask.)</p>

<p>- As noted above, the events are passed up via a series
of buffers stored into debugfs files. The size and number of
buffers can be specified via the -b and -n arguments
respectively.</p>

<p>- blktrace stores the extracted data into files stored
in the local directory. The format of the file names is (by
default) device.blk- trace.cpu, where device is the base
device name (e.g, if we are trac- ing /dev/sda, the base
device name would be sda); and cpu identifies a CPU for the
event stream.</p>

<p>The device portion of the event file name can be changed
via the -o option.</p>

<p>- blktrace may also be run concurrently with blkparse to
produce live output -- to do this specify -o - for
blktrace.</p>

<p>- The default behaviour for blktrace is to run forever
until explicitly killed by the user (via a control-C, or
sending SIGINT signal to the process via invocation the kill
(1) utility). Also you can specify a run-time duration for
blktrace via the -w option -- then blktrace will run for the
specified number of seconds, and then halt.</p>

<p>OPTIONS -A hex-mask --set-mask=hex-mask Set filter mask
to hex-mask (see below for masks)</p>

<p>-a mask --act-mask=mask Add mask to current filter (see
below for masks)</p>

<p>-b size --buffer-size=size Specifies buffer size for
event extraction (scaled by 1024). The default buffer size
is 512KiB.</p>

<p>-d dev --dev=dev Adds dev as a device to trace</p>

<p>-I file --input-devs=file Adds the devices found in file
as devices to trace</p>

<p>-n num-sub --num-sub-buffers=num-sub Specifies number of
buffers to use. blktrace defaults to 4 sub buffers.</p>

<p>-l --listen Run in network listen mode (blktrace
server)</p>

<p>-h hostname --host=hostname Run in network client mode,
connecting to the given host</p>

<p>-p number --port=number Network port to use (default
8462)</p>

<p>-s --no-sendfile Make the network client NOT use
sendfile() to transfer data</p>

<p>-o basename --output=basename Specifies base name for
input files. Default is device.blk- trace.cpu. Specifying -o
- runs in live mode with blkparse (writing data to standard
out).</p>

<p>-D dir --output-dir=dir Prepend file to output file
name(s)</p>

<p>-r rel-path --relay=rel-path Specifies debugfs mount
point</p>

<p>-v --version Outputs version</p>

<p>-V --version Outputs version</p>

<p>-w seconds --stopwatch=seconds Sets run time to the
number of seconds specified</p>

<p>FILTER MASKS The following masks may be passed with the
-a command line option, mul- tiple filters may be combined
via multiple -a command line options.</p>

<p>barrier: barrier attribute complete: completed by driver
fs: requests issue: issued to driver pc: packet command
events queue: queue operations read: read traces requeue:
requeue operations sync: synchronous attribute write: write
traces notify: trace messages drv_data: additional driver
specific trace</p>

<p>REQUEST TYPES blktrace distinguishes between two types
of block layer requests, file system and SCSI commands. The
former are dubbed fs requests, the latter pc requests. File
system requests are normal read/write operations, i.e. any
type of read or write from a specific disk location at a
given size. These requests typically originate from a user
process, but they may also be initiated by the vm flushing
dirty data to disk or the file system syncing a super or
journal block to disk. pc requests are SCSI commands.
blktrace sends the command data block as a payload so that
blkparse can decode it.</p>

<p>EXAMPLES To trace the i/o on the device /dev/hda and
parse the output to human readable form, use the following
command:</p>

<p>% blktrace -d /dev/sda -o - | blkparse -i -</p>

<p>This same behaviour can be achieve with the convenience
script btrace. The command</p>

<p>% btrace /dev/sda</p>

<p>has exactly the same effect as the previous command. See
btrace (8) for more information.</p>

<p>To trace the i/o on a device and save the output for
later processing with blkparse, use blktrace like this:</p>

<p>% blktrace /dev/sda /dev/sdb</p>

<p>This will trace i/o on the devices /dev/sda and /dev/sdb
and save the recorded information in the files sda and sdb
in the current directory, for the two different devices,
respectively. This trace information can later be parsed by
the blkparse utility:</p>

<p>% blkparse sda sdb</p>

<p>which will output the previously recorded tracing
information in human readable form to stdout. See blkparse
(1) for more information.</p>

<p>AUTHORS blktrace was written by Jens Axboe, Alan D.
Brunelle and Nathan Scott. This man page was created from
the blktrace documentation by Bas Zoetekouw.</p>

<p>REPORTING BUGS Report bugs to
&lt;linux-btrace@vger.kernel.org&gt;</p>

<p>COPYRIGHT Copyright &copy; 2006 Jens Axboe, Alan D.
Brunelle and Nathan Scott. This is free software. You may
redistribute copies of it under the terms of the GNU General
Public License &lt;http://www.gnu.org/licenses/gpl.html&gt;.
There is NO WARRANTY, to the extent permitted by law. This
manual page was created for Debian by Bas Zoetekouw. It was
derived from the documentation provided by the authors and
it may be used, distributed and modified under the terms of
the GNU General Pub- lic License, version 2. On Debian
systems, the text of the GNU General Public License can be
found in /usr/share/common-licenses/GPL-2.</p>

<p>SEE ALSO btrace (8), blkparse (1), verify_blkparse (1),
blkrawverify (1), btt (1)</p>

<p>blktrace git-20070306202522 March 6, 2007
BLKTRACE(8)</p>
<hr>
</body>
</html>
