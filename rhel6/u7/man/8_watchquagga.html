<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov  5 22:51:59 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>WATCHQUAGGA(8) WATCHQUAGGA(8)</p>

<p>NAME watchquagga - a program to monitor the status of
quagga daemons</p>

<p>SYNOPSIS watchquagga [option...] daemon... watchquagga
-h | -v</p>

<p>DESCRIPTION watchquagga is a watchdog program that
monitors the status of supplied quagga daemons and tries to
restart them in case they become unrespon- sive or shut
down.</p>

<p>To determine whether a daemon is running, it tries to
connect to the daemons VTY UNIX stream socket, and send echo
commands to ensure the daemon responds. When the daemon
crashes, EOF is received from the socket, so that
watchquagga can react immediately.</p>

<p>This program can run in one of the following 5
modes:</p>

<p>Mode 0: monitor In this mode, the program serves as a
monitor and reports status changes.</p>

<p>Example usage: watchquagga -d zebra ospfd bgpd</p>

<p>Mode 1: global restart In this mode, whenever a daemon
hangs or crashes, the given com- mand is used to restart all
watched daemons.</p>

<p>Example usage: watchquagga -dz -R /sbin/service zebra
restart; /sbin/service ospfd restart zebra ospfd</p>

<p>Mode 2: individual daemon restart In this mode, whenever
a single daemon hangs or crashes, the given command is used
to restart this daemon only.</p>

<p>Example usage: watchquagga -dz -r /sbin/service %s
restart zebra ospfd bgpd</p>

<p>Mode 3: phased zebra restart In this mode, whenever a
single daemon hangs or crashes, the given command is used to
restart this daemon only. The only exception is the zebra
daemon; in this case, the following steps are taken: (1) all
other daemons are stopped, (2) zebra is restarted, and (3)
other daemons are started again.</p>

<p>Example usage: watchquagga -adz -r /sbin/service %s
restart -s /sbin/service %s start -k /sbin/service %s stop
zebra ospfd bgpd</p>

<p>Mode 4: phased global restart for any failure In this
mode, whenever a single daemon hangs or crashes, the
following steps are taken: (1) all other daemons are
stopped, (2) zebra is restarted, and (3) other daemons are
started again.</p>

<p>Example usage: watchquagga -Adz -r /sbin/service %s
restart -s /sbin/service %s start -k /sbin/service %s stop
zebra ospfd bgpd</p>

<p>Important: It is believed that mode 2 (individual daemon
restart) is not safe, and mode 3 (phased zebra restart) may
not be safe with certain routing daemons.</p>

<p>In order to avoid restarting the daemons in quick
succession, you can supply the -m and -M options to set the
minimum and maximum delay between the restart commands. The
minimum restart delay is recalcu- lated each time a restart
is attempted. If the time since the last restart attempt
exceeds twice the value of -M, the restart delay is set to
the value of -m, otherwise the interval is doubled (but
capped at the value of -M).</p>

<p>OPTIONS -d, --daemon Run in daemon mode. When supplied,
error messages are sent to Syslog instead of standard output
(stdout).</p>

<p>-S directory, --statedir directory Set the VTY socket
directory (the default value is
&quot;/var/run/quagga&quot;).</p>

<p>-e, --no-echo Do not ping the daemons to test whether
they respond. This option is necessary if one or more
daemons do not support the echo command.</p>

<p>-l level, --loglevel level Set the logging level (the
default value is &quot;6&quot;). The value should range from
0 (LOG_EMERG) to 7 (LOG_DEBUG), but higher number can be
supplied if extra debugging messages are required.</p>

<p>-m number, --min-restart-interval number Set the minimum
number of seconds to wait between invocations of the daemon
restart commands (the default value is &quot;60&quot;).</p>

<p>-M number, --max-restart-interval number Set the maximum
number of seconds to wait between invocations of the daemon
restart commands (the default value is &quot;600&quot;).</p>

<p>-i number, --interval number Set the status polling
interval in seconds (the default value is
&quot;5&quot;).</p>

<p>-t number, --timeout number Set the unresponsiveness
timeout in seconds (the default value is
&quot;10&quot;).</p>

<p>-T number, --restart-timeout number Set the restart
(kill) timeout in seconds (the default value is
&quot;20&quot;). If any background jobs are still running
after this period has elapsed, they will be killed.</p>

<p>-r command, --restart command Supply a Bourne shell
command to restart a single daemon. The command string
should contain the %s placeholder to be substi- tuted with
the daemon name.</p>

<p>Note that -r and -R options are not compatible.</p>

<p>-s command, --start-command command Supply a Bourne
shell command to start a single daemon. The com- mand string
should contain the %s placeholder to be substi- tuted with
the daemon name.</p>

<p>-k command, --kill-command command Supply a Bourne shell
command to stop a single daemon. The com- mand string should
contain the %s placeholder to be substi- tuted with the
daemon name.</p>

<p>-R, --restart-all When one or more daemons are shut
down, try to restart them using the Bourne shell command
supplied on the command line.</p>

<p>Note that -r and -R options are not compatible.</p>

<p>-z, --unresponsive-restart When a daemon is in an
unresponsive state, treat it as being shut down for the
restart purposes.</p>

<p>-a, --all-restart When zebra hangs or crashes, restart
all daemons taking the fol- lowing steps: (1) stop all other
daemons, (2) restart zebra, and (3) start other daemons
again.</p>

<p>Note that this option also requires -r, -s, and -k
options to be specified.</p>

<p>-A, --always-all-restart When any daemon (i.e., not just
zebra) hangs or crashes, restart all daemons taking the
following steps: (1) stop all other dae- mons, (2) restart
zebra, and (3) start other daemons again.</p>

<p>Note that this option also requires -r, -s, and -k
options to be specified.</p>

<p>-p filename, --pid-file filename Set the process
identifier filename (the default value is
&quot;/var/run/quagga/watchquagga.pid&quot;).</p>

<p>-b string, --blank-string string When the supplied
string is found in any of the command line option arguments
(i.e., -r, -s, -k, or -R), replace it with a space.</p>

<p>This is an ugly hack to circumvent problems with passing
the command line arguments containing embedded spaces.</p>

<p>-v, --version Display the version information and
exit.</p>

<p>-h, --help Display the usage information and exit.</p>

<p>SEE ALSO bgpd(8), ripd(8), ripngd(8), ospfd(8),
ospf6d(8), isisd(8).</p>

<p>See the project homepage at
&lt;http://www.quagga.net/&gt;.</p>

<p>AUTHORS Copyright 2004 Andrew J. Schorr</p>

<p>July 2010 WATCHQUAGGA(8)</p>
<hr>
</body>
</html>
