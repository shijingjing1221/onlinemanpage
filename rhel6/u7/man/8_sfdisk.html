<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:33:52 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>SFDISK(8) Linux Programmer s Manual SFDISK(8)</p>

<p>NAME sfdisk - Partition table manipulator for Linux</p>

<p>SYNOPSIS sfdisk [options] device sfdisk -s
[partition]</p>

<p>DESCRIPTION sfdisk has four (main) uses: list the size
of a partition, list the partitions on a device, check the
partitions on a device, and - very dangerous - repartition a
device.</p>

<p>sfdisk doesnt understand GUID Partition Table (GPT) and
it is not designed for large partitions. In particular case
use more advanced GNU parted(8).</p>

<p>Note that sfdisk does not align partitions to block
device I/O limits. This functionality is provided by
fdisk(8).</p>

<p>List Sizes sfdisk -s partition gives the size of
partition in blocks. This may be useful in connection with
programs like mkswap(8) or so. Here partition is usually
something like /dev/hda1 or /dev/sdb12, but may also be an
entire disk, like /dev/xda. % sfdisk -s /dev/hda9 81599 % If
the partition argument is omitted, sfdisk will list the
sizes of all block devices, and the total: % sfdisk -s
/dev/hda: 208896 /dev/hdb: 1025136 /dev/hdc: 1031063
/dev/sda: 8877895 /dev/sdb: 1758927 total: 12901917 blocks
%</p>

<p>List Partitions The second type of invocation: sfdisk -l
[options] device will list the partitions on this device. If
the device argument is omitted, the par- titions on all hard
block devices are listed. % sfdisk -l /dev/hdc</p>

<p>Disk /dev/hdc: 16 heads, 63 sectors, 2045 cylinders
Units = cylinders of 516096 bytes, blocks of 1024 bytes,
counting from 0</p>

<p>Device Boot Start End #cyls #blocks Id System /dev/hdc1
0+ 406 407- 205096+ 83 Linux native /dev/hdc2 407 813 407
205128 83 Linux native /dev/hdc3 814 2044 1231 620424 83
Linux native /dev/hdc4 0 - 0 0 0 Empty % The trailing - and
+ signs indicate that rounding has taken place, and that the
actual value is slightly less (more). To see the exact val-
ues, ask for a listing with sectors as unit.</p>

<p>Check partitions The third type of invocation: sfdisk -V
device will apply various con- sistency checks to the
partition tables on device. It prints OK or complains. The
-V option can be used together with -l. In a shell script
one might use sfdisk -V -q device which only returns a
status.</p>

<p>Create partitions The fourth type of invocation: sfdisk
device will cause sfdisk to read the specification for the
desired partitioning of device from its stan- dard input,
and then to change the partition tables on that block
device. Thus, it is possible to use sfdisk from a shell
script. When sfdisk determines that its standard input is a
terminal, it will be conversational; otherwise it will abort
on any error.</p>

<p>BE EXTREMELY CAREFUL - ONE TYPING MISTAKE AND ALL YOUR
DATA IS LOST</p>

<p>As a precaution, one can save the sectors changed by
sfdisk: % sfdisk /dev/hdd -O hdd-partition-sectors.save ...
%</p>

<p>Then, if you discover that you did something stupid
before anything else has been written to block device, it
may be possible to recover the old situation with % sfdisk
/dev/hdd -I hdd-partition-sectors.save %</p>

<p>(This is not the same as saving the old partition table:
a readable version of the old partition table can be saved
using the -d option. However, if you create logical
partitions, the sectors describing them are located
somewhere on block device possibly on sectors that were not
part of the partition table before. Thus, the information
the -O option saves is not a binary version of the output of
-d.)</p>

<p>There are many options.</p>

<p>OPTIONS -v or --version Print version number of sfdisk
and exit immediately.</p>

<p>-? or --help Print a usage message and exit
immediately.</p>

<p>-T or --list-types Print the recognized types (system
Ids).</p>

<p>-s or --show-size List the size of a partition.</p>

<p>-g or --show-geometry List the kernels idea of the
geometry of the indicated block device(s)</p>

<p>-G or --show-pt-geometry List the geometry of the
indicated block devices guessed by looking at the partition
table.</p>

<p>-l or --list List the partitions of a device.</p>

<p>-d Dump the partitions of a device in a format useful as
input to sfdisk. For example, % sfdisk -d /dev/hda &gt;
hda.out % sfdisk /dev/hda &lt; hda.out will correct the bad
last extended partition that the OS/2 fdisk creates.</p>

<p>-V or --verify Test whether partitions seem correct.
(See above.)</p>

<p>-i or --increment Number cylinders etc. starting from 1
instead of 0.</p>

<p>-N number Change only the single partition indicated.
For example: % sfdisk /dev/hdb -N5 ,,,* % will make the
fifth partition on /dev/hdb bootable (active) and change
nothing else. (Probably this fifth partition is called
/dev/hdb5, but you are free to call it something else, like
/my_equipment/disks/2/5 or so).</p>

<p>-A number Make the indicated partition(s) active, and
all others inactive.</p>

<p>-c or --id number [Id] If no Id argument given: print
the partition Id of the indicated partition. If an Id
argument is present: change the type (Id) of the indicated
partition to the given value. This option has the two very
long forms --print-id and --change-id. For example: % sfdisk
--print-id /dev/hdb 5 6 % sfdisk --change-id /dev/hdb 5 83
OK first reports that /dev/hdb5 has Id 6, and then changes
that into 83.</p>

<p>-uS or -uB or -uC or -uM Accept or report in units of
sectors (blocks, cylinders, megabytes, respectively). The
default is cylinders, at least when the geometry is
known.</p>

<p>-x or --show-extended Also list non-primary extended
partitions on output, and expect descriptors for them on
input.</p>

<p>-C cylinders Specify the number of cylinders, possibly
overriding what the kernel thinks.</p>

<p>-H heads Specify the number of heads, possibly
overriding what the kernel thinks.</p>

<p>-S sectors Specify the number of sectors, possibly
overriding what the ker- nel thinks.</p>

<p>-f or --force Do what I say, even if it is stupid.</p>

<p>-q or --quiet Suppress warning messages.</p>

<p>-L or --Linux Do not complain about things irrelevant
for Linux.</p>

<p>-D or --DOS For DOS-compatibility: waste a little space.
(More precisely: if a partition cannot contain sector 0,
e.g. because that is the MBR of the device, or contains the
partition table of an extended partition, then sfdisk would
make it start the next sector. However, when this option is
given it skips to the start of the next track, wasting for
example 33 sectors (in case of 34 sectors/track), just like
certain versions of DOS do.) Certain Disk Managers and boot
loaders (such as OSBS, but not LILO or the OS/2 Boot
Manager) also live in this empty space, so maybe you want
this option if you use one.</p>

<p>-E or --DOS-extended Take the starting sector numbers of
&quot;inner&quot; extended partitions to be relative to the
starting cylinder boundary of the outer one, (like some
versions of DOS do) rather than to the starting sector (like
Linux does). (The fact that there is a difference here means
that one should always let extended partitions start at
cylinder boundaries if DOS and Linux should interpret the
partition table in the same way. Of course one can only know
where cylinder boundaries are when one knows what geometry
DOS will use for this block device.)</p>

<p>--IBM or --leave-last Certain IBM diagnostic programs
assume that they can use the last cylinder on a block device
for disk-testing purposes. If you think you might ever run
such programs, use this option to tell sfdisk that it should
not allocate the last cylinder. Sometimes the last cylinder
contains a bad sector table.</p>

<p>-n Go through all the motions, but do not actually write
to block device.</p>

<p>-R Only execute the BLKRRPART ioctl (to make the kernel
re-read the partition table). This can be useful for
checking in advance that the final BLKRRPART will be
successful, and also when you changed the partition table by
hand (e.g., using dd from a backup). If the kernel complains
(device busy for revalidation (usage = 2) ) then something
still uses the device, and you still have to unmount some
file system, or say swapoff to some swap partition.</p>

<p>--no-reread When starting a repartitioning of a block
device, sfdisk checks that this device is not mounted, or in
use as a swap device, and refuses to continue if it is. This
option suppresses the test. (On the other hand, the -f
option would force sfdisk to continue even when this test
fails.)</p>

<p>-O file Just before writing the new partition, output
the sectors that are going to be overwritten to file (where
hopefully file resides on another block device, or on a
floppy).</p>

<p>-I file After destroying your filesystems with an
unfortunate sfdisk command, you would have been able to
restore the old situation if only you had preserved it using
the -O flag.</p>

<p>THEORY Block 0 of a block device (the Master Boot
Record) contains among other things four partition
descriptors. The partitions described here are called
primary partitions.</p>

<p>A partition descriptor has 6 fields: struct partition {
unsigned char bootable; /* 0 or 0x80 */ hsc begin_hsc;
unsigned char id; hsc end_hsc; unsigned int starting_sector;
unsigned int nr_of_sectors; }</p>

<p>The two hsc fields indicate head, sector and cylinder of
the begin and the end of the partition. Since each hsc field
only takes 3 bytes, only 24 bits are available, which does
not suffice for big block devices (say &gt; 8GB). In fact,
due to the wasteful representation (that uses a byte for the
number of heads, which is typically 16), problems already
start with 0.5GB. However Linux does not use these fields,
and prob- lems can arise only at boot time, before Linux has
been started. For more details, see the lilo
documentation.</p>

<p>Each partition has a type, its Id , and if this type is
5 or f ( extended partition) the starting sector of the
partition again con- tains 4 partition descriptors. MSDOS
only uses the first two of these: the first one an actual
data partition, and the second one again an extended
partition (or empty). In this way one gets a chain of
extended partitions. Other operating systems have slightly
different conventions. Linux also accepts type 85 as
equivalent to 5 and f - this can be useful if one wants to
have extended partitions under Linux past the 1024 cylinder
boundary, without DOS FDISK hanging. (If there is no good
reason, you should just use 5, which is understood by other
systems.)</p>

<p>Partitions that are not primary or extended are called
logical. Often, one cannot boot from logical partitions
(because the process of finding them is more involved than
just looking at the MBR). Note that of an extended partition
only the Id and the start are used. There are vari- ous
conventions about what to write in the other fields. One
should not try to use extended partitions for data storage
or swap.</p>

<p>INPUT FORMAT sfdisk reads lines of the form
&lt;start&gt; &lt;size&gt; &lt;id&gt; &lt;bootable&gt;
&lt;c,h,s&gt; &lt;c,h,s&gt; where each line fills one
partition descriptor.</p>

<p>Fields are separated by whitespace, or comma or
semicolon possibly fol- lowed by whitespace; initial and
trailing whitespace is ignored. Num- bers can be octal,
decimal or hexadecimal, decimal is default. When a field is
absent or empty, a default value is used.</p>

<p>The &lt;c,h,s&gt; parts can (and probably should) be
omitted - sfdisk com- putes them from &lt;start&gt; and
&lt;size&gt; and the block device geometry as given by the
kernel or specified using the -H, -S, -C flags.</p>

<p>Bootable is specified as [*|-], with as default
not-bootable. (The value of this field is irrelevant for
Linux - when Linux runs it has been booted already - but
might play a role for certain boot loaders and for other
operating systems. For example, when there are several
primary DOS partitions, DOS assigns C: to the first among
these that is bootable.)</p>

<p>Id is given in hex, without the 0x prefix, or is
[E|S|L|X], where L (LINUX_NATIVE (83)) is the default, S is
LINUX_SWAP (82), E is EXTENDED_PARTITION (5), and X is
LINUX_EXTENDED (85).</p>

<p>The default value of start is the first nonassigned
sector/cylinder/...</p>

<p>The default value of size is as much as possible (until
next partition or end-of-device).</p>

<p>However, for the four partitions inside an extended
partition, the defaults are: Linux partition, Extended
partition, Empty, Empty.</p>

<p>But when the -N option (change a single partition only)
is given, the default for each field is its previous
value.</p>

<p>EXAMPLE The command sfdisk /dev/hdc &lt;&lt; EOF 0,407
,407 ; ; EOF will partition /dev/hdc just as indicated
above.</p>

<p>The command sfdisk /dev/hdb &lt;&lt; EOF ,3,L ,60,L
,19,S ,,E ,130,L ,130,L ,130,L ,,L EOF will partition
/dev/hdb into two Linux partitions of 3 and 60 cylin- ders,
a swap space of 19 cylinders, and an extended partition
covering the rest. Inside the extended partition there are
four Linux logical partitions, three of 130 cylinders and
one covering the rest.</p>

<p>With the -x option, the number of input lines must be a
multiple of 4: you have to list the two empty partitions
that you never want using two blank lines. Without the -x
option, you give one line for the parti- tions inside a
extended partition, instead of four, and terminate with
end-of-file (^D). (And sfdisk will assume that your input
line repre- sents the first of four, that the second one is
extended, and the 3rd and 4th are empty.)</p>

<p>DOS 6.x WARNING The DOS 6.x FORMAT command looks for
some information in the first sec- tor of the data area of
the partition, and treats this information as more reliable
than the information in the partition table. DOS FORMAT
expects DOS FDISK to clear the first 512 bytes of the data
area of a partition whenever a size change occurs. DOS
FORMAT will look at this extra information even if the /U
flag is given -- we consider this a bug in DOS FORMAT and
DOS FDISK.</p>

<p>The bottom line is that if you use sfdisk to change the
size of a DOS partition table entry, then you must also use
dd to zero the first 512 bytes of that partition before
using DOS FORMAT to format the parti- tion. For example, if
you were using sfdisk to make a DOS partition table entry
for /dev/hda1, then (after exiting sfdisk and rebooting
Linux so that the partition table information is valid) you
would use the command &quot;dd if=/dev/zero of=/dev/hda1
bs=512 count=1&quot; to zero the first 512 bytes of the
partition. BE EXTREMELY CAREFUL if you use the dd command,
since a small typo can make all of the data on your block
device useless.</p>

<p>For best results, you should always use an OS-specific
partition table program. For example, you should make DOS
partitions with the DOS FDISK program and Linux partitions
with the Linux sfdisk program.</p>

<p>DRDOS WARNINGS Stephen Tweedie reported (930515): Most
reports of superblock corrup- tion turn out to be due to bad
partitioning, with one filesystem over- running the start of
the next and corrupting its superblock. I have even had this
problem with the supposedly-reliable DRDOS. This was quite
possibly due to DRDOS-6.0s FDISK command. Unless I created a
blank track or cylinder between the DRDOS partition and the
immediately following one, DRDOS would happily stamp all
over the start of the next partition. Mind you, as long as I
keep a little free device space after any DRDOS partition, I
dont have any other problems with the two coexisting on the
one drive.</p>

<p>A. V. Le Blanc writes in README.efdisk: Dr. DOS 5.0 and
6.0 has been reported to have problems cooperating with
Linux, and with this version of efdisk in particular. This
efdisk sets the system type to hexadeci- mal 81. Dr. DOS
seems to confuse this with hexadecimal 1, a DOS code. If you
use Dr. DOS, use the efdisk command t to change the system
code of any Linux partitions to some number less than
hexadecimal 80; I suggest 41 and 42 for the moment.</p>

<p>A. V. Le Blanc writes in his README.fdisk: DR-DOS 5.0
and 6.0 are reported to have difficulties with partition ID
codes of 80 or more. The Linux fdisk used to set the system
type of new partitions to hex- adecimal 81. DR-DOS seems to
confuse this with hexadecimal 1, a DOS code. The values 82
for swap and 83 for file systems should not cause problems
with DR-DOS. If they do, you may use the fdisk command t to
change the system code of any Linux partitions to some
number less than hexadecimal 80; I suggest 42 and 43 for the
moment.</p>

<p>In fact, it seems that only 4 bits are significant for
the DRDOS FDISK, so that for example 11 and 21 are listed as
DOS 2.0. However, DRDOS itself seems to use the full byte. I
have not been able to reproduce any corruption with DRDOS or
its fdisk.</p>

<p>BUGS There are too many options.</p>

<p>There is no support for non-DOS partition types.</p>

<p>SEE ALSO cfdisk(8), fdisk(8), mkfs(8), parted(8),
partprobe(8), kpartx(8)</p>

<p>AVAILABILITY The sfdisk command is part of the
util-linux-ng package and is avail- able from
ftp://ftp.kernel.org/pub/linux/utils/util-linux-ng/.</p>

<p>Linux 1 September 1995 SFDISK(8)</p>
<hr>
</body>
</html>
