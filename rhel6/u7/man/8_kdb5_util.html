<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:20:29 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>KDB5_UTIL(8) KDB5_UTIL(8)</p>

<p>NAME kdb5_util - Kerberos database maintenance
utility</p>

<p>SYNOPSIS kdb5_util [-r realm] [-d dbname] [-k mkeytype]
[-M mkeyname] [-kv mkeyVNO] [-sf stashfilename] [-m] command
[command_options]</p>

<p>DESCRIPTION kdb5_util allows an administrator to perform
low-level maintenance pro- cedures on the Kerberos and KADM5
database. Databases can be created, destroyed, and dumped to
and loaded from ASCII files. Additionally, kdb5_util can
create a Kerberos master key stash file. kdb5_util sub-
sumes the functionality of and makes obsolete the previous
database maintenance programs kdb5_create, kdb5_edit,
kdb5_destroy, and kdb5_stash.</p>

<p>When kdb5_util is run, it attempts to acquire the master
key and open the database. However, execution continues
regardless of whether or not kdb5_util successfully opens
the database, because the database may not exist yet or the
stash file may be corrupt.</p>

<p>Note that some KDB plugins may not support all kdb5_util
commands.</p>

<p>COMMAND-LINE OPTIONS -r realm specifies the Kerberos
realm of the database; by default the realm returned by
krb5_default_local_realm(3) is used.</p>

<p>-d dbname specifies the name under which the principal
database is stored; by default the database is that listed
in kdc.conf(5). The KADM5 policy database and lock file are
also derived from this value.</p>

<p>-k mkeytype specifies the key type of the master key in
the database; the default is that given in kdc.conf.</p>

<p>-kv mkeyVNO Specifies the version number of the master
key in the database; the default is 1. Note that 0 is not
allowed.</p>

<p>-M mkeyname principal name for the master key in the
database; the default is that given in kdc.conf.</p>

<p>-m specifies that the master database password should be
read from the TTY rather than fetched from a file on
disk.</p>

<p>-sf stash_file specifies the stash file of the master
database password.</p>

<p>-P password specifies the master database password. This
option is not rec- ommended.</p>

<p>COMMANDS create [-s] Creates a new database. If the -s
option is specified, the stash file is also created. This
command fails if the database already exists. If the command
is successful, the database is opened just as if it had
already existed when the program was first run.</p>

<p>destroy [-f] Destroys the database, first overwriting
the disk sectors and then unlinking the files, after
prompting the user for confirma- tion. With the -f argument,
does not prompt the user.</p>

<p>stash [-f keyfile] Stores the master principal s keys in
a stash file. The -f argument can be used to override the
keyfile specified at startup.</p>

<p>dump [-old|-b6|-b7|-ov|-r13] [-verbose] [-mkey_convert]
[-new_mkey_file mkey_file] [-rev] [-recurse] [filename
[principals...]] Dumps the current Kerberos and KADM5
database into an ASCII file. By default, the database is
dumped in current format, &quot;kdb5_util load_dump version
6&quot;. If filename is not specified, or is the string
&quot;-&quot;, the dump is sent to standard output.
Options:</p>

<p>-old causes the dump to be in the Kerberos 5 Beta 5 and
ear- lier dump format (&quot;kdb5_edit load_dump version
2.0&quot;).</p>

<p>-b6 causes the dump to be in the Kerberos 5 Beta 6
format (&quot;kdb5_edit load_dump version 3.0&quot;).</p>

<p>-b7 causes the dump to be in the Kerberos 5 Beta 7
format (&quot;kdb5_util load_dump version 4&quot;). This was
the dump format produced on releases prior to 1.2.2.</p>

<p>-ov causes the dump to be in ovsec_adm_export
format.</p>

<p>-r13 causes the dump to be in the Kerberos 5 1.3 format
(&quot;kdb5_util load_dump version 5&quot;). This was the
dump format produced on releases prior to 1.8.</p>

<p>-verbose causes the name of each principal and policy to
be printed as it is dumped.</p>

<p>-mkey_convert prompts for a new master key. This new
master key will be used to re-encrypt the key data in the
dumpfile. The key data in the database will not be
changed.</p>

<p>-new_mkey_file mkey_file the filename of a stash file.
The master key in this stash file will be used to re-encrypt
the key data in the dumpfile. The key data in the database
will not be changed.</p>

<p>-rev dumps in reverse order. This may recover principals
that do not dump normally, in cases where database
corruption has occurred.</p>

<p>-recurse causes the dump to walk the database
recursively (btree only). This may recover principals that
do not dump nor- mally, in cases where database corruption
has occurred. In cases of such corruption, this option will
probably retrieve more principals than the -rev option
will.</p>

<p>load -old|-b6|-b7|-ov|-r13] [-hash] [-verbose] [-update]
filename dbname Loads a database dump from the named file
into the named database. Unless the -old or -b6 option is
given, the format of the dump file is detected automatically
and handled as appropri- ate. Unless the -update option is
given, load creates a new database containing only the
principals in the dump file, over- writing the contents of
any previously existing database. Note that when using the
LDAP KDB plugin the -update must be given. Options:</p>

<p>-old requires the database to be in the Kerberos 5 Beta
5 and earlier format (&quot;kdb5_edit load_dump version
2.0&quot;).</p>

<p>-b6 requires the database to be in the Kerberos 5 Beta 6
for- mat (&quot;kdb5_edit load_dump version 3.0&quot;).</p>

<p>-b7 requires the database to be in the Kerberos 5 Beta 7
for- mat (&quot;kdb5_util load_dump version 4&quot;).</p>

<p>-ov requires the database to be in ovsec_adm_import
format. Must be used with the -update option.</p>

<p>-hash requires the database to be stored as a hash. If
this option is not specified, the database will be stored as
a btree. This option is not recommended, as databases stored
in hash format are known to corrupt data and lose
principals.</p>

<p>-verbose causes the name of each principal and policy to
be printed as it is dumped.</p>

<p>-update records from the dump file are added to or
updated in the existing database; otherwise, a new database
is created containing only what is in the dump file and the
old one destroyed upon successful completion.</p>

<p>dbname is required and overrides the value specified on
the com- mand line or the default.</p>

<p>ark Adds a random key.</p>

<p>add_mkey [-e etype] [-s] Adds a new master key to the
K/M (master key) principal. Exist- ing master keys will
remain. The -e etype option allows speci- fication of the
enctype of the new master key. The -s option stashes the new
master key in a local stash file which will be created if it
doesnt already exist.</p>

<p>use_mkey mkeyVNO [time] Sets the activation time of the
master key specified by mkeyVNO. Once a master key is active
(i.e. its activation time has been reached) it will then be
used to encrypt principal keys either when the principal
keys change, are newly created or when the
update_princ_encryption command is run. If the time argument
is provided then that will be the activation time otherwise
the current time is used by default. The format of the
optional time argument is that specified in the Time Formats
section of the kadmin man page.</p>

<p>list_mkeys List all master keys from most recent to
earliest in K/M princi- pal. The output will show the KVNO,
enctype and salt for each mkey similar to kadmin getprinc
output. A * following an mkey denotes the currently active
master key.</p>

<p>purge_mkeys [-f] [-n] [-v] Delete master keys from the
K/M principal that are not used to protect any principals.
This command can be used to remove old master keys from a
K/M principal once all principal keys are protected by a
newer master key.</p>

<p>-f does not prompt user.</p>

<p>-n do a dry run, shows master keys that would be purged,
does not actually purge any keys.</p>

<p>-v verbose output.</p>

<p>update_princ_encryption [-f] [-n] [-v] [princ-pattern]
Update all principal records (or only those matching the
princ-pattern glob pattern) to re-encrypt the key data using
the active database master key, if they are encrypted using
older versions, and give a count at the end of the number of
princi- pals updated. If the -f option is not given, ask for
confirma- tion before starting to make changes. The -v
option causes each principal processed (each one matching
the pattern) to be listed, and an indication given as to
whether it needed updating or not. The -n option causes the
actions not to be taken, only the normal or verbose status
messages displayed; this implies -f since no database
changes will be performed and thus theres little reason to
seek confirmation.</p>

<p>SEE ALSO kadmin(8)</p>

<p>KDB5_UTIL(8)</p>
<hr>
</body>
</html>
