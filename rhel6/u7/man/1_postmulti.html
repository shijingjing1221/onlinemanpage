<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:28:41 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>POSTMULTI(1) POSTMULTI(1)</p>

<p>NAME postmulti - Postfix multi-instance manager</p>

<p>SYNOPSIS postmulti -l [-aRv] [-g group] [-i name]</p>

<p>postmulti -p [-av] [-g group] [-i name] command...</p>

<p>postmulti -x [-aRv] [-g group] [-i name] command...</p>

<p>postmulti -e init [-v]</p>

<p>postmulti -e create [-av] [-g group] [-i name] [-G
group] [-I name] [param=value ...]</p>

<p>postmulti -e import [-av] [-g group] [-i name] [-G
group] [-I name] [config_directory=/path]</p>

<p>postmulti -e destroy [-v] -i name</p>

<p>postmulti -e deport [-v] -i name</p>

<p>postmulti -e enable [-v] -i name</p>

<p>postmulti -e disable [-v] -i name</p>

<p>postmulti -e assign [-v] -i name [-I name] [-G
group]</p>

<p>DESCRIPTION The postmulti(1) command allows a Postfix
administrator to manage mul- tiple Postfix instances on a
single host.</p>

<p>postmulti(1) implements two fundamental modes of
operation. In itera- tor mode, it executes the same command
for multiple Postfix instances. In life-cycle management
mode, it adds or deletes one instance, or changes the
multi-instance status of one instance.</p>

<p>Each mode of operation has its own command syntax. For
this reason, each mode is documented in separate sections
below.</p>

<p>BACKGROUND A multi-instance configuration consists of
one primary Postfix instance, and one or more secondary
instances whose configuration directory pathnames are
recorded in the primary instances main.cf file. Postfix
instances share program files and documentation, but have
their own configuration, queue and data directories.</p>

<p>Currently, only the default Postfix instance can be used
as primary instance in a multi-instance configuration. The
postmulti(1) command does not currently support a -c option
to select an alternative primary instance, and exits with a
fatal error if the MAIL_CONFIG environment variable is set
to a non-default configuration directory.</p>

<p>See the MULTI_INSTANCE_README tutorial for a more
detailed discussion of multi-instance management with
postmulti(1).</p>

<p>ITERATOR MODE In iterator mode, postmulti performs the
same operation on all Postfix instances in turn.</p>

<p>If multi-instance support is not enabled, the requested
command is per- formed just for the primary instance.</p>

<p>Iterator mode implements the following command
options:</p>

<p>Instance selection -a Perform the operation on all
instances. This is the default.</p>

<p>-g group Perform the operation only for members of the
named group.</p>

<p>-i name Perform the operation only for the instance with
the specified name. You can specify either the instance name
or the absolute pathname of the instances configuration
directory. Specify &quot;-&quot; to select the primary
Postfix instance.</p>

<p>-R Reverse the iteration order. This may be appropriate
when updat- ing a multi-instance system, where
&quot;sink&quot; instances are started before
&quot;source&quot; instances.</p>

<p>This option cannot be used with -p.</p>

<p>List mode -l List Postfix instances with their instance
name, instance group name, enable/disable status and
configuration directory.</p>

<p>Postfix-wrapper mode -p Invoke postfix(1) to execute the
specified command. This option implements the
postfix-wrapper(5) interface.</p>

<p>&middot; With &quot;start&quot;-like commands,
&quot;postfix check&quot; is executed for instances that are
not enabled. The full list of com- mands is specified with
the postmulti_start_commands parameter.</p>

<p>&middot; With &quot;stop&quot;-like commands, the
iteration order is reversed, and disabled instances are
skipped. The full list of commands is specified with the
post- multi_stop_commands parameter.</p>

<p>&middot; With &quot;reload&quot; and other commands that
require a started instance, disabled instances are skipped.
The full list of commands is specified with the
postmulti_control_com- mands parameter.</p>

<p>&middot; With &quot;status&quot; and other commands that
dont require a started instance, the command is executed for
all instances.</p>

<p>The -p option can also be used interactively to
start/stop/etc. a named instance or instance group. For
example, to start just the instances in the group
&quot;msa&quot;, invoke postmulti(1) as fol- lows:</p>

<p># postmulti -g msa -p start</p>

<p>Command mode -x Execute the specified command for all
Postfix instances. The command runs with appropriate
environment settings for MAIL_CON- FIG, command_directory,
daemon_directory, config_directory, queue_directory,
data_directory, multi_instance_name, multi_instance_group
and multi_instance_enable.</p>

<p>Other options -v Enable verbose logging for debugging
purposes. Multiple -v options make the software increasingly
verbose.</p>

<p>LIFE-CYCLE MANAGEMENT MODE With the -e option
postmulti(1) can be used to add or delete a Postfix
instance, and to manage the multi-instance status of an
existing instance.</p>

<p>The following options are implemented:</p>

<p>Existing instance selection -a When creating or
importing an instance, place the new instance at the front
of the secondary instance list.</p>

<p>-g group When creating or importing an instance, place
the new instance before the first secondary instance that is
a member of the specified group.</p>

<p>-i name When creating or importing an instance, place
the new instance before the matching secondary instance.</p>

<p>With other life-cycle operations, apply the operation to
the named existing instance. Specify &quot;-&quot; to select
the primary Postfix instance.</p>

<p>New or existing instance name assignment -I name Assign
the specified instance name to an existing instance,
newly-created instance, or imported instance. Instance names
other than &quot;-&quot; (which makes the instance
&quot;nameless&quot;) must start with &quot;postfix-&quot;.
This restriction reduces the likelihood of name collisions
with system files.</p>

<p>-G group Assign the specified group name to an existing
instance or to a newly created or imported instance.</p>

<p>Instance creation/deletion/status change -e action
&quot;Edit&quot; managed instances. The following actions
are supported:</p>

<p>init This command is required before postmulti(1) can be
used to manage Postfix instances. The &quot;postmulti -e
init&quot; command updates the primary instance s main.cf
file by setting:</p>

<p>multi_instance_wrapper = ${command_directory}/postmulti
-p -- multi_instance_enable = yes</p>

<p>You can set these by other means if you prefer.</p>

<p>create Create a new Postfix instance and add it to the
multi_instance_directories parameter of the primary
instance. The &quot;-I name&quot; option is recommended to
give the instance a short name that is used to construct
default values for the private directories of the new
instance. The &quot;-G group&quot; option may be specified
to assign the instance to a group, otherwise, the new
instance is not a member of any groups.</p>

<p>The new instance main.cf is the stock main.cf with the
parameters that specify the locations of shared files cloned
from the primary instance. For &quot;nameless&quot;
instances, you should manually adjust
&quot;syslog_name&quot; to yield a unique &quot;logtag&quot;
starting with &quot;postfix-&quot; that will uniquely
identify the instance in the mail logs. It is simpler to
assign the instance a short name with the &quot;-I
name&quot; option.</p>

<p>Optional &quot;name=value&quot; arguments specify the
instance con- fig_directory, queue_directory and
data_directory. For example:</p>

<p># postmulti -I postfix-mumble -G mygroup -e create
config_directory=/my/config/dir
queue_directory=/my/queue/dir
data_directory=/my/data/dir</p>

<p>If any of these pathnames is not supplied, the program
attempts to generate the pathname by taking the corre-
sponding primary instance pathname, and by replacing the
last pathname component by the value of the -I option.</p>

<p>If the instance configuration directory already exists,
and contains both a main.cf and master.cf file, create will
&quot;import&quot; the instance as-is. For existing
instances, create and import are identical.</p>

<p>import Import an existing instance into the list of
instances managed by the postmulti(1) multi-instance
manager. This adds the instance to the
multi_instance_directories list of the primary instance. If
the &quot;-I name&quot; option is pro- vided it specifies
the new name for the instance and is used to define a
default location for the instance con- figuration directory
(as with create above). The &quot;-G group&quot; option may
be used to assign the instance to a group. Add a
&quot;config_directory=/path&quot; argument to over- ride a
default pathname based on &quot;-I name&quot;.</p>

<p>destroy Destroy a secondary Postfix instance. To be a
candidate for destruction an instance must be disabled,
stopped and its queue must not contain any messages.
Attempts to destroy the primary Postfix instance trigger a
fatal error, without destroying the instance.</p>

<p>The instance is removed from the primary instance
main.cf file s alternate_config_directories parameter and
its data, queue and configuration directories are cleaned of
files and directories created by the Postfix system. The
main.cf and master.cf files are removed from the configu-
ration directory even if they have been modified since
initial creation. Finally, the instance is
&quot;deported&quot; from the list of managed instances.</p>

<p>If other files are present in instance private directo-
ries, the directories may not be fully removed, a warning is
logged to alert the administrator. It is expected that an
instance built using &quot;fresh&quot; directories via the
cre- ate action will be fully removed by the destroy action
(if first disabled). If the instance configuration and queue
directories are populated with additional files (access and
rewriting tables, chroot jail content, etc.) the instance
directories will not be fully removed.</p>

<p>The destroy action triggers potentially dangerous file
removal operations. Make sure the instances data, queue and
configuration directories are set correctly and do not
contain any valuable files.</p>

<p>deport Deport a secondary instance from the list of
managed instances. This deletes the instance configuration
directory from the primary instances
multi_instance_directories list, but does not remove any
files or directories.</p>

<p>assign Assign a new instance name or a new group name to
the selected instance. Use &quot;-G -&quot; to specify
&quot;no group&quot; and &quot;-I -&quot; to specify
&quot;no name&quot;. If you choose to make an instance
&quot;nameless&quot;, set a suitable syslog_name in the
corresponding main.cf file.</p>

<p>enable Mark the selected instance as enabled. This just
sets the multi_instance_enable parameter to &quot;yes&quot;
in the instances main.cf file.</p>

<p>disable Mark the selected instance as disabled. This
means that the instance will not be started etc. with
&quot;postfix start&quot;, &quot;postmulti -p start&quot;
and so on. The instance can still be started etc. with
&quot;postfix -c config-directory start&quot;.</p>

<p>Other options -v Enable verbose logging for debugging
purposes. Multiple -v options make the software increasingly
verbose.</p>

<p>ENVIRONMENT The postmulti(1) command exports the
following environment variables before executing the
requested command for a given instance:</p>

<p>MAIL_VERBOSE This is set when the -v command-line option
is present.</p>

<p>MAIL_CONFIG The location of the configuration directory
of the instance.</p>

<p>CONFIGURATION PARAMETERS config_directory (seepostconf
-doutput) The default location of the Postfix main.cf and
master.cf con- figuration files.</p>

<p>daemon_directory (seepostconf -doutput) The directory
with Postfix support programs and daemon programs.</p>

<p>import_environment (seepostconf -doutput) The list of
environment parameters that a Postfix process will import
from a non-Postfix parent process.</p>

<p>multi_instance_directories (empty) An optional list of
non-default Postfix configuration directo- ries; these
directories belong to additional Postfix instances that
share the Postfix executable files and documentation with
the default Postfix instance, and that are started, stopped,
etc., together with the default Postfix instance.</p>

<p>multi_instance_group (empty) The optional instance group
name of this Postfix instance.</p>

<p>multi_instance_name (empty) The optional instance name
of this Postfix instance.</p>

<p>multi_instance_enable (no) Allow this Postfix instance
to be started, stopped, etc., by a multi-instance
manager.</p>

<p>postmulti_start_commands (start) The postfix(1) commands
that the postmulti(1) instance manager treats as
&quot;start&quot; commands.</p>

<p>postmulti_stop_commands (seepostconf -doutput) The
postfix(1) commands that the postmulti(1) instance manager
treats as &quot;stop&quot; commands.</p>

<p>postmulti_control_commands (reload flush) The postfix(1)
commands that the postmulti(1) instance manager treats as
&quot;control&quot; commands, that operate on running
instances.</p>

<p>syslog_facility (mail) The syslog facility of Postfix
logging.</p>

<p>syslog_name (seepostconf -doutput) The mail system name
that is prepended to the process name in syslog records, so
that &quot;smtpd&quot; becomes, for example, &quot;post-
fix/smtpd&quot;.</p>

<p>FILES $daemon_directory/main.cf, stock configuration
file $daemon_directory/master.cf, stock configuration file
$daemon_directory/postmulti-script, life-cycle helper
program</p>

<p>SEE ALSO postfix(1), Postfix control program
postfix-wrapper(5), Postfix multi-instance API</p>

<p>README FILES Use &quot;postconf readme_directory&quot;
or &quot;postconf html_directory&quot; to locate this
information. MULTI_INSTANCE_README, Postfix multi-instance
management</p>

<p>HISTORY The postmulti(1) command was introduced with
Postfix version 2.6.</p>

<p>LICENSE The Secure Mailer license must be distributed
with this software.</p>

<p>AUTHOR(S) Victor Duchovni Morgan Stanley</p>

<p>Wietse Venema IBM T.J. Watson Research P.O. Box 704
Yorktown Heights, NY 10598, USA</p>

<p>POSTMULTI(1)</p>
<hr>
</body>
</html>
