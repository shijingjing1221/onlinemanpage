<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:08:32 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>CRYPTSETUP-REENCRYPT(8) Maintenance Commands
CRYPTSETUP-REENCRYPT(8)</p>

<p>NAME cryptsetup-reencrypt - tool for offline LUKS device
re-encryption</p>

<p>SYNOPSIS cryptsetup-reencrypt &lt;options&gt;
&lt;device&gt;</p>

<p>DESCRIPTION Cryptsetup-reencrypt can be used to change
reencryption parameters which otherwise require full on-disk
data change (re-encryption).</p>

<p>You can regenerate volume key (the real key used in
on-disk encryption unclocked by passphrase), cipher, cipher
mode.</p>

<p>Cryptsetup-reencrypt reencrypts data on LUKS device
in-place. During reencryption process the LUKS device is
marked unavailable.</p>

<p>WARNING: The cryptsetup-reencrypt program is not
resistant to hardware or kernel failures during reencryption
(you can lose you data in this case).</p>

<p>ALWAYS BE SURE YOU HAVE RELIABLE BACKUP BEFORE USING
THIS TOOL. THIS TOOL IS EXPERIMENTAL.</p>

<p>The reencryption can be temporarily suspended (by TERM
signal or by using ctrl+c) but you need to retain temporary
files named LUKS-&lt;uuid&gt;.[log|org|new]. LUKS device is
unavailable until reencryp- tion is finished though.</p>

<p>Current working directory must by writable and temporary
files created during reencryption must be present.</p>

<p>For more info about LUKS see cryptsetup(8).</p>

<p>OPTIONS To start (or continue) re-encryption for
&lt;device&gt; use:</p>

<p>cryptsetup-reencrypt &lt;device&gt;</p>

<p>&lt;options&gt; can be [--block-size, --cipher, --hash,
--iter-time, --use- random | --use-urandom, --key-file,
--key-slot, --keyfile-offset, --keyfile-size, --tries,
--use-directio, --use-fsync, --write-log]</p>

<p>For detailed description of encryption and key file
options see crypt- setup(8) man page.</p>

<p>--verbose, -v Print more information on command
execution.</p>

<p>--debug Run in debug mode with full diagnostic logs.
Debug output lines are always prefixed by #.</p>

<p>--cipher, -c &lt;cipher-spec&gt; Set the cipher
specification string.</p>

<p>--key-size, -s &lt;bits&gt; Set key size in bits. The
argument has to be a multiple of 8.</p>

<p>The possible key-sizes are limited by the cipher and
mode used.</p>

<p>If you are increasing key size, there must be enough
space in the LUKS header for enlarged keyslots (data offset
must be large enough) or reencryption cannot be
performed.</p>

<p>If there is not enough space for keyslots with new key
size, you can destructively shrink device with
--reduce-device-size option.</p>

<p>--hash, -h &lt;hash-spec&gt; Specifies the hash used in
the LUKS key setup scheme and volume key digest.</p>

<p>NOTE: if this parameter is not specified, default hash
algorithm is always used for new device header.</p>

<p>--iter-time, -i &lt;milliseconds&gt; The number of
milliseconds to spend with PBKDF2 passphrase pro- cessing
for the new LUKS header.</p>

<p>--use-random</p>

<p>--use-urandom Define which kernel random number
generator will be used to cre- ate the volume key.</p>

<p>--key-file, -d name Read the passphrase from file.</p>

<p>WARNING: --key-file option can be used only if there
only one active keyslot, or alternatively, also if
--key-slot option is specified (then all other keyslots will
be disabled in new LUKS device).</p>

<p>If this option is not used, cryptsetup-reencrypt will
ask for all active keyslot passphrases.</p>

<p>--key-slot, -S &lt;0-7&gt; Specify which key slot is
used.</p>

<p>WARNING: All other keyslots will be disabled if this
option is used.</p>

<p>--keyfile-offset value Skip value bytes at the beginning
of the key file.</p>

<p>--keyfile-size, -l Read a maximum of value bytes from
the key file. Default is to read the whole file up to the
compiled-in maximum.</p>

<p>--keep-key Do not change encryption key, just reencrypt
the LUKS header and keyslots.</p>

<p>This option can be combined only with --hash or
--iter-time options.</p>

<p>--tries, -T Number of retries for invalid passphrase
entry.</p>

<p>--block-size, -B value Use re-encryption block size of
&lt;value&gt; in MiB.</p>

<p>Values can be between 1 and 64 MiB.</p>

<p>--device-size size[units] Instead of real device size,
use specified value.</p>

<p>It means that only specified area (from the start of the
device to the specified size) will be reencrypted.</p>

<p>WARNING: This is destructive operation.</p>

<p>If no unit suffix is specified, the size is in
bytes.</p>

<p>Unit suffix can be S for 512 byte sectors, K/M/G/T (or
KiB,MiB,GiB,TiB) for units with 1024 base or KB/MB/GB/TB for
1000 base (SI scale).</p>

<p>WARNING: This is destructive operation.</p>

<p>--reduce-device-size size[units] Enlarge data offset to
specified value by shrinking device size.</p>

<p>This means that last sectors on the original device will
be lost, ciphertext data will be effectively shifted by
specified number of sectors.</p>

<p>It can be usefull if you e.g. added some space to
underlying partition (so last sectors contains no data).</p>

<p>For units suffix see --device-size parameter
description.</p>

<p>WARNING: This is destructive operation and cannot be
reverted. Use with extreme care - shrinked filesystems are
usually unre- coverable.</p>

<p>You cannot shrink device more than by 64 MiB (131072
sectors).</p>

<p>--new, N Create new header (encrypt not yet encrypted
device).</p>

<p>This option must be used together with
--reduce-device-size.</p>

<p>WARNING: This is destructive operation and cannot be
reverted.</p>

<p>--use-directio Use direct-io (O_DIRECT) for all
read/write data operations.</p>

<p>Usefull if direct-io operations perform better than
normal buffered operations (e.g. in virtual
environments).</p>

<p>--use-fsync Use fsync call after every written
block.</p>

<p>--write-log Update log file after every block write.
This can slow down reencryption but will minimize data loss
in the case of system crash.</p>

<p>--batch-mode, -q Suppresses all warnings and
reencryption progress output.</p>

<p>--version Show the program version.</p>

<p>RETURN CODES Cryptsetup-reencrypt returns 0 on success
and a non-zero value on error.</p>

<p>Error codes are: 1 wrong parameters, 2 no permission, 3
out of memory, 4 wrong device specified, 5 device already
exists or device is busy.</p>

<p>EXAMPLES Reencrypt /dev/sdb1 (change volume key)
cryptsetup-reencrypt /dev/sdb1</p>

<p>Reencrypt and also change cipher and cipher mode
cryptsetup-reencrypt /dev/sdb1 -c aes-xts-plain64</p>

<p>Add LUKS encryption to not yet encrypted device</p>

<p>First, be sure you have space added to disk. Or
alternatively shrink filesystem in advance. Here we need
4096 512-bytes sectors (enough for 2x128 bit key).</p>

<p>fdisk -u /dev/sdb # move sdb1 partition end + 4096
sectors</p>

<p>cryptsetup-reencrypt /dev/sdb1 --new
--reduce-device-size 4096</p>

<p>REPORTING BUGS Report bugs, including ones in the
documentation, on the cryptsetup mailing list at
&lt;dm-crypt@saout.de&gt; or in the Issues section on LUKS
website. Please attach the output of the failed command with
the --debug option added.</p>

<p>AUTHORS Cryptsetup-reencrypt was written by Milan Broz
&lt;gmazyland@gmail.com&gt;.</p>

<p>COPYRIGHT Copyright &copy; 2012-2014 Milan Broz
Copyright &copy; 2012-2013 Red Hat, Inc.</p>

<p>This is free software; see the source for copying
conditions. There is NO warranty; not even for
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p>

<p>SEE ALSO The project website at
http://code.google.com/p/cryptsetup/</p>

<p>cryptsetup-reencrypt December 2013
CRYPTSETUP-REENCRYPT(8)</p>
<hr>
</body>
</html>
