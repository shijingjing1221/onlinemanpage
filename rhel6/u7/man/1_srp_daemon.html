<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:35:32 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>SRP_DAEMON(1) USER COMMANDS SRP_DAEMON(1)</p>

<p>NAME srp_daemon - Discovers SRP targets in an InfiniBand
Fabric</p>

<p>SYNOPSIS srp_daemon [-vVcaeon] [-d umad-device | -i
infiniband-device [-p port- num]] [-t timeout(ms)] [-r
retries] [-R Rescan-time] [-f rules-File]</p>

<p>DESCRIPTION Discovers and connects to InfiniBand SCSI
RDMA Protocol (SRP) targets in an IB fabric.</p>

<p>Each srp_daemon instance operates on one local port.
Upon boot it per- forms a full rescan of the fabric then
waits for an srp_daemon event. An srp_daemon event can be a
join of a new machine to the fabric, a change in the
capabilities of a machine, an SA change, or an expiration of
a predefined timeout.</p>

<p>When a new machine joins the fabric, srp_daemon checks
if it is a tar- get. When there is a change of capabilities,
srp_daemon checks if the machine has turned into a target.
When there is an SA change or a time- out expiration,
srp_daemon performs a full rescan of the fabric.</p>

<p>For each target srp_daemon finds, it checks if it should
connect to this target according to its rules (default rules
file is /etc/srp_dae- mon.conf) and if it is already
connected to the local port. If it should connect to this
target and if it is not connected yet, srp_dae- mon can
either print the target details or connect to it.</p>

<p>OPTIONS -v Print more verbose output</p>

<p>-V Print even more verbose output (debug mode)</p>

<p>-i infiniband-device Work on infiniband-device. This
option should not be used with -d.</p>

<p>-p port-num Work on port port-num (default 1). This
option must be used with -i and should not be used with
-d.</p>

<p>-d umad-device Use device file umad-device (default
/dev/infiniband/umad0) This option should not be used with
-i or -p.</p>

<p>-c Generate output suitable for piping directly to a
/sys/class/infiniband_srp/srp-&lt;device&gt;-&lt;port&gt;/add_target
file.</p>

<p>-a Prints all the targets in the fabric, not only
targets that are not connected through the local port. (The
same as ibsrpdm.)</p>

<p>-e Execute the connection command, i.e., make the
connection to the target.</p>

<p>-o Perform only one rescan and exit. (The same as
ibsrpdm.)</p>

<p>-R Rescan-time Force a complete rescan every Rescan-time
seconds. If -R is not specified, no timeout rescans will be
performed.</p>

<p>-T retry-Timeout Retries to connect to existing target
after retry-Timeout sec- onds. If -R is not specified, uses
5 Seconds timeout. if retry- Timeout is 0, will not try to
reconnect. The reason srp_daemon retries to connect to the
target is because there may be a rare scnerio in which
srp_daemon will try to connect to add a target when the
target is about to be removed, but is not removed yet.</p>

<p>-f rules-File Decide to which targets to connect
according to the rules in rules-File. If -f is not
specified, uses the default rules file /etc/srp_daemon.conf.
Each line in the rules-File is a rule which can be either an
allow connection or a disallow connection according to the
first character in the line (a or d accord- ingly). The rest
of the line is values for id_ext, ioc_guid, dgid,
service_id. Please take a look at the example section for an
example of the file. srp_daemon decide whether to allow or
disallow each target according to first rule that match the
target. If no rule matches the target, the target is allowed
and will be connected. In an allow rule it is possible to
set attributes for the connection to the target. Supported
attributes are max_cmd_per_lun and max_sect.</p>

<p>-t timeout Use timeout of timeout msec for MAD responses
(default: 5 sec).</p>

<p>-r retries Perform retries retries on each send to MAD
(default: 3 retries).</p>

<p>-n New format - use also initiator_ext in the connection
command.</p>

<p>FILES /etc/srp_daemon.conf - Default rules configuration
file that indicates to which targets to connect. Can be
overridden using the -f rules-File option. Each line in this
file is a rule which can be either an allow connection or a
disallow connection according to the first character in the
line (a or d accordingly). The rest of the line is values
for id_ext, ioc_guid, dgid, service_id. Please take a look
at the example section for an example of the file.
srp_daemon decide whether to allow or disallow each target
according to first rule that match the target. If no rule
matches the target, the target is allowed and will be con-
nected. In an allow rule it is possible to set attributes
for the con- nection to the target. Supported attributes are
max_cmd_per_lun and max_sect.</p>

<p>EXAMPLES srp_daemon -e -i mthca0 -p 1 -R 60 (Connects to
the targets accessible through port 1 of mthca0. Performs a
complete rescan every minute)</p>

<p>srp_daemon -o -c -a (Prints the connection commands for
the targets in the fabric and exits - similar to
ibsrpdm)</p>

<p>srp_daemon -e -f rules.txt (Connects to the targets
allowed in the rules file rules.txt)</p>

<p>An example for a rules configuration file (such as
/etc/srp_daemon.conf)
------------------------------------------------------------------------
# Rules file example # This is a comment # disallow the
following dgid d dgid=fe800000000000000002c90200402bd5 #
allow target with the following ioc_guid a
ioc_guid=00a0b80200402bd7 # allow target with the following
id_ext and ioc_guid. And setting max_cmd_per_lun to 31. a
id_ext=200500A0B81146A1,ioc_guid=00a0b80200402bef,max_cmd_per_lun=31
# disallow all the rest d</p>

<p>SEE ALSO ibsrpdm(1)</p>

<p>AUTHORS Roland Dreier &lt;rolandd@cisco.com&gt;</p>

<p>Ishai Rabinovitz &lt;ishai@mellanox.co.il&gt;</p>

<p>OpenFabrics September 5, 2006 SRP_DAEMON(1)</p>
<hr>
</body>
</html>
