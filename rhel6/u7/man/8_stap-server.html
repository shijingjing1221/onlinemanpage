<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:35:57 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>STAP-SERVER(8) STAP-SERVER(8)</p>

<p>NAME stap-server - systemtap compile server
management</p>

<p>SYNOPSIS [ service ] stap-server { start | stop |
restart | condrestart | try-restart | force-reload | status
} [ options ]</p>

<p>DESCRIPTION A systemtap compile server listens for
connections from stap clients on a secure SSL network port
and accepts requests to run the stap front end. Each server
advertises its presence and configuration on the local
network using mDNS (avahi) allowing for automatic detection
by clients.</p>

<p>The stap-server script aims to provide:</p>

<p>&middot; management of systemtap compile servers as a
service.</p>

<p>&middot; convenient control over configured servers and
individual (ad-hoc) servers.</p>

<p>ARGUMENTS One of the actions below must be
specified:</p>

<p>start Start servers. The specified servers are started.
If no server is specified, the configured servers are
started. If no servers are configured, a server for the
kernel release and architecture of the host is started. If a
specified server is already started, this action will be
ignored for that server. If a server fails to start, this
action fails.</p>

<p>stop Stop server(s). The specified servers are stopped.
If no server is specified, all currently running servers are
stopped. If a specified server is not running, this action
will be successful for that server. If a server fails to
stop, this action fails.</p>

<p>restart Stop and restart servers. The specified servers
are stopped and restarted. If no server is specified, all
currently running servers are stopped and restarted. If no
servers are running, this action behaves like start.</p>

<p>condrestart Stop and restart servers. The specified
servers are stopped and restarted. If a specified server is
not running, it is not started. If no server is specified,
all currently running servers are stopped and restarted. If
no servers are running, none will be started.</p>

<p>try-restart This action is identical to condrestart.</p>

<p>force-reload Stop all running servers, reload config
files and restart the service as if start was specified.</p>

<p>status Print information about running servers.
Information about the specified server(s) will be printed.
If no server is specified, information about all running
servers will be printed.</p>

<p>OPTIONS The following options are used to provide
additional configuration and to specify servers to be
managed:</p>

<p>-c configfile This option specifies a global
configuration file in addition to the default global
configuration file described below. This file will be
processed after the default global configuration file. If
the -c option is specified more than once, the last configu-
ration file specified will be used.</p>

<p>-a architecture This option specifies the target
architecture of the server and is analogous to the -a option
of stap. See the stap(1) manual page for more details. The
default architecture is the archi- tecture of the host.</p>

<p>-r kernel-release This option specifies the target
kernel release of the server and is analogous to the -r
option of stap. See the stap(1) man- ual page for more
details. The default release is that of the currently
running kernel.</p>

<p>-I path This option specifies an additional path to be
searched by the server(s) for tapsets and is analogous to
the -I option of stap. See the stap(1) manual page for more
details.</p>

<p>-R path This option specifies the location of the
systemtap runtime to be used by the server(s) and is
analogous to the -R option of stap. See the stap(1) manual
page for more details.</p>

<p>-B options This option specifies options to be passed to
make when building systemtap modules and is analogous to the
-B option of stap. See the stap(1) manual page for more
details.</p>

<p>-i This option is a shortcut which specifies one server
for each kernel release installed in /lib/modules/. Previous
-I, -R, -B and -u options will be applied to each server,
however previous -a options will be ignored and the default
architecture will be used.</p>

<p>-n nickname This option allows the specification of a
server configuration by nickname. When -n is specified, a
currently running server with the given nickname will be
searched for. If no currently running server with the given
nickname is found, a server con- figuration with the given
nickname will be searched for in the configuration files for
default servers, or the path configured in the global
configuration file or the configuration file spec- ified by
the -c option. If a server configuration for the given
nickname is found, the -a, -r, -I, -R, -B and -u options for
that server will be used as if they were specified on the
com- mand line. If no configuration with the given nickname
is found, and the action is start (or an action behaving
like start (see ARGUMENTS), the server will be started with
the given nickname. If no configuration with the given
nickname is found, and the action is not start (or an action
behaving like start), it is an error. If a nickname is not
specified for a server which is being started, its nickname
will be its process id.</p>

<p>-p pid This option allows the specification of a server
configuration by process id. When -p is specified, a
currently running server with the given process id will be
searched for. If no such server is found, it is an error. If
a server with the given pro- cess id is found, the -a, -r,
-I, -R, -B and -u options for that server will be used as if
they were specified on the command line.</p>

<p>-u user-name Each systemtap compile server is normally
run by the user name stap-server (for the initscript) or as
the user invoking stap-server, unless otherwise configured
(see FILES). This option specifies the user name used to run
the server(s). The user name specified must be a member of
the group stap-server.</p>

<p>--log logfile This option allows the specification of a
separate log file for each server. Each --log option is
added to a list which will be applied, in turn, to each
server specified. If more servers are specified than --log
options, the default log file (see FILES) will be used for
subsequent servers.</p>

<p>--port port-number This option allows the specification
of a specific network port for each server. Each --port
option is added to a list which will be applied, in turn, to
each server specified. If more servers are specified than
--port options, a randomly selected port is used for
subsequent servers.</p>

<p>--ssl certificate-db-path This option allows the
specification of a separate NSS certifi- cate database for
each server. Each --ssl option is added to a list which will
be applied, in turn, to each server specified. If more
servers are specified than --ssl options, the default
certificate database (see FILES) for subsequent servers.</p>

<p>--max-threads threads This option allows the
specification of the maximum number of worker threads to
handle concurrent requests. If threads == 0, each request
will be handled on the main thread, serially. The default is
the number of available processor cores.</p>

<p>CONFIGURATION Configuration files allow us to:</p>

<p>&middot; specify global configuration of logging, server
configuration files, status files and other global
parameters.</p>

<p>&middot; specify which servers are to be started by
default.</p>

<p>Global Configuration The Global Configuration file
contains variable assignments used to configure the overall
operation of the service. Each line beginning with a #
character is ignored. All other lines must be of the form
VARIABLE=VALUE. This is not a shell script. The entire
contents of the line after the = will be assigned as-is to
the variable.</p>

<p>The following variables may be assigned:</p>

<p>CONFIG_PATH Specifies the absolute path of the directory
containing the default server configurations.</p>

<p>STAT_PATH Specifies the absolute path of the running
server status direc- tory.</p>

<p>LOG_FILE Specifies the absolute path of the log
file.</p>

<p>STAP_USER Specifies the userid which will be used to run
the server(s) (default: for the initscript stap-server,
otherwise the user running stap-server).</p>

<p>Here is an example of a Global Configuration file:</p>

<p>CONFIG_PATH=~&lt;user&gt;/my-stap-server-configs
LOG_FILE=/tmp/stap-server/log</p>

<p>Individual Server Configuration Each server
configuration file configures a server to be started when no
server is specified for the start action, or an action
behaving like the start action (see ARGUMENTS). Each
configuration file contains variable assignments used to
configure an individual server.</p>

<p>Each line beginning with a # character is ignored. All
other lines must be of the form VARIABLE=VALUE. This is not
a shell script. The en- tire contents of the line after the
= will be assigned as-is to the variable.</p>

<p>Each configuration file must have a filename suffix of
.conf. See stap- paths(7) for the default location of these
files. This default loca- tion can be overridden in the
global configuration file using the -c option (see
OPTIONS).</p>

<p>The following variables may be assigned:</p>

<p>ARCH Specifies the target architecture for this server
and corre- sponds to the -a option (see OPTIONS). If ARCH is
not set, the architecture of the host will be used.</p>

<p>RELEASE Specifies the kernel release for this server and
corresponds to the -r option (see OPTIONS). If RELEASE is
not set, the release of the kernel running on the host will
be used.</p>

<p>BUILD Specifies options to be passed to the make process
used by sys- temtap to build kernel modules. This an array
variable with each element corresponding to a -B option (see
OPTIONS). Using the form BUILD=STRING clears the array and
sets the first ele- ment to STRING. Using the form
BUILD+=STRING adds STRING as an additional element to the
array.</p>

<p>INCLUDE Specifies a list of directories to be searched
by the server for tapsets. This is an array variable with
each element corre- sponding to a -I option (see OPTIONS).
Using the form IN- CLUDE=PATH clears the array and sets the
first element to PATH. Using the form INCLUDE+=PATH adds
PATH as an additional element to the array.</p>

<p>RUNTIME Specifies the directory which contains the
systemtap runtime code to be used by this server and
corresponds to the -R option (see OPTIONS).</p>

<p>USER Specifies the user name to be used to run this
server and corre- sponds to the -u option (see OPTIONS).</p>

<p>NICKNAME Specifies the nickname to be used to refer to
this server and corresponds to the -n option (see
OPTIONS).</p>

<p>LOG Specifies the location of the log file to be used by
this server and corresponds to the --log option (see
OPTIONS).</p>

<p>PORT Specifies the network port to be used by this
server and corre- sponds to the --port option (see
OPTIONS).</p>

<p>SSL Specifies the location of the NSS certificate
database to be used by this server and corresponds to the
--ssl option (see OP- TIONS).</p>

<p>MAXTHREADS Specifies the maximum number of worker
threads to handle concur- rent requests to be used by this
server and corresponds to the --max-threads option (see
OPTIONS).</p>

<p>Here is an example of a server configuration file:</p>

<p>ARCH= USER= RELEASE= NICKNAME=native</p>

<p>By keeping the ARCH, USER, and RELEASE fields blank,
they will default to the current arch and release and use
the default user.</p>

<p>A more specific example:</p>

<p>ARCH=i386 RELEASE=2.6.18-128.el5 PORT=5001
LOG=/path/to/log/file</p>

<p>And here is a more complicated example:</p>

<p>USER=serveruser
RELEASE=/kernels/2.6.18-92.1.18.el5/build INCLUDE=/mytapsets
INCLUDE+=/yourtapsets BUILD=VARIABLE1=VALUE1
VARIABLE2=VALUE2 DEFINE=STP_MAXMEMORY=1024
DEFINE+=DEBUG_TRANS RUNTIME=/myruntime NICKNAME=my-server
SSL=/path/to/NSS/certificate/database</p>

<p>SERVER AUTHENTICATION The security of the SSL network
connection between the client and serv- er depends on the
proper management of server certificates.</p>

<p>The trustworthiness of a given systemtap compile server
can not be de- termined automatically without a trusted
certificate authority issuing systemtap compile server
certificates. This is not practical in every- day use and
so, clients must authenticate servers against their own
database of trusted server certificates. In this context,
establishing a given server as trusted by a given client
means adding that server&rsquo;s certificate to the
client&rsquo;s database of trusted servers.</p>

<p>For the stap-server initscript, on the local host, this
is handled au- tomatically. When the systemtap-server
package is installed, the serv- er&rsquo;s certificate for
the default user (stap-server) is automatically generated
and installed. This means that servers started by the
stap-server initscript, with the default user, are
automatically trust- ed by clients on the local host, both
as an SSL peer and as a systemtap module signer.</p>

<p>Furthermore, when stap is invoked by an unprivileged
user (not root, not a member of the group stapdev, but a
member of the group stapusr and possibly the group stapsys),
the options --use-server and --privi- lege are automatically
added to the specified options. This means that unprivileged
users on the local host can use a server on the local host
in unprivileged mode with no further setup or options
required. Normal users (those in none of the SystemTap
groups) can also use compile- servers through the
--use-server and --privilege options. But they will of
course be unable to load the module (the -p4 option can be
used to stop short of loading).</p>

<p>In order to use a server running on another host, that
server&rsquo;s cer- tificate must be installed on the
client&rsquo;s host. See the --trust-servers option in the
stap(1) manual page for more details and README.unprivileged
in the systemtap sources for more details.</p>

<p>EXAMPLES See the stapex(3stap) manual page for a
collection of sample systemtap scripts.</p>

<p>To start the configured servers, or the default server,
if none are configured:</p>

<p>$ [ service ] stap-server start</p>

<p>To start a server for each kernel installed in
/lib/modules:</p>

<p>$ [ service ] stap-server start -i</p>

<p>To obtain information about the running server(s):</p>

<p>$ [ service ] stap-server status</p>

<p>To start a server like another one, except targeting a
different archi- tecture, by referencing the first
server&rsquo;s nickname:</p>

<p>$ [ service ] stap-server start -n NICKNAME -a ARCH</p>

<p>To start a server for a kernel release not installed
(cross-compiling)</p>

<p>$ [ service ] stap-server start -a ARCH -r /BUILDDIR</p>

<p>To stop one of the servers by referencing its process id
(obtained by running stap-server status):</p>

<p>$ [ service ] stap-server stop -p PID</p>

<p>To run a script using a compile server:</p>

<p>$ stap SCRIPT --use-server</p>

<p>To run a script as an unprivileged user using a compile
server:</p>

<p>$ stap SCRIPT</p>

<p>To stop all running servers:</p>

<p>$ [ service ] stap-server stop</p>

<p>To restart servers after a global configuration change
and/or when de- fault servers have been added, changed, or
removed:</p>

<p>$ [ service ] stap-server force-reload</p>

<p>SAFETY AND SECURITY Systemtap is an administrative tool.
It exposes kernel internal data structures and potentially
private user information. See the stap(1) manual page for
additional information on safety and security.</p>

<p>As a network server, stap-server should be activated
with care in order to limit the potential effects of bugs or
mischevious users. Consider the following prophylactic
measures.</p>

<p>1 Run stap-server as an unprivileged user, never as
root.</p>

<p>When invoked as a service (i.e. service stap-server
...), each server is run, by default, as the user
stap-server. When in- voked directly (i.e. stap-server ...),
each server is run, by default, as the invoking user. In
each case, another user may be selected by using the -u
option on invocation, by specifying STAP_USER=username in
the global configuration file or by speci- fying
USER=username in an individual server configuration file.
The invoking user must have authority to run processes as
anoth- er user. See CONFIGURATION.</p>

<p>The selected user must have write access to the server
log file. The location of the server log file may be changed
by setting LOG_FILE=path in the global configuration file.
See CONFIGURA- TION.</p>

<p>The selected user must have read/write access to the
directory containing the server status files. The location
of the server status files may be changed by setting
STAT_PATH=path in the global configuration file. See
CONFIGURATION.</p>

<p>The selected user must have read/write access to the
uprobes.ko build directory and its files.</p>

<p>Neither form of stap-server will run if the selected
user is root.</p>

<p>2 Run stap-server requests with resource limits that
impose maxi- mum cpu time, file size, memory consumption, in
order to bound the effects of processing excessively large
or bogus inputs.</p>

<p>When the user running the server is stap-server, each
server re- quest is run with limits specified in
~stap-server/.systemtap/rc otherwise, no limits are
imposed.</p>

<p>3 Run stap-server with a TMPDIR environment variable
that points to a separate and/or quota-enforced directory,
in order to pre- vent filling up of important
filesystems.</p>

<p>The default TMPDIR is /tmp/.</p>

<p>4 Activate network firewalls to limit stap client
connections to relatively trustworthy networks.</p>

<p>For automatic selection of servers by clients, avahi
must be in- stalled on both the server and client hosts and
mDNS messages must be allowed through the firewall.</p>

<p>The systemtap compile server and its related utilities
use the Secure Socket Layer (SSL) as implemented by Network
Security Services (NSS) for network security. NSS is also
used for the generation and manage- ment of certificates.
The related certificate databases must be pro- tected in
order to maintain the security of the system. Use of the
utilities provided will help to ensure that the proper
protection is maintained. The systemtap client will check
for proper access permis- sions before making use of any
certificate database.</p>

<p>FILES Important files and their corresponding paths can
be located in the stappaths (7) manual page.</p>

<p>SEE ALSO stap(1), staprun(8), stapprobes(3stap),
stappaths(7), stapex(3stap), avahi, ulimit(1), NSS</p>

<p>BUGS Use the Bugzilla link of the project web page or
our mailing list. http://sourceware.org/systemtap/,
&lt;systemtap@sourceware.org&gt;.</p>

<p>STAP-SERVER(8)</p>
<hr>
</body>
</html>
