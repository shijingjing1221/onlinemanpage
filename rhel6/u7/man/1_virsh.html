<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:44:09 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>VIRSH(1) Virtualization Support VIRSH(1)</p>

<p>NAME virsh - management user interface</p>

<p>SYNOPSIS virsh [OPTION]... [COMMAND_STRING]</p>

<p>virsh [OPTION]... COMMAND [ARG]...</p>

<p>DESCRIPTION The virsh program is the main interface for
managing virsh guest domains. The program can be used to
create, pause, and shutdown domains. It can also be used to
list current domains. Libvirt is a C toolkit to interact
with the virtualization capabilities of recent versions of
Linux (and other OSes). It is free software available under
the GNU Lesser General Public License. Virtualization of the
Linux Operating System means the ability to run multiple
instances of Operating Systems concurrently on a single
hardware system where the basic resources are driven by a
Linux instance. The library aims at providing a long term
stable C API. It currently supports Xen, QEmu, KVM, LXC,
OpenVZ, VirtualBox and VMware ESX.</p>

<p>The basic structure of most virsh usage is:</p>

<p>virsh [OPTION]... &lt;command&gt; &lt;domain&gt;
[ARG]...</p>

<p>Where command is one of the commands listed below;
domain is the numeric domain id, or the domain name, or the
domain UUID; and ARGS are command specific options. There
are a few exceptions to this rule in the cases where the
command in question acts on all domains, the entire machine,
or directly on the xen hypervisor. Those exceptions will be
clear for each of those commands. Note: it is permissible to
give numeric names to domains, however, doing so will result
in a domain that can only be identified by domain id. In
other words, if a numeric value is supplied it will be
interpreted as a domain id, not as a name.</p>

<p>The virsh program can be used either to run one COMMAND
by giving the command and its arguments on the shell command
line, or a COMMAND_STRING which is a single shell argument
consisting of multiple COMMAND actions and their arguments
joined with whitespace, and separated by semicolons between
commands. Within COMMAND_STRING, virsh understands the same
single, double, and backslash escapes as the shell, although
you must add another layer of shell escaping in creating the
single shell argument. If no command is given in the command
line, virsh will then start a minimal interpreter waiting
for your commands, and the quit command will then exit the
program.</p>

<p>The virsh program understands the following OPTIONS.</p>

<p>-h, --help Ignore all other arguments, and behave as if
the help command were given instead.</p>

<p>-v, --version[=short] Ignore all other arguments, and
prints the version of the libvirt library virsh is coming
from</p>

<p>-V, --version=long Ignore all other arguments, and
prints the version of the libvirt library virsh is coming
from and which options and driver are compiled in.</p>

<p>-c, --connect URI Connect to the specified URI, as if by
the connect command, instead of the default connection.</p>

<p>-d, --debug LEVEL Enable debug messages at integer LEVEL
and above. LEVEL can range from 0 to 4 (default). See the
documentation of VIRSH_DEBUG environment variable below for
the description of each LEVEL.</p>

<p>-l, --log FILE Output logging details to FILE.</p>

<p>-q, --quiet Avoid extra informational messages.</p>

<p>-r, --readonly Make the initial connection read-only, as
if by the --readonly option of the connect command.</p>

<p>-t, --timing Output elapsed time information for each
command.</p>

<p>-e, --escape string Set alternative escape sequence for
console command. By default, telnets ^] is used. Allowed
characters when using hat notation are: alphabetic
character, @, [, ], ^, _.</p>

<p>NOTES Most virsh operations rely upon the libvirt
library being able to connect to an already running libvirtd
service. This can usually be done using the command service
libvirtd start.</p>

<p>Most virsh commands require root privileges to run due
to the communications channels used to talk to the
hypervisor. Running as non root will return an error.</p>

<p>Most virsh commands act synchronously, except maybe
shutdown, setvcpus and setmem. In those cases the fact that
the virsh program returned, may not mean the action is
complete and you must poll periodically to detect that the
guest completed the operation.</p>

<p>virsh strives for backward compatibility. Although the
help command only lists the preferred usage of a command, if
an older version of virsh supported an alternate spelling of
a command or option (such as --tunnelled instead of
--tunneled), then scripts using that older spelling will
continue to work.</p>

<p>Several virsh commands take an optionally scaled
integer; if no scale is provided, then the default is listed
in the command (for historical reasons, some commands
default to bytes, while other commands default to
kibibytes). The following case-insensitive suffixes can be
used to select a specfic scale: b, byte byte 1 KB kilobyte
1,000 k, KiB kibibyte 1,024 MB megabyte 1,000,000 M, MiB
mebibyte 1,048,576 GB gigabyte 1,000,000,000 G, GiB gibibyte
1,073,741,824 TB terabyte 1,000,000,000,000 T, TiB tebibyte
1,099,511,627,776 PB petabyte 1,000,000,000,000,000 P, PiB
pebibyte 1,125,899,906,842,624 EB exabyte
1,000,000,000,000,000,000 E, EiB exbibyte
1,152,921,504,606,846,976</p>

<p>GENERIC COMMANDS The following commands are generic i.e.
not specific to a domain.</p>

<p>help [command-or-group] This lists each of the virsh
commands. When used without options, all commands are
listed, one per line, grouped into related categories,
displaying the keyword for each group.</p>

<p>To display only commands for a specific group, give the
keyword for that group as an option. For example:</p>

<p>virsh # help host</p>

<p>Host and Hypervisor (help keyword &rsquo;host&rsquo;):
capabilities capabilities connect (re)connect to hypervisor
freecell NUMA free memory hostname print the hypervisor
hostname qemu-attach Attach to existing QEMU process
qemu-monitor-command QEMU Monitor Command qemu-agent-command
QEMU Guest Agent Command sysinfo print the hypervisor
sysinfo uri print the hypervisor canonical URI</p>

<p>To display detailed information for a specific command,
give its name as the option instead. For example:</p>

<p>virsh # help list NAME list - list domains</p>

<p>SYNOPSIS list [--inactive] [--all]</p>

<p>DESCRIPTION Returns list of domains.</p>

<p>OPTIONS --inactive list inactive domains --all list
inactive &amp; active domains</p>

<p>quit, exit quit this interactive terminal</p>

<p>version Will print out the major version info about what
this built from.</p>

<p>Example</p>

<p>virsh version</p>

<p>Compiled against library: libvir 0.0.6</p>

<p>Using library: libvir 0.0.6</p>

<p>Using API: Xen 3.0.0</p>

<p>Running hypervisor: Xen 3.0.0</p>

<p>cd [directory] Will change current directory to
directory. The default directory for the cd command is the
home directory or, if there is no HOME variable in the
environment, the root directory.</p>

<p>This command is only available in interactive mode.</p>

<p>pwd Will print the current directory.</p>

<p>connect URI [--readonly] (Re)-Connect to the hypervisor.
When the shell is first started, this is automatically run
with the URI parameter requested by the &quot;-c&quot;
option on the command line. The URI parameter specifies how
to connect to the hypervisor. The documentation page at
&lt;http://libvirt.org/uri.html&gt; list the values
supported, but the most common are:</p>

<p>xen:/// this is used to connect to the local Xen
hypervisor, this is the default</p>

<p>qemu:///system connect locally as root to the daemon
supervising QEmu and KVM domains</p>

<p>qemu:///session connect locally as a normal user to his
own set of QEmu and KVM domains</p>

<p>lxc:/// connect to a local linux container</p>

<p>For remote access see the documentation page at
&lt;http://libvirt.org/uri.html&gt; on how to make URIs. The
--readonly option allows for read-only connection</p>

<p>uri Prints the hypervisor canonical URI, can be useful
in shell mode.</p>

<p>hostname Print the hypervisor hostname.</p>

<p>sysinfo Print the XML representation of the hypervisor
sysinfo, if available.</p>

<p>nodeinfo Returns basic information about the node, like
number and type of CPU, and size of the physical memory. The
output corresponds to virNodeInfo structure. Specifically,
the &quot;CPU socket(s)&quot; field means number of CPU
sockets per NUMA cell.</p>

<p>nodecpustats [cpu] [--percent] Returns cpu stats of the
node. If cpu is specified, this will prints specified cpu
statistics only. If --percent is specified, this will prints
percentage of each kind of cpu statistics during 1
second.</p>

<p>nodememstats [cell] Returns memory stats of the node. If
cell is specified, this will prints specified cell
statistics only.</p>

<p>nodesuspend [target] [duration] Puts the node (host
machine) into a system-wide sleep state such as
Suspend-to-RAM, Suspend-to-Disk or Hybrid-Suspend and sets
up a Real-Time-Clock interrupt to fire (to wake up the node)
after a time delay specified by the duration parameter. The
duration time should be at least 60 seconds.</p>

<p>node-memory-tune [shm-pages-to-scan]
[shm-sleep-millisecs] Allows you to display or set the node
memory parameters. shm- pages-to-scan can be used to set the
number of pages to scan before the shared memory service
goes to sleep; shm-sleep-millisecs can be used to set the
number of millisecs the shared memory service should sleep
before next scan; shm-merge-across-nodes specifies if pages
from different numa nodes can be merged. When set to 0, only
pages which physically reside in the memory area of same
NUMA node can be merged. When set to 1, pages from all nodes
can be merged. Default to 1.</p>

<p>capabilities Print an XML document describing the
capabilities of the hypervisor we are currently connected
to. This includes a section on the host capabilities in
terms of CPU and features, and a set of description for each
kind of guest which can be virtualized. For a more complete
description see: &lt;http://libvirt.org/formatcaps.html&gt;
The XML also show the NUMA topology information if
available.</p>

<p>inject-nmi domain Inject NMI to the guest.</p>

<p>list [--inactive | --all] [--managed-save] [--title] {
[--table] | --name | --uuid } [--persistent] [--transient]
[--with-managed-save] [--without-managed-save] [--autostart]
[--no-autostart] [--with-snapshot] [--without-snapshot]
[--state-running] [--state-paused] [--state-shutoff]
[--state-other] Prints information about existing domains.
If no options are specified it prints out information about
running domains.</p>

<p>An example format for the list is as follows:</p>

<p>virsh list Id Name State
---------------------------------------------------- 0
Domain-0 running 2 fedora paused</p>

<p>Name is the name of the domain. ID the domain numeric
id. State is the run state (see below).</p>

<p>STATES</p>

<p>The State field lists 8 states for a domain, and which
ones the current domain is in.</p>

<p>running The domain is currently running on a CPU</p>

<p>idle The domain is idle, and not running or runnable.
This can be caused because the domain is waiting on IO (a
traditional wait state) or has gone to sleep because there
was nothing else for it to do.</p>

<p>paused The domain has been paused, usually occurring
through the administrator running virsh suspend. When in a
paused state the domain will still consume allocated
resources like memory, but will not be eligible for
scheduling by the hypervisor.</p>

<p>shutdown The domain is in the process of shutting down,
i.e. the guest operating system has been notified and should
be in the process of stopping its operations gracefully.</p>

<p>shut off The domain is not running. Usually this
indicates the domain has been shut down completely, or has
not been started.</p>

<p>crashed The domain has crashed, which is always a
violent ending. Usually this state can only occur if the
domain has been configured not to restart on crash.</p>

<p>dying The domain is in process of dying, but hasnt
completely shutdown or crashed.</p>

<p>pmsuspended The domain has been suspended by guest power
management, e.g. entered into s3 state.</p>

<p>Normally only active domains are listed. To list
inactive domains specify --inactive or --all to list both
active and inactive domains.</p>

<p>To further filter the list of domains you may specify
one or more of filtering flags supported by the list
command. These flags are grouped by function. Specifying one
or more flags from a group enables the filter group. Note
that some combinations of flags may yield no results.
Supported filtering flags and groups:</p>

<p>Persistence Flag --persistent is used to include
persistent domains in the returned list. To include
transient domains specify --transient.</p>

<p>Existence of managed save image To list domains having a
managed save image specify flag --with-managed-save. For
domains that dont have a managed save image specify
--without-managed-save.</p>

<p>Domain state The following filter flags select a domain
by its state: --state-running for running domains,
--state-paused for paused domains, --state-shutoff for
turned off domains and --state-other for all other states as
a fallback.</p>

<p>Autostarting domains To list autostarting domains use
the flag --autostart. To list domains with this feature
disabled use --no-autostart.</p>

<p>Snapshot existence Domains that have snapshot images can
be listed using flag --with-snapshot, domains without a
snapshot --without-snapshot.</p>

<p>When talking to older servers, this command is forced to
use a series of API calls with an inherent race, where a
domain might not be listed or might appear more than once if
it changed state between calls while the list was being
collected. Newer servers do not have this problem.</p>

<p>If --managed-save is specified, then domains that have
managed save state (only possible if they are in the shut
off state, so you need to specify --inactive or --all to
actually list them) will instead show as saved in the
listing. This flag is usable only with the default --table
output. Note that this flag does not filter the list of
domains.</p>

<p>If --name is specified, domain names are printed instead
of the table formatted one per line. If --uuid is specified
domains UUID s are printed instead of names. Flag --table
specifies that the legacy table-formatted output should be
used. This is the default. All of these are mutually
exclusive.</p>

<p>If --title is specified, then the short domain
description (title) is printed in an extra column. This flag
is usable only with the default --table output.</p>

<p>Example:</p>

<p>virsh list --title Id Name State Title
--------------------------------------------------------------------------
0 Domain-0 running Mailserver 1 2 fedora paused</p>

<p>freecell [{ [--cellno] cellno | --all }] Prints the
available amount of memory on the machine or within a NUMA
cell. The freecell command can provide one of three
different displays of available memory on the machine
depending on the options specified. With no options, it
displays the total free memory on the machine. With the
--all option, it displays the free memory in each cell and
the total free memory on the machine. Finally, with a
numeric argument or with --cellno plus a cell number it will
display the free memory for the specified cell only.</p>

<p>cpu-baseline FILE Compute baseline CPU which will be
supported by all host CPUs given in &lt;file&gt;. The list
of host CPUs is built by extracting all &lt;cpu&gt; elements
from the &lt;file&gt;. Thus, the &lt;file&gt; can contain
either a set of &lt;cpu&gt; elements separated by new lines
or even a set of complete &lt;capabilities&gt; elements
printed by capabilities command.</p>

<p>cpu-compare FILE Compare CPU definition from XML
&lt;file&gt; with host CPU. The XML &lt;file&gt; may contain
either host or guest CPU definition. The host CPU definition
is the &lt;cpu&gt; element and its contents as printed by
capabilities command. The guest CPU definition is the
&lt;cpu&gt; element and its contents from domain XML
definition. For more information on guest CPU definition
see:
&lt;http://libvirt.org/formatdomain.html#elementsCPU&gt;</p>

<p>echo [--shell] [--xml] [arg...] Echo back each arg,
separated by space. If --shell is specified, then the output
will be single-quoted where needed, so that it is suitable
for reuse in a shell context. If --xml is specified, then
the output will be escaped for use in XML.</p>

<p>DOMAIN COMMANDS The following commands manipulate
domains directly, as stated previously most commands take
domain as the first parameter. The domain can be specified
as a short integer, a name or a full UUID.</p>

<p>autostart [--disable] domain Configure a domain to be
automatically started at boot.</p>

<p>The option --disable disables autostarting.</p>

<p>console domain [devname] [--safe] [--force] Connect the
virtual serial console for the guest. The optional devname
parameter refers to the device alias of an alternate
console, serial or parallel device configured for the guest.
If omitted, the primary console will be opened.</p>

<p>If the flag --safe is specified, the connection is only
attempted if the driver supports safe console handling. This
flag specifies that the server has to ensure exclusive
access to console devices. Optionally the --force flag may
be specified, requesting to disconnect any existing
sessions, such as in a case of a broken connection.</p>

<p>create FILE [--console] [--paused] [--autodestroy]
Create a domain from an XML &lt;file&gt;. An easy way to
create the XML &lt;file&gt; is to use the dumpxml command to
obtain the definition of a pre-existing guest. The domain
will be paused if the --paused option is used and supported
by the driver; otherwise it will be running. If --console is
requested, attach to the console after creation. If
--autodestroy is requested, then the guest will be
automatically destroyed when virsh closes its connection to
libvirt, or otherwise exits.</p>

<p>Example</p>

<p>virsh dumpxml &lt;domain&gt; &gt; domain.xml vi
domain.xml (or make changes with your other text editor)
virsh create domain.xml</p>

<p>define FILE Define a domain from an XML &lt;file&gt;.
The domain definition is registered but not started. If
domain is already running, the changes will take effect on
the next boot.</p>

<p>desc domain [[--live] [--config] | [--current]]
[--title] [--edit] [--new-desc New description or title
message] Show or modify description and title of a domain.
These values are user fields that allow to store arbitrary
textual data to allow easy identification of domains. Title
should be short, although its not enforced.</p>

<p>Flags --live or --config select whether this command
works on live or persistent definitions of the domain. If
both --live and --config are specified, the --config option
takes precedence on getting the current description and both
live configuration and config are updated while setting the
description. --current is exclusive and implied if none of
these was specified.</p>

<p>Flag --edit specifies that an editor with the contents
of current description or title should be opened and the
contents saved back afterwards.</p>

<p>Flag --title selects operation on the title field
instead of description.</p>

<p>If neither of --edit and --new-desc are specified the
note or description is displayed instead of being
modified.</p>

<p>destroy domain [--graceful] Immediately terminate the
domain domain. This doesnt give the domain OS any chance to
react, and its the equivalent of ripping the power cord out
on a physical machine. In most cases you will want to use
the shutdown command instead. However, this does not delete
any storage volumes used by the guest, and if the domain is
persistent, it can be restarted later.</p>

<p>If domain is transient, then the metadata of any
snapshots will be lost once the guest stops running, but the
snapshot contents still exist, and a new domain with the
same name and UUID can restore the snapshot metadata with
snapshot-create.</p>

<p>If --graceful is specified, dont resort to extreme
measures (e.g. SIGKILL) when the guest doesnt stop after a
reasonable timeout; return an error instead.</p>

<p>domblkstat domain block-device [--human] Get device
block stats for a running domain. A block-device corresponds
to a unique target name (&lt;target dev= name /&gt;) or
source file (&lt;source file=name/&gt;) for one of the disk
devices attached to domain (see also domblklist for listing
these names).</p>

<p>Use --human for a more human readable output.</p>

<p>Availability of these fields depends on hypervisor.
Unsupported fields are missing from the output. Other fields
may appear if communicating with a newer version of
libvirtd.</p>

<p>Explanation of fields (fields appear in the folowing
order): rd_req - count of read operations rd_bytes - count
of read bytes wr_req - count of write operations wr_bytes -
count of written bytes errs - error count flush_operations -
count of flush operations rd_total_times - total time read
operations took (ns) wr_total_times - total time write
operations took (ns) flush_total_times - total time flush
operations took (ns) &lt;-- other fields provided by
hypervisor --&gt;</p>

<p>domifstat domain interface-device Get network interface
stats for a running domain.</p>

<p>domif-setlink domain interface-device state [--config]
Modify link state of the domains virtual interface. Possible
values for state are &quot;up&quot; and &quot;down. If
--config is specified, only the persistent configuration of
the domain is modified, for compatibility purposes,
--persistent is alias of --config. interface-device can be
the interfaces target name or the MAC address.</p>

<p>domif-getlink domain interface-device [--config] Query
link state of the domains virtual interface. If --config is
specified, query the persistent configuration, for
compatibility purposes, --persistent is alias of
--config.</p>

<p>interface-device can be the interfaces target name or
the MAC address.</p>

<p>domiftune domain interface-device [[--config] [--live] |
[--current]] [--inbound average,peak,burst] [--outbound
average,peak,burst] Set or query the domains network
interfaces bandwidth parameters. interface-device can be the
interface s target name (&lt;target dev=name/&gt;), or the
MAC address.</p>

<p>If no --inbound or --outbound is specified, this command
will query and show the bandwidth settings. Otherwise, it
will set the inbound or outbound bandwidth.
average,peak,burst is the same as in command
attach-interface.</p>

<p>If --live is specified, affect a running guest. If
--config is specified, affect the next boot of a persistent
guest. If --current is specified, affect the current guest
state. Both --live and --current flags may be given, but
--current is exclusive. If no flag is specified, behavior is
different depending on hypervisor.</p>

<p>dommemstat domain Get memory stats for a running
domain.</p>

<p>domblkerror domain Show errors on block devices. This
command usually comes handy when domstate command says that
a domain was paused due to I/O error. The domblkerror
command lists all block devices in error state and the error
seen on each of them.</p>

<p>domblkinfo domain block-device Get block device size
info for a domain. A block-device corresponds to a unique
target name (&lt;target dev=name /&gt;) or source file
(&lt;source file=name/&gt;) for one of the disk devices
attached to domain (see also domblklist for listing these
names).</p>

<p>domblklist domain [--inactive] [--details] Print a table
showing the brief information of all block devices
associated with domain. If --inactive is specified, query
the block devices that will be used on the next boot, rather
than those currently in use by a running domain. If
--details is specified, disk type and device value will also
be printed. Other contexts that require a block device name
(such as domblkinfo or snapshot- create for disk snapshots)
will accept either target or unique source names printed by
this command.</p>

<p>domiflist domain [--inactive] Print a table showing the
brief information of all virtual interfaces associated with
domain. If --inactive is specified, query the virtual
interfaces that will be used on the next boot, rather than
those currently in use by a running domain. Other contexts
that require a MAC address of virtual interface (such as
detach-interface or domif-setlink) will accept the MAC
address printed by this command.</p>

<p>blockcommit domain path [bandwidth] {[base] |
[--shallow]} [top] [--delete] [--wait [--verbose] [--timeout
seconds]] Reduce the length of a backing image chain, by
committing changes at the top of the chain (snapshot or
delta files) into backing images. By default, this command
attempts to flatten the entire chain. If base and/or top are
specified as files within the backing chain, then the
operation is constrained to committing just that portion of
the chain; --shallow can be used instead of base to specify
the immediate backing file of the resulting top image to be
committed. The files being committed are rendered invalid,
possibly as soon as the operation starts; using the --delete
flag will remove these files at the successful completion of
the commit operation.</p>

<p>By default, this command returns as soon as possible,
and data for the entire disk is committed in the background;
the progress of the operation can be checked with blockjob.
However, if --wait is specified, then this command will
block until the operation completes, or cancel the operation
if the optional timeout in seconds elapses or SIGINT is sent
(usually with &quot;Ctrl-C&quot;). Using --verbose along
with --wait will produce periodic status updates.</p>

<p>path specifies fully-qualified path of the disk; it
corresponds to a unique target name (&lt;target dev=name
/&gt;) or source file (&lt;source file= name /&gt;) for one
of the disk devices attached to domain (see also domblklist
for listing these names). bandwidth specifies copying
bandwidth limit in MiB/s, although for qemu, it may be non-
zero only for an online domain.</p>

<p>blockcopy domain path dest [bandwidth] [--shallow]
[--reuse-external] [--raw] [--wait [--verbose] [{--pivot |
--finish}] [--timeout seconds] [--async]] Copy a disk
backing image chain to dest. By default, this command
flattens the entire chain; but if --shallow is specified,
the copy shares the backing chain.</p>

<p>If --reuse-external is specified, then dest must exist
and have contents identical to the resulting backing file
(that is, it must start with contents matching the backing
file disk if --shallow is used, otherwise it must start
empty); this option is typically used to set up a relative
backing file name in the destination.</p>

<p>The format of the destination is determined by the first
match in the following list: if --raw is specified, it will
be raw; if --reuse-external is specified, the existing
destination is probed for a format; and in all other cases,
the destination format will match the source format.</p>

<p>By default, the copy job runs in the background, and
consists of two phases. Initially, the job must copy all
data from the source, and during this phase, the job can
only be canceled to revert back to the source disk, with no
guarantees about the destination. After this phase
completes, both the source and the destination remain
mirrored until a call to blockjob with the --abort and
--pivot flags pivots over to the copy, or a call without
--pivot leaves the destination as a faithful copy of that
point in time. However, if --wait is specified, then this
command will block until the mirroring phase begins, or
cancel the operation if the optional timeout in seconds
elapses or SIGINT is sent (usually with &quot;Ctrl-C&quot;).
Using --verbose along with --wait will produce periodic
status updates. Using --pivot or --finish along with --wait
will additionally end the job cleanly rather than leaving
things in the mirroring phase. If job cancellation is
triggered, --async will return control to the user as fast
as possible, otherwise the command may continue to block a
little while longer until the job is done cleaning up.</p>

<p>path specifies fully-qualified path of the disk.
bandwidth specifies copying bandwidth limit in MiB/s.</p>

<p>blockpull domain path [bandwidth] [base] [--wait
[--verbose] [--timeout seconds] [--async]] Populate a disk
from its backing image chain. By default, this command
flattens the entire chain; but if base is specified,
containing the name of one of the backing files in the
chain, then that file becomes the new backing file and only
the intermediate portion of the chain is pulled. Once all
requested data from the backing image chain has been pulled,
the disk no longer depends on that portion of the backing
chain.</p>

<p>By default, this command returns as soon as possible,
and data for the entire disk is pulled in the background;
the progress of the operation can be checked with blockjob.
However, if --wait is specified, then this command will
block until the operation completes, or cancel the operation
if the optional timeout in seconds elapses or SIGINT is sent
(usually with &quot;Ctrl-C&quot;). Using --verbose along
with --wait will produce periodic status updates. If job
cancellation is triggered, --async will return control to
the user as fast as possible, otherwise the command may
continue to block a little while longer until the job is
done cleaning up.</p>

<p>path specifies fully-qualified path of the disk; it
corresponds to a unique target name (&lt;target
dev=name/&gt;) or source file (&lt;source file=name/&gt;)
for one of the disk devices attached to domain (see also
domblklist for listing these names). bandwidth specifies
copying bandwidth limit in MiB/s.</p>

<p>blkdeviotune domain device [[--config] [--live] |
[--current]] [[total- bytes-sec] | [read-bytes-sec]
[write-bytes-sec]] [[total-iops-sec] | [read-iops-sec]
[write-iops-sec]] Set or query the block disk io parameters
for a block device of domain. device specifies a unique
target name (&lt;target dev=name/&gt;) or source file
(&lt;source file=name /&gt;) for one of the disk devices
attached to domain (see also domblklist for listing these
names).</p>

<p>If no limit is specified, it will query current I/O
limits setting. Otherwise, alter the limits with these
flags: --total-bytes-sec specifies total throughput limit in
bytes per second. --read-bytes-sec specifies read throughput
limit in bytes per second. --write-bytes-sec specifies write
throughput limit in bytes per second. --total-iops-sec
specifies total I/O operations limit per second.
--read-iops-sec specifies read I/O operations limit per
second. --write-iops-sec specifies write I/O operations
limit per second.</p>

<p>Older versions of virsh only accepted these options with
underscore instead of dash, as in --total_bytes_sec.</p>

<p>Bytes and iops values are independent, but setting only
one value (such as --read-bytes-sec) resets the other two in
that category to unlimited. An explicit 0 also clears any
limit. A non-zero value for a given total cannot be mixed
with non-zero values for read or write.</p>

<p>If --live is specified, affect a running guest. If
--config is specified, affect the next boot of a persistent
guest. If --current is specified, affect the current guest
state. Both --live and --current flags may be given, but
--current is exclusive. If no flag is specified, behavior is
different depending on hypervisor.</p>

<p>blockjob domain path { [--abort] [--async] [--pivot] |
[--info] | [bandwidth] } Manage active block operations.
There are three modes: --info, bandwidth, and --abort;
--info is default except that --async or --pivot implies
--abort.</p>

<p>path specifies fully-qualified path of the disk; it
corresponds to a unique target name (&lt;target dev=name
/&gt;) or source file (&lt;source file= name /&gt;) for one
of the disk devices attached to domain (see also domblklist
for listing these names).</p>

<p>If --abort is specified, the active job on the specified
disk will be aborted. If --async is also specified, this
command will return immediately, rather than waiting for the
cancelation to complete. If --pivot is specified, this
requests that an active copy job be pivoted over to the new
copy. If --info is specified, the active job information on
the specified disk will be printed. bandwidth can be used to
set bandwidth limit for the active job.</p>

<p>blockresize domain path size Resize a block device of
domain while the domain is running, path specifies the
absolute path of the block device; it corresponds to a
unique target name (&lt;target dev=name/&gt;) or source file
(&lt;source file=name/&gt;) for one of the disk devices
attached to domain (see also domblklist for listing these
names).</p>

<p>size is a scaled integer (see NOTES above) which
defaults to KiB (blocks of 1024 bytes) if there is no
suffix. You must use a suffix of &quot;B&quot; to get bytes
(note that for historical reasons, this differs from
vol-resize which defaults to bytes without a suffix).</p>

<p>domdisplay domain [--include-password] Output a URI
which can be used to connect to the graphical display of the
domain via VNC, SPICE or RDP. If --include-password is
specified, the SPICE channel password will be included in
the URI.</p>

<p>domhostname domain Returns the hostname of a domain, if
the hypervisor makes it available.</p>

<p>dominfo domain Returns basic information about the
domain.</p>

<p>domuuid domain-name-or-id Convert a domain name or id to
domain UUID</p>

<p>domid domain-name-or-uuid Convert a domain name (or
UUID) to a domain id</p>

<p>domjobabort domain Abort the currently running domain
job.</p>

<p>domjobinfo domain Returns information about jobs running
on a domain.</p>

<p>domname domain-id-or-uuid Convert a domain Id (or UUID)
to domain name</p>

<p>domstate domain [--reason] Returns state about a domain.
--reason tells virsh to also print reason for the state.</p>

<p>domcontrol domain Returns state of an interface to VMM
used to control a domain. For states other than
&quot;ok&quot; or &quot;error&quot; the command also prints
number of seconds elapsed since the control interface
entered its current state.</p>

<p>domxml-from-native format config Convert the file config
in the native guest configuration format named by format to
a domain XML format. For QEMU/KVM hypervisor, the format
argument must be qemu-argv. For Xen hypervisor, the format
argument may be xen-xm or xen-sxpr.</p>

<p>domxml-to-native format xml Convert the file xml in
domain XML format to the native guest configuration format
named by format. For QEMU/KVM hypervisor, the format
argument must be qemu-argv. For Xen hypervisor, the format
argument may be xen-xm or xen-sxpr.</p>

<p>dump domain corefilepath [--bypass-cache] { [--live] |
[--crash] | [--reset] } [--verbose] [--memory-only] Dumps
the core of a domain to a file for analysis. If --live is
specified, the domain continues to run until the core dump
is complete, rather than pausing up front. If --crash is
specified, the domain is halted with a crashed status,
rather than merely left in a paused state. If --reset is
specified, the domain is reset after successful dump. Note,
these three switches are mutually exclusive. If
--bypass-cache is specified, the save will avoid the file
system cache, although this may slow down the operation. If
--memory-only is specified, the file is elf file, and will
only include domains memory and cpu common register value.
It is very useful if the domain uses host devices
directly.</p>

<p>The progress may be monitored using domjobinfo virsh
command and canceled with domjobabort command (sent by
another virsh instance). Another option is to send SIGINT
(usually with &quot;Ctrl-C&quot;) to the virsh process
running dump command. --verbose displays the progress of
dump.</p>

<p>NOTE: Some hypervisors may require the user to manually
ensure proper permissions on file and path specified by
argument corefilepath.</p>

<p>dumpxml domain [--inactive] [--security-info]
[--update-cpu] [--migratable] Output the domain information
as an XML dump to stdout, this format can be used by the
create command. Additional options affecting the XML dump
may be used. --inactive tells virsh to dump domain
configuration that will be used on next start of the domain
as opposed to the current domain configuration. Using
--security-info will also include security sensitive
information in the XML dump. --update-cpu updates domain CPU
requirements according to host CPU. With --migratable one
can request an XML that is suitable for migrations, i.e.,
compatible with older libvirt releases and possibly amended
with internal run-time options. This option may
automatically enable other options (--update-cpu,
--security-info, ...) as necessary.</p>

<p>edit domain Edit the XML configuration file for a
domain, which will affect the next boot of the guest.</p>

<p>This is equivalent to:</p>

<p>virsh dumpxml --inactive --security-info domain &gt;
domain.xml vi domain.xml (or make changes with your other
text editor) virsh define domain.xml</p>

<p>except that it does some error checking.</p>

<p>The editor used can be supplied by the $VISUAL or
$EDITOR environment variables, and defaults to
&quot;vi&quot;.</p>

<p>managedsave domain [--bypass-cache] [{--running |
--paused}] [--verbose] Save and destroy (stop) a running
domain, so it can be restarted from the same state at a
later time. When the virsh start command is next run for the
domain, it will automatically be started from this saved
state. If --bypass-cache is specified, the save will avoid
the file system cache, although this may slow down the
operation.</p>

<p>The progress may be monitored using domjobinfo virsh
command and canceled with domjobabort command (sent by
another virsh instance). Another option is to send SIGINT
(usually with &quot;Ctrl-C&quot;) to the virsh process
running managedsave command. --verbose displays the progress
of save.</p>

<p>Normally, starting a managed save will decide between
running or paused based on the state the domain was in when
the save was done; passing either the --running or --paused
flag will allow overriding which state the start should
use.</p>

<p>The dominfo command can be used to query whether a
domain currently has any managed save image.</p>

<p>managedsave-remove domain Remove the managedsave state
file for a domain, if it exists. This ensures the domain
will do a full boot the next time it is started.</p>

<p>maxvcpus [type] Provide the maximum number of virtual
CPUs supported for a guest VM on this connection. If
provided, the type parameter must be a valid type attribute
for the &lt;domain&gt; element of XML.</p>

<p>cpu-stats domain [--total] [start] [count] Provide cpu
statistics information of a domain. The domain should be
running. Default it shows stats for all CPUs, and a total.
Use --total for only the total stats, start for only the
per-cpu stats of the CPUs from start, count for only count
CPUs stats.</p>

<p>migrate [--live] [--direct] [--p2p [--tunnelled]]
[--persistent] [--undefinesource] [--suspend]
[--copy-storage-all] [--copy-storage-inc]
[--change-protection] [--unsafe] [--verbose]
[--abort-on-error] domain desturi [migrateuri] [dname]
[--timeout seconds] [--xml file] Migrate domain to another
host. Add --live for live migration; --p2p for peer-2-peer
migration; --direct for direct migration; or --tunnelled for
tunnelled migration. --persistent leaves the domain
persistent on destination host, --undefinesource undefines
the domain on the source host, and --suspend leaves the
domain paused on the destination host. --copy-storage-all
indicates migration with non-shared storage with full disk
copy, --copy-storage-inc indicates migration with non-shared
storage with incremental copy (same base image shared
between source and destination). In both cases the disk
images have to exist on destination host, the
--copy-storage-... options only tell libvirt to transfer
data from the images on source host to the images found at
the same place on the destination host. --change-protection
enforces that no incompatible configuration changes will be
made to the domain while the migration is underway; this
flag is implicitly enabled when supported by the hypervisor,
but can be explicitly used to reject the migration if the
hypervisor lacks change protection support. --verbose
displays the progress of migration. --abort-on-error cancels
the migration if a soft error (for example I/O error)
happens during the migration.</p>

<p>Note: Individual hypervisors usually do not support all
possible types of migration. For example, QEMU does not
support direct migration.</p>

<p>In some cases libvirt may refuse to migrate the domain
because doing so may lead to potential problems such as data
corruption, and thus the migration is considered unsafe. For
QEMU domain, this may happen if the domain uses disks
without explicitly setting cache mode to &quot;none&quot;.
Migrating such domains is unsafe unless the disk images are
stored on coherent clustered filesystem, such as GFS2 or
GPFS. If you are sure the migration is safe or you just do
not care, use --unsafe to force the migration.</p>

<p>The desturi is the connection URI of the destination
host, and migrateuri is the migration URI, which usually can
be omitted (see below). dname is used for renaming the
domain to new name during migration, which also usually can
be omitted. Likewise, --xml file is usually omitted, but can
be used to supply an alternative XML file for use on the
destination to supply a larger set of changes to any
host-specific portions of the domain XML, such as accounting
for naming differences between source and destination in
accessing underlying storage.</p>

<p>--timeout seconds forces guest to suspend when live
migration exceeds that many seconds, and then the migration
will complete offline. It can only be used with --live.</p>

<p>Running migration can be canceled by interrupting virsh
(usually using &quot;Ctrl-C&quot;) or by domjobabort command
sent from another virsh instance.</p>

<p>Note: The desturi parameter for normal migration and
peer2peer migration has different semantics:</p>

<p>&middot; normal migration: the desturi is an address of
the target host as seen from the client machine.</p>

<p>&middot; peer2peer migration: the desturi is an address
of the target host as seen from the source machine.</p>

<p>When migrateuri is not specified, libvirt will
automatically determine the hypervisor specific URI, by
looking up the target host s configured hostname. There are
a few scenarios where specifying migrateuri may help:</p>

<p>&middot; The configured hostname is incorrect, or DNS is
broken. If a host has a hostname which will not resolve to
match one of its public IP addresses, then libvirt will
generate an incorrect URI. In this case migrateuri should be
explicitly specified, using an IP address, or a correct
hostname.</p>

<p>&middot; The host has multiple network interaces. If a
host has multiple network interfaces, it might be desirable
for the migration data stream to be sent over a specific
interface for either security or performance reasons. In
this case migrateuri should be explicitly specified, using
an IP address associated with the network to be used.</p>

<p>&middot; The firewall restricts what ports are
available. When libvirt generates a migration URI, it will
pick a port number using hypervisor specific rules. Some
hypervisors only require a single port to be open in the
firewalls, while others require a whole range of port
numbers. In the latter case migrateuri might be specified to
choose a specific port number outside the default range in
order to comply with local firewall policies.</p>

<p>migrate-setmaxdowntime domain downtime Set maximum
tolerable downtime for a domain which is being live-
migrated to another host. The downtime is a number of
milliseconds the guest is allowed to be down at the end of
live migration.</p>

<p>migrate-setspeed domain bandwidth Set the maximum
migration bandwidth (in MiB/s) for a domain which is being
migrated to another host.</p>

<p>migrate-getspeed domain Get the maximum migration
bandwidth (in MiB/s) for a domain.</p>

<p>numatune domain [--mode mode] [--nodeset nodeset]
[[--config] [--live] | [--current]] Set or get a domains
numa parameters, corresponding to the &lt;numatune&gt;
element of domain XML. Without flags, the current settings
are displayed.</p>

<p>mode can be one of strict, interleave and preferred .
For a running domain, the mode can t be changed, and the
nodeset can be changed only if the domain was started with a
mode of strict.</p>

<p>nodeset is a list of numa nodes used by the host for
running the domain. Its syntax is a comma separated list,
with - for ranges and ^ for excluding a node.</p>

<p>If --live is specified, set scheduler information of a
running guest. If --config is specified, affect the next
boot of a persistent guest. If --current is specified,
affect the current guest state.</p>

<p>reboot domain [--mode acpi|agent] Reboot a domain. This
acts just as if the domain had the reboot command run from
the console. The command returns as soon as it has executed
the reboot action, which may be significantly before the
domain actually reboots.</p>

<p>The exact behavior of a domain when it reboots is set by
the on_reboot parameter in the domains XML definition.</p>

<p>By default the hypervisor will try to pick a suitable
shutdown method. To specify an alternative method, the
--mode parameter can specify &quot;acpi&quot; or
&quot;agent&quot;.</p>

<p>reset domain Reset a domain immediately without any
guest shutdown. reset emulates the power reset button on a
machine, where all guest hardware sees the RST line set and
reinitializes internal state.</p>

<p>Note: Reset without any guest OS shutdown risks data
loss.</p>

<p>restore state-file [--bypass-cache] [--xml file]
[{--running | --paused}] Restores a domain from a virsh save
state file. See save for more info.</p>

<p>If --bypass-cache is specified, the restore will avoid
the file system cache, although this may slow down the
operation.</p>

<p>--xml file is usually omitted, but can be used to supply
an alternative XML file for use on the restored guest with
changes only in the host-specific portions of the domain
XML. For example, it can be used to account for file naming
differences in underlying storage due to disk snapshots
taken after the guest was saved.</p>

<p>Normally, restoring a saved image will use the state
recorded in the save image to decide between running or
paused; passing either the --running or --paused flag will
allow overriding which state the domain should be started
in.</p>

<p>Note: To avoid corrupting file system contents within
the domain, you should not reuse the saved state file for a
second restore unless you have also reverted all storage
volumes back to the same contents as when the state file was
created.</p>

<p>save domain state-file [--bypass-cache] [--xml file]
[{--running | --paused}] [--verbose] Saves a running domain
(RAM, but not disk state) to a state file so that it can be
restored later. Once saved, the domain will no longer be
running on the system, thus the memory allocated for the
domain will be free for other domains to use. virsh restore
restores from this state file. If --bypass-cache is
specified, the save will avoid the file system cache,
although this may slow down the operation.</p>

<p>The progress may be monitored using domjobinfo virsh
command and canceled with domjobabort command (sent by
another virsh instance). Another option is to send SIGINT
(usually with &quot;Ctrl-C&quot;) to the virsh process
running save command. --verbose displays the progress of
save.</p>

<p>This is roughly equivalent to doing a hibernate on a
running computer, with all the same limitations. Open
network connections may be severed upon restore, as TCP
timeouts may have expired.</p>

<p>--xml file is usually omitted, but can be used to supply
an alternative XML file for use on the restored guest with
changes only in the host-specific portions of the domain
XML. For example, it can be used to account for file naming
differences that are planned to be made via disk snapshots
of underlying storage after the guest is saved.</p>

<p>Normally, restoring a saved image will decide between
running or paused based on the state the domain was in when
the save was done; passing either the --running or --paused
flag will allow overriding which state the restore should
use.</p>

<p>Domain saved state files assume that disk images will be
unchanged between the creation and restore point. For a more
complete system restore point, where the disk state is saved
alongside the memory state, see the snapshot family of
commands.</p>

<p>save-image-define file xml [{--running | --paused}]
Update the domain XML that will be used when file is later
used in the restore command. The xml argument must be a file
name containing the alternative XML, with changes only in
the host- specific portions of the domain XML. For example,
it can be used to account for file naming differences
resulting from creating disk snapshots of underlying storage
after the guest was saved.</p>

<p>The save image records whether the domain should be
restored to a running or paused state. Normally, this
command does not alter the recorded state; passing either
the --running or --paused flag will allow overriding which
state the restore should use.</p>

<p>save-image-dumpxml file [--security-info] Extract the
domain XML that was in effect at the time the saved state
file file was created with the save command. Using
--security-info will also include security sensitive
information.</p>

<p>save-image-edit file [{--running | --paused}] Edit the
XML configuration associated with a saved state file file
created by the save command.</p>

<p>The save image records whether the domain should be
restored to a running or paused state. Normally, this
command does not alter the recorded state; passing either
the --running or --paused flag will allow overriding which
state the restore should use.</p>

<p>This is equivalent to:</p>

<p>virsh save-image-dumpxml state-file &gt; state-file.xml
vi state-file.xml (or make changes with your other text
editor) virsh save-image-define state-file
state-file-xml</p>

<p>except that it does some error checking.</p>

<p>The editor used can be supplied by the $VISUAL or
$EDITOR environment variables, and defaults to
&quot;vi&quot;.</p>

<p>schedinfo [--set parameter=value] domain [[--config]
[--live] | [--current]] schedinfo [--weight number] [--cap
number] domain Allows you to show (and set) the domain
scheduler parameters. The parameters available for each
hypervisor are:</p>

<p>LXC (posix scheduler) : cpu_shares</p>

<p>QEMU/KVM (posix scheduler): cpu_shares, vcpu_period,
vcpu_quota, emulator_period, emulator_quota</p>

<p>Xen (credit scheduler): weight, cap</p>

<p>ESX (allocation scheduler): reservation, limit,
shares</p>

<p>If --live is specified, set scheduler information of a
running guest. If --config is specified, affect the next
boot of a persistent guest. If --current is specified,
affect the current guest state.</p>

<p>Note: The cpu_shares parameter has a valid value range
of 0-262144; Negative values are wrapped to positive, and
larger values are capped at the maximum. Therefore, -1 is a
useful shorthand for 262144. On the Linux kernel, the values
0 and 1 are automatically converted to a minimal value of
2.</p>

<p>Note: The weight and cap parameters are defined only for
the XEN_CREDIT scheduler and are now DEPRECATED.</p>

<p>Note: The vcpu_period/emulator_period parameters have a
valid value range of 1000-1000000 or 0, and the
vcpu_quota/emulator_quota parameters have a valid value
range of 1000-18446744073709551 or less than 0. The value 0
for either parameter is the same as not specifying that
parameter.</p>

<p>screenshot domain [imagefilepath] [--screen screenID]
Takes a screenshot of a current domain console and stores it
into a file. Optionally, if hypervisor supports more
displays for a domain, screenID allows to specify which
screen will be captured. It is the sequential number of
screen. In case of multiple graphics cards, heads are
enumerated before devices, e.g. having two graphics cards,
both with four heads, screen ID 5 addresses the second head
on the second card.</p>

<p>send-key domain [--codeset codeset] [--holdtime
holdtime] keycode... Parse the keycode sequence as
keystrokes to send to domain. Each keycode can either be a
numeric value or a symbolic name from the corresponding
codeset. If --holdtime is given, each keystroke will be held
for that many milliseconds. The default codeset is linux,
but use of the --codeset option allows other codesets to be
chosen.</p>

<p>linux The numeric values are those defined by the Linux
generic input event subsystem. The symbolic names match the
corresponding Linux key constant macro names.</p>

<p>xt The numeric values are those defined by the original
XT keyboard controller. No symbolic names are provided</p>

<p>atset1 The numeric values are those defined by the AT
keyboard controller, set 1 (aka XT compatible set). Extended
keycoes from atset1 may differ from extended keycodes in the
xt codeset. No symbolic names are provided</p>

<p>atset2 The numeric values are those defined by the AT
keyboard controller, set 2. No symbolic names are
provided</p>

<p>atset3 The numeric values are those defined by the AT
keyboard controller, set 3 (aka PS/2 compatible set). No
symbolic names are provided</p>

<p>os_x The numeric values are those defined by the OS-X
keyboard input subsystem. The symbolic names match the
corresponding OS-X key constant macro names</p>

<p>xt_kbd The numeric values are those defined by the Linux
KBD device. These are a variant on the original XT codeset,
but often with different encoding for extended keycodes. No
symbolic names are provided.</p>

<p>win32 The numeric values are those defined by the Win32
keyboard input subsystem. The symbolic names match the
corresponding Win32 key constant macro names</p>

<p>usb The numeric values are those defined by the USB HID
specification for keyboard input. No symbolic names are
provided</p>

<p>rfb The numeric values are those defined by the RFB
extension for sending raw keycodes. These are a variant on
the XT codeset, but extended keycodes have the low bit of
the second byte set, instead of the high bit of the first
byte. No symbolic names are provided.</p>

<p>Examples # send three strokes k, e, y, using xt codeset
virsh send-key dom --codeset xt 37 18 21 # send one stroke
right-ctrl+C virsh send-key dom KEY_RIGHTCTRL KEY_C # send a
tab, held for 1 second virsh send-key --holdtime 1000
0xf</p>

<p>setmem domain size [[--config] [--live] | [--current]]
Change the memory allocation for a guest domain. If --live
is specified, perform a memory balloon of a running guest.
If --config is specified, affect the next boot of a
persistent guest. If --current is specified, affect the
current guest state. Both --live and --config flags may be
given, but --current is exclusive. If no flag is specified,
behavior is different depending on hypervisor.</p>

<p>size is a scaled integer (see NOTES above); it defaults
to kibibytes (blocks of 1024 bytes) unless you provide a
suffix (and the older option name --kilobytes is available
as a deprecated synonym) . Libvirt rounds up to the nearest
kibibyte. Some hypervisors require a larger granularity than
KiB, and requests that are not an even multiple will be
rounded up. For example, vSphere/ESX rounds the parameter up
to mebibytes (1024 kibibytes).</p>

<p>For Xen, you can only adjust the memory of a running
domain if the domain is paravirtualized or running the PV
balloon driver.</p>

<p>setmaxmem domain size [[--config] [--live] |
[--current]] Change the maximum memory allocation limit for
a guest domain. If --live is specified, affect a running
guest. If --config is specified, affect the next boot of a
persistent guest. If --current is specified, affect the
current guest state. Both --live and --config flags may be
given, but --current is exclusive. If no flag is specified,
behavior is different depending on hypervisor.</p>

<p>Some hypervisors such as QEMU/KVM don t support live
changes (especially increasing) of the maximum memory
limit.</p>

<p>size is a scaled integer (see NOTES above); it defaults
to kibibytes (blocks of 1024 bytes) unless you provide a
suffix (and the older option name --kilobytes is available
as a deprecated synonym) . Libvirt rounds up to the nearest
kibibyte. Some hypervisors require a larger granularity than
KiB, and requests that are not an even multiple will be
rounded up. For example, vSphere/ESX rounds the parameter up
to mebibytes (1024 kibibytes).</p>

<p>memtune domain [--hard-limit size] [--soft-limit size]
[--swap-hard-limit size] [--min-guarantee size] [[--config]
[--live] | [--current]] Allows you to display or set the
domain memory parameters. Without flags, the current
settings are displayed; with a flag, the appropriate limit
is adjusted if supported by the hypervisor. LXC and QEMU/KVM
support --hard-limit, --soft-limit, and --swap-hard-limit.
--min-guarantee is supported only by ESX hypervisor. Each of
these limits are scaled integers (see NOTES above), with a
default of kibibytes (blocks of 1024 bytes) if no suffix is
present. Libvirt rounds up to the nearest kibibyte. Some
hypervisors require a larger granularity than KiB, and
requests that are not an even multiple will be rounded up.
For example, vSphere/ESX rounds the parameter up to
mebibytes (1024 kibibytes).</p>

<p>If --live is specified, affect a running guest. If
--config is specified, affect the next boot of a persistent
guest. If --current is specified, affect the current guest
state. Both --live and --config flags may be given, but
--current is exclusive. If no flag is specified, behavior is
different depending on hypervisor.</p>

<p>For QEMU/KVM, the parameters are applied to the QEMU
process as a whole. Thus, when counting them, one needs to
add up guest RAM, guest video RAM, and some memory overhead
of QEMU itself. The last piece is hard to determine so one
needs guess and try.</p>

<p>--hard-limit The maximum memory the guest can use.</p>

<p>--soft-limit The memory limit to enforce during memory
contention.</p>

<p>--swap-hard-limit The maximum memory plus swap the guest
can use. This has to be more than hard-limit value
provided.</p>

<p>--min-guarantee The guaranteed minimum memory allocation
for the guest.</p>

<p>Specifying -1 as a value for these limits is interpreted
as unlimited.</p>

<p>blkiotune domain [--weight weight] [--device-weights
device-weights] [[--config] [--live] | [--current]] Display
or set the blkio parameters. QEMU/KVM supports --weight.
--weight is in range [100, 1000].</p>

<p>device-weights is a single string listing one or more
device/weight pairs, in the format of
/path/to/device,weight,/path/to/device,weight. Each weight
is in the range [100, 1000], or the value 0 to remove that
device from per-device listings. Only the devices listed in
the string are modified; any existing per-device weights for
other devices remain unchanged.</p>

<p>If --live is specified, affect a running guest. If
--config is specified, affect the next boot of a persistent
guest. If --current is specified, affect the current guest
state. Both --live and --config flags may be given, but
--current is exclusive. If no flag is specified, behavior is
different depending on hypervisor.</p>

<p>setvcpus domain count [--maximum] [[--config] [--live] |
[--current]] [--guest] Change the number of virtual CPUs
active in a guest domain. By default, this command works on
active guest domains. To change the settings for an inactive
guest domain, use the --config flag.</p>

<p>The count value may be limited by host, hypervisor, or a
limit coming from the original description of the guest
domain. For Xen, you can only adjust the virtual CPUs of a
running domain if the domain is paravirtualized.</p>

<p>If the --config flag is specified, the change is made to
the stored XML configuration for the guest domain, and will
only take effect when the guest domain is next started.</p>

<p>If --live is specified, the guest domain must be active,
and the change takes place immediately. Both the --config
and --live flags may be specified together if supported by
the hypervisor. If this command is run before the guest has
finished booting, the guest may fail to process the
change.</p>

<p>If --current is specified, affect the current guest
state.</p>

<p>When no flags are given, the --live flag is assumed and
the guest domain must be active. In this situation it is up
to the hypervisor whether the --config flag is also assumed,
and therefore whether the XML configuration is adjusted to
make the change persistent.</p>

<p>If --guest is specified, then the count of cpus is
modified in the guest instead of the hypervisor. This flag
is usable only for live domains and may require guest agent
to be configured in the guest.</p>

<p>The --maximum flag controls the maximum number of
virtual cpus that can be hot-plugged the next time the
domain is booted. As such, it must only be used with the
--config flag, and not with the --live flag.</p>

<p>shutdown domain [--mode acpi|agent] Gracefully shuts
down a domain. This coordinates with the domain OS to
perform graceful shutdown, so there is no guarantee that it
will succeed, and may take a variable length of time
depending on what services must be shutdown in the
domain.</p>

<p>The exact behavior of a domain when it shuts down is set
by the on_shutdown parameter in the domains XML
definition.</p>

<p>If domain is transient, then the metadata of any
snapshots will be lost once the guest stops running, but the
snapshot contents still exist, and a new domain with the
same name and UUID can restore the snapshot metadata with
snapshot-create.</p>

<p>By default the hypervisor will try to pick a suitable
shutdown method. To specify an alternative method, the
--mode parameter can specify &quot;acpi&quot; or
&quot;agent&quot;.</p>

<p>start domain-name-or-uuid [--console] [--paused]
[--autodestroy] [--bypass-cache] [--force-boot] Start a
(previously defined) inactive domain, either from the last
managedsave state, or via a fresh boot if no managedsave
state is present. The domain will be paused if the --paused
option is used and supported by the driver; otherwise it
will be running. If --console is requested, attach to the
console after creation. If --autodestroy is requested, then
the guest will be automatically destroyed when virsh closes
its connection to libvirt, or otherwise exits. If
--bypass-cache is specified, and managedsave state exists,
the restore will avoid the file system cache, although this
may slow down the operation. If --force-boot is specified,
then any managedsave state is discarded and a fresh boot
occurs.</p>

<p>suspend domain Suspend a running domain. It is kept in
memory but won t be scheduled anymore.</p>

<p>resume domain Moves a domain out of the suspended state.
This will allow a previously suspended domain to now be
eligible for scheduling by the underlying hypervisor.</p>

<p>dompmsuspend domain target [--duration] Suspend a
running domain into one of these states (possible target
values): mem equivallent of S3 ACPI state disk equivallent
of S4 ACPI state hybrid RAM is saved to disk but not powered
off</p>

<p>The --duration argument specifies number of seconds
before the domain is woken up after it was suspended (see
also dompmwakeup). Default is 0 for unlimited suspend time.
(This feature isnt currently supported by any hypervisor
driver and 0 should be used.).</p>

<p>Note that this command requires a guest agent configured
and running in the domains guest OS.</p>

<p>Beware that at least for QEMU, the domain s process will
be terminated when target disk is used and a new process
will be launched when libvirt is asked to wake up the
domain. As a result of this, any runtime changes, such as
device hotplug or memory settings, are lost unless such
changes were made with --config flag.</p>

<p>dompmwakeup domain Wakeup a domain from pmsuspended
state (either suspended by dompmsuspend or from the guest
itself). Injects a wakeup into the guest that is in
pmsuspended state, rather than waiting for the previously
requested duration (if any) to elapse. This operation doesn
t not necessarily fail if the domain is running.</p>

<p>ttyconsole domain Output the device used for the TTY
console of the domain. If the information is not available
the processes will provide an exit code of 1.</p>

<p>undefine domain [--managed-save] [--snapshots-metadata]
[ {--storage volumes | --remove-all-storage} --wipe-storage]
Undefine a domain. If the domain is running, this converts
it to a transient domain, without stopping it. If the domain
is inactive, the domain configuration is removed.</p>

<p>The --managed-save flag guarantees that any managed save
image (see the managedsave command) is also cleaned up.
Without the flag, attempts to undefine a domain with a
managed save image will fail.</p>

<p>The --snapshots-metadata flag guarantees that any
snapshots (see the snapshot-list command) are also cleaned
up when undefining an inactive domain. Without the flag,
attempts to undefine an inactive domain with snapshot
metadata will fail. If the domain is active, this flag is
ignored.</p>

<p>The --storage flag takes a parameter volumes, which is a
comma separated list of volume target names or source paths
of storage volumes to be removed along with the undefined
domain. Volumes can be undefined and thus removed only on
inactive domains. Volume deletion is only attempted after
the domain is undefined; if not all of the requested volumes
could be deleted, the error message indicates what still
remains behind. If a volume path is not found in the domain
definition, its treated as if the volume was successfully
deleted. Only volumes managed by libvirt in storage pools
can be removed this way. (See domblklist for list of target
names associated to a domain). Example: --storage
vda,/path/to/storage.img</p>

<p>The --remove-all-storage flag specifies that all of the
domains storage volumes should be deleted.</p>

<p>The flag --wipe-storage specifies that the storage
volumes should be wiped before removal.</p>

<p>NOTE: For an inactive domain, the domain name or UUID
must be used as the domain.</p>

<p>vcpucount domain [{--maximum | --active} {--config |
--live | --current}] [--guest] Print information about the
virtual cpu counts of the given domain. If no flags are
specified, all possible counts are listed in a table;
otherwise, the output is limited to just the numeric value
requested. For historical reasons, the table lists the label
&quot;current&quot; on the rows that can be queried in
isolation via the --active flag, rather than relating to the
--current flag.</p>

<p>--maximum requests information on the maximum cap of
vcpus that a domain can add via setvcpus, while --active
shows the current usage; these two flags cannot both be
specified. --config requires a persistent domain and
requests information regarding the next time the domain will
be booted, --live requires a running domain and lists
current values, and --current queries according to the
current state of the domain (corresponding to --live if
running, or --config if inactive); these three flags are
mutually exclusive.</p>

<p>If --guest is specified, then the count of cpus is
reported from the perspective of the guest. This flag is
usable only for live domains and may require guest agent to
be configured in the guest.</p>

<p>vcpuinfo domain Returns basic information about the
domain virtual CPUs, like the number of vCPUs, the running
time, the affinity to physical processors.</p>

<p>vcpupin domain [vcpu] [cpulist] [[--live] [--config] |
[--current]] Query or change the pinning of domain VCPUs to
host physical CPUs. To pin a single vcpu, specify cpulist;
otherwise, you can query one vcpu or omit vcpu to list all
at once.</p>

<p>cpulist is a list of physical CPU numbers. Its syntax is
a comma separated list and a special markup using - and ^
(ex. 0-4, 0-3,^2) can also be allowed. The - denotes the
range and the ^ denotes exclusive. If you want to reset
vcpupin setting, that is, to pin vcpu all physical cpus,
simply specify r as a cpulist. If --live is specified,
affect a running guest. If --config is specified, affect the
next boot of a persistent guest. If --current is specified,
affect the current guest state. Both --live and --config
flags may be given if cpulist is present, but --current is
exclusive. If no flag is specified, behavior is different
depending on hypervisor.</p>

<p>Note: The expression is sequentially evaluated, so
&quot;0-15,^8&quot; is identical to &quot;9-14,0-7,15&quot;
but not identical to &quot;^8,0-15&quot;.</p>

<p>emulatorpin domain [cpulist] [[--live] [--config] |
[--current]] Query or change the pinning of domain s
emulator threads to host physical CPUs.</p>

<p>See vcpupin for cpulist.</p>

<p>If --live is specified, affect a running guest. If
--config is specified, affect the next boot of a persistent
guest. If --current is specified, affect the current guest
state. Both --live and --config flags may be given if
cpulist is present, but --current is exclusive. If no flag
is specified, behavior is different depending on
hypervisor.</p>

<p>vncdisplay domain Output the IP address and port number
for the VNC display. If the information is not available the
processes will provide an exit code of 1.</p>

<p>DEVICE COMMANDS The following commands manipulate
devices associated to domains. The domain can be specified
as a short integer, a name or a full UUID. To better
understand the values allowed as options for the command
reading the documentation at
&lt;http://libvirt.org/formatdomain.html&gt; on the format
of the device sections to get the most accurate set of
accepted values.</p>

<p>attach-device domain FILE [[[--live] [--config] |
[--current]] | [--persistent]] Attach a device to the
domain, using a device definition in an XML file using a
device definition element such as &lt;disk&gt; or
&lt;interface&gt; as the top-level element. See the
documentation at
&lt;http://libvirt.org/formatdomain.html#elementsDevices&gt;
to learn about libvirt XML format for a device. If --config
is specified the command alters the persistent domain
configuration with the device attach taking effect the next
time libvirt starts the domain. For cdrom and floppy
devices, this command only replaces the media within an
existing device; consider using update-device for this
usage. For passthrough host devices, see also nodedev-
detach, needed if the device does not use managed mode.</p>

<p>If --live is specified, affect a running domain. If
--config is specified, affect the next startup of a
persistent domain. If --current is specified, affect the
current domain state. Both --live and --config flags may be
given, but --current is exclusive. When no flag is specified
legacy API is used whose behavior depends on the hypervisor
driver.</p>

<p>For compatibility purposes, --persistent behaves like
--config for an offline domain, and like --live --config for
a running domain.</p>

<p>attach-disk domain source target [[[--live] [--config] |
[--current]] | [--persistent]] [--driver driver]
[--subdriver subdriver] [--cache cache] [--type type]
[--mode mode] [--sourcetype sourcetype] [--serial serial]
[--shareable] [--rawio] [--address address]
[--multifunction] Attach a new disk device to the domain.
source is path for the files and devices. target controls
the bus or device under which the disk is exposed to the
guest OS. It indicates the &quot;logical&quot; device name.
driver can be file, tap or phy for the Xen hypervisor
depending on the kind of access; or qemu for the QEMU
emulator. Further details to the driver can be passed using
subdriver. For Xen subdriver can be aio, while for QEMU
subdriver should match the format of the disk source, such
as raw or qcow2. Hypervisor default will be used if
subdriver is not specified. However, the default may not be
correct, esp. for QEMU as for security reasons it is
configured not to detect disk formats. type can indicate
lun, cdrom or floppy as alternative to the disk default,
although this use only replaces the media within the
existing virtual cdrom or floppy device; consider using
update-device for this usage instead. mode can specify the
two specific mode readonly or shareable. sourcetype can
indicate the type of source (block|file) cache can be one of
&quot;default&quot;, &quot;none&quot;,
&quot;writethrough&quot;, &quot;writeback&quot;,
&quot;directsync&quot; or &quot;unsafe&quot;. serial is the
serial of disk device. shareable indicates the disk device
is shareable between domains. rawio indicates the disk needs
rawio capability. address is the address of disk device in
the form of pci:domain.bus.slot.function,
scsi:controller.bus.unit or ide:controller.bus.unit.
multifunction indicates specified pci address is a
multifunction pci device address.</p>

<p>If --live is specified, affect a running domain. If
--config is specified, affect the next startup of a
persistent domain. If --current is specified, affect the
current domain state. Both --live and --config flags may be
given, but --current is exclusive. When no flag is specified
legacy API is used whose behavior depends on the hypervisor
driver.</p>

<p>For compatibility purposes, --persistent behaves like
--config for an offline domain, and like --live --config for
a running domain.</p>

<p>attach-interface domain type source [--target target]
[--mac mac] [--script script] [--model model] [--config]
[--inbound average,peak,burst] [--outbound
average,peak,burst] Attach a new network interface to the
domain. type can be either network to indicate a physical
network device or bridge to indicate a bridge to a device.
source indicates the source device. target allows to
indicate the target device in the guest. Names starting with
vnet are considered as auto-generated an hence blanked out.
mac allows to specify the MAC address of the network
interface. script allows to specify a path to a script
handling a bridge instead of the default one. model allows
to specify the model type. --config indicates the changes
will affect the next boot of the domain, for compatibility
purposes, --persistent is alias of --config. inbound and
outbound control the bandwidth of the interface. peak and
burst are optional, so &quot;average,peak&quot;,
&quot;average,,burst&quot; and &quot;average&quot; are also
legal.</p>

<p>Note: the optional target value is the name of a device
to be created as the back-end on the node. If not provided a
device named &quot;vnetN&quot; or &quot;vifN&quot; will be
created automatically.</p>

<p>detach-device domain FILE [[[--live] [--config] |
[--current]] | [--persistent]] Detach a device from the
domain, takes the same kind of XML descriptions as command
attach-device. For passthrough host devices, see also
nodedev-reattach, needed if the device does not use managed
mode.</p>

<p>If --live is specified, affect a running domain. If
--config is specified, affect the next startup of a
persistent domain. If --current is specified, affect the
current domain state. Both --live and --config flags may be
given, but --current is exclusive. When no flag is specified
legacy API is used whose behavior depends on the hypervisor
driver.</p>

<p>For compatibility purposes, --persistent behaves like
--config for an offline domain, and like --live --config for
a running domain.</p>

<p>Note that older versions of virsh used --config as an
alias for --persistent.</p>

<p>detach-disk domain target [[[--live] [--config] |
[--current]] | [--persistent]] Detach a disk device from a
domain. The target is the device as seen from the
domain.</p>

<p>If --live is specified, affect a running domain. If
--config is specified, affect the next startup of a
persistent domain. If --current is specified, affect the
current domain state. Both --live and --config flags may be
given, but --current is exclusive. When no flag is specified
legacy API is used whose behavior depends on the hypervisor
driver.</p>

<p>For compatibility purposes, --persistent behaves like
--config for an offline domain, and like --live --config for
a running domain.</p>

<p>Note that older versions of virsh used --config as an
alias for --persistent.</p>

<p>detach-interface domain type [--mac mac] [--config]
Detach a network interface from a domain. type can be either
network to indicate a physical network device or bridge to
indicate a bridge to a device. It is recommended to use the
mac option to distinguish between the interfaces if more
than one are present on the domain. If --config is
specified, alter persistent configuration, effect observed
on next boot, for compatibility purposes, --persistent is
alias of --config.</p>

<p>update-device domain file [--force] [[[--live]
[--config] | [--current]] | [--persistent]] Update the
characteristics of a device associated with domain, based on
the device definition in an XML file. The --force option can
be used to force device update, e.g., to eject a CD-ROM even
if it is locked/mounted in the domain. See the documentation
at
&lt;http://libvirt.org/formatdomain.html#elementsDevices&gt;
to learn about libvirt XML format for a device.</p>

<p>If --live is specified, affect a running domain. If
--config is specified, affect the next startup of a
persistent domain. If --current is specified, affect the
current domain state. Both --live and --config flags may be
given, but --current is exclusive. Not specifying any flag
is the same as specifying --current.</p>

<p>For compatibility purposes, --persistent behaves like
--config for an offline domain, and like --live --config for
a running domain.</p>

<p>Note that older versions of virsh used --config as an
alias for --persistent.</p>

<p>change-media domain path [--eject] [--insert] [--update]
[source] [--force] [[--live] [--config] | [--current]]
Change media of CDROM or floppy drive. path can be the
fully- qualified path or the unique target name (&lt;target
dev= hdc&gt;) of the disk device. source specifies the path
of the media to be inserted or updated.</p>

<p>--eject indicates the media will be ejected. --insert
indicates the media will be inserted. source must be
specified. If the device has source (e.g. &lt;source file=
media &gt;), and source is not specified, --update is equal
to --eject. If the device has no source, and source is
specified, --update is equal to --insert. If the device has
source, and source is specified, --update behaves like
combination of --eject and --insert. If none of --eject,
--insert, and --update is specified, --update is used by
default. The --force option can be used to force media
changing. If --live is specified, alter live configuration
of running guest. If --config is specified, alter persistent
configuration, effect observed on next boot. --current can
be either or both of live and config, depends on the
hypervisor s implementation. Both --live and --config flags
may be given, but --current is exclusive. If no flag is
specified, behavior is different depending on
hypervisor.</p>

<p>NODEDEV COMMANDS The following commands manipulate host
devices that are intended to be passed through to guest
domains via &lt;hostdev&gt; elements in a domains
&lt;devices&gt; section. A node device key is generally
specified by the bus name followed by its address, using
underscores between all components, such as
pci_0000_00_02_1, usb_1_5_3, or net_eth1_00_27_13_6a_fe_00.
The nodedev-list gives the full list of host devices that
are known to libvirt, although this includes devices that
cannot be assigned to a guest (for example, attempting to
detach the PCI device that controls the host s hard disk
controller where the guests disk images live could cause the
host system to lock up or reboot).</p>

<p>For more information on node device definition see:
&lt;http://libvirt.org/formatnode.html&gt;.</p>

<p>Passthrough devices cannot be simultaneously used by the
host and its guest domains, nor by multiple active guests at
once. If the &lt;hostdev&gt; description includes the
attribute managed=yes , and the hypervisor driver supports
it, then the device is in managed mode, and attempts to use
that passthrough device in an active guest will
automatically behave as if nodedev-detach (guest start,
device hot-plug) and nodedev- reattach (guest stop, device
hot-unplug) were called at the right points (currently, qemu
does this for PCI devices, but not USB). If a device is not
marked as managed, then it must manually be detached before
guests can use it, and manually reattached to be returned to
the host. Also, if a device is manually detached, then the
host does not regain control of the device without a
matching reattach, even if the guests use the device in
managed mode.</p>

<p>nodedev-create FILE Create a device on the host node
that can then be assigned to virtual machines. Normally,
libvirt is able to automatically determine which host nodes
are available for use, but this allows registration of host
hardware that libvirt did not automatically detect. file
contains xml for a top-level &lt;device&gt; description of a
node device.</p>

<p>nodedev-destroy nodedev Destroy (stop) a device on the
host. Note that this makes libvirt quit managing a host
device, and may even make that device unusable by the rest
of the physical host until a reboot.</p>

<p>nodedev-detach nodedev Detach nodedev from the host, so
that it can safely be used by guests via &lt;hostdev&gt;
passthrough. This is reversed with nodedev- reattach, and is
done automatically for managed devices. For compatibility
purposes, this command can also be spelled nodedev-
dettach.</p>

<p>nodedev-dumpxml nodedev Dump a &lt;device&gt; XML
representation for the given node device, including such
information as the device name, which bus owns the device,
the vendor and product id, and any capabilities of the
device usable by libvirt (such as whether device reset is
supported).</p>

<p>nodedev-list cap --tree List all of the devices
available on the node that are known by libvirt. cap is used
to filter the list by capability types, the types must be
separated by comma, e.g. --cap pci,scsi, valid capability
types include system, pci, usb_device, usb, net , scsi_host,
scsi_target, scsi, storage. If --tree is used, the output is
formatted in a tree representing parents of each node. cap
and --tree are mutually exclusive.</p>

<p>nodedev-reattach nodedev Declare that nodedev is no
longer in use by any guests, and that the host can resume
normal use of the device. This is done automatically for
devices in managed mode, but must be done explicitly to
match any explicit nodedev-detach.</p>

<p>nodedev-reset nodedev Trigger a device reset for
nodedev, useful prior to transferring a node device between
guest passthrough or the host. Libvirt will often do this
action implicitly when required, but this command allows an
explicit reset when needed.</p>

<p>VIRTUAL NETWORK COMMANDS The following commands
manipulate networks. Libvirt has the capability to define
virtual networks which can then be used by domains and
linked to actual network devices. For more detailed
information about this feature see the documentation at
&lt;http://libvirt.org/formatnetwork.html&gt; . Many of the
commands for virtual networks are similar to the ones used
for domains, but the way to name a virtual network is either
by its name or UUID.</p>

<p>net-autostart network [--disable] Configure a virtual
network to be automatically started at boot. The --disable
option disable autostarting.</p>

<p>net-create file Create a virtual network from an XML
file, see the documentation at
&lt;http://libvirt.org/formatnetwork.html&gt; to get a
description of the XML network format used by libvirt.</p>

<p>net-define file Define a virtual network from an XML
file, the network is just defined but not instantiated.</p>

<p>net-destroy network Destroy (stop) a given virtual
network specified by its name or UUID. This takes effect
immediately.</p>

<p>net-dumpxml network [--inactive] Output the virtual
network information as an XML dump to stdout. If --inactive
is specified, then physical functions are not expanded into
their associated virtual functions.</p>

<p>net-edit network Edit the XML configuration file for a
network.</p>

<p>This is equivalent to:</p>

<p>virsh net-dumpxml --inactive network &gt; network.xml vi
network.xml (or make changes with your other text editor)
virsh net-define network.xml</p>

<p>except that it does some error checking.</p>

<p>The editor used can be supplied by the $VISUAL or
$EDITOR environment variables, and defaults to
&quot;vi&quot;.</p>

<p>net-info network Returns basic information about the
network object.</p>

<p>net-list [--inactive | --all] [--persistent]
[&lt;--transient&gt;] [--autostart] [&lt;--no-autostart&gt;]
Returns the list of active networks, if --all is specified
this will also include defined but inactive networks, if
--inactive is specified only the inactive ones will be
listed. You may also want to filter the returned networks by
--persistent to list the persistent ones, --transient to
list the transient ones, --autostart to list the ones with
autostart enabled, and --no-autostart to list the ones with
autostart disabled.</p>

<p>NOTE: When talking to older servers, this command is
forced to use a series of API calls with an inherent race,
where a pool might not be listed or might appear more than
once if it changed state between calls while the list was
being collected. Newer servers do not have this problem.</p>

<p>net-name network-UUID Convert a network UUID to network
name.</p>

<p>net-start network Start a (previously defined) inactive
network.</p>

<p>net-undefine network Undefine the configuration for an
inactive network.</p>

<p>net-uuid network-name Convert a network name to network
UUID.</p>

<p>net-update network command section xml [--parent-index
index] [[--live] [--config] | [--current]] Update the given
section of an existing network definition, with the changes
optionally taking effect immediately, without needing to
destroy and re-start the network.</p>

<p>command is one of &quot;add-first&quot;,
&quot;add-last&quot;, &quot;add&quot; (a synonym for
add-last), &quot;delete&quot;, or &quot;modify&quot;.</p>

<p>section is one of &quot;&quot;bridge&quot;,
&quot;domain&quot;, &quot;ip&quot;,
&quot;ip-dhcp-host&quot;, &quot;ip- dhcp-range&quot;,
&quot;forward&quot;, &quot;forward-interface&quot;,
&quot;forward-pf&quot;, &quot;portgroup&quot;,
&quot;dns-host&quot;, &quot;dns-txt&quot;, or
&quot;dns-srv&quot;, each section being named by a
concatenation of the xml element hierarchy leading to the
element being changed. For example, &quot;ip-dhcp-host&quot;
will change a &lt;host&gt; element that is contained inside
a &lt;dhcp&gt; element inside an &lt;ip&gt; element of the
network.</p>

<p>xml is either the text of a complete xml element of the
type being changed (e.g. &quot;&lt;host
mac=&quot;00:11:22:33:44:55 ip=1.2.3.4 /&gt;&quot;, or the
name of a file that contains a complete xml element.
Disambiguation is done by looking at the first character of
the provided text - if the first character is
&quot;&lt;&quot;, it is xml text, if the first character is
not &quot;&lt;&quot;, it is the name of a file that contains
the xml text to be used.</p>

<p>The --parent-index option is used to specify which of
several parent elements the requested element is in
(0-based). For example, a dhcp &lt;host&gt; element could be
in any one of multiple &lt;ip&gt; elements in the network;
if a parent-index isnt provided, the &quot;most
appropriate&quot; &lt;ip&gt; element will be selected
(usually the only one that already has a &lt;dhcp&gt;
element), but if --parent-index is given, that particular
instance of &lt;ip&gt; will get the modification.</p>

<p>If --live is specified, affect a running network. If
--config is specified, affect the next startup of a
persistent network. If --current is specified, affect the
current network state. Both --live and --config flags may be
given, but --current is exclusive. Not specifying any flag
is the same as specifying --current.</p>

<p>INTERFACE COMMANDS The following commands manipulate
host interfaces. Often, these host interfaces can then be
used by name within domain &lt;interface&gt; elements (such
as a system-created bridge interface), but there is no
requirement that host interfaces be tied to any particular
guest configuration XML at all.</p>

<p>Many of the commands for host interfaces are similar to
the ones used for domains, and the way to name an interface
is either by its name or its MAC address. However, using a
MAC address for an iface argument only works when that
address is unique (if an interface and a bridge share the
same MAC address, which is often the case, then using that
MAC address results in an error due to ambiguity, and you
must resort to a name instead).</p>

<p>iface-bridge interface bridge [--no-stp] [delay]
[--no-start] Create a bridge device named bridge, and attach
the existing network device interface to the new bridge. The
new bridge defaults to starting immediately, with STP
enabled and a delay of 0; these settings can be altered with
--no-stp, --no-start, and an integer number of seconds for
delay. All IP address configuration of interface will be
moved to the new bridge device.</p>

<p>See also iface-unbridge for undoing this operation.</p>

<p>iface-define file Define a host interface from an XML
file, the interface is just defined but not started.</p>

<p>iface-destroy interface Destroy (stop) a given host
interface, such as by running &quot;if-down&quot; to disable
that interface from active use. This takes effect
immediately.</p>

<p>iface-dumpxml interface [--inactive] Output the host
interface information as an XML dump to stdout. If
--inactive is specified, then the output reflects the
persistent state of the interface that will be used the next
time it is started.</p>

<p>iface-edit interface Edit the XML configuration file for
a host interface.</p>

<p>This is equivalent to:</p>

<p>virsh iface-dumpxml iface &gt; iface.xml vi iface.xml
(or make changes with your other text editor) virsh
iface-define iface.xml</p>

<p>except that it does some error checking.</p>

<p>The editor used can be supplied by the $VISUAL or
$EDITOR environment variables, and defaults to
&quot;vi&quot;.</p>

<p>iface-list [--inactive | --all] Returns the list of
active host interfaces. If --all is specified this will also
include defined but inactive interfaces. If --inactive is
specified only the inactive ones will be listed.</p>

<p>iface-name interface Convert a host interface MAC to
interface name, if the MAC address is unique among the hosts
interfaces.</p>

<p>interface specifies the interface MAC address.</p>

<p>iface-mac interface Convert a host interface name to MAC
address.</p>

<p>interface specifies the interface name.</p>

<p>iface-start interface Start a (previously defined) host
interface, such as by running &quot;if-up&quot;.</p>

<p>iface-unbridge bridge [--no-start] Tear down a bridge
device named bridge, releasing its underlying interface back
to normal usage, and moving all IP address configuration
from the bridge device to the underlying device. The
underlying interface is restarted unless --no-start is
present; this flag is present for symmetry, but generally
not recommended.</p>

<p>See also iface-bridge for creating a bridge.</p>

<p>iface-undefine interface Undefine the configuration for
an inactive host interface.</p>

<p>iface-begin Create a snapshot of current host interface
settings, which can later be committed (iface-commit) or
restored (iface-rollback). If a snapshot already exists,
then this command will fail until the previous snapshot has
been committed or restored. Undefined behavior results if
any external changes are made to host interfaces outside of
the libvirt API between the beginning of a snapshot and its
eventual commit or rollback.</p>

<p>iface-commit Declare all changes since the last
iface-begin as working, and delete the rollback point. If no
interface snapshot has already been started, then this
command will fail.</p>

<p>iface-rollback Revert all host interface settings back
to the state recorded in the last iface-begin. If no
interface snapshot has already been started, then this
command will fail. Rebooting the host also serves as an
implicit rollback point.</p>

<p>STORAGE POOL COMMANDS The following commands manipulate
storage pools. Libvirt has the capability to manage various
storage solutions, including files, raw partitions, and
domain-specific formats, used to provide the storage volumes
visible as devices within virtual machines. For more
detailed information about this feature, see the
documentation at
&lt;http://libvirt.org/formatstorage.html&gt; . Many of the
commands for pools are similar to the ones used for
domains.</p>

<p>find-storage-pool-sources type [srcSpec] Returns XML
describing all storage pools of a given type that could be
found. If srcSpec is provided, it is a file that contains
XML to further restrict the query for pools.</p>

<p>find-storage-pool-sources-as type [host] [port]
[initiator] Returns XML describing all storage pools of a
given type that could be found. If host, port, or initiator
are provided, they control where the query is performed.</p>

<p>pool-autostart pool-or-uuid [--disable] Configure
whether pool should automatically start at boot.</p>

<p>pool-build pool-or-uuid [--overwrite] [--no-overwrite]
Build a given pool.</p>

<p>Options --overwrite and --no-overwrite can only be used
for pool- build a filesystem pool. If neither of them is
specified, pool- build on a filesystem pool only makes the
directory; If --no-overwrite is specified, it probes to
determine if a filesystem already exists on the target
device, returning an error if exists, or using mkfs to
format the target device if not; If --overwrite is
specified, mkfs is always executed, any existed data on the
target device is overwritten unconditionally.</p>

<p>pool-create file Create and start a pool object from the
XML file.</p>

<p>pool-create-as name --print-xml type [source-host]
[source-path] [source-dev] [source-name] [&lt;target&gt;]
[--source-format format] Create and start a pool object name
from the raw parameters. If --print-xml is specified, then
print the XML of the pool object without creating the pool.
Otherwise, the pool has the specified type. When using
pool-create-as for a pool of type &quot;disk&quot;, the
existing partitions found on the --source-dev path will be
used to populate the disk pool. Therefore, it is suggested
to use pool- define-as and pool-build with the --overwrite
in order to properly initialize the disk pool.</p>

<p>pool-define file Create, but do not start, a pool object
from the XML file.</p>

<p>pool-define-as name --print-xml type [source-host]
[source-path] [source-dev] [source-name] [&lt;target&gt;]
[--source-format format] Create, but do not start, a pool
object name from the raw parameters. If --print-xml is
specified, then print the XML of the pool object without
defining the pool. Otherwise, the pool has the specified
type.</p>

<p>pool-destroy pool-or-uuid Destroy (stop) a given pool
object. Libvirt will no longer manage the storage described
by the pool object, but the raw data contained in the pool
is not changed, and can be later recovered with
pool-create.</p>

<p>pool-delete pool-or-uuid Destroy the resources used by a
given pool object. This operation is non-recoverable. The
pool object will still exist after this command, ready for
the creation of new storage volumes.</p>

<p>pool-dumpxml [--inactive] pool-or-uuid Returns the XML
information about the pool object. --inactive tells virsh to
dump pool configuration that will be used on next start of
the pool as opposed to the current pool configuration.</p>

<p>pool-edit pool-or-uuid Edit the XML configuration file
for a storage pool.</p>

<p>This is equivalent to:</p>

<p>virsh pool-dumpxml pool &gt; pool.xml vi pool.xml (or
make changes with your other text editor) virsh pool-define
pool.xml</p>

<p>except that it does some error checking.</p>

<p>The editor used can be supplied by the $VISUAL or
$EDITOR environment variables, and defaults to
&quot;vi&quot;.</p>

<p>pool-info pool-or-uuid Returns basic information about
the pool object.</p>

<p>pool-list [--inactive] [--all] [--persistent]
[--transient] [--autostart] [--no-autostart] [[--details]
[&lt;type&gt;] List pool objects known to libvirt. By
default, only active pools are listed; --inactive lists just
the inactive pools, and --all lists all pools.</p>

<p>In addition, there are several sets of filtering flags.
--persistent is to list the persistent pools, --transient is
to list the transient pools. --autostart lists the
autostarting pools, --no-autostart lists the pools with
autostarting disabled.</p>

<p>You may also want to list pools with specified types
using type, the pool types must be separated by comma, e.g.
--type dir,disk. The valid pool types include dir, fs,
netfs, logical, disk, iscsi, scsi, mpath, rbd, and
sheepdog.</p>

<p>The --details option instructs virsh to additionally
display pool persistence and capacity related information
where available.</p>

<p>NOTE: When talking to older servers, this command is
forced to use a series of API calls with an inherent race,
where a pool might not be listed or might appear more than
once if it changed state between calls while the list was
being collected. Newer servers do not have this problem.</p>

<p>pool-name uuid Convert the uuid to a pool name.</p>

<p>pool-refresh pool-or-uuid Refresh the list of volumes
contained in pool.</p>

<p>pool-start pool-or-uuid Start the storage pool, which is
previously defined but inactive.</p>

<p>pool-undefine pool-or-uuid Undefine the configuration
for an inactive pool.</p>

<p>pool-uuid pool Returns the UUID of the named pool.</p>

<p>VOLUME COMMANDS vol-create pool-or-uuid FILE Create a
volume from an XML &lt;file&gt;. pool-or-uuid is the name or
UUID of the storage pool to create the volume in. FILE is
the XML &lt;file&gt; with the volume definition. An easy way
to create the XML &lt;file&gt; is to use the vol-dumpxml
command to obtain the definition of a pre-existing
volume.</p>

<p>Example</p>

<p>virsh vol-dumpxml --pool storagepool1 appvolume1 &gt;
newvolume.xml vi newvolume.xml (or make changes with your
other text editor) virsh vol-create differentstoragepool
newvolume.xml</p>

<p>vol-create-from pool-or-uuid FILE [--inputpool
pool-or-uuid] vol-name- or-key-or-path Create a volume,
using another volume as input. pool-or-uuid is the name or
UUID of the storage pool to create the volume in. FILE is
the XML &lt;file&gt; with the volume definition. --inputpool
pool-or- uuid is the name or uuid of the storage pool the
source volume is in. vol-name-or-key-or-path is the name or
key or path of the source volume.</p>

<p>vol-create-as pool-or-uuid name capacity [--allocation
size] [--format string] [--backing-vol
vol-name-or-key-or-path] [--backing-vol-format string]
Create a volume from a set of arguments. pool-or-uuid is the
name or UUID of the storage pool to create the volume in.
name is the name of the new volume. For a disk pool, this
must match the partition name as determined from the pools
source device path and the next available partition. For
example, a source device path of /dev/sdb and there are no
partitions on the disk, then the name must be sdb1 with the
next name being sdb2 and so on. capacity is the size of the
volume to be created, as a scaled integer (see NOTES above),
defaulting to bytes if there is no suffix. --allocation size
is the initial size to be allocated in the volume, also as a
scaled integer defaulting to bytes. --format string is used
in file based storage pools to specify the volume file
format to use; raw, bochs, qcow, qcow2, vmdk, qed. Use
extended for disk storage pools in order to create an
extended partition (other values are validity checked but
not preserved when libvirtd is restarted or the pool is
refreshed). --backing-vol vol-name-or-key-or-path is the
source backing volume to be used if taking a snapshot of an
existing volume. --backing-vol-format string is the format
of the snapshot backing volume; raw, bochs, qcow, qcow2,
qed, vmdk, host_device. These are, however, meant for file
based storage pools.</p>

<p>vol-clone [--pool pool-or-uuid] vol-name-or-key-or-path
name Clone an existing volume. Less powerful, but easier to
type, version of vol-create-from. --pool pool-or-uuid is the
name or UUID of the storage pool to create the volume in.
vol-name-or-key- or-path is the name or key or path of the
source volume. name is the name of the new volume.</p>

<p>vol-delete [--pool pool-or-uuid] vol-name-or-key-or-path
Delete a given volume. --pool pool-or-uuid is the name or
UUID of the storage pool the volume is in.
vol-name-or-key-or-path is the name or key or path of the
volume to delete.</p>

<p>vol-upload [--pool pool-or-uuid] [--offset bytes]
[--length bytes] vol- name-or-key-or-path local-file Upload
the contents of local-file to a storage volume. --pool
pool-or-uuid is the name or UUID of the storage pool the
volume is in. vol-name-or-key-or-path is the name or key or
path of the volume where the file will be uploaded. --offset
is the position in the storage volume at which to start
writing the data. --length is an upper bound of the amount
of data to be uploaded. An error will occurr if the
local-file is greater than the specified length.</p>

<p>vol-download [--pool pool-or-uuid] [--offset bytes]
[--length bytes] vol-name-or-key-or-path local-file Download
the contents of a storage volume to local-file. --pool
pool-or-uuid is the name or UUID of the storage pool the
volume is in. vol-name-or-key-or-path is the name or key or
path of the volume to download. --offset is the position in
the storage volume at which to start reading the data.
--length is an upper bound of the amount of data to be
downloaded.</p>

<p>vol-wipe [--pool pool-or-uuid] [--algorithm algorithm]
vol-name-or-key- or-path Wipe a volume, ensure data
previously on the volume is not accessible to future reads.
--pool pool-or-uuid is the name or UUID of the storage pool
the volume is in. vol-name-or-key-or-path is the name or key
or path of the volume to wipe. It is possible to choose
different wiping algorithms instead of re-writing volume
with zeroes. This can be done via --algorithm switch.</p>

<p>Supported algorithms zero - 1-pass all zeroes nnsa -
4-pass NNSA Policy Letter NAP-14.1-C (XVI-8) for sanitizing
removable and non-removable hard disks: random x2, 0x00,
verify. dod - 4-pass DoD 5220.22-M section 8-306 procedure
for sanitizing removeable and non-removeable rigid disks:
random, 0x00, 0xff, verify. bsi - 9-pass method recommended
by the German Center of Security in Information Technologies
(http://www.bsi.bund.de): 0xff, 0xfe, 0xfd, 0xfb, 0xf7,
0xef, 0xdf, 0xbf, 0x7f. gutmann - The canonical 35-pass
sequence described in Gutmanns paper. schneier - 7-pass
method described by Bruce Schneier in &quot;Applied
Cryptography&quot; (1996): 0x00, 0xff, random x5. pfitzner7
- Roy Pfitzner s 7-random-pass method: random x7. pfitzner33
- Roy Pfitzner s 33-random-pass method: random x33. random -
1-pass pattern: random.</p>

<p>Note: The availability of algorithms may be limited by
the version of the &quot;scrub&quot; binary installed on the
host.</p>

<p>vol-dumpxml [--pool pool-or-uuid]
vol-name-or-key-or-path Output the volume information as an
XML dump to stdout. --pool pool-or-uuid is the name or UUID
of the storage pool the volume is in.
vol-name-or-key-or-path is the name or key or path of the
volume to output the XML of.</p>

<p>vol-info [--pool pool-or-uuid] vol-name-or-key-or-path
Returns basic information about the given storage volume.
--pool pool-or-uuid is the name or UUID of the storage pool
the volume is in. vol-name-or-key-or-path is the name or key
or path of the volume to return information for.</p>

<p>vol-list [--pool pool-or-uuid] [--details] Return the
list of volumes in the given storage pool. --pool pool-
or-uuid is the name or UUID of the storage pool. The
--details option instructs virsh to additionally display
volume type and capacity related information where
available.</p>

<p>vol-pool [--uuid] vol-key-or-path Return the pool name
or UUID for a given volume. By default, the pool name is
returned. If the --uuid option is given, the pool UUID is
returned instead. vol-key-or-path is the key or path of the
volume to return the pool information for.</p>

<p>vol-path [--pool pool-or-uuid] vol-name-or-key Return
the path for a given volume. --pool pool-or-uuid is the name
or UUID of the storage pool the volume is in.
vol-name-or-key is the name or key of the volume to return
the path for.</p>

<p>vol-name vol-key-or-path Return the name for a given
volume. vol-key-or-path is the key or path of the volume to
return the name for.</p>

<p>vol-key [--pool pool-or-uuid] vol-name-or-path Return
the volume key for a given volume. --pool pool-or-uuid is
the name or UUID of the storage pool the volume is in.
vol-name-or- path is the name or path of the volume to
return the volume key for.</p>

<p>vol-resize [--pool pool-or-uuid] vol-name-or-path
pool-or-uuid capacity [--allocate] [--delta] [--shrink]
Resize the capacity of the given volume, in bytes. --pool
pool-or- uuid is the name or UUID of the storage pool the
volume is in. vol- name-or-key-or-path is the name or key or
path of the volume to resize. The new capacity might be
sparse unless --allocate is specified. Normally, capacity is
the new size, but if --delta is present, then it is added to
the existing size. Attempts to shrink the volume will fail
unless --shrink is present; capacity cannot be negative
unless --shrink is provided, but a negative sign is not
necessary. capacity is a scaled integer (see NOTES above),
which defaults to bytes if there is no suffix. This command
is only safe for storage volumes not in use by an active
guest; see also blockresize for live resizing.</p>

<p>SECRET COMMANDS The following commands manipulate
&quot;secrets&quot; (e.g. passwords, passphrases and
encryption keys). Libvirt can store secrets independently
from their use, and other objects (e.g. volumes or domains)
can refer to the secrets for encryption or possibly other
uses. Secrets are identified using an UUID. See
&lt;http://libvirt.org/formatsecret.html&gt; for
documentation of the XML format used to represent properties
of secrets.</p>

<p>secret-define file Create a secret with the properties
specified in file, with no associated secret value. If file
does not specify a UUID, choose one automatically. If file
specifies an UUID of an existing secret, replace its
properties by properties defined in file, without affecting
the secret value.</p>

<p>secret-dumpxml secret Output properties of secret
(specified by its UUID) as an XML dump to stdout.</p>

<p>secret-set-value secret base64 Set the value associated
with secret (specified by its UUID) to the value
Base64-encoded value base64.</p>

<p>secret-get-value secret Output the value associated with
secret (specified by its UUID) to stdout, encoded using
Base64.</p>

<p>secret-undefine secret Delete a secret (specified by its
UUID), including the associated value, if any.</p>

<p>secret-list [--ephemeral] [--no-ephemeral] [--private]
[--no-private] Returns the list of secrets. You may also
want to filter the returned secrets by --ephemeral to list
the ephemeral ones, --no-ephemeral to list the non-ephemeral
ones, --private to list the private ones, and --no-private
to list the non-private ones.</p>

<p>SNAPSHOT COMMANDS The following commands manipulate
domain snapshots. Snapshots take the disk, memory, and
device state of a domain at a point-of-time, and save it for
future use. They have many uses, from saving a
&quot;clean&quot; copy of an OS image to saving a domains
state before a potentially destructive operation. Snapshots
are identified with a unique name. See
&lt;http://libvirt.org/formatsnapshot.html&gt; for
documentation of the XML format used to represent properties
of snapshots.</p>

<p>snapshot-create domain [xmlfile] {[--redefine
[--current]] | [--no-metadata] [--halt] [--disk-only]
[--reuse-external] [--quiesce] [--atomic] [--live]} Create a
snapshot for domain domain with the properties specified in
xmlfile. Normally, the only properties settable for a domain
snapshot are the &lt;name&gt; and &lt;description&gt;
elements, as well as &lt;disks&gt; if --disk-only is given;
the rest of the fields are ignored, and automatically filled
in by libvirt. If xmlfile is completely omitted, then
libvirt will choose a value for all fields. The new snapshot
will become current, as listed by snapshot-current.</p>

<p>If --halt is specified, the domain will be left in an
inactive state after the snapshot is created.</p>

<p>If --disk-only is specified, the snapshot will only
include disk state rather than the usual system checkpoint
with vm state. Disk snapshots are faster than full system
checkpoints, but reverting to a disk snapshot may require
fsck or journal replays, since it is like the disk state at
the point when the power cord is abruptly pulled; and mixing
--halt and --disk-only loses any data that was not flushed
to disk at the time.</p>

<p>If --redefine is specified, then all XML elements
produced by snapshot-dumpxml are valid; this can be used to
migrate snapshot hierarchy from one machine to another, to
recreate hierarchy for the case of a transient domain that
goes away and is later recreated with the same name and
UUID, or to make slight alterations in the snapshot metadata
(such as host-specific aspects of the domain XML embedded in
the snapshot). When this flag is supplied, the xmlfile
argument is mandatory, and the domains current snapshot will
not be altered unless the --current flag is also given.</p>

<p>If --no-metadata is specified, then the snapshot data is
created, but any metadata is immediately discarded (that is,
libvirt does not treat the snapshot as current, and cannot
revert to the snapshot unless --redefine is later used to
teach libvirt about the metadata again).</p>

<p>If --reuse-external is specified, and the snapshot XML
requests an external snapshot with a destination of an
existing file, then the destination must exist, and is
reused; otherwise, a snapshot is refused to avoid losing
contents of the existing files.</p>

<p>If --quiesce is specified, libvirt will try to use guest
agent to freeze and unfreeze domain s mounted file systems.
However, if domain has no guest agent, snapshot creation
will fail. Currently, this requires --disk-only to be passed
as well.</p>

<p>If --atomic is specified, libvirt will guarantee that
the snapshot either succeeds, or fails with no changes; not
all hypervisors support this. If this flag is not specified,
then some hypervisors may fail after partially performing
the action, and dumpxml must be used to see whether any
partial changes occurred.</p>

<p>If --live is specified, libvirt takes the snapshot while
the guest is running. This increases the size of the memory
image of the external checkpoint. This is currently
supported only for external checkpoints.</p>

<p>Existence of snapshot metadata will prevent attempts to
undefine a persistent domain. However, for transient
domains, snapshot metadata is silently lost when the domain
quits running (whether by command such as destroy or by
internal guest action).</p>

<p>snapshot-create-as domain {[--print-xml] |
[--no-metadata] [--halt] [--reuse-external]} [name]
[description] [--disk-only [--quiesce]] [--atomic] [[--live]
[--memspec memspec]] [--diskspec] diskspec]... Create a
snapshot for domain domain with the given &lt;name&gt; and
&lt;description&gt;; if either value is omitted, libvirt
will choose a value. If --print-xml is specified, then XML
appropriate for snapshot-create is output, rather than
actually creating a snapshot. Otherwise, if --halt is
specified, the domain will be left in an inactive state
after the snapshot is created, and if --disk-only is
specified, the snapshot will not include vm state.</p>

<p>The --memspec option can be used to control whether a
checkpoint is internal or external. The --memspec flag is
mandatory, followed by a memspec of the form
[file=]name[,snapshot=type], where type can be none,
internal, or external. To include a literal comma in
file=name, escape it with a second comma. --memspec cannot
be used together with --disk-only.</p>

<p>The --diskspec option can be used to control how
--disk-only and external checkpoints create external files.
This option can occur multiple times, according to the
number of &lt;disk&gt; elements in the domain xml. Each
&lt;diskspec&gt; is in the form
disk[,snapshot=type][,driver=type][,file=name]. To include a
literal comma in disk or in file=name, escape it with a
second comma. A literal --diskspec must preceed each
diskspec unless all three of domain, name, and description
are also present. For example, a diskspec of
&quot;vda,snapshot=external,file=/path/to,,new&quot; results
in the following XML: &lt;disk name=vda
snapshot=external&gt; &lt;source file=/path/to,new/&gt;
&lt;/disk&gt;</p>

<p>If --reuse-external is specified, and the domain XML or
diskspec option requests an external snapshot with a
destination of an existing file, then the destination must
exist, and is reused; otherwise, a snapshot is refused to
avoid losing contents of the existing files.</p>

<p>If --quiesce is specified, libvirt will try to use guest
agent to freeze and unfreeze domain s mounted file systems.
However, if domain has no guest agent, snapshot creation
will fail. Currently, this requires --disk-only to be passed
as well.</p>

<p>If --no-metadata is specified, then the snapshot data is
created, but any metadata is immediately discarded (that is,
libvirt does not treat the snapshot as current, and cannot
revert to the snapshot unless snapshot-create is later used
to teach libvirt about the metadata again). This flag is
incompatible with --print-xml.</p>

<p>If --atomic is specified, libvirt will guarantee that
the snapshot either succeeds, or fails with no changes; not
all hypervisors support this. If this flag is not specified,
then some hypervisors may fail after partially performing
the action, and dumpxml must be used to see whether any
partial changes occurred.</p>

<p>If --live is specified, libvirt takes the snapshot while
the guest is running. This increases the size of the memory
image of the external checkpoint. This is currently
supported only for external checkpoints.</p>

<p>snapshot-current domain {[--name] | [--security-info] |
[snapshotname]} Without snapshotname, this will output the
snapshot XML for the domains current snapshot (if any). If
--name is specified, just the current snapshot name instead
of the full xml. Otherwise, using --security-info will also
include security sensitive information in the XML.</p>

<p>With snapshotname, this is a request to make the
existing named snapshot become the current snapshot, without
reverting the domain.</p>

<p>snapshot-edit domain [snapshotname] [--current]
{[--rename] | [--clone]} Edit the XML configuration file for
snapshotname of a domain. If both snapshotname and --current
are specified, also force the edited snapshot to become the
current snapshot. If snapshotname is omitted, then --current
must be supplied, to edit the current snapshot.</p>

<p>This is equivalent to:</p>

<p>virsh snapshot-dumpxml dom name &gt; snapshot.xml vi
snapshot.xml (or make changes with your other text editor)
virsh snapshot-create dom snapshot.xml --redefine
[--current]</p>

<p>except that it does some error checking.</p>

<p>The editor used can be supplied by the $VISUAL or
$EDITOR environment variables, and defaults to
&quot;vi&quot;.</p>

<p>If --rename is specified, then the edits can change the
snapshot name. If --clone is specified, then changing the
snapshot name will create a clone of the snapshot metadata.
If neither is specified, then the edits must not change the
snapshot name. Note that changing a snapshot name must be
done with care, since the contents of some snapshots, such
as internal snapshots within a single qcow2 file, are
accessible only from the original name.</p>

<p>snapshot-info domain {snapshot | --current} Output basic
information about a named &lt;snapshot&gt;, or the current
snapshot with --current.</p>

<p>snapshot-list domain [{--parent | --roots | --tree}]
[{[--from] snapshot | --current} [--descendants]]
[--metadata] [--no-metadata] [--leaves] [--no-leaves]
[--inactive] [--active] [--disk-only] [--internal]
[--external] List all of the available snapshots for the
given domain, defaulting to show columns for the snapshot
name, creation time, and domain state.</p>

<p>If --parent is specified, add a column to the output
table giving the name of the parent of each snapshot. If
--roots is specified, the list will be filtered to just
snapshots that have no parents. If --tree is specified, the
output will be in a tree format, listing just snapshot
names. These three options are mutually exclusive.</p>

<p>If --from is provided, filter the list to snapshots
which are children of the given snapshot; or if --current is
provided, start at the current snapshot. When used in
isolation or with --parent, the list is limited to direct
children unless --descendants is also present. When used
with --tree, the use of --descendants is implied. This
option is not compatible with --roots. Note that the
starting point of --from or --current is not included in the
list unless the --tree option is also present.</p>

<p>If --leaves is specified, the list will be filtered to
just snapshots that have no children. Likewise, if
--no-leaves is specified, the list will be filtered to just
snapshots with children. (Note that omitting both options
does no filtering, while providing both options will either
produce the same list or error out depending on whether the
server recognizes the flags). Filtering options are not
compatible with --tree.</p>

<p>If --metadata is specified, the list will be filtered to
just snapshots that involve libvirt metadata, and thus would
prevent undefine of a persistent domain, or be lost on
destroy of a transient domain. Likewise, if --no-metadata is
specified, the list will be filtered to just snapshots that
exist without the need for libvirt metadata.</p>

<p>If --inactive is specified, the list will be filtered to
snapshots that were taken when the domain was shut off. If
--active is specified, the list will be filtered to
snapshots that were taken when the domain was running, and
where the snapshot includes the memory state to revert to
that running state. If --disk-only is specified, the list
will be filtered to snapshots that were taken when the
domain was running, but where the snapshot includes only
disk state.</p>

<p>If --internal is specified, the list will be filtered to
snapshots that use internal storage of existing disk images.
If --external is specified, the list will be filtered to
snapshots that use external files for disk images or memory
state.</p>

<p>snapshot-dumpxml domain snapshot [--security-info]
Output the snapshot XML for the domains snapshot named
snapshot. Using --security-info will also include security
sensitive information. Use snapshot-current to easily access
the XML of the current snapshot.</p>

<p>snapshot-parent domain {snapshot | --current} Output the
name of the parent snapshot, if any, for the given snapshot,
or for the current snapshot with --current.</p>

<p>snapshot-revert domain {snapshot | --current}
[{--running | --paused}] [--force] Revert the given domain
to the snapshot specified by snapshot, or to the current
snapshot with --current. Be aware that this is a destructive
action; any changes in the domain since the last snapshot
was taken will be lost. Also note that the state of the
domain after snapshot-revert is complete will be the state
of the domain at the time the original snapshot was
taken.</p>

<p>Normally, reverting to a snapshot leaves the domain in
the state it was at the time the snapshot was created,
except that a disk snapshot with no vm state leaves the
domain in an inactive state. Passing either the --running or
--paused flag will perform additional state changes (such as
booting an inactive domain, or pausing a running domain).
Since transient domains cannot be inactive, it is required
to use one of these flags when reverting to a disk snapshot
of a transient domain.</p>

<p>There are two cases where a snapshot revert involves
extra risk, which requires the use of --force to proceed.
One is the case of a snapshot that lacks full domain
information for reverting configuration (such as snapshots
created prior to libvirt 0.9.5); since libvirt cannot prove
that the current configuration matches what was in use at
the time of the snapshot, supplying --force assures libvirt
that the snapshot is compatible with the current
configuration (and if it is not, the domain will likely fail
to run). The other is the case of reverting from a running
domain to an active state where a new hypervisor has to be
created rather than reusing the existing hypervisor, because
it implies drawbacks such as breaking any existing VNC or
Spice connections; this condition happens with an active
snapshot that uses a provably incompatible configuration, as
well as with an inactive snapshot that is combined with the
--start or --pause flag.</p>

<p>snapshot-delete domain {snapshot | --current}
[--metadata] [{--children | --children-only}] Delete the
snapshot for the domain named snapshot, or the current
snapshot with --current. If this snapshot has child
snapshots, changes from this snapshot will be merged into
the children. If --children is passed, then delete this
snapshot and any children of this snapshot. If
--children-only is passed, then delete any children of this
snapshot, but leave this snapshot intact. These two flags
are mutually exclusive.</p>

<p>If --metadata is specified, then only delete the
snapshot metadata maintained by libvirt, while leaving the
snapshot contents intact for access by external tools;
otherwise deleting a snapshot also removes the data contents
from that point in time.</p>

<p>NWFILTER COMMANDS The following commands manipulate
network filters. Network filters allow filtering of the
network traffic coming from and going to virtual machines.
Individual network traffic filters are written in XML and
may contain references to other network filters, describe
traffic filtering rules, or contain both. Network filters
are referenced by virtual machines from within their
interface description. A network filter may be referenced by
multiple virtual machines interfaces.</p>

<p>nwfilter-define xmlfile Make a new network filter known
to libvirt. If a network filter with the same name already
exists, it will be replaced with the new XML. Any running
virtual machine referencing this network filter will have
its network traffic rules adapted. If for any reason the
network traffic filtering rules cannot be instantiated by
any of the running virtual machines, then the new XML will
be rejected.</p>

<p>nwfilter-undefine nwfilter-name Delete a network filter.
The deletion will fail if any running virtual machine is
currently using this network filter.</p>

<p>nwfilter-list List all of the available network
filters.</p>

<p>nwfilter-dumpxml nwfilter-name Output the network filter
XML.</p>

<p>nwfilter-edit nwfilter-name Edit the XML of a network
filter.</p>

<p>This is equivalent to:</p>

<p>virsh nwfilter-dumpxml myfilter &gt; myfilter.xml vi
myfilter.xml (or make changes with your other text editor)
virsh nwfilter-define myfilter.xml</p>

<p>except that it does some error checking. The new network
filter may be rejected due to the same reason as mentioned
in nwfilter- define.</p>

<p>The editor used can be supplied by the $VISUAL or
$EDITOR environment variables, and defaults to
&quot;vi&quot;.</p>

<p>QEMU-SPECIFIC COMMANDS NOTE: Use of the following
commands is strongly discouraged. They can cause libvirt to
become confused and do the wrong thing on subsequent
operations. Once you have used this command, please do not
report problems to the libvirt developers; the reports will
be ignored.</p>

<p>qemu-attach pid Attach an externally launched QEMU
process to the libvirt QEMU driver. The QEMU process must
have been created with a monitor connection using the UNIX
driver. Ideally the process will also have had the -name
argument specified.</p>

<p>$ qemu-kvm -cdrom ~/demo.iso -monitor
unix:/tmp/demo,server,nowait -name foo -uuid
cece4f9f-dff0-575d-0e8e-01fe380f12ea &amp; $ QEMUPID=$! $
virsh qemu-attach $QEMUPID</p>

<p>Not all functions of libvirt are expected to work
reliably after attaching to an externally launched QEMU
process. There may be issues with the guest ABI changing
upon migration, and hotunplug may not work.</p>

<p>qemu-monitor-command domain [--hmp] command... Send an
arbitrary monitor command command to domain domain through
the qemu monitor. The results of the command will be printed
on stdout. If --hmp is passed, the command is considered to
be a human monitor command and libvirt will automatically
convert it into QMP if needed. In that case the result will
also be converted back from QMP. If more than one argument
is provided for command, they are concatenated with a space
in between before passing the single command to the
monitor.</p>

<p>qemu-agent-command domain [--timeout seconds | --async |
--block] command... Send an arbitrary guest agent command
command to domain domain through qemu agent. --timeout,
--async and --block options are exclusive. --timeout
requires timeout seconds seconds and it must be positive.
When --aysnc is given, the command waits for timeout whether
success or failed. And when --block is given, the command
waits forever with blocking timeout.</p>

<p>ENVIRONMENT The following environment variables can be
set to alter the behaviour of &quot;virsh&quot;</p>

<p>VIRSH_DEBUG=&lt;0 to 4&gt; Turn on verbose debugging of
virsh commands. Valid levels are</p>

<p>* VIRSH_DEBUG=0 DEBUG - Messages at ALL levels get
logged</p>

<p>* VIRSH_DEBUG=1 INFO - Logs messages at levels INFO,
NOTICE, WARNING and ERROR</p>

<p>* VIRSH_DEBUG=2 NOTICE - Logs messages at levels NOTICE,
WARNING and ERROR</p>

<p>* VIRSH_DEBUG=3 WARNING - Logs messages at levels
WARNING and ERROR</p>

<p>* VIRSH_DEBUG=4 ERROR - Messages at only ERROR level
gets logged.</p>

<p>VIRSH_LOG_FILE=&quot;LOGFILE&quot; The file to log virsh
debug messages.</p>

<p>VIRSH_DEFAULT_CONNECT_URI The hypervisor to connect to
by default. Set this to a URI, in the same format as
accepted by the connect option. This environment variable is
deprecated in favour of the global LIBVIRT_DEFAULT_URI
variable which serves the same purpose.</p>

<p>LIBVIRT_DEFAULT_URI The hypervisor to connect to by
default. Set this to a URI, in the same format as accepted
by the connect option. This overrides the default URI set in
any client config file and prevents libvirt from probing for
drivers.</p>

<p>VISUAL The editor to use by the edit and related
options.</p>

<p>EDITOR The editor to use by the edit and related
options, if &quot;VISUAL&quot; is not set.</p>

<p>LIBVIRT_DEBUG=LEVEL Turn on verbose debugging of all
libvirt API calls. Valid levels are</p>

<p>&middot; LIBVIRT_DEBUG=1</p>

<p>Messages at level DEBUG or above</p>

<p>&middot; LIBVIRT_DEBUG=2</p>

<p>Messages at level INFO or above</p>

<p>&middot; LIBVIRT_DEBUG=3</p>

<p>Messages at level WARNING or above</p>

<p>&middot; LIBVIRT_DEBUG=4</p>

<p>Messages at level ERROR or above</p>

<p>For further information about debugging options consult
&quot;http://libvirt.org/logging.html&quot;</p>

<p>BUGS Report any bugs discovered to the libvirt community
via the mailing list
&quot;http://libvirt.org/contact.html&quot; or bug tracker
&quot;http://libvirt.org/bugs.html&quot;. Alternatively
report bugs to your software distributor / vendor.</p>

<p>AUTHORS Please refer to the AUTHORS file distributed
with libvirt.</p>

<p>Based on the xm man page by: Sean Dague &lt;sean at
dague dot net&gt; Daniel Stekloff &lt;dsteklof at us dot ibm
dot com&gt;</p>

<p>COPYRIGHT Copyright (C) 2005, 2007-2010 Red Hat, Inc.,
and the authors listed in the libvirt AUTHORS file.</p>

<p>LICENSE virsh is distributed under the terms of the GNU
LGPL v2+. This is free software; see the source for copying
conditions. There is NO warranty; not even for
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE</p>

<p>SEE ALSO virt-install(1), virt-xml-validate(1),
virt-top(1), virt-df(1), &lt;http://www.libvirt.org/&gt;</p>

<p>libvirt-0.10.2 2015-04-28 VIRSH(1)</p>
<hr>
</body>
</html>
