<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:27:52 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>PIPE(8) PIPE(8)</p>

<p>NAME pipe - Postfix delivery to external command</p>

<p>SYNOPSIS pipe [generic Postfix daemon options]
command_attributes...</p>

<p>DESCRIPTION The pipe(8) daemon processes requests from
the Postfix queue manager to deliver messages to external
commands. This program expects to be run from the master(8)
process manager.</p>

<p>Message attributes such as sender address, recipient
address and next- hop host name can be specified as
command-line macros that are expanded before the external
command is executed.</p>

<p>The pipe(8) daemon updates queue files and marks
recipients as fin- ished, or it informs the queue manager
that delivery should be tried again at a later time.
Delivery status reports are sent to the bounce(8), defer(8)
or trace(8) daemon as appropriate.</p>

<p>SINGLE-RECIPIENT DELIVERY Some destinations cannot
handle more than one recipient per delivery request.
Examples are pagers or fax machines. In addition, multi-
recipient delivery is undesirable when prepending a
Delivered-to: or X- Original-To: message header.</p>

<p>To prevent Postfix from sending multiple recipients per
delivery request, specify</p>

<p>transport_destination_recipient_limit = 1</p>

<p>in the Postfix main.cf file, where transport is the name
in the first column of the Postfix master.cf entry for the
pipe-based delivery transport.</p>

<p>COMMAND ATTRIBUTE SYNTAX The external command attributes
are given in the master.cf file at the end of a service
definition. The syntax is as follows:</p>

<p>chroot=pathname (optional) Change the process root
directory and working directory to the named directory. This
happens before switching to the privileges specified with
the user attribute, and before executing the optional
directory=pathname directive. Delivery is deferred in case
of failure.</p>

<p>This feature is available as of Postfix 2.3.</p>

<p>directory=pathname (optional) Change to the named
directory before executing the external com- mand. The
directory must be accessible for the user specified with the
user attribute (see below). The default working direc- tory
is $queue_directory. Delivery is deferred in case of fail-
ure.</p>

<p>This feature is available as of Postfix 2.2.</p>

<p>eol=string (optional, default:n) The output record
delimiter. Typically one wouldn use either orn. The usual
C-style backslash escape sequences are recog- tddd (up to
three octal digits) and nized:abfn .</p>

<p>flags=BDFORXhqu.&gt; (optional) Optional message
processing flags. By default, a message is copied
unchanged.</p>

<p>B Append a blank line at the end of each message. This
is required by some mail user agents that recognize
&quot;From &quot; lines only when preceded by a blank
line.</p>

<p>D Prepend a &quot;Delivered-To: recipient&quot; message
header with the envelope recipient address. Note: for this
to work, the transport_destination_recipient_limit must be 1
(see SINGLE-RECIPIENT DELIVERY above for details).</p>

<p>The D flag also enforces loop detection (Postfix 2.5 and
later): if a message already contains a Delivered-To: header
with the same recipient address, then the message is
returned as undeliverable. The address comparison is case
insensitive.</p>

<p>This feature is available as of Postfix 2.0.</p>

<p>F Prepend a &quot;From sender time_stamp&quot; envelope
header to the message content. This is expected by, for
example, UUCP software.</p>

<p>O Prepend an &quot;X-Original-To: recipient&quot;
message header with the recipient address as given to
Postfix. Note: for this to work, the
transport_destination_recipient_limit must be 1 (see
SINGLE-RECIPIENT DELIVERY above for details).</p>

<p>This feature is available as of Postfix 2.0.</p>

<p>R Prepend a Return-Path: message header with the
envelope sender address.</p>

<p>X Indicate that the external command performs final
deliv- ery. This flag affects the status reported in
&quot;success&quot; DSN (delivery status notification)
messages, and changes it from &quot;relayed&quot; into
&quot;delivered&quot;.</p>

<p>This feature is available as of Postfix 2.5.</p>

<p>h Fold the command-line $original_recipient and
$recipient address domain part (text to the right of the
right-most @ character) to lower case; fold the entire
command-line $domain and $nexthop host or domain information
to lower case. This is recommended for delivery via
UUCP.</p>

<p>q Quote white space and other special characters in the
command-line $sender, $original_recipient and $recipient
address localparts (text to the left of the right-most @
character), according to an 8-bit transparent version of RFC
822. This is recommended for delivery via UUCP or BSMTP.</p>

<p>The result is compatible with the address parsing of
com- mand-line recipients by the Postfix sendmail(1) mail
sub- mission command.</p>

<p>The q flag affects only entire addresses, not the
partial address information from the $user, $extension or
$mail- box command-line macros.</p>

<p>u Fold the command-line $original_recipient and
$recipient address localpart (text to the left of the
right-most @ character) to lower case. This is recommended
for deliv- ery via UUCP.</p>

<p>. Prepend &quot;.&quot; to lines starting with
&quot;.&quot;. This is needed by, for example, BSMTP
software.</p>

<p>&gt; Prepend &quot;&gt;&quot; to lines starting with
&quot;From &quot;. This is expected by, for example, UUCP
software.</p>

<p>null_sender=replacement (default: MAILER-DAEMON) Replace
the null sender address (typically used for delivery status
notifications) with the specified text when expanding the
$sender command-line macro, and when generating a From_ or
Return-Path: message header.</p>

<p>If the null sender replacement text is a non-empty
string then it is affected by the q flag for address quoting
in command-line arguments.</p>

<p>The null sender replacement text may be empty; this form
is rec- ommended for content filters that feed mail back
into Postfix. The empty sender address is not affected by
the q flag for address quoting in command-line
arguments.</p>

<p>Caution: a null sender address is easily mis-parsed by
naive software. For example, when the pipe(8) daemon
executes a com- mand such as:</p>

<p>Wrong: command -f$sender -- $recipient</p>

<p>the command will mis-parse the -f option value when the
sender address is a null string. For correct parsing,
specify $sender as an argument by itself:</p>

<p>Right: command -f $sender -- $recipient</p>

<p>This feature is available as of Postfix 2.3.</p>

<p>size=size_limit (optional) Dont deliver messages that
exceed this size limit (in bytes); return them to the sender
instead.</p>

<p>user=username (required)</p>

<p>user=username:groupname Execute the external command
with the rights of the specified username. The software
refuses to execute commands with root privileges, or with
the privileges of the mail system owner. If groupname is
specified, the corresponding group ID is used instead of the
group ID of username.</p>

<p>argv=command... (required) The command to be executed.
This must be specified as the last command attribute. The
command is executed directly, i.e. with- out interpretation
of shell meta characters by a shell command interpreter.</p>

<p>In the command argument vector, the following macros are
recog- nized and replaced with corresponding information
from the Post- fix queue manager delivery request.</p>

<p>In addition to the form ${name}, the forms $name and
$(name) are also recognized. Specify $$ where a single $ is
wanted.</p>

<p>${client_address} This macro expands to the remote
client network address.</p>

<p>This feature is available as of Postfix 2.2.</p>

<p>${client_helo} This macro expands to the remote client
HELO command parameter.</p>

<p>This feature is available as of Postfix 2.2.</p>

<p>${client_hostname} This macro expands to the remote
client hostname.</p>

<p>This feature is available as of Postfix 2.2.</p>

<p>${client_port} This macro expands to the remote client
TCP port number.</p>

<p>This feature is available as of Postfix 2.5.</p>

<p>${client_protocol} This macro expands to the remote
client protocol.</p>

<p>This feature is available as of Postfix 2.2.</p>

<p>${domain} This macro expands to the domain portion of
the recipient address. For example, with an address
user+foo@domain the domain is domain.</p>

<p>This information is modified by the h flag for case
fold- ing.</p>

<p>This feature is available as of Postfix 2.5.</p>

<p>${extension} This macro expands to the extension part of
a recipient address. For example, with an address
user+foo@domain the extension is foo.</p>

<p>A command-line argument that contains ${extension}
expands into as many command-line arguments as there are
recipients.</p>

<p>This information is modified by the u flag for case
fold- ing.</p>

<p>${mailbox} This macro expands to the complete local part
of a recip- ient address. For example, with an address
user+foo@domain the mailbox is user+foo.</p>

<p>A command-line argument that contains ${mailbox} expands
to as many command-line arguments as there are recipi-
ents.</p>

<p>This information is modified by the u flag for case
fold- ing.</p>

<p>${nexthop} This macro expands to the next-hop
hostname.</p>

<p>This information is modified by the h flag for case
fold- ing.</p>

<p>${original_recipient} This macro expands to the complete
recipient address before any address rewriting or
aliasing.</p>

<p>A command-line argument that contains ${original_recipi-
ent} expands to as many command-line arguments as there are
recipients.</p>

<p>This information is modified by the hqu flags for
quoting and case folding.</p>

<p>This feature is available as of Postfix 2.5.</p>

<p>${recipient} This macro expands to the complete
recipient address.</p>

<p>A command-line argument that contains ${recipient}
expands to as many command-line arguments as there are
recipients.</p>

<p>This information is modified by the hqu flags for
quoting and case folding.</p>

<p>${sasl_method} This macro expands to the name of the
SASL authentication mechanism in the AUTH command when the
Postfix SMTP server received the message.</p>

<p>This feature is available as of Postfix 2.2.</p>

<p>${sasl_sender} This macro expands to the SASL sender
name (i.e. the original submitter as per RFC 4954) in the
MAIL FROM com- mand when the Postfix SMTP server received
the message.</p>

<p>This feature is available as of Postfix 2.2.</p>

<p>${sasl_username} This macro expands to the SASL user
name in the AUTH com- mand when the Postfix SMTP server
received the message.</p>

<p>This feature is available as of Postfix 2.2.</p>

<p>${sender} This macro expands to the envelope sender
address. By default, the null sender address expands to
MAILER-DAE- MON; this can be changed with the null_sender
attribute, as described above.</p>

<p>This information is modified by the q flag for
quoting.</p>

<p>${size} This macro expands to Postfixs idea of the
message size, which is an approximation of the size of the
message as delivered.</p>

<p>${user} This macro expands to the username part of a
recipient address. For example, with an address
user+foo@domain the username part is user.</p>

<p>A command-line argument that contains ${user} expands
into as many command-line arguments as there are recipi-
ents.</p>

<p>This information is modified by the u flag for case
fold- ing.</p>

<p>STANDARDS RFC 3463 (Enhanced status codes)</p>

<p>DIAGNOSTICS Command exit status codes are expected to
follow the conventions defined in &lt;sysexits.h&gt;. Exit
status 0 means normal successful comple- tion.</p>

<p>Postfix version 2.3 and later support RFC 3463-style
enhanced status codes. If a command terminates with a
non-zero exit status, and the command output begins with an
enhanced status code, this status code takes precedence over
the non-zero exit status.</p>

<p>Problems and transactions are logged to syslogd(8).
Corrupted message files are marked so that the queue manager
can move them to the corrupt queue for further
inspection.</p>

<p>SECURITY This program needs a dual personality 1) to
access the private Postfix queue and IPC mechanisms, and 2)
to execute external commands as the specified user. It is
therefore security sensitive.</p>

<p>CONFIGURATION PARAMETERS Changes to main.cf are picked
up automatically as pipe(8) processes run for only a limited
amount of time. Use the command &quot;postfix reload&quot;
to speed up a change.</p>

<p>The text below provides only a parameter summary. See
postconf(5) for more details including examples.</p>

<p>RESOURCE AND RATE CONTROLS In the text below, transport
is the first field in a master.cf entry.</p>

<p>transport_destination_concurrency_limit
($default_destination_concur- rency_limit) Limit the number
of parallel deliveries to the same destination, for delivery
via the named transport. The limit is enforced by the
Postfix queue manager.</p>

<p>transport_destination_recipient_limit
($default_destination_recipi- ent_limit) Limit the number of
recipients per message delivery, for deliv- ery via the
named transport. The limit is enforced by the Post- fix
queue manager.</p>

<p>transport_time_limit ($command_time_limit) Limit the
time for delivery to external command, for delivery via the
named transport. The limit is enforced by the pipe delivery
agent.</p>

<p>Postfix 2.4 and later support a suffix that specifies
the time unit: s (seconds), m (minutes), h (hours), d
(days), w (weeks). The default time unit is seconds.</p>

<p>MISCELLANEOUS CONTROLS config_directory (seepostconf
-doutput) The default location of the Postfix main.cf and
master.cf con- figuration files.</p>

<p>daemon_timeout (18000s) How much time a Postfix daemon
process may take to handle a request before it is terminated
by a built-in watchdog timer.</p>

<p>delay_logging_resolution_limit (2) The maximal number of
digits after the decimal point when log- ging sub-second
delay values.</p>

<p>export_environment (seepostconf -doutput) The list of
environment variables that a Postfix process will export to
non-Postfix processes.</p>

<p>ipc_timeout (3600s) The time limit for sending or
receiving information over an internal communication
channel.</p>

<p>mail_owner (postfix) The UNIX system account that owns
the Postfix queue and most Postfix daemon processes.</p>

<p>max_idle (100s) The maximum amount of time that an idle
Postfix daemon process waits for an incoming connection
before terminating voluntarily.</p>

<p>max_use (100) The maximal number of incoming connections
that a Postfix daemon process will service before
terminating voluntarily.</p>

<p>process_id (read-only) The process ID of a Postfix
command or daemon process.</p>

<p>process_name (read-only) The process name of a Postfix
command or daemon process.</p>

<p>queue_directory (seepostconf -doutput) The location of
the Postfix top-level queue directory.</p>

<p>recipient_delimiter (empty) The separator between user
names and address extensions (user+foo).</p>

<p>syslog_facility (mail) The syslog facility of Postfix
logging.</p>

<p>syslog_name (seepostconf -doutput) The mail system name
that is prepended to the process name in syslog records, so
that &quot;smtpd&quot; becomes, for example, &quot;post-
fix/smtpd&quot;.</p>

<p>SEE ALSO qmgr(8), queue manager bounce(8), delivery
status reports postconf(5), configuration parameters
master(5), generic daemon options master(8), process manager
syslogd(8), system logging</p>

<p>LICENSE The Secure Mailer license must be distributed
with this software.</p>

<p>AUTHOR(S) Wietse Venema IBM T.J. Watson Research P.O.
Box 704 Yorktown Heights, NY 10598, USA</p>

<p>PIPE(8)</p>
<hr>
</body>
</html>
