<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:20:25 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>JOURNAL_TRY_TO_FREE_(9) The Linux Journalling API
JOURNAL_TRY_TO_FREE_(9)</p>

<p>NAME journal_try_to_free_buffers - try to free page
buffers.</p>

<p>SYNOPSIS int journal_try_to_free_buffers(journal_t *
journal, struct page * page, gfp_t gfp_mask);</p>

<p>ARGUMENTS journal journal for operation</p>

<p>page to try and free</p>

<p>gfp_mask we use the mask to detect how hard should we
try to release buffers. If __GFP_WAIT and __GFP_FS is set,
we wait for commit code to release the buffers.</p>

<p>DESCRIPTION For all the buffers on this page, if they
are fully written out ordered data, move them onto BUF_CLEAN
so try_to_free_buffers can reap them.</p>

<p>This function returns non-zero if we wish
try_to_free_buffers to be called. We do this if the page is
releasable by try_to_free_buffers. We also do it if the page
has locked or dirty buffers and the caller wants us to
perform sync or async writeout.</p>

<p>This complicates JBD locking somewhat. We aren&acute;t
protected by the BKL here. We wish to remove the buffer from
its committing or running transaction&acute;s
-&gt;t_datalist via __journal_unfile_buffer.</p>

<p>This may *change* the value of
transaction_t-&gt;t_datalist, so anyone who looks at
t_datalist needs to lock against this function.</p>

<p>Even worse, someone may be doing a journal_dirty_data on
this buffer. So we need to lock against that.
journal_dirty_data will come out of the lock with the buffer
dirty, which makes it ineligible for release here.</p>

<p>Who else is affected by this? hmm... Really the only
contender is do_get_write_access - it could be looking at
the buffer while journal_try_to_free_buffer is changing its
state. But that cannot happen because we never reallocate
freed data as metadata while the data is part of a
transaction. Yes?</p>

<p>Return 0 on failure, 1 on success</p>

<p>AUTHORS Roger Gammans
&lt;rgammans@computer-surgery.co.uk&gt; Author.</p>

<p>Stephen Tweedie &lt;sct@redhat.com&gt; Author.</p>

<p>COPYRIGHT Kernel Hackers Manual 2.6. July 2015
JOURNAL_TRY_TO_FREE_(9)</p>
<hr>
</body>
</html>
