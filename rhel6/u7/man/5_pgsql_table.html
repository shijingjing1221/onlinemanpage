<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:27:40 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>PGSQL_TABLE(5) PGSQL_TABLE(5)</p>

<p>NAME pgsql_table - Postfix PostgreSQL client
configuration</p>

<p>SYNOPSIS postmap -q &quot;string&quot;
pgsql:/etc/postfix/filename</p>

<p>postmap -q - pgsql:/etc/postfix/filename
&lt;inputfile</p>

<p>DESCRIPTION The Postfix mail system uses optional tables
for address rewriting or mail routing. These tables are
usually in dbm or db format.</p>

<p>Alternatively, lookup tables can be specified as
PostgreSQL databases. In order to use PostgreSQL lookups,
define a PostgreSQL source as a lookup table in main.cf, for
example: alias_maps = pgsql:/etc/pgsql-aliases.cf</p>

<p>The file /etc/postfix/pgsql-aliases.cf has the same
format as the Post- fix main.cf file, and can specify the
parameters described below.</p>

<p>BACKWARDS COMPATIBILITY For compatibility with other
Postfix lookup tables, PostgreSQL parame- ters can also be
defined in main.cf. In order to do that, specify as
PostgreSQL source a name that doesnt begin with a slash or a
dot. The PostgreSQL parameters will then be accessible as
the name youve given the source in its definition, an
underscore, and the name of the param- eter. For example, if
the map is specified as &quot;pgsql:pgsqlname&quot;, the
parameter &quot;hosts&quot; below would be defined in
main.cf as &quot;pgsql- name_hosts&quot;.</p>

<p>Note: with this form, the passwords for the PostgreSQL
sources are written in main.cf, which is normally
world-readable. Support for this form will be removed in a
future Postfix version.</p>

<p>Postfix 2.2 has enhanced query interfaces for MySQL and
PostgreSQL, these include features previously available only
in the Postfix LDAP client. In the new interface the SQL
query is specified via a single query parameter (described
in more detail below). In Postfix 2.1 the parameter
precedence was, from highest to lowest, select_function,
query and finally select_field, ...</p>

<p>With Postfix 2.2 the query parameter has highest
precedence, and is used in preference to the still
supported, but slated to be phased out, select_function,
select_field, table, where_field and additional_condi- tions
parameters. To migrate to the new interface set:</p>

<p>query = SELECT select_function(%s)</p>

<p>or in the absence of select_function, the lower
precedence:</p>

<p>query = SELECT select_field FROM table WHERE where_field
= %s additional_conditions</p>

<p>Use the value, not the name, of each legacy parameter.
Note that the additional_conditions parameter is optional
and if not empty, will always start with AND.</p>

<p>LIST MEMBERSHIP When using SQL to store lists such as
$mynetworks, $mydestination, $relay_domains,
$local_recipient_maps, etc., it is important to understand
that the table must store each list member as a separate
key. The table lookup verifies the *existence* of the key.
See &quot;Postfix lists versus tables&quot; in the
DATABASE_README document for a discussion.</p>

<p>Do NOT create tables that return the full list of
domains in $mydesti- nation or $relay_domains etc., or IP
addresses in $mynetworks.</p>

<p>DO create tables with each matching item as a key and
with an arbitrary value. With SQL databases it is not
uncommon to return the key itself or a constant value.</p>

<p>PGSQL PARAMETERS hosts The hosts that Postfix will try
to connect to and query from. Specify unix: for UNIX-domain
sockets, inet: for TCP connections (default). Example: hosts
= host1.some.domain host2.some.domain hosts =
unix:/file/name</p>

<p>The hosts are tried in random order, with all
connections over UNIX domain sockets being tried before
those over TCP. The con- nections are automatically closed
after being idle for about 1 minute, and are re-opened as
necessary.</p>

<p>NOTE: the unix: and inet: prefixes are accepted for
backwards compatibility reasons, but are actually ignored.
The PostgreSQL client library will always try to connect to
an UNIX socket if the name starts with a slash, and will try
a TCP connection oth- erwise.</p>

<p>user, password The user name and password to log into
the pgsql server. Exam- ple: user = someone password =
some_password</p>

<p>dbname The database name on the servers. Example: dbname
= customer_database</p>

<p>query The SQL query template used to search the
database, where %s is a substitute for the address Postfix
is trying to resolve, e.g. query = SELECT replacement FROM
aliases WHERE mailbox = %s</p>

<p>This parameter supports the following % expansions:</p>

<p>%% This is replaced by a literal % character. (Postfix
2.2 and later)</p>

<p>%s This is replaced by the input key. SQL quoting is
used to make sure that the input key does not add unexpected
metacharacters.</p>

<p>%u When the input key is an address of the form
user@domain, %u is replaced by the SQL quoted local part of
the address. Otherwise, %u is replaced by the entire search
string. If the localpart is empty, the query is sup- pressed
and returns no results.</p>

<p>%d When the input key is an address of the form
user@domain, %d is replaced by the SQL quoted domain part of
the address. Otherwise, the query is suppressed and returns
no results.</p>

<p>%[SUD] The upper-case equivalents of the above
expansions behave in the query parameter identically to
their lower-case counter-parts. With the result_format
parameter (see below), they expand the input key rather than
the result value.</p>

<p>The above %S, %U and %D expansions are available with
Postfix 2.2 and later</p>

<p>%[1-9] The patterns %1, %2, ... %9 are replaced by the
corre- sponding most significant component of the input keys
domain. If the input key is user@mail.example.com, then %1
is com, %2 is example and %3 is mail. If the input key is
unqualified or does not have enough domain components to
satisfy all the specified patterns, the query is sup-
pressed and returns no results.</p>

<p>The above %1, ... %9 expansions are available with Post-
fix 2.2 and later</p>

<p>The domain parameter described below limits the input
keys to addresses in matching domains. When the domain
parameter is non- empty, SQL queries for unqualified
addresses or addresses in non-matching domains are
suppressed and return no results.</p>

<p>The precedence of this parameter has changed with
Postfix 2.2, in prior releases the precedence was, from
highest to lowest, select_function, query, select_field,
...</p>

<p>With Postfix 2.2 the query parameter has highest
precedence, see COMPATIBILITY above.</p>

<p>NOTE: DO NOT put quotes around the query parameter.</p>

<p>result_format (default: %s) Format template applied to
result attributes. Most commonly used to append (or prepend)
text to the result. This parameter sup- ports the following
% expansions:</p>

<p>%% This is replaced by a literal % character.</p>

<p>%s This is replaced by the value of the result
attribute. When result is empty it is skipped.</p>

<p>%u When the result attribute value is an address of the
form user@domain, %u is replaced by the local part of the
address. When the result has an empty localpart it is
skipped.</p>

<p>%d When a result attribute value is an address of the
form user@domain, %d is replaced by the domain part of the
attribute value. When the result is unqualified it is
skipped.</p>

<p>%[SUD1-9] The upper-case and decimal digit expansions
interpolate the parts of the input key rather than the
result. Their behavior is identical to that described with
query, and in fact because the input key is known in
advance, queries whose key does not contain all the
information specified in the result template are suppressed
and return no results.</p>

<p>For example, using &quot;result_format = smtp:[%s]&quot;
allows one to use a mailHost attribute as the basis of a
transport(5) table. After applying the result format,
multiple values are concatenated as comma separated strings.
The expansion_limit and parameter explained below allows one
to restrict the number of values in the result, which is
especially useful for maps that must return at most one
value.</p>

<p>The default value %s specifies that each result value
should be used as is.</p>

<p>This parameter is available with Postfix 2.2 and
later.</p>

<p>NOTE: DO NOT put quotes around the result format!</p>

<p>domain (default: no domain list) This is a list of
domain names, paths to files, or dictionaries. When
specified, only fully qualified search keys with a *non-
empty* localpart and a matching domain are eligible for
lookup: user lookups, bare domain lookups and
&quot;@domain&quot; lookups are not performed. This can
significantly reduce the query load on the PostgreSQL
server. domain = postfix.org,
hash:/etc/postfix/searchdomains</p>

<p>It is best not to use SQL to store the domains eligible
for SQL lookups.</p>

<p>This parameter is available with Postfix 2.2 and
later.</p>

<p>NOTE: DO NOT define this parameter for local(8) aliases,
because the input keys are always unqualified.</p>

<p>expansion_limit (default: 0) A limit on the total number
of result elements returned (as a comma separated list) by a
lookup against the map. A setting of zero disables the
limit. Lookups fail with a temporary error if the limit is
exceeded. Setting the limit to 1 ensures that lookups do not
return multiple values.</p>

<p>OBSOLETE QUERY INTERFACES This section describes query
interfaces that are deprecated as of Post- fix 2.2. Please
migrate to the new query interface as the old inter- faces
are slated to be phased out.</p>

<p>select_function This parameter specifies a database
function name. Example: select_function =
my_lookup_user_alias</p>

<p>This is equivalent to: query = SELECT
my_lookup_user_alias(%s)</p>

<p>This parameter overrides the legacy table-related fields
(described below). With Postfix versions prior to 2.2, it
also overrides the query parameter. Starting with Postfix
2.2, the query parameter has highest precedence, and the
select_function parameter is deprecated.</p>

<p>The following parameters (with lower precedence than the
select_func- tion interface described above) can be used to
build the SQL select statement as follows:</p>

<p>SELECT [select_field] FROM [table] WHERE [where_field] =
%s [additional_conditions]</p>

<p>The specifier %s is replaced with each lookup by the
lookup key and is escaped so if it contains single quotes or
other odd characters, it will not cause a parse error, or
worse, a security problem.</p>

<p>Starting with Postfix 2.2, this interface is obsoleted
by the more gen- eral query interface described above. If
higher precedence the query or select_function parameters
described above are defined, the parameters described here
are ignored.</p>

<p>select_field The SQL &quot;select&quot; parameter.
Example: select_field = forw_addr</p>

<p>table The SQL &quot;select .. from&quot; table name.
Example: table = mxaliases</p>

<p>where_field The SQL &quot;select .. where&quot;
parameter. Example: where_field = alias</p>

<p>additional_conditions Additional conditions to the SQL
query. Example: additional_conditions = AND status =
paid</p>

<p>SEE ALSO postmap(1), Postfix lookup table manager
postconf(5), configuration parameters ldap_table(5), LDAP
lookup tables mysql_table(5), MySQL lookup tables</p>

<p>README FILES Use &quot;postconf readme_directory&quot;
or &quot;postconf html_directory&quot; to locate this
information. DATABASE_README, Postfix lookup table overview
PGSQL_README, Postfix PostgreSQL client guide</p>

<p>LICENSE The Secure Mailer license must be distributed
with this software.</p>

<p>HISTORY PgSQL support was introduced with Postfix
version 2.1.</p>

<p>AUTHOR(S) Based on the MySQL client by: Scott Cotton,
Joshua Marcus IC Group, Inc.</p>

<p>Ported to PostgreSQL by: Aaron Sethman</p>

<p>Further enhanced by: Liviu Daia Institute of Mathematics
of the Romanian Academy P.O. BOX 1-764 RO-014700 Bucharest,
ROMANIA</p>

<p>PGSQL_TABLE(5)</p>
<hr>
</body>
</html>
