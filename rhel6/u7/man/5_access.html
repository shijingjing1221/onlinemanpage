<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 06:03:48 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>ACCESS(5) ACCESS(5)</p>

<p>NAME access - Postfix SMTP server access table</p>

<p>SYNOPSIS postmap /etc/postfix/access</p>

<p>postmap -q &quot;string&quot; /etc/postfix/access</p>

<p>postmap -q - /etc/postfix/access &lt;inputfile</p>

<p>DESCRIPTION This document describes access control on
remote SMTP client informa- tion: host names, network
addresses, and envelope sender or recipient addresses; it is
implemented by the Postfix SMTP server. See header_checks(5)
or body_checks(5) for access control on the content of email
messages.</p>

<p>Normally, the access(5) table is specified as a text
file that serves as input to the postmap(1) command. The
result, an indexed file in dbm or db format, is used for
fast searching by the mail system. Execute the command
&quot;postmap /etc/postfix/access&quot; to rebuild an
indexed file after changing the corresponding text file.</p>

<p>When the table is provided via other means such as NIS,
LDAP or SQL, the same lookups are done as for ordinary
indexed files.</p>

<p>Alternatively, the table can be provided as a
regular-expression map where patterns are given as regular
expressions, or lookups can be directed to TCP-based server.
In those cases, the lookups are done in a slightly different
way as described below under &quot;REGULAR EXPRESSION
TABLES&quot; or &quot;TCP-BASED TABLES&quot;.</p>

<p>CASE FOLDING The search string is folded to lowercase
before database lookup. As of Postfix 2.3, the search string
is not case folded with database types such as regexp: or
pcre: whose lookup fields can match both upper and lower
case.</p>

<p>TABLE FORMAT The input format for the postmap(1) command
is as follows:</p>

<p>pattern action When pattern matches a mail address,
domain or host address, perform the corresponding
action.</p>

<p>blank lines and comments Empty lines and whitespace-only
lines are ignored, as are lines whose first non-whitespace
character is a #.</p>

<p>multi-line text A logical line starts with
non-whitespace text. A line that starts with whitespace
continues a logical line.</p>

<p>EMAIL ADDRESS PATTERNS With lookups from indexed files
such as DB or DBM, or from networked tables such as NIS,
LDAP or SQL, patterns are tried in the order as listed
below:</p>

<p>user@domain Matches the specified mail address.</p>

<p>domain.tld Matches domain.tld as the domain part of an
email address.</p>

<p>The pattern domain.tld also matches subdomains, but only
when the string smtpd_access_maps is listed in the Postfix
par- ent_domain_matches_subdomains configuration setting
(note that this is the default for some versions of
Postfix). Otherwise, specify .domain.tld (note the initial
dot) in order to match subdomains.</p>

<p>user@ Matches all mail addresses with the specified user
part.</p>

<p>Note: lookup of the null sender address is not possible
with some types of lookup table. By default, Postfix uses
&lt;&gt; as the lookup key for such addresses. The value is
specified with the smtpd_null_access_lookup_key parameter in
the Postfix main.cf file.</p>

<p>EMAIL ADDRESS EXTENSION When a mail address localpart
contains the optional recipient delimiter (e.g.,
user+foo@domain), the lookup order becomes: user+foo@domain,
user@domain, domain, user+foo@, and user@.</p>

<p>HOST NAME/ADDRESS PATTERNS With lookups from indexed
files such as DB or DBM, or from networked tables such as
NIS, LDAP or SQL, the following lookup patterns are examined
in the order as listed:</p>

<p>domain.tld Matches domain.tld.</p>

<p>The pattern domain.tld also matches subdomains, but only
when the string smtpd_access_maps is listed in the Postfix
par- ent_domain_matches_subdomains configuration setting.
Otherwise, specify .domain.tld (note the initial dot) in
order to match subdomains.</p>

<p>net.work.addr.ess</p>

<p>net.work.addr</p>

<p>net.work</p>

<p>net Matches the specified IPv4 host address or
subnetwork. An IPv4 host address is a sequence of four
decimal octets separated by &quot;.&quot;.</p>

<p>Subnetworks are matched by repeatedly truncating the
last &quot;.octet&quot; from the remote IPv4 host address
string until a match is found in the access table, or until
further truncation is not possible.</p>

<p>NOTE 1: The access map lookup key must be in canonical
form: do not specify unnecessary null characters, and do not
enclose net- work address information with &quot;[]&quot;
characters.</p>

<p>NOTE 2: use the cidr lookup table type to specify
network/net- mask patterns. See cidr_table(5) for
details.</p>

<p>net:work:addr:ess</p>

<p>net:work:addr</p>

<p>net:work</p>

<p>net Matches the specified IPv6 host address or
subnetwork. An IPv6 host address is a sequence of three to
eight hexadecimal octet pairs separated by
&quot;:&quot;.</p>

<p>Subnetworks are matched by repeatedly truncating the
last &quot;:octetpair&quot; from the remote IPv6 host
address string until a match is found in the access table,
or until further truncation is not possible.</p>

<p>NOTE 1: the truncation and comparison are done with the
string representation of the IPv6 host address. Thus, not
all the &quot;:&quot; subnetworks will be tried.</p>

<p>NOTE 2: The access map lookup key must be in canonical
form: do not specify unnecessary null characters, and do not
enclose net- work address information with &quot;[]&quot;
characters.</p>

<p>NOTE 3: use the cidr lookup table type to specify
network/net- mask patterns. See cidr_table(5) for
details.</p>

<p>IPv6 support is available in Postfix 2.2 and later.</p>

<p>ACCEPT ACTIONS OK Accept the address etc. that matches
the pattern.</p>

<p>all-numerical An all-numerical result is treated as OK.
This format is gener- ated by address-based relay
authorization schemes such as pop- before-smtp.</p>

<p>REJECT ACTIONS Postfix version 2.3 and later support
enhanced status codes as defined in RFC 3463. When no code
is specified at the beginning of the text below, Postfix
inserts a default enhanced status code of &quot;5.7.1&quot;
in the case of reject actions, and &quot;4.7.1&quot; in the
case of defer actions. See &quot;ENHANCED STATUS CODES&quot;
below.</p>

<p>4NN text</p>

<p>5NN text Reject the address etc. that matches the
pattern, and respond with the numerical three-digit code and
text. 4NN means &quot;try again later&quot;, while 5NN means
&quot;do not try again&quot;.</p>

<p>The following responses have special meaning for the
Postfix SMTP server:</p>

<p>421 text (Postfix 2.3 and later)</p>

<p>521 text (Postfix 2.6 and later) After responding with
the numerical three-digit code and text, disconnect
immediately from the SMTP client. This frees up SMTP server
resources so that they can be made available to another SMTP
client.</p>

<p>Note: The &quot;521&quot; response should be used only
with botnets and other malware where interoperability is of
no con- cern. The &quot;send 521 and disconnect&quot;
behavior is NOT defined in the SMTP standard.</p>

<p>REJECT optional text... Reject the address etc. that
matches the pattern. Reply with
&quot;$access_map_reject_code optional text...&quot; when
the optional text is specified, otherwise reply with a
generic error response message.</p>

<p>DEFER optional text... Reject the address etc. that
matches the pattern. Reply with &quot;$access_map_defer_code
optional text...&quot; when the optional text is specified,
otherwise reply with a generic error response mes- sage.</p>

<p>This feature is available in Postfix 2.6 and later.</p>

<p>DEFER_IF_REJECT optional text... Defer the request if
some later restriction would result in a REJECT action.
Reply with &quot;$access_map_defer_code 4.7.1 optional
text...&quot; when the optional text is specified, otherwise
reply with a generic error response message.</p>

<p>Prior to Postfix 2.6, the SMTP reply code is 450.</p>

<p>This feature is available in Postfix 2.1 and later.</p>

<p>DEFER_IF_PERMIT optional text... Defer the request if
some later restriction would result in a an explicit or
implicit PERMIT action. Reply with
&quot;$access_map_defer_code 4.7.1 optional text...&quot;
when the optional text is specified, otherwise reply with a
generic error response message.</p>

<p>Prior to Postfix 2.6, the SMTP reply code is 450.</p>

<p>This feature is available in Postfix 2.1 and later.</p>

<p>OTHER ACTIONS restriction... Apply the named UCE
restriction(s) (permit, reject, reject_unauth_destination,
and so on).</p>

<p>BCC user@domain Send one copy of the message to the
specified recipient.</p>

<p>If multiple BCC actions are specified within the same
SMTP MAIL transaction, only the last action will be
used.</p>

<p>This feature is not part of the stable Postfix
release.</p>

<p>DISCARD optional text... Claim successful delivery and
silently discard the message. Log the optional text if
specified, otherwise log a generic message.</p>

<p>Note: this action currently affects all recipients of
the mes- sage. To discard only one recipient without
discarding the entire message, use the transport(5) table to
direct mail to the discard(8) service.</p>

<p>This feature is available in Postfix 2.0 and later.</p>

<p>DUNNO Pretend that the lookup key was not found. This
prevents Postfix from trying substrings of the lookup key
(such as a subdomain name, or a network address
subnetwork).</p>

<p>This feature is available in Postfix 2.0 and later.</p>

<p>FILTER transport:destination After the message is
queued, send the entire message through the specified
external content filter. The transport:destination syntax is
described in the transport(5) manual page. More information
about external content filters is in the Postfix
FILTER_README file.</p>

<p>Note: this action overrides the content_filter setting,
and cur- rently affects all recipients of the message.</p>

<p>This feature is available in Postfix 2.0 and later.</p>

<p>HOLD optional text... Place the message on the hold
queue, where it will sit until someone either deletes it or
releases it for delivery. Log the optional text if
specified, otherwise log a generic message.</p>

<p>Mail that is placed on hold can be examined with the
postcat(1) command, and can be destroyed or released with
the postsuper(1) command.</p>

<p>Note: use &quot;postsuper -r&quot; to release mail that
was kept on hold for a significant fraction of
$maximal_queue_lifetime or $bounce_queue_lifetime, or
longer. Use &quot;postsuper -H&quot; only for mail that will
not expire within a few delivery attempts.</p>

<p>Note: this action currently affects all recipients of
the mes- sage.</p>

<p>This feature is available in Postfix 2.0 and later.</p>

<p>PREPEND headername: headervalue Prepend the specified
message header to the message. When more than one PREPEND
action executes, the first prepended header appears before
the second etc. prepended header.</p>

<p>Note: this action must execute before the message
content is received; it cannot execute in the context of
smtpd_end_of_data_restrictions.</p>

<p>This feature is available in Postfix 2.1 and later.</p>

<p>REDIRECT user@domain After the message is queued, send
the message to the specified address instead of the intended
recipient(s).</p>

<p>Note: this action overrides the FILTER action, and
currently affects all recipients of the message.</p>

<p>This feature is available in Postfix 2.1 and later.</p>

<p>WARN optional text... Log a warning with the optional
text, together with client information and if available,
with helo, sender, recipient and protocol information.</p>

<p>This feature is available in Postfix 2.1 and later.</p>

<p>ENHANCED STATUS CODES Postfix version 2.3 and later
support enhanced status codes as defined in RFC 3463. When
an enhanced status code is specified in an access table, it
is subject to modification. The following transformations
are needed when the same access table is used for client,
helo, sender, or recipient access restrictions; they happen
regardless of whether Post- fix replies to a MAIL FROM, RCPT
TO or other SMTP command.</p>

<p>&middot; When a sender address matches a REJECT action,
the Postfix SMTP server will transform a recipient DSN
status (e.g., 4.1.1-4.1.6) into the corresponding sender DSN
status, and vice versa.</p>

<p>&middot; When non-address information matches a REJECT
action (such as the HELO command argument or the client
hostname/address), the Postfix SMTP server will transform a
sender or recipient DSN status into a generic non-address
DSN status (e.g., 4.0.0).</p>

<p>REGULAR EXPRESSION TABLES This section describes how the
table lookups change when the table is given in the form of
regular expressions. For a description of regular expression
lookup table syntax, see regexp_table(5) or
pcre_table(5).</p>

<p>Each pattern is a regular expression that is applied to
the entire string being looked up. Depending on the
application, that string is an entire client hostname, an
entire client IP address, or an entire mail address. Thus,
no parent domain or parent network search is done,
user@domain mail addresses are not broken up into their
user@ and domain constituent parts, nor is user+foo broken
up into user and foo.</p>

<p>Patterns are applied in the order as specified in the
table, until a pattern is found that matches the search
string.</p>

<p>Actions are the same as with indexed file lookups, with
the additional feature that parenthesized substrings from
the pattern can be interpolated as $1, $2 and so on.</p>

<p>TCP-BASED TABLES This section describes how the table
lookups change when lookups are directed to a TCP-based
server. For a description of the TCP client/server lookup
protocol, see tcp_table(5). This feature is not available up
to and including Postfix version 2.4.</p>

<p>Each lookup operation uses the entire query string once.
Depending on the application, that string is an entire
client hostname, an entire client IP address, or an entire
mail address. Thus, no parent domain or parent network
search is done, user@domain mail addresses are not broken up
into their user@ and domain constituent parts, nor is
user+foo broken up into user and foo.</p>

<p>Actions are the same as with indexed file lookups.</p>

<p>EXAMPLE The following example uses an indexed file, so
that the order of table entries does not matter. The example
permits access by the client at address 1.2.3.4 but rejects
all other clients in 1.2.3.0/24. Instead of hash lookup
tables, some systems use dbm. Use the command &quot;postconf
-m&quot; to find out what lookup tables Postfix supports on
your system.</p>

<p>/etc/postfix/main.cf: smtpd_client_restrictions =
check_client_access hash:/etc/postfix/access</p>

<p>/etc/postfix/access: 1.2.3 REJECT 1.2.3.4 OK</p>

<p>Execute the command &quot;postmap
/etc/postfix/access&quot; after editing the file.</p>

<p>BUGS The table format does not understand quoting
conventions.</p>

<p>SEE ALSO postmap(1), Postfix lookup table manager
smtpd(8), SMTP server postconf(5), configuration parameters
transport(5), transport:nexthop syntax</p>

<p>README FILES Use &quot;postconf readme_directory&quot;
or &quot;postconf html_directory&quot; to locate this
information. SMTPD_ACCESS_README, built-in SMTP server
access control DATABASE_README, Postfix lookup table
overview</p>

<p>LICENSE The Secure Mailer license must be distributed
with this software.</p>

<p>AUTHOR(S) Wietse Venema IBM T.J. Watson Research P.O.
Box 704 Yorktown Heights, NY 10598, USA</p>

<p>ACCESS(5)</p>
<hr>
</body>
</html>
