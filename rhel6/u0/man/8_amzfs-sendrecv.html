<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 21:52:53 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>AMZFS-SENDRECV(8) System Administration Commands
AMZFS-SENDRECV(8)</p>

<p>NAME amzfs-sendrecv - Amanda script to create zfs
sendrecv</p>

<p>DESCRIPTION amzfs-sendrecv is an Amanda application
implementing the Application API. It should not be run by
users directly. It create a zfs snapshot of the filesystem
and backup the snapshot with &acute;zfs send&acute;.
Snapshot are kept after the backup is done, this increase
the disk space use on the client but it is neccesary to be
able do to incremental backup. If you want only full backup,
you can disable this feature by setting the KEEP-SNAPSHOT
property to &acute;NO&acute;. Only the restoration of the
complete backup is allowed, it is impossible to restore a
single file.</p>

<p>The application is run as the amanda user, it must have
many zfs priviledge:</p>

<p>zfs allow -ldu AMANDA_USER
mount,create,rename,snapshot,destroy,send,receive
FILESYSTEM</p>

<p>Some system doesn&acute;t have &quot;zfs allow&quot;,
but you can give the Amanda backup user the rights to
manipulate ZFS filesystems by using the following
command:</p>

<p>usermod -P &quot;ZFS File System Management,ZFS Storage
Management&quot; AMANDA_USER This will require that your run
zfs under pfexec, set the PFEXEC property to YES.</p>

<p>The format of the DLE must be one of:</p>

<p>Desciption Example ---------- ------- Mountpoint /data
ZFS pool name datapool ZFS filesystem datapool/database ZFS
logical volume datapool/dbvol</p>

<p>The filesystem doesn&acute;t need to be mounted.</p>

<p>PROPERTIES This section lists the properties that
control amzfs-sendrecv&acute;s functionality. See
amanda-applications(7) for information on the Application
API, application configuration.</p>

<p>DF-PATH</p>

<p>Path to the &acute;df&acute; binary, search in $PATH by
default.</p>

<p>KEEP-SNAPSHOT</p>

<p>If &quot;YES&quot; (the default), snapshot are kept
after the backup, if set to &quot;NO&quot; then snapshot are
no kept and incremental backup will fail.</p>

<p>ZFS-PATH</p>

<p>Path to the &acute;zfs&acute; binary, search in $PATH by
default.</p>

<p>PFEXEC-PATH</p>

<p>Path to the &acute;pfexec&acute; binary, search in $PATH
by default.</p>

<p>PFEXEC</p>

<p>If &quot;NO&quot; (the default), pfexec is not used, if
set to &quot;YES&quot; then pfexec is used.</p>

<p>EXAMPLE In this example, a dumptype is defined to use
amzfs-sendrecv application to backup a zfs filesystem.
define application-tool amzfs_sendrecv { comment
&quot;amzfs-sendrecv&quot; plugin &quot;amzfs-sendrecv&quot;
#property &quot;DF-PATH&quot; &quot;/usr/sbin/df&quot;
#property &quot;KEEP-SNAPSHOT&quot; &quot;YES&quot;
#property &quot;ZFS-PATH&quot; &quot;/usr/sbin/zfs&quot;
#property &quot;PFEXEC-PATH&quot;
&quot;/usr/sbin/pfexec&quot; #property &quot;PFEXEC&quot;
&quot;NO&quot; }</p>

<p>define dumptype user-zfs-sendrecv { program
&quot;APPLICATAION&quot; application
&quot;amzfs_sendrecv&quot; }</p>

<p>SEE ALSO amanda.conf(5), amanda-client.conf(5),
amanda-applications(7)</p>

<p>AUTHOR Jean-Louis Martineau &lt;martineau@zmanda.com&gt;
Zmanda, Inc. (http://www.zmanda.com)</p>

<p>Amanda 2.6.1p2 11/05/2009 AMZFS-SENDRECV(8)</p>
<hr>
</body>
</html>
