<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 22:24:59 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>VIRT-WIN-REG(1) Virtualization Support
VIRT-WIN-REG(1)</p>

<p>NAME virt-win-reg - Export and merge Windows Registry
entries from a Windows guest</p>

<p>SYNOPSIS virt-win-reg domname
&rsquo;HKLMPathTokey&rsquo;</p>

<p>virt-win-reg domname &rsquo;HKLMPathTokey&rsquo;
name</p>

<p>virt-win-reg domname &rsquo;HKLMPathTokey&rsquo; @</p>

<p>virt-win-reg --merge domname [input.reg ...]</p>

<p>virt-win-reg [--options] disk.img ... # instead of
domname</p>

<p>WARNING You must not use &quot;virt-win-reg&quot; with
the &quot;--merge&quot; option on live virtual machines. If
you do this, you will get irreversible disk corruption in
the VM. &quot;virt-win-reg&quot; tries to stop you from
doing this, but doesnt catch all cases.</p>

<p>Modifying the Windows Registry is an inherently risky
operation. The format is deliberately obscure and
undocumented, and Registry changes can leave the system
unbootable. Therefore when using the &quot;--merge&quot;
option, make sure you have a reliable backup first.</p>

<p>DESCRIPTION This program can export and merge Windows
Registry entries from a Windows guest.</p>

<p>The first parameter is the libvirt guest name or the raw
disk image of a Windows guest.</p>

<p>If &quot;--merge&quot; is not specified, then the chosen
registry key is displayed/exported (recursively). For
example:</p>

<p>$ virt-win-reg Windows7
&rsquo;HKEY_LOCAL_MACHINETWAREcrosoft&rsquo;</p>

<p>You can also display single values from within registry
keys, for example:</p>

<p>$ cvkey=&rsquo;HKLMTWAREcrosoftWindows NT $ virt-win-reg
Windows7 $cvkey ProductName Windows 7 Enterprise</p>

<p>With &quot;--merge&quot;, you can merge a textual
regedit file into the Windows Registry:</p>

<p>$ virt-win-reg --merge Windows7 changes.reg</p>

<p>SUPPORTED SYSTEMS The program currently supports Windows
NT-derived guests starting with Windows XP through to at
least Windows 7.</p>

<p>Registry support is done for
&quot;HKEY_LOCAL_MACHINE&quot;,
&quot;HKEY_LOCAL_MACHINEURITY&quot;,
&quot;HKEY_LOCAL_MACHINETWARE&quot;,
&quot;HKEY_LOCAL_MACHINETEM&quot; and
&quot;HKEY_USERS.DEFAULT&quot;.</p>

<p>You can use &quot;HKLM&quot; as a shorthand for
&quot;HKEY_LOCAL_MACHINE&quot;, and &quot;HKU&quot; for
&quot;HKEY_USERS&quot;.</p>

<p>&quot;HKEY_USERSID&quot; and
&quot;HKEY_CURRENT_USER&quot; are not supported at this
time.</p>

<p>NOTE This program is only meant for simple access to the
registry. If you want to do complicated things with the
registry, we suggest you download the Registry hive files
from the guest using libguestfs(3) or guestfish(1) and
access them locally, eg. using hivex(3), hivexsh(1) or
hivexregedit(1).</p>

<p>ENCODING &quot;virt-win-reg&quot; expects that regedit
files have already been reencoded in the local encoding.
Usually on Linux hosts, this means UTF-8 with Unix-style
line endings. Since Windows regedit files are often in
UTF-16LE with Windows-style line endings, you may need to
reencode the whole file before or after processing.</p>

<p>To reencode a file from Windows format to Linux (before
processing it with the &quot;--merge&quot; option), you
would do something like this:</p>

<p>iconv -f utf-16le -t utf-8 &lt; win.reg | dos2unix &gt;
linux.reg</p>

<p>To go in the opposite direction, after exporting and
before sending the file to a Windows user, do something like
this:</p>

<p>unix2dos linux.reg | iconv -f utf-8 -t utf-16le &gt;
win.reg</p>

<p>For more information about encoding, see
Win::Hivex::Regedit(3).</p>

<p>If you are unsure about the current encoding, use the
file(1) command. Recent versions of Windows regedit.exe
produce a UTF-16LE file with Windows-style (CRLF) line
endings, like this:</p>

<p>$ file software.reg software.reg: Little-endian UTF-16
Unicode text, with very long lines, with CRLF line
terminators</p>

<p>This file would need conversion before you could
&quot;--merge&quot; it.</p>

<p>SHELL QUOTING Be careful when passing parameters
containing &quot; shell. Usually you will have to use single
quotes or double backslashes (but not both) to protect them
from the shell.</p>

<p>Paths and value names are case-insensitive.</p>

<p>CurrentControlSet etc. Registry keys like
&quot;CurrentControlSet&quot; dont really exist in the
Windows Registry at the level of the hive file, and
therefore you cannot modify these.</p>

<p>&quot;CurrentControlSet&quot; is usually an alias for
&quot;ControlSet001&quot;. In some circumstances it might
refer to another control set. The way to find out is to look
at the &quot;HKLMTEMect&quot; key:</p>

<p># virt-win-reg WindowsGuest &rsquo;HKLMTEMect&rsquo;
[HKEY_LOCAL_MACHINETEMect]
&quot;Current&quot;=dword:00000001
&quot;Default&quot;=dword:00000001
&quot;Failed&quot;=dword:00000000
&quot;LastKnownGood&quot;=dword:00000002</p>

<p>&quot;Default&quot; is the one which Windows will choose
when it boots.</p>

<p>Similarly, other &quot;Current...&quot; keys in the path
may need to be replaced.</p>

<p>OPTIONS --help Display brief help.</p>

<p>--version Display version number and exit.</p>

<p>--debug Enable debugging messages.</p>

<p>--connect URI | -c URI If using libvirt, connect to the
given URI. If omitted, then we connect to the default
libvirt hypervisor.</p>

<p>If you specify guest block devices directly, then
libvirt is not used at all.</p>

<p>--merge In merge mode, this merges a textual regedit
file into the Windows Registry of the virtual machine. If
this flag is not given then virt-win-reg displays or exports
Registry entries instead.</p>

<p>Note that &quot;--merge&quot; is unsafe to use on live
virtual machines, and will result in disk corruption.
However exporting (without this flag) is always safe.</p>

<p>--encoding UTF-16LE|ASCII When merging (only), you may
need to specify the encoding for strings to be used in the
hive file. This is explained in detail in &quot;ENCODING
STRINGS&quot; in Win::Hivex::Regedit(3).</p>

<p>The default is to use UTF-16LE, which should work with
recent versions of Windows.</p>

<p>SEE ALSO hivex(3), hivexsh(1), hivexregedit(1),
guestfs(3), guestfish(1), virt-cat(1), Sys::Guestfs(3),
Sys::Guestfs::Lib(3), Win::Hivex(3), Win::Hivex::Regedit(3),
Sys::Virt(3), &lt;http://libguestfs.org/&gt;.</p>

<p>BUGS When reporting bugs, please enable debugging and
capture the complete output:</p>

<p>export LIBGUESTFS_DEBUG=1 virt-win-reg --debug [... rest
...] &gt; /tmp/virt-win-reg.log 2&gt;&amp;1</p>

<p>Attach /tmp/virt-win-reg.log to a new bug report at
&lt;https://bugzilla.redhat.com/&gt;</p>

<p>AUTHOR Richard W.M. Jones
&lt;http://people.redhat.com/~rjones/&gt;</p>

<p>COPYRIGHT Copyright (C) 2010 Red Hat Inc.</p>

<p>This program is free software; you can redistribute it
and/or modify it under the terms of the GNU General Public
License as published by the Free Software Foundation; either
version 2 of the License, or (at your option) any later
version.</p>

<p>This program is distributed in the hope that it will be
useful, but WITHOUT ANY WARRANTY; without even the implied
warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
PURPOSE. See the GNU General Public License for more
details.</p>

<p>You should have received a copy of the GNU General
Public License along with this program; if not, write to the
Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA
02139, USA.</p>

<p>libguestfs-1.2.7 2010-05-14 VIRT-WIN-REG(1)</p>
<hr>
</body>
</html>
