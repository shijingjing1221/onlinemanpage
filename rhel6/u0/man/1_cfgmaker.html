<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 21:55:29 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>CFGMAKER(1) mrtg CFGMAKER(1)</p>

<p>NAME cfgmaker - Creates mrtg.cfg files (for
mrtg-2.16.2)</p>

<p>SYNOPSIS cfgmaker [options] [community@]router
[[options] [community@]router ...]</p>

<p>OPTIONS --ifref=nr interface references by Interface
Number (default) --ifref=ip ... by Ip Address --ifref=eth
... by Ethernet Number --ifref=descr ... by Interface
Description --ifref=name ... by Interface Name --ifref=type
... by Interface Type</p>

<p>--ifdesc=nr interface description uses Interface Number
(default) --ifdesc=ip ... uses Ip Address --ifdesc=eth ...
uses Ethernet Number --ifdesc=descr ... uses Interface
Description --ifdesc=name ... uses Interface Name
--ifdesc=catname ... uses CatOS Interface Name
--ifdesc=ppname ... uses Passport Port Name --ifdesc=alias
... uses Interface Alias --ifdesc=type ... uses Interface
Type</p>

<p>--if-filter=f Test every interface against filter f to
decide wether or not to include that interface into the
collection. Currently f is being evaluated as a Perl
expression and it s truth value is used to reject or accept
the interface. (Experimental, under development, might
change)</p>

<p>--if-template=templatefile Replace the normal target
entries for the interfaces with an entry as specified by the
contents in the file templatefile. The file is supposed to
contain Perl code to be executed to generate the lines for
the target in the configuration file. (Experimental, under
development, might change)</p>

<p>--host-template=templatefile In addition to creating
targets for a hosts interfaces do also create targets for
the host itself as specified by the contents in the file
templatefile. The file is supposed to contain Perl code to
be executed to generate the lines for the host related
targets (such as CPU, ping response time measurements etc.)
in the config- uration file. (Experimental, under
development, might change)</p>

<p>--global &quot;x: a&quot; add global config entries</p>

<p>--no-down do not look at admin or opr status of
interfaces</p>

<p>--show-op-down show interfaces which are operatively
down</p>

<p>--zero-speed=spd use this speed in bits-per-second as
the interface speed for all interfaces that return a speed
of 0 via ifSpeed/ifHighSpeed. 100Mbps = 100000000</p>

<p>--subdirs=format give each router its own subdirectory,
naming each per &quot;format&quot;, in which HOSTNAME and
SNMPNAME will be replaced by the values of those items --
for instance, --subdirs=HOSTNAME or --subdirs=&quot;HOSTNAME
(SNMPNAME)&quot;</p>

<p>--noreversedns do not reverse lookup ip numbers</p>

<p>--community=cmty Set the default community string to
&quot;cmty&quot; instead of &quot;public&quot;.</p>

<p>--enable-ipv6 Enable IPv6 support, if the required
libraries are present. Numeric IPv6 addresses must be
enclosed in square brackets, e.g.
public@[2001:760:4::1]:161</p>

<p>--use-16bit Use 16bit SNMP request IDs to query all
routers.</p>


<p>--snmp-options=:[&lt;port&gt;][:[&lt;tmout&gt;][:[&lt;retr&gt;][:[&lt;backoff&gt;][:&lt;ver&gt;]]]]</p>

<p>Specify default SNMP options to be appended to all
routers following. Individual fields can be empty. Routers
following might override some or all of the options given to
--snmp-options.</p>

<p>--dns-domain=domain Specifies a domain to append to the
name of all routers following.</p>

<p>--nointerfaces Don t do generate any configuration lines
for interfaces, skip the step of gathering interface
information and dont run any interface template code.</p>

<p>--interfaces Generate configuration lines for interfaces
(this is the default). The main purpose of this option is to
negate an --nointerfaces appearing earlier on the command
line.</p>

<p>--help brief help message --man full documentation
--version print the version of cfgmaker</p>

<p>--output=file output filename default is STDOUT</p>

<p>DESCRIPTION Cfgmaker creates MRTG configuration files
based on information pulled from a router or another SNMP
manageable device.</p>

<p>[community@]router</p>

<p>Community is the community name of the device you want
to create a con- figuration for. If not specified, it
defaults to public; you might want to try this first if you
do not know the community name of a device. If you are using
the wrong community name you will get no response from the
device.</p>

<p>Router is the DNS name or the IP number of an
SNMP-managable device. Following the name you can specify 6
further options separated by colons. The full syntax looks
like this:</p>


<p>router[:[prt][:[tmout][:[retr][:[backoff][:vers]]]]]</p>

<p>Of special interest may be the last parameter, vers. If
you set this to 2 then your device will be queried with SNMP
version 2 requests. This allows to poll the 64 bit traffic
counters in the device and will thus work much better with
fast interfaces (no more counter overrun). Note that the
order in which the routers are specified on the command line
do matter as the same order is used when the configuration
file is generated. The first specified router has it s
configuration lines genrated first, followed by the lines
belonging to the next router and so on.</p>

<p>Note that the first line of the generated cfg file will
contain all the commandline options you used for generating
it. This is to allow for the easy regeneration in case you
want to add newhosts or make some other global change.</p>

<p>Configuration</p>

<p>Except for the --output and --global options, all
options affect only the routers following them on the
command line. If an option specified earlier on the command
line reappears later on the command line with another value,
the new value overrides the old value as far as remain- ing
routers are concerned. This way options might be tailored
for groups of routers or for individual routers.</p>

<p>See --output and --global for how their behaviour is
affected by where or how many times they appear on the
command line.</p>

<p>See the Examples below on how to set an option
differently for multiple routers.</p>

<p>--help Print a brief help message and exit.</p>

<p>--man Prints the manual page and exits.</p>

<p>--version Print the version of cfgmaker. This should
match the version of MRTG for which config files are being
created.</p>

<p>--ifref nr|ip|eth|descr|name Select the interface
identification method. Default is nr which identifies the
router interfaces by their number. Unfortunately the
interface numbering scheme in an SNMP tree can change. Some
routers change their numbering when new interfaces are
added, oth- ers change thier numbering every full moon just
for fun.</p>

<p>To work around this sad problem MRTG can identify
interfaces by 4 other properties. None of these works for
all interfaces, but you should be able to find one which
does fine for you. Note that espe- cially ethernet addrsses
can be problematic as some routers have the same ethernet
address on most of their interface cards.</p>

<p>Select ip to identify the interface by its IP number.
Use eth to use the ethernet address for identification. Use
descr to use the Interface description. Or use name to use
the Interface name.</p>

<p>If your chosen method does not allow unique interface
identifica- tion on the device you are querying, cfgmaker
will tell you about it.</p>

<p>--ifdesc nr|ip|eth|descr|name|type|alias Select what to
use as the description of the interface. The description
appears in the &quot;Title[]&quot; property for the target
as well as the text header in the HTML code defined in the
targets &quot;PageTop[]&quot;. Default is to use nr which is
just the interface num- ber which isnt always useful to the
viewer of the graphs.</p>

<p>There are 6 other properties which could be used. Use ip
if you want to use the interfaces IP-address. Use eth if you
want to use the interfaces ethernet address. If you want a
better descrip- tion, you can use either descr, name or
alias. Exactly what each of these do varies between
different equipment so you might need to experiment. For
instance, for a serial interface on a Cisco router running
IOS using name might result in &quot;S0&quot; being the
interface description , descr might result in
&quot;Serial0&quot; and alias might result in &quot;Link to
HQ&quot; (provided that is what is used as the inter- faces
&quot;description&quot; in the routers configuration).</p>

<p>Finally, if you want to describe the interface by it s
Btype (i.e &quot;ethernetCSMA&quot;,
&quot;propPointtoPoint&quot; etc) you can use type.</p>

<p>--if-filter filter-expression First of all, this is
under some developement and is experimental.</p>

<p>Use this if you want to have better control over what
interfaces gets included into the configuration. The
filter-expression is evaluated as a piece of Perl code and
is expected to return a truth value. If true, include the
interface and if false, exclude the interface.</p>

<p>For a further discussion on how these filters work, see
the section &quot;Details on Filters&quot; below.</p>

<p>--if-template template-file First of all, this is under
some development and is experimental.</p>

<p>Use this if you want to control what the line for each
target should look like in the configuration file. The
contents of the file template-file will be evaluated as a
Perl program which gener- ates the lines using certain
variables for input and output.</p>

<p>For a further discussion on how these templates work,
see the sec- tion &quot;Details on Temaplates&quot;
below.</p>

<p>--host-template template-file First of all, this is
under some development and is experimental.</p>

<p>Use this if you want to have some extra targets related
to the host itself such as CPU utilization, ping response
time to the host, number of busy modems etc. The contents of
the file template-file will be evaluated once per host as a
Perl program which generates the lines using certain
variables for input and output.</p>

<p>For a further discussion on how these templates work,
see the sec- tion &quot;Details on Templates&quot;
below.</p>

<p>--community community-string Use this to set the
community for the routers following on the com- mand line to
community-string. Individual routers might overrride this
community string by using the syntax community@router.</p>

<p>--enable-ipv6 This option enables IPv6 support. It
requires the appropriate perl modules; if they are not found
then IPv6 is disabled (see the ipv6 documentation).</p>

<p>cfgmaker will use IPv6 or IPv4 depending on the target.
If the tar- get is a numeric address, the protocol depends
on the type of address. If the target is a hostname,
cfgmaker will try to resolve the name first to an IPv6
address then to an IPv4 address.</p>

<p>IPv6 numeric addresses must be specified between square
braces.</p>

<p>For example:</p>

<p>cfgmaker --enable-ipv6 [2001:760:4::1]:165:::2</p>

<p>If the target has both an IPv6 address and an IPv4
address with the same hostname, cfgmaker first queries the
target using IPv6 and falls back to IPv4 if it fails. This
is useful for targets which dont support SNMP over IPv6.</p>

<p>--use-16bit This option forces the use of 16bit SNMP
request IDs. Some broken SNMP agents do not accept 32bit
request IDs. Try to avoid this option as much as possible,
complain to your agent vendor instead.</p>

<p>--snmp-options
:[port][:[timeout][:[retries][:[backoff][:version]]]] Use
this to set the default SNMP options for all routers
following on the command line. Individual values might be
omitted as well as trailing colons. Note that routers might
override individual (or all) values specified by
--snmp-options by using the syntax</p>


<p>router[:[port][:[timeout][:[retries][:[backoff][:version]]]]]</p>

<p>--global &quot;bla: abc&quot; Use this to add global
options to the generated config file. You can call --global
several times to add multiple options. The line will appear
in the configuration just before the config for the next
router appearing on the command line.</p>

<p>--global &quot;workdir: /home/mrtg&quot;</p>

<p>If you want some default Options you might want to
put</p>

<p>--global &quot;options[_]: growright,bits&quot;</p>

<p>Specifying --global after the last router on the command
line will create a line in the configuration file which will
appear after all the routers.</p>

<p>--noreversedns Do not try to reverse lookup IP numbers
... a must for DNS free environments.</p>

<p>--no-down Normally cfgmaker will not include interfaces
which are marked any- thing but administratively and
operationally UP. With this switch you get them all.</p>

<p>--show-op-down Include interfaces which are operatively
down.</p>

<p>--zero-speed speed Assign this speed in bits-per-second
to all interfaces which return 0 for ifSpeed and
ifHighSpeed. Some switches, notably Foundry equipment,
return a speed of zero for some interfaces. For exam- ple,
to have all interfaces reporting zero set to 100Mbps, use
--zero-speed=100000000.</p>

<p>--subdirs format Give each router its own subdirectory
for the HTML and graphics (or .rrd) files. The directory
name is the given format string with a couple of pattern
replacements. The string &quot;HOSTNAME&quot; will be
replaced by the hostname of the router (however you
specified it on the cfgmaker commandline -- it may be an
actual hostname or just an IP address), and
&quot;SNMPNAME&quot; will be replaced with the devices idea
of its own name (the same name that appears on the right
side of the &quot;Title&quot; lines). For instance, a call
like:</p>

<p>cfgmaker --subdirs=HOSTNAME__SNMPNAME
public@10.10.0.18</p>

<p>would result in the generation of lines looking
something like:</p>

<p>Directory[10.10.0.18_1]:
10.10.0.18__fp2200-bothrip-1.3</p>

<p>--output file Write the output from cfgmaker into the
file file. The default is to use &quot;STDOUT&quot;.
--output is expected to appear only once on the command
line. If used multiple times, the file specified by the last
--output will be used.</p>

<p>--nointerfaces Dont generate configuration lines for
interfaces.</p>

<p>This makes cfgmaker skip all steps related to interfaces
which means it will not do any polling of the router to
retrieve inter- face information which speeds up the
execution of cfgmaker and it will neither run any interface
templates.</p>

<p>--interfaces This makes cfgmaker generate configuration
lines for interfaces (the default behaviour).</p>

<p>The main usage of this option is to negate an
--nointerfaces appearing earlier on the command line.</p>

<p>SNMP V3 Options</p>

<p>Cfgmaker supports SNMP V3 using the Net:SNMP perl
module. There are optional parameters affecting SNMP
operation.</p>

<p>--enablesnmpv3 {yes|no} The --enablesnmpv3 option is an
optional flag to check for the presence of the Net::SNMP
libraries. Cfgmaker will try to deter- mine whether this
flag is required and will set the values automat-
ically.</p>

<p>SNMPv3 Arguments</p>

<p>A SNMP context is a collection of management information
accessible by a SNMP entity. An item of management
information may exist in more than one context and a SNMP
entity potentially has access to many con- texts. The
combination of a contextEngineID and a contextName unam-
biguously identifies a context within an administrative
domain. In a SNMPv3 message, the contextEngineID and
contextName are included as part of the scopedPDU. All
methods that generate a SNMP message optionally take a
--contextengineid and --contextname argument to con- figure
these fields.</p>

<p>Context Engine ID The --contextengineid argument expects
a hexadecimal string repre- senting the desired
contextEngineID. The string must be 10 to 64 characters (5
to 32 octets) long and can be prefixed with an optional
&quot;0x&quot;. Once the --contextengineid is specified it
stays with the object until it is changed again or reset to
default by passing in the undefined value. By default, the
contextEngineID is set to match the authoritativeEngineID of
the authoritative SNMP engine.</p>

<p>Context Name The contextName is passed as a string which
must be 0 to 32 octets in length using the --contextname
argument. The contextName stays with the object until it is
changed. The contextName defaults to an empty string which
represents the &quot;default&quot; context.</p>

<p>User-based Security Model Arguments</p>

<p>The User-based Security Model (USM) used by SNMPv3
requires that a securityName be specified using the
--username argument. The creation of a Net::SNMP object with
the version set to SNMPv3 will fail if the --username
argument is not present. The --username argument expects a
string 1 to 32 octets in length.</p>

<p>Different levels of security are allowed by the
User-based Security Model which address authentication and
privacy concerns. A SNMPv3 tar- get will derive the security
level (securityLevel) based on which of the following
arguments are specified.</p>

<p>By default a securityLevel of noAuthNoPriv is assumed.
If the --authkey or --authpassword arguments are specified,
the securityLevel becomes authNoPriv. The --authpassword
argument expects a string which is at least 1 octet in
length. Optionally, the --authkey argu- ment can be used so
that a plain text password does not have to be specified in
a script. The --authkey argument expects a hexadecimal
string produced by localizing the password with the
authorita- tiveEngineID for the specific destination device.
The &quot;snmpkey&quot; util- ity included with the
Net::SNMP distribution can be used to create the hexadecimal
string (see snmpkey).</p>

<p>Two different hash algorithms are defined by SNMPv3
which can be used by the Security Model for authentication.
These algorithms are HMAC-MD5-96 &quot;MD5&quot; (RFC 1321)
and HMAC-SHA-96 &quot;SHA-1&quot; (NIST FIPS PUB 180-1). The
default algorithm used by the module is HMAC-MD5-96. This
behavior can be changed by using the --authprotocol
argument. This argument expects either the string md5 or sha
to be passed to modify the hash algorithm.</p>

<p>By specifying the arguments --privkey or --privpassword
the secu- rityLevel associated with the object becomes
authPriv . According to SNMPv3, privacy requires the use of
authentication. Therefore, if either of these two arguments
are present and the --authkey or --auth- password arguments
are missing, the creation of the object fails. The --privkey
and --privpassword arguments expect the same input as the
--authkey and --authpassword arguments respectively.</p>

<p>The User-based Security Model described in RFC 3414
defines a single encryption protocol to be used for privacy.
This protocol, CBC-DES &quot;DES&quot; (NIST FIPS PUB 46-1),
is used by default or if the string des is passed to the
--privprotocol argument. By working with the Extended
Security Options Consortium http://www.snmp.com/eso/, the
module also supports additional protocols which have been
defined in draft specifi- cations. The draft
http://www.snmp.com/eso/draft-reeder-snmpv3-usm-3desede-00.txt
defines the support of CBC-3DES-EDE &quot;Triple-DES&quot;
(NIST FIPS 46-3) in the User- based Security Model. This
protocol can be selected using the --privprotocol argument
with the string 3desede . The draft
http://www.snmp.com/eso/draft-blumenthal-aes-usm-04.txt
describes the use of CFB128-AES-128/192/256 &quot;AES&quot;
(NIST FIPS PUB 197) in the USM. The three AES encryption
protocols, differentiated by their key sizes, can be
selected by passing aescfb128, aescfb192, or aescfb256 to
the -privprotocol argument.</p>

<p>Details on Filters</p>

<p>The purpose of the filters is to decide which interfaces
to accept and which interfaces to reject. This decision is
done for each interface by evaluating the filter expression
as a piece of Perl code and inves- tigating the result of
the evaluation. If true, accept the interface otherwise
reject it.</p>

<p>When working with filters, remember that Perl has its
own idea of what truth and false is. The empty string
&quot;&quot; and the string &quot;0&quot; are false, all
other strings are true. This further imples that any integer
value of 0 is false as well as any undef value. It also
implies that all references are considered true.</p>

<p>As the filter is evaluated as a Perl expression, several
useful constructs in Perl are worth mentioning:</p>

<p>Expressions might be grouped by using parentheses
&quot;()&quot;. Expressions might be combined using boolean
operators such as the following:</p>

<p>&quot;and&quot; (equivalent with &quot;&amp;&amp;&quot;)
Boolean &quot;and&quot; of the two expressions, is only true
if both expres- sions are true. Example: expression1 and
expression2</p>

<p>&quot;or&quot; (equivalent with &quot;||&quot;) Boolean
&quot;or&quot; of the two expressions, is true if either or
both expressions are true. Example: expression1 or
expression2</p>

<p>&quot;not&quot; (equivalent with &quot;!&quot;) Boolean
negation of a single expression. Example: not expression .
Yet another example: !expression</p>

<p>(For more details on this I recommend a book on
Perl)</p>

<p>Predefined Filter Variables</p>

<p>To facilitate, there are a number of predefined values
available to use in the filter. Note that these variables
are also available when tem- plates interfaces are evaluated
(but not host templates).</p>

<p>Caveat: All these variables names begin with a dollar
sign ($), which is a syntactic requirement for scalar
variables in Perl. The danger here is that the dollar sign
in many shells is an active charac- ter (often used for
shell variables exactly as in Perl variables) so it is
important to ensure that the Perl expression isnt evaluated
by the command line shell as shell code before being passed
to cfgmaker as command line arguments. In shells like Bourne
shell, ksh shell or bash shell, placing the entire
expression within single qoutes will avoid such accidental
evaluation:</p>

<p>--if-filter=($default_iftype &amp;&amp; $if_admin)</p>

<p>$if_type This is an integer specifying the interface
type as per the SNMP standards and as reported by the polled
device. A complete list of interface types would be
impractical for this document , but there are a number
predefined varables below. Normally, cfgmaker puts in the
target s PageTop this iftype value within paranthesis after
the name of the interface type. (e.g
&quot;propPointToPointSerial (22)&quot;).</p>

<p>Here s a list of some of the most common interface types
by number:</p>

<p>6 ethernetCsmacd 7 iso88023Csmacd 9 iso88025TokenRing 15
fddi 19 E1 20 basicISDN 21 primaryISDN 22
propPointToPointSerial 23 ppp 24 softwareLoopback 30 ds3 32
frame-relay 33 rs232 37 atm 39 sonet 44 frameRelayService 46
hssi 49 aal5 53 propVirtual 62 Fast Ethernet (100BaseT) 63
ISDN &amp; X.25 69 Full Duplex Fast Ethernet (100BaseFX) 94
Asymetric Digital Subscriber Loop (ADSL) 117 Gigabit
Ethernet 134 ATM Sub Interface</p>

<p>$default True if and only if cfgmaker normally should
accepted the interface based on the interfaces
administrative and operational state (tak- ing the flags
--no-down and --show-op-down into account) and its type (and
a few other things).</p>

<p>$default_ifstate True if and only if cfgmaker would have
accepted the interface based on its operational and
administrative states (also taking into account the presence
of the flags --no-down and --show-op-down).</p>

<p>$default_iftype True if and only if cfgmaker would have
accepted the interface based on its type (and a few type
specific details in addition).</p>

<p>$if_admin True if and only if the interface is in an
adminstrative up state.</p>

<p>$if_oper True if and only if the interface is in an
operational up state.</p>

<p>A number of variables are also predefined to easily
decide if an inter- face belong to a certain cathegory or
not. Below is all those vari- ables listed together with
which if_type numbers each variable will be true for. Note
that some variables refer to other variables as well.</p>

<p>$if_is_ethernet True for ethernet interfaces (nr 6, 7,
26, 62, 69 and 117).</p>

<p>$if_is_isdn True for various ISDN interface types (nr
20, 21, 63, 75, 76 and 77)</p>

<p>$if_is_dialup True for dial-up interfaces such as PPP as
well as ISDN. (nr 23, 81, 82 and 108 in addition to the
numbers of $if_is_isdn).</p>

<p>$if_is_atm True for miscellaneous ATM related interface
types (nr 37, 49, 107, 105, 106, 114 and 134).</p>

<p>$if_is_wan True for WAN interfaces point to point, Frame
Relay and High Speed Serial ( 22,32,44,46)</p>

<p>$if_is_lan True for LAN interfaces (8, 9, 11, 15, 26,
55, 59, 60 and 115 in addition to the numbers of
$if_is_ethernet).</p>

<p>$if_is_dsl True for ADSL, RDSL, HDSL and SDSL (nr 94,
95, 96, 97)</p>

<p>$if_is_loopback True for software loopback interfaces
(nr 24)</p>

<p>$if_is_ciscovlan True for Cisco VLAN interfaces
(interfaces with the word Vlan or VLAN in their ifdescs)</p>

<p>$if_vlan_id Returns the vlan id associated with a
specific port on Cisco Cata- lyst switches under both
Catalyst OS and IOS, and 3Com switches. If it is not a vlan
interface, will return undef.</p>

<p>$if_cisco_trunk Returns the trunking state of a specific
port on Cisco Catalyst switches under both Catalyst OS and
IOS. Returns &quot;1&quot; if the inter- face is a trunk,
undef otherwise.</p>

<p>$if_MTU Returns the Maximum Transfer Unit associated
with a specific port.</p>

<p>Besides that, you can also use the variables defined for
templates below. Further, all the variables available in
cfgmaker is at the scripts disposal even if the use of such
features is discouraged. More &quot;shortcuts&quot; in the
form of variables and functions will be made ava- iable in
the future instead.</p>

<p>Examples on Filters</p>

<p>The following filter will not affect which interfaces
gets included or excluded, it will make cfgmaker behave as
normally.</p>

<p>--if-filter=$default</p>

<p>The following filter will make cfgmaker exclude PPP (23)
interfaces:</p>

<p>--if-filter=$default &amp;&amp; $if_type!=23</p>

<p>The following filter will make cfgmaker behave as usual
except that it will consider the operational state of an
interface irrelevant but still reject all interfaces which
are administratively down.</p>

<p>--if-filter=$if_admin &amp;&amp; $default_iftype</p>

<p>Details on Templates</p>

<p>The contents of the template files are evaluated as a
Perl program. A number or Perl variables are available for
the program to read and oth- ers are used to be written
to.</p>

<p>As quite a few of the predefined variables has values
which are are supposed to be used in HTML code some of them
have an &quot;HTML-escaped&quot; variant, e.g
$html_syslocation is the HTML escaped variant of $sysloca-
tion. The HTML escaping means that the chars
&quot;&lt;&quot;, &quot;&gt;&quot; and &quot;&amp;&quot; are
replaced by &quot;&amp;lt;&quot;, &quot;&amp;gt;&quot; and
&quot;&amp;amp;&quot; and that newlines embedded in the
string are prepended with &quot;&lt;BR&gt;&quot; and
appended with a space charac- ter (if a newline is last in
the string it is not touched).</p>

<p>Writable Template Variables</p>

<p>These are the variables available to store the
configuration lines in. Some of them are initialized prior
to the evaluation of the template but such content normally
is comments for inclusion in the final con- figuration file
so those variables might be reset to the empty string in the
template code to eliminate the comments. The other way
around is also possible, the contents of these variables
might be extended with further information for various
reasons such as debugging etc.</p>

<p>Once the template has been evaluated, the following
happens: if the template is a interface template and the
actual interface for some rea- son is rejected and thus
needs to be commented out, all the lines in the variable
$target_lines are turned into comments by adding a hash mark
(&quot;#&quot;) at their beginning. Then all the variables
$head_lines, $problem_lines , $target_lines and
$separator_lines are concatenated together to form the lines
to add to the configuration file.</p>

<p>$target_lines This variable is the placeholder for the
configuration lines cre- ated by the template. $target_lines
is predefined to be empty when the template code is
evaluated.</p>

<p>$head_lines This variable is intended to be the
placeholder for the comment line appearing just before the
target in the configuration file. It is initialized with
that comment line before the evaluation of the template code
and if the template doesn t modify $head_lines during
evaluation, the comment will look like usual in the config
file.</p>

<p>$problem_lines This variable is intended to be the
placholder for the comment lines describing any problems
which might have been encountered when trying to add the
target into the configuration. For host templates it s
normally not used and for those its predefined as the empty
string. For interface templates $problem_lines is prede-
fined with the error description comments which cfgmaker
normally would use for rejected interfaces or as the empty
string for accepted interfaces.</p>

<p>It is possible to test against $problem_lines to find
out if an interface will be included or rejected but this is
not recommended. Test against $if_ok instead.</p>

<p>$separator_lines This variable is the placeholder for
the string to use as the sepa- rator between the code for
individual targets. The contents of this variable is put
after each target (so the lines will appear after the end of
the last target in the config as well).</p>

<p>Predefined Template Variables</p>

<p>All the variables below are available for interface
templates to use. For host templates, only those listed
under &quot;Host and System Variables&quot; are
available.</p>

<p>For interface templates the variables listed under
&quot;Predefined Filter Variables&quot; are also
available.</p>

<p>Host and System Variables</p>

<p>$router_name This is the fully qualified name for the
router. It is affected by the following items on the command
line: the router name itself and --dns-domain.</p>

<p>$router_connect This is the reference string for the
router being polled. It is on the form community@router
possibly followed by some snmp options. It is affected by
the following items on the command line: the router name
itself, --community, --snmp-options and --dns-domain.
(Theres no HTML escaped variant available)</p>

<p>$directory_name This variable should contain the
directory name as cfgmaker nor- mally would use as the value
for the &quot;Directory[]&quot; directive. The value is
determined by the --subdirs command line option. If
--subdirs isn t specified $directory_name will be the empty
string. (Theres no HTML escaped variant available)</p>

<p>$syscontact This variable is the routers SNMP sysContact
value. (HTML escaped variant: $html_syscontact)</p>

<p>$sysname This variable is the routers SNMP sysName
value. (No HTML escaped variant available)</p>

<p>$syslocation This variable is the routers SNMP
sysLocation value. (HTML escaped variant:
$html_syslocation)</p>

<p>$sysdescr This variable is the routers SNMP sysDescr
value. It is normally not used by cfgmaker but might be
useful in a template. (HTML escaped variant:
$html_sysdescr)</p>

<p>Interface Target Related Variables</p>

<p>$target_name This is what cfgmaker normally would use as
the the name of the target. The target name is what is found
within the square brack- ets, &quot;[]&quot;, for target
directives. (Theres no HTML escaped variant available)</p>

<p>$if_ref This the reference string for the interface. It
is expected to be used in the &quot;Target[xyz]&quot;
directive to distinguish what interface to use. The value of
this variable is affected by the --ifref com- mand line
option. It is normally used together with $router_con- nect.
(Theres no HTML escaped variant available)</p>

<p>$if_ok This variable is true if the interface is going
to be included into the configuration file, otherwise false.
Dont test against other variables such as $problem_lines to
find out if an interface will be rejected or not, use this
$if_ok instead.</p>

<p>$default_target_lines This variable contains all the
target lines which cfgmaker by default outputs for this
interface. Its useful if you want to have the &quot;standard
target&quot; but want to add some extra lines to it by using
a template.</p>

<p>By default cfgmaker uses the following directives for
each target it generates: Target[], SetEnv[], MaxBytes[],
Title[], PageTop[] and if there is any directory specified
also the Directory[] directive.</p>

<p>To facilitate the creation of templates which generates
target configs which are similar to the default one, each of
the above mentioned directive lines have a corresponding
variable containing the line as cfgmaker would have output
it by default.</p>

<p>Note that none of these have a HTML escaped variant,
text in them is HTML escaped where needed. Also note that
they do not have any newline at the end.</p>

<p>$default_target_directive This variable contains the
default string for the Target[] direc- tive line.</p>

<p>$default_setenv_directive This variable contains the
default string for the SetEnv[] direc- tive line.</p>

<p>$default_directory_directive This variable contains the
default string for the Directory[] directive line which
means it is an empty string (with no newline) if theres no
directory.</p>

<p>$default_maxbytes_directive This variable contains the
default string for the MaxBytes[] direc- tive line.</p>

<p>$default_title_directive This variable contains the
default string for the Title[] directive line.</p>

<p>$default_pagetop_directive This variable contains the
default string for the PageTop[] direc- tive lines.</p>

<p>Interface Network Configuration Variables</p>

<p>$if_ip This variable should contain the IP-address of
the interface, if any has been assigned to it. (Theres no
HTML escaped variant available)</p>

<p>$ifindex This variable is the SNMP ifIndex for the
interface which per defi- nition always is an integer.
(Theres no HTML escaped variant available)</p>

<p>$if_index Equivalent with $ifindex.</p>

<p>$if_eth Contains the ethernet address of the interface,
if any. (Theres no HTML escaped variant available)</p>

<p>$if_speed This variable is the speed in bytes/second
(with prefixes). (Theres no HTML escaped variant
available)</p>

<p>$if_speed_str This variable is a cooked speed
description which is either in bits or bytes depending on
wether or not the bits option is active and also with the
proper prefix for the speed (k, M, G etc). (No HTML escaped
variant available)</p>

<p>$if_type_desc This variable is a textual description of
the interface type. (HTML escaped variant:
$html_if_type_desc)</p>

<p>$if_type_num This variable the integer value
corresponding to the interface type (for a listing for the
value for the more common interface types, see the section
DETAILS ON FILTERS above). (No HTML escaped vari- ant
available)</p>

<p>$if_dns_name This is the DNS name for the interface. (No
HTML escaped variant available)</p>

<p>Interface Name, Description and Alias Variables</p>

<p>It might seem confusing with both Name, Description and
Alias in this context and to some extent it is. Name and
Description are usually supported on most equipment but how
they are used varies, both between manufacturers as well as
between different cathegories of equipment from the same
manufacturer. The Alias is at least supported by Cisco IOS,
and that variable contains whatever is used in the IOS
statement called &quot;description&quot; for the interface
(not to be confused with the SNMP variables for
Description).</p>

<p>For better control from the command line consider
$if_title_desc which contents are controlled by the
--if-descr command line option.</p>

<p>$if_snmp_descr This variable should contain the
&quot;raw&quot; description of the interface as determined
by the SNMP polling of the router. (HTML escaped variant:
$html_if_snmp_descr)</p>

<p>$if_snmp_name The &quot;raw&quot; name for the interface
as provided by SNMP polling. (HTML escaped variant:
$html_if_snmp_name)</p>

<p>$if_snmp_alias The &quot;raw&quot; ifAlias for the
interface as provided by SNMP polling. (HTML escaped
variant: $html_if_snmp_alias)</p>

<p>$if_cisco_descr The &quot;raw&quot; CiscolocIfDescr for
the interface as provided by SNMP polling. (HTML escaped
variant: $html_if_cisco_descr)</p>

<p>$if_description This is the &quot;cooked&quot;
description string for the interface, taking into account
the SNMP values found for the interfaces RDescr, ifAlias and
CiscolocIfDescr. (HTML escaped variant:
$html_if_description)</p>

<p>$if_title The full string cfgmaker by default would have
used for the Title[] directive in the configuration as well
as the content of the top- most H1 tag in the PageTop[]. Is
composed by the contents of $desc_prefix, $if_title_desc and
$sysname.</p>

<p>As $if_title depends on $if_title_desc, it is possible
to indi- rectly control $if_title by using the command line
option --if-descr.</p>

<p>(HTML escaped variant: $html_if_title)</p>

<p>$if_port_name If the host is a Cisco Catalyst LAN
switch, this variable is the name of that port. (No HTML
escaped variant available)</p>

<p>$if_pp_port_name If the host is a Nortel Passport LAN
switch, this variable is the name of that port. (No HTML
escaped variant available)</p>

<p>$desc_prefix This variable is a prefix of the
description of what the target is to use in the
&quot;Title[]&quot; directive and in the H1 section of the
&quot;PageTop[]&quot;. Default is &quot;Traffic analysis for
&quot;. (HTML escaped variant: $html_desc_prefix)</p>

<p>$if_title_desc This is the description of the interface
normally used by cfgmaker as part of the variable $if_title.
The latter is used as the full string in the
&quot;Title[]&quot; directove and the H1 section in the
Page- Top[].</p>

<p>$if_title_desc is controlled by the command line option
--if-descr which indirectly controls the contents of
$if_title</p>

<p>(HTML escaped variant: $html_if_title_desc)</p>

<p>Help Functions for Templates</p>

<p>The following functions exists to facilitate the writing
of host and interface templates.</p>

<p>html_escape(string) html_escape() takes a string as an
argument and returns a new string where the following
substitutions has been done: the chars &quot;&lt;&quot;,
&quot;&gt;&quot; and &quot;&amp;&quot; are replaced by
&quot;&amp;lt;&quot;, &quot;&amp;gt;&quot; and
&quot;&amp;amp;&quot; and that newlines embedded in the
string are prepended with &quot;&lt;BR&gt;&quot; and
appended with a space character (newlines at the end of the
string are not touched).</p>


<p>oid_pick($router_connect,$v3opt,&quot;oid1&quot;,&quot;oid2&quot;...)
This function will try to poll each of the oids specified
until it is successful or has run out of oids. It will
return the name of the first oid that worked or undef if it
is not successful</p>

<p>Example Template Files</p>

<p>Template Example 1: Eliminating Rejected Targets From
Appearing</p>

<p>This template file generates exactly the same
configuration code per interface as cfgmaker does by
default, with the exception that it elim- inates all lines
(comments as well as config code) for an interface if the
interface happens to be rejected.</p>

<p>if(not $problem_lines) { $target_lines .=
&lt;&lt;ECHO;</p>

<p>Target[$target_name]: $if_ref:$router_connect
SetEnv[$target_name]: MRTG_INT_IP=&quot;$if_ip&quot;
MRTG_INT_DESCR=&quot;$if_snmp_descr&quot; ECHO</p>

<p>if ($directory_name) { $target_lines .=
&quot;Directory[$target_name]: $directory_name0; }</p>

<p>$target_lines .= &lt;&lt;ECHO; MaxBytes[$target_name]:
$if_speed Title[$target_name]:
$html_desc_prefix$html_if_title_desc -- $sysname
PageTop[$target_name]:
&lt;h1&gt;$html_desc_prefix$html_if_title_desc --
$sysname&lt;/h1&gt; &lt;div id=&quot;sysdetails&quot;&gt;
&lt;table&gt; &lt;tr&gt; &lt;td&gt;System:&lt;/td&gt;
&lt;td&gt;$sysname in $html_syslocation&lt;/td&gt;
&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Maintainer:&lt;/td&gt;
&lt;td&gt;$html_syscontact&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt;
&lt;td&gt;Description:&lt;/td&gt;
&lt;td&gt;$html_if_description&lt;/td&gt; &lt;/tr&gt;
&lt;tr&gt; &lt;td&gt;ifType:&lt;/td&gt;
&lt;td&gt;$html_if_type_desc ($if_type_num)&lt;/td&gt;
&lt;/tr&gt; &lt;tr&gt; &lt;td&gt;ifName:&lt;/td&gt;
&lt;td&gt;$html_if_snmp_name&lt;/td&gt; &lt;/tr&gt; ECHO</p>

<p>$target_lines .= &lt;&lt;ECHO if defined $if_port_name;
&lt;tr&gt; &lt;td&gt;Port Name:&lt;/td&gt;
&lt;td&gt;$if_port_name&lt;/td&gt; &lt;/tr&gt; ECHO</p>

<p>$target_lines .= &lt;&lt;ECHO if defined
$if_pp_port_name; &lt;tr&gt; &lt;td&gt;Port Name:&lt;/td&gt;
&lt;td&gt;$if_pp_port_name&lt;/td&gt; &lt;/tr&gt; ECHO</p>

<p>$target_lines .= &lt;&lt;ECHO; &lt;tr&gt; &lt;td&gt;Max
Speed:&lt;/td&gt; &lt;td&gt;$if_speed_str&lt;/td&gt;
&lt;/tr&gt; ECHO</p>

<p>$target_lines .= &lt;&lt;ECHO if $if_ip; &lt;tr&gt;
&lt;td&gt;Ip:&lt;/td&gt; &lt;td&gt;$if_ip
($if_dns_name)&lt;/td&gt; &lt;/tr&gt; ECHO</p>

<p>$target_lines .= &lt;&lt;ECHO; &lt;/table&gt;
&lt;/div&gt; ECHO } else { $head_lines=&quot;&quot;;
$problem_lines=&quot;&quot;; $target_lines=&quot;&quot;;
$separator_lines=&quot;&quot;; }</p>

<p>Template Example 2: Simplier Version of Example 1</p>

<p>Example 1 was partly intended to demonstrate how to
customize the gen- eration of interface targets but also to
provide a hint of how the variables are used in the
&quot;default&quot; template which one could consider that
cfgmaker normally uses.</p>

<p>If youre only intrested in the easiest way of entirely
eliminating those reject interfaces, the template below
would do the job as well by using $default_target_lines.</p>

<p>if($if_ok) { $target_lines = $default_target_lines; }
else { $head_lines=&quot;&quot;;
$problem_lines=&quot;&quot;; $target_lines=&quot;&quot;;
$separator_lines=&quot;&quot;; }</p>

<p>Template Example 3: Creating CPU Targets for Hosts</p>

<p>Below is an example of a host template.</p>

<p>$head_lines .= &lt;&lt;ECHO;
#---------------------------------------------------------------------
ECHO</p>

<p>my $target_name = $router_name . &quot;.cpu&quot;;</p>

<p>$target_lines .= &lt;&lt;ECHO;</p>

<p>YLegend[$target_name]: Percentage CPU load
ShortLegend[$target_name]: % Legend1[$target_name]: CPU load
in % Legend2[$target_name]: Legend3[$target_name]: Max
Observed CPU load Legend4[$target_name]:
LegendI[$target_name]: &amp;nbsp;CPU Load:
LegendO[$target_name]: WithPeak[$target_name]: ywm
MaxBytes[$target_name]: 100 Options[$target_name]:
growright, gauge, nopercent Title[$target_name]:
$router_name CPU load Target[$target_name]:
1.3.6.1.4.1.9.2.1.58.0&amp;1.3.6.1.4.1.9.2.1.58.0:$router_connect
PageTop[$target_name]: &lt;h1&gt;$router_name CPU
load&lt;/h1&gt; &lt;div&gt; &lt;table&gt; &lt;tr&gt;
&lt;td&gt;System:&lt;/td&gt; &lt;td&gt;$router_name in
$html_syslocation&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt;
&lt;td&gt;Maintainer:&lt;/td&gt;
&lt;td&gt;$html_syscontact&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt;
&lt;td&gt;Description:&lt;/td&gt;
&lt;td&gt;$html_sysdescr&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt;
&lt;td&gt;Resource:&lt;/td&gt; &lt;td&gt;CPU.&lt;/td&gt;
&lt;/tr&gt; &lt;/table&gt; &lt;/div&gt; ECHO</p>

<p>EXAMPLES The first example creates a config file for
router.place.xyz: the router has the community name public.
Interfaces get identified by their IP number. Two global
options get added to the config file. The config file gets
redirected to mrtg.conf. The signs at the end of the line
mean that this command should be written on a single
line.</p>

<p>cfgmaker --global &quot;WorkDir: /home/tobi&quot;
--global &quot;Options[_]: growright,bits&quot; --ifref=ip
public@router.place.xyz &gt; mrtg.cfg</p>

<p>Note: if cfgmaker is not in your path, but you are in
the directory where cfgmaker is stored, you can start it
with ./cfgmaker</p>

<p>The next example creates a config file for four devices:
router1.place.xyz, router2.place.xyz, switch1.place.xyz and
switch2.place.xyz all with the community public.</p>

<p>The two routers will have --ifref set to descr whilst
the two switches will use --ifref set to name. Further the
routers will use --ifdesc set to alias and switch1.place.xyz
will use --ifdesc set to descr whilst switch2.place.xyz use
name instead.</p>

<p>Finally, there will be two Options lines inserted in the
configuration: One will be in the beginning, whilst the
other will be inserted after the lines related to the two
routers but before those lines related to the switches.</p>

<p>cfgmaker --global &quot;WorkDir: /home/tobi&quot;
--global &quot;Options[_]: growright,bits&quot;
--ifref=descr --ifdesc=alias public@router1.place.xyz
public@router2.place.xyz --global &quot;Options[_]:
growright&quot; --ifref=name --ifdesc=descr
public@switch1.place.xyz --ifdesc=name
public@switch2.place.xyz &gt; mrtg.cfg</p>

<p>The next example demonstrates how to use the
--community, --snmp-options and --dns-domain to make the
command line simpler. All the equipment will use the
community hidden, except for the ppp-server which use
community access. All equipment uses these SNMP options: 1s
timeout, 1 retry and SNMP version 2 (backoff and port is
unspecified which means they use the default values). The
exception again is the ppp-server which uses SNMP version 1.
Finally, all the equipment is part of the domain place.xyz,
except for the ppp-server which is part of the domain
remote.place.xyz. Note that the latter is achieved sim- ply
by specifying the name of the ppp-server to be
ppp-server.remote .</p>

<p>cfgmaker --global &quot;WorkDir: /home/tobi&quot;
--global &quot;Options[_]: growright,bits&quot;
--dns-domain=place.xyz --community=hidden
--snmp-options=::1:1::2 router1 router2 router3 router4
router5 switch1 switch2 switch3 switch4 switch5 switch6
switch7 access@ppp-server.remote:::::1 &gt; mrtg.cfg</p>

<p>SEE ALSO mrtg-reference</p>

<p>AUTHOR Tobias Oetiker &lt;tobi@oetiker.ch&gt; and Jakob
Ilves &lt;jakob.ilves@ora- cle.com&gt;</p>

<p>LICENSE GNU General Public License</p>

<p>COPYRIGHT Cfgmaker is Copyright 2000 by Tobias Oetiker
&lt;tobi@oetiker.ch&gt;</p>

<p>2.16.2 2008-05-16 CFGMAKER(1)</p>
<hr>
</body>
</html>
