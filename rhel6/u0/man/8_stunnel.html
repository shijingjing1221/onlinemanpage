<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 22:18:12 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>STUNNEL(8) stunnel STUNNEL(8)</p>

<p>NAME stunnel - universal SSL tunnel</p>

<p>SYNOPSIS Unix: stunnel [&lt;filename&gt;] | -fdn | -help
| -version | -sockets</p>

<p>WIN32: stunnel [ [-install | -uninstall | -start |
-stop] [-quiet] [&lt;filename&gt;] ] | -help | -version |
-sockets</p>

<p>DESCRIPTION The stunnel program is designed to work as
SSL encryption wrapper between remote clients and local
(inetd-startable) or remote servers. The concept is that
having non-SSL aware daemons running on your system you can
easily set them up to communicate with clients over secure
SSL channels.</p>

<p>stunnel can be used to add SSL functionality to commonly
used Inetd daemons like POP-2, POP-3, and IMAP servers, to
standalone daemons like NNTP, SMTP and HTTP, and in
tunneling PPP over network sockets without changes to the
source code.</p>

<p>This product includes cryptographic software written by
Eric Young (eay@cryptsoft.com)</p>

<p>OPTIONS &lt;filename&gt; Use specified configuration
file</p>

<p>-fd n (Unix only) Read the config file from specified
file descriptor</p>

<p>-help Print stunnel help menu</p>

<p>-version Print stunnel version and compile time
defaults</p>

<p>-sockets Print default socket options</p>

<p>-install (NT/2000/XP only) Install NT Service</p>

<p>-uninstall (NT/2000/XP only) Uninstall NT Service</p>

<p>-start (NT/2000/XP only) Start NT Service</p>

<p>-stop (NT/2000/XP only) Stop NT Service</p>

<p>-quiet (NT/2000/XP only) Dont display a message box when
successfully installed or uninstalled NT service</p>

<p>CONFIGURATION FILE Each line of the configuration file
can be either:</p>

<p>&middot; an empty line (ignored)</p>

<p>&middot; a comment starting with ; (ignored)</p>

<p>&middot; an option_name = option_value pair</p>

<p>&middot; [service_name] indicating a start of a service
definition</p>

<p>GLOBAL OPTIONS chroot = directory (Unix only) directory
to chroot stunnel process</p>

<p>chroot keeps stunnel in chrooted jail. CApath, CRLpath,
pid and exec are located inside the jail and the patches
have to be relative to the directory specified with
chroot.</p>

<p>To have libwrap (TCP Wrappers) control effective in a
chrooted environment you also have to copy its configuration
files (/etc/hosts.allow and /etc/hosts.deny) there.</p>

<p>compression = zlib | rle select data compression
algorithm</p>

<p>default: no compression</p>

<p>zlib compression of OpenSSL 0.9.8 or above is not
backward compatible with OpenSSL 0.9.7.</p>

<p>rle compression is currently not implemented by the
OpenSSL library.</p>

<p>debug = [facility.]level debugging level</p>

<p>Level is a one of the syslog level names or numbers
emerg (0), alert (1), crit (2), err (3), warning (4), notice
(5), info (6), or debug (7). All logs for the specified
level and all levels numerically less than it will be shown.
Use debug = debug or debug = 7 for greatest debugging
output. The default is notice (5).</p>

<p>The syslog facility authpriv will be used unless a
facility name is supplied. (Facilities are not supported on
Win32.)</p>

<p>Case is ignored for both facilities and levels.</p>

<p>EGD = egd path (Unix only) path to Entropy Gathering
Daemon socket</p>

<p>Entropy Gathering Daemon socket to use to feed OpenSSL
random number generator. (Available only if compiled with
OpenSSL 0.9.5a or higher)</p>

<p>engine = auto | &lt;engine id&gt; select hardware
engine</p>

<p>default: software-only cryptography</p>

<p>Theres an example in EXAMPLES section.</p>

<p>engineCtrl = command[:parameter] control hardware
engine</p>

<p>Special commands &quot;LOAD&quot; and &quot;INIT&quot;
can be used to load and initialize the engine cryptogaphic
module.</p>

<p>fips = yes | no Enable or disable FIPS 140-2 mode.</p>

<p>This option allows to disable entering FIPS mode if
stunnel was compiled with FIPS 140-2 support.</p>

<p>default: yes</p>

<p>foreground = yes | no (Unix only) foreground mode</p>

<p>Stay in foreground (don t fork) and log to stderr
instead of via syslog (unless output is specified).</p>

<p>default: background in daemon mode</p>

<p>output = file append log messages to a file instead of
using syslog</p>

<p>/dev/stdout device can be used to redirect log messages
to the standard output (for example to log them with
daemontools splogger).</p>

<p>pid = file (Unix only) pid file location</p>

<p>If the argument is empty, then no pid file will be
created.</p>

<p>pid path is relative to chroot directory if
specified.</p>

<p>RNDbytes = bytes bytes to read from random seed
files</p>

<p>Number of bytes of data read from random seed files.
With SSL versions less than 0.9.5a, also determines how many
bytes of data are considered sufficient to seed the PRNG.
More recent OpenSSL versions have a builtin function to
determine when sufficient randomness is available.</p>

<p>RNDfile = file path to file with random seed data</p>

<p>The SSL library will use data from this file first to
seed the random number generator.</p>

<p>RNDoverwrite = yes | no overwrite the random seed files
with new random data</p>

<p>default: yes</p>

<p>service = servicename use specified string as the
service name</p>

<p>On Unix: inetd mode service name for TCP Wrapper
library.</p>

<p>On NT/2000/XP: NT service name in the Control Panel.</p>

<p>default: stunnel</p>

<p>setgid = groupname (Unix only) setgid() to groupname in
daemon mode and clears all other groups</p>

<p>setuid = username (Unix only) setuid() to username in
daemon mode</p>

<p>socket = a|l|r:option=value[:value] Set an option on
accept/local/remote socket</p>

<p>The values for linger option are l_onof:l_linger. The
values for time are tv_sec:tv_usec.</p>

<p>Examples:</p>

<p>socket = l:SO_LINGER=1:60 set one minute timeout for
closing local socket socket = r:TCP_NODELAY=1 turn off the
Nagle algorithm for remote sockets socket = r:SO_OOBINLINE=1
place out-of-band data directly into the receive data stream
for remote sockets socket = a:SO_REUSEADDR=0 disable address
reuse (enabled by default) socket = a:SO_BINDTODEVICE=lo
only accept connections on loopback interface</p>

<p>syslog = yes | no (Unix only) enable logging via
syslog</p>

<p>default: yes</p>

<p>taskbar = yes | no (WIN32 only) enable the taskbar
icon</p>

<p>default: yes</p>

<p>SERVICE-LEVEL OPTIONS Each configuration section begins
with service name in square brackets. The service name is
used for libwrap (TCP Wrappers) access control and lets you
distinguish stunnel services in your log files.</p>

<p>Note that if you wish to run stunnel in inetd mode
(where it is provided a network socket by a server such as
inetd, xinetd, or tcpserver) then you should read the
section entitled INETD MODE below.</p>

<p>accept = [host:]port accept connections on specified
host:port</p>

<p>If no host specified, defaults to all IP addresses for
the local host.</p>

<p>CApath = directory Certificate Authority directory</p>

<p>This is the directory in which stunnel will look for
certificates when using the verify. Note that the
certificates in this directory should be named XXXXXXXX.0
where XXXXXXXX is the hash value of the DER encoded subject
of the cert (the first 4 bytes of the MD5 hash in least
significant byte order).</p>

<p>CApath path is relative to chroot directory if
specified.</p>

<p>CAfile = certfile Certificate Authority file</p>

<p>This file contains multiple CA certificates, used with
the verify.</p>

<p>cert = pemfile certificate chain PEM file name</p>

<p>A PEM is always needed in server mode. Specifying this
flag in client mode will use this certificate chain as a
client side certificate chain. Using client side certs is
optional. The certificates must be in PEM format and must be
sorted starting with the certificate to the highest level
(root CA).</p>

<p>ciphers = cipherlist Select permitted SSL ciphers</p>

<p>A colon delimited list of the ciphers to allow in the
SSL connection. For example DES-CBC3-SHA:IDEA-CBC-MD5</p>

<p>client = yes | no client mode (remote service uses
SSL)</p>

<p>default: no (server mode)</p>

<p>connect = [host:]port connect to a remote host:port</p>

<p>If no host is specified, the host defaults to
localhost.</p>

<p>Multiple connect options are allowed in a single service
section.</p>

<p>If host resolves to multiple addresses and/or if
multiple connect options are specified, then the remote
address is chosen using a round-robin algorithm.</p>

<p>CRLpath = directory Certificate Revocation Lists
directory</p>

<p>This is the directory in which stunnel will look for
CRLs when using the verify. Note that the CRLs in this
directory should be named XXXXXXXX.0 where XXXXXXXX is the
hash value of the CRL.</p>

<p>CRLpath path is relative to chroot directory if
specified.</p>

<p>CRLfile = certfile Certificate Revocation Lists file</p>

<p>This file contains multiple CRLs, used with the
verify.</p>

<p>delay = yes | no delay DNS lookup for connect option</p>

<p>engineNum = engine number select engine number to read
private key</p>

<p>The engines are numbered starting from 1.</p>

<p>exec = executable_path (Unix only) execute local
inetd-type program</p>

<p>exec path is relative to chroot directory if
specified.</p>

<p>execargs = $0 $1 $2 ... (Unix only) arguments for exec
including program name ($0)</p>

<p>Quoting is currently not supported. Arguments are
separated with arbitrary number of whitespaces.</p>

<p>failover = rr | prio Failover strategy for multiple
&quot;connect&quot; targets.</p>

<p>rr (round robin) - fair load distribution prio
(priority) - use the order specified in config file</p>

<p>default: rr</p>

<p>ident = username use IDENT (RFC 1413) username
checking</p>

<p>key = keyfile private key for certificate specified with
cert option</p>

<p>Private key is needed to authenticate certificate owner.
Since this file should be kept secret it should only be
readable to its owner. On Unix systems you can use the
following command:</p>

<p>chmod 600 keyfile</p>

<p>default: value of cert option</p>

<p>local = host IP of the outgoing interface is used as
source for remote connections. Use this option to bind a
static local IP address, instead.</p>

<p>OCSP = url select OCSP server for certificate
verification</p>

<p>OCSPflag = flag specify OCSP server flag</p>

<p>Several OCSPflag can be used to specify multiple
flags.</p>

<p>currently supported flags: NOCERTS, NOINTERN NOSIGS,
NOCHAIN, NOVERIFY, NOEXPLICIT, NOCASIGN, NODELEGATED,
NOCHECKS, TRUSTOTHER, RESPID_KEY, NOTIME</p>

<p>options = SSL_options OpenSSL library options</p>

<p>The parameter is the OpenSSL option name as described in
the SSL_CTX_set_options(3ssl) manual, but without SSL_OP_
prefix. Several options can be used to specify multiple
options.</p>

<p>For example for compatibility with erroneous Eudora SSL
implementation the following option can be used:</p>

<p>options = DONT_INSERT_EMPTY_FRAGMENTS</p>

<p>protocol = proto application protocol to negotiate
SSL</p>

<p>currently supported: cifs, connect, imap, nntp, pop3,
smtp, pgsql</p>

<p>protocolAuthentication = auth_type authentication type
for protocol negotiations</p>

<p>currently supported: basic, NTLM</p>

<p>Currently authentication type only applies to connect
protocol.</p>

<p>default: basic</p>

<p>protocolHost = host:port destination address for
protocol negotiations</p>

<p>protocolPassword = password password for protocol
negotiations</p>

<p>protocolUsername = username username for protocol
negotiations</p>

<p>pty = yes | no (Unix only) allocate pseudo terminal for
exec option</p>

<p>retry = yes | no (Unix only) reconnect a connect+exec
section after it s disconnected</p>

<p>default: no</p>

<p>session = timeout session cache timeout</p>

<p>sessiond = host:port address of sessiond SSL cache
server</p>

<p>sslVersion = version select version of SSL protocol</p>

<p>Allowed options: all, SSLv2, SSLv3, TLSv1</p>

<p>stack = bytes (except for FORK model) thread stack
size</p>

<p>TIMEOUTbusy = seconds time to wait for expected data</p>

<p>TIMEOUTclose = seconds time to wait for close_notify
(set to 0 for buggy MSIE)</p>

<p>TIMEOUTconnect = seconds time to wait to connect a
remote host</p>

<p>TIMEOUTidle = seconds time to keep an idle
connection</p>

<p>transparent = yes | no (Unix only) transparent proxy
mode</p>

<p>Re-write address to appear as if wrapped daemon is
connecting from the SSL client machine instead of the
machine running stunnel.</p>

<p>This option is currently available in:</p>

<p>remote mode (I&lt;connect&gt; option) on Linux
&gt;=2.6.28 remote mode (I&lt;connect&gt; option) 2.2.x
local mode (I&lt;exec&gt; option)</p>

<p>Remote mode (either 2.2.x and &gt;=2.6.28) requires
stunnel to be executed as root. setuid option will also
break this functionality.</p>

<p>Linux &gt;=2.6.28 requires the following setup for
iptables and routing (possibly in /etc/rc.local or
equivalent file):</p>

<p>iptables -t mangle -N DIVERT iptables -t mangle -A
PREROUTING -p tcp -m socket -j DIVERT iptables -t mangle -A
DIVERT -j MARK --set-mark 1 iptables -t mangle -A DIVERT -j
ACCEPT ip rule add fwmark 1 lookup 100 ip route add local
0.0.0.0/0 dev lo table 100</p>

<p>Linux 2.2.x requires kernel to be compiled with
transparent proxy option. Connected service must be
installed on a separate host. Routing towards the clients
has to go through the stunnel box.</p>

<p>Local mode works by LD_PRELOADing env.so shared
library.</p>

<p>verify = level verify peer certificate</p>

<p>level 1 - verify peer certificate if present level 2 -
verify peer certificate level 3 - verify peer with locally
installed certificate default - no verify</p>

<p>It is important to understand, that this option was
solely designed for access control and not for
authorization. Specifically for level 2 every non-revoked
certificate is accepted regardless of its Common Name. For
this reason a dedicated CA should be used with level 2, and
not a generic CA commonly used for webservers. Level 3 is
preferred for point-to-point connections.</p>

<p>RETURN VALUE stunnel returns zero on success, non-zero
on error.</p>

<p>EXAMPLES In order to provide SSL encapsulation to your
local imapd service, use</p>

<p>[imapd] accept = 993 exec = /usr/sbin/imapd execargs =
imapd</p>

<p>If you want to provide tunneling to your pppd daemon on
port 2020, use something like</p>

<p>[vpn] accept = 2020 exec = /usr/sbin/pppd execargs =
pppd local pty = yes</p>

<p>If you want to use stunnel in inetd mode to launch your
imapd process, you d use this stunnel.conf. Note there must
be no [service_name] section.</p>

<p>exec = /usr/sbin/imapd execargs = imapd</p>

<p>Here is an example of advanced engine configuration to
read private key from an OpenSC engine</p>

<p>engine=dynamic
engineCtrl=SO_PATH:/usr/lib/opensc/engine_pkcs11.so
engineCtrl=ID:pkcs11 engineCtrl=LIST_ADD:1 engineCtrl=LOAD
engineCtrl=MODULE_PATH:/usr/lib/pkcs11/opensc-pkcs11.so
engineCtrl=INIT</p>

<p>[service] engineNum=1 key=id_45</p>

<p>FILES stunnel.conf stunnel configuration file</p>

<p>stunnel.pem stunnel certificate and private key</p>

<p>BUGS Option execargs does not support quoting.</p>

<p>RESTRICTIONS stunnel cannot be used for the FTP daemon
because of the nature of the FTP protocol which utilizes
multiple ports for data transfers. There are available SSL
enabled versions of FTP and telnet daemons, however.</p>

<p>NOTES INETD MODE The most common use of stunnel is to
listen on a network port and establish communication with
either a new port via the connect option, or a new program
via the exec option. However there is a special case when
you wish to have some other program accept incoming
connections and launch stunnel, for example with inetd,
xinetd, or tcpserver.</p>

<p>For example, if you have the following line in
inetd.conf:</p>

<p>imaps stream tcp nowait root /usr/bin/stunnel stunnel
/etc/stunnel/imaps.conf</p>

<p>In these cases, the inetd-style program is responsible
for binding a network socket (imaps above) and handing it to
stunnel when a connection is received. Thus you do not want
stunnel to have any accept option. All the Service Level
Options should be placed in the global options section, and
no [service_name] section will be present. See the EXAMPLES
section for example configurations.</p>

<p>CERTIFICATES Each SSL enabled daemon needs to present a
valid X.509 certificate to the peer. It also needs a private
key to decrypt the incoming data. The easiest way to obtain
a certificate and a key is to generate them with the free
OpenSSL package. You can find more information on
certificates generation on pages listed below.</p>

<p>The order of contents of the .pem file is important. It
should contain the unencrypted private key first, then a
signed certificate (not certificate request). There should
be also empty lines after certificate and private key.
Plaintext certificate information appended on the top of
generated certificate should be discarded. So the file
should look like this:</p>

<p>-----BEGIN RSA PRIVATE KEY----- [encoded key] -----END
RSA PRIVATE KEY----- [empty line] -----BEGIN
CERTIFICATE----- [encoded certificate] -----END
CERTIFICATE----- [empty line]</p>

<p>RANDOMNESS stunnel needs to seed the PRNG (pseudo random
number generator) in order for SSL to use good randomness.
The following sources are loaded in order until sufficient
random data has been gathered:</p>

<p>&middot; The file specified with the RNDfile flag.</p>

<p>&middot; The file specified by the RANDFILE environment
variable, if set.</p>

<p>&middot; The file .rnd in your home directory, if
RANDFILE not set.</p>

<p>&middot; The file specified with --with-random at
compile time.</p>

<p>&middot; The contents of the screen if running on
Windows.</p>

<p>&middot; The egd socket specified with the EGD flag.</p>

<p>&middot; The egd socket specified with --with-egd-sock
at compile time.</p>

<p>&middot; The /dev/urandom device.</p>

<p>With recent (&gt;=OpenSSL 0.9.5a) version of SSL it will
stop loading random data automatically when sufficient
entropy has been gathered. With previous versions it will
continue to gather from all the above sources since no SSL
function exists to tell when enough data is available.</p>

<p>Note that on Windows machines that do not have console
user interaction (mouse movements, creating windows, etc)
the screen contents are not variable enough to be
sufficient, and you should provide a random file for use
with the RNDfile flag.</p>

<p>Note that the file specified with the RNDfile flag
should contain random data -- that means it should contain
different information each time stunnel is run. This is
handled automatically unless the RNDoverwrite flag is used.
If you wish to update this file manually, the openssl rand
command in recent versions of OpenSSL, would be useful.</p>

<p>One important note -- if /dev/urandom is available,
OpenSSL has a habit of seeding the PRNG with it even when
checking the random state, so on systems with /dev/urandom
youre likely to use it even though its listed at the very
bottom of the list above. This isnt stunnes behaviour, its
OpenSSLs.</p>

<p>SEE ALSO tcpd(8) access control facility for internet
services</p>

<p>inetd(8) internet super-server</p>

<p>http://stunnel.mirt.net/ stunnel homepage</p>

<p>http://www.stunnel.org/ stunnel Frequently Asked
Questions</p>

<p>http://www.openssl.org/ OpenSSL project website</p>

<p>AUTHOR Michal Trojnara
&lt;Michal.Trojnara@mirt.net&gt;</p>

<p>4.29 2009.11.20 STUNNEL(8)</p>
<hr>
</body>
</html>
