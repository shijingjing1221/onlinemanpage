<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Sat Nov 12 22:24:58 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>VIRT-V2V(1) User Contributed Perl Documentation
VIRT-V2V(1)</p>

<p>NAME virt-v2v - Convert a guest to use KVM</p>

<p>SYNOPSIS virt-v2v -i libvirtxml -op imported --network
default guest-domain.xml</p>

<p>virt-v2v -ic esx://esx.server/ -op imported --network
default esx_guest</p>

<p>virt-v2v -ic esx://esx.server/ -o rhev -osd
rhev.nfs.storage:/export_domain --network rhevm
esx_guest</p>

<p>DESCRIPTION virt-v2v converts guests from a foreign
hypervisor to run on KVM, managed by libvirt or Red Hat
Enterprise Virtualisation (RHEV) version 2.2 or later. It
can currently convert Red Hat Enterprise Linux and Windows
guests running on Xen and VMware ESX. It will enable VirtIO
drivers in the converted guest if possible.</p>

<p>OPTIONS -i input Specifies what input method to use to
obtain the guest for conversion. The default is
&quot;libvirt&quot;. Supported options are:</p>

<p>libvirt Guest argument is the name of a libvirt
domain.</p>

<p>libvirtxml Guest argument is the path to an XML file
containing a libvirt domain.</p>

<p>-ic URI Specifies the connection to use when using the
libvirt input method. If omitted, this defaults to
qemu:///system.</p>

<p>N.B. virt-v2v can currently automatically obtain guest
storage from local libvirt connections, ESX connections, and
connections over SSH. Other types of connection are not
supported.</p>

<p>-it method Specifies the transport method used to obtain
raw storage from the source guest. This is currently only a
placeholder, and does nothing.</p>

<p>-o method Specifies the output method. Supported output
methods are:</p>

<p>libvirt Create a libvirt guest. See the -oc and -op
options. -op must be specified for the libvirt output
method.</p>

<p>rhev Create a guest on a RHEV Export storage domain,
which can later be imported into RHEV using the UI. -osd
must be specified for the rhev output method.</p>

<p>If no output type is specified, it defaults to
libvirt.</p>

<p>-oc URI Specifies the libvirt connection to use to
create the converted guest. If ommitted, this defaults to
qemu:///system.</p>

<p>N.B. virt-v2v must be able to write directly to storage
described by this libvirt connection. This makes writing to
a remote connection impractical at present.</p>

<p>-op pool Specifies the pool which will be used to create
new storage for the converted guest.</p>

<p>-osd domain Specifies the NFS path to a RHEV Export
storage domain. Note that the storage domain must have been
previously initialised by RHEV.</p>

<p>The domain must be in the format
&lt;host&gt;:&lt;path&gt;, eg:</p>

<p>rhev-storage.example.com:/rhev/export</p>

<p>The nfs export must be mountable and writable by the
machine running virt-v2v.</p>

<p>-f file | --config file Load the virt-v2v configuration
from file. Defaults to /etc/virt-v2v.conf if it exists;</p>

<p>-n network | --network network Map all guest bridges or
networks which dont have a mapping in the configuration file
to network.</p>

<p>This option cannot be used in conjunction with
--bridge.</p>

<p>-b bridge | --bridge bridge Map all guest bridges or
networks which dont have a mapping in the configuration file
to bridge.</p>

<p>This option cannot be used in conjunction with
--network.</p>

<p>--help Display brief help.</p>

<p>--version Display version number and exit.</p>

<p>PREPARING TO CONVERT A GUEST Local Xen guests N.B. The
following is required when converting guests on a host which
used to run Xen, but has been updated to run KVM. It is not
required when converting a Xen guest imported directly from
a running libvirt/Xen instance.</p>

<p>virt-v2v uses a libvirt domain description to determine
the current configuration of the guest, including the
location of its storage. This should be obtained from the
host running the guest pre-conversion by running:</p>

<p>virsh dumpxml &lt;domain&gt; &gt; &lt;domain&gt;.xml</p>

<p>This will require a reboot if the host running Xen is
the same host that will run KVM. This is because libvirt
needs to connect to a running xen hypervisor to obtain its
metadata.</p>

<p>Converting to run on libvirt/KVM Create a local storage
pool for transferred storage</p>

<p>virt-v2v copies the guest storage to the local machine
during import. When converting to run on libvirt, it creates
new storage in a locally defined libvirt pool. This pool can
be defined using any libvirt tool, and can be of any
type.</p>

<p>The simplest way to create a new pool is with
virt-manager(1). Pools can be defined from the Storage tab
under Host Details.</p>

<p>Create local network interfaces</p>

<p>The local machine must have an appropriate network for
the converted guest to connect to. This is likely to be a
bridge interface. A bridge interface can be created using
standard tools on the host.</p>

<p>Since version 0.8.3, virt-manager(1) can also create and
manage bridges.</p>

<p>Converting to run on RHEV Create an NFS export
domain</p>

<p>virt-v2v can convert guests to run on RHEV 2.2 or later.
It does this by writing the converted guest directly to an
Export NFS storage domain. The guest can later be imported
into a RHEV Data Center through the UI.</p>

<p>In RHEV 2.2, a new Export storage domain is created by
clicking on New Domain in the Storage tab. Ensure that the
Domain function is Export and the Storage type is NFS. See
the RHEV documentation for details. The NFS storage domain
must be mountable by the machine running virt-v2v.</p>

<p>N.B. When exporting to RHEV, virt-v2v must run as
root.</p>

<p>Import the appropriate Guest Tools ISO</p>

<p>Conversion of Windows guests requires that the Guest
Tools ISO has been installed before the guest is converted.
This must be done using the ISO Uploader, which can be found
on your RHEV-M system under Start-&gt;Red Hat-&gt;RHEV
Manager-&gt;ISO Uploader.</p>

<p>Failure to do this will result in drivers not being
correctly installed in the guest after conversion.</p>

<p>CONVERTING A LOCAL XEN GUEST The following requires that
the domain XML is available locally, and that the storage
referred to in the domain XML is available locally at the
same paths.</p>

<p>To perform the conversion, run:</p>

<p>virt-v2v -i libvirtxml -op &lt;pool&gt; [--network
&lt;network name&gt;] &lt;domain&gt;.xml</p>

<p>where &quot;&lt;domain&gt;.xml&quot; is the path to the
exported guest domains xml, and &quot;&lt;pool&gt;&quot; is
the local storage pool where copies of the guests disks will
be created.</p>

<p>The --network option may be provided for simple network
mappings. For more complex mappings, see
virt-v2v.conf(5).</p>

<p>If it is not possible to provide software updates over
the network in your environment, software will be installed
as specified in virt-v2v.conf. See virt-v2v.conf(5) for a
details.</p>

<p>It is possible to avoid specifying replacement kernels
in the virt-v2v config file by ensuring that the guest has
an appropriate kernel installed prior to conversion. If your
guest uses a Xen paravirtualised kernel (it would be called
something like kernel-xen or kernel-xenU), you can install a
regular kernel, which wont reference a hypervisor in its
name, alongside it. You shouldnt make this newly installed
kernel your default kernel because Xen may not boot it.
virt-v2v will make it the default during conversion.</p>

<p>CONVERTING A GUEST FROM VMWARE ESX N.B. libvirt version
0.7.0 or greater is required to connect to ESX.</p>

<p>virt-v2v can convert a guest from VMware ESX, including
transferring its storage.</p>

<p>N.B. virt-v2v does not transfer snapshots from ESX. Only
the latest flat storage is transferred.</p>

<p>The guest MUST be shut down in ESX before conversion
starts. virt-v2v will not proceed if the guest is still
running. To convert the guest, run:</p>

<p>virt-v2v -ic esx://&lt;esx.server&gt;/ -op &lt;pool&gt;
[--network &lt;network name&gt;] &lt;domain&gt;</p>

<p>where:</p>

<p>&middot; &lt;esx.server&gt; is the hostname of the ESX
server hosting the guest to be converted.</p>

<p>N.B. This hostname must match the hostname reported in
the ESX servers SSL certificate, or verification will
fail.</p>

<p>&middot; &lt;pool&gt; is the name of the local storage
pool where copies of the guests storage will be created.</p>

<p>&middot; &lt;domain&gt; is the name of the guest on the
ESX server which is to be converted.</p>

<p>The --network option may be provided for simple network
mappings. For more complex mappings, see
virt-v2v.conf(5).</p>

<p>Authenticating to the ESX server Connecting to the ESX
server will require authentication. virt-v2v supports
password authentication when connecting to ESX. It reads
passwords from $HOME/.netrc. The format of this file is
described in netrc(5). An example entry is:</p>

<p>machine esx01.example.com login root password s3cr3t</p>

<p>N.B. The permissions of .netrc MUST be set to 0600, or
it will be ignored.</p>

<p>Connecting to an ESX server with an invalid certificate
In non-production environments, the ESX server may have an
invalid certificate, for example a self-signed certificate.
In this case, certificate checking can be explicitly
disabled by adding ?no_verify=1 to the connection URI as
shown below:</p>

<p>... -ic esx://&lt;esx.server&gt;/?no_verify=1 ...</p>

<p>EXPORTING A GUEST TO RHEV virt-v2v can export to RHEV
any guest that it can convert. This includes:</p>

<p>&middot; Local Xen guests</p>

<p>&middot; ESX guests</p>

<p>&middot; Local libvirt/KVM guests</p>

<p>To export to RHEV, specify:</p>

<p>... -o rhev -osd &lt;export_sd&gt; ...</p>

<p>on the command line in place of -op as in the following
examples:</p>

<p>Exporting a local Xen guest to RHEV virt-v2v -i
libvirtxml -o rhev -osd &lt;export_sd&gt; [--network
&lt;network name&gt;] &lt;domain&gt;.xml</p>

<p>Export a VMWare ESX guest to RHEV virt-v2v -ic
esx://&lt;esx.server&gt;/ -o rhev -osd &lt;export_sd&gt;
[--network &lt;network name&gt;] &lt;domain&gt;</p>

<p>Export a local libvirt/KVM guest to RHEV virt-v2v -o
rhev -osd &lt;export_sd&gt; [--network &lt;network name&gt;]
&lt;domain&gt;</p>

<p>CONVERTING A WINDOWS GUEST When exporting to RHEV,
virt-v2v can additionally convert Windows guests. In this
case, the conversion process is split into 2 stages:</p>

<p>1. Offline conversion.</p>

<p>2. First boot.</p>

<p>The guest will be bootable after the offline conversion
stage, but will not yet have all necessary drivers installed
to work correctly in RHEV. These will be installed
automatically the first time the guest boots.</p>

<p>N.B. The first boot stage can take several minutes to
run, and must not be interrupted. It will run automatically
without any administrator intervention other than powering
on the guest. To ensure the process is not interrupted, we
strongly recommend that nobody logs in to the machine until
it has quiesced the first time it is booted after
conversion. You can check for this in the RHEV Manager
UI.</p>

<p>N.B. Driver installation on first boot requires that the
Guest Tools ISO has been previously uploaded using RHEV
Manager s ISO Uploader tool. RHEV will present this ISO to
the guest automatically the first time it is booted.</p>

<p>RUNNING THE CONVERTED GUEST Libvirt output method On
successful completion, virt-v2v will create a new libvirt
domain for the converted guest with the same name as the
original guest. It can be started as usual using libvirt
tools, for example virt-manager(1).</p>

<p>RHEV output method On successful completion virt-v2v
will have written the new guest to the export storage
domain, but it will not yet be ready to run. It must be
imported into RHEV using the UI before it can be used.</p>

<p>In RHEV 2.2 this is done from the Storage tab. Select
the export domain the guest was written to. A pane will
appear underneath the storage domain list displaying several
tabs, one of which is VM Import. The converted guest will be
listed here. Select the appropriate guest an click Import.
See the RHEV documentation for additional details.</p>

<p>POST-CONVERSION TASKS Guest network configuration
virt-v2v cannot currently reconfigure a guests network
configuration. If the converted guest is not connected to
the same subnet as the source, its network configuration may
have to be updated.</p>

<p>GUEST CONFIGURATION CHANGES As well as configuring
libvirt appropriately, virt-v2v will make certain changes to
a guest to enable it support running under a KVM host either
with or without virtio driver. These changes are guest OS
specific. Currently only Red Hat based Linux distributions
are supported.</p>

<p>Linux virt-v2v will make the following changes to a
Linux guest:</p>

<p>Kernel Un-bootable, i.e. xen paravirtualised, kernels
will be uninstalled. No new kernel will be installed if
there is a remaining kernel which supports virtio. If no
remaining kernel supports virtio and the configuration file
specifies a new kernel it will be installed and configured
as the default.</p>

<p>X reconfiguration If the guest has X configured, its
display driver will be updated. See &quot;GUEST
DRIVERS&quot; for which driver will be used.</p>

<p>Rename block devices If changes have caused block
devices to change name, these changes will be reflected in
/etc/fstab.</p>

<p>Configure device drivers Whether virtio or non-virtio
drivers are configured, virt-v2v will ensure that the
correct network and block drivers are specified in the
modprobe configuration.</p>

<p>initrd virt-v2v will ensure that the initrd for the
default kernel supports booting the root device, whether it
is using virtio or not.</p>

<p>SELinux virt-v2v will initiate a relabel of the guest on
the next boot. This ensures that any changes it has made are
correctly labelled according to the guests local policy.</p>

<p>GUEST DRIVERS Virt-v2v will configure the following
drivers in a Linux guest:</p>

<p>VirtIO X display cirrus Block virtio_blk Network
virtio_net</p>

<p>Additionally, initrd will preload the virtio_pci
driver.</p>

<p>Non-VirtIO X display cirrus Block IDE Network e1000</p>

<p>BUGS To get a list of bugs against virt-v2v use this
link:</p>


<p>&lt;https://bugzilla.redhat.com/buglist.cgi?component=virt-v2v&amp;product=Virtualization+Tools&gt;</p>

<p>To report a new bug against virt-v2v use this link:</p>


<p>&lt;https://bugzilla.redhat.com/enter_bug.cgi?component=virt-v2v&amp;product=Virtualization+Tools&gt;</p>

<p>When reporting a bug, please check:</p>

<p>&middot; That the bug hasnt been reported already.</p>

<p>&middot; That you are testing a recent version.</p>

<p>&middot; Describe the bug accurately, and give a way to
reproduce it.</p>

<p>SEE ALSO virt-v2v.conf(5), virt-manager(1),
&lt;http://libguestfs.org/&gt;.</p>

<p>AUTHOR Richard W.M. Jones
&lt;http://et.redhat.com/~rjones/&gt;</p>

<p>Matthew Booth &lt;mbooth@redhat.com&gt;</p>

<p>COPYRIGHT Copyright (C) 2009,2010 Red Hat Inc.</p>

<p>This program is free software; you can redistribute it
and/or modify it under the terms of the GNU General Public
License as published by the Free Software Foundation; either
version 2 of the License, or (at your option) any later
version.</p>

<p>This program is distributed in the hope that it will be
useful, but WITHOUT ANY WARRANTY; without even the implied
warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
PURPOSE. See the GNU General Public License for more
details.</p>

<p>You should have received a copy of the GNU General
Public License along with this program; if not, write to the
Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA
02139, USA.</p>

<p>perl v5.10.1 2010-08-19 VIRT-V2V(1)</p>
<hr>
</body>
</html>
