<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Sat Nov 12 01:08:20 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>NFSDCLTRACK</title>

</head>
<body>

<h1 align="center">NFSDCLTRACK</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#COMMANDS">COMMANDS</a><br>
<a href="#LEGACY TRANSITION MECHANISM">LEGACY TRANSITION MECHANISM</a><br>
<a href="#NOTES">NOTES</a><br>
<a href="#AUTHORS">AUTHORS</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">nfsdcltrack
&minus; NFSv4 Client Tracking Callout Program</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">nfsdcltrack
[&minus;d] [&minus;f] [&minus;s stable storage dir]
&lt;command&gt; &lt;args...&gt;</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">nfsdcltack is
the NFSv4 client tracking callout program. It is not
necessary to install this daemon on machines that are not
acting as NFSv4 servers.</p>

<p style="margin-left:11%; margin-top: 1em">When a network
partition is combined with a server reboot, there are edge
conditions that can cause the server to grant lock reclaims
when other clients have taken conflicting locks in the
interim. A more detailed explanation of this issue is
described in <small>RFC</small> 3530, section 8.6.3.</p>

<p style="margin-left:11%; margin-top: 1em">In order to
prevent these problems, the server must track a small amount
of per-client information on stable storage. This program
provides the userspace piece of that functionality. When the
kernel needs to manipulate the database that stores this
info, it will execute this program to handle it.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>&minus;d</b>,
<b>&minus;&minus;debug</b></p>

<p style="margin-left:17%;">Enable debug level logging.</p>

<p style="margin-left:11%;"><b>&minus;f</b>,
<b>&minus;&minus;foreground</b></p>

<p style="margin-left:17%;">Log to stderr instead of
syslog.</p>

<p style="margin-left:11%;"><b>&minus;s</b>
<i>storagedir</i>,
<b>&minus;&minus;storagedir</b>=<i>storage_dir</i></p>

<p style="margin-left:17%;">Directory where stable storage
information should be kept. The default value is
<i>/var/lib/nfs/nfsdcltrack</i>.</p>

<h2>COMMANDS
<a name="COMMANDS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">nfsdcltrack
requires a command for each invocation. Supported commands
are: <b><br>
init</b></p>

<p style="margin-left:17%;">Initialize the database. This
command requires no argument.</p>

<p style="margin-left:11%;"><b>create</b></p>

<p style="margin-left:17%;">Create a new client record (or
update the timestamp on an existing one). This command
requires a hex-encoded nfs_client_id4 as an argument.</p>

<p style="margin-left:11%;"><b>remove</b></p>

<p style="margin-left:17%;">Remove a client record from the
database. This command requires a hex-encoded nfs_client_id4
as an argument.</p>

<p style="margin-left:11%;"><b>check</b></p>

<p style="margin-left:17%;">Check to see if a
nfs_client_id4 is allowed to reclaim. This command requires
a hex-encoded nfs_client_id4 as an argument.</p>

<p style="margin-left:11%;"><b>gracedone</b></p>

<p style="margin-left:17%;">Remove any unreclaimed client
records from the database. This command requires a epoch
boot time as an argument.</p>

<h2>LEGACY TRANSITION MECHANISM
<a name="LEGACY TRANSITION MECHANISM"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The Linux
kernel NFSv4 server has historically tracked this
information on stable storage by manipulating information on
the filesystem directly, in the directory to which
<i>/proc/fs/nfsd/nfsv4recoverydir</i> points. If the kernel
passes the correct information, then nfsdcltrack can use it
to allow a seamless transition from the old client tracking
scheme to the new one.</p>

<p style="margin-left:11%; margin-top: 1em">On a
<b>check</b> operation, if there is no record of the client
in the database, nfsdcltrack will look to see if the
<b><small>NFSDCLTRACK_LEGACY_RECDIR</small></b> environment
variable is set. If it is, then it will fetch that value and
see if a directory exists by that name. If it does, then the
check operation will succeed and the directory will be
removed.</p>

<p style="margin-left:11%; margin-top: 1em">On a
<b>gracedone</b> operation, nfsdcltrack will look to see if
the <b><small>NFSDCLTRACK_LEGACY_TOPDIR</small></b>
environment variable is set. If it is, then it will attempt
to clean out that directory prior to exiting.</p>

<p style="margin-left:11%; margin-top: 1em">Note that this
transition is one-way. If the machine subsequently reboots
back into an older kernel that does not support the
nfsdcltrack upcall then the clients will not be able to
recover their state.</p>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This program
requires a kernel that supports the nfsdcltrack
usermodehelper upcall. This support was first added to
mainline kernels in 3.8.</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">nfsdcltrack was
developed by Jeff Layton &lt;jlayton@redhat.com&gt;.</p>
<hr>
</body>
</html>
