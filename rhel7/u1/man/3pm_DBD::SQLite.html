<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Sat Nov 12 00:34:29 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>DBD::SQLite</title>

</head>
<body>

<h1 align="center">DBD::SQLite</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#NOTABLE DIFFERENCES FROM OTHER DRIVERS">NOTABLE DIFFERENCES FROM OTHER DRIVERS</a><br>
<a href="#DRIVER PRIVATE ATTRIBUTES">DRIVER PRIVATE ATTRIBUTES</a><br>
<a href="#METHODS">METHODS</a><br>
<a href="#DRIVER PRIVATE METHODS">DRIVER PRIVATE METHODS</a><br>
<a href="#DRIVER CONSTANTS">DRIVER CONSTANTS</a><br>
<a href="#COLLATION FUNCTIONS">COLLATION FUNCTIONS</a><br>
<a href="#FULLTEXT SEARCH">FULLTEXT SEARCH</a><br>
<a href="#R* TREE SUPPORT">R* TREE SUPPORT</a><br>
<a href="#FOR DBD::SQLITE EXTENSION AUTHORS">FOR DBD::SQLITE EXTENSION AUTHORS</a><br>
<a href="#TO DO">TO DO</a><br>
<a href="#SUPPORT">SUPPORT</a><br>
<a href="#AUTHORS">AUTHORS</a><br>
<a href="#COPYRIGHT">COPYRIGHT</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">DBD::SQLite
&minus; Self&minus;contained RDBMS in a DBI Driver</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<pre style="margin-left:11%; margin-top: 1em">  use DBI;
  my $dbh = DBI&minus;&gt;connect(&quot;dbi:SQLite:dbname=$dbfile&quot;,&quot;&quot;,&quot;&quot;);</pre>


<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">SQLite is a
public domain file-based relational database engine that you
can find at &lt;http://www.sqlite.org/&gt;.</p>


<p style="margin-left:11%; margin-top: 1em"><b>DBD::SQLite</b>
is a Perl <small>DBI</small> driver for SQLite, that
includes the entire thing in the distribution. So in order
to get a fast transaction capable <small>RDBMS</small>
working for your perl project you simply have to install
this module, and <b>nothing</b> else.</p>

<p style="margin-left:11%; margin-top: 1em">SQLite supports
the following features: <br>
Implements a large subset of <small>SQL92</small></p>

<p style="margin-left:17%;">See
&lt;http://www.sqlite.org/lang.html&gt; for details.</p>

<p style="margin-left:11%;">A complete <small>DB</small> in
a single disk file</p>

<p style="margin-left:17%;">Everything for your database is
stored in a single disk file, making it easier to move
things around than with <small>DBD::CSV</small> .</p>

<p style="margin-left:11%;">Atomic commit and rollback</p>

<p style="margin-left:17%;">Yes, <b>DBD::SQLite</b> is
small and light, but it supports full transactions!</p>

<p style="margin-left:11%;">Extensible</p>

<p style="margin-left:17%;">User-defined aggregate or
regular functions can be registered with the
<small>SQL</small> parser.</p>

<p style="margin-left:11%; margin-top: 1em">There&rsquo;s
lots more to it, so please refer to the docs on the SQLite
web page, listed above, for <small>SQL</small> details. Also
refer to <small>DBI</small> for details on how to use
<small>DBI</small> itself. The <small>API</small> works like
every <small>DBI</small> module does. However, currently
many statement attributes are not implemented or are limited
by the typeless nature of the SQLite database.</p>

<h2>NOTABLE DIFFERENCES FROM OTHER DRIVERS
<a name="NOTABLE DIFFERENCES FROM OTHER DRIVERS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Database
Name Is A File Name</b> <br>
SQLite creates a file per a database. You should pass the
<tt>&quot;path&quot;</tt> of the database file (with or
without a parent directory) in the <small>DBI</small>
connection string (as a database
<tt>&quot;name&quot;</tt>):</p>

<pre style="margin-left:11%; margin-top: 1em">  my $dbh = DBI&minus;&gt;connect(&quot;dbi:SQLite:dbname=$dbfile&quot;,&quot;&quot;,&quot;&quot;);</pre>


<p style="margin-left:11%; margin-top: 1em">The file is
opened in read/write mode, and will be created if it does
not exist yet.</p>

<p style="margin-left:11%; margin-top: 1em">Although the
database is stored in a single file, the directory
containing the database file must be writable by SQLite
because the library will create several temporary files
there.</p>

<p style="margin-left:11%; margin-top: 1em">If the filename
<tt>$dbfile</tt> is &quot;:memory:&quot;, then a private,
temporary in-memory database is created for the connection.
This in-memory database will vanish when the database
connection is closed. It is handy for your library
tests.</p>

<p style="margin-left:11%; margin-top: 1em">Note that
future versions of SQLite might make use of additional
special filenames that begin with the &quot;:&quot;
character. It is recommended that when a database filename
actually does begin with a &quot;:&quot; character you
should prefix the filename with a pathname such as
&quot;./&quot; to avoid ambiguity.</p>

<p style="margin-left:11%; margin-top: 1em">If the filename
<tt>$dbfile</tt> is an empty string, then a private,
temporary on-disk database will be created. This private
database will be automatically deleted as soon as the
database connection is closed.</p>

<p style="margin-left:11%; margin-top: 1em"><b>DBD::SQLite
And File::Temp</b> <br>
When you use File::Temp to create a temporary file/directory
for SQLite databases, you need to remember: <br>
tempfile may be locked exclusively</p>

<p style="margin-left:17%;">You may want to use
<tt>&quot;tempfile()&quot;</tt> to create a temporary
database filename for DBD::SQLite, but as noted in
File::Temp&rsquo;s <small>POD,</small> this file may have an
exclusive lock under some operating systems (notably Mac
<small>OSX</small> ), and result in a &quot;database is
locked&quot; error. To avoid this, set <small>EXLOCK</small>
option to false when you call <i>tempfile()</i>.</p>

<pre style="margin-left:17%; margin-top: 1em">  ($fh, $filename) = tempfile($template, EXLOCK =&gt; 0);</pre>


<p style="margin-left:11%;"><small>CLEANUP</small> may not
work unless a database is disconnected</p>

<p style="margin-left:17%;">When you set
<small>CLEANUP</small> option to true when you create a
temporary directory with <tt>&quot;tempdir()&quot;</tt> or
<tt>&quot;newdir()&quot;</tt>, you may have to disconnect
databases explicitly before the temporary directory is gone
(notably under <small>MS</small> Windows).</p>

<p style="margin-left:11%; margin-top: 1em">(The above is
quoted from the pod of File::Temp.)</p>

<p style="margin-left:11%; margin-top: 1em">If you
don&rsquo;t need to keep or share a temporary database, use
&quot;:memory:&quot; database instead. It&rsquo;s much
handier and cleaner for ordinary testing.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Accessing A
Database With Other Tools</b> <br>
To access the database from the command line, try using
<tt>&quot;dbish&quot;</tt> which comes with the DBI::Shell
module. Just type:</p>

<pre style="margin-left:11%; margin-top: 1em">  dbish dbi:SQLite:foo.db</pre>


<p style="margin-left:11%; margin-top: 1em">On the command
line to access the file <i>foo.db</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Alternatively
you can install SQLite from the link above without
conflicting with <b>DBD::SQLite</b> and use the supplied
<tt>&quot;sqlite3&quot;</tt> command line tool.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Blobs</b>
<br>
As of version 1.11, blobs should &quot;just work&quot; in
SQLite as text columns. However this will cause the data to
be treated as a string, so <small>SQL</small> statements
such as length(x) will return the length of the column as a
<small>NUL</small> terminated string, rather than the size
of the blob in bytes. In order to store natively as a
<small>BLOB</small> use the following code:</p>

<pre style="margin-left:11%; margin-top: 1em">  use DBI qw(:sql_types);
  my $dbh = DBI&minus;&gt;connect(&quot;dbi:SQLite:dbfile&quot;,&quot;&quot;,&quot;&quot;);
  my $blob = `cat foo.jpg`;
  my $sth = $dbh&minus;&gt;prepare(&quot;INSERT INTO mytable VALUES (1, ?)&quot;);
  $sth&minus;&gt;bind_param(1, $blob, SQL_BLOB);
  $sth&minus;&gt;execute();</pre>


<p style="margin-left:11%; margin-top: 1em">And then
retrieval just works:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;prepare(&quot;SELECT * FROM mytable WHERE id = 1&quot;);
  $sth&minus;&gt;execute();
  my $row = $sth&minus;&gt;fetch;
  my $blobo = $row&minus;&gt;[1];
  # now $blobo == $blob</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Functions
And Bind Parameters</b> <br>
As of this writing, a <small>SQL</small> that compares a
return value of a function with a numeric bind value like
this doesn&rsquo;t work as you might expect.</p>

<pre style="margin-left:11%; margin-top: 1em">  my $sth = $dbh&minus;&gt;prepare(q{
    SELECT bar FROM foo GROUP BY bar HAVING count(*) &gt; ?;
  });
  $sth&minus;&gt;execute(5);</pre>


<p style="margin-left:11%; margin-top: 1em">This is because
DBD::SQLite assumes that all the bind values are text (and
should be quoted) by default. Thus the above statement
becomes like this while executing:</p>

<pre style="margin-left:11%; margin-top: 1em">  SELECT bar FROM foo GROUP BY bar HAVING count(*) &gt; &quot;5&quot;;</pre>


<p style="margin-left:11%; margin-top: 1em">There are three
workarounds for this. <br>
Use <i>bind_param()</i> explicitly</p>

<p style="margin-left:17%;">As shown above in the
<tt>&quot;BLOB&quot;</tt> section, you can always use
<tt>&quot;bind_param()&quot;</tt> to tell the type of a bind
value.</p>

<pre style="margin-left:17%; margin-top: 1em">  use DBI qw(:sql_types);  # Don't forget this
  my $sth = $dbh&minus;&gt;prepare(q{
    SELECT bar FROM foo GROUP BY bar HAVING count(*) &gt; ?;
  });
  $sth&minus;&gt;bind_param(1, 5, SQL_INTEGER);
  $sth&minus;&gt;execute();</pre>


<p style="margin-left:11%;">Add zero to make it a
number</p>

<p style="margin-left:17%;">This is somewhat weird, but
works anyway.</p>

<pre style="margin-left:17%; margin-top: 1em">  my $sth = $dbh&minus;&gt;prepare(q{
    SELECT bar FROM foo GROUP BY bar HAVING count(*) &gt; (? + 0);
  });
  $sth&minus;&gt;execute(5);</pre>


<p style="margin-left:11%;">Set
&quot;sqlite_see_if_its_a_number&quot; database handle
attribute</p>

<p style="margin-left:17%;">As of version 1.32_02, you can
use <tt>&quot;sqlite_see_if_its_a_number&quot;</tt> to let
DBD::SQLite to see if the bind values are numbers or
not.</p>

<pre style="margin-left:17%; margin-top: 1em">  $dbh&minus;&gt;{sqlite_see_if_its_a_number} = 1;
  my $sth = $dbh&minus;&gt;prepare(q{
    SELECT bar FROM foo GROUP BY bar HAVING count(*) &gt; ?;
  });
  $sth&minus;&gt;execute(5);</pre>


<p style="margin-left:17%; margin-top: 1em">You can set it
to true when you connect to a database.</p>

<pre style="margin-left:17%; margin-top: 1em">  my $dbh = DBI&minus;&gt;connect('dbi:SQLite:foo', undef, undef, {
    AutoCommit =&gt; 1,
    RaiseError =&gt; 1,
    sqlite_see_if_its_a_number =&gt; 1,
  });</pre>


<p style="margin-left:17%; margin-top: 1em">This is the
most straightforward solution, but as noted above, existing
data in your databases created by DBD::SQLite have not
always been stored as numbers, so this *might* cause other
obscure problems. Use this sparingly when you handle
existing databases. If you handle databases created by other
tools like native <tt>&quot;sqlite3&quot;</tt> command line
tool, this attribute would help you.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Placeholders</b>
<br>
SQLite supports several placeholder expressions, including
<tt>&quot;?&quot;</tt> and <tt>&quot;:AAAA&quot;</tt>.
Consult the <small>DBI</small> and sqlite documentation for
details.</p>


<p style="margin-left:11%; margin-top: 1em">&lt;http://www.sqlite.org/lang_expr.html#varparam&gt;</p>

<p style="margin-left:11%; margin-top: 1em">Note that a
question mark actually means a next unused (numbered)
placeholder. You&rsquo;re advised not to use it with other
(numbered or named) placeholders to avoid confusion.</p>

<pre style="margin-left:11%; margin-top: 1em">  my $sth = $dbh&minus;&gt;prepare(
    'update TABLE set a=?1 where b=?2 and a IS NOT ?1'
  );
  $sth&minus;&gt;execute(1, 2);</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Foreign Keys
<small><br>
BE PREPARED</small> ! <small>WOLVES APPROACH</small>
!!</b></p>

<p style="margin-left:11%; margin-top: 1em">SQLite has
started supporting foreign key constraints since 3.6.19
(released on Oct 14, 2009; bundled in DBD::SQLite 1.26_05).
To be exact, SQLite has long been able to parse a schema
with foreign keys, but the constraints has not been
enforced. Now you can issue a pragma actually to enable this
feature and enforce the constraints.</p>

<p style="margin-left:11%; margin-top: 1em">To do this,
issue the following pragma (see below), preferably as soon
as you connect to a database and you&rsquo;re not in a
transaction:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;do(&quot;PRAGMA foreign_keys = ON&quot;);</pre>


<p style="margin-left:11%; margin-top: 1em">And you can
explicitly disable the feature whenever you like by turning
the pragma off:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;do(&quot;PRAGMA foreign_keys = OFF&quot;);</pre>


<p style="margin-left:11%; margin-top: 1em">As of this
writing, this feature is disabled by default by the sqlite
team, and by us, to secure backward compatibility, as this
feature may break your applications, and actually broke some
for us. If you have used a schema with foreign key
constraints but haven&rsquo;t cared them much and supposed
they&rsquo;re always ignored for SQLite, be prepared, and
<b>please do extensive testing to ensure that your
applications will continue to work when the foreign keys
support is enabled by default</b>. It is very likely that
the sqlite team will turn it default-on in the future, and
we plan to do it <small>NO LATER THAN</small> they do
so.</p>

<p style="margin-left:11%; margin-top: 1em">See
&lt;http://www.sqlite.org/foreignkeys.html&gt; for
details.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Pragma</b>
<br>
SQLite has a set of &quot;Pragma&quot;s to modify its
operation or to query for its internal data. These are
specific to SQLite and are not likely to work with other
<small>DBD</small> libraries, but you may find some of these
are quite useful, including: <br>
journal_mode</p>

<p style="margin-left:17%;">You can use this pragma to
change the journal mode for SQLite databases, maybe for
better performance, or for compatibility.</p>

<p style="margin-left:17%; margin-top: 1em">Its default
mode is <tt>&quot;DELETE&quot;</tt>, which means SQLite uses
a rollback journal to implement transactions, and the
journal is deleted at the conclusion of each transaction. If
you use <tt>&quot;TRUNCATE&quot;</tt> instead of
<tt>&quot;DELETE&quot;</tt>, the journal will be truncated,
which is usually much faster.</p>

<p style="margin-left:17%; margin-top: 1em">A
<tt>&quot;WAL&quot;</tt> (write-ahead log) mode is
introduced as of SQLite 3.7.0. This mode is persistent, and
it stays in effect even after closing and reopening the
database. In other words, once the <tt>&quot;WAL&quot;</tt>
mode is set in an application or in a test script, the
database becomes inaccessible by older clients. This tends
to be an issue when you use a system
<tt>&quot;sqlite3&quot;</tt> executable under a conservative
operating system.</p>

<p style="margin-left:17%; margin-top: 1em">To fix this,
You need to issue <tt>&quot;PRAGMA journal_mode =
DELETE&quot;</tt> (or <tt>&quot;TRUNCATE&quot;</tt>)
beforehand, or install a newer version of
<tt>&quot;sqlite3&quot;</tt>.</p>

<p style="margin-left:11%;">legacy_file_format</p>

<p style="margin-left:17%;">If you happen to need to create
a SQLite database that will also be accessed by a very old
SQLite client (prior to 3.3.0 released in Jan. 2006), you
need to set this pragma to <small>ON</small> before you
create a database.</p>

<p style="margin-left:11%;">reverse_unordered_selects</p>

<p style="margin-left:17%;">You can set this pragma to
<small>ON</small> to reverse the order of results of
<small>SELECT</small> statements without an <small>ORDER
BY</small> clause so that you can see if applications are
making invalid assumptions about the result order.</p>

<p style="margin-left:17%; margin-top: 1em">Note that
SQLite 3.7.15 (bundled with DBD::SQLite 1.38_02) enhanced
its query optimizer and the order of results of a
<small>SELECT</small> statement without an <small>ORDER
BY</small> clause may be different from the one of the
previous versions.</p>

<p style="margin-left:11%;">synchronous</p>

<p style="margin-left:17%;">You can set set this pragma to
<small>OFF</small> to make some of the operations in SQLite
faster with a possible risk of database corruption in the
worst case. See also &quot;Performance&quot; section
below.</p>

<p style="margin-left:11%; margin-top: 1em">See
&lt;http://www.sqlite.org/pragma.html&gt; for more
details.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Transactions</b>
<br>
DBI/DBD::SQLite&rsquo;s transactions may be a bit confusing.
They behave differently according to the status of the
<tt>&quot;AutoCommit&quot;</tt> flag: <br>
When the AutoCommit flag is on</p>

<p style="margin-left:17%;">You&rsquo;re supposed to always
use the auto-commit mode, except you explicitly begin a
transaction, and when the transaction ended, you&rsquo;re
supposed to go back to the auto-commit mode. To begin a
transaction, call <tt>&quot;begin_work&quot;</tt> method, or
issue a <tt>&quot;BEGIN&quot;</tt> statement. To end it,
call <tt>&quot;commit/rollback&quot;</tt> methods, or issue
the corresponding statements.</p>

<pre style="margin-left:17%; margin-top: 1em">  $dbh&minus;&gt;{AutoCommit} = 1;
  $dbh&minus;&gt;begin_work; # or $dbh&minus;&gt;do('BEGIN TRANSACTION');
  # $dbh&minus;&gt;{AutoCommit} is turned off temporarily during a transaction;
  $dbh&minus;&gt;commit; # or $dbh&minus;&gt;do('COMMIT');
  # $dbh&minus;&gt;{AutoCommit} is turned on again;</pre>


<p style="margin-left:11%;">When the AutoCommit flag is
off</p>

<p style="margin-left:17%;">You&rsquo;re supposed to always
use the transactional mode, until you explicitly turn on the
AutoCommit flag. You can explicitly issue a
<tt>&quot;BEGIN&quot;</tt> statement (only when an actual
transaction has not begun yet) but you&rsquo;re not allowed
to call <tt>&quot;begin_work&quot;</tt> method (if you
don&rsquo;t issue a <tt>&quot;BEGIN&quot;</tt>, it will be
issued internally). You can commit or roll it back freely.
Another transaction will automatically begins if you execute
another statement.</p>

<pre style="margin-left:17%; margin-top: 1em">  $dbh&minus;&gt;{AutoCommit} = 0;
  # $dbh&minus;&gt;do('BEGIN TRANSACTION') is not necessary, but possible
  ...
  $dbh&minus;&gt;commit; # or $dbh&minus;&gt;do('COMMIT');
  # $dbh&minus;&gt;{AutoCommit} stays intact;
  $dbh&minus;&gt;{AutoCommit} = 1;  # ends the transactional mode</pre>


<p style="margin-left:11%; margin-top: 1em">This
<tt>&quot;AutoCommit&quot;</tt> mode is independent from the
autocommit mode of the internal SQLite library, which always
begins by a <tt>&quot;BEGIN&quot;</tt> statement, and ends
by a <tt>&quot;COMMIT&quot;</tt> or a &lt;
<small>ROLLBACK</small> &gt;.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Transaction
and Database Locking</b> <br>
The default transaction behavior of SQLite is
<tt>&quot;deferred&quot;</tt>, that means, locks are not
acquired until the first read or write operation, and thus
it is possible that another thread or process could create a
separate transaction and write to the database after the
<tt>&quot;BEGIN&quot;</tt> on the current thread has
executed, and eventually cause a &quot;deadlock&quot;. To
avoid this, DBD::SQLite internally issues a <tt>&quot;BEGIN
IMMEDIATE&quot;</tt> when you begin a transaction by
<tt>&quot;begin_work&quot;</tt> or under the
<tt>&quot;AutoCommit&quot;</tt> mode (since 1.38_01).</p>

<p style="margin-left:11%; margin-top: 1em">If you really
need to turn off this feature for some reasons, set
<tt>&quot;sqlite_use_immediate_transaction&quot;</tt>
database handle attribute to false, and the default
<tt>&quot;deferred&quot;</tt> transaction will be used.</p>

<pre style="margin-left:11%; margin-top: 1em">  my $dbh = DBI&minus;&gt;connect(&quot;dbi:SQLite::memory:&quot;, &quot;&quot;, &quot;&quot;, {
    sqlite_use_immediate_transaction =&gt; 0,
  });</pre>


<p style="margin-left:11%; margin-top: 1em">See
&lt;http://sqlite.org/lockingv3.html&gt; for locking
details.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&quot;$sth&minus;&gt;finish&quot;
and Transaction Rollback</b> <br>
As the <small>DBI</small> doc says, you almost certainly do
<b>not</b> need to call &quot;finish&quot; in
<small>DBI</small> method if you fetch all rows (probably in
a loop). However, there are several exceptions to this rule,
and rolling-back of an unfinished
<tt>&quot;SELECT&quot;</tt> statement is one of such
exceptional cases.</p>

<p style="margin-left:11%; margin-top: 1em">SQLite
prohibits <tt>&quot;ROLLBACK&quot;</tt> of unfinished
<tt>&quot;SELECT&quot;</tt> statements in a transaction (See
&lt;http://sqlite.org/lang_transaction.html&gt; for
details). So you need to call <tt>&quot;finish&quot;</tt>
before you issue a rollback.</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;prepare(&quot;SELECT * FROM t&quot;);
  $dbh&minus;&gt;begin_work;
  eval {
      $sth&minus;&gt;execute;
      $row = $sth&minus;&gt;fetch;
      ...
      die &quot;For some reason&quot;;
      ...
  };
  if($@) {
     $sth&minus;&gt;finish;  # You need this for SQLite
     $dbh&minus;&gt;rollback;
  } else {
     $dbh&minus;&gt;commit;
  }</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Processing
Multiple Statements At A Time</b> <small><br>
DBI</small> &rsquo;s statement handle is not supposed to
process multiple statements at a time. So if you pass a
string that contains multiple statements (a
<tt>&quot;dump&quot;</tt>) to a statement handle (via
<tt>&quot;prepare&quot;</tt> or <tt>&quot;do&quot;</tt>),
DBD::SQLite only processes the first statement, and discards
the rest.</p>

<p style="margin-left:11%; margin-top: 1em">Since 1.30_01,
you can retrieve those ignored (unprepared) statements via
<tt>&quot;$sth&minus;&gt;{sqlite_unprepared_statements}&quot;</tt>.
It usually contains nothing but white spaces, but if you
really care, you can check this attribute to see if
there&rsquo;s anything left undone. Also, if you set a
<tt>&quot;sqlite_allow_multiple_statements&quot;</tt>
attribute of a database handle to true when you connect to a
database, <tt>&quot;do&quot;</tt> method automatically
checks the <tt>&quot;sqlite_unprepared_statements&quot;</tt>
attribute, and if it finds anything undone (even if
what&rsquo;s left is just a single white space), it repeats
the process again, to the end.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Performance</b>
<br>
SQLite is fast, very fast. Matt processed his 72MB log file
with it, inserting the data (400,000+ rows) by using
transactions and only committing every 1000 rows (otherwise
the insertion is quite slow), and then performing queries on
the data.</p>

<p style="margin-left:11%; margin-top: 1em">Queries like
count(*) and avg(bytes) took fractions of a second to
return, but what surprised him most of all was:</p>

<pre style="margin-left:11%; margin-top: 1em">  SELECT url, count(*) as count
  FROM access_log
  GROUP BY url
  ORDER BY count desc
  LIMIT 20</pre>


<p style="margin-left:11%; margin-top: 1em">To discover the
top 20 hit URLs on the site (&lt;http://axkit.org&gt;), and
it returned within 2 seconds. He was seriously considering
switching his log analysis code to use this little speed
demon!</p>

<p style="margin-left:11%; margin-top: 1em">Oh yeah, and
that was with no indexes on the table, on a 400MHz
<small>PIII.</small></p>

<p style="margin-left:11%; margin-top: 1em">For best
performance be sure to tune your hdparm settings if you are
using linux. Also you might want to set:</p>

<pre style="margin-left:11%; margin-top: 1em">  PRAGMA synchronous = OFF</pre>


<p style="margin-left:11%; margin-top: 1em">Which will
prevent sqlite from doing fsync&rsquo;s when writing (which
slows down non-transactional writes significantly) at the
expense of some peace of mind. Also try playing with the
cache_size pragma.</p>

<p style="margin-left:11%; margin-top: 1em">The memory
usage of SQLite can also be tuned using the cache_size
pragma.</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;do(&quot;PRAGMA cache_size = 800000&quot;);</pre>


<p style="margin-left:11%; margin-top: 1em">The above will
allocate 800M for <small>DB</small> cache; the default is
2M. Your sweet spot probably lies somewhere in between.</p>

<h2>DRIVER PRIVATE ATTRIBUTES
<a name="DRIVER PRIVATE ATTRIBUTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Database
Handle Attributes</b> <br>
sqlite_version</p>

<p style="margin-left:17%;">Returns the version of the
SQLite library which <b>DBD::SQLite</b> is using, e.g.,
&quot;2.8.0&quot;. Can only be read.</p>

<p style="margin-left:11%;">sqlite_unicode</p>

<p style="margin-left:17%;">If set to a true value,
<b>DBD::SQLite</b> will turn the <small>UTF&minus;8</small>
flag on for all text strings coming out of the database
(this feature is currently disabled for perl &lt; 5.8.5).
For more details on the <small>UTF&minus;8</small> flag see
perlunicode. The default is for the
<small>UTF&minus;8</small> flag to be turned off.</p>

<p style="margin-left:17%; margin-top: 1em">Also note that
due to some bizarreness in SQLite&rsquo;s type system (see
&lt;http://www.sqlite.org/datatype3.html&gt;), if you want
to retain blob-style behavior for <b>some</b> columns under
<tt>&quot;$dbh&minus;&gt;{sqlite_unicode} = 1&quot;</tt>
(say, to store images in the database), you have to state so
explicitly using the 3&minus;argument form of
&quot;bind_param&quot; in <small>DBI</small> when doing
updates:</p>

<pre style="margin-left:17%; margin-top: 1em">  use DBI qw(:sql_types);
  $dbh&minus;&gt;{sqlite_unicode} = 1;
  my $sth = $dbh&minus;&gt;prepare(&quot;INSERT INTO mytable (blobcolumn) VALUES (?)&quot;);
  # Binary_data will be stored as is.
  $sth&minus;&gt;bind_param(1, $binary_data, SQL_BLOB);</pre>


<p style="margin-left:17%; margin-top: 1em">Defining the
column type as <tt>&quot;BLOB&quot;</tt> in the
<small>DDL</small> is <b>not</b> sufficient.</p>

<p style="margin-left:17%; margin-top: 1em">This attribute
was originally named as <tt>&quot;unicode&quot;</tt>, and
renamed to <tt>&quot;sqlite_unicode&quot;</tt> for integrity
since version 1.26_06. Old <tt>&quot;unicode&quot;</tt>
attribute is still accessible but will be deprecated in the
near future.</p>


<p style="margin-left:11%;">sqlite_allow_multiple_statements</p>

<p style="margin-left:17%;">If you set this to true,
<tt>&quot;do&quot;</tt> method will process multiple
statements at one go. This may be handy, but with
performance penalty. See above for details.</p>


<p style="margin-left:11%;">sqlite_use_immediate_transaction</p>

<p style="margin-left:17%;">If you set this to true,
DBD::SQLite tries to issue a <tt>&quot;begin immediate
transaction&quot;</tt> (instead of <tt>&quot;begin
transaction&quot;</tt>) when necessary. See above for
details.</p>

<p style="margin-left:17%; margin-top: 1em">As of version
1.38_01, this attribute is set to true by default. If you
really need to use <tt>&quot;deferred&quot;</tt>
transactions for some reasons, set this to false
explicitly.</p>

<p style="margin-left:11%;">sqlite_see_if_its_a_number</p>

<p style="margin-left:17%;">If you set this to true,
DBD::SQLite tries to see if the bind values are number or
not, and does not quote if they are numbers. See above for
details.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Statement
Handle Attributes</b> <br>
sqlite_unprepared_statements</p>

<p style="margin-left:17%;">Returns an unprepared part of
the statement you pass to <tt>&quot;prepare&quot;</tt>.
Typically this contains nothing but white spaces after a
semicolon. See above for details.</p>

<h2>METHODS
<a name="METHODS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">See also to the
<small>DBI</small> documentation for the details of other
common methods.</p>


<p style="margin-left:11%; margin-top: 1em"><b>table_info</b></p>


<pre style="margin-left:11%;">  $sth = $dbh&minus;&gt;table_info(undef, $schema, $table, $type, \%attr);</pre>


<p style="margin-left:11%; margin-top: 1em">Returns all
tables and schemas (databases) as specified in
&quot;table_info&quot; in <small>DBI</small> . The schema
and table arguments will do a <tt>&quot;LIKE&quot;</tt>
search. You can specify an <small>ESCAPE</small> character
by including an &rsquo;Escape&rsquo; attribute in \%attr.
The <tt>$type</tt> argument accepts a comma separated list
of the following types &rsquo; <small>TABLE</small> &rsquo;,
&rsquo; <small>VIEW</small> &rsquo;, &rsquo; <small>LOCAL
TEMPORARY</small> &rsquo; and &rsquo; <small>SYSTEM
TABLE</small> &rsquo; (by default all are returned). Note
that a statement handle is returned, and not a direct list
of tables.</p>

<p style="margin-left:11%; margin-top: 1em">The following
fields are returned:</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_CAT</small></b>
: Always <small>NULL,</small> as SQLite does not have the
concept of catalogs.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_SCHEM</small></b>
: The name of the schema (database) that the table or view
is in. The default schema is &rsquo;main&rsquo;, temporary
tables are in &rsquo;temp&rsquo; and other databases will be
in the name given when the database was attached.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_NAME</small></b>
: The name of the table or view.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_TYPE</small></b>
: The type of object returned. Will be one of &rsquo;
<small>TABLE</small> &rsquo;, &rsquo; <small>VIEW</small>
&rsquo;, &rsquo; <small>LOCAL TEMPORARY</small> &rsquo; or
&rsquo; <small>SYSTEM TABLE</small> &rsquo;.</p>


<p style="margin-left:11%; margin-top: 1em"><b>primary_key,
primary_key_info</b></p>

<pre style="margin-left:11%;">  @names = $dbh&minus;&gt;primary_key(undef, $schema, $table);
  $sth   = $dbh&minus;&gt;primary_key_info(undef, $schema, $table, \%attr);</pre>


<p style="margin-left:11%; margin-top: 1em">You can
retrieve primary key names or more detailed information. As
noted above, SQLite does not have the concept of catalogs,
so the first argument of the methods is usually
<tt>&quot;undef&quot;</tt>, and you&rsquo;ll usually set
<tt>&quot;undef&quot;</tt> for the second one (unless you
want to know the primary keys of temporary tables).</p>


<p style="margin-left:11%; margin-top: 1em"><b>foreign_key_info</b></p>


<pre style="margin-left:11%;">  $sth = $dbh&minus;&gt;foreign_key_info(undef, $pk_schema, $pk_table,
                                undef, $fk_schema, $fk_table);</pre>


<p style="margin-left:11%; margin-top: 1em">Returns
information about foreign key constraints, as specified in
&quot;foreign_key_info&quot; in <small>DBI</small> , but
with some limitations :</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>information in rows returned by the <tt>$sth</tt> is
incomplete with respect to the &quot;foreign_key_info&quot;
in <small>DBI</small> specification. All requested fields
are present, but the content is <tt>&quot;undef&quot;</tt>
for some of them.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">The following
nonempty fields are returned :</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>PKTABLE_NAME</small></b>
: The primary (unique) key table identifier.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>PKCOLUMN_NAME</small></b>
: The primary (unique) key column identifier.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>FKTABLE_NAME</small></b>
: The foreign key table identifier.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>FKCOLUMN_NAME</small></b>
: The foreign key column identifier.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>KEY_SEQ</small></b>
: The column sequence number (starting with 1), when several
columns belong to a same constraint.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>UPDATE_RULE</small></b>
: The referential action for the <small>UPDATE</small> rule.
The following codes are defined:</p>

<pre style="margin-left:11%; margin-top: 1em">  CASCADE              0
  RESTRICT             1
  SET NULL             2
  NO ACTION            3
  SET DEFAULT          4</pre>


<p style="margin-left:11%; margin-top: 1em">Default is 3
(&rsquo; <small>NO ACTION</small> &rsquo;).</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DELETE_RULE</small></b>
: The referential action for the <small>DELETE</small> rule.
The codes are the same as for
<small>UPDATE_RULE.</small></p>

<p style="margin-left:11%; margin-top: 1em">Unfortunately,
the <b><small>DEFERRABILITY</small></b> field is always
<tt>&quot;undef&quot;</tt>; as a matter of fact,
deferrability clauses are supported by SQLite, but they
can&rsquo;t be reported because the <tt>&quot;PRAGMA
foreign_key_list&quot;</tt> tells nothing about them.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>UNIQUE_OR_PRIMARY</small></b>
: Whether the column is primary or unique.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Note</b>:
foreign key support in SQLite must be explicitly turned on
through a <tt>&quot;PRAGMA&quot;</tt> command; see
&quot;Foreign keys&quot; earlier in this manual.</p>


<p style="margin-left:11%; margin-top: 1em"><b>ping</b></p>


<pre style="margin-left:11%;">  my $bool = $dbh&minus;&gt;ping;</pre>


<p style="margin-left:11%; margin-top: 1em">returns true if
the database file exists (or the database is in-memory), and
the database connection is active.</p>

<h2>DRIVER PRIVATE METHODS
<a name="DRIVER PRIVATE METHODS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The following
methods can be called via the <i>func()</i> method with a
little tweak, but the use of <i>func()</i> method is now
discouraged by the <small>DBI</small> author for various
reasons (see <small>DBI</small> &rsquo;s document
&lt;http://search.cpan.org/dist/DBI/lib/DBI/DBD.pm#<i>Using_install_method()</i>_to_expose_driver&minus;private_methods&gt;
for details). So, if you&rsquo;re using <small>DBI</small>
&gt;= 1.608, use these <tt>&quot;sqlite_&quot;</tt> methods.
If you need to use an older <small>DBI</small> , you can
call these like this:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;func( ..., &quot;(method name without sqlite_ prefix)&quot; );</pre>


<p style="margin-left:11%; margin-top: 1em">Exception:
<tt>&quot;sqlite_trace&quot;</tt> should always be called as
is, even with <tt>&quot;func()&quot;</tt> method (to avoid
conflict with <small>DBI</small> &rsquo;s <i>trace()</i>
method).</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;func( ..., &quot;sqlite_trace&quot;);</pre>



<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;</b><i>sqlite_last_insert_rowid()</i>
<br>
This method returns the last inserted rowid. If you specify
an <small>INTEGER PRIMARY KEY</small> as the first column in
your table, that is the column that is returned. Otherwise,
it is the hidden <small>ROWID</small> column. See the sqlite
docs for details.</p>

<p style="margin-left:11%; margin-top: 1em">Generally you
should not be using this method. Use the <small>DBI</small>
last_insert_id method instead. The usage of this is:</p>

<pre style="margin-left:11%; margin-top: 1em">  $h&minus;&gt;last_insert_id($catalog, $schema, $table_name, $field_name [, \%attr ])</pre>


<p style="margin-left:11%; margin-top: 1em">Running
<tt>&quot;$h&minus;&gt;last_insert_id(&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;)&quot;</tt>
is the equivalent of running
<tt>&quot;$dbh&minus;&gt;sqlite_last_insert_rowid()&quot;</tt>
directly.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;</b><i>sqlite_db_filename()</i>
<br>
Retrieve the current (main) database filename. If the
database is in-memory or temporary, this returns
<tt>&quot;undef&quot;</tt>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;</b><i>sqlite_busy_timeout()</i>
<br>
Retrieve the current busy timeout.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_busy_timeout(
$ms )</b> <br>
Set the current busy timeout. The timeout is in
milliseconds.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_create_function(
$name, $argc, $code_ref )</b> <br>
This method will register a new function which will be
usable in an <small>SQL</small> query. The method&rsquo;s
parameters are: <br>
$name</p>

<p style="margin-left:17%;">The name of the function. This
is the name of the function as it will be used from
<small>SQL.</small></p>

<p style="margin-left:11%;">$argc</p>

<p style="margin-left:17%;">The number of arguments taken
by the function. If this number is &minus;1, the function
can take any number of arguments.</p>

<p style="margin-left:11%;">$code_ref</p>

<p style="margin-left:17%;">This should be a reference to
the function&rsquo;s implementation.</p>

<p style="margin-left:11%; margin-top: 1em">For example,
here is how to define a <i>now()</i> function which returns
the current number of seconds since the epoch:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;sqlite_create_function( 'now', 0, sub { return time } );</pre>


<p style="margin-left:11%; margin-top: 1em">After this, it
could be use from <small>SQL</small> as:</p>

<pre style="margin-left:11%; margin-top: 1em">  INSERT INTO mytable ( now() );</pre>



<p style="margin-left:11%; margin-top: 1em"><i><small>REGEXP</small>
function</i></p>

<p style="margin-left:11%; margin-top: 1em">SQLite includes
syntactic support for an infix operator &rsquo;
<small>REGEXP</small> &rsquo;, but without any
implementation. The <tt>&quot;DBD::SQLite&quot;</tt> driver
automatically registers an implementation that performs
standard perl regular expression matching, using current
locale. So for example you can search for words starting
with an &rsquo;A&rsquo; with a query like</p>

<pre style="margin-left:11%; margin-top: 1em">  SELECT * from table WHERE column REGEXP '\bA\w+'</pre>


<p style="margin-left:11%; margin-top: 1em">If you want
case-insensitive searching, use perl regex flags, like this
:</p>

<pre style="margin-left:11%; margin-top: 1em">  SELECT * from table WHERE column REGEXP '(?i:\bA\w+)'</pre>


<p style="margin-left:11%; margin-top: 1em">The default
<small>REGEXP</small> implementation can be overridden
through the <tt>&quot;create_function&quot;</tt>
<small>API</small> described above.</p>

<p style="margin-left:11%; margin-top: 1em">Note that
regexp matching will <b>not</b> use SQLite indices, but will
iterate over all rows, so it could be quite costly in terms
of performance.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_create_collation(
$name, $code_ref )</b> <br>
This method manually registers a new function which will be
usable in an <small>SQL</small> query as a
<small>COLLATE</small> option for sorting. Such functions
can also be registered automatically on demand: see section
&quot; <small>COLLATION FUNCTIONS&quot;</small> below.</p>

<p style="margin-left:11%; margin-top: 1em">The
method&rsquo;s parameters are: <br>
$name</p>

<p style="margin-left:17%;">The name of the function
exposed to <small>SQL.</small></p>

<p style="margin-left:11%;">$code_ref</p>

<p style="margin-left:17%;">Reference to the
function&rsquo;s implementation. The driver will check that
this is a proper sorting function.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_collation_needed(
$code_ref )</b> <br>
This method manually registers a callback function that will
be invoked whenever an undefined collation sequence is
required from an <small>SQL</small> statement. The callback
is invoked as</p>

<pre style="margin-left:11%; margin-top: 1em">  $code_ref&minus;&gt;($dbh, $collation_name)</pre>


<p style="margin-left:11%; margin-top: 1em">and should
register the desired collation using
&quot;sqlite_create_collation&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">An initial
callback is already registered by
<tt>&quot;DBD::SQLite&quot;</tt>, so for most common cases
it will be simpler to just add your collation sequences in
the <tt>%DBD::SQLite::COLLATION</tt> hash (see section
&quot; <small>COLLATION FUNCTIONS&quot;</small> below).</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_create_aggregate(
$name, $argc, $pkg )</b> <br>
This method will register a new aggregate function which can
then be used from <small>SQL.</small> The method&rsquo;s
parameters are: <br>
$name</p>

<p style="margin-left:17%;">The name of the aggregate
function, this is the name under which the function will be
available from <small>SQL.</small></p>

<p style="margin-left:11%;">$argc</p>

<p style="margin-left:17%;">This is an integer which tells
the <small>SQL</small> parser how many arguments the
function takes. If that number is &minus;1, the function can
take any number of arguments.</p>

<p style="margin-left:11%;">$pkg</p>

<p style="margin-left:17%;">This is the package which
implements the aggregator interface.</p>

<p style="margin-left:11%; margin-top: 1em">The aggregator
interface consists of defining three methods: <i><br>
new()</i></p>

<p style="margin-left:17%;">This method will be called once
to create an object which should be used to aggregate the
rows in a particular group. The <i>step()</i> and
<i>finalize()</i> methods will be called upon the reference
return by the method.</p>

<p style="margin-left:11%;">step(@_)</p>

<p style="margin-left:17%;">This method will be called once
for each row in the aggregate.</p>

<p style="margin-left:11%;"><i>finalize()</i></p>

<p style="margin-left:17%;">This method will be called once
all rows in the aggregate were processed and it should
return the aggregate function&rsquo;s result. When there is
no rows in the aggregate, <i>finalize()</i> will be called
right after <i>new()</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Here is a
simple aggregate function which returns the variance
(example adapted from pysqlite):</p>

<pre style="margin-left:11%; margin-top: 1em">  package variance;
  sub new { bless [], shift; }
  sub step {
      my ( $self, $value ) = @_;
      push @$self, $value;
  }
  sub finalize {
      my $self = $_[0];
      my $n = @$self;
      # Variance is NULL unless there is more than one row
      return undef unless $n || $n == 1;
      my $mu = 0;
      foreach my $v ( @$self ) {
          $mu += $v;
      }
      $mu /= $n;
      my $sigma = 0;
      foreach my $v ( @$self ) {
          $sigma += ($v &minus; $mu)**2;
      }
      $sigma = $sigma / ($n &minus; 1);
      return $sigma;
  }
  $dbh&minus;&gt;sqlite_create_aggregate( &quot;variance&quot;, 1, 'variance' );</pre>


<p style="margin-left:11%; margin-top: 1em">The aggregate
function can then be used as:</p>

<pre style="margin-left:11%; margin-top: 1em">  SELECT group_name, variance(score)
  FROM results
  GROUP BY group_name;</pre>


<p style="margin-left:11%; margin-top: 1em">For more
examples, see the DBD::SQLite::Cookbook.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_progress_handler(
$n_opcodes, $code_ref )</b> <br>
This method registers a handler to be invoked periodically
during long running calls to SQLite.</p>

<p style="margin-left:11%; margin-top: 1em">An example use
for this interface is to keep a <small>GUI</small> updated
during a large query. The parameters are: <br>
$n_opcodes</p>

<p style="margin-left:17%;">The progress handler is invoked
once for every <tt>$n_opcodes</tt> virtual machine opcodes
in SQLite.</p>

<p style="margin-left:11%;">$code_ref</p>

<p style="margin-left:17%;">Reference to the handler
subroutine. If the progress handler returns non-zero, the
SQLite operation is interrupted. This feature can be used to
implement a &quot;Cancel&quot; button on a
<small>GUI</small> dialog box.</p>

<p style="margin-left:17%; margin-top: 1em">Set this
argument to <tt>&quot;undef&quot;</tt> if you want to
unregister a previous progress handler.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_commit_hook(
$code_ref )</b> <br>
This method registers a callback function to be invoked
whenever a transaction is committed. Any callback set by a
previous call to <tt>&quot;sqlite_commit_hook&quot;</tt> is
overridden. A reference to the previous callback (if any) is
returned. Registering an <tt>&quot;undef&quot;</tt> disables
the callback.</p>

<p style="margin-left:11%; margin-top: 1em">When the commit
hook callback returns zero, the commit operation is allowed
to continue normally. If the callback returns non-zero, then
the commit is converted into a rollback (in that case, any
attempt to <i>explicitly</i> call
<tt>&quot;$dbh&minus;&gt;rollback()&quot;</tt> afterwards
would yield an error).</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_rollback_hook(
$code_ref )</b> <br>
This method registers a callback function to be invoked
whenever a transaction is rolled back. Any callback set by a
previous call to <tt>&quot;sqlite_rollback_hook&quot;</tt>
is overridden. A reference to the previous callback (if any)
is returned. Registering an <tt>&quot;undef&quot;</tt>
disables the callback.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_update_hook(
$code_ref )</b> <br>
This method registers a callback function to be invoked
whenever a row is updated, inserted or deleted. Any callback
set by a previous call to
<tt>&quot;sqlite_update_hook&quot;</tt> is overridden. A
reference to the previous callback (if any) is returned.
Registering an <tt>&quot;undef&quot;</tt> disables the
callback.</p>

<p style="margin-left:11%; margin-top: 1em">The callback
will be called as</p>

<pre style="margin-left:11%; margin-top: 1em">  $code_ref&minus;&gt;($action_code, $database, $table, $rowid)</pre>


<p style="margin-left:11%; margin-top: 1em">where <br>
$action_code</p>

<p style="margin-left:17%;">is an integer equal to either
<tt>&quot;DBD::SQLite::INSERT&quot;</tt>,
<tt>&quot;DBD::SQLite::DELETE&quot;</tt> or
<tt>&quot;DBD::SQLite::UPDATE&quot;</tt> (see &quot;Action
Codes&quot;);</p>

<p style="margin-left:11%;">$database</p>

<p style="margin-left:17%;">is the name of the database
containing the affected row;</p>

<p style="margin-left:11%;">$table</p>

<p style="margin-left:17%;">is the name of the table
containing the affected row;</p>

<p style="margin-left:11%;">$rowid</p>

<p style="margin-left:17%;">is the unique 64&minus;bit
signed integer key of the affected row within that
table.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_set_authorizer(
$code_ref )</b> <br>
This method registers an authorizer callback to be invoked
whenever <small>SQL</small> statements are being compiled by
the &quot;prepare&quot; in <small>DBI</small> method. The
authorizer callback should return
<tt>&quot;DBD::SQLite::OK&quot;</tt> to allow the action,
<tt>&quot;DBD::SQLite::IGNORE&quot;</tt> to disallow the
specific action but allow the <small>SQL</small> statement
to continue to be compiled, or
<tt>&quot;DBD::SQLite::DENY&quot;</tt> to cause the entire
<small>SQL</small> statement to be rejected with an error.
If the authorizer callback returns any other value, then
<tt>&quot;prepare&quot;</tt> call that triggered the
authorizer will fail with an error message.</p>

<p style="margin-left:11%; margin-top: 1em">An authorizer
is used when preparing <small>SQL</small> statements from an
untrusted source, to ensure that the <small>SQL</small>
statements do not try to access data they are not allowed to
see, or that they do not try to execute malicious statements
that damage the database. For example, an application may
allow a user to enter arbitrary <small>SQL</small> queries
for evaluation by a database. But the application does not
want the user to be able to make arbitrary changes to the
database. An authorizer could then be put in place while the
user-entered <small>SQL</small> is being prepared that
disallows everything except <small>SELECT</small>
statements.</p>

<p style="margin-left:11%; margin-top: 1em">The callback
will be called as</p>

<pre style="margin-left:11%; margin-top: 1em">  $code_ref&minus;&gt;($action_code, $string1, $string2, $database, $trigger_or_view)</pre>


<p style="margin-left:11%; margin-top: 1em">where <br>
$action_code</p>

<p style="margin-left:17%;">is an integer that specifies
what action is being authorized (see &quot;Action
Codes&quot;).</p>

<p style="margin-left:11%;">$string1, $string2</p>

<p style="margin-left:17%;">are strings that depend on the
action code (see &quot;Action Codes&quot;).</p>

<p style="margin-left:11%;">$database</p>

<p style="margin-left:17%;">is the name of the database
(<tt>&quot;main&quot;</tt>, <tt>&quot;temp&quot;</tt>, etc.)
if applicable.</p>

<p style="margin-left:11%;">$trigger_or_view</p>

<p style="margin-left:17%;">is the name of the inner-most
trigger or view that is responsible for the access attempt,
or <tt>&quot;undef&quot;</tt> if this access attempt is
directly from top-level <small>SQL</small> code.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_backup_from_file(
$filename )</b> <br>
This method accesses the SQLite Online Backup
<small>API,</small> and will take a backup of the named
database file, copying it to, and overwriting, your current
database connection. This can be particularly handy if your
current connection is to the special :memory: database, and
you wish to populate it from an existing
<small>DB.</small></p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_backup_to_file(
$filename )</b> <br>
This method accesses the SQLite Online Backup
<small>API,</small> and will take a backup of the currently
connected database, and write it out to the named file.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_enable_load_extension(
$bool )</b> <br>
Calling this method with a true value enables loading
(external) sqlite3 extensions. After the call, you can load
extensions like this:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;sqlite_enable_load_extension(1);
  $sth = $dbh&minus;&gt;prepare(&quot;select load_extension('libsqlitefunctions.so')&quot;)
  or die &quot;Cannot prepare: &quot; . $dbh&minus;&gt;errstr();</pre>



<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_load_extension(
$file, $proc )</b> <br>
Loading an extension by a select statement (with the
&quot;load_extension&quot; sqlite3 function like above) has
some limitations. If you need to, say, create other
functions from an extension, use this method. <tt>$file</tt>
(a path to the extension) is mandatory, and <tt>$proc</tt>
(an entry point name) is optional. You need to call
<tt>&quot;sqlite_enable_load_extension&quot;</tt> before
calling <tt>&quot;sqlite_load_extension&quot;</tt>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_trace(
$code_ref )</b> <br>
This method registers a trace callback to be invoked
whenever <small>SQL</small> statements are being run.</p>

<p style="margin-left:11%; margin-top: 1em">The callback
will be called as</p>

<pre style="margin-left:11%; margin-top: 1em">  $code_ref&minus;&gt;($statement)</pre>


<p style="margin-left:11%; margin-top: 1em">where <br>
$statement</p>

<p style="margin-left:17%;">is a <small>UTF&minus;8</small>
rendering of the <small>SQL</small> statement text as the
statement first begins executing.</p>

<p style="margin-left:11%; margin-top: 1em">Additional
callbacks might occur as each triggered subprogram is
entered. The callbacks for triggers contain a
<small>UTF&minus;8 SQL</small> comment that identifies the
trigger.</p>

<p style="margin-left:11%; margin-top: 1em">See also &quot;
<small>TRACING&quot;</small> in <small>DBI</small> for
better tracing options.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_profile(
$code_ref )</b> <br>
This method registers a profile callback to be invoked
whenever a <small>SQL</small> statement finishes.</p>

<p style="margin-left:11%; margin-top: 1em">The callback
will be called as</p>

<pre style="margin-left:11%; margin-top: 1em">  $code_ref&minus;&gt;($statement, $elapsed_time)</pre>


<p style="margin-left:11%; margin-top: 1em">where <br>
$statement</p>

<p style="margin-left:17%;">is the original statement text
(without bind parameters).</p>

<p style="margin-left:11%;">$elapsed_time</p>

<p style="margin-left:17%;">is an estimate of wall-clock
time of how long that statement took to run (in
milliseconds).</p>

<p style="margin-left:11%; margin-top: 1em">This method is
considered experimental and is subject to change in future
versions of SQLite.</p>

<p style="margin-left:11%; margin-top: 1em">See also
DBI::Profile for better profiling options.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;sqlite_table_column_metadata(
$dbname, $tablename, $columnname )</b> <br>
is for internal use only.</p>


<p style="margin-left:11%; margin-top: 1em"><i>DBD::SQLite::compile_options()</i>
<br>
Returns an array of compile options (available since sqlite
3.6.23, bundled in DBD::SQLite 1.30_01), or an empty array
if the bundled library is old or compiled with
<small>SQLITE_OMIT_COMPILEOPTION_DIAGS.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>DBD::SQLite::sqlite_status()</i>
<br>
Returns a hash reference that holds a set of status
information of SQLite runtime such as memory usage or page
cache usage (see
&lt;http://www.sqlite.org/c3ref/c_status_malloc_count.html&gt;
for details). Each of the entry contains the current value
and the highwater value.</p>

<pre style="margin-left:11%; margin-top: 1em">  my $status = DBD::SQLite::sqlite_status();
  my $cur  = $status&minus;&gt;{memory_used}{current};
  my $high = $status&minus;&gt;{memory_used}{highwater};</pre>


<p style="margin-left:11%; margin-top: 1em">You may also
pass 0 as an argument to reset the status.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$dbh&minus;&gt;</b><i>sqlite_db_status()</i>
<br>
Returns a hash reference that holds a set of status
information of database connection such as cache usage. See
&lt;http://www.sqlite.org/c3ref/c_dbstatus_options.html&gt;
for details. You may also pass 0 as an argument to reset the
status.</p>


<p style="margin-left:11%; margin-top: 1em"><b>$sth&minus;&gt;</b><i>sqlite_st_status()</i>
<br>
Returns a hash reference that holds a set of status
information of SQLite statement handle such as full table
scan count. See
&lt;http://www.sqlite.org/c3ref/c_stmtstatus_counter.html&gt;
for details. Statement status only holds the current
value.</p>

<pre style="margin-left:11%; margin-top: 1em">  my $status = $sth&minus;&gt;sqlite_st_status();
  my $cur = $status&minus;&gt;{fullscan_step};</pre>


<p style="margin-left:11%; margin-top: 1em">You may also
pass 0 as an argument to reset the status.</p>

<h2>DRIVER CONSTANTS
<a name="DRIVER CONSTANTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">A subset of
SQLite C constants are made available to Perl, because they
may be needed when writing hooks or authorizer callbacks.
For accessing such constants, the
<tt>&quot;DBD::SQLite&quot;</tt> module must be explicitly
<tt>&quot;use&quot;</tt>d at compile time. For example, an
authorizer that forbids any <small>DELETE</small> operation
would be written as follows :</p>

<pre style="margin-left:11%; margin-top: 1em">  use DBD::SQLite;
  $dbh&minus;&gt;sqlite_set_authorizer(sub {
    my $action_code = shift;
    return $action_code == DBD::SQLite::DELETE ? DBD::SQLite::DENY
                                               : DBD::SQLite::OK;
  });</pre>


<p style="margin-left:11%; margin-top: 1em">The list of
constants implemented in <tt>&quot;DBD::SQLite&quot;</tt> is
given below; more information can be found ad at
&lt;http://www.sqlite.org/c3ref/constlist.html&gt;.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Authorizer
Return Codes</b></p>
<pre style="margin-left:11%;">  OK
  DENY
  IGNORE</pre>

<p style="margin-left:11%; margin-top: 1em"><b>Action
Codes</b> <br>
The &quot;set_authorizer&quot; method registers a callback
function that is invoked to authorize certain
<small>SQL</small> statement actions. The first parameter to
the callback is an integer code that specifies what action
is being authorized. The second and third parameters to the
callback are strings, the meaning of which varies according
to the action code. Below is the list of action codes,
together with their associated strings.</p>

<pre style="margin-left:11%; margin-top: 1em">  # constant              string1         string2
  # ========              =======         =======
  CREATE_INDEX            Index Name      Table Name
  CREATE_TABLE            Table Name      undef
  CREATE_TEMP_INDEX       Index Name      Table Name
  CREATE_TEMP_TABLE       Table Name      undef
  CREATE_TEMP_TRIGGER     Trigger Name    Table Name
  CREATE_TEMP_VIEW        View Name       undef
  CREATE_TRIGGER          Trigger Name    Table Name
  CREATE_VIEW             View Name       undef
  DELETE                  Table Name      undef
  DROP_INDEX              Index Name      Table Name
  DROP_TABLE              Table Name      undef
  DROP_TEMP_INDEX         Index Name      Table Name
  DROP_TEMP_TABLE         Table Name      undef
  DROP_TEMP_TRIGGER       Trigger Name    Table Name
  DROP_TEMP_VIEW          View Name       undef
  DROP_TRIGGER            Trigger Name    Table Name
  DROP_VIEW               View Name       undef
  INSERT                  Table Name      undef
  PRAGMA                  Pragma Name     1st arg or undef
  READ                    Table Name      Column Name
  SELECT                  undef           undef
  TRANSACTION             Operation       undef
  UPDATE                  Table Name      Column Name
  ATTACH                  Filename        undef
  DETACH                  Database Name   undef
  ALTER_TABLE             Database Name   Table Name
  REINDEX                 Index Name      undef
  ANALYZE                 Table Name      undef
  CREATE_VTABLE           Table Name      Module Name
  DROP_VTABLE             Table Name      Module Name
  FUNCTION                undef           Function Name
  SAVEPOINT               Operation       Savepoint Name</pre>


<h2>COLLATION FUNCTIONS
<a name="COLLATION FUNCTIONS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>Definition</b>
<br>
SQLite v3 provides the ability for users to supply arbitrary
comparison functions, known as user-defined &quot;collation
sequences&quot; or &quot;collating functions&quot;, to be
used for comparing two text values.
&lt;http://www.sqlite.org/datatype3.html#collation&gt;
explains how collations are used in various
<small>SQL</small> expressions.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Builtin
collation sequences</b> <br>
The following collation sequences are builtin within SQLite
: <b><small><br>
BINARY</small></b></p>

<p style="margin-left:17%;">Compares string data using
<i>memcmp()</i>, regardless of text encoding.</p>


<p style="margin-left:11%;"><b><small>NOCASE</small></b></p>

<p style="margin-left:17%;">The same as binary, except the
26 upper case characters of <small>ASCII</small> are folded
to their lower case equivalents before the comparison is
performed. Note that only <small>ASCII</small> characters
are case folded. SQLite does not attempt to do full
<small>UTF</small> case folding due to the size of the
tables required.</p>


<p style="margin-left:11%;"><b><small>RTRIM</small></b></p>

<p style="margin-left:17%;">The same as binary, except that
trailing space characters are ignored.</p>

<p style="margin-left:11%; margin-top: 1em">In addition,
<tt>&quot;DBD::SQLite&quot;</tt> automatically installs the
following collation sequences : <b><br>
perl</b></p>

<p style="margin-left:17%;">corresponds to the Perl
<tt>&quot;cmp&quot;</tt> operator</p>

<p style="margin-left:11%;"><b>perllocale</b></p>

<p style="margin-left:17%;">Perl <tt>&quot;cmp&quot;</tt>
operator, in a context where <tt>&quot;use locale&quot;</tt>
is activated.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Usage</b>
<br>
You can write for example</p>

<pre style="margin-left:11%; margin-top: 1em">  CREATE TABLE foo(
      txt1 COLLATE perl,
      txt2 COLLATE perllocale,
      txt3 COLLATE nocase
  )</pre>


<p style="margin-left:11%; margin-top: 1em">or</p>

<pre style="margin-left:11%; margin-top: 1em">  SELECT * FROM foo ORDER BY name COLLATE perllocale</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Unicode
handling</b> <br>
If the attribute
<tt>&quot;$dbh&minus;&gt;{sqlite_unicode}&quot;</tt> is set,
strings coming from the database and passed to the collation
function will be properly tagged with the utf8 flag; but
this only works if the <tt>&quot;sqlite_unicode&quot;</tt>
attribute is set <b>before</b> the first call to a perl
collation sequence . The recommended way to activate unicode
is to set the parameter at connection time :</p>

<pre style="margin-left:11%; margin-top: 1em">  my $dbh = DBI&minus;&gt;connect(
      &quot;dbi:SQLite:dbname=foo&quot;, &quot;&quot;, &quot;&quot;,
      {
          RaiseError     =&gt; 1,
          sqlite_unicode =&gt; 1,
      }
  );</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Adding
user-defined collations</b> <br>
The native SQLite <small>API</small> for adding user-defined
collations is exposed through methods
&quot;sqlite_create_collation&quot; and
&quot;sqlite_collation_needed&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">To avoid
calling these functions every time a <tt>$dbh</tt> handle is
created, <tt>&quot;DBD::SQLite&quot;</tt> offers a simpler
interface through the <tt>%DBD::SQLite::COLLATION</tt> hash
: just insert your own collation functions in that hash, and
whenever an unknown collation name is encountered in
<small>SQL,</small> the appropriate collation function will
be loaded on demand from the hash. For example, here is a
way to sort text values regardless of their accented
characters :</p>

<pre style="margin-left:11%; margin-top: 1em">  use DBD::SQLite;
  $DBD::SQLite::COLLATION{no_accents} = sub {
    my ( $a, $b ) = map lc, @_;
    tr[XXXXXXXXXXXXXXXXXXXXXXXXXXXX]
      [aaaaaacdeeeeiiiinoooooouuuuy] for $a, $b;
    $a cmp $b;
  };
  my $dbh  = DBI&minus;&gt;connect(&quot;dbi:SQLite:dbname=dbfile&quot;);
  my $sql  = &quot;SELECT ... FROM ... ORDER BY ... COLLATE no_accents&quot;);
  my $rows = $dbh&minus;&gt;selectall_arrayref($sql);</pre>


<p style="margin-left:11%; margin-top: 1em">The builtin
<tt>&quot;perl&quot;</tt> or <tt>&quot;perllocale&quot;</tt>
collations are predefined in that same hash.</p>

<p style="margin-left:11%; margin-top: 1em">The
<small>COLLATION</small> hash is a global registry within
the current process; hence there is a risk of undesired
side-effects. Therefore, to prevent action at distance, the
hash is implemented as a &quot;write-only&quot; hash, that
will happily accept new entries, but will raise an exception
if any attempt is made to override or delete a existing
entry (including the builtin <tt>&quot;perl&quot;</tt> and
<tt>&quot;perllocale&quot;</tt>).</p>

<p style="margin-left:11%; margin-top: 1em">If you really,
really need to change or delete an entry, you can always
grab the tied object underneath
<tt>%DBD::SQLite::COLLATION</tt> &minus;&minus;&minus; but
don&rsquo;t do that unless you really know what you are
doing. Also observe that changes in the global hash will not
modify existing collations in existing database handles: it
will only affect new <i>requests</i> for collations. In
other words, if you want to change the behaviour of a
collation within an existing <tt>$dbh</tt>, you need to call
the &quot;create_collation&quot; method directly.</p>

<h2>FULLTEXT SEARCH
<a name="FULLTEXT SEARCH"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<small>FTS</small> extension module within SQLite allows
users to create special tables with a built-in full-text
index (hereafter &quot; <small>FTS</small> tables&quot;).
The full-text index allows the user to efficiently query the
database for all rows that contain one or more instances of
a specified word (hereafter a &quot;token&quot;), even if
the table contains many large documents.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Short
introduction to <small>FTS</small></b> <br>
The first full-text search modules for SQLite were called
<tt>&quot;FTS1&quot;</tt> and <tt>&quot;FTS2&quot;</tt> and
are now obsolete. The latest recommended module is
<tt>&quot;FTS4&quot;</tt>; however the former module
<tt>&quot;FTS3&quot;</tt> is still supporter. Detailed
documentation for both <tt>&quot;FTS4&quot;</tt> and
<tt>&quot;FTS3&quot;</tt> can be found at
&lt;http://www.sqlite.org/fts3.html&gt;, including
explanations about the differences between these two
versions.</p>

<p style="margin-left:11%; margin-top: 1em">Here is a very
short example of using <small>FTS :</small></p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;do(&lt;&lt;&quot;&quot;) or die DBI::errstr;
  CREATE VIRTUAL TABLE fts_example USING fts4(content)
  my $sth = $dbh&minus;&gt;prepare(&quot;INSERT INTO fts_example(content) VALUES (?))&quot;);
  $sth&minus;&gt;execute($_) foreach @docs_to_insert;
  my $results = $dbh&minus;&gt;selectall_arrayref(&lt;&lt;&quot;&quot;);
  SELECT docid, snippet(content) FROM fts_example WHERE content MATCH 'foo'</pre>


<p style="margin-left:11%; margin-top: 1em">The key points
in this example are :</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="57%">


<p>The syntax for creating <small>FTS</small> tables is</p></td>
<td width="26%">
</td></tr>
</table>

<pre style="margin-left:17%; margin-top: 1em">  CREATE VIRTUAL TABLE &lt;table_name&gt; USING fts4(&lt;columns&gt;)</pre>


<p style="margin-left:17%; margin-top: 1em">where
<tt>&quot;&lt;columns&gt;&quot;</tt> is a list of column
names. Columns may be typed, but the type information is
ignored. If no columns are specified, the default is a
single column named <tt>&quot;content&quot;</tt>. In
addition, <small>FTS</small> tables have an implicit column
called <tt>&quot;docid&quot;</tt> (or also
<tt>&quot;rowid&quot;</tt>) for numbering the stored
documents.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p style="margin-top: 1em">Statements for inserting,
updating or deleting records use the same syntax as for
regular SQLite tables.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>Full-text searches are specified with the
<tt>&quot;MATCH&quot;</tt> operator, and an operand which
may be a single word, a word prefix ending with
&rsquo;*&rsquo;, a list of words, a &quot;phrase query&quot;
in double quotes, or a boolean combination of the above.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>The builtin function <tt>&quot;snippet(...)&quot;</tt>
builds a formatted excerpt of the document text, where the
words pertaining to the query are highlighted.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">There are many
more details to building and searching <small>FTS</small>
tables, so we strongly invite you to read the full
documentation at
&lt;http://www.sqlite.org/fts3.html&gt;.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Incompatible
change</b> : starting from version 1.31,
<tt>&quot;DBD::SQLite&quot;</tt> uses the new, recommended
&quot;Enhanced Query Syntax&quot; for binary set operators (
<small>AND, OR, NOT,</small> possibly nested with
parenthesis). Previous versions of
<tt>&quot;DBD::SQLite&quot;</tt> used the &quot;Standard
Query Syntax&quot; (see
&lt;http://www.sqlite.org/fts3.html#section_3_2&gt;).
Unfortunately this is a compilation switch, so it cannot be
tuned at runtime; however, since <small>FTS3</small> was
never advertised in versions prior to 1.31, the change
should be invisible to the vast majority of
<tt>&quot;DBD::SQLite&quot;</tt> users. If, however, there
are any applications that nevertheless were built using the
&quot;Standard Query&quot; syntax, they have to be migrated,
because the precedence of the <tt>&quot;OR&quot;</tt>
operator has changed. Conversion from old to new syntax can
be automated through DBD::SQLite::FTS3Transitional,
published in a separate distribution.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Tokenizers</b>
<br>
The behaviour of full-text indexes strongly depends on how
documents are split into <i>tokens</i>; therefore
<small>FTS</small> table declarations can explicitly specify
how to perform tokenization:</p>

<pre style="margin-left:11%; margin-top: 1em">  CREATE ... USING fts4(&lt;columns&gt;, tokenize=&lt;tokenizer&gt;)</pre>


<p style="margin-left:11%; margin-top: 1em">where
<tt>&quot;&lt;tokenizer&gt;&quot;</tt> is a sequence of
space-separated words that triggers a specific tokenizer.
Tokenizers can be SQLite builtins, written in C code, or
Perl tokenizers. Both are as explained below.</p>

<p style="margin-left:11%; margin-top: 1em"><i>SQLite
builtin tokenizers</i></p>

<p style="margin-left:11%; margin-top: 1em">SQLite comes
with three builtin tokenizers : <br>
simple</p>

<p style="margin-left:17%;">Under the <i>simple</i>
tokenizer, a term is a contiguous sequence of eligible
characters, where eligible characters are all alphanumeric
characters, the &quot;_&quot; character, and all characters
with <small>UTF</small> codepoints greater than or equal to
128. All other characters are discarded when splitting a
document into terms. They serve only to separate adjacent
terms.</p>

<p style="margin-left:17%; margin-top: 1em">All uppercase
characters within the <small>ASCII</small> range (
<small>UTF</small> codepoints less than 128), are
transformed to their lowercase equivalents as part of the
tokenization process. Thus, full-text queries are
case-insensitive when using the simple tokenizer.</p>

<p style="margin-left:11%;">porter</p>

<p style="margin-left:17%;">The <i>porter</i> tokenizer
uses the same rules to separate the input document into
terms, but as well as folding all terms to lower case it
uses the Porter Stemming algorithm to reduce related English
language words to a common root.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p>icu</p></td>
<td width="2%"></td>
<td width="83%">


<p>If SQLite is compiled with the
<small>SQLITE_ENABLE_ICU</small> pre-processor symbol
defined, then there exists a built-in tokenizer named
&quot;icu&quot; implemented using the <small>ICU</small>
library, and taking an <small>ICU</small> locale identifier
as argument (such as &quot;tr_TR&quot; for Turkish as used
in Turkey, or &quot;en_AU&quot; for English as used in
Australia). For example:</p></td></tr>
</table>

<pre style="margin-left:17%; margin-top: 1em">  CREATE VIRTUAL TABLE thai_text USING fts4(text, tokenize=icu th_TH)</pre>


<p style="margin-left:17%; margin-top: 1em">The
<small>ICU</small> tokenizer implementation is very simple.
It splits the input text according to the <small>ICU</small>
rules for finding word boundaries and discards any tokens
that consist entirely of white-space. This may be suitable
for some applications in some locales, but not all. If more
complex processing is required, for example to implement
stemming or discard punctuation, use the perl tokenizer as
explained below.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Perl
tokenizers</i></p>

<p style="margin-left:11%; margin-top: 1em">In addition to
the builtin SQLite tokenizers,
<tt>&quot;DBD::SQLite&quot;</tt> implements a <i>perl</i>
tokenizer, that can hook to any tokenizing algorithm written
in Perl. This is specified as follows :</p>

<pre style="margin-left:11%; margin-top: 1em">  CREATE ... USING fts4(&lt;columns&gt;, tokenize=perl '&lt;perl_function&gt;')</pre>


<p style="margin-left:11%; margin-top: 1em">where
<tt>&quot;&lt;perl_function&gt;&quot;</tt> is a fully
qualified Perl function name (i.e. prefixed by the name of
the package in which that function is declared). So for
example if the function is <tt>&quot;my_func&quot;</tt> in
the main program, write</p>

<pre style="margin-left:11%; margin-top: 1em">  CREATE ... USING fts4(&lt;columns&gt;, tokenize=perl 'main::my_func')</pre>


<p style="margin-left:11%; margin-top: 1em">That function
should return a code reference that takes a string as single
argument, and returns an iterator (another function), which
returns a tuple <tt>&quot;($term, $len, $start, $end,
$index)&quot;</tt> for each term. Here is a simple example
that tokenizes on words according to the current perl
locale</p>

<pre style="margin-left:11%; margin-top: 1em">  sub locale_tokenizer {
    return sub {
      my $string = shift;
      use locale;
      my $regex      = qr/\w+/;
      my $term_index = 0;
      return sub { # closure
        $string =~ /$regex/g or return; # either match, or no more token
        my ($start, $end) = ($&minus;[0], $+[0]);
        my $len           = $end&minus;$start;
        my $term          = substr($string, $start, $len);
        return ($term, $len, $start, $end, $term_index++);
      }
    };
  }</pre>


<p style="margin-left:11%; margin-top: 1em">There must be
three levels of subs, in a kind of &quot;Russian dolls&quot;
structure, because :</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p style="margin-top: 1em">the external, named sub is
called whenever accessing a <small>FTS</small> table with
that tokenizer</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>the inner, anonymous sub is called whenever a new string
needs to be tokenized (either for inserting new text into
the table, or for analyzing a query).</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>the innermost, anonymous sub is called repeatedly for
retrieving all terms within that string.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">Instead of
writing tokenizers by hand, you can grab one of those
already implemented in the Search::Tokenizer module. For
example, if you want ignore differences between accented
characters, you can write :</p>

<pre style="margin-left:11%; margin-top: 1em">  use Search::Tokenizer;
  $dbh&minus;&gt;do(&lt;&lt;&quot;&quot;) or die DBI::errstr;
  CREATE ... USING fts4(&lt;columns&gt;,
                        tokenize=perl 'Search::Tokenizer::unaccent')</pre>


<p style="margin-left:11%; margin-top: 1em">Alternatively,
you can use &quot;new&quot; in Search::Tokenizer to build
your own tokenizer.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Incomplete
handling of utf8 characters</b> <br>
The current <small>FTS</small> implementation in SQLite is
far from complete with respect to utf8 handling : in
particular, variable-length characters are not treated
correctly by the builtin functions
<tt>&quot;offsets()&quot;</tt> and
<tt>&quot;snippet()&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Database
space for <small>FTS</small></b> <br>
By default, <small>FTS</small> stores a complete copy of the
indexed documents, together with the fulltext index. On a
large collection of documents, this can consume quite a lot
of disk space. However, <small>FTS</small> has some options
for compressing the documents, or even for not storing them
at all -- see
&lt;http://www.sqlite.org/fts3.html#fts4_options&gt;.</p>

<h2>R* TREE SUPPORT
<a name="R* TREE SUPPORT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<small>RTREE</small> extension module within SQLite adds
support for creating a R&minus;Tree, a special index for
range and multidimensional queries. This allows users to
create tables that can be loaded with (as an example)
geospatial data such as latitude/longitude coordinates for
buildings within a city :</p>

<pre style="margin-left:11%; margin-top: 1em">  CREATE VIRTUAL TABLE city_buildings USING rtree(
     id,               &minus;&minus; Integer primary key
     minLong, maxLong, &minus;&minus; Minimum and maximum longitude
     minLat, maxLat    &minus;&minus; Minimum and maximum latitude
  );</pre>


<p style="margin-left:11%; margin-top: 1em">then query
which buildings overlap or are contained within a specified
region:</p>

<pre style="margin-left:11%; margin-top: 1em">  # IDs that are contained within query coordinates
  my $contained_sql = &lt;&lt;&quot;&quot;;
  SELECT id FROM try_rtree
     WHERE  minLong &gt;= ? AND maxLong &lt;= ?
     AND    minLat  &gt;= ? AND maxLat  &lt;= ?
  # ... and those that overlap query coordinates
  my $overlap_sql = &lt;&lt;&quot;&quot;;
  SELECT id FROM try_rtree
     WHERE    maxLong &gt;= ? AND minLong &lt;= ?
     AND      maxLat  &gt;= ? AND minLat  &lt;= ?
  my $contained = $dbh&minus;&gt;selectcol_arrayref($contained_sql,undef,
                        $minLong, $maxLong, $minLat, $maxLat);
  my $overlapping = $dbh&minus;&gt;selectcol_arrayref($overlap_sql,undef,
                        $minLong, $maxLong, $minLat, $maxLat);</pre>


<p style="margin-left:11%; margin-top: 1em">For more
detail, please see the SQLite R&minus;Tree page
(&lt;http://www.sqlite.org/rtree.html&gt;). Note that custom
R&minus;Tree queries using callbacks, as mentioned in the
prior link, have not been implemented yet.</p>

<h2>FOR DBD::SQLITE EXTENSION AUTHORS
<a name="FOR DBD::SQLITE EXTENSION AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Since 1.30_01,
you can retrieve the bundled sqlite C source and/or header
like this:</p>

<pre style="margin-left:11%; margin-top: 1em">  use File::ShareDir 'dist_dir';
  use File::Spec::Functions 'catfile';
  # the whole sqlite3.h header
  my $sqlite3_h = catfile(dist_dir('DBD&minus;SQLite'), 'sqlite3.h');
  # or only a particular header, amalgamated in sqlite3.c
  my $what_i_want = 'parse.h';
  my $sqlite3_c = catfile(dist_dir('DBD&minus;SQLite'), 'sqlite3.c');
  open my $fh, '&lt;', $sqlite3_c or die $!;
  my $code = do { local $/; &lt;$fh&gt; };
  my ($parse_h) = $code =~ m{(
    /\*+[ ]Begin[ ]file[ ]$what_i_want[ ]\*+
    .+?
    /\*+[ ]End[ ]of[ ]$what_i_want[ ]\*+/
  )}sx;
  open my $out, '&gt;', $what_i_want or die $!;
  print $out $parse_h;
  close $out;</pre>


<p style="margin-left:11%; margin-top: 1em">You usually
want to use this in your extension&rsquo;s
<tt>&quot;Makefile.PL&quot;</tt>, and you may want to add
DBD::SQLite to your extension&rsquo;s
<tt>&quot;CONFIGURE_REQUIRES&quot;</tt> to ensure your
extension users use the same C source/header they use to
build DBD::SQLite itself (instead of the ones installed in
their system).</p>

<h2>TO DO
<a name="TO DO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The following
items remain to be done.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Leak
Detection</b> <br>
Implement one or more leak detection tests that only run
during <small>AUTOMATED_TESTING</small> and
<small>RELEASE_TESTING</small> and validate that none of the
C code we work with leaks.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Stream
<small>API</small> for Blobs</b> <br>
Reading/writing into blobs using
<tt>&quot;sqlite2_blob_open&quot;</tt> /
<tt>&quot;sqlite2_blob_close&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Flags for
sqlite3_open_v2</b> <br>
Support the full <small>API</small> of sqlite3_open_v2
(flags for opening the file).</p>

<p style="margin-left:11%; margin-top: 1em"><b>Support for
custom callbacks for R&minus;Tree queries</b> <br>
Custom queries of a R&minus;Tree index using a callback are
possible with the SQLite C <small>API</small>
(&lt;http://www.sqlite.org/rtree.html&gt;), so one could
potentially use a callback that narrowed the result set down
based on a specific need, such as querying for overlapping
circles.</p>

<h2>SUPPORT
<a name="SUPPORT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Bugs should be
reported via the <small>CPAN</small> bug tracker at</p>


<p style="margin-left:11%; margin-top: 1em">&lt;http://rt.cpan.org/NoAuth/ReportBug.html?Queue=DBD&minus;SQLite&gt;</p>

<p style="margin-left:11%; margin-top: 1em">Note that bugs
of bundled sqlite library (i.e. bugs in
<tt>&quot;sqlite3.[ch]&quot;</tt>) should be reported to the
sqlite developers at sqlite.org via their bug tracker or via
their mailing list.</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Matt Sergeant
&lt;matt@sergeant.org&gt;</p>

<p style="margin-left:11%; margin-top: 1em">Francis J.
Lacoste &lt;flacoste@logreport.org&gt;</p>

<p style="margin-left:11%; margin-top: 1em">Wolfgang
Sourdeau &lt;wolfgang@logreport.org&gt;</p>

<p style="margin-left:11%; margin-top: 1em">Adam Kennedy
&lt;adamk@cpan.org&gt;</p>

<p style="margin-left:11%; margin-top: 1em">Max Maischein
&lt;corion@cpan.org&gt;</p>

<p style="margin-left:11%; margin-top: 1em">Laurent Dami
&lt;dami@cpan.org&gt;</p>

<p style="margin-left:11%; margin-top: 1em">Kenichi
Ishigaki &lt;ishigaki@cpan.org&gt;</p>

<h2>COPYRIGHT
<a name="COPYRIGHT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The bundled
SQLite code in this distribution is Public Domain.</p>

<p style="margin-left:11%; margin-top: 1em">DBD::SQLite is
copyright 2002 &minus; 2007 Matt Sergeant.</p>

<p style="margin-left:11%; margin-top: 1em">Some parts
copyright 2008 Francis J. Lacoste.</p>

<p style="margin-left:11%; margin-top: 1em">Some parts
copyright 2008 Wolfgang Sourdeau.</p>

<p style="margin-left:11%; margin-top: 1em">Some parts
copyright 2008 &minus; 2013 Adam Kennedy.</p>

<p style="margin-left:11%; margin-top: 1em">Some parts
copyright 2009 &minus; 2013 Kenichi Ishigaki.</p>

<p style="margin-left:11%; margin-top: 1em">Some parts
derived from DBD::SQLite::Amalgamation copyright 2008 Audrey
Tang.</p>

<p style="margin-left:11%; margin-top: 1em">This program is
free software; you can redistribute it and/or modify it
under the same terms as Perl itself.</p>

<p style="margin-left:11%; margin-top: 1em">The full text
of the license can be found in the <small>LICENSE</small>
file included with this module.</p>
<hr>
</body>
</html>
