<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Sat Nov 12 00:54:53 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>IBDIAGNET</title>

</head>
<body>

<h1 align="center">IBDIAGNET</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSYS">SYNOPSYS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#FILES">FILES</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#ERROR CODES">ERROR CODES</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">ibdiagnet
&minus; IB diagnostic net</p>

<h2>SYNOPSYS
<a name="SYNOPSYS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">ibdiagnet
[&minus;c &lt;count&gt;] [&minus;v] [&minus;r] [&minus;vlr]
[&minus;u] [&minus;o &lt;out&minus;dir&gt;] <br>
[&minus;t &lt;topo&minus;file&gt;] [&minus;s
&lt;sys&minus;name&gt;] [&minus;i &lt;dev&minus;index&gt;]
[&minus;p &lt;port&minus;num&gt;] [&minus;wt] <br>
[&minus;pm] [&minus;pc] [&minus;P &lt;&lt; <small>PM</small>
&gt;=&lt;Value&gt;&gt;] <br>
[&minus;lw &lt;1x|4x|12x&gt;] [&minus;ls &lt;2.5|5|10&gt;]
<br>
[&minus;skip &lt;ibdiag_check/s&gt;] [&minus;load_db
&lt;db_file&gt;]</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">ibdiagnet scans
the fabric using directed route packets and extracts all the
available information regarding its connectivity and
devices. It then produces the following files in the output
directory (which defined by the &minus;o option (see
below)).</p>

<h2>FILES
<a name="FILES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><i>ibdiagnet.log</i>
&minus;</p>

<p style="margin-left:17%;">A dump of all the application
reports generate according to the provided flags</p>

<p style="margin-left:11%;"><i>ibdiagnet.lst</i>
&minus;</p>

<p style="margin-left:17%;">List of all the nodes, ports
and links in the fabric</p>

<p style="margin-left:11%;"><i>ibdiagnet.fdbs</i>
&minus;</p>

<p style="margin-left:17%;">A dump of the unicast
forwarding tables of the fabric switches</p>

<p style="margin-left:11%;"><i>ibdiagnet.mcfdbs</i>
&minus;</p>

<p style="margin-left:17%;">A dump of the multicast
forwarding tables of the fabric switches</p>

<p style="margin-left:11%;"><i>ibdiagnet.masks</i>
&minus;</p>

<p style="margin-left:17%;">In case of duplicate port/node
Guids, these file include the map between masked Guid and
real Guids</p>

<p style="margin-left:11%;"><i>ibdiagnet.sm</i> &minus;</p>

<p style="margin-left:17%;">List of all the
<small>SM</small> (state and priority) in the fabric</p>

<p style="margin-left:11%;"><i>ibdiagnet.pm</i> &minus;</p>

<p style="margin-left:17%;">A dump of the pm Counters
values, of the fabric links</p>

<p style="margin-left:11%;"><i>ibdiagnet.pkey</i>
&minus;</p>

<p style="margin-left:17%;">A dump of the the existing
partitions and their member host ports</p>

<p style="margin-left:11%;"><i>ibdiagnet.mcgs</i>
&minus;</p>

<p style="margin-left:17%;">A dump of the multicast groups,
their properties and member host ports</p>

<p style="margin-left:11%;"><i>ibdiagnet.psl</i>
&minus;</p>

<p style="margin-left:17%;">A dump of the path record
<small>SL</small> of each possible source node guid and
<small>DLID</small> pairs. Created only if &minus;vlr option
is provided</p>

<p style="margin-left:11%;"><i>ibdiagnet.slvl</i>
&minus;</p>

<p style="margin-left:17%;">A dump of the
<small>SL2VL</small> Tables from all the switches. Created
only if &minus;vlr option is provided</p>

<p style="margin-left:11%;"><i>ibdiagnet.db</i> &minus;</p>

<p style="margin-left:17%;">A dump of the internal subnet
database. This file can be loaded in later runs using the
&minus;load_db option</p>

<p style="margin-left:11%; margin-top: 1em">In addition to
generating the files above, the discovery phase also checks
for duplicate node/port GUIDs in the <small>IB</small>
fabric. If such an error is detected, it is displayed on the
standard output. After the discovery phase is completed,
directed route packets are sent multiple times (according to
the &minus;c option) to detect possible problematic paths on
which packets may be lost. Such paths are explored, and a
report of the suspected bad links is displayed on the
standard output.</p>

<p style="margin-left:11%; margin-top: 1em">After scanning
the fabric, if the &minus;r option is provided, a full
report of the fabric qualities is displayed. This report
includes:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="41%">


<p><b><small>SM</small> report</b></p></td>
<td width="42%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="41%">


<p><b>Number of nodes and systems</b></p></td>
<td width="42%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="41%">


<p><b>Hop-count information</b></p></td>
<td width="42%">
</td></tr>
</table>

<p style="margin-left:17%;">maximal hop-count, an example
path, and a hop-count histogram</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="63%">


<p><b>All CA-to-CA paths traced</b></p></td>
<td width="20%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="63%">


<p><b>Credit loop report</b></p></td>
<td width="20%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="63%">


<p><b>mgid-mlid-HCAs multicast group and report</b></p></td>
<td width="20%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="63%">


<p><b>Partitions report</b></p></td>
<td width="20%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="63%">


<p><b>IPoIB report</b></p></td>
<td width="20%">
</td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">Note: In case
the <small>IB</small> fabric includes only one
<small>CA,</small> then CA-to-CA paths are not reported.
Furthermore, if a topology file is provided, ibdiagnet uses
the names defined in it for the output reports.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;c
&lt;count</b>&gt; :</p>

<p style="margin-left:17%;">Min number of packets to be
sent across each link (default = 10)</p>

<p style="margin-left:11%;"><b>&minus;v</b> :</p>

<p style="margin-left:17%;">Enable verbose mode</p>

<p style="margin-left:11%;"><b>&minus;r</b> :</p>

<p style="margin-left:17%;">Provides a report of the fabric
qualities</p>

<p style="margin-left:11%;"><b>&minus;u</b> :</p>

<p style="margin-left:17%;">Credit loop check based on
UpDown rules</p>

<p style="margin-left:11%;"><b>&minus;t
&lt;topo&minus;file</b>&gt; :</p>

<p style="margin-left:17%;">Specifies the topology file
name</p>

<p style="margin-left:11%;"><b>&minus;s
&lt;sys&minus;name</b>&gt; :</p>

<p style="margin-left:17%;">Specifies the local system
name. Meaningful only if a topology <br>
file is specified</p>

<p style="margin-left:11%;"><b>&minus;i
&lt;dev&minus;index</b>&gt; :</p>

<p style="margin-left:17%;">Specifies the index of the
device of the port used to connect to <br>
the <small>IB</small> fabric (in case of multiple devices on
the local system)</p>

<p style="margin-left:11%;"><b>&minus;p
&lt;port&minus;num</b>&gt; :</p>

<p style="margin-left:17%;">Specifies the local
device&rsquo;s port num used to connect to the
<small>IB</small> <br>
fabric</p>

<p style="margin-left:11%;"><b>&minus;o
&lt;out&minus;dir</b>&gt; :</p>

<p style="margin-left:17%;">Specifies the directory where
the output files will be placed <br>
(default = /var/cache/ibutils)</p>

<p style="margin-left:11%;"><b>&minus;lw
&lt;1x|4x|12x</b>&gt; :</p>

<p style="margin-left:17%;">Specifies the expected link
width</p>

<p style="margin-left:11%;"><b>&minus;ls
&lt;2.5|5|10</b>&gt; :</p>

<p style="margin-left:17%;">Specifies the expected link
speed</p>

<p style="margin-left:11%;"><b>&minus;pm</b> :</p>

<p style="margin-left:17%;">Dump all the fabric links, pm
Counters into ibdiagnet.pm</p>

<p style="margin-left:11%;"><b>&minus;pc</b> :</p>

<p style="margin-left:17%;">Reset all the fabric links
pmCounters</p>

<p style="margin-left:11%;"><b>&minus;P</b>
&lt;PM=&lt;Trash&gt;&gt; :</p>

<p style="margin-left:17%;">If any of the provided pm is
greater then its provided value, <br>
print it to screen</p>

<p style="margin-left:11%;"><b>&minus;skip
&lt;skip&minus;option(s)</b>&gt; :</p>

<p style="margin-left:17%;">Skip the executions of the
selected checks. Skip options (one or <br>
more can be specified) : dup_guids zero_guids pm
logical_state <br>
part ipoib all</p>

<p style="margin-left:11%;"><b>&minus;wt</b>
&lt;file&minus;name&gt;&gt; :</p>

<p style="margin-left:17%;">Write out the discovered
topology into the given file. This flag <br>
is useful if you later want to check for changes from the
current <br>
state of the fabric. A directory named ibdiag_ibnl is also
created <br>
by this option, and holds the <small>IBNL</small> files
required to load this <br>
topology. To use these files you will need to set the
environment <br>
variable named <small>IBDM_IBNL_PATH</small> to that
directory. The directory is <br>
located in /var/cache/ibutils or in the output directory
provided <br>
by the &minus;o flag.</p>

<p style="margin-left:11%;"><b>&minus;load_db</b>
&lt;file&minus;name&gt;&gt; :</p>

<p style="margin-left:17%;">Load subnet data from the given
.db file, and skip subnet <br>
discovery stage. Note: Some of the checks require actual
subnet <br>
discovery, and therefore would not run when load_db is
specified. <br>
These checks are : Duplicated/zero guids, link state, SMs
status.</p>

<p style="margin-left:11%;"><b>&minus;vlr</b> :</p>

<p style="margin-left:17%;"><small>VL</small> based Routing
&minus; provide this option to create the paths
<small>SL</small> file <br>
(psl), <small>SL2VL</small> file (slvl) and use them in
credit loops check (if &minus;r <br>
option is provided).</p>

<p style="margin-left:23%;"><small>NOTE:</small> Since
number of paths is N^2 extracting the <small>PSL</small>
file may take some time.</p>


<p style="margin-left:11%;"><b>&minus;h|&minus;&minus;help</b>
:</p>

<p style="margin-left:17%;">Prints the help page
information</p>


<p style="margin-left:11%;"><b>&minus;V|&minus;&minus;version</b>
:</p>

<p style="margin-left:17%;">Prints the version of the
tool</p>

<p style="margin-left:11%;"><b>&minus;&minus;vars</b> :</p>

<p style="margin-left:17%;">Prints the tool&rsquo;s
environment variables and their values</p>

<h2>ERROR CODES
<a name="ERROR CODES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">1 &minus;
Failed to fully discover the fabric <br>
2 &minus; Failed to parse command line options <br>
3 &minus; Failed to intract with <small>IB</small> fabric
<br>
4 &minus; Failed to use local device or local port <br>
5 &minus; Failed to use Topology File <br>
6 &minus; Failed to load requierd Package</p>
<hr>
</body>
</html>
