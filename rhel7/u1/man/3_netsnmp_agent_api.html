<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Sat Nov 12 01:08:08 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>NETSNMP_AGENT_API</title>

</head>
<body>

<h1 align="center">NETSNMP_AGENT_API</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#CONFIGURATION">CONFIGURATION</a><br>
<a href="#COMPILING">COMPILING</a><br>
<a href="#FUNCTIONS">FUNCTIONS</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">netsnmp_agent_api
- embedding an agent into a external application</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">#include
&lt;net&minus;snmp/net&minus;snmp&minus;config.h&gt; <br>
#include
&lt;net&minus;snmp/net&minus;snmp&minus;includes.h&gt; <br>
#include
&lt;net&minus;snmp/agent/net&minus;snmp&minus;agent&minus;includes.h&gt;</p>

<p style="margin-left:11%; margin-top: 1em">int <br>
main (int argc, char *argv[]) <br>
{ <br>
int agentx_subagent = 1; /* Change this if you&rsquo;re a
master agent. */</p>


<p style="margin-left:11%; margin-top: 1em">snmp_enable_stderrlog();</p>

<p style="margin-left:11%; margin-top: 1em">/* If
we&rsquo;re an AgentX subagent... */ <br>
if (agentx_subagent) { <br>
/* ...make us an AgentX client. */ <br>
netsnmp_ds_set_boolean(NETSNMP_DS_APPLICATION_ID, <br>
NETSNMP_DS_AGENT_ROLE, 1); <br>
}</p>


<p style="margin-left:11%; margin-top: 1em">init_agent(&quot;yourappname&quot;);</p>

<p style="margin-left:11%; margin-top: 1em">/* Initialize
your MIB code here. */ <br>
init_my_mib_code();</p>

<p style="margin-left:11%; margin-top: 1em">/*
&lsquo;yourappname&rsquo; will be used to read
yourappname.conf files. */ <br>
init_snmp(&quot;yourappname&quot;);</p>

<p style="margin-left:11%; margin-top: 1em">/* If
we&rsquo;re going to be a SNMP master agent... */ <br>
if (!agentx_subagent) <br>
init_master_agent(); /* Listen on default port (161). */</p>

<p style="margin-left:11%; margin-top: 1em">/* Your main
loop here... */ <br>
while (whatever) { <br>
/* if you use select(), see snmp_api(3) */ <br>
/* --- OR --- */ <br>
agent_check_and_process(0); /* 0 == don&rsquo;t block */
<br>
}</p>

<p style="margin-left:11%; margin-top: 1em">/* At shutdown
time: */ <br>
snmp_shutdown(&quot;yourappname&quot;); <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">Then: <br>
$(CC) ... &lsquo;net&minus;snmp&minus;config
&minus;&minus;agent&minus;libs&lsquo;</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Our goal is to
create a easy to use interface to the Net-SNMP package such
that you can take code that you have written that has been
designed to be a Net-SNMP MIB module and embed it into an
external application where you can either chose to be a SNMP
master agent or an AgentX sub-agent using the same MIB
module code. Our suggestion is that you use our (or another)
SNMP agent as the AgentX master agent and chose to become an
AgentX subagent which then attaches to the master.</p>

<p style="margin-left:11%; margin-top: 1em">The Net-SNMP
package provides a pair of libraries that enables easy
embedding of an SNMP or AgentX agent into an external
software package. AgentX is an extensible protocol designed
to allow multiple SNMP sub-agents all run on one machine
under a single SNMP master agent. It is defined in RFC
2741.</p>

<p style="margin-left:11%; margin-top: 1em">You will need
to perform a few tasks in order to accomplish this. First
off, you will need to initialize both the SNMP library and
the SNMP agent library. As indicated above, this is done
slightly differently depending on whether or not you are
going to perform as a master agent or an AgentX
sub-agent.</p>

<h2>CONFIGURATION
<a name="CONFIGURATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">If you intend
to operate as an AgentX sub-agent, you will have to
configured the Net-SNMP package with agentx support (which
is turned on by default, so just don&rsquo;t turn it
off)</p>

<p style="margin-left:11%; margin-top: 1em">Additionally,
you will need to link against the Net-SNMP libraries (use
the output of &quot;net&minus;snmp&minus;config
&minus;&minus;agent&minus;libs&quot; to get a library list)
and call subagent_pre_init() as indicated above.</p>

<h2>COMPILING
<a name="COMPILING"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">In order to
make use of any of the above API, you will need to link
against at least the four libraries listed above.</p>

<h2>FUNCTIONS
<a name="FUNCTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">where to find
out more information on them. It is certainly not a complete
list of what is available within all the Net-SNMP libraries.
<br>
snmp_enable_stderrlog()</p>

<p style="margin-left:22%;">Logs error output from the SNMP
agent to the standard error stream.</p>

<p style="margin-left:11%;">netsnmp_ds_set_boolean()</p>

<p style="margin-left:22%;">Please see the
<i>default_store(3)</i> manual page for more information
about this API.</p>

<p style="margin-left:11%;">init_agent(char *name)</p>

<p style="margin-left:22%;">Initializes the embedded agent.
This should be called before the <b>init_snmp()</b> call.
<i>name</i> is used to dictate what .conf file to read when
<b>init_snmp()</b> is called later.</p>

<p style="margin-left:11%;">init_snmp(char *name)</p>

<p style="margin-left:22%;">Initializes the SNMP library.
Note that one of the things this will do will be to read
configuration files in an effort to configure your
application. It will attempt to read the configuration files
named by the <i>name</i> string that you passed in. It can
be used to configure access control, for instance. Please
see the <i>netsnmp_config_api(3)</i>, <i>snmp_config(5)</i>,
and <i>snmpd.conf(5)</i> manual pages for further details on
this subject.</p>

<p style="margin-left:11%;">init_master_agent(void)</p>

<p style="margin-left:22%;">Initializes the master agent
and causes it to listen for SNMP requests on its default UDP
port of 161.</p>

<p style="margin-left:11%;">agent_check_and_process(int
block)</p>

<p style="margin-left:22%;">This checks for packets
arriving on the SNMP port and processes them if some are
found. If <i>block</i> is non-zero, the function call will
block until a packet arrives or an alarm must be run (see
<i>snmp_alarm(3)</i>). The return value from this function
is a positive integer if packets were processed, zero if an
alarm occurred and &minus;1 if an error occured.</p>

<p style="margin-left:11%;">snmp_shutdown(char *name);</p>

<p style="margin-left:22%;">This shuts down the agent,
saving any needed persistent storage, etc.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">http://www.net&minus;snmp.org/tutorial&minus;5/toolkit/
select(2), snmp_api(3), default_store(3), snmp_alarm(3),
netsnmp_config_api(3), snmp_config(5), snmpd.conf(5)</p>
<hr>
</body>
</html>
