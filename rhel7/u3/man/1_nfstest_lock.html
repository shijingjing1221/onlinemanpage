<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 22:00:28 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>NFSTEST_LOCK</title>

</head>
<body>

<h1 align="center">NFSTEST_LOCK</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#TESTS">TESTS</a><br>
<a href="#NOTES">NOTES</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#BUGS">BUGS</a><br>
<a href="#AUTHOR">AUTHOR</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">nfstest_lock -
Locking tests</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">nfstest_lock
--server &lt;server&gt; [--client &lt;client&gt;]
[options]</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Basic locking
tests verify that a lock is granted using various arguments
to fcntl. These include blocking and non-blocking locks,
read or write locks, where the file is opened either for
reading, writing or both. It also checks different ranges
including limit conditions.</p>


<p style="margin-left:11%; margin-top: 1em">Non-overlapping
tests verity that locks are granted on both the client under
test and a second process or a remote client when locking
the same file.</p>

<p style="margin-left:11%; margin-top: 1em">Overlapping
tests verity that a lock is granted on the client under test
and a second process or a remote client trying to lock the
same file will be denied if a non-blocking lock is issue or
will be blocked if a blocking lock is issue on the second
process or remote client.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">--version</p>

<p style="margin-left:22%;">show program&rsquo;s version
number and exit</p>

<p style="margin-left:11%;">-h, --help</p>

<p style="margin-left:22%;">show this help message and
exit</p>

<p style="margin-left:11%;">-f FILE, --file=FILE</p>

<p style="margin-left:22%;">File where options are
specified besides the system wide file /etc/nfstest, user
wide file $HOME/.nfstest or in the current directory
.nfstest file</p>

<p style="margin-left:11%; margin-top: 1em"><b>NFS specific
options:</b> <br>
-s SERVER, --server=SERVER</p>

<p style="margin-left:22%;">Server name or IP address</p>

<p style="margin-left:11%;">-e EXPORT, --export=EXPORT</p>

<p style="margin-left:22%;">Exported file system to mount
[default: &rsquo;/&rsquo;]</p>

<p style="margin-left:11%;">--nfsversion=NFSVERSION</p>

<p style="margin-left:22%;">NFS version, e.g., 3, 4, 4.1,
etc. [default: 4.1]</p>

<p style="margin-left:11%;">-m MTPOINT,
--mtpoint=MTPOINT</p>

<p style="margin-left:22%;">Mount point [default:
&rsquo;/mnt/t&rsquo;]</p>

<p style="margin-left:11%;">-p PORT, --port=PORT</p>

<p style="margin-left:22%;">NFS server port [default:
2049]</p>

<p style="margin-left:11%;">--proto=PROTO</p>

<p style="margin-left:22%;">NFS protocol name [default:
&rsquo;tcp&rsquo;]</p>

<p style="margin-left:11%;">--sec=SEC</p>

<p style="margin-left:22%;">Security flavor [default:
&rsquo;sys&rsquo;]</p>

<p style="margin-left:11%;">-o MTOPTS, --mtopts=MTOPTS</p>

<p style="margin-left:22%;">Mount options [default:
&rsquo;hard,rsize=4096,wsize=4096&rsquo;]</p>

<p style="margin-left:11%;">--datadir=DATADIR</p>

<p style="margin-left:22%;">Data directory where files are
created, directory is created on the mount point [default:
&rsquo;&rsquo;]</p>

<p style="margin-left:11%; margin-top: 1em"><b>Logging
options:</b> <br>
-v VERBOSE, --verbose=VERBOSE</p>

<p style="margin-left:22%;">Verbose level for debug
messages [default: &rsquo;none&rsquo;]</p>

<p style="margin-left:11%;">--tverbose=TVERBOSE</p>

<p style="margin-left:22%;">Verbose level for test messages
[default: &rsquo;1&rsquo;]</p>

<p style="margin-left:11%;">--createlog</p>

<p style="margin-left:22%;">Create log file</p>

<p style="margin-left:11%;">--warnings</p>

<p style="margin-left:22%;">Display warnings</p>

<p style="margin-left:11%;">--tag=TAG</p>

<p style="margin-left:22%;">Informational tag, it is
displayed as an INFO message [default: &rsquo;&rsquo;]</p>

<p style="margin-left:11%; margin-top: 1em"><b>Packet trace
options:</b> <br>
--createtraces</p>

<p style="margin-left:22%;">Create a packet trace for each
test</p>

<p style="margin-left:11%;">--tbsize=TBSIZE</p>

<p style="margin-left:22%;">Capture buffer size for tcpdump
[default: &rsquo;50000&rsquo;]</p>

<p style="margin-left:11%;">--trcdelay=TRCDELAY</p>

<p style="margin-left:22%;">Seconds to delay before
stopping packet trace [default: 0.0]</p>

<p style="margin-left:11%;">--keeptraces</p>

<p style="margin-left:22%;">Do not remove any trace files
[default: remove trace files if no errors]</p>

<p style="margin-left:11%;">--rmtraces</p>

<p style="margin-left:22%;">Remove trace files [default:
remove trace files if no errors]</p>

<p style="margin-left:11%;">-i INTERFACE,
--interface=INTERFACE</p>

<p style="margin-left:22%;">Device interface [default:
automatically selected]</p>

<p style="margin-left:11%;">--subtraces</p>

<p style="margin-left:22%;">Create a packet trace for each
sub-test. Use it with caution since it will create a lot of
packet traces. Use --createtraces instead unless trying to
get a packet trace for a specific sub-test. Best if it is
used in combination with the --runtest option.</p>

<p style="margin-left:11%; margin-top: 1em"><b>File
options:</b> <br>
--nfiles=NFILES</p>

<p style="margin-left:22%;">Number of files to create
[default: 2]</p>

<p style="margin-left:11%;">--filesize=FILESIZE</p>

<p style="margin-left:22%;">File size to use for test files
[default: 65536]</p>

<p style="margin-left:11%;">--rsize=RSIZE</p>

<p style="margin-left:22%;">Read size to use when reading
files [default: 4096]</p>

<p style="margin-left:11%;">--wsize=WSIZE</p>

<p style="margin-left:22%;">Write size to use when writing
files [default: 4096]</p>

<p style="margin-left:11%;">--iodelay=IODELAY</p>

<p style="margin-left:22%;">Seconds to delay I/O operations
[default: 0.1]</p>


<p style="margin-left:11%;">--offset-delta=OFFSET_DELTA</p>

<p style="margin-left:22%;">Read/Write offset delta
[default: 4096]</p>

<p style="margin-left:11%; margin-top: 1em"><b>Path
options:</b> <br>
--sudo=SUDO</p>

<p style="margin-left:22%;">Full path of binary for sudo
[default: &rsquo;/usr/bin/sudo&rsquo;]</p>

<p style="margin-left:11%;">--tcpdump=TCPDUMP</p>

<p style="margin-left:22%;">Full path of binary for tcpdump
[default: &rsquo;/usr/sbin/tcpdump&rsquo;]</p>

<p style="margin-left:11%;">--iptables=IPTABLES</p>

<p style="margin-left:22%;">Full path of binary for
iptables [default: &rsquo;/sbin/iptables&rsquo;]</p>

<p style="margin-left:11%;">--messages=MESSAGES</p>

<p style="margin-left:22%;">Full path of log messages file
[default: &rsquo;/var/log/messages&rsquo;]</p>

<p style="margin-left:11%;">--tmpdir=TMPDIR</p>

<p style="margin-left:22%;">Temporary directory [default:
&rsquo;/tmp&rsquo;]</p>

<p style="margin-left:11%; margin-top: 1em"><b>Debug
options:</b> <br>
--nocleanup</p>

<p style="margin-left:22%;">Do not cleanup created
files</p>

<p style="margin-left:11%;">--bugmsgs=BUGMSGS</p>

<p style="margin-left:22%;">File containing test messages
to mark as bugs if they failed</p>

<p style="margin-left:11%;">--ignore</p>

<p style="margin-left:22%;">Ignore all bugs given by
bugmsgs</p>

<p style="margin-left:11%;">--nomount</p>

<p style="margin-left:22%;">Do not mount server and run the
tests on local disk space</p>

<p style="margin-left:11%;">--basename=BASENAME</p>

<p style="margin-left:22%;">Base name for all files and
logs [default: automatically generated]</p>

<p style="margin-left:11%;">--nfsdebug=NFSDEBUG</p>

<p style="margin-left:22%;">Set NFS kernel debug flags and
save log messages [default: &rsquo;&rsquo;]</p>

<p style="margin-left:11%;">--rpcdebug=RPCDEBUG</p>

<p style="margin-left:22%;">Set RPC kernel debug flags and
save log messages [default: &rsquo;&rsquo;]</p>

<p style="margin-left:11%; margin-top: 1em"><b>Test
options:</b> <br>
--runtest=RUNTEST</p>

<p style="margin-left:22%;">Comma separated list of tests
to run, if list starts with a &rsquo;^&rsquo; then all tests
are run except the ones listed [default:
&rsquo;all&rsquo;]</p>

<p style="margin-left:11%;">--client=CLIENT</p>

<p style="margin-left:22%;">Remote NFS client used for
conflicting lock tests</p>

<p style="margin-left:11%;">--offset=OFFSET</p>

<p style="margin-left:22%;">Offset of first lock granted
[default: 4096]</p>

<p style="margin-left:11%;">--length=LENGTH</p>

<p style="margin-left:22%;">Length of first lock granted
[default: 4096]</p>


<p style="margin-left:11%;">--unlock-delay=UNLOCK_DELAY</p>

<p style="margin-left:22%;">Time in seconds to unlock first
lock [default: 2.0]</p>


<p style="margin-left:11%;">--lockw-timeout=LOCKW_TIMEOUT</p>

<p style="margin-left:22%;">Time in seconds to wait for
blocked lock after conflicting lock has been released
[default: 30]</p>

<p style="margin-left:11%;">--opentype=OPENTYPE</p>

<p style="margin-left:22%;">List of open types to test
[default: read,write,rdwr]</p>

<p style="margin-left:11%;">--locktype=LOCKTYPE</p>

<p style="margin-left:22%;">List of lock types to test
[default: read,write]</p>

<p style="margin-left:11%;">--opentype2=OPENTYPE2</p>

<p style="margin-left:22%;">List of open types to test on
remote client [default: read,write,rdwr]</p>

<p style="margin-left:11%;">--locktype2=LOCKTYPE2</p>

<p style="margin-left:22%;">List of lock types to test on
remote client [default: read,write]</p>

<p style="margin-left:11%;">--setlock=SETLOCK</p>

<p style="margin-left:22%;">List of set lock types to test
[default: immediate,block]</p>

<h2>TESTS
<a name="TESTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>btest01</b>
<br>
Basic locking tests <br>
These tests verify that a lock is granted using various
arguments <br>
to fcntl. These include blocking and non-blocking locks,
read or <br>
write locks, where the file is opened either for reading,
writing <br>
or both. It also checks different ranges including limit
conditions.</p>


<p style="margin-left:11%; margin-top: 1em"><b>noverlap</b>
<br>
Run all non-overlapping locking tests: nptest01, nptest02,
nptest03, <br>
nptest04, nctest01, nctest02, nctest03, nctest04</p>

<p style="margin-left:11%; margin-top: 1em"><b>nptest</b>
<br>
Run all non-overlapping locking tests using a second
process: nptest01, <br>
nptest02, nptest03, nptest04</p>


<p style="margin-left:11%; margin-top: 1em"><b>nptest01</b>
<br>
Locking non-overlapping range from a second process where
end2 &lt; start1 <br>
process1: |------------------| <br>
process2: |--------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>nptest02</b>
<br>
Locking non-overlapping range from a second process where
end2 == start1 - 1 <br>
process1: |------------------| <br>
process2: |------------------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>nptest03</b>
<br>
Locking non-overlapping range from a second process where
start2 &gt; end1 <br>
process1: |------------------| <br>
process2: |--------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>nptest04</b>
<br>
Locking non-overlapping range from a second process where
start2 == end1 + 1 <br>
process1: |------------------| <br>
process2: |------------------|</p>

<p style="margin-left:11%; margin-top: 1em"><b>nctest</b>
<br>
Run all non-overlapping locking tests using a second client:
nctest01, <br>
nctest02, nctest03, nctest04</p>


<p style="margin-left:11%; margin-top: 1em"><b>nctest01</b>
<br>
Locking non-overlapping range from a second client where
end2 &lt; start1 <br>
client1: |------------------| <br>
client2: |--------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>nctest02</b>
<br>
Locking non-overlapping range from a second client where
end2 == start1 - 1 <br>
client1: |------------------| <br>
client2: |------------------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>nctest03</b>
<br>
Locking non-overlapping range from a second client where
start2 &gt; end1 <br>
client1: |------------------| <br>
client2: |--------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>nctest04</b>
<br>
Locking non-overlapping range from a second client where
start2 == end1 + 1 <br>
client1: |------------------| <br>
client2: |------------------|</p>

<p style="margin-left:11%; margin-top: 1em"><b>overlap</b>
<br>
Run all overlapping locking tests: optest01, optest02,
optest03, <br>
optest04, optest05, optest06, optest07, optest08, octest01,
octest02, <br>
octest03, octest04, octest05, octest06, octest07,
octest08</p>

<p style="margin-left:11%; margin-top: 1em"><b>optest</b>
<br>
Run all overlapping locking tests using a second process:
optest01, <br>
optest02, optest03, optest04, optest05, optest06, optest07,
optest08</p>


<p style="margin-left:11%; margin-top: 1em"><b>optest01</b>
<br>
Locking same range from a second process <br>
process1: |------------------| <br>
process2: |------------------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>optest02</b>
<br>
Locking overlapping range from a second process where start2
&lt; start1 <br>
process1: |------------------| <br>
process2: |------------------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>optest03</b>
<br>
Locking overlapping range from a second process where end2
&gt; end1 <br>
process1: |------------------| <br>
process2: |------------------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>optest04</b>
<br>
Locking overlapping range from a second process where range2
is entirely within range1 <br>
process1: |------------------| <br>
process2: |--------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>optest05</b>
<br>
Locking overlapping range from a second process where range1
is entirely within range2 <br>
process1: |------------------| <br>
process2: |----------------------------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>optest06</b>
<br>
Locking full file range from a second process</p>


<p style="margin-left:11%; margin-top: 1em"><b>optest07</b>
<br>
Locking overlapping range from a second process where end2
== start1 <br>
process1: |------------------| <br>
process2: |------------------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>optest08</b>
<br>
Locking overlapping range from a second process where start2
== end1 <br>
process1: |------------------| <br>
process2: |------------------|</p>

<p style="margin-left:11%; margin-top: 1em"><b>octest</b>
<br>
Run all overlapping locking tests using a second client:
octest01, <br>
octest02, octest03, octest04, octest05, octest06, octest07,
octest08</p>


<p style="margin-left:11%; margin-top: 1em"><b>octest01</b>
<br>
Locking same range from a second client <br>
client1: |------------------| <br>
client2: |------------------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>octest02</b>
<br>
Locking overlapping range from a second client where start2
&lt; start1 <br>
client1: |------------------| <br>
client2: |------------------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>octest03</b>
<br>
Locking overlapping range from a second client where end2
&gt; end1 <br>
client1: |------------------| <br>
client2: |------------------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>octest04</b>
<br>
Locking overlapping range from a second client where range2
is entirely within range1 <br>
client1: |------------------| <br>
client2: |--------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>octest05</b>
<br>
Locking overlapping range from a second client where range1
is entirely within range2 <br>
client1: |------------------| <br>
client2: |----------------------------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>octest06</b>
<br>
Locking full file range from a second client</p>


<p style="margin-left:11%; margin-top: 1em"><b>octest07</b>
<br>
Locking overlapping range from a second client where end2 ==
start1 <br>
client1: |------------------| <br>
client2: |------------------|</p>


<p style="margin-left:11%; margin-top: 1em"><b>octest08</b>
<br>
Locking overlapping range from a second client where start2
== end1 <br>
client1: |------------------| <br>
client2: |------------------|</p>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The user id in
the local host and the host specified by --client must have
access to run commands as root using the &rsquo;sudo&rsquo;
command without the need for a password.</p>

<p style="margin-left:11%; margin-top: 1em">The user id
must be able to &rsquo;ssh&rsquo; to remote host without the
need for a password.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>nfstest.rexec(3),
nfstest.test_util(3), nfstest_alloc(1), nfstest_cache(1),
nfstest_delegation(1), nfstest_dio(1), nfstest_file(1),
nfstest_interop(1), nfstest_io(1), nfstest_pkt(1),
nfstest_pnfs(1), nfstest_posix(1), nfstest_sparse(1),
nfstest_xid(1)</b></p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">No known
bugs.</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Jorge Mora
(mora@netapp.com)</p>
<hr>
</body>
</html>
