<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 21:45:01 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>IPSEC_PLUTO</title>

</head>
<body>

<h1 align="center">IPSEC_PLUTO</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#SIGNALS">SIGNALS</a><br>
<a href="#EXIT STATUS">EXIT STATUS</a><br>
<a href="#FILES">FILES</a><br>
<a href="#ENVIRONMENT">ENVIRONMENT</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#HISTORY">HISTORY</a><br>
<a href="#BUGS">BUGS</a><br>
<a href="#AUTHOR">AUTHOR</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">ipsec_pluto,
ipsec_whack, pluto &minus; ipsec whack : IPsec IKE keying
daemon and control interface</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>pluto</i>
[&minus;&minus;help] [&minus;&minus;version]
[&minus;&minus;leak&minus;detective]
[&minus;&minus;config&nbsp;<i>filename</i>]
[&minus;&minus;vendorid&nbsp;<i>VID</i>]
[&minus;&minus;nofork] [&minus;&minus;stderrlog]
[&minus;&minus;&minus;&minus;plutostderrlogtime]
[&minus;&minus;logfile&nbsp;<i>filename</i>]
[&minus;&minus;use&minus;klips]
[&minus;&minus;use&minus;mast]
[&minus;&minus;use&minus;netkey]
[&minus;&minus;use&minus;nostack] [&minus;&minus;uniqueids]
[&minus;&minus;virtual&minus;private&nbsp;<i>network_list</i>]
[&minus;&minus;keep&minus;alive&nbsp;<i>delay_sec</i>]
[&minus;&minus;force&minus;busy] [&minus;&minus;nocrsend]
[&minus;&minus;strictcrlpolicy]
[&minus;&minus;crlcheckinterval]
[&minus;&minus;interface&nbsp;<i>interfacename</i>]
[&minus;&minus;listen&nbsp;<i>ipaddr</i>]
[&minus;&minus;ikeport&nbsp;<i>portnumber</i>]
[&minus;&minus;natikeport&nbsp;<i>portnumber</i>]
[&minus;&minus;ctlbase&nbsp;<i>path</i>]
[&minus;&minus;secretsfile&nbsp;<i>secrets&minus;file</i>]
[&minus;&minus;adns&nbsp;<i>pathname</i>]
[&minus;&minus;nhelpers&nbsp;<i>number</i>]
[&minus;&minus;seedbits&nbsp;<i>numbits</i>]
[&minus;&minus;perpeerlog]
[&minus;&minus;perpeerlogbase&nbsp;<i>dirname</i>]
[&minus;&minus;ipsecdir&nbsp;<i>dirname</i>]
[&minus;&minus;coredir&nbsp;<i>dirname</i>]
[&minus;&minus;statsbin&nbsp;<i>filename</i>]
[&minus;&minus;secctx&minus;attr&minus;type&nbsp;<i>number</i>]</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
[&minus;&minus;help] [&minus;&minus;version]</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
[&minus;&minus;debug&minus;none]
[&minus;&minus;debug&minus;all]
[&minus;&minus;debug&minus;raw]
[&minus;&minus;debug&minus;crypt]
[&minus;&minus;debug&minus;parsing]
[&minus;&minus;debug&minus;emitting]
[&minus;&minus;debug&minus;control]
[&minus;&minus;debug&minus;lifecycle]
[&minus;&minus;debug&minus;kernel]
[&minus;&minus;debug&minus;pfkey]
[&minus;&minus;debug&minus;nat&minus;t]
[&minus;&minus;debug&minus;dpd]
[&minus;&minus;debug&minus;dns]
[&minus;&minus;debug&minus;oppo]
[&minus;&minus;debug&minus;oppoinfo]
[&minus;&minus;debug&minus;whackwatch]
[&minus;&minus;debug&minus;private]
[&minus;&minus;debug&minus;x509]</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;name&nbsp;<i>connection&minus;name</i>
[[&minus;&minus;ipv4] | [&minus;&minus;ipv6]]
[[&minus;&minus;tunnelipv4] |
[&minus;&minus;tunnelipv6]]</p> </td></tr>
</table>


<p style="margin-left:20%;">[&minus;&minus;id&nbsp;<i>identity</i>]
[&minus;&minus;host&nbsp;<i>ip&minus;address</i>]
[&minus;&minus;cert&nbsp;<i>path</i>]
[&minus;&minus;ca&nbsp;<i>distinguished&nbsp;name</i>]
[&minus;&minus;groups&nbsp;<i>access&nbsp;control&nbsp;groups</i>]
[&minus;&minus;sendcert&nbsp;yes&nbsp;|&nbsp;forced&nbsp;|&nbsp;always&nbsp;|&nbsp;ifasked&nbsp;|&nbsp;no&nbsp;|&nbsp;never]
[&minus;&minus;sendca&nbsp;none&nbsp;|&nbsp;issuer&nbsp;|&nbsp;all]
[&minus;&minus;certtype&nbsp;<i>number</i>]
[&minus;&minus;ikeport&nbsp;<i>portnumber</i>]
[&minus;&minus;nexthop&nbsp;<i>ip&minus;address</i>]
[[&minus;&minus;client&nbsp;<i>subnet</i>] |
[&minus;&minus;clientwithin&nbsp;<i>subnet</i>]]
[&minus;&minus;clientprotoport&nbsp;<i>protocol</i>/<i>port</i>]
[&minus;&minus;srcip&nbsp;<i>ip&minus;address</i>]
[&minus;&minus;xauthserver] [&minus;&minus;xauthclient]
[&minus;&minus;modecfgserver] [&minus;&minus;modecfgclient]
[&minus;&minus;modecfgdns1&nbsp;<i>ip&minus;address</i>]
[&minus;&minus;modecfgdns2&nbsp;<i>ip&minus;address</i>]
[&minus;&minus;modecfgdomain&nbsp;<i>DNS&minus;domain</i>]
[&minus;&minus;modecfgbanner&nbsp;<i>login&minus;banner</i>]
[&minus;&minus;dnskeyondemand]
[&minus;&minus;updown&nbsp;<i>updown</i>] <br>
&minus;&minus;to <br>
[&minus;&minus;id&nbsp;<i>identity</i>]
[&minus;&minus;host&nbsp;<i>ip&minus;address</i>]
[&minus;&minus;cert&nbsp;<i>path</i>]
[&minus;&minus;ca&nbsp;<i>distinguished&nbsp;name</i>]
[&minus;&minus;groups&nbsp;<i>access&nbsp;control&nbsp;groups</i>]
[&minus;&minus;sendcert&nbsp;yes&nbsp;|&nbsp;always&nbsp;|&nbsp;ifasked&nbsp;|&nbsp;no&nbsp;|&nbsp;never]
[&minus;&minus;certtype&nbsp;<i>number</i>]
[&minus;&minus;ikeport&nbsp;<i>port&minus;number</i>]
[&minus;&minus;nexthop&nbsp;<i>ip&minus;address</i>]
[&minus;&minus;client&nbsp;<i>subnet</i>]
[&minus;&minus;clientwithin&nbsp;<i>subnet</i>]
[&minus;&minus;clientprotoport&nbsp;<i>protocol</i>/<i>port</i>]
[&minus;&minus;srcip&nbsp;<i>ip&minus;address</i>]
[&minus;&minus;xauthserver] [&minus;&minus;xauthclient]
[&minus;&minus;modecfgserver] [&minus;&minus;modecfgclient]
[&minus;&minus;modecfgdns1&nbsp;<i>ip&minus;address</i>]
[&minus;&minus;modecfgdns2&nbsp;<i>ip&minus;address</i>]
[&minus;&minus;modecfgdomain&nbsp;<i>DNS&minus;domain</i>]
[&minus;&minus;dnskeyondemand]
[&minus;&minus;updown&nbsp;<i>updown</i>]</p>


<p style="margin-left:20%; margin-top: 1em">[&minus;&minus;tunnel]
[&minus;&minus;psk] [&minus;&minus;rsasig]
[&minus;&minus;encrypt] [&minus;&minus;authenticate]
[&minus;&minus;compress] [&minus;&minus;pfs]
[&minus;&minus;pfsgroup&nbsp;[modp1024]&nbsp;|&nbsp;[modp1536]&nbsp;|&nbsp;[modp2048]&nbsp;|&nbsp;[modp3072]&nbsp;|&nbsp;[modp4096]&nbsp;|&nbsp;[modp6144]&nbsp;|&nbsp;[modp8192]&nbsp;|&nbsp;[dh22]&nbsp;|&nbsp;[dh23]&nbsp;|&nbsp;[dh24]]
[&minus;&minus;disablearrivalcheck]
[&minus;&minus;ikelifetime&nbsp;<i>seconds</i>]
[&minus;&minus;ipseclifetime&nbsp;<i>seconds</i>]
[&minus;&minus;rekeymargin&nbsp;<i>seconds</i>]
[&minus;&minus;rekeyfuzz&nbsp;<i>percentage</i>]
[&minus;&minus;keyingtries&nbsp;<i>count</i>]
[&minus;&minus;esp&nbsp;<i>esp&minus;algos</i>]
[&minus;&minus;dontrekey] [&minus;&minus;aggrmode]
[&minus;&minus;modecfgpull]
[&minus;&minus;metric&nbsp;<i>metric</i>]
[&minus;&minus;nflog&minus;group&nbsp;<i>nflognum</i>]
[[&minus;&minus;dpddelay&nbsp;<i>seconds</i>] |
[&minus;&minus;dpdtimeout&nbsp;<i>seconds</i>]]
[&minus;&minus;dpdaction&nbsp;[clear]&nbsp;|&nbsp;[hold]&nbsp;|&nbsp;[restart]]
[&minus;&minus;forceencaps]
[&minus;&minus;no&minus;keep&minus;alive]
[[&minus;&minus;initiateontraffic]&nbsp;|&nbsp;[&minus;&minus;pass]&nbsp;|&nbsp;[&minus;&minus;drop]&nbsp;|&nbsp;[&minus;&minus;reject]]
[[&minus;&minus;failnone]&nbsp;|&nbsp;[&minus;&minus;failpass]&nbsp;|&nbsp;[&minus;&minus;faildrop]&nbsp;|&nbsp;[&minus;&minus;failreject]]
[&minus;&minus;ctlbase&nbsp;<i>path</i>]
[&minus;&minus;label&nbsp;<i>string</i>]</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;keyid&nbsp;<i>id</i> [&minus;&minus;addkey]
[&minus;&minus;pubkeyrsa&nbsp;<i>key</i>]
[&minus;&minus;ctlbase&nbsp;<i>path</i>]
[&minus;&minus;label&nbsp;<i>string</i>]</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;myid&nbsp;<i>id</i></p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;listen | &minus;&minus;unlisten
[&minus;&minus;ctlbase&nbsp;<i>path</i>]
[&minus;&minus;label&nbsp;<i>string</i>]</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;busy | &minus;&minus;relax
[&minus;&minus;ctlbase&nbsp;<i>path</i>]</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;route | &minus;&minus;unroute
&minus;&minus;name&nbsp;<i>connection&minus;name</i>
[&minus;&minus;ctlbase&nbsp;<i>path</i>]
[&minus;&minus;label&nbsp;<i>string</i>]</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;initiate | &minus;&minus;terminate
&minus;&minus;name&nbsp;<i>connection&minus;name</i>
[&minus;&minus;xauthuser&nbsp;<i>user</i>]
[&minus;&minus;xauthpass&nbsp;<i>pass</i>]
[&minus;&minus;asynchronous]
[&minus;&minus;ctlbase&nbsp;<i>path</i>]
[&minus;&minus;label&nbsp;<i>string</i>]</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
[[&minus;&minus;tunnelipv4] | [&minus;&minus;tunnelipv6]]
&minus;&minus;oppohere&nbsp;<i>ip&minus;address</i>
&minus;&minus;oppothere&nbsp;<i>ip&minus;address</i></p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;crash [ipaddress]</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;whackrecord [filename]</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;whackstoprecord</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;name&nbsp;<i>connection&minus;name</i>
&minus;&minus;delete
[&minus;&minus;ctlbase&nbsp;<i>path</i>]
[&minus;&minus;label&nbsp;<i>string</i>]</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;deletestate&nbsp;<i>state&minus;number</i>
[&minus;&minus;ctlbase&nbsp;<i>path</i>]
[&minus;&minus;label&nbsp;<i>string</i>]</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;deleteuser
&minus;&minus;name&nbsp;<i>username</i>
[&minus;&minus;ctlbase&nbsp;<i>path</i>]
[&minus;&minus;label&nbsp;<i>string</i>]</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
[&minus;&minus;name&nbsp;<i>connection&minus;name</i>]
[&minus;&minus;debug&minus;none]
[&minus;&minus;debug&minus;all]
[&minus;&minus;debug&minus;raw]
[&minus;&minus;debug&minus;crypt]
[&minus;&minus;debug&minus;parsing]
[&minus;&minus;debug&minus;emitting]
[&minus;&minus;debug&minus;control]
[&minus;&minus;debug&minus;controlmore]
[&minus;&minus;debug&minus;lifecycle]
[&minus;&minus;debug&minus;klips]
[&minus;&minus;debug&minus;pfkey]
[&minus;&minus;debug&minus;dns]
[&minus;&minus;debug&minus;dpd]
[&minus;&minus;debug&minus;natt]
[&minus;&minus;debug&minus;oppo]
[&minus;&minus;debug&minus;oppoinfo]
[&minus;&minus;debug&minus;whackwatch]
[&minus;&minus;debug&minus;private]
[&minus;&minus;impair&minus;bust&minus;mi2]
[&minus;&minus;impair&minus;bust&minus;mr2]
[&minus;&minus;impair&minus;sa&minus;fail]
[&minus;&minus;impair&minus;die&minus;oninfo]
[&minus;&minus;impair&minus;jacob&minus;two&minus;two]
[&minus;&minus;impair&minus;major&minus;version&minus;bump]
[&minus;&minus;impair&minus;minor&minus;version&minus;bump]
[&minus;&minus;impair&minus;retransmits]
[&minus;&minus;impair&minus;send&minus;bogus&minus;isakmp&minus;flag]
[&minus;&minus;impair&minus;send&minus;ikev2&minus;ke]
[&minus;&minus;impair&minus;send&minus;key&minus;size&minus;check]
[&minus;&minus;impair&minus;send&minus;no&minus;delete]</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
[&minus;&minus;utc] [&minus;&minus;listall]
[&minus;&minus;listpubkeys] [&minus;&minus;listcerts]
[&minus;&minus;listcacerts] [&minus;&minus;listcrls]</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
[&minus;&minus;utc] [&minus;&minus;rereadsecrets]
[&minus;&minus;rereadcrls] [&minus;&minus;rereadall]</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;listevents</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;purgeocsp</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;status
[&minus;&minus;ctlbase&nbsp;<i>path</i>]
[&minus;&minus;label&nbsp;<i>string</i>]</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;trafficstatus &minus;&minus;shuntstatus
[&minus;&minus;ctlbase&nbsp;<i>path</i>]
[&minus;&minus;label&nbsp;<i>string</i>]</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>ipsec</b> <i>whack</i>
&minus;&minus;shutdown
[&minus;&minus;ctlbase&nbsp;<i>path</i>]
[&minus;&minus;label&nbsp;<i>string</i>]</p> </td></tr>
</table>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>pluto</b> is
an IKE (&ldquo;IPsec Key Exchange&rdquo;) daemon.
<b>whack</b> is an auxiliary program to allow requests to be
made to a running <b>pluto</b>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>pluto</b> is
used to automatically build shared &ldquo;security
associations&rdquo; on a system that has IPsec, the secure
IP protocol. In other words, <b>pluto</b> can eliminate much
of the work of manual keying. The actual secure transmission
of packets is the responsibility of other parts of the
system &minus; the kernel. Pluto can talk to various kernel
implementations, such as <b>KLIPS</b>, such as
<b>NETKEY</b>, and such as <b>KAME</b> IPsec stacks.
<b>ipsec_auto</b>(8) provides a more convenient interface to
<b>pluto</b> and <b>whack</b>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>IKE's
Job</b> <br>
A <i>Security Association</i> (<i>SA</i>) is an agreement
between two network nodes on how to process certain traffic
between them. This processing involves encapsulation,
authentication, encryption, or compression.</p>

<p style="margin-left:11%; margin-top: 1em">IKE can be
deployed on a network node to negotiate Security
Associations for that node. These IKE implementations can
only negotiate with other IKE implementations, so IKE must
be on each node that is to be an endpoint of an
IKE&minus;negotiated Security Association. No other nodes
need to be running IKE.</p>

<p style="margin-left:11%; margin-top: 1em">An IKE instance
(i.e. an IKE implementation on a particular network node)
communicates with another IKE instance using UDP IP packets,
so there must be a route between the nodes in each
direction.</p>

<p style="margin-left:11%; margin-top: 1em">The negotiation
of Security Associations requires a number of choices that
involve tradeoffs between security, convenience, trust, and
efficiency. These are policy issues and are normally
specified to the IKE instance by the system
administrator.</p>

<p style="margin-left:11%; margin-top: 1em">IKE deals with
two kinds of Security Associations. The first part of a
negotiation between IKE instances is to build an ISAKMP SA.
An ISAKMP SA is used to protect communication between the
two IKEs. IPsec SAs can then be built by the IKEs &minus;
these are used to carry protected IP traffic between the
systems.</p>

<p style="margin-left:11%; margin-top: 1em">The negotiation
of the ISAKMP SA is known as Phase 1. In theory, Phase 1 can
be accomplished by a couple of different exchange types.
Currently, Main Mode and Aggressive Mode are
implemented.</p>

<p style="margin-left:11%; margin-top: 1em">Any negotiation
under the protection of an ISAKMP SA, including the
negotiation of IPsec SAs, is part of Phase 2. The exchange
type that we use to negotiate an IPsec SA is called Quick
Mode.</p>

<p style="margin-left:11%; margin-top: 1em">IKE instances
must be able to authenticate each other as part of their
negotiation of an ISAKMP SA. This can be done by several
mechanisms described in the draft standards.</p>

<p style="margin-left:11%; margin-top: 1em">IKE negotiation
can be initiated by any instance with any other. If both can
find an agreeable set of characteristics for a Security
Association, and both recognize each others authenticity,
they can set up a Security Association. The standards do not
specify what causes an IKE instance to initiate a
negotiation.</p>

<p style="margin-left:11%; margin-top: 1em">In summary, an
IKE instance is prepared to automate the management of
Security Associations in an IPsec environment, but a number
of issues are considered policy and are left in the system
administrator's hands.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Pluto <br>
pluto</b> is an implementation of IKE. It runs as a daemon
on a network node. Currently, this network node must be a
LINUX system running the <b>KLIPS</b> or <b>NETKEY</b>
implementation of IPsec, or a FreeBSD/NetBSD/Mac OSX system
running the <b>KAME</b> implementation of IPsec.</p>

<p style="margin-left:11%; margin-top: 1em"><b>pluto</b>
implements a large subset of IKE. This is enough for it to
interoperate with other instances of <b>pluto</b>, and many
other IKE implementations.</p>

<p style="margin-left:11%; margin-top: 1em">The policy for
acceptable characteristics for Security Associations is
mostly hardwired into the code of <b>pluto</b> (spdb.c).
Eventually this will be moved into a security policy
database with reasonable expressive power and more
convenience.</p>

<p style="margin-left:11%; margin-top: 1em"><b>pluto</b>
uses shared secrets or RSA signatures to authenticate peers
with whom it is negotiating. These RSA signatures can come
from DNS(SEC), a configuration file, or from X.509 and CA
certificates.</p>

<p style="margin-left:11%; margin-top: 1em"><b>pluto</b>
initiates negotiation of a Security Association when it is
manually prodded: the program <b>whack</b> is run to trigger
this. It will also initiate a negotiation when <b>KLIPS</b>
traps an outbound packet for Opportunistic Encryption.</p>

<p style="margin-left:11%; margin-top: 1em"><b>pluto</b>
implements ISAKMP SAs itself. After it has negotiated the
characteristics of an IPsec SA, it directs the <b>kernel</b>
to implement it. If necessary, it also invokes a script to
adjust any firewall and issue <b>route</b>(8) commands to
direct IP packets.</p>

<p style="margin-left:11%; margin-top: 1em">When
<b>pluto</b> shuts down, it closes all Security
Associations.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Before
Running Pluto <br>
pluto</b> runs as a daemon with userid root. Before running
it, a few things must be set up.</p>

<p style="margin-left:11%; margin-top: 1em"><b>pluto</b>
requires a working IPsec stack.</p>

<p style="margin-left:11%; margin-top: 1em"><b>pluto</b>
supports multiple public networks (that is, networks that
are considered insecure and thus need to have their traffic
encrypted or authenticated). It discovers the public
interfaces to use by looking at all interfaces that are
configured (the <b>&minus;&minus;interface</b> option can be
used to limit the interfaces considered). It does this only
when <b>whack</b> tells it to &minus;&minus;listen, so the
interfaces must be configured by then. Each interface with a
name of the form <b>ipsec</b>[0&minus;9] is taken as a
<b>KLIPS</b> virtual public interface. Another network
interface with the same IP address (the first one found will
be used) is taken as the corresponding real public
interface. The <b>&minus;&minus;listen</b> can be used to
limit listening on only 1 IP address of a certain interface.
<b>ifconfig</b>(8) or <b>ip</b>(8) with the <b>&minus;a</b>
flag will show the name and status of each network
interface.</p>

<p style="margin-left:11%; margin-top: 1em"><b>pluto</b>
requires a database of preshared secrets and RSA private
keys. This is described in the <b>ipsec.secrets</b>(5).
<b>pluto</b> is told of RSA public keys via <b>whack</b>
commands. If the connection is Opportunistic, and no RSA
public key is known, <b>pluto</b> will attempt to fetch RSA
keys using the Domain Name System.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Setting up
KLIPS for pluto</b> <br>
The most basic network topology that <b>pluto</b> supports
has two security gateways negotiating on behalf of client
subnets. The diagram of RGB's testbed is a good example (see
<i>klips/doc/rgb_setup.txt</i>).</p>

<p style="margin-left:11%; margin-top: 1em">The file
INSTALL in the base directory of this distribution explains
how to start setting up the whole system, including
<b>KLIPS</b>.</p>

<p style="margin-left:11%; margin-top: 1em">Make sure that
the security gateways have routes to each other. This is
usually covered by the default route, but may require
issuing <b>route</b>(8) commands. The route must go through
a particular IP interface (we will assume it is <i>eth0</i>,
but it need not be). The interface that connects the
security gateway to its client must be a different one.</p>

<p style="margin-left:11%; margin-top: 1em">It is necessary
to issue a <b>ipsec_tncfg</b>(8) command on each gateway.
The required command is: &nbsp;&nbsp;&nbsp;</p>

<p style="margin-left:11%; margin-top: 1em">ipsec tncfg
&minus;&minus;attach&nbsp;&minus;&minus;virtual&nbsp;ipsec0
&minus;&minus;physical&nbsp;eth0</p>

<p style="margin-left:11%; margin-top: 1em">A command to
set up the ipsec0 virtual interface will also need to be
run. It will have the same parameters as the command used to
set up the physical interface to which it has just been
connected using <b>ipsec_tncfg</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>Setting up
NETKEY for pluto</b> <br>
No special requirements are necessary to use NETKEY &minus;
it ships with all modern versions of Linux 2.4 and 2.6.
however, note that certain vendors or older distributions
use old versions or backports of NETKEY which are broken. If
possible use a NETKEY version that is at least based on, or
backported from Linux 2.6.11 or newer.</p>


<p style="margin-left:11%; margin-top: 1em"><b>ipsec.secrets
file</b> <br>
A <b>pluto</b> daemon and another IKE daemon (for example,
another instance of <b>pluto</b>) must convince each other
that they are who they are supposed to be before any
negotiation can succeed. This authentication is accomplished
by using either secrets that have been shared beforehand
(manually) or by using RSA signatures. There are other
techniques, but they have not been implemented in
<b>pluto</b>.</p>

<p style="margin-left:11%; margin-top: 1em">The file
/etc/ipsec.secrets is used to keep preshared secret keys and
XAUTH passwords. RSA private keys, X.509 certificates, CRLs,
OCSP and smartcards are handled via NSS. For debugging,
there is an argument to the <b>pluto</b> command to use a
different file. This file is described in
<b>ipsec.secrets</b>(5).</p>

<p style="margin-left:11%; margin-top: 1em"><b>Running
Pluto</b> <br>
To fire up the daemon, just type <b>pluto</b> (be sure to be
running as the superuser). The default IKE port number is
500, the UDP port assigned by IANA for IKE Daemons.
<b>pluto</b> must be run by the superuser to be able to use
the UDP 500 port. If pluto is told to enable
NAT&minus;Traversal, then UDP port 4500 is also taken by
pluto to listen on.</p>

<p style="margin-left:11%; margin-top: 1em">Pluto supports
different IPstacks on different operating systems. This can
be configured using one of the options
<b>&minus;&minus;use&minus;netkey</b> (the default),
<b>&minus;&minus;use&minus;klips</b>,
<b>&minus;&minus;use&minus;mast</b>,
<b>&minus;&minus;use&minus;bsdkame</b>,
<b>&minus;&minus;use&minus;win2k</b> or
<b>&minus;&minus;use&minus;nostack</b>. The latter is meant
for testing only &minus; no actual IPsec connections will be
loaded into the kernel. The option
<b>&minus;&minus;use&minus;auto</b> has been obsoleted. On
startup, pluto might also read the <b>protostack=</b> option
to select the IPsec stack to use if <b>&minus;&minus;config
/etc/ipsec.conf</b> is given as argument to pluto. If both
<b>&minus;&minus;use&minus;XXX</b> and
<b>&minus;&minus;config /etc/ipsec.conf</b> are specified,
the last command line argument specified takes
precedence.</p>

<p style="margin-left:11%; margin-top: 1em">Pluto supports
RFC 3947 NAT&minus;Traversal. The allowed range behind the
NAT routers is submitted using the
<b>&minus;&minus;virtual&minus;private</b> option. See
<b>ipsec.conf</b>(5) for the syntax. The option
<b>&minus;&minus;force&minus;keepalive</b> forces the
sending of the <i>keep&minus;alive packets</i>, which are
send to prevent the NAT router from closing its port when
there is not enough traffic on the IPsec connection. The
<b>&minus;&minus;keep&minus;alive</b> sets the delay (in
seconds) of these keep&minus;alive packets. The newer
NAT&minus;T standards support <i>port floating</i>, and
Libreswan enables this per default.</p>

<p style="margin-left:11%; margin-top: 1em">Pluto supports
the use of X.509 certificates and sends it certificate when
needed. This can confuse IKE implementations that do not
implement this, such as the old FreeS/WAN implementation.
The <b>&minus;&minus;nocrsend</b> prevents pluto from
sending these. At startup, pluto loads all the X.509 related
files from the directories /etc/ipsec.d/certs,
/etc/ipsec.d/cacerts, /etc/ipsec.d/aacerts,
/etc/ipsec.d/private and /etc/ipsec.d/crls. The
<i>Certificate Revocation Lists</i> can also be retrieved
from an URL. The option
<b>&minus;&minus;crlcheckinterval</b> sets the time between
checking for CRL expiration and issuing new fetch commands.
The first attempt to update a CRL is started at
<i>2*crlcheckinterval</i> before the next update time. Pluto
logs a warning if no valid CRL was loaded or obtained for a
connection. If <b>&minus;&minus;strictcrlpolicy</b> is
given, the connection will be rejected until a valid CRL has
been loaded.</p>

<p style="margin-left:11%; margin-top: 1em">Pluto can also
use helper children to off&minus;load cryptographic
operations. This behavior can be fine tuned using the
<b>&minus;&minus;nhelpers</b>. Pluto will start
<i>(n&minus;1)</i> of them, where <i>n</i> is the number of
CPU&rsquo;s you have (including hypherthreaded CPU&rsquo;s).
A value of <i>0</i> forces pluto to do all operations in the
main process. A value of <i>&minus;1</i> tells pluto to
perform the above calculation. Any other value forces the
number to that amount.</p>

<p style="margin-left:11%; margin-top: 1em">Pluto uses the
NSS crypto library as its random source. Some government
Three Letter Agency requires that pluto reads 440 bits from
/dev/random and feed this into the NSS RNG before drawing
random from the NSS library, despite the NSS library itself
already seeding its internal state. As this process can
block pluto for an extended time, the default is to not
perform this redundant seeding. The
<b>&minus;&minus;seedbits</b> option can be used to specify
the number of bits that will be pulled from /dev/random and
seeded into the NSS RNG. This can also be accomplished by
specifying seedbits in the &quot;config setup&quot; section
of ipsec.conf. This option should not be used by most
people.</p>

<p style="margin-left:11%; margin-top: 1em"><b>pluto</b>
attempts to create a lockfile with the name
/var/run/pluto/pluto.pid. If the lockfile cannot be created,
<b>pluto</b> exits &minus; this prevents multiple
<b>pluto</b>s from competing Any &ldquo;leftover&rdquo;
lockfile must be removed before <b>pluto</b> will run.
<b>pluto</b> writes its PID into this file so that scripts
can find it. This lock will not function properly if it is
on an NFS volume (but sharing locks on multiple machines
doesn't make sense anyway).</p>

<p style="margin-left:11%; margin-top: 1em"><b>pluto</b>
then forks and the parent exits. This is the conventional
&ldquo;daemon fork&rdquo;. It can make debugging awkward, so
there is an option to suppress this fork. In certain
configurations, pluto might also launch helper programs to
assist with DNS queries or to offload cryptographic
operations.</p>

<p style="margin-left:11%; margin-top: 1em">All logging,
including diagnostics, is sent to <b>syslog</b>(3) with
facility=authpriv; it decides where to put these messages
(possibly in /var/log/secure or /var/log/auth.log). Since
this too can make debugging awkward, the option
<b>&minus;&minus;stderrlog</b> is used to steer logging to
stderr.</p>

<p style="margin-left:11%; margin-top: 1em">Alternatively,
<b>&minus;&minus;logfile</b> can be used to send all logging
information to a specific file.</p>

<p style="margin-left:11%; margin-top: 1em">If the
<b>&minus;&minus;perpeerlog</b> option is given, then pluto
will open a log file per connection. By default, this is in
/var/log/pluto/peer, in a subdirectory formed by turning all
dot (.) [IPv4} or colon (:) [IPv6] into slashes (/).</p>

<p style="margin-left:11%; margin-top: 1em">The base
directory can be changed with the
<b>&minus;&minus;perpeerlogbase</b>.</p>

<p style="margin-left:11%; margin-top: 1em">Once
<b>pluto</b> is started, it waits for requests from
<b>whack</b>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Pluto's
Internal State</b> <br>
To understand how to use <b>pluto</b>, it is helpful to
understand a little about its internal state. Furthermore,
the terminology is needed to decipher some of the diagnostic
messages.</p>

<p style="margin-left:11%; margin-top: 1em">Pluto supports
<b>food groups</b>, and X.509 certificates. These are
located in /etc/ipsec.d, or another directory as specified
by <b>&minus;&minus;ipsecdir</b>.</p>

<p style="margin-left:11%; margin-top: 1em">Pluto may core
dump. It will normally do so into the current working
directory. You can specify the &minus;&minus;coredir option
for pluto, or specify the dumpdir= option in ipsec.conf.</p>

<p style="margin-left:11%; margin-top: 1em">If you are
investigating a potential memory leak in pluto, start pluto
with the &minus;&minus;leak&minus;detective option. Before
the leak causes the system or pluto to die, shut down pluto
in the regular way. pluto will display a list of leaks it
has detected.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>(potential) connection</i> database describes attributes
of a connection. These include the IP addresses of the hosts
and client subnets and the security characteristics desired.
<b>pluto</b> requires this information (simply called a
connection) before it can respond to a request to build an
SA. Each connection is given a name when it is created, and
all references are made using this name.</p>

<p style="margin-left:11%; margin-top: 1em">During the IKE
exchange to build an SA, the information about the
negotiation is represented in a <i>state object</i>. Each
state object reflects how far the negotiation has reached.
Once the negotiation is complete and the SA established, the
state object remains to represent the SA. When the SA is
terminated, the state object is discarded. Each State object
is given a serial number and this is used to refer to the
state objects in logged messages.</p>

<p style="margin-left:11%; margin-top: 1em">Each state
object corresponds to a connection and can be thought of as
an instantiation of that connection. At any particular time,
there may be any number of state objects corresponding to a
particular connection. Often there is one representing an
ISAKMP SA and another representing an IPsec SA.</p>

<p style="margin-left:11%; margin-top: 1em"><b>KLIPS</b>
hooks into the routing code in a LINUX kernel. Traffic to be
processed by an IPsec SA must be directed through
<b>KLIPS</b> by routing commands. Furthermore, the
processing to be done is specified by <i>ipsec eroute(8)</i>
commands. <b>pluto</b> takes the responsibility of managing
both of these special kinds of routes.</p>

<p style="margin-left:11%; margin-top: 1em"><b>NETKEY</b>
requires no special routing.</p>

<p style="margin-left:11%; margin-top: 1em">Each connection
may be routed, and must be while it has an IPsec SA. The
connection specifies the characteristics of the route: the
interface on this machine, the &ldquo;gateway&rdquo; (the
nexthop), and the peer's client subnet. Two connections may
not be simultaneously routed if they are for the same peer's
client subnet but use different interfaces or gateways
(<b>pluto</b>'s logic does not reflect any advanced routing
capabilities).</p>

<p style="margin-left:11%; margin-top: 1em">On KLIPS, each
eroute is associated with the state object for an IPsec SA
because it has the particular characteristics of the SA. Two
eroutes conflict if they specify the identical local and
remote clients (unlike for routes, the local clients are
taken into account).</p>

<p style="margin-left:11%; margin-top: 1em">When
<b>pluto</b> needs to install a route for a connection, it
must make sure that no conflicting route is in use. If
another connection has a conflicting route, that route will
be taken down, as long as there is no IPsec SA instantiating
that connection. If there is such an IPsec SA, the attempt
to install a route will fail.</p>

<p style="margin-left:11%; margin-top: 1em">There is an
exception. If <b>pluto</b>, as Responder, needs to install a
route to a fixed client subnet for a connection, and there
is already a conflicting route, then the SAs using the route
are deleted to make room for the new SAs. The rationale is
that the new connection is probably more current. The need
for this usually is a product of Road Warrior connections
(these are explained later; they cannot be used to
initiate).</p>

<p style="margin-left:11%; margin-top: 1em">When
<b>pluto</b> needs to install an eroute for an IPsec SA (for
a state object), first the state object's connection must be
routed (if this cannot be done, the eroute and SA will not
be installed). If a conflicting eroute is already in place
for another connection, the eroute and SA will not be
installed (but note that the routing exception mentioned
above may have already deleted potentially conflicting SAs).
If another IPsec SA for the same connection already has an
eroute, all its outgoing traffic is taken over by the new
eroute. The incoming traffic will still be processed. This
characteristic is exploited during rekeying.</p>

<p style="margin-left:11%; margin-top: 1em">All of these
routing characteristics are expected change when
<b>KLIPS</b> and <b>NETKEY</b> merge into a single new
stack.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Using whack
<br>
whack</b> is used to command a running <b>pluto</b>.
<b>whack</b> uses a UNIX domain socket to speak to
<b>pluto</b> (by default, /var/pluto.ctl).</p>

<p style="margin-left:11%; margin-top: 1em"><b>whack</b>
has an intricate argument syntax. This syntax allows many
different functions to be specified. The help form shows the
usage or version information. The connection form gives
<b>pluto</b> a description of a potential connection. The
public key form informs <b>pluto</b> of the RSA public key
for a potential peer. The delete form deletes a connection
description and all SAs corresponding to it. The listen form
tells <b>pluto</b> to start or stop listening on the public
interfaces for IKE requests from peers. The route form tells
<b>pluto</b> to set up routing for a connection; the unroute
form undoes this. The initiate form tells <b>pluto</b> to
negotiate an SA corresponding to a connection. The terminate
form tells <b>pluto</b> to remove all SAs corresponding to a
connection, including those being negotiated. The status
form displays the <b>pluto</b>'s internal state. The debug
form tells <b>pluto</b> to change the selection of debugging
output &ldquo;on the fly&rdquo;. The shutdown form tells
<b>pluto</b> to shut down, deleting all SAs.</p>

<p style="margin-left:11%; margin-top: 1em">The crash
option asks pluto to consider a particularly target IP to
have crashed, and to attempt to restart all connections with
that IP address as a gateway. In general, you should use
Dead Peer Detection to detect this kind of situation
automatically, but this is not always possible.</p>

<p style="margin-left:11%; margin-top: 1em">Most options
are specific to one of the forms, and will be described with
that form. There are three options that apply to all
forms.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;ctlbase&nbsp;</b><i>path</i></p>

<p style="margin-left:17%;"><i>path</i>.ctl is used as the
UNIX domain socket for talking to <b>pluto</b>. This option
facilitates debugging.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;label&nbsp;</b><i>string</i></p>

<p style="margin-left:17%;">adds the string to all error
messages generated by <b>whack</b>.</p>

<p style="margin-left:11%; margin-top: 1em">The help form
of <b>whack</b> is self&minus;explanatory.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;help</b></p>

<p style="margin-left:17%;">display the usage message.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;version</b></p>

<p style="margin-left:17%;">display the version of
<b>whack</b>.</p>

<p style="margin-left:11%; margin-top: 1em">The connection
form describes a potential connection to <b>pluto</b>.
<b>pluto</b> needs to know what connections can and should
be negotiated. When <b>pluto</b> is the initiator, it needs
to know what to propose. When <b>pluto</b> is the responder,
it needs to know enough to decide whether is is willing to
set up the proposed connection.</p>

<p style="margin-left:11%; margin-top: 1em">The description
of a potential connection can specify a large number of
details. Each connection has a unique name. This name will
appear in a updown shell command, so it should not contain
punctuation that would make the command
ill&minus;formed.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;name&nbsp;</b><i>connection&minus;name</i></p>

<p style="margin-left:17%;">sets the name of the
connection</p>

<p style="margin-left:11%; margin-top: 1em">The topology of
a connection is symmetric, so to save space here is half a
picture: &nbsp;&nbsp;&nbsp;</p>


<p style="margin-left:11%; margin-top: 1em">client_subnet&lt;&minus;&minus;&gt;host:ikeport&lt;&minus;&minus;&gt;nexthop&lt;&minus;&minus;&minus;</p>

<p style="margin-left:11%; margin-top: 1em">A similar trick
is used in the flags. The same flag names are used for both
ends. Those before the <b>&minus;&minus;to</b> flag describe
the left side and those afterwards describe the right side.
When <b>pluto</b> attempts to use the connection, it decides
whether it is the left side or the right side of the
connection, based on the IP numbers of its interfaces.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;id&nbsp;</b><i>id</i></p>

<p style="margin-left:17%;">the identity of the end.
Currently, this can be an IP address (specified as dotted
quad or as a Fully Qualified Domain Name, which will be
resolved immediately) or as a Fully Qualified Domain Name
itself (prefixed by &ldquo;@&rdquo; to signify that it
should not be resolved), or as user@FQDN, or an X.509 DN, or
as the magic value <b>%myid</b>. <b>Pluto</b> only
authenticates the identity, and does not use it for
addressing, so, for example, an IP address need not be the
one to which packets are to be sent. If the option is
absent, the identity defaults to the IP address specified by
<b>&minus;&minus;host</b>. <b>%myid</b> allows the identity
to be separately specified (by the <b>pluto</b> or
<b>whack</b> option <b>&minus;&minus;myid</b> or by the
<b>ipsec.conf</b>(5)<b>config setup</b> parameter
<i>myid</i>). Otherwise, <b>pluto</b> tries to guess what
<b>%myid</b> should stand for: the IP address of
<b>%defaultroute</b>, if it is supported by a suitable TXT
record in the reverse domain for that IP address, or the
system's hostname, if it is supported by a suitable TXT
record in its forward domain.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;host&nbsp;</b><i>ip&minus;address</i>,
<b>&minus;&minus;host&nbsp;%any</b>,
<b>&minus;&minus;host&nbsp;%opportunistic</b></p>

<p style="margin-left:17%;">the IP address of the end
(generally the public interface). If <b>pluto</b> is to act
as a responder for IKE negotiations initiated from unknown
IP addresses (the &ldquo;Road Warrior&rdquo; case), the IP
address should be specified as <b>%any</b> (currently, the
obsolete notation 0.0.0.0 is also accepted for this). If
<b>pluto</b> is to opportunistically initiate the
connection, use <b>%opportunistic</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;cert&nbsp;</b><i>filename</i></p>

<p style="margin-left:17%;">The filename of the X.509
certificate. This must be the public key certificate only,
and cannot be the PKCS#12 certificate file. See
<b>ipsec.conf</b>(5) on how to extrac this from the PKCS#12
file.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;ca&nbsp;</b><i>distinguished
name</i></p>

<p style="margin-left:17%;">the X.509 Certificate
Authority's Distinguished Name (DN) used as trust anchor for
this connection. This is the CA certificate that signed the
host certificate, as well as the certificate of the incoming
client.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;groups&nbsp;</b><i>access
control groups</i></p>

<p style="margin-left:17%;">the access control groups
used.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;sendcert&nbsp;</b><i>yes|forced|always|ifasked|no|never</i></p>

<p style="margin-left:17%;">Whether or not to send our
X.509 certificate credentials. This could potentially give
an attacker too much information about which identities are
allowed to connect to this host. The default is to use
<b>ifasked</b> when we are a Responder, and to use
<b>yes</b> (which is the same as <b>forced</b> and
<b>always</b> if we are an Initiator. The values <b>no</b>
and <b>never</b> are equivalent. NOTE: &quot;forced&quot;
does not seem to be actually implemented &minus; do not use
it.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;sendca&nbsp;</b><i>none|issuer|all</i></p>

<p style="margin-left:17%;">How much of our available X.509
trust chain to send with the end certificate, excluding any
root CAs. Specifying <b>issuer</b> sends just the issuing
intermediate CA, while <b><br>
all</b> will send the entire chain of intermediate
CAs.<b>none</b> will not send any CA certs. The default is
<b>none</b> which maintains the current libreswan
behavior.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;certtype&nbsp;</b><i>number</i></p>

<p style="margin-left:17%;">The X.509 certificate type
number.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;ikeport&nbsp;</b><i>port&minus;number</i></p>

<p style="margin-left:17%;">the UDP port that IKE listens
to on that host. The default is 500. (<b>pluto</b> on this
machine uses the port specified by its own command line
argument, so this only affects where <b>pluto</b> sends
messages.)</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;nexthop&nbsp;</b><i>ip&minus;address</i></p>

<p style="margin-left:17%;">where to route packets for the
peer's client (presumably for the peer too, but it will not
be used for this). When <b>pluto</b> installs an IPsec SA,
it issues a route command. It uses the nexthop as the
gateway. The default is the peer's IP address (this can be
explicitly written as <b>%direct</b>; the obsolete notation
0.0.0.0 is accepted). This option is necessary if
<b>pluto</b>'s host's interface used for sending packets to
the peer is neither point&minus;to&minus;point nor directly
connected to the peer.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;client&nbsp;</b><i>subnet</i></p>

<p style="margin-left:17%;">the subnet for which the IPsec
traffic will be destined. If not specified, the host will be
the client. The subnet can be specified in any of the forms
supported by <b>ipsec_atosubnet</b>(3). The general form is
<i>address</i>/<i>mask</i>. The <i>address</i> can be either
a domain name or four decimal numbers (specifying octets)
separated by dots. The most convenient form of the
<i>mask</i> is a decimal integer, specifying the number of
leading one bits in the mask. So, for example, 10.0.0.0/8
would specify the class A network &ldquo;Net 10&rdquo;.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;clientwithin&nbsp;</b><i>subnet</i></p>

<p style="margin-left:17%;">This option is obsolete and
will be removed. Do not use this option anymore.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;clientprotoport&nbsp;</b><i>protocol/port</i></p>

<p style="margin-left:17%;">specify the Port Selectors
(filters) to be used on this connection. The general form is
<i>protocol</i>/<i>port</i>. This is most commonly used to
limit the connection to L2TP traffic only by specifying a
value of <i>17/1701</i> for UDP (protocol 17) and port 1701.
The notation <i>17/%any</i> can be used to allow all UDP
traffic and is needed for L2TP connections with Windows XP
machines before Service Pack 2.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;srcip&nbsp;</b><i>ip&minus;address</i></p>

<p style="margin-left:17%;">the IP address for this host to
use when transmitting a packet to the remote IPsec gateway
itself. This option is used to make the gateway itself use
its internal IP, which is part of the
<b>&minus;&minus;client subnet</b>. Otherwise it will use
its nearest IP address, which is its public IP address,
which is not part of the subnet&minus;subnet IPsec tunnel,
and would therefor not get encrypted.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;xauthserver</b></p>

<p style="margin-left:17%;">this end is an xauthserver. It
will lookup the xauth user name and password and verify this
before allowing the connection to get established.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;xauthclient</b></p>

<p style="margin-left:17%;">this end is an xauthclient. To
bring this connection up with the
<b>&minus;&minus;initiate</b> also requires the client to
specify <b>&minus;&minus;xauthuser username</b> and
<b>&minus;&minus;xauthpass password</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;xauthuser</b></p>

<p style="margin-left:17%;">The username for the xauth
authentication.This option is normally passed along by
<b>ipsec_auto</b>(8) when an xauth connection is started
using <i>ipsec auto &minus;&minus;up conn</i></p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;xauthpass</b></p>

<p style="margin-left:17%;">The password for the xauth
authentication. This option is normally passed along by
<b>ipsec_auto</b>(8) when an xauth connection is started
using <i>ipsec auto &minus;&minus;up conn</i></p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;modecfgserver</b></p>

<p style="margin-left:17%;">this end is an Mode Config
server</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;modecfgclient</b></p>

<p style="margin-left:17%;">this end is an Mode Config
client</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;modecfgdns1</b></p>

<p style="margin-left:17%;">The IP address of the first DNS
server to pass along to the ModeConfig Client</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;modecfgdns2</b></p>

<p style="margin-left:17%;">The IP address of the second
DNS server to pass along to the ModeConfig Client</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;dnskeyondemand</b></p>

<p style="margin-left:17%;">specifies that when an RSA
public key is needed to authenticate this host, and it isn't
already known, fetch it from DNS.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;updown&nbsp;</b><i>updown</i></p>

<p style="margin-left:17%;">specifies an external shell
command to be run whenever <b>pluto</b> brings up or down a
connection. The script is used to build a shell command, so
it may contain positional parameters, but ought not to have
punctuation that would cause the resulting command to be
ill&minus;formed. The default is <i>ipsec _updown</i>. Pluto
passes a dozen environment variables to the script about the
connection involved.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;to</b></p>

<p style="margin-left:17%;">separates the specification of
the left and right ends of the connection. Pluto tries to
decide whether it is <i>left</i> or <i>right</i> based on
the information provided on both sides of this option.</p>

<p style="margin-left:11%; margin-top: 1em">The potential
connection description also specifies characteristics of
rekeying and security.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;psk</b></p>

<p style="margin-left:17%;">Propose and allow preshared
secret authentication for IKE peers. This authentication
requires that each side use the same secret. May be combined
with <b>&minus;&minus;rsasig</b>; at least one must be
specified.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;rsasig</b></p>

<p style="margin-left:17%;">Propose and allow RSA
signatures for authentication of IKE peers. This
authentication requires that each side have have a private
key of its own and know the public key of its peer. May be
combined with <b>&minus;&minus;psk</b>; at least one must be
specified.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;encrypt</b></p>

<p style="margin-left:17%;">All proposed or accepted IPsec
SAs will include non&minus;null ESP. The actual choices of
transforms are wired into <b>pluto</b>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;authenticate</b></p>

<p style="margin-left:17%;">All proposed IPsec SAs will
include AH. All accepted IPsec SAs will include AH or ESP
with authentication. The actual choices of transforms are
wired into <b>pluto</b>. Note that this has nothing to do
with IKE authentication.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;compress</b></p>

<p style="margin-left:17%;">All proposed IPsec SAs will
include IPCOMP (compression). This will be ignored if KLIPS
is not configured with IPCOMP support.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;tunnel</b></p>

<p style="margin-left:17%;">the IPsec SA should use
tunneling. Implicit if the SA is for clients. Must only be
used with <b>&minus;&minus;authenticate</b> or
<b>&minus;&minus;encrypt</b>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;ipv4</b></p>

<p style="margin-left:17%;">The host addresses will be
interpreted as IPv4 addresses. This is the default. Note
that for a connection, all host addresses must be of the
same Address Family (IPv4 and IPv6 use different Address
Families).</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;ipv6</b></p>

<p style="margin-left:17%;">The host addresses (including
nexthop) will be interpreted as IPv6 addresses. Note that
for a connection, all host addresses must be of the same
Address Family (IPv4 and IPv6 use different Address
Families).</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;tunnelipv4</b></p>

<p style="margin-left:17%;">The client addresses will be
interpreted as IPv4 addresses. The default is to match what
the host will be. This does not imply
<b>&minus;&minus;tunnel</b> so the flag can be safely used
when no tunnel is actually specified. Note that for a
connection, all tunnel addresses must be of the same Address
Family.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;tunnelipv6</b></p>

<p style="margin-left:17%;">The client addresses will be
interpreted as IPv6 addresses. The default is to match what
the host will be. This does not imply
<b>&minus;&minus;tunnel</b> so the flag can be safely used
when no tunnel is actually specified. Note that for a
connection, all tunnel addresses must be of the same Address
Family.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;pfs</b></p>

<p style="margin-left:17%;">There should be Perfect Forward
Secrecy &minus; new keying material will be generated for
each IPsec SA rather than being derived from the ISAKMP SA
keying material. Since the group to be used cannot be
negotiated (a dubious feature of the standard), <b>pluto</b>
will propose the same group that was used during Phase 1. We
don't implement a stronger form of PFS which would require
that the ISAKMP SA be deleted after the IPSEC SA is
negotiated.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;pfsgroup&nbsp;</b><i>modp&minus;group</i></p>

<p style="margin-left:17%;">Sets the Diffie&minus;Hellman
group used. Currently the following values are supported:
<b>modp1024</b> (DHgroup 2), <b>modp1536</b> (DHgroup 5),
<b>modp2048</b> (DHgroup 14), <b>modp3072</b> (DHgroup 15),
<b>modp4096</b> (DHgroup 16), <b>modp6144</b> (DHgroup 17),
and <b>modp8192</b> (DHgroup 18). It is possible to support
the weak and broken <b>modp768</b> (DHgroup 1), but this
requires a manual recompile and is strongly discouraged.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;disablearrivalcheck</b></p>

<p style="margin-left:17%;">If the connection is a tunnel,
allow packets arriving through the tunnel to have any source
and destination addresses.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;esp&nbsp;</b><i>esp&minus;algos</i></p>

<p style="margin-left:17%;">ESP encryption/authentication
algorithm to be used for the connection (phase2 aka IPsec
SA). The options must be suitable as a value of
<b>ipsec_spi</b>(8). See <b>ipsec.conf</b>(5) for a detailed
description of the algorithm format.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;aggrmode</b></p>

<p style="margin-left:17%;">This tunnel is using aggressive
mode ISAKMP negotiation. The default is main mode.
Aggressive mode is less secure than main mode as it reveals
your identity to an eavesdropper, but is needed to support
road warriors using PSK keys or to interoperate with other
buggy implementations insisting on using aggressive
mode.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;modecfgpull</b></p>

<p style="margin-left:17%;">Pull the Mode Config network
information from the peer.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;dpddelay&nbsp;</b><i>seconds</i></p>

<p style="margin-left:17%;">Set the delay (in seconds)
between Dead Peer Detection (RFC 3706) keepalives
(R_U_THERE, R_U_THERE_ACK) that are sent for this connection
(default 30 seconds).</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;timeout&nbsp;</b><i>seconds</i></p>

<p style="margin-left:17%;">Set the length of time (in
seconds) we will idle without hearing either an R_U_THERE
poll from our peer, or an R_U_THERE_ACK reply. After this
period has elapsed with no response and no traffic, we will
declare the peer dead, and remove the SA (default 120
seconds).</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;dpdaction&nbsp;</b><i>action</i></p>

<p style="margin-left:17%;">When a DPD enabled peer is
declared dead, what action should be taken.
<b>hold</b>(default) means the eroute will be put into
<i>%hold</i> status, while <b>clear</b>means the eroute and
SA with both be cleared. Clear is really only useful on the
server of a Road Warrior config. The action <b>restart</b>
is used on tunnels that need to be permanently up, and have
static IP addresses. The action <b>restart_by_peer</b>has
been obsoleted and its functionality has been moved into the
restart action.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;forceencaps</b></p>

<p style="margin-left:17%;">In some cases, for example when
ESP packets are filtered or when a broken IPsec peer does
not properly recognise NAT, it can be useful to force
RFC&minus;3948 encapsulation using this option. It causes
pluto lie and tell the remote peer that RFC&minus;3948
encapsulation (ESP in UDP port 4500 packets) is
required.</p>

<p style="margin-left:11%; margin-top: 1em">If none of the
<b>&minus;&minus;encrypt</b>,
<b>&minus;&minus;authenticate</b>,
<b>&minus;&minus;compress</b>, or <b>&minus;&minus;pfs</b>
flags is given, the initiating the connection will only
build an ISAKMP SA. For such a connection, client subnets
have no meaning and must not be specified.</p>

<p style="margin-left:11%; margin-top: 1em">Apart from
initiating directly using the <b>&minus;&minus;initiate</b>
option, a tunnel can be loaded with a different policy</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;initiateontraffic</b></p>

<p style="margin-left:17%;">Only initiate the connection
when we have traffic to send over the connection</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;pass</b></p>

<p style="margin-left:17%;">Allow <b>unencrypted</b>
traffic to flow until the tunnel is initiated.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;drop</b></p>

<p style="margin-left:17%;">Drop unencrypted traffic
silently.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;reject</b></p>

<p style="margin-left:17%;">Drop unencrypted traffic
silently, but send an ICMP message notifying the other
end.</p>

<p style="margin-left:11%; margin-top: 1em">These options
need to be documented</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;failnone</b></p>

<p style="margin-left:17%;">to be documented</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;failpass</b></p>

<p style="margin-left:17%;">to be documented</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;faildrop</b></p>

<p style="margin-left:17%;">to be documented</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;failreject</b></p>

<p style="margin-left:17%;">to be documented</p>

<p style="margin-left:11%; margin-top: 1em"><b>pluto</b>
supports various X.509 Certificate related options.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;utc</b></p>

<p style="margin-left:17%;">display all times in UTC.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;listall</b></p>

<p style="margin-left:17%;">lists all of the X.509
information known to pluto.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;listpubkeys</b></p>

<p style="margin-left:17%;">list all the public keys that
have been successfully loaded.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;listcerts</b></p>

<p style="margin-left:17%;">list all the X.509 certificates
that are currently loaded.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;checkpubkeys</b></p>

<p style="margin-left:17%;">list all the loaded X.509
certificates which are about to expire or have been
expired.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;listcacerts</b></p>

<p style="margin-left:17%;">list all the Certificate
Authority X.509 certificates that are currently loaded.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;listcrls</b></p>

<p style="margin-left:17%;">list all the loaded
<i>Certificate Revocation Lists</i> (CRLs)</p>

<p style="margin-left:11%; margin-top: 1em">The
corresponding options <b>&minus;&minus;rereadsecrets</b>,
<b>&minus;&minus;rereadall</b>, and
<b>&minus;&minus;rereadcrls</b> options reread this
information from their respective sources, and purge all the
online obtained information. The option
<b>&minus;&minus;listevents</b> lists all pending CRL fetch
commands.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;ikelifetime&nbsp;</b><i>seconds</i></p>

<p style="margin-left:17%;">how long <b>pluto</b> will
propose that an ISAKMP SA be allowed to live. The default is
3600 (one hour) and the maximum is 86400 (1 day). This
option will not affect what is accepted. <b>pluto</b> will
reject proposals that exceed the maximum.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;ipseclifetime&nbsp;</b><i>seconds</i></p>

<p style="margin-left:17%;">how long <b>pluto</b> will
propose that an IPsec SA be allowed to live. The default is
28800 (eight hours) and the maximum is 86400 (one day). This
option will not affect what is accepted. <b>pluto</b> will
reject proposals that exceed the maximum.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;rekeymargin&nbsp;</b><i>seconds</i></p>

<p style="margin-left:17%;">how long before an SA's
expiration should <b>pluto</b> try to negotiate a
replacement SA. This will only happen if <b>pluto</b> was
the initiator. The default is 540 (nine minutes).</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;rekeyfuzz&nbsp;</b><i>percentage</i></p>

<p style="margin-left:17%;">maximum size of random
component to add to rekeymargin, expressed as a percentage
of rekeymargin. <b>pluto</b> will select a delay uniformly
distributed within this range. By default, the percentage
will be 100. If greater determinism is desired, specify 0.
It may be appropriate for the percentage to be much larger
than 100.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;keyingtries&nbsp;</b><i>count</i></p>

<p style="margin-left:17%;">how many times <b>pluto</b>
should try to negotiate an SA, either for the first time or
for rekeying. A value of 0 is interpreted as a very large
number: never give up. The default is three.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;dontrekey</b></p>

<p style="margin-left:17%;">A misnomer. Only rekey a
connection if we were the Initiator and there was recent
traffic on the existing connection. This applies to Phase 1
and Phase 2. This is currently the only automatic way for a
connection to terminate. It may be useful with Road Warrior
or Opportunistic connections. Since SA lifetime negotiation
is take&minus;it&minus;or&minus;leave it, a Responder
normally uses the shorter of the negotiated or the
configured lifetime. This only works because if the lifetime
is shorter than negotiated, the Responder will rekey in time
so that everything works. This interacts badly with
<b>&minus;&minus;dontrekey</b>. In this case, the Responder
will end up rekeying to rectify a shortfall in an IPsec SA
lifetime; for an ISAKMP SA, the Responder will accept the
negotiated lifetime.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;delete</b></p>

<p style="margin-left:17%;">when used in the connection
form, it causes any previous connection with this name to be
deleted before this one is added. Unlike a normal delete, no
diagnostic is produced if there was no previous connection
to delete. Any routing in place for the connection is
undone.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;delete</b>,
<b>&minus;&minus;name&nbsp;</b><i>connection&minus;name</i></p>

<p style="margin-left:17%;">The delete form deletes a named
connection description and any SAs established or
negotiations initiated using this connection. Any routing in
place for the connection is undone.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;deletestate&nbsp;</b><i>state&minus;number</i></p>

<p style="margin-left:17%;">The deletestate form deletes
the state object with the specified serial number. This is
useful for selectively deleting instances of
connections.</p>

<p style="margin-left:11%; margin-top: 1em">The route form
of the <b>whack</b> command tells <b>pluto</b> to set up
routing for a connection. Although like a traditional route,
it uses an ipsec device as a virtual interface. Once routing
is set up, no packets will be sent &ldquo;in the
clear&rdquo; to the peer's client specified in the
connection. A TRAP shunt eroute will be installed; if
outbound traffic is caught, Pluto will initiate the
connection. An explicit <b>whack</b> route is not always
needed: if it hasn't been done when an IPsec SA is being
installed, one will be automatically attempted.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;route</b>,
<b>&minus;&minus;name&nbsp;</b><i>connection&minus;name</i></p>

<p style="margin-left:17%;">When a routing is attempted for
a connection, there must not already be a routing for a
different connection with the same subnet but different
interface or destination, or if there is, it must not be
being used by an IPsec SA. Otherwise the attempt will
fail.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;unroute</b>,
<b>&minus;&minus;name&nbsp;</b><i>connection&minus;name</i></p>

<p style="margin-left:17%;">The unroute form of the
<b>whack</b> command tells <b>pluto</b> to undo a routing.
<b>pluto</b> will refuse if an IPsec SA is using the
connection. If another connection is sharing the same
routing, it will be left in place. Without a routing,
packets will be sent without encryption or
authentication.</p>

<p style="margin-left:11%; margin-top: 1em">The initiate
form tells <b>pluto</b> to initiate a negotiation with
another <b>pluto</b> (or other IKE daemon) according to the
named connection. Initiation requires a route that
<b>&minus;&minus;route</b> would provide; if none is in
place at the time an IPsec SA is being installed,
<b>pluto</b> attempts to set one up.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;initiate</b>,
<b>&minus;&minus;name&nbsp;</b><i>connection&minus;name</i>,
<b>&minus;&minus;asynchronous</b></p>

<p style="margin-left:17%;">The initiate form of the
<b>whack</b> command will relay back from <b>pluto</b>
status information via the UNIX domain socket (unless
&minus;&minus;asynchronous is specified). The status
information is meant to look a bit like that from
<b>FTP</b>. Currently <b>whack</b> simply copies this to
stderr. When the request is finished (eg. the SAs are
established or <b>pluto</b> gives up), <b>pluto</b> closes
the channel, causing <b>whack</b> to terminate.</p>

<p style="margin-left:11%; margin-top: 1em">The
opportunistic initiate form is mainly used for
debugging.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;tunnelipv4</b>,
<b>&minus;&minus;tunnelipv6</b>,
<b>&minus;&minus;oppohere&nbsp;</b><i>ip&minus;address</i>,
<b>&minus;&minus;oppothere&nbsp;</b><i>ip&minus;address</i></p>

<p style="margin-left:17%;">This will cause <b>pluto</b> to
attempt to opportunistically initiate a connection from here
to the there, even if a previous attempt had been made. The
whack log will show the progress of this attempt.</p>

<p style="margin-left:11%; margin-top: 1em">Ending an
connection</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;terminate</b>,
<b>&minus;&minus;name&nbsp;</b><i>connection&minus;name</i></p>

<p style="margin-left:17%;">the terminate form tells
<i>pluto</i> to delete any SAs that use the specified
connection and to stop any negotiations in process. it does
not prevent new negotiations from starting (the delete form
has this effect).</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;crash&nbsp;</b><i>ip&minus;address</i></p>

<p style="margin-left:17%;">If the remote peer has crashed,
and therefor did not notify us, we keep sending encrypted
traffic, and rejecting all plaintext (non&minus;IKE) traffic
from that remote peer. The <b>&minus;&minus;crash</b> brings
our end down as well for all the known connections to the
specified <i>ip&minus;address</i></p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;whackrecord</b><i>filename</i>,
<b>&minus;&minus;whackstoprecord</b></p>

<p style="margin-left:17%;">this causes <i>pluto</i>to open
the given filename for write, and record each of the
messages received from whack or addconn. This continues
until the whackstoprecord option is used. This option may
not be combined with any other command. The start/stop
commands are not recorded themselves. These files are
usually used to create input files for unit tests,
particularly for complex setups where policies may in fact
overlap.</p>

<p style="margin-left:17%; margin-top: 1em">The format of
the file consists of a line starting with
#!pluto&minus;whack and the date that the file was started,
as well as the hostname, and a linefeed. What follows are
binary format records consisting of a 32&minus;bit record
length in bytes, (including the length record itself), a
64&minus;bit timestamp, and then the literal contents of the
whack message that was received. All integers are in host
format. In order to unambigously determine the host order,
the first record is an empty record that contains only the
current WHACK_MAGIC value. This record is 16 bytes long.</p>


<p style="margin-left:11%; margin-top: 1em"><i>ip&minus;address</i></p>

<p style="margin-left:17%;">If the remote peer has crashed,
and therefor did not notify us, we keep sending encrypted
traffic, and rejecting all plaintext (non&minus;IKE) traffic
from that remote peer. The <b>&minus;&minus;crash</b> brings
our end down as well for all the known connections to the
specified <i>ip&minus;address</i></p>

<p style="margin-left:11%; margin-top: 1em">The public key
for informs <b>pluto</b> of the RSA public key for a
potential peer. Private keys must be kept secret, so they
are kept in <b>ipsec.secrets</b>(5).</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;keyid&nbsp;</b><i>id</i></p>

<p style="margin-left:17%;">specififies the identity of the
peer for which a public key should be used. Its form is
identical to the identity in the connection. If no public
key is specified, <b>pluto</b> attempts to find KEY records
from DNS for the id (if a FQDN) or through reverse lookup
(if an IP address). Note that there several interesting ways
in which this is not secure.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;addkey</b></p>

<p style="margin-left:17%;">specifies that the new key is
added to the collection; otherwise the new key replaces any
old ones.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;pubkeyrsa&nbsp;</b><i>key</i></p>

<p style="margin-left:17%;">specifies the value of the RSA
public key. It is a sequence of bytes as described in RFC
2537 &ldquo;RSA/MD5 KEYs and SIGs in the Domain Name System
(DNS)&rdquo;. It is denoted in a way suitable for
<b>ipsec_ttodata</b>(3). For example, a base 64 numeral
starts with 0s.</p>

<p style="margin-left:11%; margin-top: 1em">The listen form
tells <b>pluto</b> to start listening for IKE requests on
its public interfaces. To avoid race conditions, it is
normal to load the appropriate connections into <b>pluto</b>
before allowing it to listen. If <b>pluto</b> isn't
listening, it is pointless to initiate negotiations, so it
will refuse requests to do so. Whenever the listen form is
used, <b>pluto</b> looks for public interfaces and will
notice when new ones have been added and when old ones have
been removed. This is also the trigger for <b>pluto</b> to
read the <i>ipsec.secrets</i> file. So listen may useful
more than once.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;listen</b></p>

<p style="margin-left:17%;">start listening for IKE traffic
on public interfaces.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;unlisten</b></p>

<p style="margin-left:17%;">stop listening for IKE traffic
on public interfaces.</p>

<p style="margin-left:11%; margin-top: 1em">The busy and
relax options tells <b>pluto</b> to explicitly activate or
deactivate additional DDoS protection. Normally, these
meassures are automatically activate or deactivate based on
the number of states inside pluto. One of these DDoS
protection methods is to active IKEv2 DCOOKIEs to defend
against spoofed IKE packets.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;busy</b></p>

<p style="margin-left:17%;">place pluto into busy mode and
activate anti&minus;DDoS measures.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;relax</b></p>

<p style="margin-left:17%;">pull pluto out of busy mode and
deactivate anti&minus;DDoS measures.</p>

<p style="margin-left:11%; margin-top: 1em">The status form
will display information about the internal state of
<b>pluto</b>: information about each potential connection,
about each state object, and about each shunt that
<b>pluto</b> is managing without an associated
connection.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;status</b></p>

<p style="margin-left:11%; margin-top: 1em">The
trafficstatus form will display the xauth username, add_time
and the total in and out bytes of the IPsec SA's.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;trafficstatus</b></p>

<p style="margin-left:11%; margin-top: 1em">The shutdown
form is the proper way to shut down <b>pluto</b>. It will
tear down the SAs on this machine that <b>pluto</b> has
negotiated. It does not inform its peers, so the SAs on
their machines remain.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;shutdown</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>Examples</b>
<br>
It would be normal to start <b>pluto</b> in one of the
system initialization scripts. It needs to be run by the
superuser. Generally, no arguments are needed. To run in
manually, the superuser can simply type
&nbsp;&nbsp;&nbsp;</p>

<p style="margin-left:11%; margin-top: 1em">ipsec pluto</p>

<p style="margin-left:11%; margin-top: 1em">The command
will immediately return, but a <b>pluto</b> process will be
left running, waiting for requests from <b>whack</b> or a
peer.</p>

<p style="margin-left:11%; margin-top: 1em">Using
<b>whack</b>, several potential connections would be
described: &nbsp;&nbsp;&nbsp;</p>

<p style="margin-left:11%; margin-top: 1em">ipsec whack
&minus;&minus;name&nbsp;silly
&minus;&minus;host&nbsp;127.0.0.1 &minus;&minus;to
&minus;&minus;host&nbsp;127.0.0.2
&minus;&minus;ikelifetime&nbsp;900
&minus;&minus;ipseclifetime&nbsp;800
&minus;&minus;keyingtries&nbsp;3</p>

<p style="margin-left:11%; margin-top: 1em">Since this
silly connection description specifies neither encryption,
authentication, nor tunneling, it could only be used to
establish an ISAKMP SA. &nbsp;&nbsp;&nbsp;</p>

<p style="margin-left:11%; margin-top: 1em">ipsec whack
&minus;&minus;name&nbsp;conn_name
&minus;&minus;host&nbsp;10.0.0.1
&minus;&minus;client&nbsp;10.0.1.0/24 &minus;&minus;to
&minus;&minus;host&nbsp;10.0.0.2
&minus;&minus;client&nbsp;10.0.2.0/24
&minus;&minus;encrypt</p>

<p style="margin-left:11%; margin-top: 1em">This is
something that must be done on both sides. If the other side
is <b>pluto</b>, the same <b>whack</b> command could be used
on it (the command syntax is designed to not distinguish
which end is ours).</p>

<p style="margin-left:11%; margin-top: 1em">Now that the
connections are specified, <b>pluto</b> is ready to handle
requests and replies via the public interfaces. We must tell
it to discover those interfaces and start accepting messages
from peers: &nbsp;&nbsp;&nbsp;</p>

<p style="margin-left:11%; margin-top: 1em">ipsec whack
&minus;&minus;listen</p>

<p style="margin-left:11%; margin-top: 1em">If we don't
immediately wish to bring up a secure connection between the
two clients, we might wish to prevent insecure traffic. The
routing form asks <b>pluto</b> to cause the packets sent
from our client to the peer's client to be routed through
the ipsec0 device; if there is no SA, they will be
discarded: &nbsp;&nbsp;&nbsp;</p>

<p style="margin-left:11%; margin-top: 1em">ipsec whack
&minus;&minus;route conn_name</p>

<p style="margin-left:11%; margin-top: 1em">Finally, we are
ready to get <b>pluto</b> to initiate negotiation for an
IPsec SA (and implicitly, an ISAKMP SA):
&nbsp;&nbsp;&nbsp;</p>

<p style="margin-left:11%; margin-top: 1em">ipsec whack
&minus;&minus;initiate&nbsp;&minus;&minus;name&nbsp;conn_name</p>

<p style="margin-left:11%; margin-top: 1em">A small log of
interesting events will appear on standard output (other
logging is sent to syslog).</p>

<p style="margin-left:11%; margin-top: 1em"><b>whack</b>
can also be used to terminate <b>pluto</b> cleanly, tearing
down all SAs that it has negotiated. &nbsp;&nbsp;&nbsp;</p>

<p style="margin-left:11%; margin-top: 1em">ipsec whack
&minus;&minus;shutdown</p>

<p style="margin-left:11%; margin-top: 1em">Notification of
any IPSEC SA deletion, but not ISAKMP SA deletion is sent to
the peer. Unfortunately, such Notification is not reliable.
Furthermore, <b>pluto</b> itself ignores Notifications.</p>

<p style="margin-left:11%; margin-top: 1em"><b>XAUTH</b>
<br>
If <b>pluto</b> needs additional authentication, such as
defined by the XAUTH specifications, then it may ask
<b>whack</b> to prompt the operator for username or
passwords. Typically, these will be entered interactively. A
GUI that wraps around <b>whack</b> may look for the 041
(username) or 040 (password) prompts, and display them to
the user.</p>

<p style="margin-left:11%; margin-top: 1em">For testing
purposes, the options
<b>&minus;&minus;xauthuser&nbsp;</b><i>user</i><b>&minus;&minus;xauthpass&nbsp;</b><i>pass</i>
may be be given prior to the
<b>&minus;&minus;initiate&nbsp;</b> to provide responses to
the username and password prompts.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The updown
command</b> <br>
Whenever <b>pluto</b> brings a connection up or down, it
invokes the updown command. This command is specified using
the <b>&minus;&minus;updown</b> option. This allows for
customized control over routing and firewall
manipulation.</p>

<p style="margin-left:11%; margin-top: 1em">The updown is
invoked for five different operations. Each of these
operations can be for our client subnet or for our host
itself.</p>


<p style="margin-left:11%; margin-top: 1em"><b>prepare&minus;host</b>
or <b>prepare&minus;client</b></p>

<p style="margin-left:17%;">is run before bringing up a new
connection if no other connection with the same clients is
up. Generally, this is useful for deleting a route that
might have been set up before <b>pluto</b> was run or
perhaps by some agent not known to <b>pluto</b>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>route&minus;host</b>
or <b>route&minus;client</b></p>

<p style="margin-left:17%;">is run when bringing up a
connection for a new peer client subnet (even if
<b>prepare&minus;host</b> or <b>prepare&minus;client</b> was
run). The command should install a suitable route. Routing
decisions are based only on the destination (peer's client)
subnet address, unlike eroutes which discriminate based on
source too.</p>


<p style="margin-left:11%; margin-top: 1em"><b>unroute&minus;host</b>
or <b>unroute&minus;client</b></p>

<p style="margin-left:17%;">is run when bringing down the
last connection for a particular peer client subnet. It
should undo what the <b>route&minus;host</b> or
<b>route&minus;client</b> did.</p>


<p style="margin-left:11%; margin-top: 1em"><b>up&minus;host</b>
or <b>up&minus;client</b></p>

<p style="margin-left:17%;">is run when bringing up a
tunnel eroute with a pair of client subnets that does not
already have a tunnel eroute. This command should install
firewall rules as appropriate. It is generally a good idea
to allow IKE messages (UDP port 500) travel between the
hosts.</p>


<p style="margin-left:11%; margin-top: 1em"><b>down&minus;host</b>
or <b>down&minus;client</b></p>

<p style="margin-left:17%;">is run when bringing down the
eroute for a pair of client subnets. This command should
delete firewall rules as appropriate. Note that there may
remain some inbound IPsec SAs with these client subnets.</p>

<p style="margin-left:11%; margin-top: 1em">The script is
passed a large number of environment variables to specify
what needs to be done.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_VERSION</b></p>

<p style="margin-left:17%;">indicates what version of this
interface is being used. This document describes version
1.1. This is upwardly compatible with version 1.0.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_VERB</b></p>

<p style="margin-left:17%;">specifies the name of the
operation to be performed (<b>prepare&minus;host</b>,r
<b>prepare&minus;client</b>, <b>up&minus;host</b>,
<b>up&minus;client</b>, <b>down&minus;host</b>, or
<b>down&minus;client</b>). If the address family for
security gateway to security gateway communications is IPv6,
then a suffix of &minus;v6 is added to the verb.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_CONNECTION</b></p>

<p style="margin-left:17%;">is the name of the connection
for which we are routing.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_NEXT_HOP</b></p>

<p style="margin-left:17%;">is the next hop to which
packets bound for the peer must be sent.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_INTERFACE</b></p>

<p style="margin-left:17%;">is the name of the ipsec
interface to be used.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_ME</b></p>

<p style="margin-left:17%;">is the IP address of our
host.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_MY_CLIENT</b></p>

<p style="margin-left:17%;">is the IP address / count of
our client subnet. If the client is just the host, this will
be the host's own IP address / max (where max is 32 for IPv4
and 128 for IPv6).</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_MY_CLIENT_NET</b></p>

<p style="margin-left:17%;">is the IP address of our client
net. If the client is just the host, this will be the host's
own IP address.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_MY_CLIENT_MASK</b></p>

<p style="margin-left:17%;">is the mask for our client net.
If the client is just the host, this will be
255.255.255.255.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_PEER</b></p>

<p style="margin-left:17%;">is the IP address of our
peer.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_PEER_CLIENT</b></p>

<p style="margin-left:17%;">is the IP address / count of
the peer's client subnet. If the client is just the peer,
this will be the peer's own IP address / max (where max is
32 for IPv4 and 128 for IPv6).</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_PEER_CLIENT_NET</b></p>

<p style="margin-left:17%;">is the IP address of the peer's
client net. If the client is just the peer, this will be the
peer's own IP address.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_PEER_CLIENT_MASK</b></p>

<p style="margin-left:17%;">is the mask for the peer's
client net. If the client is just the peer, this will be
255.255.255.255.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_MY_PROTOCOL</b></p>

<p style="margin-left:17%;">lists the protocols allowed
over this IPsec SA.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_PEER_PROTOCOL</b></p>

<p style="margin-left:17%;">lists the protocols the peer
allows over this IPsec SA.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_MY_PORT</b></p>

<p style="margin-left:17%;">lists the ports allowed over
this IPsec SA.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_PEER_PORT</b></p>

<p style="margin-left:17%;">lists the ports the peer allows
over this IPsec SA.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_MY_ID</b></p>

<p style="margin-left:17%;">lists our id.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_PEER_ID</b></p>

<p style="margin-left:17%;">Dlists our peer's id.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PLUTO_PEER_CA</b></p>

<p style="margin-left:17%;">lists the peer's CA.</p>

<p style="margin-left:11%; margin-top: 1em">All output sent
by the script to stderr or stdout is logged. The script
should return an exit status of 0 if and only if it
succeeds.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Pluto</b>
waits for the script to finish and will not do any other
processing while it is waiting. The script may assume that
<b>pluto</b> will not change anything while the script runs.
The script should avoid doing anything that takes much time
and it should not issue any command that requires processing
by <b>pluto</b>. Either of these activities could be
performed by a background subprocess of the script.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Rekeying</b>
<br>
When an SA that was initiated by <b>pluto</b> has only a bit
of lifetime left, <b>pluto</b> will initiate the creation of
a new SA. This applies to ISAKMP and IPsec SAs. The rekeying
will be initiated when the SA's remaining lifetime is less
than the rekeymargin plus a random percentage, between 0 and
rekeyfuzz, of the rekeymargin.</p>

<p style="margin-left:11%; margin-top: 1em">Similarly, when
an SA that was initiated by the peer has only a bit of
lifetime left, <b>pluto</b> will try to initiate the
creation of a replacement. To give preference to the
initiator, this rekeying will only be initiated when the
SA's remaining lifetime is half of rekeymargin. If rekeying
is done by the responder, the roles will be reversed: the
responder for the old SA will be the initiator for the
replacement. The former initiator might also initiate
rekeying, so there may be redundant SAs created. To avoid
these complications, make sure that rekeymargin is
generous.</p>

<p style="margin-left:11%; margin-top: 1em">One risk of
having the former responder initiate is that perhaps none of
its proposals is acceptable to the former initiator (they
have not been used in a successful negotiation). To reduce
the chances of this happening, and to prevent loss of
security, the policy settings are taken from the old SA
(this is the case even if the former initiator is
initiating). These may be stricter than those of the
connection.</p>

<p style="margin-left:11%; margin-top: 1em"><b>pluto</b>
will not rekey an SA if that SA is not the most recent of
its type (IPsec or ISAKMP) for its potential connection.
This avoids creating redundant SAs.</p>

<p style="margin-left:11%; margin-top: 1em">The random
component in the rekeying time (rekeyfuzz) is intended to
make certain pathological patterns of rekeying unstable. If
both sides decide to rekey at the same time, twice as many
SAs as necessary are created. This could become a stable
pattern without the randomness.</p>

<p style="margin-left:11%; margin-top: 1em">Another more
important case occurs when a security gateway has SAs with
many other security gateways. Each of these connections
might need to be rekeyed at the same time. This would cause
a high peek requirement for resources (network bandwidth,
CPU time, entropy for random numbers). The rekeyfuzz can be
used to stagger the rekeying times.</p>

<p style="margin-left:11%; margin-top: 1em">Once a new set
of SAs has been negotiated, <b>pluto</b> will never send
traffic on a superseded one. Traffic will be accepted on an
old SA until it expires.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Selecting a
Connection When Responding: Road Warrior Support</b> <br>
When <b>pluto</b> receives an initial Main Mode message, it
needs to decide which connection this message is for. It
picks based solely on the source and destination IP
addresses of the message. There might be several connections
with suitable IP addresses, in which case one of them is
arbitrarily chosen. (The ISAKMP SA proposal contained in the
message could be taken into account, but it is not.)</p>

<p style="margin-left:11%; margin-top: 1em">The ISAKMP SA
is negotiated before the parties pass further identifying
information, so all ISAKMP SA characteristics specified in
the connection description should be the same for every
connection with the same two host IP addresses. At the
moment, the only characteristic that might differ is
authentication method.</p>

<p style="margin-left:11%; margin-top: 1em">Up to this
point, all configuring has presumed that the IP addresses
are known to all parties ahead of time. This will not work
when either end is mobile (or assigned a dynamic IP address
for other reasons). We call this situation &ldquo;Road
Warrior&rdquo;. It is fairly tricky and has some important
limitations, most of which are features of the IKE
protocol.</p>

<p style="margin-left:11%; margin-top: 1em">Only the
initiator may be mobile: the initiator may have an IP number
unknown to the responder. When the responder doesn't
recognize the IP address on the first Main Mode packet, it
looks for a connection with itself as one end and
<b>%any</b> as the other. If it cannot find one, it refuses
to negotiate. If it does find one, it creates a temporary
connection that is a duplicate except with the <b>%any</b>
replaced by the source IP address from the packet; if there
was no identity specified for the peer, the new IP address
will be used.</p>

<p style="margin-left:11%; margin-top: 1em">When
<b>pluto</b> is using one of these temporary connections and
needs to find the preshared secret or RSA private key in
<i>ipsec.secrets</i>, and and the connection specified no
identity for the peer, <b>%any</b> is used as its identity.
After all, the real IP address was apparently unknown to the
configuration, so it is unreasonable to require that it be
used in this table.</p>

<p style="margin-left:11%; margin-top: 1em">Part way into
the Phase 1 (Main Mode) negotiation using one of these
temporary connection descriptions, <b>pluto</b> will be
receive an Identity Payload. At this point, <b>pluto</b>
checks for a more appropriate connection, one with an
identity for the peer that matches the payload but which
would use the same keys so&minus;far used for
authentication. If it finds one, it will switch to using
this better connection (or a temporary derived from this, if
it has <b>%any</b> for the peer's IP address). It may even
turn out that no connection matches the newly discovered
identity, including the current connection; if so,
<b>pluto</b> terminates negotiation.</p>

<p style="margin-left:11%; margin-top: 1em">Unfortunately,
if preshared secret authentication is being used, the
Identity Payload is encrypted using this secret, so the
secret must be selected by the responder without knowing
this payload. This limits there to being at most one
preshared secret for all Road Warrior systems connecting to
a host. RSA Signature authentications does not require that
the responder know how to select the initiator's public key
until after the initiator's Identity Payload is decoded
(using the responder's private key, so that must be
preselected).</p>

<p style="margin-left:11%; margin-top: 1em">When
<b>pluto</b> is responding to a Quick Mode negotiation via
one of these temporary connection descriptions, it may well
find that the subnets specified by the initiator don't match
those in the temporary connection description. If so, it
will look for a connection with matching subnets, its own
host address, a peer address of <b>%any</b> and matching
identities. If it finds one, a new temporary connection is
derived from this one and used for the Quick Mode
negotiation of IPsec SAs. If it does not find one,
<b>pluto</b> terminates negotiation.</p>

<p style="margin-left:11%; margin-top: 1em">Be sure to
specify an appropriate nexthop for the responder to send a
message to the initiator: <b>pluto</b> has no way of
guessing it (if forwarding isn't required, use an explicit
<b>%direct</b> as the nexthop and the IP address of the
initiator will be filled in; the obsolete notation 0.0.0.0
is still accepted).</p>

<p style="margin-left:11%; margin-top: 1em"><b>pluto</b>
has no special provision for the initiator side. The current
(possibly dynamic) IP address and nexthop must be used in
defining connections. These must be properly configured each
time the initiator's IP address changes. <b>pluto</b> has no
mechanism to do this automatically.</p>

<p style="margin-left:11%; margin-top: 1em">Although we
call this Road Warrior Support, it could also be used to
support encrypted connections with anonymous initiators. The
responder's organization could announce the preshared secret
that would be used with unrecognized initiators and let
anyone connect. Of course the initiator's identity would not
be authenticated.</p>

<p style="margin-left:11%; margin-top: 1em">If any Road
Warrior connections are supported, <b>pluto</b> cannot
reject an exchange initiated by an unknown host until it has
determined that the secret is not shared or the signature is
invalid. This must await the third Main Mode message from
the initiator. If no Road Warrior connection is supported,
the first message from an unknown source would be rejected.
This has implications for ease of debugging configurations
and for denial of service attacks.</p>

<p style="margin-left:11%; margin-top: 1em">Although a Road
Warrior connection must be initiated by the mobile side, the
other side can and will rekey using the temporary connection
it has created. If the Road Warrior wishes to be able to
disconnect, it is probably wise to set
<b>&minus;&minus;keyingtries</b> to 1 in the connection on
the non&minus;mobile side to prevent it trying to rekey the
connection. Unfortunately, there is no mechanism to unroute
the connection automatically.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Debugging
<br>
pluto</b> accepts several optional arguments, useful mostly
for debugging. Except for <b>&minus;&minus;interface</b>,
each should appear at most once.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;interface</b>
<i>interfacename</i></p>

<p style="margin-left:17%;">specifies that the named real
public network interface should be considered. The interface
name specified should not be <b>ipsec</b><i>N</i>. If the
option doesn't appear, all interfaces are considered. To
specify several interfaces, use the option once for each.
One use of this option is to specify which interface should
be used when two or more share the same IP address.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;ikeport</b>
<i>port&minus;number</i></p>

<p style="margin-left:17%;">changes the UDP port that
<b>pluto</b> will use (default, specified by IANA: 500)</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;ctlbase</b>
<i>path</i></p>

<p style="margin-left:17%;">basename for control files.
<i>path</i>.ctl is the socket through which <b>whack</b>
communicates with <b>pluto</b>. <i>path</i>.pid is the
lockfile to prevent multiple <b>pluto</b> instances. The
default is /var/run/pluto/pluto).</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;secretsfile</b>
<i>file</i></p>

<p style="margin-left:17%;">specifies the file for
authentication secrets (default: /etc/ipsec.secrets). This
name is subject to &ldquo;globbing&rdquo; as in
<b>sh</b>(1), so every file with a matching name is
processed. Quoting is generally needed to prevent the shell
from doing the globbing.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;adns</b>
<i>path to adns</i></p>

<p style="margin-left:17%;">specifies where to find
<b>pluto</b>'s helper program for asynchronous DNS lookup.
<b>pluto</b> can be built to use <b>_pluto_adns</b>. By
default, <b>pluto</b> will look for the program in
<b>$IPSEC_DIR</b> (if that environment variable is defined)
or, failing that, in the same directory as <b>pluto</b>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;nofork</b></p>

<p style="margin-left:17%;">disable &ldquo;daemon
fork&rdquo; (default is to fork). In addition, after the
lock file and control socket are created, print the line
&ldquo;Pluto initialized&rdquo; to standard out.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;uniqueids</b></p>

<p style="margin-left:17%;">if this option has been
selected, whenever a new ISAKMP SA is established, any
connection with the same Peer ID but a different Peer IP
address is unoriented (causing all its SAs to be deleted).
This helps clean up dangling SAs when a connection is lost
and then regained at another IP address.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;force&minus;busy</b></p>

<p style="margin-left:17%;">if this option has been
selected, pluto will be forced to be &quot;busy&quot;. In
this state, which happens when there is a Denial of Service
attack, will force pluto to use cookies before accepting new
incoming IKE packets. Cookies are send and required in ikev1
Aggressive Mode and in ikev2. This option is mostly used for
testing purposes, but can be selected by paranoid
administrators as well.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;stderrlog</b></p>

<p style="margin-left:17%;">log goes to standard out
{default is to use <b>syslogd</b>(8))</p>

<p style="margin-left:11%; margin-top: 1em">For example</p>

<p style="margin-left:11%; margin-top: 1em">pluto
&minus;&minus;secretsfile&nbsp;ipsec.secrets
&minus;&minus;ctlbase&nbsp;pluto.base
&minus;&minus;ikeport&nbsp;8500 &minus;&minus;nofork
&minus;&minus;use&minus;nostack &minus;&minus;stderrlog</p>

<p style="margin-left:11%; margin-top: 1em">lets one test
<b>pluto</b> without using the superuser account.</p>

<p style="margin-left:11%; margin-top: 1em"><b>pluto</b> is
willing to produce a prodigious amount of debugging
information. There are several classes of debugging output,
and <b>pluto</b> may be directed to produce a selection of
them. All lines of debugging output are prefixed with
&ldquo;|&nbsp;&rdquo; to distinguish them from error
messages.</p>

<p style="margin-left:11%; margin-top: 1em">When
<b>pluto</b> is invoked, it may be given arguments to
specify which classes to output. The current options
are:</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;none</b></p>

<p style="margin-left:17%;">disable all debugging</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;all</b></p>

<p style="margin-left:17%;">enable all debugging</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;raw</b></p>

<p style="margin-left:17%;">show the raw bytes of
messages</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;crypt</b></p>

<p style="margin-left:17%;">show the encryption and
decryption of messages</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;parsing</b></p>

<p style="margin-left:17%;">show the structure of input
messages</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;emitting</b></p>

<p style="margin-left:17%;">show the structure of output
messages</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;control</b></p>

<p style="margin-left:17%;">show <b>pluto</b>'s decision
making</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;controlmore</b></p>

<p style="margin-left:17%;">show even more detailed
<b>pluto</b> decision making</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;lifecycle</b></p>

<p style="margin-left:17%;">[this option is temporary] log
more detail of lifecycle of SAs</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;klips</b></p>

<p style="margin-left:17%;">show <b>pluto</b>'s interaction
with <b>KLIPS</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;pfkey</b></p>

<p style="margin-left:17%;">show <b>pluto</b>'s
<b>PFKEY</b>interface communication</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;dns</b></p>

<p style="margin-left:17%;">show <b>pluto</b>'s interaction
with <b>DNS</b> for KEY and TXT records</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;dpd</b></p>

<p style="margin-left:17%;">show <b>pluto</b>'s <b>Dead
Peer Detection</b> handling</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;natt</b></p>

<p style="margin-left:17%;">show <b>pluto</b>'s <b>NAT
Traversal</b> handling</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;oppo</b></p>

<p style="margin-left:17%;">show why <b>pluto</b> didn't
find a suitable DNS TXT record to authorize opportunistic
initiation</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;oppoinfo</b></p>

<p style="margin-left:17%;">log when connections are
initiated due to acquires from the kernel. This is often
useful to know, but can be extremely chatty on a busy
system.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;whackwatch</b></p>

<p style="margin-left:17%;">if set, causes pluto not to
release the whack &minus;&minus;initiate channel until the
SA is completely up. This will cause the requestor to
possibly wait forever while pluto unsuccessfully negotiates.
Used often in test cases.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug&minus;private</b></p>

<p style="margin-left:17%;">allow debugging output with
private keys.</p>

<p style="margin-left:11%; margin-top: 1em">The debug form
of the <b>whack</b> command will change the selection in a
running <b>pluto</b>. If a connection name is specified, the
flags are added whenever <b>pluto</b> has identified that it
is dealing with that connection. Unfortunately, this is
often part way into the operation being observed.</p>

<p style="margin-left:11%; margin-top: 1em">For example, to
start a <b>pluto</b> with a display of the structure of
input and output:</p>

<p style="margin-left:11%; margin-top: 1em">pluto
&minus;&minus;debug&minus;emitting
&minus;&minus;debug&minus;parsing</p>

<p style="margin-left:11%; margin-top: 1em">To later change
this <b>pluto</b> to only display raw bytes:</p>

<p style="margin-left:11%; margin-top: 1em">whack
&minus;&minus;debug&minus;raw</p>

<p style="margin-left:11%; margin-top: 1em">Hint: ISAKMP
SAs are often kept alive by IKEs even after the IPsec SA is
established. This allows future IPsec SA's to be negotiated
directly. If one of the IKEs is restarted, the other may try
to use the ISAKMP SA but the new IKE won't know about it.
This can lead to much confusion. <b>pluto</b> is not yet
smart enough to get out of such a mess.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Pluto's
Behaviour When Things Go Wrong</b> <br>
When <b>pluto</b> doesn't understand or accept a message, it
just ignores the message. It is not yet capable of
communicating the problem to the other IKE daemon (in the
future it might use Notifications to accomplish this in many
cases). It does log a diagnostic.</p>

<p style="margin-left:11%; margin-top: 1em">When
<b>pluto</b> gets no response from a message, it resends the
same message (a message will be sent at most three times).
This is appropriate: UDP is unreliable.</p>

<p style="margin-left:11%; margin-top: 1em">When pluto gets
a message that it has already seen, there are many cases
when it notices and discards it. This too is appropriate for
UDP.</p>

<p style="margin-left:11%; margin-top: 1em">Combine these
three rules, and you can explain many apparently mysterious
behaviours. In a <b>pluto</b> log, retrying isn't usually
the interesting event. The critical thing is either earlier
(<b>pluto</b> got a message which it didn't like and so
ignored, so it was still awaiting an acceptable message and
got impatient) or on the other system (<b>pluto</b> didn't
send a reply because it wasn't happy with the previous
message).</p>

<p style="margin-left:11%; margin-top: 1em"><b>Notes</b>
<br>
If <b>pluto</b> is compiled without &minus;DKLIPS, it
negotiates Security Associations but never ask the kernel to
put them in place and never makes routing changes. This
allows <b>pluto</b> to be tested on systems without
<b>KLIPS</b>, but makes it rather useless.</p>

<p style="margin-left:11%; margin-top: 1em">Each IPsec SA
is assigned an SPI, a 32&minus;bit number used to refer to
the SA. The IKE protocol lets the destination of the SA
choose the SPI. The range 0 to 0xFF is reserved for IANA.
<b>Pluto</b> also avoids choosing an SPI in the range 0x100
to 0xFFF, leaving these SPIs free for manual keying.
Remember that the peer, if not <b>pluto</b>, may well chose
SPIs in this range.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Policies</b>
<br>
This catalogue of policies may be of use when trying to
configure <b>Pluto</b> and another IKE implementation to
interoperate.</p>

<p style="margin-left:11%; margin-top: 1em">In Phase 1,
only Main Mode is supported. We are not sure that Aggressive
Mode is secure. For one thing, it does not support identity
protection. It may allow more severe Denial Of Service
attacks.</p>

<p style="margin-left:11%; margin-top: 1em">No
Informational Exchanges are supported. These are optional
and since their delivery is not assured, they must not
matter. It is the case that some IKE implementations won't
interoperate without Informational Exchanges, but we feel
they are broken.</p>

<p style="margin-left:11%; margin-top: 1em">No
Informational Payloads are supported. These are optional,
but useful. It is of concern that these payloads are not
authenticated in Phase 1, nor in those Phase 2 messages
authenticated with HASH(3).</p>

<p style="margin-left:11%; margin-top: 1em">&bull;</p>

<p style="margin-left:17%;">Diffie Hellman Groups MODP 1024
and MODP 1536 (2 and 5) are supported. Group MODP768 (1) is
not supported because it is too weak.</p>

<p style="margin-left:11%; margin-top: 1em">&bull;</p>

<p style="margin-left:17%;">Host authentication can be done
by RSA Signatures or Pre&minus;Shared Secrets.</p>

<p style="margin-left:11%; margin-top: 1em">&bull;</p>

<p style="margin-left:17%;">3DES CBC (Cypher Block Chaining
mode) is the only encryption supported, both for ISAKMP SAs
and IPSEC SAs.</p>

<p style="margin-left:11%; margin-top: 1em">&bull;</p>

<p style="margin-left:17%;">MD5 and SHA1 hashing are
supported for packet authentication in both kinds of
SAs.</p>

<p style="margin-left:11%; margin-top: 1em">&bull;</p>

<p style="margin-left:17%;">The ESP, AH, or AH plus ESP are
supported. If, and only if, AH and ESP are combined, the ESP
need not have its own authentication component. The
selection is controlled by the &minus;&minus;encrypt and
&minus;&minus;authenticate flags.</p>

<p style="margin-left:11%; margin-top: 1em">&bull;</p>

<p style="margin-left:17%;">Each of these may be combined
with IPCOMP Deflate compression, but only if the potential
connection specifies compression and only if KLIPS is
configured with IPCOMP support.</p>

<p style="margin-left:11%; margin-top: 1em">&bull;</p>

<p style="margin-left:17%;">The IPSEC SAs may be tunnel or
transport mode, where appropriate. The &minus;&minus;tunnel
flag controls this when <b>pluto</b> is initiating.</p>

<p style="margin-left:11%; margin-top: 1em">&bull;</p>

<p style="margin-left:17%;">When responding to an ISAKMP SA
proposal, the maximum acceptable lifetime is eight hours.
The default is one hour. There is no minimum. The
&minus;&minus;ikelifetime flag controls this when
<b>pluto</b> is initiating.</p>

<p style="margin-left:11%; margin-top: 1em">&bull;</p>

<p style="margin-left:17%;">When responding to an IPSEC SA
proposal, the maximum acceptable lifetime is one day. The
default is eight hours. There is no minimum. The
&minus;&minus;ipseclifetime flag controls this when
<b>pluto</b> is initiating.</p>

<p style="margin-left:11%; margin-top: 1em">&bull;</p>

<p style="margin-left:17%;">PFS is acceptable, and will be
proposed if the &minus;&minus;pfs flag was specified. The DH
group proposed will be the same as negotiated for Phase
1.</p>

<h2>SIGNALS
<a name="SIGNALS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Pluto</b>
responds to <b>SIGHUP</b> by issuing a suggestion that
&lsquo;&lsquo;<b>whack</b> &minus;&minus;listen'' might have
been intended.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Pluto</b>
exits when it receives <b>SIGTERM</b>.</p>

<h2>EXIT STATUS
<a name="EXIT STATUS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>pluto</b>
normally forks a daemon process, so the exit status is
normally a very preliminary result.</p>

<p style="margin-left:11%; margin-top: 1em">0</p>

<p style="margin-left:17%;">means that all is OK so
far.</p>

<p style="margin-left:11%; margin-top: 1em">1</p>

<p style="margin-left:17%;">means that something was
wrong.</p>

<p style="margin-left:11%; margin-top: 1em">10</p>

<p style="margin-left:17%;">means that the lock file
already exists.</p>

<p style="margin-left:11%; margin-top: 1em">If <b>whack</b>
detects a problem, it will return an exit status of 1. If it
received progress messages from <b>pluto</b>, it returns as
status the value of the numeric prefix from the last such
message that was not a message sent to syslog or a comment
(but the prefix for success is treated as 0). Otherwise, the
exit status is 0.</p>

<h2>FILES
<a name="FILES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">/var/run/pluto/pluto.pid/var/run/pluto/pluto.ctl/etc/ipsec.secrets/dev/urandom</p>

<h2>ENVIRONMENT
<a name="ENVIRONMENT"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><i>IPSEC_EXECDIRIPSECmyidPLUTO_CORE_DIR</i></p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The rest of the
Libreswan distribution, in particular <b>ipsec</b>(8).</p>


<p style="margin-left:11%; margin-top: 1em"><b>ipsec_auto</b>(8)
is designed to make using <b>pluto</b> more pleasant. Use
it!</p>


<p style="margin-left:11%; margin-top: 1em"><b>ipsec.secrets</b>(5)
describes the format of the secrets file.</p>


<p style="margin-left:11%; margin-top: 1em"><b>ipsec_atoaddr</b>(3),
part of the Libreswan distribution, describes the forms that
IP addresses may take. <b>ipsec_atosubnet</b>(3), part of
the Libreswan distribution, describes the forms that subnet
specifications.</p>

<p style="margin-left:11%; margin-top: 1em">For more
information on IPsec, the mailing list, and the relevant
documents, see:</p>


<p style="margin-left:11%; margin-top: 1em"><b><font color="#0000FF">https://datatracker.ietf.org/wg/ipsecme/charter/</font></b></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">At
the time of writing, the most relevant IETF RFCs
are:</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">RFC5996
Internet Key Exchange Protocol Version 2 (IKEv2)</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">The
Libreswan web site &lt;https://libreswan.org&gt; and the
mailing lists described there.</font></p>

<h2>HISTORY
<a name="HISTORY"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><font color="#000000">This
code is released under the GPL terms. See the accompanying
files COPYING and CREDITS.* for more details.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">This
software was originally written for the FreeS/WAN project
&lt;</font><b><font color="#0000FF">http://www.freeswan.org</font></b><font color="#000000">&gt;,
founded by John Gilmore and managed by Hugh Daniel. It was
written by Angelos D. Keromytis (angelos@dsl.cis.upenn.edu),
in May/June 1997, in Athens, Greece. Thanks go to John
Ioannidis for his help.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">FreeS/WAN's
Pluto was developed/maintained from 2000&minus;2004 by D.
Hugh Redelmeier (hugh@mimosa.com), in Canada. The
regulations of Greece and Canada allow the code to be freely
redistributable.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">Richard
Guy Briggs &lt;rgb@conscoop.ottawa.on.ca&gt; was the main
resource on KLIPS development</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">IKE
version 2 was initially written by Michael Richardson,
Antony Antony and Paul Wouters. It has since been extended
by Avesh Agarwal, D. Hugh Redelmeier, Matt Rogers, Antony
Antony and Paul Wouters.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">From
2003 onwards, the code was developed and maintained by The
Openswan Project by developers worldwide and distributed
from The Netherland and Finland. Due to a lawsuit by
Xelerance over the trademark, the project was forced to
rename itself and the code to The Libreswan Project in
2012.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">See
further: the CHANGES/CREDITS files in the main directory and
the doc/ directory.</font></p>

<h2>BUGS
<a name="BUGS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><font color="#000000">Please
see
&lt;</font><b><font color="#0000FF">https://bugs.libreswan.org</font></b><font color="#000000">&gt;
for a list of currently known bugs and missing
features.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">Bugs
should be reported to the
&lt;swan&minus;dev@lists.libreswan.org&gt; mailing
list.</font></p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Paul
Wouters</b></font></p>


<p style="margin-left:17%;"><font color="#000000">placeholder
to suppress warning</font></p>
<hr>
</body>
</html>
