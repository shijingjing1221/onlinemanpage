<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 20:50:04 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>ALSABAT</title>

</head>
<body>

<h1 align="center">ALSABAT</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#RETURN VALUE">RETURN VALUE</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#BUGS">BUGS</a><br>
<a href="#AUTHOR">AUTHOR</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">alsabat &minus;
command&minus;line sound tester for ALSA sound card
driver</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>alsabat</b>
[<i>flags</i>]</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>ALSABAT(ALSA
Basic Audio Tester)</b> is a simple command&minus;line
utility intended to help automate audio driver and sound
server testing with little human interaction. ALSABAT can be
used to test audio quality, stress test features and test
audio before and after PM state changes.</p>


<p style="margin-left:11%; margin-top: 1em">ALSABAT&rsquo;s
design is relatively simple. ALSABAT plays an audio stream
and captures the same stream in either a digital or analog
loop back. It then compares the captured stream using a FFT
to the original to determine if the test case passes or
fails.</p>

<p style="margin-left:11%; margin-top: 1em">ALSABAT can
either run wholly on the target machine being tested
(standalone mode) or can run as a client/server mode where
by alsabat client runs on the target and runs as a server on
a separate tester machine. The client/server mode still
requires some manual interaction for synchronization, but
this is actively being developed for future releases.</p>

<p style="margin-left:11%; margin-top: 1em">The hardware
testing configuration may require the use of an analog cable
connecting target to tester machines or a cable to create an
analog loopback if no loopback mode is not available on the
sound hardware that is being tested. An analog loopback
cable can be used to connect the &quot;line in&quot; to
&quot;line out&quot; jacks to create a loopback. If only
headphone and mic jacks (or combo jack) are available then
the following simple circuit can be used to create an analog
loopback :-</p>


<p style="margin-left:11%; margin-top: 1em">https://source.android.com/devices/audio/loopback.html</p>

<p style="margin-left:11%; margin-top: 1em">If tinyalsa is
installed in system, user can choose tinyalsa as backend lib
of alsabat, with configure option
&quot;--enable-alsabat-backend-tiny&quot;.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><i>&minus;h,
&minus;&minus;help</i></p>

<p style="margin-left:22%;">Help: show syntax.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><i>&minus;D</i></p></td>
<td width="8%"></td>
<td width="60%">


<p>Select sound card to be tested by name.</p></td>
<td width="18%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><i>&minus;P</i></p></td>
<td width="8%"></td>
<td width="60%">


<p>Select the playback PCM device.</p></td>
<td width="18%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><i>&minus;C</i></p></td>
<td width="8%"></td>
<td width="60%">


<p>Select the capture PCM device.</p></td>
<td width="18%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><i>&minus;f</i></p></td>
<td width="8%"></td>
<td width="60%">


<p>Sample format</p></td>
<td width="18%">
</td></tr>
</table>

<p style="margin-left:22%;">Recognized sample formats are:
U8 S16_LE S24_3LE S32_LE <br>
Some of these may not be available on selected hardware <br>
The available format shortcuts are: <br>
&minus;f cd (16 bit little endian, 44100, stereo) [&minus;f
S16_LE &minus;c2 &minus;r44100] <br>
&minus;f dat (16 bit little endian, 48000, stereo) [&minus;f
S16_LE &minus;c2 &minus;r48000] <br>
If no format is given S16_LE is used.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em"><i>&minus;c</i></p></td>
<td width="8%"></td>
<td width="78%">


<p style="margin-top: 1em">The number of channels. The
default is one channel. Valid values at the moment are 1 or
2.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><i>&minus;r</i></p></td>
<td width="8%"></td>
<td width="78%">


<p>Sampling rate in Hertz. The default rate is 44100 Hertz.
Valid values depends on hardware support.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><i>&minus;n</i></p></td>
<td width="8%"></td>
<td width="78%">


<p>Duration of generated signal. The value could be either
of the two forms:</p></td></tr>
</table>

<p style="margin-left:22%;">1. Decimal integer, means
number of frames; <br>
2. Floating point with suffix &rsquo;s&rsquo;, means number
of seconds. <br>
The default is 2 seconds.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em"><i>&minus;k</i></p></td>
<td width="8%"></td>
<td width="41%">


<p style="margin-top: 1em">Sigma k value for analysis.</p></td>
<td width="37%">
</td></tr>
</table>

<p style="margin-left:22%;">The analysis function reads
data from WAV file, run FFT against the data to get
magnitude of frequency vectors, and then calculates the
average value and standard deviation of frequency vectors.
After that, we define a threshold: <br>
threshold = k * standard_deviation + mean_value <br>
Frequencies with amplitude larger than threshold will be
recognized as a peak, and the frequency with largest peak
value will be recognized as a detected frequency. <br>
ALSABAT then compares the detected frequency to target
frequency, to decide if the detecting passes or fails. <br>
The default value is 3.0.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em"><i>&minus;F</i></p></td>
<td width="8%"></td>
<td width="78%">


<p style="margin-top: 1em">Target frequency for signal
generation and analysis, in Hertz. The default is 997.0
Hertz. Valid range is (DC_THRESHOLD, 40% * Sampling
rate).</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><i>&minus;p</i></p></td>
<td width="8%"></td>
<td width="78%">


<p>Total number of periods to play or capture.</p></td></tr>
</table>

<p style="margin-left:11%;"><i>&minus;&minus;log=#</i></p>

<p style="margin-left:22%;">Write stderr and stdout output
to this log file.</p>


<p style="margin-left:11%;"><i>&minus;&minus;file=#</i></p>

<p style="margin-left:22%;">Input WAV file for
playback.</p>


<p style="margin-left:11%;"><i>&minus;&minus;saveplay=#</i></p>

<p style="margin-left:22%;">Target WAV file to save capture
test content.</p>

<p style="margin-left:11%;"><i>&minus;&minus;local</i></p>

<p style="margin-left:22%;">Internal loopback mode.
Playback, capture and analysis internal to ALSABAT only.
This is intended for developers to test new ALSABAT features
as no audio is routed outside of ALSABAT.</p>


<p style="margin-left:11%;"><i>&minus;&minus;standalone</i></p>

<p style="margin-left:22%;">Add support for standalone mode
where ALSABAT will run on a different machine to the one
being tested. In standalone mode, the sound data can be
generated, playback and captured just like in normal mode,
but will not be analyzed. The ALSABAT being built without
libfftw3 support is always in standalone mode. The ALSABAT
in normal mode can also bypass data analysis using option
&quot;--standalone&quot;.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>alsabat
&minus;P plughw:0,0 &minus;C plughw:0,0 &minus;c 2 &minus;f
S32_LE &minus;F 250</b></p>

<p style="margin-left:22%;">Generate and play a sine wave
of 250 Hertz with 2 channel and S32_LE format, and then
capture and analyze.</p>

<p style="margin-left:11%;"><b>alsabat &minus;P plughw:0,0
&minus;C plughw:0,0 &minus;&minus;file 500Hz.wav</b></p>

<p style="margin-left:22%;">Play the RIFF WAV file
&quot;500Hz.wav&quot; which contains 500 Hertz waveform LPCM
data, and then capture and analyze.</p>

<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">On success,
returns 0. <br>
If no peak be detected, returns -1001; <br>
If only DC be detected, returns -1002; <br>
If peak frequency does not match with the target frequency,
returns -1003.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>aplay(1)</b></p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Currently only
support RIFF WAV format with PCM data. Please report any
bugs to the alsa-devel mailing list.</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>alsabat</b>
is by Liam Girdwood &lt;liam.r.girdwood@linux.intel.com&gt;,
Bernard Gautier &lt;bernard.gautier@intel.com&gt; and Han Lu
&lt;han.lu@intel.com&gt;. This document is by Liam Girdwood
&lt;liam.r.girdwood@linux.intel.com&gt; and Han Lu
&lt;han.lu@intel.com&gt;.</p>
<hr>
</body>
</html>
