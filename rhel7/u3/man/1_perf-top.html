<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 22:06:25 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>PERF&minus;TOP</title>

</head>
<body>

<h1 align="center">PERF&minus;TOP</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#INTERACTIVE PROMPTING KEYS">INTERACTIVE PROMPTING KEYS</a><br>
<a href="#OVERHEAD CALCULATION">OVERHEAD CALCULATION</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">perf-top
&minus; System profiling tool.</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><i>perf top</i>
[&minus;e &lt;EVENT&gt; | &minus;&minus;event=EVENT]
[&lt;options&gt;]</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This command
generates and displays a performance counter profile in real
time.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">&minus;a,
&minus;&minus;all&minus;cpus</p>

<p style="margin-left:17%;">System&minus;wide collection.
(default)</p>

<p style="margin-left:11%; margin-top: 1em">&minus;c
&lt;count&gt;, &minus;&minus;count=&lt;count&gt;</p>

<p style="margin-left:17%;">Event period to sample.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;C
&lt;cpu&minus;list&gt;, &minus;&minus;cpu=&lt;cpu&gt;</p>

<p style="margin-left:17%;">Monitor only on the list of
CPUs provided. Multiple CPUs can be provided as a
comma&minus;separated list with no space: 0,1. Ranges of
CPUs are specified with &minus;: 0&minus;2. Default is to
monitor all CPUS.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;d
&lt;seconds&gt;, &minus;&minus;delay=&lt;seconds&gt;</p>

<p style="margin-left:17%;">Number of seconds to delay
between refreshes.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;e
&lt;event&gt;, &minus;&minus;event=&lt;event&gt;</p>

<p style="margin-left:17%;">Select the PMU event. Selection
can be a symbolic event name (use <i>perf list</i> to list
all events) or a raw PMU event (eventsel+umask) in the form
of rNNN where NNN is a hexadecimal event descriptor.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;E
&lt;entries&gt;, &minus;&minus;entries=&lt;entries&gt;</p>

<p style="margin-left:17%;">Display this many
functions.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;f
&lt;count&gt;,
&minus;&minus;count&minus;filter=&lt;count&gt;</p>

<p style="margin-left:17%;">Only display functions with
more events than this.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;group</p>

<p style="margin-left:17%;">Put the counters into a counter
group.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;F
&lt;freq&gt;, &minus;&minus;freq=&lt;freq&gt;</p>

<p style="margin-left:17%;">Profile at this frequency.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;i,
&minus;&minus;inherit</p>

<p style="margin-left:17%;">Child tasks do not inherit
counters.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;k
&lt;path&gt;, &minus;&minus;vmlinux=&lt;path&gt;</p>

<p style="margin-left:17%;">Path to vmlinux. Required for
annotation functionality.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;m
&lt;pages&gt;,
&minus;&minus;mmap&minus;pages=&lt;pages&gt;</p>

<p style="margin-left:17%;">Number of mmap data pages (must
be a power of two) or size specification with appended unit
character &minus; B/K/M/G. The size is rounded up to have
nearest pages power of two value.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;p
&lt;pid&gt;, &minus;&minus;pid=&lt;pid&gt;</p>

<p style="margin-left:17%;">Profile events on existing
Process ID (comma separated list).</p>

<p style="margin-left:11%; margin-top: 1em">&minus;t
&lt;tid&gt;, &minus;&minus;tid=&lt;tid&gt;</p>

<p style="margin-left:17%;">Profile events on existing
thread ID (comma separated list).</p>

<p style="margin-left:11%; margin-top: 1em">&minus;u,
&minus;&minus;uid=</p>

<p style="margin-left:17%;">Record events in threads owned
by uid. Name or number.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;r
&lt;priority&gt;,
&minus;&minus;realtime=&lt;priority&gt;</p>

<p style="margin-left:17%;">Collect data with this RT
SCHED_FIFO priority.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;sym&minus;annotate=&lt;symbol&gt;</p>

<p style="margin-left:17%;">Annotate this symbol.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;K,
&minus;&minus;hide_kernel_symbols</p>

<p style="margin-left:17%;">Hide kernel symbols.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;U,
&minus;&minus;hide_user_symbols</p>

<p style="margin-left:17%;">Hide user symbols.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;demangle&minus;kernel</p>

<p style="margin-left:17%;">Demangle kernel symbols.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;D,
&minus;&minus;dump&minus;symtab</p>

<p style="margin-left:17%;">Dump the symbol table used for
profiling.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;v,
&minus;&minus;verbose</p>

<p style="margin-left:17%;">Be more verbose (show counter
open errors, etc).</p>

<p style="margin-left:11%; margin-top: 1em">&minus;z,
&minus;&minus;zero</p>

<p style="margin-left:17%;">Zero history across display
updates.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;s,
&minus;&minus;sort</p>

<p style="margin-left:17%;">Sort by key(s): pid, comm, dso,
symbol, parent, srcline, weight, local_weight, abort, in_tx,
transaction, overhead, sample, period. Please see
description of &minus;&minus;sort in the perf&minus;report
man page.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;fields=</p>

<p style="margin-left:17%;">Specify output field &minus;
multiple keys can be specified in CSV format. Following
fields are available: overhead, overhead_sys, overhead_us,
overhead_children, sample and period. Also it can contain
any sort key(s).</p>

<p style="margin-left:23%; margin-top: 1em">By default,
every sort keys not specified in &minus;&minus;field will be
appended <br>
automatically.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;n,
&minus;&minus;show&minus;nr&minus;samples</p>

<p style="margin-left:17%;">Show a column with the number
of samples.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;show&minus;total&minus;period</p>

<p style="margin-left:17%;">Show a column with the sum of
periods.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;dsos</p>

<p style="margin-left:17%;">Only consider symbols in these
dsos. This option will affect the percentage of the overhead
column. See &minus;&minus;percentage for more info.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;comms</p>

<p style="margin-left:17%;">Only consider symbols in these
comms. This option will affect the percentage of the
overhead column. See &minus;&minus;percentage for more
info.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;symbols</p>

<p style="margin-left:17%;">Only consider these symbols.
This option will affect the percentage of the overhead
column. See &minus;&minus;percentage for more info.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;M,
&minus;&minus;disassembler&minus;style=</p>

<p style="margin-left:17%;">Set disassembler style for
objdump.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;source</p>

<p style="margin-left:17%;">Interleave source code with
assembly code. Enabled by default, disable with
&minus;&minus;no&minus;source.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;asm&minus;raw</p>

<p style="margin-left:17%;">Show raw instruction encoding
of assembly instructions.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;g</p>

<p style="margin-left:17%;">Enables call&minus;graph (stack
chain/backtrace) recording.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;call&minus;graph
[mode,type,min[,limit],order[,key][,branch]]</p>

<p style="margin-left:17%;">Setup and enable
call&minus;graph (stack chain/backtrace) recording, implies
&minus;g. See &minus;&minus;call&minus;graph section in
perf&minus;record and perf&minus;report man pages for
details.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;children</p>

<p style="margin-left:17%;">Accumulate callchain of
children to parent entry so that then can show up in the
output. The output will have a new &quot;Children&quot;
column and will be sorted on the data. It requires
&minus;g/&minus;&minus;call&minus;graph option enabled. See
the &lsquo;overhead calculation&rsquo; section for more
details.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;max&minus;stack</p>

<p style="margin-left:17%;">Set the stack depth limit when
parsing the callchain, anything beyond the specified depth
will be ignored. This is a trade&minus;off between
information loss and faster processing especially for
workloads that can have a very long callchain stack.</p>

<p style="margin-left:23%; margin-top: 1em">Default:
127</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;ignore&minus;callees=&lt;regex&gt;</p>

<p style="margin-left:17%;">Ignore callees of the
function(s) matching the given regex. This has the effect of
collecting the callers of each such function into one place
in the call&minus;graph tree.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;percent&minus;limit</p>

<p style="margin-left:17%;">Do not show entries which have
an overhead under that percent. (Default: 0).</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;percentage</p>

<p style="margin-left:17%;">Determine how to display the
overhead percentage of filtered entries. Filters can be
applied by &minus;&minus;comms, &minus;&minus;dsos and/or
&minus;&minus;symbols options and Zoom operations on the TUI
(thread, dso, etc).</p>


<p style="margin-left:23%; margin-top: 1em">&quot;relative&quot;
means it's relative to filtered entries only so that the
<br>
sum of shown entries will be always 100%.
&quot;absolute&quot; means it retains <br>
the original value before and after the filter is
applied.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;w,
&minus;&minus;column&minus;widths=&lt;width[,width...]&gt;</p>

<p style="margin-left:17%;">Force each column width to the
provided list, for large terminal readability. 0 means no
limit (default behavior).</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;proc&minus;map&minus;timeout</p>

<p style="margin-left:17%;">When processing
pre&minus;existing threads /proc/XXX/mmap, it may take a
long time, because the file may be huge. A time out is
needed in such cases. This option sets the time out limit.
The default value is 500 ms.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;b,
&minus;&minus;branch&minus;any</p>

<p style="margin-left:17%;">Enable taken branch stack
sampling. Any type of taken branch may be sampled. This is a
shortcut for &minus;&minus;branch&minus;filter any. See
&minus;&minus;branch&minus;filter for more infos.</p>

<p style="margin-left:11%; margin-top: 1em">&minus;j,
&minus;&minus;branch&minus;filter</p>

<p style="margin-left:17%;">Enable taken branch stack
sampling. Each sample captures a series of consecutive taken
branches. The number of branches captured with each sample
depends on the underlying hardware, the type of branches of
interest, and the executed code. It is possible to select
the types of branches captured by enabling filters. For a
full list of modifiers please see the perf record
manpage.</p>

<p style="margin-left:23%; margin-top: 1em">The option
requires at least one branch type among any, any_call,
any_ret, ind_call, cond. <br>
The privilege levels may be omitted, in which case, the
privilege levels of the associated <br>
event are applied to the branch filter. Both kernel (k) and
hypervisor (hv) privilege <br>
levels are subject to permissions. When sampling on multiple
events, branch stack sampling <br>
is enabled for all the sampling events. The sampled branch
type is the same for all events. <br>
The various filters must be specified as a comma separated
list: &minus;&minus;branch&minus;filter any_ret,u,k <br>
Note that this feature may not be available on all
processors.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;raw&minus;trace</p>

<p style="margin-left:17%;">When displaying traceevent
output, do not use print fmt or plugins.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;hierarchy</p>

<p style="margin-left:17%;">Enable hierarchy output.</p>

<h2>INTERACTIVE PROMPTING KEYS
<a name="INTERACTIVE PROMPTING KEYS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">[d]</p>

<p style="margin-left:17%;">Display refresh delay.</p>

<p style="margin-left:11%; margin-top: 1em">[e]</p>

<p style="margin-left:17%;">Number of entries to
display.</p>

<p style="margin-left:11%; margin-top: 1em">[E]</p>

<p style="margin-left:17%;">Event to display when multiple
counters are active.</p>

<p style="margin-left:11%; margin-top: 1em">[f]</p>

<p style="margin-left:17%;">Profile display filter (&gt;=
hit count).</p>

<p style="margin-left:11%; margin-top: 1em">[F]</p>

<p style="margin-left:17%;">Annotation display filter
(&gt;= % of total).</p>

<p style="margin-left:11%; margin-top: 1em">[s]</p>

<p style="margin-left:17%;">Annotate symbol.</p>

<p style="margin-left:11%; margin-top: 1em">[S]</p>

<p style="margin-left:17%;">Stop annotation, return to full
profile display.</p>

<p style="margin-left:11%; margin-top: 1em">[z]</p>

<p style="margin-left:17%;">Toggle event count zeroing
across display updates.</p>

<p style="margin-left:11%; margin-top: 1em">[qQ]</p>

<p style="margin-left:17%;">Quit.</p>

<p style="margin-left:11%; margin-top: 1em">Pressing any
unmapped key displays a menu, and prompts for input.</p>

<h2>OVERHEAD CALCULATION
<a name="OVERHEAD CALCULATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The overhead
can be shown in two columns as <i>Children</i> and
<i>Self</i> when perf collects callchains. The <i>self</i>
overhead is simply calculated by adding all period values of
the entry &minus; usually a function (symbol). This is the
value that perf shows traditionally and sum of all the
<i>self</i> overhead values should be 100%.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>children</i> overhead is calculated by adding all period
values of the child functions so that it can show the total
overhead of the higher level functions even if they
don&rsquo;t directly execute much. <i>Children</i> here
means functions that are called from another (parent)
function.</p>

<p style="margin-left:11%; margin-top: 1em">It might be
confusing that the sum of all the <i>children</i> overhead
values exceeds 100% since each of them is already an
accumulation of <i>self</i> overhead of its child functions.
But with this enabled, users can find which function has the
most overhead even if samples are spread over the
children.</p>

<p style="margin-left:11%; margin-top: 1em">Consider the
following example; there are three functions like below.</p>

<p style="margin-left:17%; margin-top: 1em">.ft C <br>
void foo(void) { <br>
/* do something */ <br>
}</p>

<p style="margin-left:17%; margin-top: 1em">void bar(void)
{ <br>
/* do something */ <br>
foo(); <br>
}</p>

<p style="margin-left:17%; margin-top: 1em">int main(void)
{ <br>
bar() <br>
return 0; <br>
} <br>
.ft</p>

<p style="margin-left:11%; margin-top: 1em">In this case
<i>foo</i> is a child of <i>bar</i>, and <i>bar</i> is an
immediate child of <i>main</i> so <i>foo</i> also is a child
of <i>main</i>. In other words, <i>main</i> is a parent of
<i>foo</i> and <i>bar</i>, and <i>bar</i> is a parent of
<i>foo</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Suppose all
samples are recorded in <i>foo</i> and <i>bar</i> only. When
it&rsquo;s recorded with callchains the output will show
something like below in the usual
(self&minus;overhead&minus;only) output of perf report:</p>

<p style="margin-left:17%; margin-top: 1em">.ft C <br>
Overhead Symbol <br>
........ ..................... <br>
60.00% foo <br>
| <br>
&minus;&minus;&minus; foo <br>
bar <br>
main <br>
__libc_start_main</p>

<p style="margin-left:17%; margin-top: 1em">40.00% bar <br>
| <br>
&minus;&minus;&minus; bar <br>
main <br>
__libc_start_main <br>
.ft</p>

<p style="margin-left:11%; margin-top: 1em">When the
&minus;&minus;children option is enabled, the <i>self</i>
overhead values of child functions (i.e. <i>foo</i> and
<i>bar</i>) are added to the parents to calculate the
<i>children</i> overhead. In this case the report could be
displayed as:</p>

<p style="margin-left:17%; margin-top: 1em">.ft C <br>
Children Self Symbol <br>
........ ........ .................... <br>
100.00% 0.00% __libc_start_main <br>
| <br>
&minus;&minus;&minus; __libc_start_main</p>

<p style="margin-left:17%; margin-top: 1em">100.00% 0.00%
main <br>
| <br>
&minus;&minus;&minus; main <br>
__libc_start_main</p>

<p style="margin-left:17%; margin-top: 1em">100.00% 40.00%
bar <br>
| <br>
&minus;&minus;&minus; bar <br>
main <br>
__libc_start_main</p>

<p style="margin-left:17%; margin-top: 1em">60.00% 60.00%
foo <br>
| <br>
&minus;&minus;&minus; foo <br>
bar <br>
main <br>
__libc_start_main <br>
.ft</p>

<p style="margin-left:11%; margin-top: 1em">In the above
output, the <i>self</i> overhead of <i>foo</i> (60%) was add
to the <i>children</i> overhead of <i>bar</i>, <i>main</i>
and <i>__libc_start_main</i>. Likewise, the <i>self</i>
overhead of <i>bar</i> (40%) was added to the
<i>children</i> overhead of <i>main</i> and
<i>\_\_libc_start_main</i>.</p>

<p style="margin-left:11%; margin-top: 1em">So
<i>\_\_libc_start_main</i> and <i>main</i> are shown first
since they have same (100%) <i>children</i> overhead (even
though they have zero <i>self</i> overhead) and they are the
parents of <i>foo</i> and <i>bar</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Since v3.16 the
<i>children</i> overhead is shown by default and the output
is sorted by its values. The <i>children</i> overhead is
disabled by specifying &minus;&minus;no&minus;children
option on the command line or by adding <i>report.children =
false</i> or <i>top.children = false</i> in the perf config
file.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>perf-stat</b>(1),
<b>perf-list</b>(1), <b>perf-report</b>(1)</p>
<hr>
</body>
</html>
