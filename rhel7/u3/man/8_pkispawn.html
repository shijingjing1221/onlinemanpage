<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 22:08:34 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>pkispawn</title>

</head>
<body>

<h1 align="center">pkispawn</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#SEPARATE VERSUS SHARED INSTANCES">SEPARATE VERSUS SHARED INSTANCES</a><br>
<a href="#INTERACTIVE MODE">INTERACTIVE MODE</a><br>
<a href="#PRE-CHECK MODE">PRE-CHECK MODE</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#BUGS">BUGS</a><br>
<a href="#AUTHORS">AUTHORS</a><br>
<a href="#COPYRIGHT">COPYRIGHT</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">pkispawn
&minus; Sets up an instance of Certificate Server.</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">pkispawn
&minus;s &lt;subsystem&gt; &minus;f &lt;config_file&gt;
[&minus;h] [&minus;v] [&minus;p &lt;prefix&gt;]</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Sets up a
Certificate Server subsystem (CA, KRA, OCSP, TKS, or TPS) in
a Tomcat instance.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>Note:</b></p></td>
<td width="4%"></td>
<td width="78%">


<p>A 389 Directory Server instance must be configured and
running before this script can be run. Certificate Server
requires an internal directory database. The default
configuration assumes a Directory Server instance running on
the same machine on port 389. For more information on
creating a Directory Server instance, see
<b>setup-ds.pl(8).</b></p> </td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">An instance can
contain multiple subsystems, although it may contain at most
one of each type of subsystem on a single machine. So, for
example, an instance could contain CA and KRA subsystems,
but not two CA subsystems. To create an instance with a CA
and a KRA, simply run pkispawn twice, with values <i>-s
CA</i> and <i>-s KRA</i> respectively.</p>

<p style="margin-left:11%; margin-top: 1em">The instances
are created based on values for configuration parameters in
the default configuration (/etc/pki/default.cfg) and the
user-provided configuration file. The user-provided
configuration file is read after the default configuration
file, so any parameters defined in that file will override
parameters in the default configuration file. In general,
most users will store only those parameters which are
different from the default configuration in their
user-provided configuration file.</p>

<p style="margin-left:11%; margin-top: 1em">This
configuration file contains parameters that are grouped into
sections. These sections are stacked, so that parameters
defined in earlier sections can be overwritten by parameters
defined in later sections. The sections are read in the
following order: [DEFAULT], [Tomcat], and the subsystem
section ([CA], [KRA], [OCSP], [TKS], or [TPS]). This allows
the ability to specify parameters to be shared by all
subsystems in [DEFAULT] or [Tomcat], and system-specific
customization.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p style="margin-top: 1em"><b>Note:</b></p></td>
<td width="4%"></td>
<td width="78%">


<p style="margin-top: 1em">Any non-password related
parameter values in the configuration file that needs to
contain a <b>%</b> character must be properly escaped. For
example, a value of <b>foo%bar</b> would be specified as
<b>foo%%bar</b> in the configuration file.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">At a minimum,
the user-defined configuration file must provide some
passwords needed for the install. An example configuration
file is provided in the <b>EXAMPLES</b> section below. For
more information on the default configuration file and the
parameters it contains (and can be customized), see
<b>pki_default.cfg(5).</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<b>pkispawn</b> run creates several different installation
files that can be referenced later, if need be:</p>

<p style="margin-left:22%; margin-top: 1em">* For
Tomcat-based instances, a Tomcat instance is created at
/var/lib/pki/&lt;pki_instance_name&gt;, where
pki_instance_name is defined in the configuration file.</p>

<p style="margin-left:22%; margin-top: 1em">* A log file of
<b>pkispawn</b> operations is written to
<i>/var/log/pki/pki-&lt;subsystem&gt;-spawn.&lt;timestamp&gt;.log</i>.</p>

<p style="margin-left:22%; margin-top: 1em">* A .p12 (PKCS
#12) file containing a certificate for a subsystem
administrator is stored in pki_client_dir.</p>

<p style="margin-left:11%; margin-top: 1em">When the
utility is done running, the CA can be accessed by pointing
a browser to
https://&lt;hostname&gt;:&lt;pki_https_port&gt;/. The agent
pages can be accessed by importing the CA certificate and
administrator certificate into the browser.</p>

<p style="margin-left:11%; margin-top: 1em">The Certificate
Server instance can also be accessed using the <b>pki</b>
command line interface. See <b>pki(1)</b>. For more
extensive documentation on how to use Certificate Server
features, see the Red Hat Certificate System Documentation
at
https://access.redhat.com/knowledge/docs/Red_Hat_Certificate_System/.</p>

<p style="margin-left:11%; margin-top: 1em">Instances
created using <b>pkispawn</b> can be removed using
<b>pkidestroy</b>. See <b>pkidestroy(8).</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>pkispawn</b>
supersedes and combines the functionality of
<b>pkicreate</b> and <b>pkisilent</b>, which were available
in earlier releases of Certificate Server. It is now
possible to completely create and configure the Certificate
Server subsystem in a single step using <b>pkispawn</b>.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p style="margin-top: 1em"><b>Note:</b></p></td>
<td width="4%"></td>
<td width="78%">


<p style="margin-top: 1em">Previously, as an alternative to
using <b>pkisilent</b> to perform a non-interactive batch
configuration, a PKI instance could be interactively
configured by a GUI-based configuration wizard via a Firefox
browser. GUI-based configuration of a PKI instance is
unavailable in this version of the product.</p></td></tr>
</table>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>-s
&lt;subsystem&gt;</b></p>

<p style="margin-left:22%;">Specifies the subsystem to be
installed and configured, where &lt;subsystem&gt; is CA,
KRA, OCSP, TKS, or TPS.</p>

<p style="margin-left:11%;"><b>-f
&lt;config_file&gt;</b></p>

<p style="margin-left:22%;">Specifies the path to the
user-defined configuration file. This file contains
differences between the default configuration and the custom
configuration.</p>

<p style="margin-left:11%;"><b>--precheck</b></p>

<p style="margin-left:22%;">Execute pre-checks and
exit.</p>

<p style="margin-left:11%;"><b>-h, --help</b></p>

<p style="margin-left:22%;">Prints additional help
information.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-v</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Displays verbose information about the installation.
This flag can be provided multiple times to increase
verbosity. See <b>pkispawn -h</b> for details.</p></td></tr>
</table>

<h2>SEPARATE VERSUS SHARED INSTANCES
<a name="SEPARATE VERSUS SHARED INSTANCES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Separate PKI
instances:</b></p>

<p style="margin-left:11%; margin-top: 1em">As described
above, this version of Certificate System continues to
support separate PKI instances for all subsystems.</p>

<p style="margin-left:11%; margin-top: 1em">Separate PKI
instances run as a single Java-based Apache Tomcat instance,
contain a single PKI subsystem (CA, KRA, OCSP, TKS, or TPS),
and must utilize unique ports if co-located on the same
physical machine or virtual machine (VM).</p>

<p style="margin-left:11%; margin-top: 1em"><b>Shared PKI
instances:</b></p>

<p style="margin-left:11%; margin-top: 1em">Additionally,
this version of Certificate System introduces the notion of
a shared PKI instance.</p>

<p style="margin-left:11%; margin-top: 1em">Shared PKI
instances also run as a single Java-based Apache Tomcat
instance, but may contain any combination of up to one of
each type of PKI subsystem:</p>

<p style="margin-left:22%; margin-top: 1em">CA <br>
TKS <br>
CA, KRA <br>
CA, OCSP <br>
TKS, TPS <br>
CA, KRA, TKS, TPS <br>
CA, KRA, OCSP, TKS, TPS <br>
etc.</p>

<p style="margin-left:11%; margin-top: 1em">Shared PKI
instances allow all of their subsystems contained within
that instance to share the same ports, and must utilize
unique ports if more than one shared PKI instance is
co-located on the same physical machine or VM.</p>

<p style="margin-left:11%; margin-top: 1em">Semantically, a
shared PKI instance that contains a single PKI subsystem is
identical to a separate PKI instance.</p>

<h2>INTERACTIVE MODE
<a name="INTERACTIVE MODE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">If no options
are specified, pkispawn will provide an interactive menu to
collect the parameters needed to install the Certificate
Server instance. Note that only the most basic installation
options are provided. This includes root CA, KRA, OCSP, TKS,
and TPS connecting to an existing directory server. More
advanced setups such as cloned subsystems, subordinate or
externally signed CA, subsystems that connect to the
directory server using LDAPS, and subsystems that are
customized beyond the options described below require the
use of a configuration file with the &minus;f option.</p>

<p style="margin-left:11%; margin-top: 1em">The interactive
option is most useful for those users getting familiar with
Certificate Server. The parameters collected are written to
the installation file of the subsystem, which can be found
at <b>/etc/sysconfig/pki/tomcat/&lt;instance
name&gt;/&lt;subsystem&gt;/deployment.cfg.</b></p>

<p style="margin-left:11%; margin-top: 1em">The following
parameters are queried interactively during the installation
process:</p>

<p style="margin-left:11%; margin-top: 1em"><b>Subsystem
Type</b> <i><br>
Subsystem (CA/KRA/OCSP/TKS/TPS):</i></p>

<p style="margin-left:22%;">the type of subsystem to be
installed. Prompted when the &minus;s option is not
specified. The default value chosen is CA.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Instance
Specific Parameters</b> <i><br>
Instance name:</i></p>

<p style="margin-left:22%;">the name of the tomcat instance
in which the subsystem is to be installed. The default value
is pki-tomcat. <b><br>
Note:</b> Only one subsystem of a given type (CA, KRA, OCSP,
TKS, TPS) can exist within a given instance.</p>

<p style="margin-left:11%;"><i>HTTP port:</i></p>

<p style="margin-left:22%;">the HTTP port of the Tomcat
instance. The default value is 8080.</p>

<p style="margin-left:11%;"><i>Secure HTTP port:</i></p>

<p style="margin-left:22%;">the HTTPS port of the Tomcat
instance. The default value is 8443.</p>

<p style="margin-left:11%;"><i>AJP port:</i></p>

<p style="margin-left:22%;">the AJP port of the Tomcat
instance. The default value is 8009.</p>

<p style="margin-left:11%;"><i>Management port:</i></p>

<p style="margin-left:22%;">the management port of the
Tomcat instance. The default value is 8005.</p>

<p style="margin-left:11%;"><b>Note:</b> When deploying a
new subsystem into an existing instance, <br>
pkispawn will attempt to read the ports from
<b>deployment.cfg</b> files <br>
stored for previously installed subsystems for this
instance. If <br>
successful, the installer will not prompt for these
ports.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Administrative
User Parameters</b> <i><br>
Username:</i></p>

<p style="margin-left:22%;">the username of the
administrator of this subsystem. The default value is
&lt;ca/kra/ocsp/tks/tps&gt;admin.</p>

<p style="margin-left:11%;"><i>Password:</i></p>

<p style="margin-left:22%;">password for the administrator
user.</p>

<p style="margin-left:11%;"><i>Import certificate:</i></p>

<p style="margin-left:22%;">An optional parameter that can
be used to import an already available CA admin certificate
into this instance.</p>

<p style="margin-left:11%;"><i>Export certificate:</i></p>

<p style="margin-left:22%;">setup the path where the admin
certificate of this &lt;subsystem&gt; should be stored. The
default value is
$HOME/.dogtag/pki-tomcat/&lt;ca/kra/ocsp/tks/tps&gt;_admin.cert.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Directory
Server Parameters</b> <i><br>
Hostname:</i></p>

<p style="margin-left:22%;">Hostname of the directory
server instance. The default value is the hostname of the
system.</p>

<p style="margin-left:11%;"><i>Use a secure LDAPS
connection?</i></p>

<p style="margin-left:22%;">Answering yes to this question
will cause prompts for <i>Secure LDAPS Port:</i> and
<i>Directory Server CA certificate pem file:</i>. Answering
no to this question will cause a prompt for <i>LDAP
Port</i>. The initial default value for this question is
no.</p>

<p style="margin-left:11%;"><i>Secure LDAPS Port:</i></p>

<p style="margin-left:22%;">Secure LDAPS port for the
directory server instance. The default value is 636.</p>

<p style="margin-left:11%;"><i>Directory Server CA
certificate pem file:</i></p>

<p style="margin-left:22%;">The fully-qualified path
including the filename of the file which contains an
exported copy of the Directory Server&rsquo;s CA certificate
(e. g. - $HOME/dscacert.pem). This file must exist prior to
<b>pkispawn</b> being able to utilize it. For details on
creation of this file see the <b>EXAMPLES</b> section below
entitled <b>Installing a CA connecting securely to a
Directory Server via LDAPS.</b></p>

<p style="margin-left:11%;"><i>LDAP Port:</i></p>

<p style="margin-left:22%;">LDAP port for the directory
server instance. The default value is 389.</p>

<p style="margin-left:11%;"><i>Base DN:</i></p>

<p style="margin-left:22%;">the Base DN to be used for the
internal database for this subsystem. The default value is
o=pki-tomcat-&lt;subsystem&gt;.</p>

<p style="margin-left:11%;"><i>Bind DN:</i></p>

<p style="margin-left:22%;">the bind DN required to connect
for the directory server. This user must have sufficient
permissions to install the required schema and database. The
default value is cn=Directory Manager.</p>

<p style="margin-left:11%;"><i>Password:</i></p>

<p style="margin-left:22%;">password for the bind DN.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Security
Domain Parameters</b></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><i>Name:</i></p></td>
<td width="4%"></td>
<td width="78%">


<p>the name of the security domain. Required only if
installing a root CA. Default value: &lt;DNS domain name&gt;
Security Domain.</p></td></tr>
</table>

<p style="margin-left:11%;"><i>Hostname:</i></p>

<p style="margin-left:22%;">the hostname for the security
domain CA. Required only for non-CA subsystems. The default
value is the hostname of this system.</p>

<p style="margin-left:11%;"><i>Secure HTTP port:</i></p>

<p style="margin-left:22%;">the https port for the security
domain. Required only for non-CA subsystems. The default
value is 8443.</p>

<p style="margin-left:11%;"><i>Username:</i></p>

<p style="margin-left:22%;">the username of the security
domain administrator of the CA. Required only for non-CA
subsystems. The default value is caadmin.</p>

<p style="margin-left:11%;"><i>Password:</i></p>

<p style="margin-left:22%;">password for the security
domain administrator. Required for all subsystems that are
not root CAs.</p>

<h2>PRE-CHECK MODE
<a name="PRE-CHECK MODE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This option is
only available when pkispawn is invoked in a non-interactive
mode. When the <b>--precheck</b> option is provided, a set
of basic tests are performed to ensure that the parameters
provided to pkispawn are valid and consistent.</p>

<p style="margin-left:11%; margin-top: 1em">pkispawn will
then exit with an exit code of 0 on success, or 1 on
failure. This mode can be used to perform basic tests prior
to doing any actual installation of the Certificate Server
instance.</p>

<p style="margin-left:11%; margin-top: 1em">Flags are
available to disable specific tests. For instance, one might
want to disable validation of the credentials for the
internal database user if the directory server instance has
not yet been created.</p>

<p style="margin-left:11%; margin-top: 1em">See
<b>pki_default.cfg(5)</b> for more details about available
flags.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Installing a
root CA</b></p>

<p style="margin-left:11%; margin-top: 1em">To install a
root CA in a new instance execute the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s CA &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i></p>

<p style="margin-left:11%; margin-top: 1em">Prior to
running this command, a Directory Server instance should be
created and running. This command assumes that the Directory
Server instance is using its default configuration:</p>

<p style="margin-left:22%; margin-top: 1em">* Installed on
the local machine</p>

<p style="margin-left:22%; margin-top: 1em">* Listening on
port 389</p>

<p style="margin-left:22%; margin-top: 1em">* The user is
cn=Directory Manager, with the password specified in
pki_ds_password</p>

<p style="margin-left:11%; margin-top: 1em">This invocation
of <b>pkispawn</b> creates a Tomcat instance containing a CA
running on the local machine with secure port 8443 and
unsecure port 8080. To access this CA, simply point a
browser to https://&lt;hostname&gt;:8443.</p>

<p style="margin-left:11%; margin-top: 1em">The instance
name (defined by pki_instance_name) is pki-tomcat, and it is
located at <i>/var/lib/pki/pki-tomcat</i>. Logs for the
instance are located at <i>/var/log/pki/pki-tomcat</i>, and
an installation log is written to
<i>/var/log/pki/pki-&lt;subsystem&gt;-spawn.&lt;timestamp&gt;.log</i>.</p>

<p style="margin-left:11%; margin-top: 1em">A PKCS #12 file
containing the administrator certificate is created in
<i>$HOME/.dogtag/pki-tomcat</i>. This PKCS #12 file uses the
password designated by pki_client_pkcs12_password in the
configuration file.</p>

<p style="margin-left:11%; margin-top: 1em">To access the
agent pages, first import the CA certificate by accessing
the CA End Entity Pages and clicking on the Retrieval Tab.
Be sure to trust the CA certificate. Then, import the
administrator certificate in the PKCS #12 file.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Installing a
root CA using ECC</b></p>

<p style="margin-left:11%; margin-top: 1em">To install a
root CA in a new instance using ECC execute the following
command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s CA &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_admin_keysize=nistp256 <br>
pki_admin_key_type=ecc <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_ssl_server_key_algorithm=SHA256withEC <br>
pki_ssl_server_key_size=nistp256 <br>
pki_ssl_server_key_type=ecc <br>
pki_subsystem_key_algorithm=SHA256withEC <br>
pki_subsystem_key_size=nistp256 <br>
pki_subsystem_key_type=ecc</p>

<p style="margin-left:22%; margin-top: 1em">[CA] <br>
pki_ca_signing_key_algorithm=SHA256withEC <br>
pki_ca_signing_key_size=nistp256 <br>
pki_ca_signing_key_type=ecc <br>
pki_ca_signing_signing_algorithm=SHA256withEC <br>
pki_ocsp_signing_key_algorithm=SHA256withEC <br>
pki_ocsp_signing_key_size=nistp256 <br>
pki_ocsp_signing_key_type=ecc <br>
pki_ocsp_signing_signing_algorithm=SHA256withEC</p>

<p style="margin-left:11%; margin-top: 1em">In order to
utilize ECC, the SSL Server and Subsystem key algorithm, key
size, and key type should be changed from SHA256withRSA
--&gt; SHA256withEC, 2048 --&gt; nistp256, and rsa --&gt;
ecc, respectively. To use an ECC admin key size and key
type, the values should also be changed from 2048 --&gt;
nistp256, and rsa --&gt; ecc.</p>

<p style="margin-left:11%; margin-top: 1em">Additionally,
for a CA subsystem, both the CA and OCSP Signing key
algorithm, key size, key type, and signing algorithm should
be changed from SHA256withRSA --&gt; SHA256withEC, 2048
--&gt; nistp256, rsa --&gt; ecc, and SHA256withRSA --&gt;
SHA256withEC,respectively.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>Note:</b></p></td>
<td width="4%"></td>
<td width="78%">


<p>For all PKI subsystems including the CA, ECC is not
supported for the corresponding Audit Signing parameters.
Similarly, for KRA subsystems, ECC is not supported for
either of the corresponding Storage or Transport
parameters.</p> </td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em"><b>Installing a
KRA, OCSP, TKS, or TPS in a shared instance</b></p>

<p style="margin-left:11%; margin-top: 1em">For this
example, assume that a new CA instance has been installed by
executing the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s CA &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
# Optionally keep client databases <br>
pki_client_database_purge=False</p>

<p style="margin-left:11%; margin-top: 1em">To install a
shared KRA in the same instance used by the CA execute <br>
the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s KRA &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i></p>

<p style="margin-left:11%; margin-top: 1em">To install a
shared OCSP in the same instance used by the CA execute <br>
the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s OCSP &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i></p>

<p style="margin-left:11%; margin-top: 1em">To install a
shared TKS in the same instance used by the CA execute <br>
the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s TKS &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i></p>

<p style="margin-left:11%; margin-top: 1em">To install a
shared TPS in the same instance used by the CA execute <br>
the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s TPS &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i> <br>
[TPS] <br>
# Shared TPS instances optionally utilize their shared KRA
<br>
# for server-side keygen <br>
pki_enable_server_side_keygen=True <br>
pki_authdb_basedn=<i>dc=example,dc=com</i></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p style="margin-top: 1em"><b>Note:</b></p></td>
<td width="4%"></td>
<td width="78%">


<p style="margin-top: 1em">For this particular example, the
computed default values for a</p></td></tr>
</table>

<p style="margin-left:22%;">PKI instance name including its
ports, URLs, machine names, etc. <br>
were utilized as defined in <i>/etc/pki/default.cfg</i>.
Each <br>
subsystem in this example will reside under the <i><br>
/var/lib/pki/pki-tomcat</i> instance housed within their own
<i><br>
ca</i>, <i>kra</i>, <i>ocsp</i>, <i>tks</i>, and <i>tps</i>
<br>
subdirectories, utilizing the same default port values of
<br>
8080 (http), 8443 (https), 8009 (ajp), 8005 (tomcat), using
the <br>
same computed hostname and URL information, and sharing a
single <br>
common PKI Administrator Certificate.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>pki_security_domain_password</b> is the admin password of
the <br>
CA installed in the same instance. This command should be
run after <br>
a CA is installed. This installs another subsystem within
the same <br>
instance using the certificate generated for the CA
administrator <br>
for the subsystem&rsquo;s administrator. This allows a user
to access <br>
both subsystems on the browser with a single administrator
<br>
certificate. To access the new subsystem&rsquo;s
functionality, simply <br>
point the browser to https://&lt;hostname&gt;:8443 and click
the <br>
relevant top-level links.</p>

<p style="margin-left:11%; margin-top: 1em">To install TPS
in a shared instance the following section must be <br>
added to <i>myconfig.txt</i>:</p>

<p style="margin-left:22%; margin-top: 1em">[TPS] <br>
pki_authdb_basedn=<i>dc=example,dc=com</i></p>

<p style="margin-left:11%; margin-top: 1em">TPS requires an
authentication database. The <b>pki_authdb_basedn</b>
specifies the base DN of the authentication database.</p>

<p style="margin-left:11%; margin-top: 1em">TPS also
requires that a CA and a TKS subsystems are already
installed in the same instance. Since they are in the same
instance, a shared secret key will automatically be
generated in TKS and imported into TPS.</p>

<p style="margin-left:11%; margin-top: 1em">Optionally,
server-side key generation can be enabled in TPS by adding
the following parameter in [TPS]:</p>


<p style="margin-left:22%; margin-top: 1em">pki_enable_server_side_keygen=<i>True</i></p>

<p style="margin-left:11%; margin-top: 1em">Enabling
server-side key generation requires that a KRA subsystem is
already installed in the same instance.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Installing a
KRA, OCSP, TKS, or TPS in a separate instance</b></p>

<p style="margin-left:11%; margin-top: 1em">For this
example, assume that a new CA instance has been installed by
executing the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s CA &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
# Optionally keep client databases <br>
pki_client_database_purge=False <br>
# Separated CA instance name and ports <br>
pki_instance_name=<i>pki-ca</i> <br>
pki_http_port=<i>18080</i> <br>
pki_https_port=<i>18443</i> <br>
# This Separated CA instance will be its own security domain
<br>
pki_security_domain_https_port=<i>18443</i> <br>
[Tomcat] <br>
# Separated CA Tomcat ports <br>
pki_ajp_port=<i>18009</i> <br>
pki_tomcat_server_port=<i>18005</i></p>

<p style="margin-left:11%; margin-top: 1em">To install a
separate KRA which connects to this remote CA execute <br>
the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s KRA &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i> <br>
# Optionally keep client databases <br>
pki_client_database_purge=False <br>
# Separated KRA instance name and ports <br>
pki_instance_name=<i>pki-kra</i> <br>
pki_http_port=<i>28080</i> <br>
pki_https_port=<i>28443</i> <br>
# Separated KRA instance security domain references <br>
pki_issuing_ca=<i>https://pki.example.com:18443</i> <br>
pki_security_domain_hostname=<i>pki.example.com</i> <br>
pki_security_domain_https_port=<i>18443</i> <br>
pki_security_domain_user=caadmin <br>
[Tomcat] <br>
# Separated KRA Tomcat ports <br>
pki_ajp_port=<i>28009</i> <br>
pki_tomcat_server_port=<i>28005</i> <br>
[KRA] <br>
# A Separated KRA instance requires its own <br>
# PKI Administrator Certificate <br>
pki_import_admin_cert=False</p>

<p style="margin-left:11%; margin-top: 1em">To install a
separate OCSP which connects to this remote CA execute <br>
the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s OCSP &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i> <br>
# Optionally keep client databases <br>
pki_client_database_purge=False <br>
# Separated OCSP instance name and ports <br>
pki_instance_name=<i>pki-ocsp</i> <br>
pki_http_port=<i>29080</i> <br>
pki_https_port=<i>29443</i> <br>
# Separated OCSP instance security domain references <br>
pki_issuing_ca=<i>https://pki.example.com:18443</i> <br>
pki_security_domain_hostname=<i>pki.example.com</i> <br>
pki_security_domain_https_port=<i>18443</i> <br>
pki_security_domain_user=caadmin <br>
[Tomcat] <br>
# Separated OCSP Tomcat ports <br>
pki_ajp_port=<i>29009</i> <br>
pki_tomcat_server_port=<i>29005</i> <br>
[OCSP] <br>
# A Separated OCSP instance requires its own <br>
# PKI Administrator Certificate <br>
pki_import_admin_cert=False</p>

<p style="margin-left:11%; margin-top: 1em">To install a
separate TKS which connects to this remote CA execute <br>
the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s TKS &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i> <br>
# Optionally keep client databases <br>
pki_client_database_purge=False <br>
# Separated TKS instance name and ports <br>
pki_instance_name=<i>pki-tks</i> <br>
pki_http_port=<i>30080</i> <br>
pki_https_port=<i>30443</i> <br>
# Separated TKS instance security domain references <br>
pki_issuing_ca=<i>https://pki.example.com:18443</i> <br>
pki_security_domain_hostname=<i>pki.example.com</i> <br>
pki_security_domain_https_port=<i>18443</i> <br>
pki_security_domain_user=caadmin <br>
[Tomcat] <br>
# Separated TKS Tomcat ports <br>
pki_ajp_port=<i>30009</i> <br>
pki_tomcat_server_port=<i>30005</i> <br>
[TKS] <br>
# A Separated TKS instance requires its own <br>
# PKI Administrator Certificate <br>
pki_import_admin_cert=False</p>

<p style="margin-left:11%; margin-top: 1em">To install a
separate TPS which connects to this remote CA execute <br>
the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s TPS &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i> <br>
# Optionally keep client databases <br>
pki_client_database_purge=False <br>
# Separated TPS instance name and ports <br>
pki_instance_name=<i>pki-tps</i> <br>
pki_http_port=<i>31080</i> <br>
pki_https_port=<i>31443</i> <br>
# Separated TPS instance security domain references <br>
pki_issuing_ca=<i>https://pki.example.com:18443</i> <br>
pki_security_domain_hostname=<i>pki.example.com</i> <br>
pki_security_domain_https_port=<i>18443</i> <br>
pki_security_domain_user=caadmin <br>
[Tomcat] <br>
# Separated TPS Tomcat ports <br>
pki_ajp_port=<i>31009</i> <br>
pki_tomcat_server_port=<i>31005</i> <br>
[TPS] <br>
# Separated TPS instances require specifying a remote CA
<br>
pki_ca_uri=<i>https://pki.example.com:18443</i> <br>
# Separated TPS instances optionally utilize a remote KRA
<br>
# for server-side keygen <br>
pki_kra_uri=<i>https://pki.example.com:28443</i> <br>
pki_enable_server_side_keygen=True <br>
pki_authdb_basedn=<i>dc=example,dc=com</i> <br>
# Separated TPS instances require specifying a remote TKS
<br>
pki_tks_uri=<i>https://pki.example.com:30443</i> <br>
pki_import_shared_secret=True <br>
# A Separated TPS instance requires its own <br>
# PKI Administrator Certificate <br>
pki_import_admin_cert=False</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p style="margin-top: 1em"><b>Note:</b></p></td>
<td width="4%"></td>
<td width="78%">


<p style="margin-top: 1em">For this particular example,
besides passwords, sample</p></td></tr>
</table>

<p style="margin-left:22%;">values were also utilized for
PKI instance names, ports, <br>
URLs, machine names, etc. Under no circumstances should <br>
these demonstrative values be construed to be required <br>
literal values.</p>

<p style="margin-left:11%; margin-top: 1em">A remote CA is
one where the CA resides in another <br>
Certificate Server instance, either on the local machine
<br>
or a remote machine. In this case, <i>myconfig.txt</i> must
<br>
specify the connection information for the remote CA and the
<br>
information about the security domain (the trusted
collection <br>
of subsystems within an instance).</p>

<p style="margin-left:11%; margin-top: 1em">The subsystem
section is [KRA], [OCSP], [TKS], or [TPS]. <br>
This example assumes that the specified CA hosts the
security <br>
domain. The CA must be running and accessible.</p>

<p style="margin-left:11%; margin-top: 1em">A new
administrator certificate is generated for the new <br>
subsystem and stored in a PKCS #12 file <br>
in <i>$HOME/.dogtag/&lt;pki_instance_name&gt;</i>.</p>

<p style="margin-left:11%; margin-top: 1em">As in a shared
instance, to install TPS in a separate instance <br>
the authentication database must be specified in the [TPS]
section, <br>
and optionally the server-side key generation can be
enabled. <br>
If the CA, KRA, or TKS subsystems required by TPS are
running <br>
on a remote instance the following parameters must be added
into <br>
the [TPS] section to specify their locations:</p>


<p style="margin-left:22%; margin-top: 1em">pki_ca_uri=<i>https://&lt;ca_hostname&gt;:&lt;ca_https_port&gt;</i>
<br>

pki_kra_uri=<i>https://&lt;kra_hostname&gt;:&lt;kra_https_port&gt;</i>
<br>

pki_tks_uri=<i>https://&lt;tks_hostname&gt;:&lt;tks_https_port&gt;</i></p>

<p style="margin-left:11%; margin-top: 1em">If TPS and TKS
are installed on separate instances the shared secret key
should be imported over the wire between the TKS and TPS
automatically.</p>

<p style="margin-left:11%; margin-top: 1em">If the
automated procedure fails for any unlikely reason the
following manual procedure will serve as a fallback. The key
needs to be created on the TKS side and imported into the
TPS side in this case.</p>

<p style="margin-left:11%; margin-top: 1em">Generate the
shared secret key (if needed) in TKS with the following
command:</p>

<p style="margin-left:22%; margin-top: 1em">tkstool -T -d
/var/lib/pki/pki-tomcat/alias -n sharedSecret</p>

<p style="margin-left:11%; margin-top: 1em">Verify the
shared secret key in TKS with the following command:</p>

<p style="margin-left:22%; margin-top: 1em">tkstool -L -d
/var/lib/pki/pki-tomcat/alias</p>

<p style="margin-left:11%; margin-top: 1em">Once TPS is
installed, shutdown TPS instance, then import the shared
secret key into TPS with the following command:</p>

<p style="margin-left:22%; margin-top: 1em">tkstool -I -d
/var/lib/pki/pki-tomcat/alias -n sharedSecret</p>

<p style="margin-left:11%; margin-top: 1em">Verify the
shared secret key in TPS with the following command:</p>

<p style="margin-left:22%; margin-top: 1em">tkstool -L -d
/var/lib/pki/pki-tomcat/alias</p>

<p style="margin-left:11%; margin-top: 1em">The shared
secret key nickname should be stored in the following
property in the TPS&rsquo;s CS.cfg:</p>


<p style="margin-left:22%; margin-top: 1em">conn.tks1.tksSharedSymKeyName=sharedSecret</p>

<p style="margin-left:11%; margin-top: 1em">Finally,
restart the TPS instance.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Installing a
CA, KRA, OCSP, TKS, or TPS using a Hardware Security Module
(HSM)</b></p>

<p style="margin-left:11%; margin-top: 1em">This section
provides sample <b>myconfig.txt</b> files when an HSM is
being utilized in a shared PKI instance.</p>

<p style="margin-left:11%; margin-top: 1em">For this
example, assume that a new CA instance has been installed by
executing the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s CA &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
# Optionally keep client databases <br>
pki_client_database_purge=False <br>
# Provide HSM parameters <br>
pki_hsm_enable=True <br>
pki_hsm_libfile=&lt;hsm_libfile&gt; <br>
pki_hsm_modulename=&lt;hsm_modulename&gt; <br>
pki_token_name=&lt;hsm_token_name&gt; <br>
pki_token_password=&lt;pki_token_password&gt; <br>
# Provide PKI-specific HSM token names <br>
pki_audit_signing_token=&lt;hsm_token_name&gt; <br>
pki_ssl_server_token=&lt;hsm_token_name&gt; <br>
pki_subsystem_token=&lt;hsm_token_name&gt; <br>
[CA] <br>
# Provide CA-specific HSM token names <br>
pki_ca_signing_token=&lt;hsm_token_name&gt; <br>
pki_ocsp_signing_token=&lt;hsm_token_name&gt;</p>

<p style="margin-left:11%; margin-top: 1em">To install a
shared KRA in the same instance used by the CA execute <br>
the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s KRA &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i> <br>
# Provide HSM parameters <br>
pki_hsm_enable=True <br>
pki_hsm_libfile=&lt;hsm_libfile&gt; <br>
pki_hsm_modulename=&lt;hsm_modulename&gt; <br>
pki_token_name=&lt;hsm_token_name&gt; <br>
pki_token_password=&lt;pki_token_password&gt; <br>
# Provide PKI-specific HSM token names <br>
pki_audit_signing_token=&lt;hsm_token_name&gt; <br>
pki_ssl_server_token=&lt;hsm_token_name&gt; <br>
pki_subsystem_token=&lt;hsm_token_name&gt; <br>
[KRA] <br>
# Provide KRA-specific HSM token names <br>
pki_storage_token=&lt;hsm_token_name&gt; <br>
pki_transport_token=&lt;hsm_token_name&gt;</p>

<p style="margin-left:11%; margin-top: 1em">To install a
shared OCSP in the same instance used by the CA execute <br>
the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s OCSP &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i> <br>
# Provide HSM parameters <br>
pki_hsm_enable=True <br>
pki_hsm_libfile=&lt;hsm_libfile&gt; <br>
pki_hsm_modulename=&lt;hsm_modulename&gt; <br>
pki_token_name=&lt;hsm_token_name&gt; <br>
pki_token_password=&lt;pki_token_password&gt; <br>
# Provide PKI-specific HSM token names <br>
pki_audit_signing_token=&lt;hsm_token_name&gt; <br>
pki_ssl_server_token=&lt;hsm_token_name&gt; <br>
pki_subsystem_token=&lt;hsm_token_name&gt; <br>
[OCSP] <br>
# Provide OCSP-specific HSM token names <br>
pki_ocsp_signing_token=&lt;hsm_token_name&gt;</p>

<p style="margin-left:11%; margin-top: 1em">To install a
shared TKS in the same instance used by the CA execute <br>
the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s TKS &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i> <br>
# Provide HSM parameters <br>
pki_hsm_enable=True <br>
pki_hsm_libfile=&lt;hsm_libfile&gt; <br>
pki_hsm_modulename=&lt;hsm_modulename&gt; <br>
pki_token_name=&lt;hsm_token_name&gt; <br>
pki_token_password=&lt;pki_token_password&gt; <br>
# Provide PKI-specific HSM token names <br>
pki_audit_signing_token=&lt;hsm_token_name&gt; <br>
pki_ssl_server_token=&lt;hsm_token_name&gt; <br>
pki_subsystem_token=&lt;hsm_token_name&gt;</p>

<p style="margin-left:11%; margin-top: 1em">To install a
shared TPS in the same instance used by the CA execute <br>
the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s TPS &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i> <br>
# Provide HSM parameters <br>
pki_hsm_enable=True <br>
pki_hsm_libfile=&lt;hsm_libfile&gt; <br>
pki_hsm_modulename=&lt;hsm_modulename&gt; <br>
pki_token_name=&lt;hsm_token_name&gt; <br>
pki_token_password=&lt;pki_token_password&gt; <br>
# Provide PKI-specific HSM token names <br>
pki_audit_signing_token=&lt;hsm_token_name&gt; <br>
pki_ssl_server_token=&lt;hsm_token_name&gt; <br>
pki_subsystem_token=&lt;hsm_token_name&gt; <br>
[TPS] <br>
# Shared TPS instances optionally utilize their shared KRA
<br>
# for server-side keygen <br>
pki_enable_server_side_keygen=True <br>
pki_authdb_basedn=<i>dc=example,dc=com</i></p>

<p style="margin-left:11%;"><b>Important:</b></p>

<p style="margin-left:22%;">Since HSM keys are stored in
the HSM (hardware), they cannot be <br>
backed up, moved, or copied to a PKCS #12 file (software).
<br>
For example, if <b>pki_hsm_enable</b> is set to True,
<b><br>
pki_backup_keys</b> should be set to False and <b><br>
pki_backup_password</b> should be left unset (the default
<br>
values in <b>/etc/pki/default.cfg</b>). Similarly, for the
case <br>
of clones using an HSM, this means that the HSM keys must be
<br>
shared between the master and its clones. Therefore, if
<b><br>
pki_hsm_enable</b> is set to True, both <b><br>
pki_clone_pkcs12_path</b> and
<b>pki_clone_pkcs12_password</b> <br>
should be left unset (the default values in <b><br>
/etc/pki/default.cfg</b>). Failure to comply with these
rules <br>
will result in <b>pkispawn</b> reporting an appropriate
error and <br>
exiting.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Installing a
CA clone</b></p>

<p style="margin-left:11%; margin-top: 1em">To install a CA
clone execute the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s CA &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i> <br>
pki_security_domain_hostname=&lt;master_ca_hostname&gt; <br>
pki_security_domain_https_port=&lt;master_ca_https_port&gt;
<br>
pki_security_domain_user=caadmin</p>

<p style="margin-left:22%; margin-top: 1em">[Tomcat] <br>
pki_clone=True <br>
pki_clone_pkcs12_password=<i>Secret123</i> <br>
pki_clone_pkcs12_path=&lt;path_to_pkcs12_file&gt; <br>
pki_clone_replicate_schema=True <br>

pki_clone_uri=https://&lt;master_ca_hostname&gt;:&lt;master_ca_https_port&gt;</p>

<p style="margin-left:11%; margin-top: 1em">A cloned CA is
a CA which uses the same signing, OCSP signing, and audit
signing certificates as the master CA, but issues
certificates within a different serial number range. It has
its own internal database -- separate from the master CA
database -- but using the same base DN, that keeps in sync
with the master CA through replication agreements between
the databases. This is very useful for load sharing and
disaster recovery. To create a clone, the
<i>myconfig.txt</i> uses pki_clone-* parameters in its
[Tomcat] section which identify the original CA to use as a
master template. Additionally, it connects to the master CA
as a remote CA and uses its security domain.</p>

<p style="margin-left:11%; margin-top: 1em">Before the
clone can be generated, the Directory Server must be created
that is separate from the master CA&rsquo;s Directory
Server. The example assumes that the master CA and cloned CA
are on different machines, and that their Directory Servers
are on port 389.</p>

<p style="margin-left:11%; margin-top: 1em">In addition,
since this example does not utilize an HSM, the
master&rsquo;s system certs and keys have been stored in a
PKCS #12 file that is copied over to the clone subsystem in
the location specified in &lt;path_to_pkcs12_file&gt;. This
file needs to be readable by the user the Certificate Server
runs as (by default, pkiuser) and be given the SELinux
context pki_tomcat_cert_t.</p>

<p style="margin-left:11%; margin-top: 1em">The
master&rsquo;s system certificates can be exported to a
PKCS#12 file when the master is installed if the parameter
<b>pki_backup_keys</b> is set to <b>True</b> and the
<b>pki_backup_password</b> is set. The PKCS#12 file is then
found under <b>/var/lib/pki/&lt;instance_name&gt;/alias</b>.
Alternatively, the PKCS#12 file can be generated at any time
post-installation using <b>PKCS12Export</b>.</p>

<p style="margin-left:11%; margin-top: 1em">An example
invocation showing the export of the system certificates and
keys, copying the keys to the replica subsystem, and setting
the relevant SELinux and file permissions is shown below.
<b>pwfile</b> is a text file containing the password for the
master NSS DB (found in
<b>/etc/pki/&lt;instance_name&gt;/password.conf</b>).
<b><br>
pkcs12_password_file</b> is a text file containing the
password selected for the generated PKCS12 file.</p>

<p style="margin-left:22%; margin-top: 1em"><b>master#
PKCS12Export -d /etc/pki/pki-tomcat/alias -p pwfile \ <br>
-w pkcs12_password_file -o backup_keys.p12 <br>
master# scp backup_keys.p12 clone:/backup_keys.p12</b></p>

<p style="margin-left:22%; margin-top: 1em"><b>clone# chown
pkiuser: /backup_keys.p12 <br>
clone# semanage -a -t pki_tomcat_cert_t
/backup_keys.p12</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>Note:</b>
From Dogtag 10.3, a slightly different mechanism has been
provided to create and specify the required PKCS#12 file to
the clone subsystem. This new method is provided in addition
to the method above, but will become the preferred method in
future releases.</p>

<p style="margin-left:11%; margin-top: 1em">This method can
be used if both master and clone are 10.3 or above.</p>

<p style="margin-left:11%; margin-top: 1em">To export the
required keys from the master, use the <b>pki-server</b>
command line tool.</p>

<p style="margin-left:22%; margin-top: 1em"><b>master#
pki-server ca-clone-prepare -i pki-tomcat \ <br>
--pkcs12-file backup_keys.p12 \ <br>
--pkcs12-password Secret123</b></p>

<p style="margin-left:22%; margin-top: 1em"><b>master# scp
backup_keys.p12 clone:/backup_keys.p12 <br>
master# scp /etc/pki/pki-tomcat/external_certs.conf \ <br>
clone:/external_certs.conf</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<b>external_certs.conf</b> file contains information about
third party certificates that were added to the
master&rsquo;s certificate database using the
<b>pki-server</b> command. The certificates themselves are
stored in the backup_keys.p12 file. If there are no
third-party certifcates that have been added, then the
<b>external_certs.conf</b> file may not exist and should be
ignored.</p>

<p style="margin-left:11%; margin-top: 1em">The two files
(<b>backup_keys.p12</b> and <b>external_certs.conf</b>) are
specified to pkispawn as below.</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i> <br>
pki_security_domain_hostname=&lt;master_ca_hostname&gt; <br>
pki_security_domain_https_port=&lt;master_ca_https_port&gt;
<br>
pki_security_domain_user=caadmin</p>

<p style="margin-left:22%; margin-top: 1em">[Tomcat] <br>
pki_server_pkcs12_path=&lt;path to pkcs12 file&gt; <br>
pki_server_pkcs12_password=<i>Secret123</i> <br>
pki_server_external_certs_path=&lt;path to
external_certs.conf file&gt; <br>
pki_clone=True <br>
pki_clone_replicate_schema=True <br>

pki_clone_uri=https://&lt;master_ca_hostname&gt;:&lt;master_ca_https_port&gt;</p>

<p style="margin-left:11%; margin-top: 1em">Note that the
previous p12 parameters (pki_clone_pkcs12_*) are no longer
needed, and will be ignored.</p>

<p style="margin-left:11%; margin-top: 1em">Note: One
current cloning anomaly to mention is the following
scenario:</p>

<p style="margin-left:11%; margin-top: 1em">1. Create a
clone of a CA or of any other subsystem. <br>
2. Remove that just created clone. <br>
3. Immediately attempt the exact same clone again, in place
of <br>
the recently destroyed instance. Before recreating this
clone, <br>
make sure the &quot;pki_ds_remove_data=True&quot; is used in
the clone&rsquo;s <br>
deployment config file. This will remove the old data from
the previous <br>
clone.</p>

<p style="margin-left:11%; margin-top: 1em">Here the
Director Server instance may have worked itself in into a
state <br>
where it no longer accepts connections, aborting the clone
configuration quickly.</p>

<p style="margin-left:11%; margin-top: 1em">The fix to this
is to simply restart the Directory Server instance before
<br>
creating the clone for the second time. After restarting the
Directory Server <br>
it should be possible to create the mentioned clone
instance.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Installing a
KRA or TKS clone</b></p>

<p style="margin-left:11%; margin-top: 1em">To install a
KRA or TKS (OCSP and TPS unsupported as of now) execute the
following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s &lt;subsystem&gt; &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where subsystem
is KRA or TKS and <i>myconfig.txt</i> contains the following
text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i> <br>
pki_security_domain_hostname=&lt;master_ca_hostname&gt; <br>
pki_security_domain_https_port=&lt;master_ca_https_port&gt;
<br>
pki_security_domain_user=caadmin</p>

<p style="margin-left:22%; margin-top: 1em">[Tomcat] <br>
pki_clone=True <br>
pki_clone_pkcs12_password=<i>Secret123</i> <br>
pki_clone_pkcs12_path=&lt;path_to_pkcs12_file&gt; <br>
pki_clone_replicate_schema=True <br>

pki_clone_uri=https://&lt;master_subsystem_host&gt;:&lt;master_subsystem_https_port&gt;
<br>

pki_issuing_ca=https://&lt;ca_hostname&gt;:&lt;ca_https_port&gt;</p>

<p style="margin-left:11%; margin-top: 1em">As with a CA
clone, a KRA or TKS clone uses the same certificates and
basic configuration as the original subsystem. The
configuration points to the original subsystem to copy its
configuration. This example also assumes that the CA is on a
remote machine and specifies the CA and security domain
information.</p>

<p style="margin-left:11%; margin-top: 1em">The parameter
<b>pki_clone_uri</b> should be modified to point to the
required master (KRA or TKS).</p>

<p style="margin-left:11%; margin-top: 1em">As of 10.3, a
slightly different mechanism has been introduced to generate
and specify the PKCS#12 file and any third-party
certificates. See the <b>Installing a CA clone</b> section
for details.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Installing a
CA clone on the same host</b></p>

<p style="margin-left:11%; margin-top: 1em">For testing
purposes, it is useful to configure cloned CAs which exist
(with their internal databases) on the same host as the
master CA. To configure the cloned CA execute the following
command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s CA &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=Secret123 <br>
pki_client_database_password=Secret123 <br>
pki_client_pkcs12_password=Secret123 <br>
pki_ds_password=Secret123 <br>
pki_ds_ldap_port=&lt;unique port different from master&gt;
<br>
pki_ds_ldaps_port=&lt;unique port different from master&gt;
<br>
pki_http_port=&lt;unique port different from master&gt; <br>
pki_https_port=&lt;unique port different from master&gt;
<br>
pki_instance_name=&lt;unique name different from master&gt;
<br>
pki_security_domain_hostname=&lt;master_ca_hostname&gt; <br>
pki_security_domain_https_port=&lt;master_ca_https_port&gt;
<br>
pki_security_domain_password=Secret123</p>

<p style="margin-left:22%; margin-top: 1em">[Tomcat] <br>
pki_ajp_port=&lt;unique port different from master&gt; <br>
pki_clone=True <br>
pki_clone_pkcs12_password=Secret123 <br>
pki_clone_pkcs12_path=&lt;path_to_pkcs12_file&gt; <br>

pki_clone_uri=https://&lt;master_ca_hostname&gt;:&lt;master_ca_https_port&gt;
<br>
pki_tomcat_server_port=&lt;unique port different from
master&gt;</p>

<p style="margin-left:22%; margin-top: 1em">[CA] <br>
pki_ds_base_dn=&lt;identical value as master&gt; <br>
pki_ds_database=&lt;identical value as master&gt;</p>

<p style="margin-left:11%; margin-top: 1em">In this case,
because both CA Tomcat instances are on the same host, they
must have distinct ports. Similarly, each CA must use a
distinct directory server instance for its internal
database. Like the Tomcat instances, these are distinguished
by distinct ports. The suffix being replicated
(<b>pki_ds_base</b>), however, must be the same for both
master and clone.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Installing a
subordinate CA in existing security domain</b></p>

<p style="margin-left:11%; margin-top: 1em">To install a
subordinate CA in an existing security domain execute the
following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s CA &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i> <br>

pki_security_domain_hostname=&lt;security_domain_ca_hostname&gt;
<br>

pki_security_domain_https_port=&lt;security_domain_ca_https_port&gt;
<br>
pki_security_domain_user=caadmin</p>

<p style="margin-left:22%; margin-top: 1em">[CA] <br>
pki_subordinate=True <br>

pki_issuing_ca=https://&lt;master_ca_hostname&gt;:&lt;master_ca_https_port&gt;
<br>
pki_ca_signing_subject_dn=cn=CA Subordinate
Signing,o=example.com</p>

<p style="margin-left:11%; margin-top: 1em">A sub-CA
derives its certificate configuration -- such as allowed
extensions and validity periods -- from a superior or root
CA. Otherwise, the configuration of the CA is independent of
the root CA, so it is its own instance rather than a clone.
A sub-CA is configured using the pki_subordinate parameter
and a pointer to the CA which issues the sub-CA&rsquo;s
certificates.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Note:</b>
The value of <b>pki_ca_signing_subject_dn</b> of a
subordinate CA should be different from the root CA&rsquo;s
signing subject DN.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Installing a
subordinate CA in new security domain</b></p>

<p style="margin-left:11%; margin-top: 1em">To install a
subordinate CA in a new security domain execute the
following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s CA &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>myconfig.txt</i> contains the following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i> <br>
pki_security_domain_hostname=&lt;master CA security domain
hostname&gt; <br>
pki_security_domain_https_port=&lt;master CA security domain
https port&gt; <br>
pki_security_domain_user=caadmin</p>

<p style="margin-left:22%; margin-top: 1em">[CA] <br>
pki_subordinate=True <br>

pki_issuing_ca=https://&lt;master_ca_hostname&gt;:&lt;master_ca_https_port&gt;
<br>
pki_ca_signing_subject_dn=<i>cn=CA Subordinate
Signing,o=example.com</i> <br>
pki_subordinate_create_new_security_domain=True <br>
pki_subordinate_security_domain_name=<i>Subordinate CA
Security Domain</i></p>

<p style="margin-left:11%; margin-top: 1em">In this
section, the subordinate CA logs onto and registers with the
security domain CA (using parameters
<b>pki_security_domain_hostname</b>,
<b>pki_security_domain_user</b> and
<b>pki_security_domain_password</b>) as in the previous
section, but also creates and hosts a new security domain.
To do this,
<b>pki_subordinate_create_new_security_domain</b> must be
set to <b>True</b>. The subordinate CA security domain name
can also be specified by specifying a value for
<b>pki_subordinate_security_domain_name</b>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Note:</b>
The value of <b>pki_ca_signing_subject_dn</b> of a
subordinate CA should be different from the root CA&rsquo;s
signing subject DN.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Installing
an externally signed CA</b></p>

<p style="margin-left:11%; margin-top: 1em">To install an
externally signed CA execute the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn
&minus;s CA &minus;f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em">This is a two
step process.</p>

<p style="margin-left:11%; margin-top: 1em">In the first
step, a certificate signing request (CSR) is generated for
the signing certificate and <i>myconfig.txt</i> contains the
following text:</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i></p>

<p style="margin-left:22%; margin-top: 1em">[CA] <br>
pki_external=True <br>
pki_external_csr_path=<i>/tmp/ca_signing.csr</i> <br>
pki_ca_signing_subject_dn=<i>cn=CA
Signing,ou=External,o=example.com</i></p>

<p style="margin-left:11%; margin-top: 1em">The CSR is
written to pki_external_csr_path. The
pki_ca_signing_subject_dn should be different from the
subject DN of the external CA that is signing the request.
The pki_ca_signing_subject_dn parameter can be used to
specify the signing certificate&rsquo;s subject DN.</p>

<p style="margin-left:11%; margin-top: 1em">The CSR is then
submitted to the external CA, and the resulting certificate
and certificate chain are saved to files on the system.</p>

<p style="margin-left:11%; margin-top: 1em">In the second
step, the configuration file has been modified to install
the issued certificates. In place of the original CSR, the
configuration file now points to the issued CA certificate
and certificate chain. There is also a flag to indicate that
this completes the installation process
(pki_external_step_two).</p>

<p style="margin-left:22%; margin-top: 1em">[DEFAULT] <br>
pki_admin_password=<i>Secret123</i> <br>
pki_client_database_password=<i>Secret123</i> <br>
pki_client_pkcs12_password=<i>Secret123</i> <br>
pki_ds_password=<i>Secret123</i> <br>
pki_security_domain_password=<i>Secret123</i></p>

<p style="margin-left:22%; margin-top: 1em">[CA] <br>
pki_external=True <br>

pki_external_ca_cert_chain_path=<i>/tmp/ca_cert_chain.cert</i>
<br>
pki_external_ca_cert_path=<i>/tmp/ca_signing.cert</i> <br>
pki_external_step_two=True <br>
pki_ca_signing_subject_dn=<i>cn=CA Signing
Certificate,ou=External,o=example.com</i></p>

<p style="margin-left:11%; margin-top: 1em">Then, the
<b>pkispawn</b> command is run again:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkispawn -s
CA -f myconfig.txt</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>Installing a
PKI subsystem with a secure LDAP connection</b></p>

<p style="margin-left:11%; margin-top: 1em">There are three
scenarios in which a PKI subsystem (e.g. a CA) needs to
communicate securely via LDAPS with a directory server:</p>

<p style="margin-left:22%; margin-top: 1em">* A directory
server exists which is already running LDAPS using a CA
certificate that has been issued by some other CA. For this
scenario, the CA certificate must be made available via a
PEM file (e.g. $HOME/dscacert.pem) prior to running
<b>pkispawn</b> such that the new CA may be installed and
configured to communicate with this directory server using
LDAPS.</p>

<p style="margin-left:22%; margin-top: 1em">* A directory
server exists which is currently running LDAP. Once a CA has
been created, there is a desire to use its CA certificate to
issue an SSL certificate for this directory server so that
this CA and this directory server can communicate via LDAPS.
For this scenario, since there is no need to communicate
securely during the <b>pkispawn</b>
installation/configuration, simply use <b>pkispawn</b> to
install and configure the CA using the LDAP port of the
directory server, issue an SSL certificate from this CA for
the directory server, and then reconfigure the CA and
directory server to communicate with each other via
LDAPS.</p>

<p style="margin-left:22%; margin-top: 1em">* Similar to
the previous scenario, a directory server exists which is
currently running LDAP, and the desire is to create a CA and
use it to establish LDAPS communications between this CA and
this directory server. However, for this scenario, there is
a need for the CA and the directory server to communicate
securely during <b>pkispawn</b> installation and
configuration. For this to succeed, the directory server
must generate a temporary self-signed certificate which then
must be made available via a PEM file (e.g.
$HOME/dscacert.pem) prior to running <b>pkispawn</b>. Once
the CA has been created, swap things out to reconfigure the
CA and directory server to utilize LDAPS through the desired
certificates.</p>

<p style="margin-left:11%; margin-top: 1em">The following
example demonstrates the steps to generate a temporary
self-signed certificate in the Directory Server which
requires an Admin Server. Directory Server and Admin Server
instances can be created with the following command:</p>


<p style="margin-left:22%; margin-top: 1em"><b>setup-ds-admin.pl</b></p>

<p style="margin-left:11%; margin-top: 1em">Enable LDAPS in
the Directory Server with the following command:</p>


<p style="margin-left:22%; margin-top: 1em"><b>/usr/sbin/setupssl2.sh
/etc/dirsrv/</b><i>slapd-pki</i> <b>389 636</b>
<i>Secret123</i></p>

<p style="margin-left:11%; margin-top: 1em"><b>Note:</b>
The <b>setupssl2.sh</b> script may be downloaded from
<b>https://raw.githubusercontent.com/richm/scripts/master/setupssl2.sh</b>.</p>

<p style="margin-left:11%; margin-top: 1em">Restart the
Directory Server with the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>systemctl
restart dirsrv.target</b></p>

<p style="margin-left:11%; margin-top: 1em">Verify that a
client can connect securely over LDAPS with the following
command:</p>


<p style="margin-left:22%; margin-top: 1em"><b>/usr/lib64/mozldap/ldapsearch
-Z -h</b> <i>pki.example.com</i> <b>-p 636 -D
&rsquo;cn=Directory Manager&rsquo; -w</b> <i>Secret123</i>
<b>-b</b> <i>&quot;dc=example, dc=com&quot;</i>
<b>&quot;objectclass=*&quot;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>Note:</b>
The <b>mozldap ldapsearch</b> utility is available from the
<b>mozldap-tools</b> package.</p>

<p style="margin-left:11%; margin-top: 1em">Export the
self-signed CA certificate with the following command:</p>

<p style="margin-left:22%; margin-top: 1em"><b>certutil -L
-d /etc/dirsrv/</b><i>slapd-pki</i> <b>-n &quot;CA
certificate&quot; -a &gt;</b> <i>$HOME/dscacert.pem</i></p>

<p style="margin-left:11%; margin-top: 1em">Once the
self-signed CA certificate is obtained, add the following
parameters into the [DEFAULT] section in
<i>myconfig.txt</i>:</p>


<p style="margin-left:22%; margin-top: 1em">pki_ds_secure_connection=True
<br>

pki_ds_secure_connection_ca_pem_file=<i>$HOME/dscacert.pem</i></p>

<p style="margin-left:11%; margin-top: 1em">Then execute
<b>pkispawn</b> to create the CA subsystem.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Managing PKI
instance</b></p>

<p style="margin-left:11%; margin-top: 1em">To start all
389 instances (local PKI databases):</p>

<p style="margin-left:22%; margin-top: 1em"><b>systemctl
start dirsrv.target</b></p>

<p style="margin-left:11%; margin-top: 1em">To stop all 389
instances (local PKI databases):</p>

<p style="margin-left:22%; margin-top: 1em"><b>systemctl
stop dirsrv.target</b></p>

<p style="margin-left:11%; margin-top: 1em">To restart all
389 instances (local PKI databases):</p>

<p style="margin-left:22%; margin-top: 1em"><b>systemctl
restart dirsrv.target</b></p>

<p style="margin-left:11%; margin-top: 1em">To obtain the
status of all 389 instances (local PKI databases):</p>

<p style="margin-left:22%; margin-top: 1em"><b>systemctl
status dirsrv.target</b></p>

<p style="margin-left:11%; margin-top: 1em">To start a PKI
instance named &lt;pki_instance_name&gt;:</p>

<p style="margin-left:22%; margin-top: 1em"><b>systemctl
start pki-tomcatd@&lt;pki_instance_name&gt;.service</b></p>

<p style="margin-left:11%; margin-top: 1em">To stop a PKI
instance named &lt;pki_instance_name&gt;:</p>

<p style="margin-left:22%; margin-top: 1em"><b>systemctl
stop pki-tomcatd@&lt;pki_instance_name&gt;.service</b></p>

<p style="margin-left:11%; margin-top: 1em">To restart a
PKI instance named &lt;pki_instance_name&gt;:</p>

<p style="margin-left:22%; margin-top: 1em"><b>systemctl
restart
pki-tomcatd@&lt;pki_instance_name&gt;.service</b></p>

<p style="margin-left:11%; margin-top: 1em">To obtain the
status of a PKI instance named
&lt;pki_instance_name&gt;:</p>

<p style="margin-left:22%; margin-top: 1em"><b>systemctl
status pki-tomcatd@&lt;pki_instance_name&gt;.service</b></p>

<p style="margin-left:11%; margin-top: 1em">To obtain a
detailed status of a Tomcat PKI instance named
&lt;pki_instance_name&gt;:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkidaemon
status tomcat &lt;pki_instance_name&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">To obtain a
detailed status of all Tomcat PKI instances:</p>

<p style="margin-left:22%; margin-top: 1em"><b>pkidaemon
status tomcat</b></p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Report bugs to
http://bugzilla.redhat.com.</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Ade Lee
&lt;alee@redhat.com&gt;. <b>pkispawn</b> was written by the
Certificate Server project.</p>

<h2>COPYRIGHT
<a name="COPYRIGHT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Copyright (c)
2012 Red Hat, Inc. This is licensed under the GNU General
Public License, version 2 (GPLv2). A copy of this license is
available at
http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>pkidestroy(8),
pki_default.cfg(5), pki(1), setup-ds.pl(8)</b></p>
<hr>
</body>
</html>
