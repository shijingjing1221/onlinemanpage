<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 20:42:37 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>LIBPAF-DSC</title>

</head>
<body>

<h1 align="center">LIBPAF-DSC</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#RETURN VALUE">RETURN VALUE</a><br>
<a href="#ERRORS">ERRORS</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#NOTES">NOTES</a><br>
<a href="#VERSIONS">VERSIONS</a><br>
<a href="#REFERENCES">REFERENCES</a><br>
<a href="#REPORTING BUGS">REPORTING BUGS</a><br>
<a href="#AUTHORS">AUTHORS</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">libpaf-dsc
&minus; The Power Architecture Facilities Data Stream
Control Library</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>#include
&lt;paf/dsc.h&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>uint64_t
paf_dsc_check_support(void);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
paf_dsc_get(uint64_t</b> <i>*dscr</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
paf_dsc_set(uint64_t</b> <i>dscr</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em">Compile and
link with <i>&minus;lpaf&minus;dsc</i>.</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The Power
Architecture&reg; Facilities <b>Data Stream Control
Library</b> (<b>libpaf-dsc</b>) is a part of the Power
Architecture Facilities Library (<b>PAFLib</b>)</p>

<p style="margin-left:11%; margin-top: 1em">The Data Stream
Control Library provides a mechanism to interact with the
Data Stream Control Register (<b>DSCR</b>) available on
Power Architecture. This register follows the layout
specified in the corresponding Power ISA, with the following
defined flags.</p>

<p style="margin-left:11%; margin-top: 1em">These are
features supported by Power ISA 2.05:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="44%">


<p><b>DSCR_SSE</b> Store Stream Enable.</p></td>
<td width="42%">
</td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">These features
were added on Power ISA 2.06:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="2%"></td>
<td width="51%">


<p style="margin-top: 1em"><b>DSCR_SNSE</b> Stride-N Stream
Enable.</p> </td>
<td width="35%">
</td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">These features
were added on Power ISA 2.06+:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="2%"></td>
<td width="44%">


<p style="margin-top: 1em"><b>DSCR_LSD</b> Load Stream
Disable.</p> </td>
<td width="42%">
</td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">These are
supported only on Power ISA 2.07:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="2%"></td>
<td width="57%">


<p style="margin-top: 1em"><b>DSCR_HWUE</b> Hardware Unit
count Enable.</p></td>
<td width="29%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="57%">


<p><b>DSCR_SWUE</b> Software Unit count Enable.</p></td>
<td width="29%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="57%">


<p><b>DSCR_LTE</b> Load Transient Enable.</p></td>
<td width="29%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="57%">


<p><b>DSCR_STE</b> Software Transient Enable.</p></td>
<td width="29%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="57%">


<p><b>DSCR_HTE</b> Hardware Transient Enable.</p></td>
<td width="29%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="57%">


<p><b>DSCR_SWTE</b> Software Transient Enable.</p></td>
<td width="29%">
</td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">There are also
other settings whose variable value can be accessed using
the following macros: <b><br>
DSCR_DPFD_GET(dscr) <br>
DSCR_DPFD_SET(dscr,</b>value)</p>

<p style="margin-left:22%;">Default Prefetch Depth. This
field supplies a prefetch depth for hardware-detected
streams and for software-defined streams. The possible
values for this field are the following:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="18%">


<p>0 default</p></td>
<td width="68%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="18%">


<p>1 none</p></td>
<td width="68%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="18%">


<p>2 shallowest</p></td>
<td width="68%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="18%">


<p>3 shallow</p></td>
<td width="68%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="18%">


<p>4 medium</p></td>
<td width="68%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="18%">


<p>5 deep</p></td>
<td width="68%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="18%">


<p>6 deeper</p></td>
<td width="68%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="18%">


<p>7 deepest</p></td>
<td width="68%">
</td></tr>
</table>

<p style="margin-left:14%; margin-top: 1em">This setting
was introduced on Power ISA 2.05.</p>

<p style="margin-left:11%;"><b>DSCR_URG_GET(dscr) <br>
DSCR_URG_SET(dscr,</b>value)</p>

<p style="margin-left:14%;">Depth Attainment Urgency. This
field indicates how quickly the prefetch depth should be
reached for hardware-detected streams. These are the
following possible values:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="21%">


<p>0 default</p></td>
<td width="65%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="21%">


<p>1 not urgent</p></td>
<td width="65%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="21%">


<p>2 least urgent</p></td>
<td width="65%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="21%">


<p>3 less urgent</p></td>
<td width="65%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="21%">


<p>4 medium</p></td>
<td width="65%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="21%">


<p>5 urgent</p></td>
<td width="65%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="21%">


<p>6 more urgent</p></td>
<td width="65%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="21%">


<p>7 most urgent</p></td>
<td width="65%">
</td></tr>
</table>

<p style="margin-left:14%; margin-top: 1em">This setting
was added on Power ISA 2.06+.</p>

<p style="margin-left:11%;"><b>DSCR_UNITCNT_GET(dscr) <br>
DSCR_UNITCNT_SET(dscr,</b>value)</p>

<p style="margin-left:14%;">Number of units in data stream.
This field can have a value between 0 and 1023. This setting
was added on Power ISA 2.07.</p>

<p style="margin-left:11%; margin-top: 1em">For tips about
how to use the macros above, see the section EXAMPLES.</p>

<p style="margin-left:11%; margin-top: 1em">The function
<b>paf_dsc_check_support()</b> checks the available DSCR
features, returning the bit flags and fields supported by
the processor.</p>

<p style="margin-left:11%; margin-top: 1em">The function
<b>paf_dsc_get()</b> retrieves the current DSCR content and
copies to <i>*dscr</i></p>

<p style="margin-left:11%; margin-top: 1em">The function
<b>paf_dsc_set()</b> sets the current DSCR content to
<i>dscr</i></p>

<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><i><b>paf_dsc_check_support()</b></i>
returns a bitmask with the value of Data Stream Control
Register or 0 if unsupported.</p>


<p style="margin-left:11%; margin-top: 1em"><b>paf_dsc_get()</b>
return 0 in case of success or -1 otherwise.</p>


<p style="margin-left:11%; margin-top: 1em"><b>paf_dsc_set()</b>
return 0 in case of success or -1 otherwise.</p>

<h2>ERRORS
<a name="ERRORS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p style="margin-top: 1em"><b>ENOSYS</b></p></td>
<td width="2%"></td>
<td width="69%">


<p style="margin-top: 1em">if the system does not support
DSCR facility.</p></td>
<td width="9%">
</td></tr>
</table>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Program
source</b> <br>
#include &lt;inttypes.h&gt; <br>
#include &lt;paf/dsc.h&gt; <br>
#include &lt;assert.h&gt;</p>

<p style="margin-left:11%; margin-top: 1em">int main(void)
<br>
{ <br>
uint64_t dscr, dscr_support; <br>
int dpfd_value;</p>


<p style="margin-left:11%; margin-top: 1em">assert((dscr_support
= paf_dsc_check_support()) &gt; 0);</p>

<p style="margin-left:11%; margin-top: 1em">/* Check if the
system supports DSCR_SSE */ <br>
if ((dscr_support | DSCR_SSE) == dscr_support) <br>
{ <br>
assert(paf_dsc_get(&amp;dscr) == 0); <br>
assert(paf_dsc_set(dscr | DSCR_SSE) == 0); <br>
}</p>


<p style="margin-left:11%; margin-top: 1em">assert(paf_dsc_get(&amp;dscr)
== 0);</p>

<p style="margin-left:11%; margin-top: 1em">/* Retrieve the
current Default Prefetch Depth value */ <br>
dpfd_value = DSCR_DPFD_GET(dscr);</p>

<p style="margin-left:11%; margin-top: 1em">/* Check if the
system supports DSCR_UNITCNT */ <br>
if ((dscr_support | DSCR_UNITCNT_SET(dscr, 256)) ==
dscr_support) <br>
{ <br>
dscr = DSCR_UNITCNT_SET(dscr, 256); <br>
assert(paf_dsc_set(dscr) == 0); <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">return 0; <br>
}</p>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">In order to
check if the DSCR instructions are supported by the kernel,
the library uses a signal handler for SIGILL during its
initialization.</p>

<h2>VERSIONS
<a name="VERSIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The Data Stream
Control Register (DSCR) [Category: Stream] is a Power
Architecture hardware facility available since Power ISA
2.05 as privileged-state, and ISA 2.07 as problem-state,
that affects how the processor handles hardware-detected and
software-defined data streams.</p>

<p style="margin-left:11%; margin-top: 1em">DSCR emulation
on pre-ISA 2.07 hardware is provided in Linux Kernel
3.10-cr1. DSCR problem-state availability is exported in
Linux Kernel 3.10-rc1.</p>

<h2>REFERENCES
<a name="REFERENCES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Power
ISA&trade; Version 2.05 <br>
Power ISA&trade; Version 2.06 <br>
Power ISA&trade; Version 2.06+ <br>
Power ISA&trade; Version 2.07</b></p>

<h2>REPORTING BUGS
<a name="REPORTING BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Email bug
reports to Edjunior B. Machado
&lt;emachado@linux.vnet.ibm.com&gt;.</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This manual
page was written by Edjunior B. Machado
&lt;emachado@linux.vnet.ibm.com&gt; and Adhemerval Zanella
&lt;azanella@linux.vnet.ibm.com&gt;.</p>
<hr>
</body>
</html>
