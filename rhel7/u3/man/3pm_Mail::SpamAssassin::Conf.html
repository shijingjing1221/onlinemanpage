<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 21:54:31 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>Mail::SpamAssassin::Conf</title>

</head>
<body>

<h1 align="center">Mail::SpamAssassin::Conf</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#FILE FORMAT">FILE FORMAT</a><br>
<a href="#USER PREFERENCES">USER PREFERENCES</a><br>
<a href="#RULE DEFINITIONS AND PRIVILEGED SETTINGS">RULE DEFINITIONS AND PRIVILEGED SETTINGS</a><br>
<a href="#ADMINISTRATOR SETTINGS">ADMINISTRATOR SETTINGS</a><br>
<a href="#PREPROCESSING OPTIONS">PREPROCESSING OPTIONS</a><br>
<a href="#TEMPLATE TAGS">TEMPLATE TAGS</a><br>
<a href="#LOCALI[SZ]ATION">LOCALI[SZ]ATION</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">Mail::SpamAssassin::Conf
&minus; SpamAssassin configuration file</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<pre style="margin-left:11%; margin-top: 1em">  # a comment
  rewrite_header Subject          *****SPAM*****
  full PARA_A_2_C_OF_1618         /Paragraph .a.{0,10}2.{0,10}C. of S. 1618/i
  describe PARA_A_2_C_OF_1618     Claims compliance with senate bill 1618
  header FROM_HAS_MIXED_NUMS      From =~ /\d+[a&minus;z]+\d+\S*@/i
  describe FROM_HAS_MIXED_NUMS    From: contains numbers mixed in with letters
  score A_HREF_TO_REMOVE          2.0
  lang es describe FROM_FORGED_HOTMAIL Forzado From: simula ser de hotmail.com
  lang pt_BR report O programa detetor de Spam ZOE [...]</pre>


<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">SpamAssassin is
configured using traditional UNIX-style configuration files,
loaded from the <tt>&quot;/usr/share/spamassassin&quot;</tt>
and <tt>&quot;/etc/mail/spamassassin&quot;</tt>
directories.</p>

<p style="margin-left:11%; margin-top: 1em">The following
web page lists the most important configuration settings
used to configure SpamAssassin; novices are encouraged to
read it first:</p>

<pre style="margin-left:11%; margin-top: 1em">  http://wiki.apache.org/spamassassin/ImportantInitialConfigItems</pre>


<h2>FILE FORMAT
<a name="FILE FORMAT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;#&quot;</tt> character starts a comment, which
continues until end of line. <b><small>NOTE:</small></b> if
the <tt>&quot;#&quot;</tt> character is to be used as part
of a rule or configuration option, it must be escaped with a
backslash. i.e.: <tt>&quot;\#&quot;</tt></p>

<p style="margin-left:11%; margin-top: 1em">Whitespace in
the files is not significant, but please note that starting
a line with whitespace is deprecated, as we reserve its use
for multi-line rule definitions, at some point in the
future.</p>

<p style="margin-left:11%; margin-top: 1em">Currently, each
rule or configuration setting must fit on one-line;
multi-line settings are not supported yet.</p>

<p style="margin-left:11%; margin-top: 1em">File and
directory paths can use <tt>&quot;~&quot;</tt> to refer to
the user&rsquo;s home directory, but no other shell-style
path extensions such as globing or
<tt>&quot;~user/&quot;</tt> are supported.</p>

<p style="margin-left:11%; margin-top: 1em">Where
appropriate below, default values are listed in
parentheses.</p>

<h2>USER PREFERENCES
<a name="USER PREFERENCES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The following
options can be used in both site-wide
(<tt>&quot;local.cf&quot;</tt>) and user-specific
(<tt>&quot;user_prefs&quot;</tt>) configuration files to
customize how SpamAssassin handles incoming email
messages.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>SCORING
OPTIONS</small></b> <br>
required_score n.nn (default: 5)</p>

<p style="margin-left:17%;">Set the score required before a
mail is considered spam. <tt>&quot;n.nn&quot;</tt> can be an
integer or a real number. 5.0 is the default setting, and is
quite aggressive; it would be suitable for a single-user
setup, but if you&rsquo;re an <small>ISP</small> installing
SpamAssassin, you should probably set the default to be more
conservative, like 8.0 or 10.0. It is not recommended to
automatically delete or discard messages marked as spam, as
your users <b>will</b> complain, but if you choose to do so,
only delete messages with an exceptionally high score such
as 15.0 or higher. This option was previously known as
<tt>&quot;required_hits&quot;</tt> and that name is still
accepted, but is deprecated.</p>

<p style="margin-left:11%;">score
<small>SYMBOLIC_TEST_NAME</small> n.nn [ n.nn n.nn n.nn
]</p>

<p style="margin-left:17%;">Assign scores (the number of
points for a hit) to a given test. Scores can be positive or
negative real numbers or integers.
<tt>&quot;SYMBOLIC_TEST_NAME&quot;</tt> is the symbolic name
used by SpamAssassin for that test; for example, &rsquo;
<small>FROM_ENDS_IN_NUMS</small> &rsquo;.</p>

<p style="margin-left:17%; margin-top: 1em">If only one
valid score is listed, then that score is always used for a
test.</p>

<p style="margin-left:17%; margin-top: 1em">If four valid
scores are listed, then the score that is used depends on
how SpamAssassin is being used. The first score is used when
both Bayes and network tests are disabled (score set 0). The
second score is used when Bayes is disabled, but network
tests are enabled (score set 1). The third score is used
when Bayes is enabled and network tests are disabled (score
set 2). The fourth score is used when Bayes is enabled and
network tests are enabled (score set 3).</p>

<p style="margin-left:17%; margin-top: 1em">Setting a
rule&rsquo;s score to 0 will disable that rule from
running.</p>

<p style="margin-left:17%; margin-top: 1em">If any of the
score values are surrounded by parenthesis &rsquo;()&rsquo;,
then all of the scores in the line are considered to be
relative to the already set score. ie: &rsquo;(3)&rsquo;
means increase the score for this rule by 3 points in all
score sets. &rsquo;(3) (0) (3) (0)&rsquo; means increase the
score for this rule by 3 in score sets 0 and 2 only.</p>

<p style="margin-left:17%; margin-top: 1em">If no score is
given for a test by the end of the configuration, a default
score is assigned: a score of 1.0 is used for all tests,
except those whose names begin with &rsquo;T_&rsquo; (this
is used to indicate a rule in testing) which receive
0.01.</p>

<p style="margin-left:17%; margin-top: 1em">Note that test
names which begin with &rsquo;__&rsquo; are indirect rules
used to compose meta-match rules and can also act as
prerequisites to other rules. They are not scored or listed
in the &rsquo;tests hit&rsquo; reports, but assigning a
score of 0 to an indirect rule will disable it from
running.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>WHITELIST
AND BLACKLIST OPTIONS</small></b> <br>
whitelist_from user@example.com</p>

<p style="margin-left:17%;">Used to whitelist sender
addresses which send mail that is often tagged (incorrectly)
as spam.</p>

<p style="margin-left:17%; margin-top: 1em">Use of this
setting is not recommended, since it blindly trusts the
message, which is routinely and easily forged by spammers
and phish senders. The recommended solution is to instead
use <tt>&quot;whitelist_auth&quot;</tt> or other
authenticated whitelisting methods, or
<tt>&quot;whitelist_from_rcvd&quot;</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">Whitelist and
blacklist addresses are now file-glob-style patterns, so
<tt>&quot;friend@somewhere.com&quot;</tt>,
<tt>&quot;*@isp.com&quot;</tt>, or
<tt>&quot;*.domain.net&quot;</tt> will all work.
Specifically, <tt>&quot;*&quot;</tt> and
<tt>&quot;?&quot;</tt> are allowed, but all other
metacharacters are not. Regular expressions are not used for
security reasons. Matching is case-insensitive.</p>

<p style="margin-left:17%; margin-top: 1em">Multiple
addresses per line, separated by spaces, is
<small>OK.</small> Multiple
<tt>&quot;whitelist_from&quot;</tt> lines are also
<small>OK.</small></p>

<p style="margin-left:17%; margin-top: 1em">The headers
checked for whitelist addresses are as follows: if
<tt>&quot;Resent&minus;From&quot;</tt> is set, use that;
otherwise check all addresses taken from the following set
of headers:</p>

<pre style="margin-left:17%; margin-top: 1em">        Envelope&minus;Sender
        Resent&minus;Sender
        X&minus;Envelope&minus;From
        From</pre>


<p style="margin-left:17%; margin-top: 1em">In addition,
the &quot;envelope sender&quot; data, taken from the
<small>SMTP</small> envelope data where this is available,
is looked up. See
<tt>&quot;envelope_sender_header&quot;</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">e.g.</p>

<pre style="margin-left:17%; margin-top: 1em">  whitelist_from joe@example.com fred@example.com
  whitelist_from *@example.com</pre>


<p style="margin-left:11%;">unwhitelist_from
user@example.com</p>

<p style="margin-left:17%;">Used to override a default
whitelist_from entry, so for example a distribution
whitelist_from can be overridden in a local.cf file, or an
individual user can override a whitelist_from entry in their
own <tt>&quot;user_prefs&quot;</tt> file. The specified
email address has to match exactly (although
case-insensitively) the address previously used in a
whitelist_from line, which implies that a wildcard only
matches literally the same wildcard (not &rsquo;any&rsquo;
address).</p>

<p style="margin-left:17%; margin-top: 1em">e.g.</p>

<pre style="margin-left:17%; margin-top: 1em">  unwhitelist_from joe@example.com fred@example.com
  unwhitelist_from *@example.com</pre>


<p style="margin-left:11%;">whitelist_from_rcvd
addr@lists.sourceforge.net sourceforge.net</p>

<p style="margin-left:17%;">Works similarly to
whitelist_from, except that in addition to matching a sender
address, a relay&rsquo;s rDNS name or its <small>IP</small>
address must match too for the whitelisting rule to fire.
The first parameter is a sender&rsquo;s e&minus;mail address
to whitelist, and the second is a string to match the
relay&rsquo;s rDNS, or its <small>IP</small> address.
Matching is case-insensitive.</p>

<p style="margin-left:17%; margin-top: 1em">This second
parameter is matched against the TCP-info information field
as provided in a <small>FROM</small> clause of a trace
information (i.e. the Received header field, see <small>RFC
5321</small> ). Only the Received header fields inserted by
trusted hosts are considered. This parameter can either be a
full hostname, or the domain component of that hostname, or
an <small>IP</small> address in square brackets. The reverse
<small>DNS</small> lookup is done by a <small>MTA,</small>
not by SpamAssassin.</p>

<p style="margin-left:17%; margin-top: 1em">In case of an
IPv4 address in brackets, it may be truncated on classful
boundaries to cover whole subnets, e.g.
<tt>&quot;[10.1.2.3]&quot;</tt>,
<tt>&quot;[10.1.2]&quot;</tt>, <tt>&quot;[10.1]&quot;</tt>,
<tt>&quot;[10]&quot;</tt>. <small>CIDR</small> notation is
currently not supported, nor is IPv6. The matching on
<small>IP</small> address is mainly provided to cover rare
cases where whitelisting of a sending <small>MTA</small> is
desired which does not have a correct reverse
<small>DNS</small> configured.</p>

<p style="margin-left:17%; margin-top: 1em">In other words,
if the host that connected to your <small>MX</small> had an
<small>IP</small> address 192.0.2.123 that mapped to
&rsquo;sendinghost.example.org&rsquo;, you should specify
<tt>&quot;sendinghost.example.org&quot;</tt>, or
<tt>&quot;example.org&quot;</tt>, or
<tt>&quot;[192.0.2.123]&quot;</tt> or
<tt>&quot;[192.0.2]&quot;</tt> here.</p>

<p style="margin-left:17%; margin-top: 1em">Note that this
requires that <tt>&quot;internal_networks&quot;</tt> be
correct. For simple cases, it will be, but for a complex
network you may get better results by setting that
parameter.</p>

<p style="margin-left:17%; margin-top: 1em">It also
requires that your mail exchangers be configured to perform
<small>DNS</small> reverse lookups on the connecting
host&rsquo;s <small>IP</small> address, and to record the
result in the generated Received header field according to
<small>RFC 5321.</small></p>

<p style="margin-left:17%; margin-top: 1em">e.g.</p>

<pre style="margin-left:17%; margin-top: 1em">  whitelist_from_rcvd joe@example.com  example.com
  whitelist_from_rcvd *@axkit.org      sergeant.org
  whitelist_from_rcvd *@axkit.org      [192.0.2.123]</pre>


<p style="margin-left:11%;">def_whitelist_from_rcvd
addr@lists.sourceforge.net sourceforge.net</p>

<p style="margin-left:17%;">Same as
<tt>&quot;whitelist_from_rcvd&quot;</tt>, but used for the
default whitelist entries in the SpamAssassin distribution.
The whitelist score is lower, because these are often
targets for spammer spoofing.</p>

<p style="margin-left:11%;">whitelist_allows_relays
user@example.com</p>

<p style="margin-left:17%;">Specify addresses which are in
<tt>&quot;whitelist_from_rcvd&quot;</tt> that sometimes send
through a mail relay other than the listed ones. By default
mail with a From address that is in
<tt>&quot;whitelist_from_rcvd&quot;</tt> that does not match
the relay will trigger a forgery rule. Including the address
in <tt>&quot;whitelist_allows_relay&quot;</tt> prevents
that.</p>

<p style="margin-left:17%; margin-top: 1em">Whitelist and
blacklist addresses are now file-glob-style patterns, so
<tt>&quot;friend@somewhere.com&quot;</tt>,
<tt>&quot;*@isp.com&quot;</tt>, or
<tt>&quot;*.domain.net&quot;</tt> will all work.
Specifically, <tt>&quot;*&quot;</tt> and
<tt>&quot;?&quot;</tt> are allowed, but all other
metacharacters are not. Regular expressions are not used for
security reasons. Matching is case-insensitive.</p>

<p style="margin-left:17%; margin-top: 1em">Multiple
addresses per line, separated by spaces, is
<small>OK.</small> Multiple
<tt>&quot;whitelist_allows_relays&quot;</tt> lines are also
<small>OK.</small></p>

<p style="margin-left:17%; margin-top: 1em">The specified
email address does not have to match exactly the address
previously used in a whitelist_from_rcvd line as it is
compared to the address in the header.</p>

<p style="margin-left:17%; margin-top: 1em">e.g.</p>

<pre style="margin-left:17%; margin-top: 1em">  whitelist_allows_relays joe@example.com fred@example.com
  whitelist_allows_relays *@example.com</pre>


<p style="margin-left:11%;">unwhitelist_from_rcvd
user@example.com</p>

<p style="margin-left:17%;">Used to override a default
whitelist_from_rcvd entry, so for example a distribution
whitelist_from_rcvd can be overridden in a local.cf file, or
an individual user can override a whitelist_from_rcvd entry
in their own <tt>&quot;user_prefs&quot;</tt> file.</p>

<p style="margin-left:17%; margin-top: 1em">The specified
email address has to match exactly the address previously
used in a whitelist_from_rcvd line.</p>

<p style="margin-left:17%; margin-top: 1em">e.g.</p>

<pre style="margin-left:17%; margin-top: 1em">  unwhitelist_from_rcvd joe@example.com fred@example.com
  unwhitelist_from_rcvd *@axkit.org</pre>


<p style="margin-left:11%;">blacklist_from
user@example.com</p>

<p style="margin-left:17%;">Used to specify addresses which
send mail that is often tagged (incorrectly) as non-spam,
but which the user doesn&rsquo;t want. Same format as
<tt>&quot;whitelist_from&quot;</tt>.</p>

<p style="margin-left:11%;">unblacklist_from
user@example.com</p>

<p style="margin-left:17%;">Used to override a default
blacklist_from entry, so for example a distribution
blacklist_from can be overridden in a local.cf file, or an
individual user can override a blacklist_from entry in their
own <tt>&quot;user_prefs&quot;</tt> file. The specified
email address has to match exactly the address previously
used in a blacklist_from line.</p>

<p style="margin-left:17%; margin-top: 1em">e.g.</p>

<pre style="margin-left:17%; margin-top: 1em">  unblacklist_from joe@example.com fred@example.com
  unblacklist_from *@spammer.com</pre>


<p style="margin-left:11%;">whitelist_to
user@example.com</p>

<p style="margin-left:17%;">If the given address appears as
a recipient in the message headers (Resent-To, To, Cc,
obvious envelope recipient, etc.) the mail will be
whitelisted. Useful if you&rsquo;re deploying SpamAssassin
system-wide, and don&rsquo;t want some users to have their
mail filtered. Same format as
<tt>&quot;whitelist_from&quot;</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">There are three
levels of To-whitelisting,
<tt>&quot;whitelist_to&quot;</tt>,
<tt>&quot;more_spam_to&quot;</tt> and
<tt>&quot;all_spam_to&quot;</tt>. Users in the first level
may still get some spammish mails blocked, but users in
<tt>&quot;all_spam_to&quot;</tt> should never get mail
blocked.</p>

<p style="margin-left:17%; margin-top: 1em">The headers
checked for whitelist addresses are as follows: if
<tt>&quot;Resent&minus;To&quot;</tt> or
<tt>&quot;Resent&minus;Cc&quot;</tt> are set, use those;
otherwise check all addresses taken from the following set
of headers:</p>

<pre style="margin-left:17%; margin-top: 1em">        To
        Cc
        Apparently&minus;To
        Delivered&minus;To
        Envelope&minus;Recipients
        Apparently&minus;Resent&minus;To
        X&minus;Envelope&minus;To
        Envelope&minus;To
        X&minus;Delivered&minus;To
        X&minus;Original&minus;To
        X&minus;Rcpt&minus;To
        X&minus;Real&minus;To</pre>


<p style="margin-left:11%;">more_spam_to
user@example.com</p>

<p style="margin-left:17%;">See above.</p>

<p style="margin-left:11%;">all_spam_to
user@example.com</p>

<p style="margin-left:17%;">See above.</p>

<p style="margin-left:11%;">blacklist_to
user@example.com</p>

<p style="margin-left:17%;">If the given address appears as
a recipient in the message headers (Resent-To, To, Cc,
obvious envelope recipient, etc.) the mail will be
blacklisted. Same format as
<tt>&quot;blacklist_from&quot;</tt>.</p>

<p style="margin-left:11%;">whitelist_auth
user@example.com</p>

<p style="margin-left:17%;">Used to specify addresses which
send mail that is often tagged (incorrectly) as spam. This
is different from <tt>&quot;whitelist_from&quot;</tt> and
<tt>&quot;whitelist_from_rcvd&quot;</tt> in that it first
verifies that the message was sent by an authorized sender
for the address, before whitelisting.</p>

<p style="margin-left:17%; margin-top: 1em">Authorization
is performed using one of the installed sender-authorization
schemes: <small>SPF</small> (using
<tt>&quot;Mail::SpamAssassin::Plugin::SPF&quot;</tt>), or
<small>DKIM</small> (using
<tt>&quot;Mail::SpamAssassin::Plugin::DKIM&quot;</tt>). Note
that those plugins must be active, and working, for this to
operate.</p>

<p style="margin-left:17%; margin-top: 1em">Using
<tt>&quot;whitelist_auth&quot;</tt> is roughly equivalent to
specifying duplicate
<tt>&quot;whitelist_from_spf&quot;</tt>,
<tt>&quot;whitelist_from_dk&quot;</tt>, and
<tt>&quot;whitelist_from_dkim&quot;</tt> lines for each of
the addresses specified.</p>

<p style="margin-left:17%; margin-top: 1em">e.g.</p>

<pre style="margin-left:17%; margin-top: 1em">  whitelist_auth joe@example.com fred@example.com
  whitelist_auth *@example.com</pre>


<p style="margin-left:11%;">def_whitelist_auth
user@example.com</p>

<p style="margin-left:17%;">Same as
<tt>&quot;whitelist_auth&quot;</tt>, but used for the
default whitelist entries in the SpamAssassin distribution.
The whitelist score is lower, because these are often
targets for spammer spoofing.</p>

<p style="margin-left:11%;">unwhitelist_auth
user@example.com</p>

<p style="margin-left:17%;">Used to override a
<tt>&quot;whitelist_auth&quot;</tt> entry. The specified
email address has to match exactly the address previously
used in a <tt>&quot;whitelist_auth&quot;</tt> line.</p>

<p style="margin-left:17%; margin-top: 1em">e.g.</p>

<pre style="margin-left:17%; margin-top: 1em">  unwhitelist_auth joe@example.com fred@example.com
  unwhitelist_auth *@example.com</pre>


<p style="margin-left:11%;">enlist_uri_host (listname) host
...</p>

<p style="margin-left:17%;">Adds one or more host names or
domain names to a named list of <small>URI</small> domains.
The named list can then be consulted through a
<i>check_uri_host_listed()</i> eval rule implemented by the
WLBLEval plugin, which takes the list name as an argument.
Parenthesis around a list name are literal &minus; a
required syntax.</p>

<p style="margin-left:17%; margin-top: 1em">Host names may
optionally be prefixed by an exclamantion mark
&rsquo;!&rsquo;, which produces false as a result if this
entry matches. This makes it easier to exclude some
subdomains when their superdomain is listed, for
example:</p>

<pre style="margin-left:17%; margin-top: 1em">  enlist_uri_host (MYLIST) !sub1.example.com !sub2.example.com example.com</pre>


<p style="margin-left:17%; margin-top: 1em">No wildcards
are supported, but subdomains do match implicitly. Lists are
independent. Search for each named list starts by looking up
the full hostname first, then leading fields are
progressively stripped off (e.g.: sub.example.com,
example.com, com) until a match is found or we run out of
fields. The first matching entry (the most specific)
determines if a lookup yielded a true (no &rsquo;!&rsquo;
prefix) or a false (with a &rsquo;!&rsquo; prefix)
result.</p>

<p style="margin-left:17%; margin-top: 1em">If an
<small>URL</small> found in a message contains an
<small>IP</small> address in place of a host name, the given
list must specify the exact same <small>IP</small> address
(instead of a host name) in order to match.</p>

<p style="margin-left:17%; margin-top: 1em">Use the
delist_uri_host directive to neutralize previous
enlist_uri_host settings.</p>

<p style="margin-left:17%; margin-top: 1em">Enlisting to
lists named &rsquo; <small>BLACK</small> &rsquo; and &rsquo;
<small>WHITE</small> &rsquo; have their shorthand directives
blacklist_uri_host and whitelist_uri_host and corresponding
default rules, but the names &rsquo; <small>BLACK</small>
&rsquo; and &rsquo; <small>WHITE</small> &rsquo; are
otherwise not special or reserved.</p>

<p style="margin-left:11%;">delist_uri_host [ (listname) ]
host ...</p>

<p style="margin-left:17%;">Removes one or more specified
host names from a named list of <small>URI</small> domains.
Removing an unlisted name is ignored (is not an error).
Listname is optional, if specified then just the named list
is affected, otherwise hosts are removed from all
<small>URI</small> host lists created so far. Parenthesis
around a list name are a required syntax.</p>

<p style="margin-left:17%; margin-top: 1em">Note that
directives in configuration files are processed in sequence,
the delist_uri_host only applies to previously listed
entries and has no effect on enlisted entries in
yet-to-be-processed directives.</p>

<p style="margin-left:17%; margin-top: 1em">For convenience
(similarity to the enlist_uri_host directive) hostnames may
be prefixed by a an exclamation mark, which is stripped off
from each name and has no meaning here.</p>

<p style="margin-left:11%;">blacklist_uri_host
host-or-domain ...</p>

<p style="margin-left:17%;">Is a shorthand for a directive:
enlist_uri_host ( <small>BLACK</small> ) host ...</p>

<p style="margin-left:17%; margin-top: 1em">Please see
directives enlist_uri_host and delist_uri_host for
details.</p>

<p style="margin-left:11%;">whitelist_uri_host
host-or-domain ...</p>

<p style="margin-left:17%;">Is a shorthand for a directive:
enlist_uri_host ( <small>BLACK</small> ) host ...</p>

<p style="margin-left:17%; margin-top: 1em">Please see
directives enlist_uri_host and delist_uri_host for
details.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>BASIC
MESSAGE TAGGING OPTIONS</small></b> <br>
rewrite_header { subject | from | to }
<small>STRING</small></p>

<p style="margin-left:17%;">By default, suspected spam
messages will not have the <tt>&quot;Subject&quot;</tt>,
<tt>&quot;From&quot;</tt> or <tt>&quot;To&quot;</tt> lines
tagged to indicate spam. By setting this option, the header
will be tagged with <tt>&quot;STRING&quot;</tt> to indicate
that a message is spam. For the From or To headers, this
will take the form of an <small>RFC 2822</small> comment
following the address in parantheses. For the Subject
header, this will be prepended to the original subject. Note
that you should only use the _REQD_ and _SCORE_ tags when
rewriting the Subject header if
<tt>&quot;report_safe&quot;</tt> is 0. Otherwise, you may
not be able to remove the SpamAssassin markup via the normal
methods. More information about tags is explained below in
the <b><small>TEMPLATE TAGS</small></b> section.</p>

<p style="margin-left:17%; margin-top: 1em">Parentheses are
not permitted in <small>STRING</small> if rewriting the From
or To headers. (They will be converted to square
brackets.)</p>

<p style="margin-left:17%; margin-top: 1em">If
<tt>&quot;rewrite_header subject&quot;</tt> is used, but the
message being rewritten does not already contain a
<tt>&quot;Subject&quot;</tt> header, one will be
created.</p>

<p style="margin-left:17%; margin-top: 1em">A null value
for <tt>&quot;STRING&quot;</tt> will remove any existing
rewrite for the specified header.</p>

<p style="margin-left:11%;">add_header { spam | ham | all }
header_name string</p>

<p style="margin-left:17%;">Customized headers can be added
to the specified type of messages (spam, ham, or
&quot;all&quot; to add to either). All headers begin with
<tt>&quot;X&minus;Spam&minus;&quot;</tt> (so a
<tt>&quot;header_name&quot;</tt> Foo will generate a header
called X&minus;Spam-Foo). header_name is restricted to the
character set [A&minus;Za&minus;z0&minus;9_&minus;].</p>

<p style="margin-left:17%; margin-top: 1em">The order of
<tt>&quot;add_header&quot;</tt> configuration options is
preserved, inserted headers will follow this order of
declarations. When combining <tt>&quot;add_header&quot;</tt>
with <tt>&quot;clear_headers&quot;</tt> and
<tt>&quot;remove_header&quot;</tt>, keep in mind that
<tt>&quot;add_header&quot;</tt> appends a new header to the
current list, after first removing any existing header
fields of the same name. Note also that
<tt>&quot;add_header&quot;</tt>,
<tt>&quot;clear_headers&quot;</tt> and
<tt>&quot;remove_header&quot;</tt> may appear in multiple
.cf files, which are interpreted in alphabetic order.</p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;string&quot;</tt>
can contain tags as explained below in the
<b><small>TEMPLATE TAGS</small></b> section. You can also
use <tt>&quot;\n&quot;</tt> and <tt>&quot;\t&quot;</tt> in
the header to add newlines and tabulators as desired. A
backslash has to be written as \\, any other escaped chars
will be silently removed.</p>

<p style="margin-left:17%; margin-top: 1em">All headers
will be folded if fold_headers is set to <tt>1</tt>. Note:
Manually adding newlines via <tt>&quot;\n&quot;</tt>
disables any further automatic wrapping (ie: long header
lines are possible). The lines will still be properly folded
(marked as continuing) though.</p>

<p style="margin-left:17%; margin-top: 1em">You can
customize existing headers with <b>add_header</b> (only the
specified subset of messages will be changed).</p>

<p style="margin-left:17%; margin-top: 1em">See also
<tt>&quot;clear_headers&quot;</tt> and
<tt>&quot;remove_header&quot;</tt> for removing headers.</p>

<p style="margin-left:17%; margin-top: 1em">Here are some
examples (these are the defaults, note that Checker-Version
can not be changed or removed):</p>

<pre style="margin-left:17%; margin-top: 1em">  add_header spam Flag _YESNOCAPS_
  add_header all Status _YESNO_, score=_SCORE_ required=_REQD_ tests=_TESTS_ autolearn=_AUTOLEARN_ version=_VERSION_
  add_header all Level _STARS(*)_
  add_header all Checker&minus;Version SpamAssassin _VERSION_ (_SUBVERSION_) on _HOSTNAME_</pre>


<p style="margin-left:11%;">remove_header { spam | ham |
all } header_name</p>

<p style="margin-left:17%;">Headers can be removed from the
specified type of messages (spam, ham, or &quot;all&quot; to
remove from either). All headers begin with
<tt>&quot;X&minus;Spam&minus;&quot;</tt> (so
<tt>&quot;header_name&quot;</tt> will be appended to
<tt>&quot;X&minus;Spam&minus;&quot;</tt>).</p>

<p style="margin-left:17%; margin-top: 1em">See also
<tt>&quot;clear_headers&quot;</tt> for removing all the
headers at once.</p>

<p style="margin-left:17%; margin-top: 1em">Note that
<b>X&minus;Spam-Checker-Version</b> is not removable because
the version information is needed by mail administrators and
developers to debug problems. Without at least one header,
it might not even be possible to determine that SpamAssassin
is running.</p>

<p style="margin-left:11%;">clear_headers</p>

<p style="margin-left:17%;">Clear the list of headers to be
added to messages. You may use this before any
<b>add_header</b> options to prevent the default headers
from being added to the message.</p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;add_header&quot;</tt>,
<tt>&quot;clear_headers&quot;</tt> and
<tt>&quot;remove_header&quot;</tt> may appear in multiple
.cf files, which are interpreted in alphabetic order, so
<tt>&quot;clear_headers&quot;</tt> in a later file will
remove all added headers from previously interpreted
configuration files, which may or may not be desired.</p>

<p style="margin-left:17%; margin-top: 1em">Note that
<b>X&minus;Spam-Checker-Version</b> is not removable because
the version information is needed by mail administrators and
developers to debug problems. Without at least one header,
it might not even be possible to determine that SpamAssassin
is running.</p>

<p style="margin-left:11%;">report_safe ( 0 | 1 | 2 )
(default: 1)</p>

<p style="margin-left:17%;">if this option is set to 1, if
an incoming message is tagged as spam, instead of modifying
the original message, SpamAssassin will create a new report
message and attach the original message as a message/rfc822
<small>MIME</small> part (ensuring the original message is
completely preserved, not easily opened, and easier to
recover).</p>

<p style="margin-left:17%; margin-top: 1em">If this option
is set to 2, then original messages will be attached with a
content type of text/plain instead of message/rfc822. This
setting may be required for safety reasons on certain broken
mail clients that automatically load attachments without any
action by the user. This setting may also make it somewhat
more difficult to extract or view the original message.</p>

<p style="margin-left:17%; margin-top: 1em">If this option
is set to 0, incoming spam is only modified by adding some
<tt>&quot;X&minus;Spam&minus;&quot;</tt> headers and no
changes will be made to the body. In addition, a header
named <b>X&minus;Spam-Report</b> will be added to spam. You
can use the <b>remove_header</b> option to remove that
header after setting <b>report_safe</b> to 0.</p>

<p style="margin-left:17%; margin-top: 1em">See
<b>report_safe_copy_headers</b> if you want to copy headers
from the original mail into tagged messages.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>LANGUAGE
OPTIONS</small></b> <br>
ok_locales xx [ yy zz ... ] (default: all)</p>

<p style="margin-left:17%;">This option is used to specify
which locales are considered <small>OK</small> for incoming
mail. Mail using the <b>character sets</b> that are allowed
by this option will not be marked as possibly being spam in
a foreign language.</p>

<p style="margin-left:17%; margin-top: 1em">If you receive
lots of spam in foreign languages, and never get any
non-spam in these languages, this may help. Note that all
ISO&minus;8859&minus;* character sets, and Windows code page
character sets, are always permitted by default.</p>

<p style="margin-left:17%; margin-top: 1em">Set this to
<tt>&quot;all&quot;</tt> to allow all character sets. This
is the default.</p>

<p style="margin-left:17%; margin-top: 1em">The rules
<tt>&quot;CHARSET_FARAWAY&quot;</tt>,
<tt>&quot;CHARSET_FARAWAY_BODY&quot;</tt>, and
<tt>&quot;CHARSET_FARAWAY_HEADERS&quot;</tt> are triggered
based on how this is set.</p>

<p style="margin-left:17%; margin-top: 1em">Examples:</p>

<pre style="margin-left:17%; margin-top: 1em">  ok_locales all         (allow all locales)
  ok_locales en          (only allow English)
  ok_locales en ja zh    (allow English, Japanese, and Chinese)</pre>


<p style="margin-left:17%; margin-top: 1em">Note: if there
are multiple ok_locales lines, only the last one is
used.</p>

<p style="margin-left:17%; margin-top: 1em">Select the
locales to allow from the list below: <br>
en &minus; Western character sets in general <br>
ja &minus; Japanese character sets <br>
ko &minus; Korean character sets <br>
ru &minus; Cyrillic character sets <br>
th &minus; Thai character sets <br>
zh &minus; Chinese (both simplified and traditional)
character sets</p>

<p style="margin-left:11%;">normalize_charset ( 0 | 1)
(default: 0)</p>

<p style="margin-left:17%;">Whether to detect character
sets and normalize message content to Unicode. Requires the
Encode::Detect module, HTML::Parser version 3.46 or later,
and Perl 5.8.5 or later.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>NETWORK
TEST OPTIONS</small></b> <br>
trusted_networks IPaddress[/masklen] ... (default: none)</p>

<p style="margin-left:17%;">What networks or hosts are
&rsquo;trusted&rsquo; in your setup. <b>Trusted</b> in this
case means that relay hosts on these networks are considered
to not be potentially operated by spammers, open relays, or
open proxies. A trusted host could conceivably relay spam,
but will not originate it, and will not forge header data.
<small>DNS</small> blacklist checks will never query for
hosts on these networks.</p>

<p style="margin-left:17%; margin-top: 1em">See
<tt>&quot;http://wiki.apache.org/spamassassin/TrustPath&quot;</tt>
for more information.</p>

<p style="margin-left:17%; margin-top: 1em">MXes for your
domain(s) and internal relays should <b>also</b> be
specified using the <tt>&quot;internal_networks&quot;</tt>
setting. When there are &rsquo;trusted&rsquo; hosts that are
not MXes or internal relays for your domain(s) they should
<b>only</b> be specified in
<tt>&quot;trusted_networks&quot;</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">The
<tt>&quot;IPaddress&quot;</tt> can be an IPv4 address (in a
dot-quad form), or an IPv6 address optionally enclosed in
square brackets. Scoped link-local IPv6 addresses are
syntactically recognized but the interface scope is
currently ignored (e.g. [fe80::1234%eth0] ) and should be
avoided.</p>

<p style="margin-left:17%; margin-top: 1em">If a
<tt>&quot;/masklen&quot;</tt> is specified, it is considered
a CIDR-style &rsquo;netmask&rsquo; length, specified in
bits. If it is not specified, but less than 4 octets of an
IPv4 address are specified with a trailing dot, an implied
netmask length covers all addresses in remaining octets
(i.e. implied masklen is /8 or /16 or /24). If masklen is
not specified, and there is not trailing dot, then just a
single <small>IP</small> address specified is used, as if
the masklen were <tt>&quot;/32&quot;</tt> with an IPv4
address, or <tt>&quot;/128&quot;</tt> in case of an IPv6
address.</p>

<p style="margin-left:17%; margin-top: 1em">If a network or
host address is prefaced by a <tt>&quot;!&quot;</tt> the
matching network or host will be excluded from the list even
if a less specific (shorter netmask length) subnet is later
specified in the list. This allows a subset of a wider
network to be exempt. In case of specifying overlapping
subnets, specify more specific subnets first (tighter
matching, i.e. with a longer netmask length), followed by
less specific (shorter netmask length) subnets to get
predictable results regarless of the search algorithm used
&minus; when Net::Patricia module is installed the search
finds the tightest matching entry in the list, while a
sequential search as used in absence of the module
Net::Patricia will find the first matching entry in the
list.</p>

<p style="margin-left:17%; margin-top: 1em">Note:
127.0.0.0/8 and ::1 are always included in trusted_networks,
regardless of your config.</p>

<p style="margin-left:17%; margin-top: 1em">Examples:</p>

<pre style="margin-left:17%; margin-top: 1em">   trusted_networks 192.168.0.0/16        # all in 192.168.*.*
   trusted_networks 192.168.              # all in 192.168.*.*
   trusted_networks 212.17.35.15          # just that host
   trusted_networks !10.0.1.5 10.0.1/24   # all in 10.0.1.* but not 10.0.1.5
   trusted_networks 2001:db8:1::1 !2001:db8:1::/64 2001:db8::/32
     # 2001:db8::/32 and 2001:db8:1::1/128, except the rest of 2001:db8:1::/64</pre>


<p style="margin-left:17%; margin-top: 1em">This operates
additively, so a <tt>&quot;trusted_networks&quot;</tt> line
after another one will append new entries to the list of
trusted networks. To clear out the existing entries, use
<tt>&quot;clear_trusted_networks&quot;</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">If
<tt>&quot;trusted_networks&quot;</tt> is not set and
<tt>&quot;internal_networks&quot;</tt> is, the value of
<tt>&quot;internal_networks&quot;</tt> will be used for this
parameter.</p>

<p style="margin-left:17%; margin-top: 1em">If neither
<tt>&quot;trusted_networks&quot;</tt> or
<tt>&quot;internal_networks&quot;</tt> is set, a basic
inference algorithm is applied. This works as follows:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="17%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="77%">


<p>If the &rsquo;from&rsquo; host has an <small>IP</small>
address in a private ( <small>RFC 1918</small> ) network
range, then it&rsquo;s trusted</p></td></tr>
<tr valign="top" align="left">
<td width="17%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="77%">


<p>If there are authentication tokens in the received
header, and the previous host was trusted, then this host is
also trusted</p></td></tr>
<tr valign="top" align="left">
<td width="17%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="77%">


<p>Otherwise this host, and all further hosts, are consider
untrusted.</p> </td></tr>
</table>

<p style="margin-left:11%;">clear_trusted_networks</p>

<p style="margin-left:17%;">Empty the list of trusted
networks.</p>

<p style="margin-left:11%;">internal_networks
IPaddress[/masklen] ... (default: none)</p>

<p style="margin-left:17%;">What networks or hosts are
&rsquo;internal&rsquo; in your setup. <b>Internal</b> means
that relay hosts on these networks are considered to be MXes
for your domain(s), or internal relays. This uses the same
syntax as <tt>&quot;trusted_networks&quot;</tt>, above
&minus; see there for details.</p>

<p style="margin-left:17%; margin-top: 1em">This value is
used when checking &rsquo;dial&minus;up&rsquo; or dynamic
<small>IP</small> address blocklists, in order to detect
direct-to-MX spamming.</p>

<p style="margin-left:17%; margin-top: 1em">Trusted relays
that accept mail directly from dial-up connections (i.e. are
also performing a role of mail submission agents &minus;
<small>MSA</small> ) should not be listed in
<tt>&quot;internal_networks&quot;</tt>. List them only in
<tt>&quot;trusted_networks&quot;</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">If
<tt>&quot;trusted_networks&quot;</tt> is set and
<tt>&quot;internal_networks&quot;</tt> is not, the value of
<tt>&quot;trusted_networks&quot;</tt> will be used for this
parameter.</p>

<p style="margin-left:17%; margin-top: 1em">If neither
<tt>&quot;trusted_networks&quot;</tt> nor
<tt>&quot;internal_networks&quot;</tt> is set, no addresses
will be considered local; in other words, any relays past
the machine where SpamAssassin is running will be considered
external.</p>

<p style="margin-left:17%; margin-top: 1em">Every entry in
<tt>&quot;internal_networks&quot;</tt> must appear in
<tt>&quot;trusted_networks&quot;</tt>; in other words,
<tt>&quot;internal_networks&quot;</tt> is always a subset of
the trusted set.</p>

<p style="margin-left:17%; margin-top: 1em">Note: 127/8 and
::1 are always included in internal_networks, regardless of
your config.</p>

<p style="margin-left:11%;">clear_internal_networks</p>

<p style="margin-left:17%;">Empty the list of internal
networks.</p>

<p style="margin-left:11%;">msa_networks
IPaddress[/masklen] ... (default: none)</p>

<p style="margin-left:17%;">The networks or hosts which are
acting as MSAs in your setup (but not also as
<small>MX</small> relays). This uses the same syntax as
<tt>&quot;trusted_networks&quot;</tt>, above &minus; see
there for details.</p>


<p style="margin-left:17%; margin-top: 1em"><b><small>MSA</small></b>
means that the relay hosts on these networks accept mail
from your own users and authenticates them appropriately.
These relays will never accept mail from hosts that
aren&rsquo;t authenticated in some way. Examples of
authentication include, <small>IP</small> lists, <small>SMTP
AUTH,</small> POP-before-SMTP, etc.</p>

<p style="margin-left:17%; margin-top: 1em">All relays
found in the message headers after the <small>MSA</small>
relay will take on the same trusted and internal
classifications as the <small>MSA</small> relay itself, as
defined by your <i>trusted_networks</i> and
<i>internal_networks</i> configuration.</p>

<p style="margin-left:17%; margin-top: 1em">For example, if
the <small>MSA</small> relay is trusted and internal so will
all of the relays that precede it.</p>

<p style="margin-left:17%; margin-top: 1em">When using
msa_networks to identify an <small>MSA</small> it is
recommended that you treat that <small>MSA</small> as both
trusted and internal. When an <small>MSA</small> is not
included in msa_networks you should treat the
<small>MSA</small> as trusted but not internal, however if
the <small>MSA</small> is also acting as an
<small>MX</small> or intermediate relay you must always
treat it as both trusted and internal and ensure that the
<small>MSA</small> includes visible auth tokens in its
Received header to identify submission clients.</p>


<p style="margin-left:17%; margin-top: 1em"><b>Warning:</b>
Never include an <small>MSA</small> that also acts as an
<small>MX</small> (or is also an intermediate relay for an
<small>MX</small> ) or otherwise accepts mail from
non-authenticated users in msa_networks. Doing so will
result in unknown external relays being trusted.</p>

<p style="margin-left:11%;">clear_msa_networks</p>

<p style="margin-left:17%;">Empty the list of msa
networks.</p>

<p style="margin-left:11%;">originating_ip_headers header
... (default: X&minus;Yahoo-Post-IP <br>
X&minus;Originating-IP X&minus;Apparently-From
X&minus;SenderIP)</p>

<p style="margin-left:17%;">A list of header field names
from which an originating <small>IP</small> address can be
obtained. For example, webmail servers may record a client
<small>IP</small> address in X&minus;Originating-IP.</p>

<p style="margin-left:17%; margin-top: 1em">These
<small>IP</small> addresses are virtually appended into the
Received: chain, so they are used in <small>RBL</small>
checks where appropriate.</p>

<p style="margin-left:17%; margin-top: 1em">Currently the
<small>IP</small> addresses are not added into
X&minus;Spam&minus;Relays&minus;* header fields, but they
may be in the future.</p>


<p style="margin-left:11%;">clear_originating_ip_headers</p>

<p style="margin-left:17%;">Empty the list of
&rsquo;originating <small>IP</small> address&rsquo; header
field names.</p>

<p style="margin-left:11%;">always_trust_envelope_sender (
0 | 1 ) (default: 0)</p>

<p style="margin-left:17%;">Trust the envelope sender even
if the message has been passed through one or more trusted
relays. See also
<tt>&quot;envelope_sender_header&quot;</tt>.</p>

<p style="margin-left:11%;">skip_rbl_checks ( 0 | 1 )
(default: 0)</p>

<p style="margin-left:17%;">Turning on the skip_rbl_checks
setting will disable the DNSEval plugin, which implements
Real-time Block List (or: Blackhole List) (
<small>RBL</small> ) lookups.</p>

<p style="margin-left:17%; margin-top: 1em">By default,
SpamAssassin will run <small>RBL</small> checks. Individual
blocklists may be disabled selectively by setting a score of
a corresponding rule to 0.</p>

<p style="margin-left:17%; margin-top: 1em">See also a
related configuration parameter skip_uribl_checks, which
controls the <small>URIDNSBL</small> plugin (documented in
the <small>URIDNSBL</small> man page).</p>

<p style="margin-left:11%;">dns_available { yes | no |
test[: domain1 domain2...] } (default: <br>
yes)</p>

<p style="margin-left:17%;">Tells SpamAssassin whether
<small>DNS</small> resolving is available or not. A value
<i>yes</i> indicates <small>DNS</small> resolving is
available, a value <i>no</i> indicates <small>DNS</small>
resolving is not available &minus; both of these values
apply unconditionally and skip initial <small>DNS</small>
tests, which can be slow or unreliable.</p>

<p style="margin-left:17%; margin-top: 1em">When the option
value is a <i>test</i> (with or without arguments),
SpamAssassin will query some domain names on the internet
during initialization, attempting to determine if
<small>DNS</small> resolving is working or not. A
space-separated list of domain names may be specified
explicitly, or left to a built-in default of a dozen or so
domain names. From an explicit or a default list a subset of
three domain names is picked randomly for checking. The test
queries for <small>NS</small> records of these domain: if at
least one query returns a success then SpamAssassin
considers <small>DNS</small> resolving as available,
otherwise not.</p>

<p style="margin-left:17%; margin-top: 1em">The problem is
that the test can introduce some startup delay if a network
connection is down, and in some cases it can wrongly guess
that <small>DNS</small> is unavailable because a test
connection failed, what causes disabling several
DNS-dependent tests.</p>

<p style="margin-left:17%; margin-top: 1em">Please note,
the <small>DNS</small> test queries for <small>NS</small>
records, so specify domain names, not host names.</p>

<p style="margin-left:17%; margin-top: 1em">Since version
3.4.0 of SpamAssassin a default setting for option
<i>dns_available</i> is <i>yes</i>. A default in older
versions was <i>test</i>.</p>

<p style="margin-left:11%;">dns_server ip-addr-port
(default: entries provided by Net::DNS)</p>

<p style="margin-left:17%;">Specifies an <small>IP</small>
address of a <small>DNS</small> server, and optionally its
port number. The <i>dns_server</i> directive may be
specified multiple times, each entry adding to a list of
available resolving name servers. The <i>ip-addr-port</i>
argument can either be an IPv4 or IPv6 address, optionally
enclosed in brackets, and optionally followed by a colon and
a port number. In absence of a port number a standard port
number 53 is assumed. When an IPv6 address is specified
along with a port number, the address <b>must</b> be
enclosed in brackets to avoid parsing ambiguity regarding a
colon separator,</p>

<p style="margin-left:17%; margin-top: 1em">Examples : <br>
dns_server 127.0.0.1 <br>
dns_server 127.0.0.1:53 <br>
dns_server [127.0.0.1]:53 <br>
dns_server [::1]:53</p>

<p style="margin-left:17%; margin-top: 1em">In absence of
<i>dns_server</i> directives, the list of name servers is
provided by Net::DNS module, which typically obtains the
list from /etc/resolv.conf, but this may be platform
dependent. Please consult the Net::DNS::Resolver
documentation for details.</p>

<p style="margin-left:11%;">clear_dns_servers</p>

<p style="margin-left:17%;">Empty the list of explicitly
configured <small>DNS</small> servers through a
<i>dns_server</i> directive, falling back to Net::DNS
&minus;supplied defaults.</p>

<p style="margin-left:11%;">dns_local_ports_permit
ranges...</p>

<p style="margin-left:17%;">Add the specified ports or
ports ranges to the set of allowed port numbers that can be
used as local port numbers when sending <small>DNS</small>
queries to a resolver.</p>

<p style="margin-left:17%; margin-top: 1em">The argument is
a whitespace-separated or a comma-separated list of single
port numbers n, or port number pairs (i.e. m&minus;n)
delimited by a &rsquo;&minus;&rsquo;, representing a range.
Allowed port numbers are between 1 and 65535.</p>

<p style="margin-left:17%; margin-top: 1em">Directives
<i>dns_local_ports_permit</i> and
<i>dns_local_ports_avoid</i> are processed in order in which
they appear in configuration files. Each directive adds (or
subtracts) its subsets of ports to a current set of
available ports. Whatever is left in the set by the end of
configuration processing is made available to a
<small>DNS</small> resolving client code.</p>

<p style="margin-left:17%; margin-top: 1em">If the
resulting set of port numbers is empty (see also the
directive <i>dns_local_ports_none</i>), then SpamAssassin
does not apply its ports randomization logic, but instead
leaves the operating system to choose a suitable free local
port number.</p>

<p style="margin-left:17%; margin-top: 1em">The initial set
consists of all port numbers in the range 1024&minus;65535.
Note that system config files already modify the set and
remove all the <small>IANA</small> registered port numbers
and some other ranges, so there is rarely a need to adjust
the ranges by site-specific directives.</p>

<p style="margin-left:17%; margin-top: 1em">See also
directives <i>dns_local_ports_permit</i> and
<i>dns_local_ports_none</i>.</p>

<p style="margin-left:11%;">dns_local_ports_avoid
ranges...</p>

<p style="margin-left:17%;">Remove specified ports or ports
ranges from the set of allowed port numbers that can be used
as local port numbers when sending <small>DNS</small>
queries to a resolver.</p>

<p style="margin-left:17%; margin-top: 1em">Please see
directive <i>dns_local_ports_permit</i> for details.</p>

<p style="margin-left:11%;">dns_local_ports_none</p>

<p style="margin-left:17%;">Is a fast shorthand for:</p>

<pre style="margin-left:17%; margin-top: 1em">  dns_local_ports_avoid 1&minus;65535</pre>


<p style="margin-left:17%; margin-top: 1em">leaving the set
of available <small>DNS</small> query local port numbers
empty. In all respects (apart from speed) it is equivalent
to the shown directive, and can be freely mixed with
<i>dns_local_ports_permit</i> and
<i>dns_local_ports_avoid</i>.</p>

<p style="margin-left:17%; margin-top: 1em">If the
resulting set of port numbers is empty, then SpamAssassin
does not apply its ports randomization logic, but instead
leaves the operating system to choose a suitable free local
port number.</p>

<p style="margin-left:17%; margin-top: 1em">See also
directives <i>dns_local_ports_permit</i> and
<i>dns_local_ports_avoid</i>.</p>

<p style="margin-left:11%;">dns_test_interval n (default:
600 seconds)</p>

<p style="margin-left:17%;">If dns_available is set to
<i>test</i>, the dns_test_interval time in number of seconds
will tell SpamAssassin how often to retest for working
<small>DNS. A</small> numeric value is optionally suffixed
by a time unit (s, m, h, d, w, indicating seconds (default),
minutes, hours, days, weeks).</p>

<p style="margin-left:11%;">dns_options opts (default:
norotate, nodns0x20, edns=4096)</p>

<p style="margin-left:17%;">Provides a (whitespace or comma
&minus;separated) list of options applying to
<small>DNS</small> resolving. Available options are:
<i>rotate</i>, <i>dns0x20</i> and <i>edns</i> (or
<i>edns0</i>). Option name may be negated by prepending a
<i>no</i> (e.g. <i>norotate</i>, <i>NoEDNS</i>) to
counteract a previously enabled option. Option names are not
case-sensitive. The <i>dns_options</i> directive may appear
in configuration files multiple times, the last setting
prevails.</p>

<p style="margin-left:17%; margin-top: 1em">Option
<i>edns</i> (or <i>edsn0</i>) may take a value which
specifies a requestor&rsquo;s acceptable <small>UDP</small>
payload size according to <small>EDNS0</small>
specifications ( <small>RFC 6891,</small> ex <small>RFC
2671</small> ) e.g. <i>edns=4096</i>. When
<small>EDNS0</small> is off (<i>noedns</i> or
<i>edns=512</i>) a traditional implied <small>UDP</small>
payload size is 512 bytes, which is also a minimum allowed
value for this option. When the option is specified but a
value is not provided, a conservative default of 1220 bytes
is implied. It is recommended to keep <i>edns</i> enabled
when using a local recursive <small>DNS</small> server which
supports <small>EDNS0</small> (like most modern
<small>DNS</small> servers do), a suitable setting in this
case is <i>edns=4096</i>, which is also a default. Allowing
<small>UDP</small> payload size larger than 512 bytes can
avoid truncation of resource records in large
<small>DNS</small> responses (like in <small>TXT</small>
records of some <small>SPF</small> and <small>DKIM</small>
responses, or when an unreasonable number of A records is
published by some domain). The option should be disabled
when a recursive <small>DNS</small> server is only reachable
through non&minus; <small>RFC 6891</small> compliant
middleboxes (such as some old-fashioned firewall) which bans
<small>DNS UDP</small> payload sizes larger than 512 bytes.
A suitable value when a non-local recursive
<small>DNS</small> server is used and a middlebox
<b>does</b> allow <small>EDNS0</small> but blocks fragmented
<small>IP</small> packets is perhaps 1220 bytes, allowing a
<small>DNS UDP</small> packet to fit within a single
<small>IP</small> packet in most cases (a slightly less
conservative range would be 1280&minus;1410 bytes).</p>

<p style="margin-left:17%; margin-top: 1em">Option
<i>rotate</i> causes SpamAssassin to choose a
<small>DNS</small> server at random from all servers listed
in <tt>&quot;/etc/resolv.conf&quot;</tt> every
<i>dns_test_interval</i> seconds, effectively spreading the
load over all currently available <small>DNS</small> servers
when there are many spamd workers.</p>

<p style="margin-left:17%; margin-top: 1em">Option
<i>dns0x20</i> enables randomization of letters in a
<small>DNS</small> query label according to
draft&minus;vixie&minus;dnsext&minus;dns0x20, decreasing a
chance of collisions of responses (by chance or by a
malicious intent) by increasing spread as provided by a
16&minus;bit query <small>ID</small> and up to 16 bits of a
port number, with additional bits as encoded by flipping
case (upper/lower) of letters in a query. The number of
additional random bits corresponds to the number of letters
in a query label. Should work reliably with all mainstream
<small>DNS</small> servers &minus; do not turn on if you see
frequent info messages &quot;dns: no callback for id:&quot;
in the log, or if <small>RBL</small> or
<small>URIDNS</small> lookups do not work for no apparent
reason.</p>

<p style="margin-left:11%;">dns_query_restriction
(allow|deny) domain1 domain2 ...</p>

<p style="margin-left:17%;">Option allows disabling of
rules which would result in a <small>DNS</small> query to
one of the listed domains. The first argument must be a
literal <tt>&quot;allow&quot;</tt> or
<tt>&quot;deny&quot;</tt>, remaining arguments are domains
names.</p>

<p style="margin-left:17%; margin-top: 1em">Most
<small>DNS</small> queries (with some exceptions) are
subject to dns_query_restriction. A domain to be queried is
successively stripped-off of its leading labels (thus
yielding a series of its parent domains), and on each
iteration a check is made against an associative array
generated by dns_query_restriction options. Search stops at
the first match (i.e. the tightest match), and the matching
entry with its <tt>&quot;allow&quot;</tt> or
<tt>&quot;deny&quot;</tt> value then controls whether a
<small>DNS</small> query is allowed to be launched.</p>

<p style="margin-left:17%; margin-top: 1em">If no match is
found an implicit default is to allow a query. The purpose
of an explicit <tt>&quot;allow&quot;</tt> entry is to be
able to override a previously configured
<tt>&quot;deny&quot;</tt> on the same domain or to override
an entry (possibly yet to be configured in subsequent config
directives) on one of its parent domains. Thus an
&rsquo;allow zen.spamhaus.org&rsquo; with a &rsquo;deny
spamhaus.org&rsquo; would permit <small>DNS</small> queries
on a specific <small>DNS BL</small> zone but deny queries to
other zones under the same parent domain.</p>

<p style="margin-left:17%; margin-top: 1em">Domains are
matched case-insensitively, no wildcards are recognized,
there should be no leading or trailing dot.</p>

<p style="margin-left:17%; margin-top: 1em">Specifying a
block on querying a domain name has a similar effect as
setting a score of corresponding <small>DNSBL</small> and
<small>URIBL</small> rules to zero, and can be a handy
alternative to hunting for such rules when a site policy
does not allow certain <small>DNS</small> block lists to be
queried.</p>

<p style="margin-left:17%; margin-top: 1em">Example: <br>
dns_query_restriction deny dnswl.org surbl.org <br>
dns_query_restriction allow zen.spamhaus.org <br>
dns_query_restriction deny spamhaus.org mailspike.net
spamcop.net</p>


<p style="margin-left:11%;">clear_dns_query_restriction</p>

<p style="margin-left:17%;">The option removes any entries
entered by previous &rsquo;dns_query_restriction&rsquo;
options, leaving the list empty, i.e. allowing
<small>DNS</small> queries for any domain (including any
<small>DNS BL</small> zone).</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>LEARNING
OPTIONS</small></b> <br>
use_learner ( 0 | 1 ) (default: 1)</p>

<p style="margin-left:17%;">Whether to use any
machine-learning classifiers with SpamAssassin, such as the
default &rsquo;BAYES_*&rsquo; rules. Setting this to 0 will
disable use of any and all human-trained classifiers.</p>

<p style="margin-left:11%;">use_bayes ( 0 | 1 ) (default:
1)</p>

<p style="margin-left:17%;">Whether to use the
naive-Bayesian-style classifier built into SpamAssassin.
This is a master on/off switch for all Bayes-related
operations.</p>

<p style="margin-left:11%;">use_bayes_rules ( 0 | 1 )
(default: 1)</p>

<p style="margin-left:17%;">Whether to use rules using the
naive-Bayesian-style classifier built into SpamAssassin.
This allows you to disable the rules while leaving auto and
manual learning enabled.</p>

<p style="margin-left:11%;">bayes_auto_learn ( 0 | 1 )
(default: 1)</p>

<p style="margin-left:17%;">Whether SpamAssassin should
automatically feed high-scoring mails (or low-scoring mails,
for non-spam) into its learning systems. The only learning
system supported currently is a naive-Bayesian-style
classifier.</p>

<p style="margin-left:17%; margin-top: 1em">See the
documentation for the
<tt>&quot;Mail::SpamAssassin::Plugin::AutoLearnThreshold&quot;</tt>
plugin module for details on how Bayes auto-learning is
implemented by default.</p>

<p style="margin-left:11%;">bayes_ignore_header
header_name</p>

<p style="margin-left:17%;">If you receive mail filtered by
upstream mail systems, like a spam-filtering
<small>ISP</small> or mailing list, and that service adds
new headers (as most of them do), these headers may provide
inappropriate cues to the Bayesian classifier, allowing it
to take a &quot;short cut&quot;. To avoid this, list the
headers using this setting. Example:</p>

<pre style="margin-left:17%; margin-top: 1em">        bayes_ignore_header X&minus;Upstream&minus;Spamfilter
        bayes_ignore_header X&minus;Upstream&minus;SomethingElse</pre>


<p style="margin-left:11%;">bayes_ignore_from
user@example.com</p>

<p style="margin-left:17%;">Bayesian classification and
autolearning will not be performed on mail from the listed
addresses. Program <tt>&quot;sa&minus;learn&quot;</tt> will
also ignore the listed addresses if it is invoked using the
<tt>&quot;&minus;&minus;use&minus;ignores&quot;</tt> option.
One or more addresses can be listed, see
<tt>&quot;whitelist_from&quot;</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">Spam messages
from certain senders may contain many words that frequently
occur in ham. For example, one might read messages from a
preferred bookstore but also get unwanted spam messages from
other bookstores. If the unwanted messages are learned as
spam then any messages discussing books, including the
preferred bookstore and antiquarian messages would be in
danger of being marked as spam. The addresses of the
annoying bookstores would be listed. (Assuming they were
halfway legitimate and didn&rsquo;t send you mail through
myriad affiliates.)</p>

<p style="margin-left:17%; margin-top: 1em">Those who have
pieces of spam in legitimate messages or otherwise receive
ham messages containing potentially spammy words might fear
that some spam messages might be in danger of being marked
as ham. The addresses of the spam mailing lists,
correspondents, etc. would be listed.</p>

<p style="margin-left:11%;">bayes_ignore_to
user@example.com</p>

<p style="margin-left:17%;">Bayesian classification and
autolearning will not be performed on mail to the listed
addresses. See <tt>&quot;bayes_ignore_from&quot;</tt> for
details.</p>

<p style="margin-left:11%;">bayes_min_ham_num (Default:
200) <br>
bayes_min_spam_num (Default: 200)</p>

<p style="margin-left:17%;">To be accurate, the Bayes
system does not activate until a certain number of ham
(non-spam) and spam have been learned. The default is 200 of
each ham and spam, but you can tune these up or down with
these two settings.</p>

<p style="margin-left:11%;">bayes_learn_during_report
(Default: 1)</p>

<p style="margin-left:17%;">The Bayes system will, by
default, learn any reported messages (<tt>&quot;spamassassin
&minus;r&quot;</tt>) as spam. If you do not want this to
happen, set this option to 0.</p>


<p style="margin-left:11%;">bayes_sql_override_username</p>

<p style="margin-left:17%;">Used by BayesStore::SQL storage
implementation.</p>

<p style="margin-left:17%; margin-top: 1em">If this options
is set the BayesStore::SQL module will override the set
username with the value given. This could be useful for
implementing global or group bayes databases.</p>

<p style="margin-left:11%;">bayes_use_hapaxes (default:
1)</p>

<p style="margin-left:17%;">Should the Bayesian classifier
use hapaxes (words/tokens that occur only once) when
classifying? This produces significantly better
hit-rates.</p>

<p style="margin-left:11%;">bayes_journal_max_size
(default: 102400)</p>

<p style="margin-left:17%;">SpamAssassin will
opportunistically sync the journal and the database. It will
do so once a day, but will sync more often if the journal
file size goes above this setting, in bytes. If set to 0,
opportunistic syncing will not occur.</p>

<p style="margin-left:11%;">bayes_expiry_max_db_size
(default: 150000)</p>

<p style="margin-left:17%;">What should be the maximum size
of the Bayes tokens database? When expiry occurs, the Bayes
system will keep either 75% of the maximum value, or 100,000
tokens, whichever has a larger value. 150,000 tokens is
roughly equivalent to a 8Mb database file.</p>

<p style="margin-left:11%;">bayes_auto_expire (default:
1)</p>

<p style="margin-left:17%;">If enabled, the Bayes system
will try to automatically expire old tokens from the
database. Auto-expiry occurs when the number of tokens in
the database surpasses the bayes_expiry_max_db_size value.
If a bayes datastore backend does not implement individual
key/value expirations, the setting is silently ignored.</p>

<p style="margin-left:11%;">bayes_token_ttl (default: 3w,
i.e. 3 weeks)</p>

<p style="margin-left:17%;">Time-to-live / expiration time
in seconds for tokens kept in a Bayes database. A numeric
value is optionally suffixed by a time unit (s, m, h, d, w,
indicating seconds (default), minutes, hours, days,
weeks).</p>

<p style="margin-left:17%; margin-top: 1em">If
bayes_auto_expire is true and a Bayes datastore backend
supports it (currently only Redis), this setting controls
deletion of expired tokens from a bayes database. The value
is observed on a best-effort basis, exact timing promises
are not necessarily kept. If a bayes datastore backend does
not implement individual key/value expirations, the setting
is silently ignored.</p>

<p style="margin-left:11%;">bayes_seen_ttl (default: 8d,
i.e. 8 days)</p>

<p style="margin-left:17%;">Time-to-live / expiration time
in seconds for &rsquo;seen&rsquo; entries (i.e. mail message
digests with their status) kept in a Bayes database. A
numeric value is optionally suffixed by a time unit (s, m,
h, d, w, indicating seconds (default), minutes, hours, days,
weeks).</p>

<p style="margin-left:17%; margin-top: 1em">If
bayes_auto_expire is true and a Bayes datastore backend
supports it (currently only Redis), this setting controls
deletion of expired &rsquo;seen&rsquo; entries from a bayes
database. The value is observed on a best-effort basis,
exact timing promises are not necessarily kept. If a bayes
datastore backend does not implement individual key/value
expirations, the setting is silently ignored.</p>

<p style="margin-left:11%;">bayes_learn_to_journal
(default: 0)</p>

<p style="margin-left:17%;">If this option is set, whenever
SpamAssassin does Bayes learning, it will put the
information into the journal instead of directly into the
database. This lowers contention for locking the database to
execute an update, but will also cause more access to the
journal and cause a delay before the updates are actually
committed to the Bayes database.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>MISCELLANEOUS
OPTIONS</small></b> <br>
time_limit n (default: 300)</p>

<p style="margin-left:17%;">Specifies a limit on elapsed
time in seconds that SpamAssassin is allowed to spend before
providing a result. The value may be fractional and must not
be negative, zero is interpreted as unlimited. The default
is 300 seconds for consistency with the spamd default
setting of &minus;&minus;timeout&minus;child .</p>

<p style="margin-left:17%; margin-top: 1em">This is a
best-effort advisory setting, processing will not be
abruptly aborted at an arbitrary point in processing when
the time limit is exceeded, but only on reaching one of
locations in the program flow equipped with a time test.
Currently equipped with the test are the main checking loop,
asynchronous <small>DNS</small> lookups, plugins which are
calling external programs. Rule evaluation is guarded by
starting a timer (alarm) on each set of compiled rules.</p>

<p style="margin-left:17%; margin-top: 1em">When a message
is passed to Mail::SpamAssassin::parse, a deadline time is
established as a sum of current time and the
<tt>&quot;time_limit&quot;</tt> setting.</p>

<p style="margin-left:17%; margin-top: 1em">This deadline
may also be specified by a caller through an option
&rsquo;master_deadline&rsquo; in <tt>$suppl_attrib</tt> on a
call to <i>parse()</i>, possibly providing a more accurate
deadline taking into account past and expected future
processing of a message in a mail filtering setup. If both
the config option as well as a &rsquo;master_deadline&rsquo;
option in a call are provided, the shorter time limit of the
two is used (since version 3.3.2). Note that spamd (and
possibly third-party callers of SpamAssassin) will supply
the &rsquo;master_deadline&rsquo; option in a call based on
its &minus;&minus;timeout&minus;child option (or
equivalent), unlike the command line
<tt>&quot;spamassassin&quot;</tt>, which has no such command
line option.</p>

<p style="margin-left:17%; margin-top: 1em">When a time
limit is exceeded, most of the remaining tests will be
skipped, as well as auto-learning. Whatever tests fired so
far will determine the final score. The behaviour is similar
to short-circuiting with attribute &rsquo;on&rsquo;, as
implemented by a Shortcircuit plugin. A synthetic hit on a
rule named <small>TIME_LIMIT_EXCEEDED</small> with a
near-zero default score is generated, so that the report
will reflect the event. A score for
<small>TIME_LIMIT_EXCEEDED</small> may be provided
explicitly in a configuration file, for example to achieve
whitelisting or blacklisting effect for messages with long
processing times.</p>

<p style="margin-left:17%; margin-top: 1em">The
<tt>&quot;time_limit&quot;</tt> option is a useful
protection against excessive processing time on certain
degenerate or unusually long or complex mail messages, as
well as against some DoS attacks. It is also needed in
time-critical pre-queue filtering setups (e.g. milter,
proxy, integration with <small>MTA</small> ), where message
processing must finish before a <small>SMTP</small> client
times out. <small>RFC 5321</small> prescribes in section
4.5.3.2.6 the &rsquo; <small>DATA</small> Termination&rsquo;
time limit of 10 minutes, although it is not unusual to see
some <small>SMTP</small> clients abort sooner on waiting for
a response. A sensible <tt>&quot;time_limit&quot;</tt> for a
pre-queue filtering setup is maybe 50 seconds, assuming that
clients are willing to wait at least a minute.</p>

<p style="margin-left:11%;">lock_method type</p>

<p style="margin-left:17%;">Select the file-locking method
used to protect database files on-disk. By default,
SpamAssassin uses an NFS-safe locking method on
<small>UNIX</small> ; however, if you are sure that the
database files you&rsquo;ll be using for Bayes and
<small>AWL</small> storage will never be accessed over
<small>NFS,</small> a non-NFS-safe locking system can be
selected.</p>

<p style="margin-left:17%; margin-top: 1em">This will be
quite a bit faster, but may risk file corruption if the
files are ever accessed by multiple clients at once, and one
or more of them is accessing them through an
<small>NFS</small> filesystem.</p>

<p style="margin-left:17%; margin-top: 1em">Note that
different platforms require different locking systems.</p>

<p style="margin-left:17%; margin-top: 1em">The supported
locking systems for <tt>&quot;type&quot;</tt> are as
follows: <i><br>
nfssafe</i> &minus; an NFS-safe locking system <i><br>
flock</i> &minus; simple <small>UNIX</small>
&quot;flock()&quot; locking <i><br>
win32</i> &minus; Win32 locking using &quot;sysopen (...,
O_CREAT|O_EXCL)&quot;.</p>

<p style="margin-left:17%; margin-top: 1em">nfssafe and
flock are only available on <small>UNIX,</small> and win32
is only available on Windows. By default, SpamAssassin will
choose either nfssafe or win32 depending on the platform in
use.</p>

<p style="margin-left:11%;">fold_headers ( 0 | 1 )
(default: 1)</p>

<p style="margin-left:17%;">By default, headers added by
SpamAssassin will be whitespace folded. In other words, they
will be broken up into multiple lines instead of one very
long one and each continuation line will have a tabulator
prepended to mark it as a continuation of the preceding
one.</p>

<p style="margin-left:17%; margin-top: 1em">The automatic
wrapping can be disabled here. Note that this can generate
very long lines. <small>RFC 2822</small> required that
header lines do not exceed 998 characters (not counting the
final <small>CRLF</small> ).</p>

<p style="margin-left:11%;">report_safe_copy_headers
header_name ...</p>

<p style="margin-left:17%;">If using
<tt>&quot;report_safe&quot;</tt>, a few of the headers from
the original message are copied into the wrapper header
(From, To, Cc, Subject, Date, etc.) If you want to have
other headers copied as well, you can add them using this
option. You can specify multiple headers on the same line,
separated by spaces, or you can just use multiple lines.</p>

<p style="margin-left:11%;">envelope_sender_header
Name-Of-Header</p>

<p style="margin-left:17%;">SpamAssassin will attempt to
discover the address used in the &rsquo; <small>MAIL
FROM:</small> &rsquo; phase of the <small>SMTP</small>
transaction that delivered this message, if this data has
been made available by the <small>SMTP</small> server. This
is used in the <tt>&quot;EnvelopeFrom&quot;</tt>
pseudo-header, and for various rules such as
<small>SPF</small> checking.</p>

<p style="margin-left:17%; margin-top: 1em">By default,
various MTAs will use different headers, such as the
following:</p>

<pre style="margin-left:17%; margin-top: 1em">    X&minus;Envelope&minus;From
    Envelope&minus;Sender
    X&minus;Sender
    Return&minus;Path</pre>


<p style="margin-left:17%; margin-top: 1em">SpamAssassin
will attempt to use these, if some heuristics (such as the
header placement in the message, or the absence of fetchmail
signatures) appear to indicate that they are safe to use.
However, it may choose the wrong headers in some mailserver
configurations. (More discussion of this can be found in bug
2142 and bug 4747 in the SpamAssassin BugZilla.)</p>

<p style="margin-left:17%; margin-top: 1em">To avoid this
heuristic failure, the
<tt>&quot;envelope_sender_header&quot;</tt> setting may be
helpful. Name the header that your <small>MTA</small> or
<small>MDA</small> adds to messages containing the address
used at the <small>MAIL FROM</small> step of the
<small>SMTP</small> transaction.</p>

<p style="margin-left:17%; margin-top: 1em">If the header
in question contains <tt>&quot;&lt;&quot;</tt> or
<tt>&quot;&gt;&quot;</tt> characters at the start and end of
the email address in the right-hand side, as in the
<small>SMTP</small> transaction, these will be stripped.</p>

<p style="margin-left:17%; margin-top: 1em">If the header
is not found in a message, or if it&rsquo;s value does not
contain an <tt>&quot;@&quot;</tt> sign, SpamAssassin will
issue a warning in the logs and fall back to its default
heuristics.</p>

<p style="margin-left:17%; margin-top: 1em">(Note for
<small>MTA</small> developers: we would prefer if the use of
a single header be avoided in future, since that precludes
&rsquo;downstream&rsquo; spam scanning.
<tt>&quot;http://wiki.apache.org/spamassassin/EnvelopeSenderInReceived&quot;</tt>
details a better proposal, storing the envelope sender at
each hop in the <tt>&quot;Received&quot;</tt> header.)</p>

<p style="margin-left:17%; margin-top: 1em">example:</p>

<pre style="margin-left:17%; margin-top: 1em">    envelope_sender_header X&minus;SA&minus;Exim&minus;Mail&minus;From</pre>


<p style="margin-left:11%;">describe
<small>SYMBOLIC_TEST_NAME</small> description ...</p>

<p style="margin-left:17%;">Used to describe a test. This
text is shown to users in the detailed report.</p>

<p style="margin-left:17%; margin-top: 1em">Note that test
names which begin with &rsquo;__&rsquo; are reserved for
meta-match sub-rules, and are not scored or listed in the
&rsquo;tests hit&rsquo; reports.</p>

<p style="margin-left:17%; margin-top: 1em">Also note that
by convention, rule descriptions should be limited in length
to no more than 50 characters.</p>

<p style="margin-left:11%;">report_charset
<small>CHARSET</small> (default: unset)</p>

<p style="margin-left:17%;">Set the <small>MIME</small>
Content-Type charset used for the text/plain report which is
attached to spam mail messages.</p>

<p style="margin-left:11%;">report ...some text for a
report...</p>

<p style="margin-left:17%;">Set the report template which
is attached to spam mail messages. See the
<tt>&quot;10_default_prefs.cf&quot;</tt> configuration file
in <tt>&quot;/usr/share/spamassassin&quot;</tt> for an
example.</p>

<p style="margin-left:17%; margin-top: 1em">If you change
this, try to keep it under 78 columns. Each
<tt>&quot;report&quot;</tt> line appends to the existing
template, so use <tt>&quot;clear_report_template&quot;</tt>
to restart.</p>

<p style="margin-left:17%; margin-top: 1em">Tags can be
included as explained above.</p>

<p style="margin-left:11%;">clear_report_template</p>

<p style="margin-left:17%;">Clear the report template.</p>

<p style="margin-left:11%;">report_contact ...text of
contact address...</p>

<p style="margin-left:17%;">Set what _CONTACTADDRESS_ is
replaced with in the above report text. By default, this is
&rsquo;the administrator of that system&rsquo;, since the
hostname of the system the scanner is running on is also
included.</p>

<p style="margin-left:11%;">report_hostname ...hostname to
use...</p>

<p style="margin-left:17%;">Set what _HOSTNAME_ is replaced
with in the above report text. By default, this is
determined dynamically as whatever the host running
SpamAssassin calls itself.</p>

<p style="margin-left:11%;">unsafe_report ...some text for
a report...</p>

<p style="margin-left:17%;">Set the report template which
is attached to spam mail messages which contain a
non&minus;text/plain part. See the
<tt>&quot;10_default_prefs.cf&quot;</tt> configuration file
in <tt>&quot;/usr/share/spamassassin&quot;</tt> for an
example.</p>

<p style="margin-left:17%; margin-top: 1em">Each
<tt>&quot;unsafe&minus;report&quot;</tt> line appends to the
existing template, so use
<tt>&quot;clear_unsafe_report_template&quot;</tt> to
restart.</p>

<p style="margin-left:17%; margin-top: 1em">Tags can be
used in this template (see above for details).</p>


<p style="margin-left:11%;">clear_unsafe_report_template</p>

<p style="margin-left:17%;">Clear the unsafe_report
template.</p>

<p style="margin-left:11%;">mbox_format_from_regex</p>

<p style="margin-left:17%;">Set a specific regular
expression to be used for mbox file From separators.</p>

<p style="margin-left:17%; margin-top: 1em">For example,
this setting will allow sa-learn to process emails stored in
a kmail 2 mbox:</p>


<p style="margin-left:17%; margin-top: 1em">mbox_format_from_regex
/^From \S+ ?[[:upper:]][[:lower:]]{2}(?:, \d\d
[[:upper:]][[:lower:]]{2} \d{4} [0&minus;2]\d:\d\d:\d\d
[+&minus;]\d{4}| [[:upper:]][[:lower:]]{2} [ 1&minus;3]\d [
0&minus;2]\d:\d\d:\d\d \d{4})/</p>

<h2>RULE DEFINITIONS AND PRIVILEGED SETTINGS
<a name="RULE DEFINITIONS AND PRIVILEGED SETTINGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">These settings
differ from the ones above, in that they are considered
&rsquo;privileged&rsquo;. Only users running
<tt>&quot;spamassassin&quot;</tt> from their
procmailrc&rsquo;s or forward files, or sysadmins editing a
file in <tt>&quot;/etc/mail/spamassassin&quot;</tt>, can use
them. <tt>&quot;spamd&quot;</tt> users cannot use them in
their <tt>&quot;user_prefs&quot;</tt> files, for security
and efficiency reasons, unless
<tt>&quot;allow_user_rules&quot;</tt> is enabled (and then,
they may only add rules from below). <br>
allow_user_rules ( 0 | 1 ) (default: 0)</p>

<p style="margin-left:17%;">This setting allows users to
create rules (and only rules) in their
<tt>&quot;user_prefs&quot;</tt> files for use with
<tt>&quot;spamd&quot;</tt>. It defaults to off, because this
could be a severe security hole. It may be possible for
users to gain root level access if
<tt>&quot;spamd&quot;</tt> is run as root. It is
<small>NOT</small> a good idea, unless you have some other
way of ensuring that users&rsquo; tests are safe.
Don&rsquo;t use this unless you are certain you know what
you are doing. Furthermore, this option causes spamassassin
to recompile all the tests each time it processes a message
for a user with a rule in his/her
<tt>&quot;user_prefs&quot;</tt> file, which could have a
significant effect on server load. It is not
recommended.</p>

<p style="margin-left:17%; margin-top: 1em">Note that it is
not currently possible to use
<tt>&quot;allow_user_rules&quot;</tt> to modify an existing
system rule from a <tt>&quot;user_prefs&quot;</tt> file with
<tt>&quot;spamd&quot;</tt>.</p>

<p style="margin-left:11%;">redirector_pattern
/pattern/modifiers</p>

<p style="margin-left:17%;">A regex pattern that matches
both the redirector site portion, and the target site
portion of a <small>URI.</small></p>

<p style="margin-left:17%; margin-top: 1em">Note: The
target <small>URI</small> portion must be surrounded in
parentheses and <br>
no other part of the pattern may create a backreference.</p>

<p style="margin-left:17%; margin-top: 1em">Example:
http://chkpt.zdnet.com/chkpt/whatever/spammer.domain/yo/dude</p>


<pre style="margin-left:17%; margin-top: 1em">  redirector_pattern    /^https?:\/\/(?:opt\.)?chkpt\.zdnet\.com\/chkpt\/\w+\/(.*)$/i</pre>


<p style="margin-left:11%;">header
<small>SYMBOLIC_TEST_NAME</small> header op
/pattern/modifiers [if&minus;unset: <small><br>
STRING</small> ]</p>

<p style="margin-left:17%;">Define a test.
<tt>&quot;SYMBOLIC_TEST_NAME&quot;</tt> is a symbolic test
name, such as &rsquo; <small>FROM_ENDS_IN_NUMS</small>
&rsquo;. <tt>&quot;header&quot;</tt> is the name of a mail
header field, such as &rsquo;Subject&rsquo;,
&rsquo;To&rsquo;, &rsquo;From&rsquo;, etc. Header field
names are matched case-insensitively (conforming to
<small>RFC 5322</small> section 1.2.2), except for
all-capitals metaheader fields such as <small>ALL,
MESSAGEID,</small> ALL-TRUSTED.</p>

<p style="margin-left:17%; margin-top: 1em">Appending a
modifier <tt>&quot;:raw&quot;</tt> to a header field name
will inhibit decoding of quoted-printable or base&minus;64
encoded strings, and will preserve all whitespace inside the
header string. The <tt>&quot;:raw&quot;</tt> may also be
applied to pseudo-headers e.g. <tt>&quot;ALL:raw&quot;</tt>
will return a pristine (unmodified) header section.</p>

<p style="margin-left:17%; margin-top: 1em">Appending a
modifier <tt>&quot;:addr&quot;</tt> to a header field name
will cause everything except the first email address to be
removed from the header field. It is mainly applicable to
header fields &rsquo;From&rsquo;, &rsquo;Sender&rsquo;,
&rsquo;To&rsquo;, &rsquo;Cc&rsquo; along with their
&rsquo;Resent&minus;*&rsquo; counterparts, and the
&rsquo;Return&minus;Path&rsquo;.</p>

<p style="margin-left:17%; margin-top: 1em">Appending a
modifier <tt>&quot;:name&quot;</tt> to a header field name
will cause everything except the first display name to be
removed from the header field. It is mainly applicable to
header fields containing a single mail address:
&rsquo;From&rsquo;, &rsquo;Sender&rsquo;, along with their
&rsquo;Resent&minus;From&rsquo; and
&rsquo;Resent&minus;Sender&rsquo; counterparts.</p>

<p style="margin-left:17%; margin-top: 1em">It is
syntactically permitted to append more than one modifier to
a header field name, although currently most combinations
achieve no additional effect, for example
<tt>&quot;From:addr:raw&quot;</tt> or
<tt>&quot;From:raw:addr&quot;</tt> is currently the same as
<tt>&quot;From:addr&quot;</tt> .</p>

<p style="margin-left:17%; margin-top: 1em">For example,
appending <tt>&quot;:addr&quot;</tt> to a header name will
result in example@foo in all of the following cases: <br>
example@foo <br>
example@foo (Foo Blah) <br>
example@foo, example@bar <br>
display: example@foo (Foo Blah), example@bar ; <br>
Foo Blah &lt;example@foo&gt; <br>
&quot;Foo Blah&quot; &lt;example@foo&gt; <br>
&quot;&rsquo;Foo Blah&rsquo;&quot; &lt;example@foo&gt;</p>

<p style="margin-left:17%; margin-top: 1em">For example,
appending <tt>&quot;:name&quot;</tt> to a header name will
result in &quot;Foo Blah&quot; (without quotes) in all of
the following cases: <br>
example@foo (Foo Blah) <br>
example@foo (Foo Blah), example@bar <br>
display: example@foo (Foo Blah), example@bar ; <br>
Foo Blah &lt;example@foo&gt; <br>
&quot;Foo Blah&quot; &lt;example@foo&gt; <br>
&quot;&rsquo;Foo Blah&rsquo;&quot; &lt;example@foo&gt;</p>

<p style="margin-left:17%; margin-top: 1em">There are
several special pseudo-headers that can be specified: <br>
&quot;ALL&quot; can be used to mean the text of all the
message&rsquo;s headers. <br>
Note that all whitespace inside the headers, at line folds,
is <br>
currently compressed into a single space (&rsquo; &rsquo;)
character. To obtain <br>
a pristine (unmodified) header section, use
&quot;ALL:raw&quot; &minus; the :raw <br>
modifier is documented above. <br>
&quot;ToCc&quot; can be used to mean the contents of both
the &rsquo;To&rsquo; and &rsquo;Cc&rsquo; <br>
headers. <br>
&quot;EnvelopeFrom&quot; is the address used in the &rsquo;
<small>MAIL FROM:</small> &rsquo; phase of the <small><br>
SMTP</small> transaction that delivered this message, if
this data has been <br>
made available by the <small>SMTP</small> server. See
&quot;envelope_sender_header&quot; <br>
for more information on how to set this. <br>
&quot;MESSAGEID&quot; is a symbol meaning all
Message-Id&rsquo;s found in the <br>
message; some mailing list software moves the real
&rsquo;Message&minus;Id&rsquo; to <br>
&rsquo;Resent&minus;Message&minus;Id&rsquo; or to
&rsquo;X&minus;Message&minus;Id&rsquo;, then uses its own
one in <br>
the &rsquo;Message&minus;Id&rsquo; header. The value
returned for this symbol is the <br>
text from all 3 headers, separated by newlines. <br>
&quot;X&minus;Spam&minus;Relays&minus;Untrusted&quot;,
&quot;X&minus;Spam&minus;Relays&minus;Trusted&quot;, <br>
&quot;X&minus;Spam&minus;Relays&minus;Internal&quot; and
&quot;X&minus;Spam&minus;Relays&minus;External&quot;
represent a <br>
portable, pre-parsed representation of the message&rsquo;s
network path, <br>
as recorded in the Received headers, divided into
&rsquo;trusted&rsquo; vs <br>
&rsquo;untrusted&rsquo; and &rsquo;internal&rsquo; vs
&rsquo;external&rsquo; sets. See <br>

&quot;http://wiki.apache.org/spamassassin/TrustedRelays&quot;
for more <br>
details.</p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;op&quot;</tt>
is either <tt>&quot;=~&quot;</tt> (contains regular
expression) or <tt>&quot;!~&quot;</tt> (does not contain
regular expression), and <tt>&quot;pattern&quot;</tt> is a
valid Perl regular expression, with
<tt>&quot;modifiers&quot;</tt> as regexp modifiers in the
usual style. Note that multi-line rules are not supported,
even if you use <tt>&quot;x&quot;</tt> as a modifier. Also
note that the <tt>&quot;#&quot;</tt> character must be
escaped (<tt>&quot;\#&quot;</tt>) or else it will be
considered to be the start of a comment and not part of the
regexp.</p>

<p style="margin-left:17%; margin-top: 1em">If the
<tt>&quot;[if&minus;unset: STRING]&quot;</tt> tag is
present, then <tt>&quot;STRING&quot;</tt> will be used if
the header is not found in the mail message.</p>

<p style="margin-left:17%; margin-top: 1em">Test names must
not start with a number, and must contain only alphanumerics
and underscores. It is suggested that lower-case characters
not be used, and names have a length of no more than 22
characters, as an informal convention. Dashes are not
allowed.</p>

<p style="margin-left:17%; margin-top: 1em">Note that test
names which begin with &rsquo;__&rsquo; are reserved for
meta-match sub-rules, and are not scored or listed in the
&rsquo;tests hit&rsquo; reports. Test names which begin with
&rsquo;T_&rsquo; are reserved for tests which are undergoing
<small>QA,</small> and these are given a very low score.</p>

<p style="margin-left:17%; margin-top: 1em">If you add or
modify a test, please be sure to run a sanity check
afterwards by running <tt>&quot;spamassassin
&minus;&minus;lint&quot;</tt>. This will avoid confusing
error messages, or other tests being skipped as a
side-effect.</p>

<p style="margin-left:11%;">header
<small>SYMBOLIC_TEST_NAME</small>
exists:header_field_name</p>

<p style="margin-left:17%;">Define a header field existence
test. <tt>&quot;header_field_name&quot;</tt> is the name of
a header field to test for existence. Not to be confused
with a test for a nonempty header field body, which can be
implemented by a <tt>&quot;header SYMBOLIC_TEST_NAME header
=~ /\S/&quot;</tt> rule as described above.</p>

<p style="margin-left:11%;">header
<small>SYMBOLIC_TEST_NAME</small>
eval:name_of_eval_method([arguments])</p>

<p style="margin-left:17%;">Define a header eval test.
<tt>&quot;name_of_eval_method&quot;</tt> is the name of a
method on the
<tt>&quot;Mail::SpamAssassin::EvalTests&quot;</tt> object.
<tt>&quot;arguments&quot;</tt> are optional arguments to the
function call.</p>

<p style="margin-left:11%;">header
<small>SYMBOLIC_TEST_NAME</small>
eval:check_rbl(&rsquo;set&rsquo;, &rsquo;zone&rsquo; [,
&rsquo;sub&minus;test&rsquo;])</p>

<p style="margin-left:17%;">Check a <small>DNSBL</small> (a
<small>DNS</small> blacklist or whitelist). This will
retrieve Received: headers from the message, extract the
<small>IP</small> addresses, select which ones are
&rsquo;untrusted&rsquo; based on the
<tt>&quot;trusted_networks&quot;</tt> logic, and query that
<small>DNSBL</small> zone. There&rsquo;s a few things to
note: <br>
duplicated or private IPs</p>

<p style="margin-left:23%;">Duplicated IPs are only queried
once and reserved IPs are not queried. Private IPs are those
listed in
&lt;http://www.iana.org/assignments/ipv4&minus;address&minus;space&gt;,
&lt;http://duxcw.com/faq/network/privip.htm&gt;,
&lt;http://duxcw.com/faq/network/autoip.htm&gt;, or
&lt;http://tools.ietf.org/html/rfc5735&gt; as private.</p>

<p style="margin-left:17%;">the &rsquo;set&rsquo;
argument</p>

<p style="margin-left:23%;">This is used as a &rsquo;zone
<small>ID</small> &rsquo;. If you want to look up a
multiple-meaning zone like <small>SORBS,</small> you can
then query the results from that zone using it; but all
<i>check_rbl_sub()</i> calls must use that zone
<small>ID.</small></p>

<p style="margin-left:23%; margin-top: 1em">Also, if more
than one <small>IP</small> address gets a
<small>DNSBL</small> hit for a particular rule, it does not
affect the score because rules only trigger once per
message.</p>

<p style="margin-left:17%;">the &rsquo;zone&rsquo;
argument</p>

<p style="margin-left:23%;">This is the root zone of the
<small>DNSBL.</small></p>

<p style="margin-left:23%; margin-top: 1em">The domain name
is considered to be a fully qualified domain name (i.e. not
subject to <small>DNS</small> resolver&rsquo;s search or
default domain options). No trailing period is needed, and
will be removed if specified.</p>

<p style="margin-left:17%;">the
&rsquo;sub&minus;test&rsquo; argument</p>

<p style="margin-left:23%;">This optional argument behaves
the same as the sub-test argument in
<tt>&quot;check_rbl_sub()&quot;</tt> below.</p>

<p style="margin-left:17%;">selecting all IPs except for
the originating one</p>

<p style="margin-left:23%;">This is accomplished by placing
&rsquo;&minus;notfirsthop&rsquo; at the end of the set name.
This is useful for querying against <small>DNS</small> lists
which list dialup <small>IP</small> addresses; the first hop
may be a dialup, but as long as there is at least one more
hop, via their outgoing <small>SMTP</small> server,
that&rsquo;s legitimate, and so should not gain points. If
there is only one hop, that will be queried anyway, as it
should be relaying via its outgoing <small>SMTP</small>
server instead of sending directly to your <small>MX</small>
(mail exchange).</p>

<p style="margin-left:17%;">selecting IPs by whether they
are trusted</p>

<p style="margin-left:23%;">When checking a
&rsquo;nice&rsquo; <small>DNSBL</small> (a
<small>DNS</small> whitelist), you cannot trust the
<small>IP</small> addresses in Received headers that were
not added by trusted relays. To test the first
<small>IP</small> address that can be trusted, place
&rsquo;&minus;firsttrusted&rsquo; at the end of the set
name. That should test the <small>IP</small> address of the
relay that connected to the most remote trusted relay.</p>

<p style="margin-left:23%; margin-top: 1em">Note that this
requires that SpamAssassin know which relays are trusted.
For simple cases, SpamAssassin can make a good estimate. For
complex cases, you may get better results by setting
<tt>&quot;trusted_networks&quot;</tt> manually.</p>

<p style="margin-left:23%; margin-top: 1em">In addition,
you can test all untrusted <small>IP</small> addresses by
placing &rsquo;&minus;untrusted&rsquo; at the end of the set
name. Important note -- this does <small>NOT</small> include
the <small>IP</small> address from the most recent
&rsquo;untrusted line&rsquo;, as used in
&rsquo;&minus;firsttrusted&rsquo; above. That&rsquo;s
because we&rsquo;re talking about the trustworthiness of the
<small>IP</small> address data, not the source header line,
here; and in the case of the most recent header (the
&rsquo;firsttrusted&rsquo;), that data can be trusted. See
the Wiki page at
<tt>&quot;http://wiki.apache.org/spamassassin/TrustedRelays&quot;</tt>
for more information on this.</p>

<p style="margin-left:17%;">Selecting just the last
external <small>IP</small></p>

<p style="margin-left:23%;">By using
&rsquo;&minus;lastexternal&rsquo; at the end of the set
name, you can select only the external host that connected
to your internal network, or at least the last external host
with a public <small>IP.</small></p>

<p style="margin-left:11%;">header
<small>SYMBOLIC_TEST_NAME</small>
eval:check_rbl_txt(&rsquo;set&rsquo;,
&rsquo;zone&rsquo;)</p>

<p style="margin-left:17%;">Same as <i>check_rbl()</i>,
except querying using <small>IN TXT</small> instead of
<small>IN A</small> records. If the zone supports it, it
will result in a line of text describing why the
<small>IP</small> is listed, typically a hyperlink to a
database entry.</p>

<p style="margin-left:11%;">header
<small>SYMBOLIC_TEST_NAME</small>
eval:check_rbl_sub(&rsquo;set&rsquo;,
&rsquo;sub&minus;test&rsquo;)</p>

<p style="margin-left:17%;">Create a sub-test for
&rsquo;set&rsquo;. If you want to look up a multi-meaning
zone like relays.osirusoft.com, you can then query the
results from that zone using the zone <small>ID</small> from
the original query. The sub-test may either be an IPv4
dotted address for RBLs that return multiple A records or a
non-negative decimal number to specify a bitmask for RBLs
that return a single A record containing a bitmask of
results, a SenderBase test beginning with &quot;sb:&quot;,
or (if none of the preceding options seem to fit) a regular
expression.</p>

<p style="margin-left:17%; margin-top: 1em">Note: the set
name must be exactly the same for as the main query rule,
including selections like &rsquo;&minus;notfirsthop&rsquo;
appearing at the end of the set name.</p>

<p style="margin-left:11%;">body
<small>SYMBOLIC_TEST_NAME</small> /pattern/modifiers</p>

<p style="margin-left:17%;">Define a body pattern test.
<tt>&quot;pattern&quot;</tt> is a Perl regular expression.
Note: as per the header tests, <tt>&quot;#&quot;</tt> must
be escaped (<tt>&quot;\#&quot;</tt>) or else it is
considered the beginning of a comment.</p>

<p style="margin-left:17%; margin-top: 1em">The
&rsquo;body&rsquo; in this case is the textual parts of the
message body; any non-text <small>MIME</small> parts are
stripped, and the message decoded from Quoted-Printable or
Base&minus;64&minus;encoded format if necessary. The message
Subject header is considered part of the body and becomes
the first paragraph when running the rules. All
<small>HTML</small> tags and line breaks will be removed
before matching.</p>

<p style="margin-left:11%;">body
<small>SYMBOLIC_TEST_NAME</small>
eval:name_of_eval_method([args])</p>

<p style="margin-left:17%;">Define a body eval test. See
above.</p>

<p style="margin-left:11%;">uri
<small>SYMBOLIC_TEST_NAME</small> /pattern/modifiers</p>

<p style="margin-left:17%;">Define a uri pattern test.
<tt>&quot;pattern&quot;</tt> is a Perl regular expression.
Note: as per the header tests, <tt>&quot;#&quot;</tt> must
be escaped (<tt>&quot;\#&quot;</tt>) or else it is
considered the beginning of a comment.</p>

<p style="margin-left:17%; margin-top: 1em">The
&rsquo;uri&rsquo; in this case is a list of all the URIs in
the body of the email, and the test will be run on each and
every one of those URIs, adjusting the score if a match is
found. Use this test instead of one of the body tests when
you need to match a <small>URI,</small> as it is more
accurately bound to the start/end points of the
<small>URI,</small> and will also be faster.</p>

<p style="margin-left:11%;">rawbody
<small>SYMBOLIC_TEST_NAME</small> /pattern/modifiers</p>

<p style="margin-left:17%;">Define a raw-body pattern test.
<tt>&quot;pattern&quot;</tt> is a Perl regular expression.
Note: as per the header tests, <tt>&quot;#&quot;</tt> must
be escaped (<tt>&quot;\#&quot;</tt>) or else it is
considered the beginning of a comment.</p>

<p style="margin-left:17%; margin-top: 1em">The &rsquo;raw
body&rsquo; of a message is the raw data inside all textual
parts. The text will be decoded from base64 or
quoted-printable encoding, but <small>HTML</small> tags and
line breaks will still be present. Multiline expressions
will need to be used to match strings that are broken by
line breaks. Note: the text is split into 1 kB &minus; 2kB
chunks so your expressions may unexpectedly stop matching
where they should.</p>

<p style="margin-left:11%;">rawbody
<small>SYMBOLIC_TEST_NAME</small>
eval:name_of_eval_method([args])</p>

<p style="margin-left:17%;">Define a raw-body eval test.
See above.</p>

<p style="margin-left:11%;">full
<small>SYMBOLIC_TEST_NAME</small> /pattern/modifiers</p>

<p style="margin-left:17%;">Define a full message pattern
test. <tt>&quot;pattern&quot;</tt> is a Perl regular
expression. Note: as per the header tests,
<tt>&quot;#&quot;</tt> must be escaped
(<tt>&quot;\#&quot;</tt>) or else it is considered the
beginning of a comment.</p>

<p style="margin-left:17%; margin-top: 1em">The full
message is the pristine message headers plus the pristine
message body, including all <small>MIME</small> data such as
images, other attachments, <small>MIME</small> boundaries,
etc.</p>

<p style="margin-left:11%;">full
<small>SYMBOLIC_TEST_NAME</small>
eval:name_of_eval_method([args])</p>

<p style="margin-left:17%;">Define a full message eval
test. See above.</p>

<p style="margin-left:11%;">meta
<small>SYMBOLIC_TEST_NAME</small> boolean expression</p>

<p style="margin-left:17%;">Define a boolean expression
test in terms of other tests that have been hit or not hit.
For example:</p>

<p style="margin-left:17%; margin-top: 1em">meta
<small>META1 TEST1 &amp;&amp;</small> !(
<small>TEST2</small> || <small>TEST3</small> )</p>

<p style="margin-left:17%; margin-top: 1em">Note that
English language operators (&quot;and&quot;, &quot;or&quot;)
will be treated as rule names, and that there is no
<tt>&quot;XOR&quot;</tt> operator.</p>

<p style="margin-left:11%;">meta
<small>SYMBOLIC_TEST_NAME</small> boolean arithmetic
expression</p>

<p style="margin-left:17%;">Can also define an arithmetic
expression in terms of other tests, with an unhit test
having the value &quot;0&quot; and a hit test having a
nonzero value. The value of a hit meta test is that of its
arithmetic expression. The value of a hit eval test is that
returned by its method. The value of a hit header, body,
rawbody, uri, or full test which has the
&quot;multiple&quot; tflag is the number of times the test
hit. The value of any other type of hit test is
&quot;1&quot;.</p>

<p style="margin-left:17%; margin-top: 1em">For
example:</p>

<p style="margin-left:17%; margin-top: 1em">meta
<small>META2</small> (3 * <small>TEST1 &minus; 2</small> *
<small>TEST2</small> ) &gt; 0</p>

<p style="margin-left:17%; margin-top: 1em">Note that Perl
builtins and functions, like <tt>&quot;abs()&quot;</tt>,
<b>can&rsquo;t</b> be used, and will be treated as rule
names.</p>

<p style="margin-left:17%; margin-top: 1em">If you want to
define a meta-rule, but do not want its individual sub-rules
to count towards the final score unless the entire meta-rule
matches, give the sub-rules names that start with
&rsquo;__&rsquo; (two underscores). SpamAssassin will ignore
these for scoring.</p>

<p style="margin-left:11%;">reuse
<small>SYMBOLIC_TEST_NAME</small> [
<small>OLD_SYMBOLIC_TEST_NAME_1 ...</small> ]</p>

<p style="margin-left:17%;">Defines the name of a test that
should be &quot;reused&quot; during the scoring process. If
a message has an X&minus;Spam-Status header that shows a hit
for this rule or any of the old rule names given, a hit will
be added for this rule when <b>mass-check
&minus;&minus;reuse</b> is used. Examples:</p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;reuse
SPF_PASS&quot;</tt></p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;reuse
MY_NET_RULE_V2 MY_NET_RULE_V1&quot;</tt></p>

<p style="margin-left:17%; margin-top: 1em">The actual
logic for reuse tests is done by
<b>Mail::SpamAssassin::Plugin::Reuse</b>.</p>

<p style="margin-left:11%;">tflags
<small>SYMBOLIC_TEST_NAME</small> flags</p>

<p style="margin-left:17%;">Used to set flags on a test.
Parameter is a space-separated list of flag names or flag
name = value pairs. These flags are used in the
score-determination back end system for details of the
test&rsquo;s behaviour. Please see
<tt>&quot;bayes_auto_learn&quot;</tt> for more information
about tflag interaction with those systems. The following
flags can be set:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="17%"></td>
<td width="5%">


<p>net</p></td>
<td width="1%"></td>
<td width="77%">


<p>The test is a network test, and will not be run in the
mass checking system or if <b>&minus;L</b> is used,
therefore its score should not be modified.</p></td></tr>
</table>

<p style="margin-left:17%;">nice</p>

<p style="margin-left:23%;">The test is intended to
compensate for common false positives, and should be
assigned a negative score.</p>

<p style="margin-left:17%;">userconf</p>

<p style="margin-left:23%;">The test requires user
configuration before it can be used (like language-specific
tests).</p>

<p style="margin-left:17%;">learn</p>

<p style="margin-left:23%;">The test requires training
before it can be used.</p>

<p style="margin-left:17%;">noautolearn</p>

<p style="margin-left:23%;">The test will explicitly be
ignored when calculating the score for learning systems.</p>

<p style="margin-left:17%;">autolearn_force</p>

<p style="margin-left:23%;">The test will be subject to
less stringent autolearn thresholds.</p>

<p style="margin-left:23%; margin-top: 1em">Normally,
SpamAssassin will require 3 points from the header and 3
points from the body to be auto-learned as spam. This option
keeps the threshold at 6 points total but changes it to have
no regard to the source of the points.</p>

<p style="margin-left:17%;">multiple</p>

<p style="margin-left:23%;">The test will be evaluated
multiple times, for use with meta rules. Only affects
header, body, rawbody, uri, and full tests.</p>

<p style="margin-left:17%;">maxhits=N</p>

<p style="margin-left:23%;">If <b>multiple</b> is
specified, limit the number of hits found to N. If the rule
is used in a meta that counts the hits (e.g. __RULENAME &gt;
5), this is a way to avoid wasted extra work (use
&quot;tflags multiple maxhits=6&quot;).</p>

<p style="margin-left:23%; margin-top: 1em">For
example:</p>

<pre style="margin-left:23%; margin-top: 1em">  uri      __KAM_COUNT_URIS /^./
  tflags   __KAM_COUNT_URIS multiple maxhits=16
  describe __KAM_COUNT_URIS A multiple match used to count URIs in a message
  meta __KAM_HAS_0_URIS (__KAM_COUNT_URIS == 0)
  meta __KAM_HAS_1_URIS (__KAM_COUNT_URIS &gt;= 1)
  meta __KAM_HAS_2_URIS (__KAM_COUNT_URIS &gt;= 2)
  meta __KAM_HAS_3_URIS (__KAM_COUNT_URIS &gt;= 3)
  meta __KAM_HAS_4_URIS (__KAM_COUNT_URIS &gt;= 4)
  meta __KAM_HAS_5_URIS (__KAM_COUNT_URIS &gt;= 5)
  meta __KAM_HAS_10_URIS (__KAM_COUNT_URIS &gt;= 10)
  meta __KAM_HAS_15_URIS (__KAM_COUNT_URIS &gt;= 15)</pre>


<p style="margin-left:17%;">ips_only</p>

<p style="margin-left:23%;">This flag is specific to rules
invoking an <small>URIDNSBL</small> plugin, it is documented
there.</p>

<p style="margin-left:17%;">domains_only</p>

<p style="margin-left:23%;">This flag is specific to rules
invoking an <small>URIDNSBL</small> plugin, it is documented
there.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="17%"></td>
<td width="3%">


<p>ns</p></td>
<td width="3%"></td>
<td width="77%">


<p>This flag is specific to rules invoking an
<small>URIDNSBL</small> plugin, it is documented there.</p></td></tr>
<tr valign="top" align="left">
<td width="17%"></td>
<td width="3%">


<p>a</p></td>
<td width="3%"></td>
<td width="77%">


<p>This flag is specific to rules invoking an
<small>URIDNSBL</small> plugin, it is documented there.</p></td></tr>
</table>

<p style="margin-left:11%;">priority
<small>SYMBOLIC_TEST_NAME</small> n</p>

<p style="margin-left:17%;">Assign a specific priority to a
test. All tests, except for <small>DNS</small> and Meta
tests, are run in increasing priority value order (negative
priority values are run before positive priority values).
The default test priority is 0 (zero).</p>

<p style="margin-left:17%; margin-top: 1em">The values
&lt;&minus;99999999999999&gt; and
&lt;&minus;99999999999998&gt; have a special meaning
internally, and should not be used.</p>

<h2>ADMINISTRATOR SETTINGS
<a name="ADMINISTRATOR SETTINGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">These settings
differ from the ones above, in that they are considered
&rsquo;more privileged&rsquo; -- even more than the ones in
the <b><small>PRIVILEGED SETTINGS</small></b> section. No
matter what <tt>&quot;allow_user_rules&quot;</tt> is set to,
these can never be set from a user&rsquo;s
<tt>&quot;user_prefs&quot;</tt> file when spamc/spamd is
being used. However, all settings can be used by local
programs run directly by the user. <br>
version_tag string</p>

<p style="margin-left:17%;">This tag is appended to the
<small>SA</small> version in the X&minus;Spam-Status header.
You should include it when modify your ruleset, especially
if you plan to distribute it. A good choice for
<i>string</i> is your last name or your initials followed by
a number which you increase with each change.</p>

<p style="margin-left:17%; margin-top: 1em">The version_tag
will be lowercased, and any non-alphanumeric or period
character will be replaced by an underscore.</p>

<p style="margin-left:17%; margin-top: 1em">e.g.</p>

<pre style="margin-left:17%; margin-top: 1em">  version_tag myrules1    # version=2.41&minus;myrules1</pre>


<p style="margin-left:11%;">test
<small>SYMBOLIC_TEST_NAME</small> (ok|fail) Some string to
test against</p>

<p style="margin-left:17%;">Define a regression testing
string. You can have more than one regression test string
per symbolic test name. Simply specify a string that you
wish the test to match.</p>

<p style="margin-left:17%; margin-top: 1em">These tests are
only run as part of the test suite &minus; they should not
affect the general running of SpamAssassin.</p>

<p style="margin-left:11%;">rbl_timeout t [t_min] [zone]
(default: 15 3)</p>

<p style="margin-left:17%;">All <small>DNS</small> queries
are made at the beginning of a check and we try to read the
results at the end. This value specifies the maximum period
of time (in seconds) to wait for a <small>DNS</small> query.
If most of the <small>DNS</small> queries have succeeded for
a particular message, then SpamAssassin will not wait for
the full period to avoid wasting time on unresponsive
server(s), but will shrink the timeout according to a
percentage of queries already completed. As the number of
queries remaining approaches 0, the timeout value will
gradually approach a t_min value, which is an optional
second parameter and defaults to 0.2 * t. If t is smaller
than t_min, the initial timeout is set to t_min. Here is a
chart of queries remaining versus the timeout in seconds,
for the default 15 second / 3 second timeout setting:</p>

<pre style="margin-left:17%; margin-top: 1em">  queries left  100%  90%  80%  70%  60%  50%  40%  30%  20%  10%   0%
  timeout        15   14.9 14.5 13.9 13.1 12.0 10.7  9.1  7.3  5.3  3</pre>


<p style="margin-left:17%; margin-top: 1em">For example, if
20 queries are made at the beginning of a message check and
16 queries have returned (leaving 20%), the remaining 4
queries should finish within 7.3 seconds since their query
started or they will be timed out. Note that timed out
queries are only aborted when there is nothing else left for
SpamAssassin to do &minus; long evaluation of other rules
may grant queries additional time.</p>

<p style="margin-left:17%; margin-top: 1em">If a parameter
&rsquo;zone&rsquo; is specified (it must end with a letter,
which distinguishes it from other numeric parametrs), then
the setting only applies to <small>DNS</small> queries
against the specified <small>DNS</small> domain (host,
domain or <small>RBL</small> (sub)zone). Matching is
case-insensitive, the actual domain may be a subdomain of
the specified zone.</p>

<p style="margin-left:11%;">util_rb_tld tld1 tld2 ...</p>

<p style="margin-left:17%;">This option allows the addition
of new TLDs to the RegistrarBoundaries code. Updates to the
list usually happen when new versions of SpamAssassin are
released, but sometimes it&rsquo;s necessary to add in new
TLDs faster than a release can occur. TLDs include things
like com, net, org, etc.</p>

<p style="margin-left:11%;">util_rb_2tld 2tld&minus;1.tld
2tld&minus;2.tld ...</p>

<p style="margin-left:17%;">This option allows the addition
of new 2nd&minus;level TLDs (2TLD) to the
RegistrarBoundaries code. Updates to the list usually happen
when new versions of SpamAssassin are released, but
sometimes it&rsquo;s necessary to add in new 2TLDs faster
than a release can occur. 2TLDs include things like co.uk,
fed.us, etc.</p>

<p style="margin-left:11%;">util_rb_3tld 3tld1.some.tld
3tld2.other.tld ...</p>

<p style="margin-left:17%;">This option allows the addition
of new 3rd&minus;level TLDs (3TLD) to the
RegistrarBoundaries code. Updates to the list usually happen
when new versions of SpamAssassin are released, but
sometimes it&rsquo;s necessary to add in new 3TLDs faster
than a release can occur. 3TLDs include things like
demon.co.uk, plc.co.im, etc.</p>

<p style="margin-left:11%;">bayes_path /path/filename
(default: ~/.spamassassin/bayes)</p>

<p style="margin-left:17%;">This is the directory and
filename for Bayes databases. Several databases will be
created, with this as the base directory and filename, with
<tt>&quot;_toks&quot;</tt>, <tt>&quot;_seen&quot;</tt>, etc.
appended to the base. The default setting results in files
called <tt>&quot;~/.spamassassin/bayes_seen&quot;</tt>,
<tt>&quot;~/.spamassassin/bayes_toks&quot;</tt>, etc.</p>

<p style="margin-left:17%; margin-top: 1em">By default,
each user has their own in their
<tt>&quot;~/.spamassassin&quot;</tt> directory with mode
0700/0600. For system-wide SpamAssassin use, you may want to
reduce disk space usage by sharing this across all users.
However, Bayes appears to be more effective with individual
user databases.</p>

<p style="margin-left:11%;">bayes_file_mode (default:
0700)</p>

<p style="margin-left:17%;">The file mode bits used for the
Bayesian filtering database files.</p>

<p style="margin-left:17%; margin-top: 1em">Make sure you
specify this using the &rsquo;x&rsquo; mode bits set, as it
may also be used to create directories. However, if a file
is created, the resulting file will not have any execute
bits set (the umask is set to 111). The argument is a string
of octal digits, it is converted to a numeric value
internally.</p>

<p style="margin-left:11%;">bayes_store_module
Name::Of::BayesStore::Module</p>

<p style="margin-left:17%;">If this option is set, the
module given will be used as an alternate to the default
bayes storage mechanism. It must conform to the published
storage specification (see Mail::SpamAssassin::BayesStore).
For example, set this to Mail::SpamAssassin::BayesStore::SQL
to use the generic <small>SQL</small> storage module.</p>

<p style="margin-left:11%;">bayes_sql_dsn
DBI::databasetype:databasename:hostname:port</p>

<p style="margin-left:17%;">Used for BayesStore::SQL
storage implementation.</p>

<p style="margin-left:17%; margin-top: 1em">This option
give the connect string used to connect to the
<small>SQL</small> based Bayes storage.</p>

<p style="margin-left:11%;">bayes_sql_username</p>

<p style="margin-left:17%;">Used by BayesStore::SQL storage
implementation.</p>

<p style="margin-left:17%; margin-top: 1em">This option
gives the username used by the above <small>DSN.</small></p>

<p style="margin-left:11%;">bayes_sql_password</p>

<p style="margin-left:17%;">Used by BayesStore::SQL storage
implementation.</p>

<p style="margin-left:17%; margin-top: 1em">This option
gives the password used by the above <small>DSN.</small></p>

<p style="margin-left:11%;">bayes_sql_username_authorized (
0 | 1 ) (default: 0)</p>

<p style="margin-left:17%;">Whether to call the
services_authorized_for_username plugin hook in BayesSQL. If
the hook does not determine that the user is allowed to use
bayes or is invalid then then database will not be
initialized.</p>


<p style="margin-left:17%; margin-top: 1em"><small>NOTE:</small>
By default the user is considered invalid until a plugin
returns a true value. If you enable this, but do not have a
proper plugin loaded, all users will turn up as invalid.</p>

<p style="margin-left:17%; margin-top: 1em">The username
passed into the plugin can be affected by the
bayes_sql_override_username config option.</p>

<p style="margin-left:11%;">user_scores_dsn
DBI:databasetype:databasename:hostname:port</p>

<p style="margin-left:17%;">If you load user scores from an
<small>SQL</small> database, this will set the
<small>DSN</small> used to connect. Example:
<tt>&quot;DBI:mysql:spamassassin:localhost&quot;</tt></p>

<p style="margin-left:17%; margin-top: 1em">If you load
user scores from an <small>LDAP</small> directory, this will
set the <small>DSN</small> used to connect. You have to
write the <small>DSN</small> as an <small>LDAP URL,</small>
the components being the host and port to connect to, the
base <small>DN</small> for the search, the scope of the
search (base, one or sub), the single attribute being the
multivalued attribute used to hold the configuration data
(space separated pairs of key and value, just as in a file)
and finally the filter being the expression used to filter
out the wanted username. Note that the filter expression is
being used in a sprintf statement with the username as the
only parameter, thus is can hold a single __USERNAME__
expression. This will be replaced with the username.</p>

<p style="margin-left:17%; margin-top: 1em">Example:
<tt>&quot;ldap://localhost:389/dc=koehntopp,dc=de?saconfig?uid=__USERNAME__&quot;</tt></p>

<p style="margin-left:11%;">user_scores_sql_username
username</p>

<p style="margin-left:17%;">The authorized username to
connect to the above <small>DSN.</small></p>

<p style="margin-left:11%;">user_scores_sql_password
password</p>

<p style="margin-left:17%;">The password for the database
username, for the above <small>DSN.</small></p>

<p style="margin-left:11%;">user_scores_sql_custom_query
query</p>

<p style="margin-left:17%;">This option gives you the
ability to create a custom <small>SQL</small> query to
retrieve user scores and preferences. In order to work
correctly your query should return two values, the
preference name and value, in that order. In addition, there
are several &quot;variables&quot; that you can use as part
of your query, these variables will be substituted for the
current values right before the query is run. The current
allowed variables are: <br>
_TABLE_</p>

<p style="margin-left:23%;">The name of the table where
user scores and preferences are stored. Currently hardcoded
to userpref, to change this value you need to create a new
custom query with the new table name.</p>

<p style="margin-left:17%;">_USERNAME_</p>

<p style="margin-left:23%;">The current user&rsquo;s
username.</p>

<p style="margin-left:17%;">_MAILBOX_</p>

<p style="margin-left:23%;">The portion before the @ as
derived from the current user&rsquo;s username.</p>

<p style="margin-left:17%;">_DOMAIN_</p>

<p style="margin-left:23%;">The portion after the @ as
derived from the current user&rsquo;s username, this value
may be null.</p>

<p style="margin-left:17%; margin-top: 1em">The query must
be one continuous line in order to parse correctly.</p>

<p style="margin-left:17%; margin-top: 1em">Here are
several example queries, please note that these are broken
up for easy reading, in your config it should be one
continuous line. <br>
Current default query:</p>

<p style="margin-left:23%;"><tt>&quot;SELECT preference,
value FROM _TABLE_ WHERE username = _USERNAME_ OR username =
'@GLOBAL' ORDER BY username ASC&quot;</tt></p>

<p style="margin-left:17%;">Use global and then domain
level defaults:</p>

<p style="margin-left:23%;"><tt>&quot;SELECT preference,
value FROM _TABLE_ WHERE username = _USERNAME_ OR username =
'@GLOBAL' OR username = '@~'||_DOMAIN_ ORDER BY username
ASC&quot;</tt></p>

<p style="margin-left:17%;">Maybe global prefs should
override user prefs:</p>

<p style="margin-left:23%;"><tt>&quot;SELECT preference,
value FROM _TABLE_ WHERE username = _USERNAME_ OR username =
'@GLOBAL' ORDER BY username DESC&quot;</tt></p>

<p style="margin-left:11%;">user_scores_ldap_username</p>

<p style="margin-left:17%;">This is the Bind
<small>DN</small> used to connect to the <small>LDAP</small>
server. It defaults to the empty string (&quot;&quot;),
allowing anonymous binding to work.</p>

<p style="margin-left:17%; margin-top: 1em">Example:
<tt>&quot;cn=master,dc=koehntopp,dc=de&quot;</tt></p>

<p style="margin-left:11%;">user_scores_ldap_password</p>

<p style="margin-left:17%;">This is the password used to
connect to the <small>LDAP</small> server. It defaults to
the empty string (&quot;&quot;).</p>

<p style="margin-left:11%;">user_scores_fallback_to_global
(default: 1)</p>

<p style="margin-left:17%;">Fall back to global scores and
settings if userprefs can&rsquo;t be loaded from
<small>SQL</small> or <small>LDAP,</small> instead of
passing the message through unprocessed.</p>

<p style="margin-left:11%;">loadplugin PluginModuleName
[/path/module.pm]</p>

<p style="margin-left:17%;">Load a SpamAssassin plugin
module. The <tt>&quot;PluginModuleName&quot;</tt> is the
perl module name, used to create the plugin object
itself.</p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;/path/to/module.pm&quot;</tt>
is the file to load, containing the module&rsquo;s perl
code; if it&rsquo;s specified as a relative path, it&rsquo;s
considered to be relative to the current configuration file.
If it is omitted, the module will be loaded using
perl&rsquo;s search path (the <tt>@INC</tt> array).</p>

<p style="margin-left:17%; margin-top: 1em">See
<tt>&quot;Mail::SpamAssassin::Plugin&quot;</tt> for more
details on writing plugins.</p>

<p style="margin-left:11%;">tryplugin PluginModuleName
[/path/module.pm]</p>

<p style="margin-left:17%;">Same as
<tt>&quot;loadplugin&quot;</tt>, but silently ignored if the
.pm file cannot be found in the filesystem.</p>

<p style="margin-left:11%;">ignore_always_matching_regexps
(Default: 0)</p>

<p style="margin-left:17%;">Ignore any rule which contains
a regexp which always matches. Currently only catches
regexps which contain &rsquo;||&rsquo;, or which begin or
end with a &rsquo;|&rsquo;. Also ignore rules with
<tt>&quot;some&quot;</tt> combinatorial explosions.</p>

<h2>PREPROCESSING OPTIONS
<a name="PREPROCESSING OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">include
filename</p>

<p style="margin-left:17%;">Include configuration lines
from <tt>&quot;filename&quot;</tt>. Relative paths are
considered relative to the current configuration file or
user preferences file.</p>

<p style="margin-left:11%;">if (boolean perl
expression)</p>

<p style="margin-left:17%;">Used to support conditional
interpretation of the configuration file. Lines between this
and a corresponding <tt>&quot;else&quot;</tt> or
<tt>&quot;endif&quot;</tt> line will be ignored unless the
expression evaluates as true (in the perl sense; that is,
defined and non&minus;0 and non-empty string).</p>

<p style="margin-left:17%; margin-top: 1em">The conditional
accepts a limited subset of perl for security -- just enough
to perform basic arithmetic comparisons. The following input
is accepted: <br>
numbers, whitespace, arithmetic operations and grouping</p>

<p style="margin-left:23%;">Namely these characters and
ranges:</p>

<pre style="margin-left:23%; margin-top: 1em">  ( ) &minus; + * / _ . , &lt; = &gt; ! ~ 0&minus;9 whitespace</pre>


<p style="margin-left:17%;">version</p>

<p style="margin-left:23%;">This will be replaced with the
version number of the currently-running SpamAssassin engine.
Note: The version used is in the internal SpamAssassin
version format which is <tt>&quot;x.yyyzzz&quot;</tt>, where
x is major version, y is minor version, and z is maintenance
version. So 3.0.0 is <tt>3.000000</tt>, and 3.4.80 is
<tt>3.004080</tt>.</p>

<p style="margin-left:17%;">plugin(Name::Of::Plugin)</p>

<p style="margin-left:23%;">This is a function call that
returns <tt>1</tt> if the plugin named
<tt>&quot;Name::Of::Plugin&quot;</tt> is loaded, or
<tt>&quot;undef&quot;</tt> otherwise.</p>


<p style="margin-left:17%;">has(Name::Of::Package::function_name)</p>

<p style="margin-left:23%;">This is a function call that
returns <tt>1</tt> if the perl package named
<tt>&quot;Name::Of::Package&quot;</tt> includes a function
called <tt>&quot;function_name&quot;</tt>, or
<tt>&quot;undef&quot;</tt> otherwise. Note that packages can
be SpamAssassin plugins or built-in classes, there&rsquo;s
no difference in this respect. Internally this invokes
UNIVERSAL::can.</p>


<p style="margin-left:17%;">can(Name::Of::Package::function_name)</p>

<p style="margin-left:23%;">This is a function call that
returns <tt>1</tt> if the perl package named
<tt>&quot;Name::Of::Package&quot;</tt> includes a function
called <tt>&quot;function_name&quot;</tt> <b>and</b> that
function returns a true value when called with no arguments,
otherwise <tt>&quot;undef&quot;</tt> is returned.</p>

<p style="margin-left:23%; margin-top: 1em">Is similar to
<tt>&quot;has&quot;</tt>, except that it also calls the
named function, testing its return value (unlike the perl
function UNIVERSAL::can). This makes it possible for a
&rsquo;feature&rsquo; function to determine its result value
at run time.</p>

<p style="margin-left:17%; margin-top: 1em">If the end of a
configuration file is reached while still inside a
<tt>&quot;if&quot;</tt> scope, a warning will be issued, but
parsing will restart on the next file.</p>

<p style="margin-left:17%; margin-top: 1em">For
example:</p>

<pre style="margin-left:17%; margin-top: 1em">        if (version &gt; 3.000000)
          header MY_FOO ...
        endif
        loadplugin MyPlugin plugintest.pm
        if plugin (MyPlugin)
          header MY_PLUGIN_FOO  eval:check_for_foo()
          score  MY_PLUGIN_FOO  0.1
        endif</pre>


<p style="margin-left:11%;">ifplugin PluginModuleName</p>

<p style="margin-left:17%;">An alias for <tt>&quot;if
plugin(PluginModuleName)&quot;</tt>.</p>

<p style="margin-left:11%;">else</p>

<p style="margin-left:17%;">Used to support conditional
interpretation of the configuration file. Lines between this
and a corresponding <tt>&quot;endif&quot;</tt> line, will be
ignored unless the conditional expression evaluates as false
(in the perl sense; that is, not defined and not 0 and
non-empty string).</p>

<p style="margin-left:11%;">require_version n.nnnnnn</p>

<p style="margin-left:17%;">Indicates that the entire file,
from this line on, requires a certain version of
SpamAssassin to run. If a different (older or newer) version
of SpamAssassin tries to read the configuration from this
file, it will output a warning instead, and ignore it.</p>

<p style="margin-left:17%; margin-top: 1em">Note: The
version used is in the internal SpamAssassin version format
which is <tt>&quot;x.yyyzzz&quot;</tt>, where x is major
version, y is minor version, and z is maintenance version.
So 3.0.0 is <tt>3.000000</tt>, and 3.4.80 is
<tt>3.004080</tt>.</p>

<h2>TEMPLATE TAGS
<a name="TEMPLATE TAGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The following
<tt>&quot;tags&quot;</tt> can be used as placeholders in
certain options. They will be replaced by the corresponding
value when they are used.</p>

<p style="margin-left:11%; margin-top: 1em">Some tags can
take an argument (in parentheses). The argument is optional,
and the default is shown below.</p>

<pre style="margin-left:11%; margin-top: 1em"> _YESNO_           &quot;Yes&quot; for spam, &quot;No&quot; for nonspam (=ham)
 _YESNO(spam_str,ham_str)_  returns the first argument (&quot;Yes&quot; if missing)
                   for spam, and the second argument (&quot;No&quot; if missing) for ham
 _YESNOCAPS_       &quot;YES&quot; for spam, &quot;NO&quot; for nonspam (=ham)
 _YESNOCAPS(spam_str,ham_str)_  same as _YESNO(...)_, but uppercased
 _SCORE(PAD)_      message score, if PAD is included and is either spaces or
                   zeroes, then pad scores with that many spaces or zeroes
                   (default, none)  ie: _SCORE(0)_ makes 2.4 become 02.4,
                   _SCORE(00)_ is 002.4.  12.3 would be 12.3 and 012.3
                   respectively.
 _REQD_            message threshold
 _VERSION_         version (eg. 3.0.0 or 3.1.0&minus;r26142&minus;foo1)
 _SUBVERSION_      sub&minus;version/code revision date (eg. 2004&minus;01&minus;10)
 _RULESVERSION_    comma&minus;separated list of rules versions, retrieved from
                   an '# UPDATE version' comment in rules files; if there is
                   more than one set of rules (update channels) the order
                   is unspecified (currently sorted by names of files);
 _HOSTNAME_        hostname of the machine the mail was processed on
 _REMOTEHOSTNAME_  hostname of the machine the mail was sent from, only
                   available with spamd
 _REMOTEHOSTADDR_  ip address of the machine the mail was sent from, only
                   available with spamd
 _BAYES_           bayes score
 _TOKENSUMMARY_    number of new, neutral, spammy, and hammy tokens found
 _BAYESTC_         number of new tokens found
 _BAYESTCLEARNED_  number of seen tokens found
 _BAYESTCSPAMMY_   number of spammy tokens found
 _BAYESTCHAMMY_    number of hammy tokens found
 _HAMMYTOKENS(N)_  the N most significant hammy tokens (default, 5)
 _SPAMMYTOKENS(N)_ the N most significant spammy tokens (default, 5)
 _DATE_            rfc&minus;2822 date of scan
 _STARS(*)_        one &quot;*&quot; (use any character) for each full score point
                   (note: limited to 50 'stars')
 _RELAYSTRUSTED_   relays used and deemed to be trusted (see the
                   'X&minus;Spam&minus;Relays&minus;Trusted' pseudo&minus;header)
 _RELAYSUNTRUSTED_ relays used that can not be trusted (see the
                   'X&minus;Spam&minus;Relays&minus;Untrusted' pseudo&minus;header)
 _RELAYSINTERNAL_  relays used and deemed to be internal (see the
                   'X&minus;Spam&minus;Relays&minus;Internal' pseudo&minus;header)
 _RELAYSEXTERNAL_  relays used and deemed to be external (see the
                   'X&minus;Spam&minus;Relays&minus;External' pseudo&minus;header)
 _LASTEXTERNALIP_  IP address of client in the external&minus;to&minus;internal
                   SMTP handover
 _LASTEXTERNALRDNS_ reverse&minus;DNS of client in the external&minus;to&minus;internal
                   SMTP handover
 _LASTEXTERNALHELO_ HELO string used by client in the external&minus;to&minus;internal
                   SMTP handover
 _AUTOLEARN_       autolearn status (&quot;ham&quot;, &quot;no&quot;, &quot;spam&quot;, &quot;disabled&quot;,
                   &quot;failed&quot;, &quot;unavailable&quot;)
 _AUTOLEARNSCORE_  portion of message score used by autolearn
 _TESTS(,)_        tests hit separated by &quot;,&quot; (or other separator)
 _TESTSSCORES(,)_  as above, except with scores appended (eg. AWL=&minus;3.0,...)
 _SUBTESTS(,)_     subtests (start with &quot;__&quot;) hit separated by &quot;,&quot;
                   (or other separator)
 _DCCB_            DCC's &quot;Brand&quot;
 _DCCR_            DCC's results
 _PYZOR_           Pyzor results
 _RBL_             full results for positive RBL queries in DNS URI format
 _LANGUAGES_       possible languages of mail
 _PREVIEW_         content preview
 _REPORT_          terse report of tests hit (for header reports)
 _SUMMARY_         summary of tests hit for standard report (for body reports)
 _CONTACTADDRESS_  contents of the 'report_contact' setting
 _HEADER(NAME)_    includes the value of a message header.  value is the same
                   as is found for header rules (see elsewhere in this doc)
 _TIMING_          timing breakdown report
 _ADDEDHEADERHAM_  resulting header fields as requested by add_header for spam
 _ADDEDHEADERSPAM_ resulting header fields as requested by add_header for ham
 _ADDEDHEADER_     same as ADDEDHEADERHAM for ham or ADDEDHEADERSPAM for spam</pre>


<p style="margin-left:11%; margin-top: 1em">If a tag
reference uses the name of a tag which is not in this list
or defined by a loaded plugin, the reference will be left
intact and not replaced by any value.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;HAMMYTOKENS&quot;</tt> and
<tt>&quot;SPAMMYTOKENS&quot;</tt> tags have an optional
second argument which specifies a format. See the
<b><small>HAMMYTOKENS/SPAMMYTOKENS TAG FORMAT</small></b>
section, below, for details.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>HAMMYTOKENS/SPAMMYTOKENS
TAG FORMAT</small></b> <br>
The <tt>&quot;HAMMYTOKENS&quot;</tt> and
<tt>&quot;SPAMMYTOKENS&quot;</tt> tags have an optional
second argument which specifies a format:
<tt>&quot;_SPAMMYTOKENS(N,FMT)_&quot;</tt>,
<tt>&quot;_HAMMYTOKENS(N,FMT)_&quot;</tt> The following
formats are available: <br>
short</p>

<p style="margin-left:17%;">Only the tokens themselves are
listed. <i>For example, preference file entry:</i></p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;add_header
all Spammy _SPAMMYTOKENS(2,short)_&quot;</tt></p>

<p style="margin-left:17%; margin-top: 1em"><i>Results in
message header:</i></p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;X&minus;Spam&minus;Spammy:
remove.php, UD:jpg&quot;</tt></p>

<p style="margin-left:17%; margin-top: 1em">Indicating that
the top two spammy tokens found are
<tt>&quot;remove.php&quot;</tt> and
<tt>&quot;UD:jpg&quot;</tt>. (The token itself follows the
last colon, the text before the colon indicates something
about the token. <tt>&quot;UD&quot;</tt> means the token
looks like it might be part of a domain name.)</p>

<p style="margin-left:11%;">compact</p>

<p style="margin-left:17%;">The token probability, an
abbreviated declassification distance (see example), and the
token are listed. <i>For example, preference file
entry:</i></p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;add_header
all Spammy _SPAMMYTOKENS(2,compact)_&quot;</tt></p>

<p style="margin-left:17%; margin-top: 1em"><i>Results in
message header:</i></p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;0.989&minus;6&minus;&minus;remove.php,
0.988&minus;+&minus;&minus;UD:jpg&quot;</tt></p>

<p style="margin-left:17%; margin-top: 1em">Indicating that
the probabilities of the top two tokens are 0.989 and 0.988,
respectively. The first token has a declassification
distance of 6, meaning that if the token had appeared in at
least 6 more ham messages it would not be considered spammy.
The <tt>&quot;+&quot;</tt> for the second token indicates a
declassification distance greater than 9.</p>

<p style="margin-left:11%;">long</p>

<p style="margin-left:17%;">Probability, declassification
distance, number of times seen in a ham message, number of
times seen in a spam message, age and the token are
listed.</p>

<p style="margin-left:17%; margin-top: 1em"><i>For example,
preference file entry:</i></p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;add_header
all Spammy _SPAMMYTOKENS(2,long)_&quot;</tt></p>

<p style="margin-left:17%; margin-top: 1em"><i>Results in
message header:</i></p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;X&minus;Spam&minus;Spammy:
0.989&minus;6&minus;&minus;0h&minus;4s&minus;&minus;4d&minus;&minus;remove.php,
0.988&minus;33&minus;&minus;2h&minus;25s&minus;&minus;1d&minus;&minus;UD:jpg&quot;</tt></p>

<p style="margin-left:17%; margin-top: 1em">In addition to
the information provided by the compact option, the long
option shows that the first token appeared in zero ham
messages and four spam messages, and that it was last seen
four days ago. The second token appeared in two ham
messages, 25 spam messages and was last seen one day ago.
(Unlike the <tt>&quot;compact&quot;</tt> option, the long
option shows declassification distances that are greater
than 9.)</p>

<h2>LOCALI[SZ]ATION
<a name="LOCALI[SZ]ATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">A line starting
with the text <tt>&quot;lang xx&quot;</tt> will only be
interpreted if the user is in that locale, allowing test
descriptions and templates to be set for that language.</p>

<p style="margin-left:11%; margin-top: 1em">The locales
string should specify either both the language and country,
e.g. <tt>&quot;lang pt_BR&quot;</tt>, or just the language,
e.g. <tt>&quot;lang de&quot;</tt>.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><tt>&quot;Mail::SpamAssassin&quot;
&quot;spamassassin&quot; &quot;spamd&quot;</tt></p>
<hr>
</body>
</html>
