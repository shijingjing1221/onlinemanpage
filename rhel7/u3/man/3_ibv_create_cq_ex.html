<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 21:41:51 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>IBV_CREATE_CQ_EX</title>

</head>
<body>

<h1 align="center">IBV_CREATE_CQ_EX</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#Polling an extended CQ">Polling an extended CQ</a><br>
<a href="#RETURN VALUE">RETURN VALUE</a><br>
<a href="#NOTES">NOTES</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#AUTHORS">AUTHORS</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">ibv_create_cq_ex
&minus; create a completion queue (CQ)</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>#include
&lt;infiniband/verbs.h&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>struct
ibv_cq_ex *ibv_create_cq_ex(struct ibv_context</b>
<i>*context</i><b>, <br>
struct ibv_create_cq_attr_ex</b>
<i>*cq_attr</i><b>);</b></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>ibv_create_cq_ex()</b>
creates a completion queue (CQ) for RDMA device context
<i>context</i>. The argument <i>cq_attr</i> is a pointer to
struct ibv_create_cq_attr_ex as defined in
&lt;infiniband/verbs.h&gt;.</p>

<p style="margin-left:11%; margin-top: 1em">struct
ibv_create_cq_attr_ex {</p>

<p style="margin-left:23%;">int cqe; /* Minimum number of
entries required for CQ */ <br>
void *cq_context; /* Consumer-supplied context returned for
completion events */ <br>
struct ibv_comp_channel *channel; /* Completion channel
where completion events will be queued. May be NULL if
completion events will not be used. */ <br>
int comp_vector; /* Completion vector used to signal
completion events. Must be &gt;= 0 and &lt;
context-&gt;num_comp_vectors. */ <br>
uint64_t wc_flags; /* The wc_flags that should be returned
in ibv_poll_cq_ex. Or&rsquo;ed bit of enum ibv_wc_flags_ex.
*/ <br>
uint32_t comp_mask; /* compatibility mask (extended verb).
*/</p>

<p style="margin-left:11%;">};</p>

<p style="margin-left:11%; margin-top: 1em">enum
ibv_wc_flags_ex { <br>
IBV_WC_EX_WITH_BYTE_LEN = 1 &lt;&lt; 0, /* Require byte len
in WC */ <br>
IBV_WC_EX_WITH_IMM = 1 &lt;&lt; 1, /* Require immediate in
WC */ <br>
IBV_WC_EX_WITH_QP_NUM = 1 &lt;&lt; 2, /* Require QP number
in WC */ <br>
IBV_WC_EX_WITH_SRC_QP = 1 &lt;&lt; 3, /* Require source QP
in WC */ <br>
IBV_WC_EX_WITH_SLID = 1 &lt;&lt; 4, /* Require slid in WC */
<br>
IBV_WC_EX_WITH_SL = 1 &lt;&lt; 5, /* Require sl in WC */
<br>
IBV_WC_EX_WITH_DLID_PATH_BITS = 1 &lt;&lt; 6, /* Require
dlid path bits in WC */ <br>
IBV_WC_EX_WITH_COMPLETION_TIMESTAMP = 1 &lt;&lt; 7, /*
Require completion timestamp in WC /* <br>
};</p>

<p style="margin-left:11%; margin-top: 1em">enum
ibv_cq_init_attr_mask { <br>
IBV_CQ_INIT_ATTR_MASK_FLAGS = 1 &lt;&lt; 0, <br>
};</p>

<p style="margin-left:11%; margin-top: 1em">enum
ibv_create_cq_attr_flags { <br>
IBV_CREATE_CQ_ATTR_SINGLE_THREADED = 1 &lt;&lt; 0, /* This
CQ is used from a single threaded, thus no locking is
required */ <br>
};</p>

<h2>Polling an extended CQ
<a name="Polling an extended CQ"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">In order to
poll an extended CQ efficiently, a user could use the
following functions. <b><br>
Completion iterator functions</b></p>

<p style="margin-left:22%; margin-top: 1em"><b>int
ibv_start_poll(struct ibv_cq_ex</b> <i>*cq</i><b>, struct
ibv_poll_cq_attr</b> <i>*attr</i><b>)</b> <br>
Start polling a batch of work completions. <i>attr</i> is
given in order to make this function easily extensible in
the future. This function either returns 0 on success or an
error code otherwise. When no completions are available on
the CQ, ENOENT is returned, but the CQ remains in a valid
state. On success, querying the completion&rsquo;s attribute
could be done using the query functions described below. If
an error code is given, end_poll shouldn&rsquo;t be
called.</p>

<p style="margin-left:22%; margin-top: 1em"><b>int
ibv_next_poll(struct ibv_cq_ex</b> <i>*cq</i><b>)</b> <br>
This function is called in order to get the next work
completion. It has to be called after <i>start_poll</i> and
before <i>end_poll</i> are called. This function either
returns 0 on success or an error code otherwise. When no
completions are available on the CQ, ENOENT is returned, but
the CQ remains in a valid state. On success, querying the
completion&rsquo;s attribute could be done using the query
functions described below. If an error code is given,
end_poll should still be called, indicating this is the end
of the polled batch.</p>

<p style="margin-left:22%; margin-top: 1em"><b>void
ibv_end_poll(struct ibv_cq_ex</b> <i>*cq</i><b>)</b> <br>
This function indicates the end of polling batch of work
completions. After calling this function, the user should
start a new batch by calling <i>start_poll.</i></p>

<p style="margin-left:11%;"><b>Polling fields in the
completion</b></p>

<p style="margin-left:22%;">Below members and functions are
used in order to poll the current completion. The current
completion is the completion which the iterator points to
(start_poll and next_poll advances this iterator). Only
fields that the user requested via wc_flags in
ibv_create_cq_ex could be queried. In addition, some fields
are only valid in certain opcodes and status codes.</p>

<p style="margin-left:22%; margin-top: 1em"><b>uint64_t
wr_id - Can be accessed directly from struct
ibv_cq_ex</b><i>.</i></p>

<p style="margin-left:22%; margin-top: 1em"><b>enum
ibv_wc_status - Can be accessed directly from struct
ibv_cq_ex</b><i>.</i></p>

<p style="margin-left:22%; margin-top: 1em"><b>enum
ibv_wc_opcode ibv_wc_read_opcode(struct ibv_cq_ex</b>
<i>*cq</i><b>);</b> Get the opcode from the current
completion.</p>

<p style="margin-left:22%; margin-top: 1em"><b>uint32_t
ibv_wc_read_vendor_err(struct ibv_cq_ex</b>
<i>*cq</i><b>);</b> Get the vendor error from the current
completion.</p>

<p style="margin-left:22%; margin-top: 1em"><b>uint32_t
ibv_wc_read_byte_len(struct ibv_cq_ex</b>
<i>*cq</i><b>);</b> Get the vendor error from the current
completion.</p>

<p style="margin-left:22%; margin-top: 1em"><b>uint32_t
ibv_wc_read_imm_data(struct ibv_cq_ex</b>
<i>*cq</i><b>);</b> Get the immediate data field from the
current completion.</p>

<p style="margin-left:22%; margin-top: 1em"><b>uint32_t
ibv_wc_read_qp_num(struct ibv_cq_ex</b> <i>*cq</i><b>);</b>
Get the QP number field from the current completion.</p>

<p style="margin-left:22%; margin-top: 1em"><b>uint32_t
ibv_wc_read_src_qp(struct ibv_cq_ex</b> <i>*cq</i><b>);</b>
Get the source QP number field from the current
completion.</p>

<p style="margin-left:22%; margin-top: 1em"><b>int
ibv_wc_read_wc_flags(struct ibv_cq_ex</b>
<i>*cq</i><b>);</b> Get the QP flags field from the current
completion.</p>

<p style="margin-left:22%; margin-top: 1em"><b>uint16_t
ibv_wc_read_pkey_index(struct ibv_cq_ex</b>
<i>*cq</i><b>);</b> Get the pkey index field from the
current completion.</p>

<p style="margin-left:22%; margin-top: 1em"><b>uint32_t
ibv_wc_read_slid(struct ibv_cq_ex</b> <i>*cq</i><b>);</b>
Get the slid field from the current completion.</p>

<p style="margin-left:22%; margin-top: 1em"><b>uint8_t
ibv_wc_read_sl(struct ibv_cq_ex</b> <i>*cq</i><b>);</b> Get
the sl field from the current completion.</p>

<p style="margin-left:22%; margin-top: 1em"><b>uint8_t
ibv_wc_read_dlid_path_bits(struct ibv_cq_ex</b>
<i>*cq</i><b>);</b> Get the dlid_path_bits field from the
current completion.</p>

<p style="margin-left:22%; margin-top: 1em"><b>uint64_t
ibv_wc_read_completion_ts(struct ibv_cq_ex</b>
<i>*cq</i><b>);</b> Get the completion timestamp from the
current completion.</p>

<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>ibv_create_cq_ex()</b>
returns a pointer to the CQ, or NULL if the request
fails.</p>

<h2>NOTES
<a name="NOTES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>ibv_create_cq_ex()</b>
may create a CQ with size greater than or equal to the
requested size. Check the cqe attribute in the returned CQ
for the actual size.</p>

<p style="margin-left:11%; margin-top: 1em">CQ should be
destroyed with ibv_destroy_cq.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>ibv_create_cq</b>(3),
<b>ibv_destroy_cq</b>(3), <b>ibv_resize_cq</b>(3),
<b>ibv_req_notify_cq</b>(3), <b>ibv_ack_cq_events</b>(3),
<b>ibv_create_qp</b>(3)</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Matan Barak
&lt;matanb@mellanox.com&gt;</p>
<hr>
</body>
</html>
