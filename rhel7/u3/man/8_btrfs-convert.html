<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 20:56:00 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>BTRFS&minus;CONVERT</title>

</head>
<body>

<h1 align="center">BTRFS&minus;CONVERT</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#EXIT STATUS">EXIT STATUS</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">btrfs-convert
&minus; convert from ext2/3/4 filesystem to btrfs</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>btrfs&minus;convert</b>
[options] <i>&lt;device&gt;</i></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><i><b>btrfs&minus;convert</b></i>
is used to convert existing ext2/3/4 filesystem image to a
btrfs filesystem in&minus;place. The original filesystem
image is accessible subvolume named <i>ext2_saved</i> as
file <i>image</i>.</p>


<p style="margin-left:17%; margin-top: 1em"><b><big>Warning</big></b>
<br>
If you are going to perform rollback to ext2/3/4, you should
not execute <b>btrfs balance</b> command on the converted
filesystem. This will change the extent layout and make
<b>btrfs&minus;convert</b> unable to rollback.</p>

<p style="margin-left:11%; margin-top: 1em">The conversion
utilizes free space of the original filesystem. The exact
estimate of the required space cannot be foretold. The final
btrfs metadata might occupy several gigabytes on a
hundreds&minus;gigabyte filesystem.</p>

<p style="margin-left:11%; margin-top: 1em">If you decide
not to rollback anymore, it is recommended to perform a few
more steps to transform the btrfs filesystem to a more
compact layout. The conversion inherits the original data
block fragmentation and the metadata blocks are bound to the
original free space layout.</p>

<p style="margin-left:11%; margin-top: 1em"><b>REMOVE THE
ORIGINAL FILESYSTEM METADATA</b></p>

<p style="margin-left:11%; margin-top: 1em">By removing the
<i>ext2_saved</i> subvolume, all metadata of the original
filesystem will be removed:</p>

<p style="margin-left:17%; margin-top: 1em"># btrfs
subvolume delete /mnt/ext2_saved</p>

<p style="margin-left:11%; margin-top: 1em">At this point
it&rsquo;s not possible to do rollback. The filesystem is
usable but may be impacted by the fragmentation.</p>

<p style="margin-left:11%; margin-top: 1em"><b>MAKE FILE
DATA MORE CONTIGUOUS</b></p>

<p style="margin-left:11%; margin-top: 1em">An optional but
recommended step is to run defragmentation on the entire
filesystem. This will attempt to make file extents more
contiguous.</p>

<p style="margin-left:17%; margin-top: 1em"># btrfs
filesystem defrag &minus;v &minus;r &minus;f &minus;t 32M
/mnt/btrfs</p>

<p style="margin-left:11%; margin-top: 1em">Verbose
recursive defragmentation (<i>&minus;v</i>,
<i>&minus;r</i>), flush data per&minus;file
(<i>&minus;f</i>) with target extent size 32M
(<i>&minus;t</i>).</p>

<p style="margin-left:11%; margin-top: 1em"><b>ATTEMPT TO
MAKE BTRFS METADATA MORE COMPACT</b></p>

<p style="margin-left:11%; margin-top: 1em">Optional but
recommended step.</p>

<p style="margin-left:11%; margin-top: 1em">The metadata
block groups after conversion may be smaller than the
default size (256MiB or 1GiB). Running a balance will
attempt to merge the block groups. This depends on the free
space layout (and fragmentation) and may fail. This is a
soft error leaving the filesystem usable but the block group
layout may remain unchanged.</p>

<p style="margin-left:11%; margin-top: 1em">Note that
balance operation takes a lot of time.</p>

<p style="margin-left:17%; margin-top: 1em"># btrfs balance
start &minus;m /mnt/btrfs</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><big>&minus;d|&minus;&minus;no&minus;datasum</big></p>

<p style="margin-left:17%;"><big>disable data checksum
calculations and set NODATASUM file flag, this can speed up
the conversion</big></p>


<p style="margin-left:11%; margin-top: 1em"><big>&minus;i|&minus;&minus;no&minus;xattr</big></p>

<p style="margin-left:17%;"><big>ignore xattrs and ACLs of
files</big></p>


<p style="margin-left:11%; margin-top: 1em"><big>&minus;n|&minus;&minus;no&minus;inline</big></p>

<p style="margin-left:17%;"><big>disable inlining of small
files to metadata blocks, this will decrease the metadata
consumption and may help to convert a filesystem with low
free space</big></p>


<p style="margin-left:11%; margin-top: 1em"><big>&minus;N|&minus;&minus;nodesize
<i>&lt;SIZE&gt;</i></big></p>

<p style="margin-left:17%;"><big>set filesystem nodesize,
the tree block size in which btrfs stores its metadata. The
default value is 16KB (16384) or the page size, whichever is
bigger. Must be a multiple of the sectorsize, but not larger
than 65536. Se <b>mkfs.btrfs</b>(8) for more
details.</big></p>


<p style="margin-left:11%; margin-top: 1em"><big>&minus;r|&minus;&minus;rollback</big></p>

<p style="margin-left:17%;"><big>rollback to the original
ext2/3/4 filesystem if possible</big></p>


<p style="margin-left:11%; margin-top: 1em"><big>&minus;l|&minus;&minus;label
<i>&lt;LABEL&gt;</i></big></p>

<p style="margin-left:17%;"><big>set filesystem label
during conversion</big></p>


<p style="margin-left:11%; margin-top: 1em"><big>&minus;L|&minus;&minus;copy&minus;label</big></p>

<p style="margin-left:17%;"><big>use label from the
converted filesystem</big></p>


<p style="margin-left:11%; margin-top: 1em"><big>&minus;p|&minus;&minus;progress</big></p>

<p style="margin-left:17%;"><big>show progress of
conversion, on by default</big></p>


<p style="margin-left:11%; margin-top: 1em"><big>&minus;&minus;no&minus;progress</big></p>

<p style="margin-left:17%;"><big>disable detailed progress
and show only the main phases of conversion</big></p>

<h2>EXIT STATUS
<a name="EXIT STATUS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><big><b>btrfs&minus;convert</b>
will return 0 if no error happened. If any problems
happened, 1 will be returned.</big></p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><big><b>mkfs.btrfs</b>(8)</big></p>
<hr>
</body>
</html>
