<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 21:02:11 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>Class::Singleton</title>

</head>
<body>

<h1 align="center">Class::Singleton</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#PREREQUISITES">PREREQUISITES</a><br>
<a href="#INSTALLATION">INSTALLATION</a><br>
<a href="#USING THE CLASS::SINGLETON MODULE">USING THE CLASS::SINGLETON MODULE</a><br>
<a href="#DERIVING SINGLETON CLASSES">DERIVING SINGLETON CLASSES</a><br>
<a href="#METHODS">METHODS</a><br>
<a href="#AUTHOR">AUTHOR</a><br>
<a href="#VERSION">VERSION</a><br>
<a href="#COPYRIGHT">COPYRIGHT</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">Class::Singleton
&minus; Implementation of a &quot;Singleton&quot; class</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<pre style="margin-left:11%; margin-top: 1em">    use Class::Singleton;
    my $one = Class::Singleton&minus;&gt;instance();   # returns a new instance
    my $two = Class::Singleton&minus;&gt;instance();   # returns same instance</pre>


<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This is the
<tt>&quot;Class::Singleton&quot;</tt> module. A Singleton
describes an object class that can have only one instance in
any system. An example of a Singleton might be a print
spooler or system registry. This module implements a
Singleton class from which other classes can be derived. By
itself, the <tt>&quot;Class::Singleton&quot;</tt> module
does very little other than manage the instantiation of a
single object. In deriving a class from
<tt>&quot;Class::Singleton&quot;</tt>, your module will
inherit the Singleton instantiation method and can implement
whatever specific functionality is required.</p>

<p style="margin-left:11%; margin-top: 1em">For a
description and discussion of the Singleton class, see
&quot;Design Patterns&quot;, Gamma et al, Addison-Wesley,
1995, <small>ISBN
0&minus;201&minus;63361&minus;2.</small></p>

<h2>PREREQUISITES
<a name="PREREQUISITES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><tt>&quot;Class::Singleton&quot;</tt>
requires Perl version 5.004 or later. If you have an older
version of Perl, please upgrade to latest version, available
from your nearest <small>CPAN</small> site (see
<small>INSTALLATION</small> below).</p>

<h2>INSTALLATION
<a name="INSTALLATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;Class::Singleton&quot;</tt> module is available
from <small>CPAN.</small> As the &rsquo;perlmod&rsquo; man
page explains:</p>

<pre style="margin-left:11%; margin-top: 1em">    CPAN stands for the Comprehensive Perl Archive Network.
    This is a globally replicated collection of all known Perl
    materials, including hundreds of unbunded modules.
    [...]
    For an up&minus;to&minus;date listing of CPAN sites, see
    http://www.perl.com/perl/ or ftp://ftp.perl.com/perl/ .</pre>


<p style="margin-left:11%; margin-top: 1em">The module is
available in the following directories:</p>

<pre style="margin-left:11%; margin-top: 1em">    /modules/by&minus;module/Class/Class&minus;Singleton&minus;&lt;version&gt;.tar.gz
    /authors/id/ABW/Class&minus;Singleton&minus;&lt;version&gt;.tar.gz</pre>



<p style="margin-left:11%; margin-top: 1em">&quot;Class::Singleton&quot;
is distributed as a single gzipped tar archive file:</p>

<pre style="margin-left:11%; margin-top: 1em">    Class&minus;Singleton&minus;&lt;version&gt;.tar.gz</pre>


<p style="margin-left:11%; margin-top: 1em">Note that
&quot;&lt;version&gt;&quot; represents the current version
number, of the form &quot;<tt>1.23</tt>&quot;. See
<small>VERSION</small> below to determine the current
version number for
<tt>&quot;Class::Singleton&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">Unpack the
archive to create an installation directory:</p>

<pre style="margin-left:11%; margin-top: 1em">    gunzip Class&minus;Singleton&minus;&lt;version&gt;.tar.gz
    tar xvf Class&minus;Singleton&minus;&lt;version&gt;.tar</pre>



<p style="margin-left:11%; margin-top: 1em">&rsquo;cd&rsquo;
into that directory, make, test and install the module:</p>

<pre style="margin-left:11%; margin-top: 1em">    cd Class&minus;Singleton&minus;&lt;version&gt;
    perl Makefile.PL
    make
    make test
    make install</pre>


<p style="margin-left:11%; margin-top: 1em">The
&rsquo;<tt>&quot;make install&quot;</tt>&rsquo; will install
the module on your system. You may need root access to
perform this task. If you install the module in a local
directory (for example, by executing &quot;<tt>&quot;perl
Makefile.PL LIB=~/lib&quot;</tt>&quot; in the above &minus;
see <tt>&quot;perldoc MakeMaker&quot;</tt> for full
details), you will need to ensure that the
<tt>&quot;PERL5LIB&quot;</tt> environment variable is set to
include the location, or add a line to your scripts
explicitly naming the library location:</p>

<pre style="margin-left:11%; margin-top: 1em">    use lib '/local/path/to/lib';</pre>


<h2>USING THE CLASS::SINGLETON MODULE
<a name="USING THE CLASS::SINGLETON MODULE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">To import and
use the <tt>&quot;Class::Singleton&quot;</tt> module the
following line should appear in your Perl program:</p>

<pre style="margin-left:11%; margin-top: 1em">    use Class::Singleton;</pre>


<p style="margin-left:11%; margin-top: 1em">The
<i>instance()</i> method is used to create a new
<tt>&quot;Class::Singleton&quot;</tt> instance, or return a
reference to an existing instance. Using this method, it is
only possible to have a single instance of the class in any
system.</p>

<pre style="margin-left:11%; margin-top: 1em">    my $highlander = Class::Singleton&minus;&gt;instance();</pre>


<p style="margin-left:11%; margin-top: 1em">Assuming that
no <tt>&quot;Class::Singleton&quot;</tt> object currently
exists, this first call to <i>instance()</i> will create a
new <tt>&quot;Class::Singleton&quot;</tt> and return a
reference to it. Future invocations of <i>instance()</i>
will return the same reference.</p>

<pre style="margin-left:11%; margin-top: 1em">    my $macleod    = Class::Singleton&minus;&gt;instance();</pre>


<p style="margin-left:11%; margin-top: 1em">In the above
example, both <tt>$highlander</tt> and <tt>$macleod</tt>
contain the same reference to a
<tt>&quot;Class::Singleton&quot;</tt> instance. There can be
only one.</p>

<h2>DERIVING SINGLETON CLASSES
<a name="DERIVING SINGLETON CLASSES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">A module class
may be derived from <tt>&quot;Class::Singleton&quot;</tt>
and will inherit the <i>instance()</i> method that correctly
instantiates only one object.</p>

<pre style="margin-left:11%; margin-top: 1em">    package PrintSpooler;
    use base 'Class::Singleton';
    # derived class specific code
    sub submit_job {
        ...
    }
    sub cancel_job {
        ...
    }</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;PrintSpooler&quot;</tt> class defined above could
be used as follows:</p>

<pre style="margin-left:11%; margin-top: 1em">    use PrintSpooler;
    my $spooler = PrintSpooler&minus;&gt;instance();
    $spooler&minus;&gt;submit_job(...);</pre>


<p style="margin-left:11%; margin-top: 1em">The
<i>instance()</i> method calls the <i>_new_instance()</i>
constructor method the first and only time a new instance is
created. All parameters passed to the <i>instance()</i>
method are forwarded to <i>_new_instance()</i>. In the base
class the <i>_new_instance()</i> method returns a blessed
reference to a hash array containing any arguments passed as
either a hash reference or list of named parameters.</p>

<pre style="margin-left:11%; margin-top: 1em">    package MyConfig;
    use base 'Class::Singleton';
    sub foo {
        shift&minus;&gt;{ foo };
    }
    sub bar {
        shift&minus;&gt;{ bar };
    }
    package main;
    # either: hash reference of named parameters
    my $config = MyConfig&minus;&gt;instance({ foo =&gt; 10, bar =&gt; 20 });
    # or: list of named parameters
    my $config = MyConfig&minus;&gt;instance( foo =&gt; 10, bar =&gt; 20 );
    print $config&minus;&gt;foo();   # 10
    print $config&minus;&gt;bar();   # 20</pre>


<p style="margin-left:11%; margin-top: 1em">Derived classes
may redefine the <i>_new_instance()</i> method to provide
more specific object initialisation or change the underlying
object type (to a list reference, for example).</p>

<pre style="margin-left:11%; margin-top: 1em">    package MyApp::Database;
    use base 'Class::Singleton';
    use DBI;
    # this only gets called the first time instance() is called
    sub _new_instance {
        my $class = shift;
        my $self  = bless { }, $class;
        my $db    = shift || &quot;myappdb&quot;;
        my $host  = shift || &quot;localhost&quot;;
        $self&minus;&gt;{ DB } = DBI&minus;&gt;connect(&quot;DBI:mSQL:$db:$host&quot;)
            || die &quot;Cannot connect to database: $DBI::errstr&quot;;
        # any other initialisation...
        return $self;
    }</pre>


<p style="margin-left:11%; margin-top: 1em">The above
example might be used as follows:</p>

<pre style="margin-left:11%; margin-top: 1em">    use MyApp::Database;
    # first use &minus; database gets initialised
    my $database = MyApp::Database&minus;&gt;instance();</pre>


<p style="margin-left:11%; margin-top: 1em">Some time later
on in a module far, far away...</p>

<pre style="margin-left:11%; margin-top: 1em">    package MyApp::FooBar
    use MyApp::Database;
    # this FooBar object needs access to the database; the Singleton
    # approach gives a nice wrapper around global variables.
    sub new {
        my $class = shift;
        bless {
            database =&gt; MyApp::Database&minus;&gt;instance(),
        }, $class;
    }</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;Class::Singleton&quot;</tt> <i>instance()</i>
method uses a package variable to store a reference to any
existing instance of the object. This variable,
&quot;<tt>&quot;_instance&quot;</tt>&quot;, is coerced into
the derived class package rather than the base class
package.</p>

<p style="margin-left:11%; margin-top: 1em">Thus, in the
<tt>&quot;MyApp::Database&quot;</tt> example above, the
instance variable would be:</p>

<pre style="margin-left:11%; margin-top: 1em">    $MyApp::Database::_instance;</pre>


<p style="margin-left:11%; margin-top: 1em">This allows
different classes to be derived from
<tt>&quot;Class::Singleton&quot;</tt> that can co-exist in
the same system, while still allowing only one instance of
any one class to exists. For example, it would be possible
to derive both
&rsquo;<tt>&quot;PrintSpooler&quot;</tt>&rsquo; and
&rsquo;<tt>&quot;MyApp::Database&quot;</tt>&rsquo; from
<tt>&quot;Class::Singleton&quot;</tt> and have a single
instance of <i>each</i> in a system, rather than a single
instance of <i>either</i>.</p>

<p style="margin-left:11%; margin-top: 1em">You can use the
<i>has_instance()</i> method to find out if a particular
class already has an instance defined. A reference to the
instance is returned or <tt>&quot;undef&quot;</tt> if none
is currently defined.</p>

<pre style="margin-left:11%; margin-top: 1em">    my $instance = MyApp::Database&minus;&gt;has_instance()
        || warn &quot;No instance is defined yet&quot;;</pre>


<h2>METHODS
<a name="METHODS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><i>instance()</i>
<br>
This method is called to return a current object instance or
create a new one by calling <i>_new_instance()</i>.</p>


<p style="margin-left:11%; margin-top: 1em"><i>has_instance()</i>
<br>
This method returns a reference to any existing instance or
<tt>&quot;undef&quot;</tt> if none is defined.</p>

<pre style="margin-left:11%; margin-top: 1em">    my $testing = MySingleton1&minus;&gt;has_instance()
        || warn &quot;No instance defined for MySingleton1&quot;;</pre>



<p style="margin-left:11%; margin-top: 1em"><i>_new_instance()</i>
<br>
This &quot;private&quot; method is called by
<i>instance()</i> to create a new object instance if one
doesn&rsquo;t already exist. It is not intended to be called
directly (although there&rsquo;s nothing to stop you from
calling it if you&rsquo;re really determined to do so).</p>

<p style="margin-left:11%; margin-top: 1em">It creates a
blessed hash reference containing any arguments passed to
the method as either a hash reference or list of named
parameters.</p>

<pre style="margin-left:11%; margin-top: 1em">    # either: hash reference of named parameters
    my $example1 = MySingleton1&minus;&gt;new({ pi =&gt; 3.14, e =&gt; 2.718 });
    # or: list of named parameters
    my $example2 = MySingleton2&minus;&gt;new( pi =&gt; 3.14, e =&gt; 2.718 );</pre>


<p style="margin-left:11%; margin-top: 1em">It is important
to remember that the <i>instance()</i> method will
<i>only</i> call the <i>_new_instance()</i> method once, so
any arguments you pass may be silently ignored if an
instance already exists. You can use the
<i>has_instance()</i> method to determine if an instance is
already defined.</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Andy Wardley
&lt;abw@wardley.org&gt; &lt;http://wardley.org/&gt;</p>

<p style="margin-left:11%; margin-top: 1em">Thanks to
Andreas Koenig for providing some significant speedup
patches and other ideas.</p>

<h2>VERSION
<a name="VERSION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This is version
1.4, released September 2007</p>

<h2>COPYRIGHT
<a name="COPYRIGHT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Copyright Andy
Wardley 1998&minus;2007. All Rights Reserved.</p>

<p style="margin-left:11%; margin-top: 1em">This module is
free software; you can redistribute it and/or modify it
under the same terms as Perl itself.</p>
<hr>
</body>
</html>
