<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 22:08:28 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>pki</title>

</head>
<body>

<h1 align="center">pki</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#CLI OPTIONS">CLI OPTIONS</a><br>
<a href="#OPERATIONS">OPERATIONS</a><br>
<a href="#FILES">FILES</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#AUTHORS">AUTHORS</a><br>
<a href="#COPYRIGHT">COPYRIGHT</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">pki &minus;
Command-Line Interface for accessing Certificate System
services.</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>pki</b> [CLI
options] &lt;command&gt; [command arguments]</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The <b>pki</b>
command provides a command-line interface allowing clients
to access various services on the Certificate System server.
These services include certificates, groups, keys, security
domains, and users.</p>

<h2>CLI OPTIONS
<a name="CLI OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>-c
&lt;client security database password&gt;</b></p>

<p style="margin-left:22%;">Specifies the client security
database password (mutually exclusive to the
&rsquo;-C&rsquo; option).</p>

<p style="margin-left:11%;"><b>-C &lt;client-side password
file&gt;</b></p>

<p style="margin-left:22%;">Specifies the file which
contains the client security database password (mutually
exclusive to the &rsquo;-c&rsquo; option).</p>

<p style="margin-left:11%;"><b>-d &lt;client security
database location&gt;</b></p>

<p style="margin-left:22%;">Specifies the client security
database location (default: <i>~/.dogtag/nssdb</i>).</p>

<p style="margin-left:11%;"><b>-h &lt;hostname&gt;</b></p>

<p style="margin-left:22%;">Specifies the hostname
(default: hostname of the local machine).</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>--help</b></p></td>
<td width="2%"></td>
<td width="53%">


<p>Prints additional help information.</p></td>
<td width="25%">
</td></tr>
</table>

<p style="margin-left:11%;"><b>--ignore-cert-status
&lt;list&gt;</b></p>

<p style="margin-left:22%;">Comma-separated list of ignored
certificate validity statuses.</p>

<p style="margin-left:11%;"><b>--message-format
&lt;format&gt;</b></p>

<p style="margin-left:22%;">Message format: xml (default),
json.</p>

<p style="margin-left:11%;"><b>-n &lt;client certificate
nickname&gt;</b></p>

<p style="margin-left:22%;">Specifies the nickname for
client certificate authentication (mutually exclusive to the
&rsquo;-u&rsquo; option). This authentication requires a
security database password.</p>

<p style="margin-left:11%;"><b>--output
&lt;folder&gt;</b></p>

<p style="margin-left:22%;">Folder to store HTTP
messages.</p>

<p style="margin-left:11%;"><b>-P &lt;protocol&gt;</b></p>

<p style="margin-left:22%;">Specifies the protocol
(default: http).</p>

<p style="margin-left:11%;"><b>-p &lt;port&gt;</b></p>

<p style="margin-left:22%;">Specifies the port (default:
8080).</p>

<p style="margin-left:11%;"><b>--reject-cert-status
&lt;list&gt;</b></p>

<p style="margin-left:22%;">Comma-separated list of
rejected certificate validity statuses. PKI subsystem type -
[CA, KRA, OCSP, TKS, or TPS] (non-case-sensitive).</p>

<p style="margin-left:11%;"><b>-U &lt;URI&gt;</b></p>

<p style="margin-left:22%;">Specifies the server URI.</p>

<p style="margin-left:11%;"><b>-u &lt;username&gt;</b></p>

<p style="margin-left:22%;">Specifies the username for
basic authentication (mutually exclusive to the
&rsquo;-n&rsquo; option). This authentication requires a
user password.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-v</b></p></td>
<td width="8%"></td>
<td width="44%">


<p>Displays verbose information.</p></td>
<td width="34%">
</td></tr>
</table>

<p style="margin-left:11%;"><b>--version</b></p>

<p style="margin-left:22%;">Displays CLI version
information.</p>

<p style="margin-left:11%;"><b>-w &lt;password&gt;</b></p>

<p style="margin-left:22%;">Specifies the user password
(mutually exclusive to the &rsquo;-W&rsquo; option).</p>

<p style="margin-left:11%;"><b>-W &lt;client-side password
file&gt;</b></p>

<p style="margin-left:22%;">Specifies the file which
contains the user password (mutually exclusive to the
&rsquo;-w&rsquo; option).</p>

<h2>OPERATIONS
<a name="OPERATIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">To view
available commands and options, simply type <b>pki</b>. Some
commands have sub-commands. To view the sub-commands, type
<b>pki &lt;command&gt;</b>. To view each command&rsquo;s
usage, type <b>pki &lt;command&gt;
&minus;&minus;help</b>.</p>

<p style="margin-left:11%; margin-top: 1em">A client
security database is needed to execute commands that require
SSL connection or client certificate for authentication. See
<b>pki-client</b>(1) for more information.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Connection</b>
<br>
By default, the CLI connects to a server running on the
local machine via the non-secure HTTP port 8080. To specify
a different server location, use the appropriate arguments
to give a different host (<b>-h</b>), port (<b>-p</b>), or
connection protocol (<b>-P</b>).</p>

<p style="margin-left:11%; margin-top: 1em"><b>pki -P
&lt;protocol&gt; -h &lt;hostname&gt; -p &lt;port&gt;
&lt;command&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Alternatively,
the connection parameters can be specified as a URI:</p>

<p style="margin-left:11%; margin-top: 1em"><b>pki -U
&lt;URI&gt; &lt;command&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">where the URI
is of the format
<i>&lt;protocol&gt;://&lt;hostname&gt;:&lt;port&gt;</i>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Authentication</b>
<br>
Some commands require authentication. These are commands
that are restricted to particular sets of users (such as
agents or admins) or those operations involving certificate
profiles that require authentication.</p>

<p style="margin-left:11%; margin-top: 1em">To execute a
command without authentication:</p>

<p style="margin-left:11%; margin-top: 1em"><b>pki
&lt;command&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">To execute a
command using basic authentication (i. e. -
username/password), see the <b>Basic Authentication</b>
section of this man page.</p>

<p style="margin-left:11%; margin-top: 1em">To execute a
command using client authentication (i. e. - client
certificate), see the <b>Client Authentication</b> section
of this man page.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Basic
Authentication</b> <br>
To authenticate with a username and password:</p>

<p style="margin-left:11%; margin-top: 1em"><b>pki -u
&lt;username&gt; -w &lt;password&gt; &lt;command&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Rather than
being exposed in plaintext on the command-line, user
passwords may be stored in a file instead. See
<b>Client-side Password Files</b> for detailed
information.</p>

<p style="margin-left:11%; margin-top: 1em">To authenticate
with a username by obtaining the user password from a
client-side password file:</p>

<p style="margin-left:11%; margin-top: 1em"><b>pki -u
&lt;username&gt; -W &lt;client-side password file&gt;
&lt;command&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Finally, if a
username has been specified on the command-line, and neither
the &rsquo;-W &lt;client-side password file&gt;&rsquo; nor
the &rsquo;-w &lt;password&gt;&rsquo; options have been
utilized, the password will be prompted for.</p>

<p style="margin-left:11%; margin-top: 1em">To authenticate
with a username by interactively prompting for a
password:</p>

<p style="margin-left:11%; margin-top: 1em"><b>pki -u
&lt;username&gt; &lt;command&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>Note:</b>
Prompting for a user password is not suitable for automated
batch processing.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Client
Authentication Setup</b> <br>
A client certificate associated with the desired PKI server
must be used for client authentication. This can be done by
importing the client certificate into an NSS security
database and passing the values to the relevant options
provided by the <b>pki</b> CLI framework.</p>

<p style="margin-left:11%; margin-top: 1em">To achieve
this, execute the following commands to set up an NSS
security database for use by the <b>pki</b> client, import
the client certificate into the NSS database, and list
information (including the nickname of the client
certificate) stored in the NSS database:</p>

<p style="margin-left:11%; margin-top: 1em"><b>- certutil
-N -d &lt;CERT_DB_DIR_PATH&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>- pk12util
-i &lt;Agent_Cert_P12_FILE_PATH&gt; -d
&lt;CERT_DB_DIR_PATH&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>- certutil
-L -d &lt;CERT_DB_DIR_PATH&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">The first
command creates a client security database, and asks the
client user to enter a password for this NSS database.</p>

<p style="margin-left:11%; margin-top: 1em">The second
command imports a client certificate stored in a PKCS12
format into this NSS database; it prompts for the passwords
of the PKCS12 file and the client security database. The
simplist example of such a client certificate is to obtain
the administrator certificate created during the
configuration portion of the basic PKI installation of the
associated PKI server (e. g. - located at
<i>/root/.dogtag/pki-tomcat/ca_admin_cert.p12</i> on the PKI
server machine).</p>

<p style="margin-left:11%; margin-top: 1em">The third
command shows the information about the imported client
certificate (including its nickname).</p>

<p style="margin-left:11%; margin-top: 1em"><b>Note:</b>
When issuing the first <b>pki</b> command using the
authentication parameters (after completion of the setup of
the client security database), a user may be greeted with a
warning message which indicates that an untrusted issuer was
encountered. Simply reply &rsquo;Y&rsquo; to import the CA
certificate, and, presuming that the displayed CA server URL
is valid, press the carriage return.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Client
Authentication</b> <br>
To authenticate with a client certificate:</p>

<p style="margin-left:11%; margin-top: 1em"><b>pki -d
&lt;client security database location&gt; -c &lt;client
security database password&gt; -n &lt;client certificate
nickname&gt; &lt;command&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Alternatively,
to prevent exposure via the command-line, a client security
database may store their password in a file instead. See
<b>Client-side Password Files</b> for detailed
information.</p>

<p style="margin-left:11%; margin-top: 1em">To authenticate
with a client certificate by obtaining the client security
database password from a client-side password file:</p>

<p style="margin-left:11%; margin-top: 1em"><b>pki -d
&lt;client security database location&gt; -C &lt;client-side
password file&gt; -n &lt;client certificate nickname&gt;
&lt;command&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Finally, if a
client certificate has been specified on the command-line,
and neither the &rsquo;-C &lt;client-side password
file&gt;&rsquo; nor the &rsquo;-c &lt;client security
database password&gt;&rsquo; options have been utilized, the
client security database password will be prompted for.</p>

<p style="margin-left:11%; margin-top: 1em">To authenticate
with a client certificate by interactively prompting for a
client security database password:</p>

<p style="margin-left:11%; margin-top: 1em"><b>pki -d
&lt;client security database location&gt; -n &lt;client
certificate nickname&gt; &lt;command&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>Note:</b>
Prompting for a client security database password is not
suitable for automated batch processing.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Client-side
Password Files</b> <br>
Both the &rsquo;-C&rsquo; (client authentication) and the
&rsquo;-W&rsquo; (basic authentication) options require the
use of a client-side password file.</p>

<p style="margin-left:11%; margin-top: 1em">For security
purposes, client-side password files should be, at a
minimum, operating system protected non-world readable
files.</p>

<p style="margin-left:11%; margin-top: 1em">Client-side
password files generally store a password in an
equals-sign-delimited plaintext format
&rsquo;token=password&rsquo; (e. g. -
&rsquo;internal=foobar&rsquo; where &rsquo;internal&rsquo;
is the token, &rsquo;=&rsquo; is the delimiter, and
&rsquo;foobar&rsquo; is the actual password). The token
keyword &rsquo;internal&rsquo; is the default specification
for a token, and refers to the &quot;Internal Key Storage
Token&quot;. If a client-side password file is being used
for the sole purposes of the <b>pki</b> command-line tool, a
client-side password file also supports the format that
merely consists of the plaintext password on a single line
(read the <b>Caveats</b> which follow).</p>


<p style="margin-left:11%; margin-top: 1em"><b>Caveats:</b></p>

<p style="margin-left:22%; margin-top: 1em">&bull; Since
client-side password files are allowed to use the
&rsquo;token=password&rsquo; format, the first
&rsquo;=&rsquo; character can only be used as a delimiter
(i. e. - it cannot be used as a valid character within the
&rsquo;token&rsquo; name) as escaping the &rsquo;=&rsquo;
character within a token is not supported.</p>

<p style="margin-left:22%; margin-top: 1em">&bull; When
specifying a password which contains an &rsquo;=&rsquo;
character, always specify an initial &rsquo;=&rsquo; prior
to specifying the actual password (mandatory when no token
has been specified) as escaping the &rsquo;=&rsquo;
character within a password is not supported.</p>

<p style="margin-left:22%; margin-top: 1em">&bull; Tokens
do not support leading or trailing whitespace since these
characters are stripped prior to their use; however, all
whitespace inside tokens will be preserved.</p>

<p style="margin-left:22%; margin-top: 1em">&bull;
Passwords preserve all leading, trailing, and internal
whitespace since passwords are not trimmed prior to their
use.</p>

<p style="margin-left:22%; margin-top: 1em">&bull; TBD:
Supply code to handle the case of a non-internal token (e.
g. - &rsquo;hardware-nethsm&rsquo; utilized in the following
examples) since the current code ignores the specified token
(i. e. - it always utilizes the default
&rsquo;internal&rsquo; token no matter what is currently
specified).</p>

<p style="margin-left:22%; margin-top: 1em">&bull; TBD:
Allow numerous &rsquo;token=password&rsquo; lines in a
single client-side password file to support the ability to
authenticate against specified tokens as well as multiple
tokens.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Valid
examples include:</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>internal=foobar</b>
<br>
where: token=&quot;internal&quot;,
password=&quot;foobar&quot;</p>


<p style="margin-left:11%; margin-top: 1em"><b>hardware-nethsm=foobar</b>
<br>
where: token=&quot;hardware-nethsm&quot; (ignored - TBD),
password=&quot;foobar&quot;</p>


<p style="margin-left:11%; margin-top: 1em"><b>internal=ack=bar</b>
<br>
where: token=&quot;internal&quot;,
password=&quot;ack=bar&quot;</p>


<p style="margin-left:11%; margin-top: 1em"><b>hardware-nethsm=ack=bar</b>
<br>
where: token=&quot;hardware-nethsm&quot; (ignored - TBD),
password=&quot;ack=bar&quot;</p>

<p style="margin-left:11%; margin-top: 1em"><b>=foobar</b>
<br>
where: token=&quot;internal&quot; (default),
password=&quot;foobar&quot;</p>


<p style="margin-left:11%; margin-top: 1em"><b>=foo=bar</b>
<br>
where: token=&quot;internal&quot; (default),
password=&quot;foo=bar&quot; <br>
(Since the password contains an &rsquo;=&rsquo; character,
<br>
an initial &rsquo;=&rsquo; character must be specified!)</p>

<p style="margin-left:11%; margin-top: 1em"><b>foobar</b>
<br>
where: token=&quot;internal&quot; (default),
password=&quot;foobar&quot;</p>

<p style="margin-left:11%; margin-top: 1em"><b>Results
Paging</b> <br>
Some commands (e.g. cert-find) may return multiple results.
Since the number of results may be large, the results are
split into multiple pages. By default the command will
return only the first page (e.g. the first 20 results). To
retrieve results from another page, additional paging
parameters can be specified:</p>

<p style="margin-left:11%; margin-top: 1em">* start: index
of the first result to return (default: 0) <br>
* size: number of results to return (default: 20)</p>

<p style="margin-left:11%; margin-top: 1em">For example, to
retrieve the first page (index #0-#19):</p>

<p style="margin-left:11%; margin-top: 1em"><b>pki
cert-find --start 0 --size 20</b></p>

<p style="margin-left:11%; margin-top: 1em">To retrieve the
second page (index #20-#39):</p>

<p style="margin-left:11%; margin-top: 1em"><b>pki
cert-find --start 20 --size 20</b></p>

<p style="margin-left:11%; margin-top: 1em">To retrieve the
third page (index #40-#59):</p>

<p style="margin-left:11%; margin-top: 1em"><b>pki
cert-find --start 40 --size 20</b></p>

<h2>FILES
<a name="FILES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b><i>/usr/bin/pki</i></b></p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b><i>pki-cert</i></b>(1)</p>

<p style="margin-left:17%;">Certificate management
commands</p>


<p style="margin-left:11%; margin-top: 1em"><b>pki-client</b>(1)</p>

<p style="margin-left:17%;">Client security database
management commands</p>


<p style="margin-left:11%; margin-top: 1em"><b>pki-group</b>(1)</p>

<p style="margin-left:17%;">Group management commands</p>


<p style="margin-left:11%; margin-top: 1em"><b>pki-group-member</b>(1)</p>

<p style="margin-left:17%;">Group member management
commands</p>


<p style="margin-left:11%; margin-top: 1em"><b>pki-key</b>(1)</p>

<p style="margin-left:17%;">Key management commands</p>


<p style="margin-left:11%; margin-top: 1em"><b>pki-securitydomain</b>(1)</p>

<p style="margin-left:17%;">Security domain management
commands</p>


<p style="margin-left:11%; margin-top: 1em"><b>pki-user</b>(1)</p>

<p style="margin-left:17%;">User management commands</p>


<p style="margin-left:11%; margin-top: 1em"><b>pki-user-cert</b>(1)</p>

<p style="margin-left:17%;">User certificate management
commands</p>


<p style="margin-left:11%; margin-top: 1em"><b>pki-user-membership</b>(1)</p>

<p style="margin-left:17%;">User membership management
commands</p>


<p style="margin-left:11%; margin-top: 1em"><b>pki-ca-profile</b>(1)</p>

<p style="margin-left:17%;">Profile management commands</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Ade Lee
&lt;alee@redhat.com&gt;, Endi Dewata
&lt;edewata@redhat.com&gt;, and Matthew Harmsen
&lt;mharmsen@redhat.com&gt;.</p>

<h2>COPYRIGHT
<a name="COPYRIGHT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Copyright (c)
2012 Red Hat, Inc. This is licensed under the GNU General
Public License, version 2 (GPLv2). A copy of this license is
available at
http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.</p>
<hr>
</body>
</html>
