<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Sat Nov 12 02:25:57 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>STAPRUN</title>

</head>
<body>

<h1 align="center">STAPRUN</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#ARGUMENTS">ARGUMENTS</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#MODULE DETACHING AND ATTACHING">MODULE DETACHING AND ATTACHING</a><br>
<a href="#FILE SWITCHING BY SIGNAL">FILE SWITCHING BY SIGNAL</a><br>
<a href="#SAFETY AND SECURITY">SAFETY AND SECURITY</a><br>
<a href="#FILES">FILES</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#BUGS">BUGS</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">staprun &minus;
systemtap runtime</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>staprun</b>
[ <i>OPTIONS</i> ] <i>MODULE</i> [ <i>MODULE-OPTIONS</i>
]</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<i>staprun</i> program is the back-end of the Systemtap
tool. It expects a kernel module produced by the front-end
<i>stap</i> tool.</p>

<p style="margin-left:11%; margin-top: 1em">Splitting the
systemtap tool into a front-end and a back-end allows a user
to compile a systemtap script on a development machine that
has the kernel development tools (needed to compile the
script) and then transfer the resulting kernel module to a
production machine that doesn&rsquo;t have any development
tools installed.</p>

<p style="margin-left:11%; margin-top: 1em">Please refer to
stappaths (7) for the version number, or run rpm &minus;q
systemtap (fedora/red hat) apt&minus;get &minus;v systemtap
(ubuntu)</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<i>staprun</i> program supports the following options. Any
other option prints a list of supported options.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;v</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Verbose mode.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;V</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Print version number and exit.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;w</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Suppress warnings from the script.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;u</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Load the uprobes.ko module.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;c CMD</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Command CMD will be run and the <i>staprun</i> program
will exit when CMD does. The &rsquo;_stp_target&rsquo;
variable will contain the pid for CMD.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;x PID</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>The &rsquo;_stp_target&rsquo; variable will be set to
PID.</p> </td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;o FILE</b></p>

<p style="margin-left:22%;">Send output to FILE. If the
module uses bulk mode, the output will be in percpu files
FILE_x(FILE_cpux in background and bulk mode) where
&rsquo;x&rsquo; is the cpu number. This supports strftime(3)
formats for FILE.</p>

<p style="margin-left:11%;"><b>&minus;b BUFFER_SIZE</b></p>

<p style="margin-left:22%;">The systemtap module will
specify a buffer size. Setting one here will override that
value. The value should be an integer between 1 and 4095
which be assumed to be the buffer size in MB. That value
will be per-cpu if bulk mode is used.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;L</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Load module and start probes, then detach from the
module leaving the probes running. The module can be
attached to later by using the <b>&minus;A</b> option.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;A</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Attach to loaded systemtap module.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;C WHEN</b></p>

<p style="margin-left:22%;">Control coloring of error
messages. WHEN must be either &quot;never&quot;,
&quot;always&quot;, or &quot;auto&quot; (i.e. enable only if
at a terminal). If the option is missing, then
&quot;auto&quot; is assumed. Colors can be modified using
the SYSTEMTAP_COLORS environment variable. See the
<i>stap</i>(1) manual page for more information on syntax
and behaviour.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;d</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Delete a module. Only detached or unused modules the
user has permission to access will be deleted. Use
&quot;*&quot; (quoted) to delete all unused modules.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;D</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Run staprun in background as a daemon and show
it&rsquo;s pid.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;R</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Rename the module to a unique name before inserting
it.</p> </td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;r N:URI</b></p>

<p style="margin-left:22%;">Pass the given number and URI
data to the tapset functions remote_id() and
remote_uri().</p>

<p style="margin-left:11%;"><b>&minus;S</b>
<i>size[,N]</i></p>

<p style="margin-left:22%;">Sets the maximum size of output
file and the maximum number of output files. If the size of
output file will exceed <b>size</b> , systemtap switches
output file to the next file. And if the number of output
files exceed <b>N</b> , systemtap removes the oldest output
file. You can omit the second argument.</p>

<p style="margin-left:11%;"><b>&minus;T timeout</b></p>

<p style="margin-left:22%;">Sets maximum time reader thread
will wait before dumping trace buffer. Value is in ms,
default is 200ms. Setting this to a high value decreases
number of stapio wake-ups, allowing deeper sleep for
embedded platforms. But it impacts interactivity on terminal
as traces are dumped less often in case of low throughput.
There is no interactivity or performance impact for high
throughput as trace is dumped when buffer is full, before
this timeout expires.</p>

<p style="margin-left:11%;"><b>var1=val</b></p>

<p style="margin-left:22%;">Sets the value of global
variable var1 to val. Global variables contained within a
module are treated as module options and can be set from the
staprun command line.</p>

<h2>ARGUMENTS
<a name="ARGUMENTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>MODULE</b>
is either a module path or a module name. If it is a module
name, the module will be looked for in the following
directory (where &rsquo;VERSION&rsquo; is the output of
&quot;uname &minus;r&quot;):</p>


<p style="margin-left:22%; margin-top: 1em">/lib/modules/VERSION/systemtap</p>

<p style="margin-left:11%; margin-top: 1em">Any additional
arguments on the command line are passed to the module. One
use of these additional module arguments is to set the value
of global variables declared within the module.</p>

<p style="margin-left:11%; margin-top: 1em">$ stap
&minus;p4 &minus;m mod1 &minus;e&nbsp;'global
var1=&quot;foo&quot;; probe begin{printf(&quot;%s\n&quot;,
var1); exit()}'</p>

<p style="margin-left:11%; margin-top: 1em">Running this
with an additional module argument:</p>

<p style="margin-left:11%; margin-top: 1em">$ staprun
mod1.ko var1=&quot;HelloWorld&quot; <br>
HelloWorld</p>

<p style="margin-left:11%; margin-top: 1em">Spaces and
exclamation marks currently cannot be passed into global
variables this way.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">See the
<i>stapex</i>(3stap) manual page for a collection of sample
scripts.</p>

<p style="margin-left:11%; margin-top: 1em">Here is a very
basic example of how to use <i>staprun.</i> First, use
<i>stap</i> to compile a script. The <i>stap</i> program
will report the pathname to the resulting module.</p>

<p style="margin-left:11%; margin-top: 1em">$ stap
&minus;p4 &minus;e 'probe begin { printf(&quot;Hello
World!\n&quot;); exit() }' <br>
/home/user/.systemtap/cache/85/stap_8553d83f78c_265.ko</p>

<p style="margin-left:11%; margin-top: 1em">Run
<i>staprun</i> with the pathname to the module as an
argument.</p>

<p style="margin-left:11%; margin-top: 1em">$ staprun
/home/user/.systemtap/cache/85/stap_8553d83f78c_265.ko <br>
Hello World!</p>

<h2>MODULE DETACHING AND ATTACHING
<a name="MODULE DETACHING AND ATTACHING"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">After the
<i>staprun</i> program installs a Systemtap kernel module,
users can detach from the kernel module and reattach to it
later. The <b>&minus;L</b> option loads the module and
automatically detaches. Users can also detach from the
kernel module interactively by sending the SIGQUIT signal
from the keyboard (typically by typing Ctrl&minus;\).</p>

<p style="margin-left:11%; margin-top: 1em">To reattach to
a kernel module, the <i>staprun</i> <b>&minus;A</b> option
would be used.</p>

<h2>FILE SWITCHING BY SIGNAL
<a name="FILE SWITCHING BY SIGNAL"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">After
<i>staprun</i> launched the <i>stapio</i> program, users can
command it to switch output file to next file when it
outputs to file(s) (running staprun with <b>&minus;o</b>
option) by sending a <b>SIGUSR2</b> signal to the
<i>stapio</i> process. When it receives SIGUSR2, it will
switch output file to new file with suffix <i>.N</i> where N
is the sequential number. For example,</p>

<p style="margin-left:11%; margin-top: 1em">$ staprun
&minus;o foo ...</p>

<p style="margin-left:11%; margin-top: 1em">outputs trace
logs to <i>foo</i> and if it receives <b>SIGUSR2</b> signal,
it switches output to <i>foo.1</i> file. And receiving
<b>SIGUSR2</b> again, it switches to <i>foo.2</i> file.</p>

<h2>SAFETY AND SECURITY
<a name="SAFETY AND SECURITY"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Systemtap, in
the default kernel-module runtime mode, is an administrative
tool. It exposes kernel internal data structures and
potentially private user information. See the <i>stap</i>(1)
manual page for additional information on safety and
security.</p>

<p style="margin-left:11%; margin-top: 1em">To increase
system security, users of systemtap must be root, or in the
<i>staprun</i> group in order to execute this setuid
<i>staprun</i> program. A user may select a particular
privilege level with the stap
<i>&minus;&minus;privilege=</i> option, which <i>staprun</i>
will later enforce. <br>
stapdev</p>

<p style="margin-left:22%;">Members of the <i>stapdev</i>
group can write and load script modules with root-equivalent
privileges, without particular security constraints. (Many
safety constraints remain.)</p>

<p style="margin-left:11%;">stapsys</p>

<p style="margin-left:22%;">Members of the <i>stapsys</i>
group have almost all the privileges of <i>stapdev</i>,
except for guru mode constructs.</p>

<p style="margin-left:11%;">staprun</p>

<p style="margin-left:22%;">Members only of the
<i>stapusr</i> group may any-privileged modules placed into
the /lib/modules/VERSION/systemtap by the system
administrator.</p>

<p style="margin-left:11%;">staprun</p>

<p style="margin-left:22%;">Members only of the
<i>stapusr</i> group may also write and load low-privilege
script modules, which are normally limited to manipulating
their own processes (and not the kernel nor other
users&rsquo; processes).</p>

<p style="margin-left:11%; margin-top: 1em">Part of the
privilege enforcement mechanism may require using a
stap-server and administrative trust in its cryptographic
signer; see the <i>stap&minus;server</i>(8) manual page for
a for more information.</p>

<h2>FILES
<a name="FILES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">/lib/modules/VERSION/systemtap</p>

<p style="margin-left:22%;">If MODULE is a module name, the
module will be looked for in this directory. Users who are
only in the <i>&rsquo;stapusr&rsquo;</i> group can install
modules located in this directory. This directory must be
owned by the root user and not be world writable.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><i>stap</i>(1),
<i>stapprobes</i>(3stap), <i>stap&minus;server</i>(8),
<i>stapdyn</i>(8), <i>stapex</i>(3stap)</p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Use the
Bugzilla link of the project web page or our mailing list.
<b>http://sourceware.org/systemtap/</b>,
<b>&lt;systemtap@sourceware.org&gt;</b>.</p>
<hr>
</body>
</html>
