<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Sat Nov 12 02:11:49 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>PERFQUERY</title>

</head>
<body>

<h1 align="center">PERFQUERY</h1>

<a href="#NAME">NAME</a><br>
<a href="#query InfiniBand port counters on a single port">query InfiniBand port counters on a single port</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">PERFQUERY
&minus;</p>

<h2>query InfiniBand port counters on a single port
<a name="query InfiniBand port counters on a single port"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>SYNOPSIS</b>
<br>
perfquery [options] [&lt;lid|guid&gt; [[port(s)]
[reset_mask]]]</p>


<p style="margin-left:11%; margin-top: 1em"><b>DESCRIPTION</b>
<br>
perfquery uses PerfMgt GMPs to obtain the PortCounters
(basic performance and error counters),
PortExtendedCounters, PortXmitDataSL, PortRcvDataSL,
PortRcvErrorDetails, PortXmitDiscardDetails,
PortExtendedSpeedsCounters, or PortSamplesControl from the
PMA at the node/port specified. Optionally shows aggregated
counters for all ports of node. Finally it can, reset after
read, or just reset the counters.</p>

<p style="margin-left:11%; margin-top: 1em">Note: In
PortCounters, PortCountersExtended, PortXmitDataSL, and
PortRcvDataSL, components that represent Data (e.g.
PortXmitData and PortRcvData) indicate octets divided by 4
rather than just octets.</p>

<p style="margin-left:11%; margin-top: 1em">Note: Inputting
a port of 255 indicates an operation be performed on all
ports.</p>

<p style="margin-left:11%; margin-top: 1em">Note: For
PortCounters, ExtendedCounters, and resets, multiple ports
can be specified by either a comma separated list or a port
range. See examples below.</p>

<p style="margin-left:11%; margin-top: 1em"><b>OPTIONS <br>
&minus;x, &minus;&minus;extended</b></p>

<p style="margin-left:22%; margin-top: 1em">show extended
port counters rather than (basic) port counters. Note that
extended port counters attribute is optional.</p>

<p style="margin-left:11%;"><b>&minus;X,
&minus;&minus;xmtsl</b></p>

<p style="margin-left:22%; margin-top: 1em">show transmit
data SL counter. This is an optional counter for QoS.</p>

<p style="margin-left:11%;"><b>&minus;S,
&minus;&minus;rcvsl</b></p>

<p style="margin-left:22%; margin-top: 1em">show receive
data SL counter. This is an optional counter for QoS.</p>

<p style="margin-left:11%;"><b>&minus;D,
&minus;&minus;xmtdisc</b></p>

<p style="margin-left:22%; margin-top: 1em">show transmit
discard details. This is an optional counter.</p>

<p style="margin-left:11%;"><b>&minus;E,
&minus;&minus;rcverr</b></p>

<p style="margin-left:22%; margin-top: 1em">show receive
error details. This is an optional counter.</p>

<p style="margin-left:11%;"><b>&minus;D,
&minus;&minus;xmtdisc</b></p>

<p style="margin-left:22%; margin-top: 1em">show transmit
discard details. This is an optional counter.</p>

<p style="margin-left:11%;"><b>&minus;T,
&minus;&minus;extended_speeds</b></p>

<p style="margin-left:22%; margin-top: 1em">show extended
speeds port counters. This is an optional counter.</p>


<p style="margin-left:11%;"><b>&minus;&minus;oprcvcounters</b></p>

<p style="margin-left:22%; margin-top: 1em">show Rcv
Counters per Op code. This is an optional counter.</p>


<p style="margin-left:11%;"><b>&minus;&minus;flowctlcounters</b></p>

<p style="margin-left:22%; margin-top: 1em">show flow
control counters. This is an optional counter.</p>


<p style="margin-left:11%;"><b>&minus;&minus;vloppackets</b></p>

<p style="margin-left:22%; margin-top: 1em">show packets
received per Op code per VL. This is an optional
counter.</p>


<p style="margin-left:11%;"><b>&minus;&minus;vlopdata</b></p>

<p style="margin-left:22%; margin-top: 1em">show data
received per Op code per VL. This is an optional
counter.</p>


<p style="margin-left:11%;"><b>&minus;&minus;vlxmitflowctlerrors</b></p>

<p style="margin-left:22%; margin-top: 1em">show flow
control update errors per VL. This is an optional
counter.</p>


<p style="margin-left:11%;"><b>&minus;&minus;vlxmitcounters</b></p>

<p style="margin-left:22%; margin-top: 1em">show ticks
waiting to transmit counters per VL. This is an optional
counter.</p>


<p style="margin-left:11%;"><b>&minus;&minus;swportvlcong</b></p>

<p style="margin-left:22%; margin-top: 1em">show sw port VL
congestion. This is an optional counter.</p>

<p style="margin-left:11%;"><b>&minus;&minus;rcvcc</b></p>

<p style="margin-left:22%; margin-top: 1em">show Rcv
congestion control counters. This is an optional
counter.</p>


<p style="margin-left:11%;"><b>&minus;&minus;slrcvfecn</b></p>

<p style="margin-left:22%; margin-top: 1em">show SL Rcv
FECN counters. This is an optional counter.</p>


<p style="margin-left:11%;"><b>&minus;&minus;slrcvbecn</b></p>

<p style="margin-left:22%; margin-top: 1em">show SL Rcv
BECN counters. This is an optional counter.</p>


<p style="margin-left:11%;"><b>&minus;&minus;xmitcc</b></p>

<p style="margin-left:22%; margin-top: 1em">show Xmit
congestion control counters. This is an optional
counter.</p>


<p style="margin-left:11%;"><b>&minus;&minus;vlxmittimecc</b></p>

<p style="margin-left:22%; margin-top: 1em">show VL Xmit
Time congestion control counters. This is an optional
counter.</p>

<p style="margin-left:11%;"><b>&minus;c,
&minus;&minus;smplctl</b></p>

<p style="margin-left:22%; margin-top: 1em">show port
samples control.</p>

<p style="margin-left:11%;"><b>&minus;a,
&minus;&minus;all_ports</b></p>

<p style="margin-left:22%; margin-top: 1em">show aggregated
counters for all ports of the destination lid, reset all
counters for all ports, or if multiple ports are specified,
aggregate the counters of the specified ports. If the
destination lid does not support the AllPortSelect flag, all
ports will be iterated through to emulate AllPortSelect
behavior.</p>

<p style="margin-left:11%;"><b>&minus;l,
&minus;&minus;loop_ports</b></p>

<p style="margin-left:22%; margin-top: 1em">If all ports
are selected by the user (either through the <b>&minus;a</b>
option or port 255) or multiple ports are specified iterate
through each port rather than doing than aggregate
operation.</p>

<p style="margin-left:11%;"><b>&minus;r,
&minus;&minus;reset_after_read</b></p>

<p style="margin-left:22%; margin-top: 1em">reset counters
after read</p>

<p style="margin-left:11%;"><b>&minus;R,
&minus;&minus;Reset_only</b></p>

<p style="margin-left:22%; margin-top: 1em">only reset
counters</p>

<p style="margin-left:11%; margin-top: 1em"><b>Addressing
Flags <br>
&minus;G, &minus;&minus;Guid</b> The address specified is a
Port GUID</p>

<p style="margin-left:11%; margin-top: 1em"><b>&minus;L,
&minus;&minus;Lid</b> The address specified is a LID</p>

<p style="margin-left:11%; margin-top: 1em"><b>&minus;s,
&minus;&minus;sm_port &lt;smlid&gt;</b> use 'smlid' as the
target lid for SA queries.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Port
Selection flags <br>
&minus;C, &minus;&minus;Ca &lt;ca_name&gt;</b> use the
specified ca_name.</p>

<p style="margin-left:11%; margin-top: 1em"><b>&minus;P,
&minus;&minus;Port &lt;ca_port&gt;</b> use the specified
ca_port.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Local port
Selection</b> <br>
Multiple port/Multiple CA support: when no IB device or port
is specified (see the &quot;local umad parameters&quot;
below), the libibumad library selects the port to use by the
following criteria:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="15%"></td>
<td width="3%">


<p>1.</p></td>
<td width="2%"></td>
<td width="80%">


<p>the first port that is ACTIVE.</p></td></tr>
<tr valign="top" align="left">
<td width="15%"></td>
<td width="3%">


<p>2.</p></td>
<td width="2%"></td>
<td width="80%">


<p>if not found, the first port that is UP (physical link
up).</p> </td></tr>
</table>

<p style="margin-left:15%; margin-top: 1em">If a port
and/or CA name is specified, the libibumad library attempts
to fulfill the user request, and will fail if it is not
possible.</p>

<p style="margin-left:15%; margin-top: 1em">For
example:</p>

<pre style="margin-left:15%; margin-top: 1em">ibaddr                 # use the first port (criteria #1 above)
ibaddr &minus;C mthca1       # pick the best port from &quot;mthca1&quot; only.
ibaddr &minus;P 2            # use the second (active/up) port from the first available IB device.
ibaddr &minus;C mthca0 &minus;P 2  # use the specified port only.</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Debugging
flags</b></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em"><b>&minus;d</b></p></td>
<td width="8%"></td>
<td width="78%">


<p style="margin-top: 1em">raise the IB debugging level.
May be used several times (&minus;ddd or &minus;d &minus;d
&minus;d).</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;e</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>show send and receive errors (timeouts and others)</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em"><b>&minus;h,
&minus;&minus;help</b> show the usage message <b><br>
&minus;v, &minus;&minus;verbose</b></p>

<p style="margin-left:22%; margin-top: 1em">increase the
application verbosity level. May be used several times
(&minus;vv or &minus;v &minus;v &minus;v)</p>

<p style="margin-left:11%; margin-top: 1em"><b>&minus;V,
&minus;&minus;version</b> show the version info.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Configuration
flags <br>
&minus;t, &minus;&minus;timeout &lt;timeout_ms&gt;</b>
override the default timeout for the solicited mads. <b><br>
&minus;y, &minus;&minus;m_key &lt;key&gt;</b></p>

<p style="margin-left:22%; margin-top: 1em">use the
specified M_key for requests. If non&minus;numeric value
(like 'x') is specified then a value will be prompted
for.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;config,
&minus;z &lt;config_file&gt;</b> Specify alternate config
file.</p>

<p style="margin-left:15%; margin-top: 1em">Default:
/etc/infiniband-diags/ibdiag.conf</p>

<p style="margin-left:11%; margin-top: 1em"><b>FILES <br>
CONFIG FILE</b> <br>
/etc/infiniband-diags/ibdiag.conf</p>

<p style="margin-left:11%; margin-top: 1em">A global config
file is provided to set some of the common options for all
tools. See supplied config file for details.</p>


<p style="margin-left:11%; margin-top: 1em"><b>EXAMPLES</b></p>


<pre style="margin-left:11%;">perfquery                # read local port performance counters
perfquery 32 1           # read performance counters from lid 32, port 1
perfquery &minus;x 32 1        # read extended performance counters from lid 32, port 1
perfquery &minus;a 32          # read perf counters from lid 32, all ports
perfquery &minus;r 32 1        # read performance counters and reset
perfquery &minus;x &minus;r 32 1     # read extended performance counters and reset
perfquery &minus;R 0x20 1      # reset performance counters of port 1 only
perfquery &minus;x &minus;R 0x20 1   # reset extended performance counters of port 1 only
perfquery &minus;R &minus;a 32       # reset performance counters of all ports
perfquery &minus;R 32 2 0x0fff # reset only error counters of port 2
perfquery &minus;R 32 2 0xf000 # reset only non&minus;error counters of port 2
perfquery &minus;a 32 1&minus;10     # read performance counters from lid 32, port 1&minus;10, aggregate output
perfquery &minus;l 32 1&minus;10     # read performance counters from lid 32, port 1&minus;10, output each port
perfquery &minus;a 32 1,4,8    # read performance counters from lid 32, port 1, 4, and 8, aggregate output
perfquery &minus;l 32 1,4,8    # read performance counters from lid 32, port 1, 4, and 8, output each port</pre>


<p style="margin-left:11%; margin-top: 1em"><b>AUTHOR <br>
Hal Rosenstock</b></p>

<p style="margin-left:22%;">&lt;
<i>hal.rosenstock@gmail.com</i> &gt;</p>
<hr>
</body>
</html>
