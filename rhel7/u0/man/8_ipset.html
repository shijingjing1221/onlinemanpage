<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Sat Nov 12 02:00:23 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>IPSET</title>

</head>
<body>

<h1 align="center">IPSET</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#INTRODUCTION">INTRODUCTION</a><br>
<a href="#GENERIC CREATE AND ADD OPTIONS">GENERIC CREATE AND ADD OPTIONS</a><br>
<a href="#SET TYPES">SET TYPES</a><br>
<a href="#GENERAL RESTRICTIONS">GENERAL RESTRICTIONS</a><br>
<a href="#COMMENTS">COMMENTS</a><br>
<a href="#DIAGNOSTICS">DIAGNOSTICS</a><br>
<a href="#BUGS">BUGS</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#AUTHORS">AUTHORS</a><br>
<a href="#LAST REMARK">LAST REMARK</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">ipset &mdash;
administration tool for IP sets</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>ipset</b> [
<i>OPTIONS</i> ] <i>COMMAND</i> [
<i>COMMAND&minus;OPTIONS</i> ]</p>

<p style="margin-left:11%; margin-top: 1em">COMMANDS := {
<b>create</b> | <b>add</b> | <b>del</b> | <b>test</b> |
<b>destroy</b> | <b>list</b> | <b>save</b> | <b>restore</b>
| <b>flush</b> | <b>rename</b> | <b>swap</b> | <b>help</b> |
<b>version</b> | <b>&minus;</b> }</p>

<p style="margin-left:11%; margin-top: 1em"><i>OPTIONS</i>
:= { <b>&minus;exist</b> | <b>&minus;output</b> {
<b>plain</b> | <b>save</b> | <b>xml</b> } |
<b>&minus;quiet</b> | <b>&minus;resolve</b> |
<b>&minus;sorted</b> | <b>&minus;name</b> |
<b>&minus;terse</b> | <b>&minus;file</b> <i>filename</i>
}</p>

<p style="margin-left:11%; margin-top: 1em"><b>ipset
create</b> <i>SETNAME TYPENAME</i> [
<i>CREATE&minus;OPTIONS</i> ]</p>

<p style="margin-left:11%; margin-top: 1em"><b>ipset
add</b> <i>SETNAME ADD&minus;ENTRY</i> [
<i>ADD&minus;OPTIONS</i> ]</p>

<p style="margin-left:11%; margin-top: 1em"><b>ipset
del</b> <i>SETNAME DEL&minus;ENTRY</i> [
<i>DEL&minus;OPTIONS</i> ]</p>

<p style="margin-left:11%; margin-top: 1em"><b>ipset
test</b> <i>SETNAME TEST&minus;ENTRY</i> [
<i>TEST&minus;OPTIONS</i> ]</p>

<p style="margin-left:11%; margin-top: 1em"><b>ipset
destroy</b> [ <i>SETNAME</i> ]</p>

<p style="margin-left:11%; margin-top: 1em"><b>ipset
list</b> [ <i>SETNAME</i> ]</p>

<p style="margin-left:11%; margin-top: 1em"><b>ipset
save</b> [ <i>SETNAME</i> ]</p>

<p style="margin-left:11%; margin-top: 1em"><b>ipset
restore</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>ipset
flush</b> [ <i>SETNAME</i> ]</p>

<p style="margin-left:11%; margin-top: 1em"><b>ipset
rename</b> <i>SETNAME&minus;FROM SETNAME&minus;TO</i></p>

<p style="margin-left:11%; margin-top: 1em"><b>ipset
swap</b> <i>SETNAME&minus;FROM SETNAME&minus;TO</i></p>

<p style="margin-left:11%; margin-top: 1em"><b>ipset
help</b> [ <i>TYPENAME</i> ]</p>

<p style="margin-left:11%; margin-top: 1em"><b>ipset
version</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>ipset
&minus;</b></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>ipset</b> is
used to set up, maintain and inspect so called IP sets in
the Linux kernel. Depending on the type of the set, an IP
set may store IP(v4/v6) addresses, (TCP/UDP) port numbers,
IP and MAC address pairs, IP address and port number pairs,
etc. See the set type definitions below.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Iptables</b>
matches and targets referring to sets create references,
which protect the given sets in the kernel. A set cannot be
destroyed while there is a single reference pointing to
it.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The options
that are recognized by <b>ipset</b> can be divided into
several different groups.</p>


<p style="margin-left:11%; margin-top: 1em"><b>COMMANDS</b>
<br>
These options specify the desired action to perform. Only
one of them can be specified on the command line unless
otherwise specified below. For all the long versions of the
command names, you need to use only enough letters to ensure
that <b>ipset</b> can differentiate it from all other
commands. The <b>ipset</b> parser follows the order here
when looking for the shortest match in the long command
names. <b><br>
n</b>, <b>create</b> <i>SETNAME TYPENAME</i> [
<i>CREATE&minus;OPTIONS</i> ]</p>

<p style="margin-left:22%;">Create a set identified with
setname and specified type. The type may require type
specific options. If the <b>&minus;exist</b> option is
specified, <b>ipset</b> ignores the error otherwise raised
when the same set (setname and create parameters are
identical) already exists.</p>

<p style="margin-left:11%;"><b>add</b> <i>SETNAME
ADD&minus;ENTRY</i> [ <i>ADD&minus;OPTIONS</i> ]</p>

<p style="margin-left:22%;">Add a given entry to the set.
If the <b>&minus;exist</b> option is specified, <b>ipset</b>
ignores if the entry already added to the set.</p>

<p style="margin-left:11%;"><b>del</b> <i>SETNAME
DEL&minus;ENTRY</i> [ <i>DEL&minus;OPTIONS</i> ]</p>

<p style="margin-left:22%;">Delete an entry from a set. If
the <b>&minus;exist</b> option is specified, <b>ipset</b>
ignores if the entry does not added to (already expired
from) the set.</p>

<p style="margin-left:11%;"><b>test</b> <i>SETNAME
TEST&minus;ENTRY</i> [ <i>TEST&minus;OPTIONS</i> ]</p>

<p style="margin-left:22%;">Test wether an entry is in a
set or not. Exit status number is zero if the tested entry
is in the set and nonzero if it is missing from the set.</p>

<p style="margin-left:11%;"><b>x</b>, <b>destroy</b> [
<i>SETNAME</i> ]</p>

<p style="margin-left:22%;">Destroy the specified set or
all the sets if none is given.</p>

<p style="margin-left:22%; margin-top: 1em">If the set has
got reference(s), nothing is done and no set destroyed.</p>

<p style="margin-left:11%;"><b>list</b> [ <i>SETNAME</i> ]
[ <i>OPTIONS</i> ]</p>

<p style="margin-left:22%;">List the header data and the
entries for the specified set, or for all sets if none is
given. The <b>&minus;resolve</b> option can be used to force
name lookups (which may be slow). When the
<b>&minus;sorted</b> option is given, the entries are listed
sorted (if the given set type supports the operation). The
option <b>&minus;output</b> can be used to control the
format of the listing: <b>plain</b>, <b>save</b> or
<b>xml</b>. (The default is <b>plain</b>.) If the option
<b>&minus;name</b> is specified, just the names of the
existing sets are listed. If the option <b>&minus;terse</b>
is specified, just the set names and headers are listed. The
output is printed to stdout, the option <b>&minus;file</b>
can be used to specify a filename instead of stdout.</p>

<p style="margin-left:11%;"><b>save</b> [ <i>SETNAME</i>
]</p>

<p style="margin-left:22%;">Save the given set, or all sets
if none is given to stdout in a format that <b>restore</b>
can read. The option <b>&minus;file</b> can be used to
specify a filename instead of stdout.</p>

<p style="margin-left:11%;"><b>restore</b></p>

<p style="margin-left:22%;">Restore a saved session
generated by <b>save</b>. The saved session can be fed from
stdin or the option <b>&minus;file</b> can be used to
specify a filename instead of stdin.</p>

<p style="margin-left:22%; margin-top: 1em">Please note,
existing sets and elements are not erased by <b>restore</b>
unless specified so in the restore file. All commands are
allowed in restore mode except <b>list</b>, <b>help</b>,
<b>version</b>, interactive mode and <b>restore</b>
itself.</p>

<p style="margin-left:11%;"><b>flush</b> [ <i>SETNAME</i>
]</p>

<p style="margin-left:22%;">Flush all entries from the
specified set or flush all sets if none is given.</p>

<p style="margin-left:11%;"><b>e</b>, <b>rename</b>
<i>SETNAME&minus;FROM SETNAME&minus;TO</i></p>

<p style="margin-left:22%;">Rename a set. Set identified by
<i>SETNAME&minus;TO</i> must not exist.</p>

<p style="margin-left:11%;"><b>w</b>, <b>swap</b>
<i>SETNAME&minus;FROM SETNAME&minus;TO</i></p>

<p style="margin-left:22%;">Swap the content of two sets,
or in another words, exchange the name of two sets. The
referred sets must exist and identical type of sets can be
swapped only.</p>

<p style="margin-left:11%;"><b>help</b> [ <i>TYPENAME</i>
]</p>

<p style="margin-left:22%;">Print help and set type
specific help if <i>TYPENAME</i> is specified.</p>

<p style="margin-left:11%;"><b>version</b></p>

<p style="margin-left:22%;">Print program version.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p><b>&minus;</b></p></td>
<td width="10%"></td>
<td width="78%">


<p>If a dash is specified as command, then <b>ipset</b>
enters a simple interactive mode and the commands are read
from the standard input. The interactive mode can be
finished by entering the pseudo&minus;command
<b>quit</b>.</p> </td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em"><b>OTHER
OPTIONS</b> <br>
The following additional options can be specified. The long
option names cannot be abbreviated. <b><br>
&minus;!</b>, <b>&minus;exist</b></p>

<p style="margin-left:22%;">Ignore errors when exactly the
same set is to be created or already added entry is added or
missing entry is deleted.</p>

<p style="margin-left:11%;"><b>&minus;o</b>,
<b>&minus;output</b> { <b>plain</b> | <b>save</b> |
<b>xml</b> }</p>

<p style="margin-left:22%;">Select the output format to the
<b>list</b> command.</p>

<p style="margin-left:11%;"><b>&minus;q</b>,
<b>&minus;quiet</b></p>

<p style="margin-left:22%;">Suppress any output to stdout
and stderr. <b>ipset</b> will still exit with error if it
cannot continue.</p>

<p style="margin-left:11%;"><b>&minus;r</b>,
<b>&minus;resolve</b></p>

<p style="margin-left:22%;">When listing sets, enforce name
lookup. The program will try to display the IP entries
resolved to host names which requires <b>slow</b> DNS
lookups.</p>

<p style="margin-left:11%;"><b>&minus;s</b>,
<b>&minus;sorted</b></p>

<p style="margin-left:22%;">Sorted output. When listing
sets entries are listed sorted. Not supported yet.</p>

<p style="margin-left:11%;"><b>&minus;n</b>,
<b>&minus;name</b></p>

<p style="margin-left:22%;">List just the names of the
existing sets, i.e. suppress listing of set headers and
members.</p>

<p style="margin-left:11%;"><b>&minus;t</b>,
<b>&minus;terse</b></p>

<p style="margin-left:22%;">List the set names and headers,
i.e. suppress listing of set members.</p>

<p style="margin-left:11%;"><b>&minus;f</b>,
<b>&minus;file</b> <i>filename</i></p>

<p style="margin-left:22%;">Specify a filename to print
into instead of stdout (<b>list</b> or <b>save</b> commands)
or read from instead of stdin (<b>restore</b> command).</p>

<h2>INTRODUCTION
<a name="INTRODUCTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">A set type
comprises of the storage method by which the data is stored
and the data type(s) which are stored in the set. Therefore
the <i>TYPENAME</i> parameter of the <b>create</b> command
follows the syntax</p>


<p style="margin-left:11%; margin-top: 1em"><i>TYPENAME</i>
:=
<i>method</i><b>:</b><i>datatype</i>[<b>,</b><i>datatype</i>[<b>,</b><i>datatype</i>]]</p>

<p style="margin-left:11%; margin-top: 1em">where the
current list of the methods are <b>bitmap</b>, <b>hash</b>,
and <b>list</b> and the possible data types are <b>ip</b>,
<b>net</b>, <b>mac</b>, <b>port</b> and <b>iface</b>. The
dimension of a set is equal to the number of data types in
its type name.</p>

<p style="margin-left:11%; margin-top: 1em">When adding,
deleting or testing entries in a set, the same comma
separated data syntax must be used for the entry parameter
of the commands, i.e</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
ipaddr,portnum,ipaddr</p>

<p style="margin-left:11%; margin-top: 1em">If host names
or service names with dash in the name are used instead of
IP addresses or service numbers, then the host name or
service name must be enclosed in square brackets.
Example:</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
[test&minus;hostname],[ftp&minus;data]</p>

<p style="margin-left:11%; margin-top: 1em">In the case of
host names the DNS resolver is called internally by
<b>ipset</b> but if it returns multiple IP addresses, only
the first one is used.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>bitmap</b> and <b>list</b> types use a fixed sized
storage. The <b>hash</b> types use a hash to store the
elements. In order to avoid clashes in the hash, a limited
number of chaining, and if that is exhausted, the doubling
of the hash size is performed when adding entries by the
<b>ipset</b> command. When entries added by the <b>SET</b>
target of <b>iptables/ip6tables</b>, then the hash size is
fixed and the set won&rsquo;t be duplicated, even if the new
entry cannot be added to the set.</p>

<h2>GENERIC CREATE AND ADD OPTIONS
<a name="GENERIC CREATE AND ADD OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>timeout</b>
<br>
All set types supports the optional <b>timeout</b> parameter
when creating a set and adding entries. The value of the
<b>timeout</b> parameter for the <b>create</b> command means
the default timeout value (in seconds) for new entries. If a
set is created with timeout support, then the same
<b>timeout</b> option can be used to specify
non&minus;default timeout values when adding entries. Zero
timeout value means the entry is added permanent to the set.
The timeout value of already added elements can be changed
by readding the element using the <b>&minus;exist</b>
option. Example:</p>

<p style="margin-left:22%; margin-top: 1em">ipset create
test hash:ip timeout 300</p>

<p style="margin-left:22%; margin-top: 1em">ipset add test
192.168.0.1 timeout 60</p>

<p style="margin-left:22%; margin-top: 1em">ipset -exist
add test 192.168.0.1 timeout 600</p>

<p style="margin-left:11%; margin-top: 1em"><b>nomatch</b>
<br>
The <b>hash</b> set types which can store <b>net</b> type of
data (i.e. hash:*net*) support the optional <b>nomatch</b>
option when adding entries. When matching elements in the
set, entries marked as <b>nomatch</b> are skipped as if
those were not added to the set, which makes possible to
build up sets with exceptions. See the example at hash type
<b>hash:net</b> below.</p>

<p style="margin-left:11%; margin-top: 1em">When elements
are tested by <b>ipset</b>, the <b>nomatch</b> flags are
taken into account. If one wants to test the existence of an
element marked with <b>nomatch</b> in a set, then the flag
must be specified too.</p>

<p style="margin-left:11%; margin-top: 1em"><b>counters,
packets, bytes</b> <br>
All set types support the optional <b>counters</b> option
when creating a set. If the option is specified then the set
is created with packet and byte counters per element
support. The packet and byte counters are initialized to
zero when the elements are (re&minus;)added to the set,
unless the packet and byte counter values are explicitly
specified by the <b>packets</b> and <b>bytes</b> options. An
example when an element is added to a set with
non&minus;zero counter values:</p>

<p style="margin-left:22%; margin-top: 1em">ipset create
foo hash:ip counters</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.1.1 packets 42 bytes 1024</p>

<h2>SET TYPES
<a name="SET TYPES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>bitmap:ip</b>
<br>
The <b>bitmap:ip</b> set type uses a memory range to store
either IPv4 host (default) or IPv4 network addresses. A
<b>bitmap:ip</b> type of set can store up to 65536
entries.</p>


<p style="margin-left:11%; margin-top: 1em"><i>CREATE&minus;OPTIONS</i>
:= <b>range</b>
<i>fromip</i>&minus;<i>toip</i>|<i>ip</i>/<i>cidr</i> [
<b>netmask</b> <i>cidr</i> ] [ <b>timeout</b> <i>value</i> ]
[ <b>counters</b> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;ENTRY</i>
:= { <i>ip</i> | <i>fromip</i>&minus;<i>toip</i> |
<i>ip</i>/<i>cidr</i> }</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;OPTIONS</i>
:= [ <b>timeout</b> <i>value</i> ] [ <b>packets</b>
<i>value</i> ] [ <b>bytes</b> <i>value</i> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>DEL&minus;ENTRY</i>
:= { <i>ip</i> | <i>fromip</i>&minus;<i>toip</i> |
<i>ip</i>/<i>cidr</i> }</p>


<p style="margin-left:11%; margin-top: 1em"><i>TEST&minus;ENTRY</i>
:= <i>ip</i></p>

<p style="margin-left:11%; margin-top: 1em">Mandatory
<b>create</b> options: <b><br>
range</b>
<i>fromip</i>&minus;<i>toip</i>|<i>ip</i>/<i>cidr</i></p>

<p style="margin-left:22%;">Create the set from the
specified inclusive address range expressed in an IPv4
address range or network. The size of the range (in entries)
cannot exceed the limit of maximum 65536 elements.</p>

<p style="margin-left:11%; margin-top: 1em">Optional
<b>create</b> options: <b><br>
netmask</b> <i>cidr</i></p>

<p style="margin-left:22%;">When the optional
<b>netmask</b> parameter specified, network addresses will
be stored in the set instead of IP host addresses. The
<i>cidr</i> prefix value must be between 1&minus;32. An IP
address will be in the set if the network address, which is
resulted by masking the address with the specified netmask,
can be found in the set.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>bitmap:ip</b> type supports adding or deleting multiple
entries in one command.</p>

<p style="margin-left:11%; margin-top: 1em">Examples:</p>

<p style="margin-left:22%; margin-top: 1em">ipset create
foo bitmap:ip range 192.168.0.0/16</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.1/24</p>

<p style="margin-left:22%; margin-top: 1em">ipset test foo
192.168.1.1</p>


<p style="margin-left:11%; margin-top: 1em"><b>bitmap:ip,mac</b>
<br>
The <b>bitmap:ip,mac</b> set type uses a memory range to
store IPv4 and a MAC address pairs. A <b>bitmap:ip,mac</b>
type of set can store up to 65536 entries.</p>


<p style="margin-left:11%; margin-top: 1em"><i>CREATE&minus;OPTIONS</i>
:= <b>range</b>
<i>fromip</i>&minus;<i>toip</i>|<i>ip</i>/<i>cidr</i> [
<b>timeout</b> <i>value</i> ] [ <b>counters</b> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;ENTRY</i>
:= <i>ip</i>[,<i>macaddr</i>]</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;OPTIONS</i>
:= [ <b>timeout</b> <i>value</i> ] [ <b>packets</b>
<i>value</i> ] [ <b>bytes</b> <i>value</i> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>DEL&minus;ENTRY</i>
:= <i>ip</i>[,<i>macaddr</i>]</p>


<p style="margin-left:11%; margin-top: 1em"><i>TEST&minus;ENTRY</i>
:= <i>ip</i>[,<i>macaddr</i>]</p>

<p style="margin-left:11%; margin-top: 1em">Mandatory
options to use when creating a <b>bitmap:ip,mac</b> type of
set: <b><br>
range</b>
<i>fromip</i>&minus;<i>toip</i>|<i>ip</i>/<i>cidr</i></p>

<p style="margin-left:22%;">Create the set from the
specified inclusive address range expressed in an IPv4
address range or network. The size of the range cannot
exceed the limit of maximum 65536 entries.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>bitmap:ip,mac</b> type is exceptional in the sense that
the MAC part can be left out when adding/deleting/testing
entries in the set. If we add an entry without the MAC
address specified, then when the first time the entry is
matched by the kernel, it will automatically fill out the
missing MAC address with the source MAC address from the
packet. If the entry was specified with a timeout value, the
timer starts off when the IP and MAC address pair is
complete.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>bitmap:ip,mac</b> type of sets require two <b>src/dst</b>
parameters of the <b>set</b> match and <b>SET</b> target
netfilter kernel modules and the second one must be
<b>src</b> to match, add or delete entries, because the
<b>set</b> match and <b>SET</b> target have access to the
source MAC address only.</p>

<p style="margin-left:11%; margin-top: 1em">Examples:</p>

<p style="margin-left:22%; margin-top: 1em">ipset create
foo bitmap:ip,mac range 192.168.0.0/16</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.1.1,12:34:56:78:9A:BC</p>

<p style="margin-left:22%; margin-top: 1em">ipset test foo
192.168.1.1</p>


<p style="margin-left:11%; margin-top: 1em"><b>bitmap:port</b>
<br>
The <b>bitmap:port</b> set type uses a memory range to store
port numbers and such a set can store up to 65536 ports.</p>


<p style="margin-left:11%; margin-top: 1em"><i>CREATE&minus;OPTIONS</i>
:= <b>range</b> <i>fromport</i>&minus;<i>toport [</i>
<b>timeout</b> <i>value</i> ] [ <b>counters</b> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;ENTRY</i>
:= { <i>port</i> | <i>fromport</i>&minus;<i>toport</i> }</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;OPTIONS</i>
:= [ <b>timeout</b> <i>value</i> ] [ <b>packets</b>
<i>value</i> ] [ <b>bytes</b> <i>value</i> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>DEL&minus;ENTRY</i>
:= { <i>port</i> | <i>fromport</i>&minus;<i>toport</i> }</p>


<p style="margin-left:11%; margin-top: 1em"><i>TEST&minus;ENTRY</i>
:= <i>port</i></p>

<p style="margin-left:11%; margin-top: 1em">Mandatory
options to use when creating a <b>bitmap:port</b> type of
set: <b><br>
range</b> <i>fromport</i>&minus;<i>toport</i></p>

<p style="margin-left:22%;">Create the set from the
specified inclusive port range.</p>

<p style="margin-left:11%; margin-top: 1em">The <b>set</b>
match and <b>SET</b> target netfilter kernel modules
interpret the stored numbers as TCP or UDP port numbers.</p>

<p style="margin-left:11%; margin-top: 1em">Examples:</p>

<p style="margin-left:22%; margin-top: 1em">ipset create
foo bitmap:port range 0&minus;1024</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
80</p>

<p style="margin-left:22%; margin-top: 1em">ipset test foo
80</p>

<p style="margin-left:11%; margin-top: 1em"><b>hash:ip</b>
<br>
The <b>hash:ip</b> set type uses a hash to store IP host
addresses (default) or network addresses. Zero valued IP
address cannot be stored in a <b>hash:ip</b> type of
set.</p>


<p style="margin-left:11%; margin-top: 1em"><i>CREATE&minus;OPTIONS</i>
:= [ <b>family</b> { <b>inet</b> | <b>inet6</b> } ] | [
<b>hashsize</b> <i>value</i> ] [ <b>maxelem</b> <i>value</i>
] [ <b>netmask</b> <i>cidr</i> ] [ <b>timeout</b>
<i>value</i> ] [ <b>counters</b> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;ENTRY</i>
:= <i>ipaddr</i></p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;OPTIONS</i>
:= [ <b>timeout</b> <i>value</i> ] [ <b>packets</b>
<i>value</i> ] [ <b>bytes</b> <i>value</i> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>DEL&minus;ENTRY</i>
:= <i>ipaddr</i></p>


<p style="margin-left:11%; margin-top: 1em"><i>TEST&minus;ENTRY</i>
:= <i>ipaddr</i></p>

<p style="margin-left:11%; margin-top: 1em">Optional
<b>create</b> options: <b><br>
family</b> { <b>inet</b> | <b>inet6</b> }</p>

<p style="margin-left:22%;">The protocol family of the IP
addresses to be stored in the set. The default is
<b>inet</b>, i.e IPv4.</p>

<p style="margin-left:11%;"><b>hashsize</b>
<i>value</i></p>

<p style="margin-left:22%;">The initial hash size for the
set, default is 1024. The hash size must be a power of two,
the kernel automatically rounds up non power of two hash
sizes to the first correct value.</p>

<p style="margin-left:11%;"><b>maxelem</b> <i>value</i></p>

<p style="margin-left:22%;">The maximal number of elements
which can be stored in the set, default 65536.</p>

<p style="margin-left:11%;"><b>netmask</b> <i>cidr</i></p>

<p style="margin-left:22%;">When the optional
<b>netmask</b> parameter specified, network addresses will
be stored in the set instead of IP host addresses. The
<i>cidr</i> prefix value must be between 1&minus;32 for IPv4
and between 1&minus;128 for IPv6. An IP address will be in
the set if the network address, which is resulted by masking
the address with the netmask, can be found in the set.</p>

<p style="margin-left:11%; margin-top: 1em">For the
<b>inet</b> family one can add or delete multiple entries by
specifying a range or a network:</p>

<p style="margin-left:11%; margin-top: 1em"><i>ipaddr</i>
:= { <i>ip</i> | <i>fromaddr</i>&minus;<i>toaddr</i> |
<i>ip</i>/<i>cidr</i> }</p>

<p style="margin-left:11%; margin-top: 1em">Examples:</p>

<p style="margin-left:22%; margin-top: 1em">ipset create
foo hash:ip netmask 30</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.1.0/24</p>

<p style="margin-left:22%; margin-top: 1em">ipset test foo
192.168.1.2</p>


<p style="margin-left:11%; margin-top: 1em"><b>hash:net</b>
<br>
The <b>hash:net</b> set type uses a hash to store different
sized IP network addresses. Network address with zero prefix
size cannot be stored in this type of sets.</p>


<p style="margin-left:11%; margin-top: 1em"><i>CREATE&minus;OPTIONS</i>
:= [ <b>family</b> { <b>inet</b> | <b>inet6</b> } ] | [
<b>hashsize</b> <i>value</i> ] [ <b>maxelem</b> <i>value</i>
] [ <b>timeout</b> <i>value</i> ] [ <b>counters</b> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;ENTRY</i>
:= <i>netaddr</i></p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;OPTIONS</i>
:= [ <b>timeout</b> <i>value</i> ] [ <b>nomatch</b> ] [
<b>packets</b> <i>value</i> ] [ <b>bytes</b> <i>value</i>
]</p>


<p style="margin-left:11%; margin-top: 1em"><i>DEL&minus;ENTRY</i>
:= <i>netaddr</i></p>


<p style="margin-left:11%; margin-top: 1em"><i>TEST&minus;ENTRY</i>
:= <i>netaddr</i></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>netaddr</i> := <i>ip</i>[/<i>cidr</i>]</p>

<p style="margin-left:11%; margin-top: 1em">Optional
<b>create</b> options: <b><br>
family</b> { <b>inet</b> | <b>inet6</b> }</p>

<p style="margin-left:22%;">The protocol family of the IP
addresses to be stored in the set. The default is
<b>inet</b>, i.e IPv4.</p>

<p style="margin-left:11%;"><b>hashsize</b>
<i>value</i></p>

<p style="margin-left:22%;">The initial hash size for the
set, default is 1024. The hash size must be a power of two,
the kernel automatically rounds up non power of two hash
sizes to the first correct value.</p>

<p style="margin-left:11%;"><b>maxelem</b> <i>value</i></p>

<p style="margin-left:22%;">The maximal number of elements
which can be stored in the set, default 65536.</p>

<p style="margin-left:11%; margin-top: 1em">For the
<b>inet</b> family one can add or delete multiple entries by
specifying a range, which is converted internally to
network(s) equal to the range:</p>

<p style="margin-left:11%; margin-top: 1em"><i>netaddr</i>
:= { <i>ip</i>[/<i>cidr</i>] |
<i>fromaddr</i>&minus;<i>toaddr</i> }</p>

<p style="margin-left:11%; margin-top: 1em">When
adding/deleting/testing entries, if the cidr prefix
parameter is not specified, then the host prefix value is
assumed. When adding/deleting entries, the exact element is
added/deleted and overlapping elements are not checked by
the kernel. When testing entries, if a host address is
tested, then the kernel tries to match the host address in
the networks added to the set and reports the result
accordingly.</p>

<p style="margin-left:11%; margin-top: 1em">From the
<b>set</b> netfilter match point of view the searching for a
match always starts from the smallest size of netblock (most
specific prefix) to the largest one (least specific prefix)
added to the set. When adding/deleting IP addresses to the
set by the <b>SET</b> netfilter target, it will be
added/deleted by the most specific prefix which can be found
in the set, or by the host prefix value if the set is
empty.</p>

<p style="margin-left:11%; margin-top: 1em">The lookup time
grows linearly with the number of the different prefix
values added to the set.</p>

<p style="margin-left:11%; margin-top: 1em">Example:</p>

<p style="margin-left:22%; margin-top: 1em">ipset create
foo hash:net</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.0.0/24</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
10.1.0.0/16</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.0/24</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.0/30 nomatch</p>

<p style="margin-left:11%; margin-top: 1em">When matching
the elements in the set above, all IP addresses will match
from the networks 192.168.0.0/24, 10.1.0.0/16 and
192.168.0/24 except the ones from 192.168.0/30.</p>


<p style="margin-left:11%; margin-top: 1em"><b>hash:ip,port</b>
<br>
The <b>hash:ip,port</b> set type uses a hash to store IP
address and port number pairs. The port number is
interpreted together with a protocol (default TCP) and zero
protocol number cannot be used.</p>


<p style="margin-left:11%; margin-top: 1em"><i>CREATE&minus;OPTIONS</i>
:= [ <b>family</b> { <b>inet</b> | <b>inet6</b> } ] | [
<b>hashsize</b> <i>value</i> ] [ <b>maxelem</b> <i>value</i>
] [ <b>timeout</b> <i>value</i> ] [ <b>counters</b> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;ENTRY</i>
:= <i>ipaddr</i>,[<i>proto</i>:]<i>port</i></p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;OPTIONS</i>
:= [ <b>timeout</b> <i>value</i> ] [ <b>packets</b>
<i>value</i> ] [ <b>bytes</b> <i>value</i> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>DEL&minus;ENTRY</i>
:= <i>ipaddr</i>,[<i>proto</i>:]<i>port</i></p>


<p style="margin-left:11%; margin-top: 1em"><i>TEST&minus;ENTRY</i>
:= <i>ipaddr</i>,[<i>proto</i>:]<i>port</i></p>

<p style="margin-left:11%; margin-top: 1em">Optional
<b>create</b> options: <b><br>
family</b> { <b>inet</b> | <b>inet6</b> }</p>

<p style="margin-left:22%;">The protocol family of the IP
addresses to be stored in the set. The default is
<b>inet</b>, i.e IPv4.</p>

<p style="margin-left:11%;"><b>hashsize</b>
<i>value</i></p>

<p style="margin-left:22%;">The initial hash size for the
set, default is 1024. The hash size must be a power of two,
the kernel automatically rounds up non power of two hash
sizes to the first correct value</p>

<p style="margin-left:11%;"><b>maxelem</b> <i>value</i></p>

<p style="margin-left:22%;">The maximal number of elements
which can be stored in the set, default 65536.</p>

<p style="margin-left:11%; margin-top: 1em">For the
<b>inet</b> family one can add or delete multiple entries by
specifying a range or a network of IPv4 addresses in the IP
address part of the entry:</p>

<p style="margin-left:11%; margin-top: 1em"><i>ipaddr</i>
:= { <i>ip</i> | <i>fromaddr</i>&minus;<i>toaddr</i> |
<i>ip</i>/<i>cidr</i> }</p>

<p style="margin-left:11%; margin-top: 1em">The
[<i>proto</i>:]<i>port</i> part of the elements may be
expressed in the following forms, where the range variations
are valid when adding or deleting entries: <i><br>
portname[&minus;portname]</i></p>

<p style="margin-left:22%;">TCP port or range of ports
expressed in TCP portname identifiers from /etc/services</p>


<p style="margin-left:11%;"><i>portnumber[&minus;portnumber]</i></p>

<p style="margin-left:22%;">TCP port or range of ports
expressed in TCP port numbers</p>


<p style="margin-left:11%;"><b>tcp</b>|<b>sctp</b>|<b>udp</b>|<b>udplite</b>:<i>portname</i>|<i>portnumber</i>[&minus;<i>portname</i>|<i>portnumber</i>]</p>

<p style="margin-left:22%;">TCP, SCTP, UDP or UDPLITE port
or port range expressed in port name(s) or port
number(s)</p>


<p style="margin-left:11%;"><b>icmp</b>:<i>codename</i>|<i>type</i>/<i>code</i></p>

<p style="margin-left:22%;">ICMP codename or type/code. The
supported ICMP codename identifiers can always be listed by
the help command.</p>


<p style="margin-left:11%;"><b>icmpv6</b>:<i>codename</i>|<i>type</i>/<i>code</i></p>

<p style="margin-left:22%;">ICMPv6 codename or type/code.
The supported ICMPv6 codename identifiers can always be
listed by the help command.</p>

<p style="margin-left:11%;"><i>proto</i>:0</p>

<p style="margin-left:22%;">All other protocols, as an
identifier from /etc/protocols or number. The pseudo port
number must be zero.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>hash:ip,port</b> type of sets require two
<b>src</b>/<b>dst</b> parameters of the <b>set</b> match and
<b>SET</b> target kernel modules.</p>

<p style="margin-left:11%; margin-top: 1em">Examples:</p>

<p style="margin-left:22%; margin-top: 1em">ipset create
foo hash:ip,port</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.1.0/24,80&minus;82</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.1.1,udp:53</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.1.1,vrrp:0</p>

<p style="margin-left:22%; margin-top: 1em">ipset test foo
192.168.1.1,80</p>


<p style="margin-left:11%; margin-top: 1em"><b>hash:net,port</b>
<br>
The <b>hash:net,port</b> set type uses a hash to store
different sized IP network address and port pairs. The port
number is interpreted together with a protocol (default TCP)
and zero protocol number cannot be used. Network address
with zero prefix size is not accepted either.</p>


<p style="margin-left:11%; margin-top: 1em"><i>CREATE&minus;OPTIONS</i>
:= [ <b>family</b> { <b>inet</b> | <b>inet6</b> } ] | [
<b>hashsize</b> <i>value</i> ] [ <b>maxelem</b> <i>value</i>
] [ <b>timeout</b> <i>value</i> ] [ <b>counters</b> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;ENTRY</i>
:= <i>netaddr</i>,[<i>proto</i>:]<i>port</i></p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;OPTIONS</i>
:= [ <b>timeout</b> <i>value</i> ] [ <b>nomatch</b> ] [
<b>packets</b> <i>value</i> ] [ <b>bytes</b> <i>value</i>
]</p>


<p style="margin-left:11%; margin-top: 1em"><i>DEL&minus;ENTRY</i>
:= <i>netaddr</i>,[<i>proto</i>:]<i>port</i></p>


<p style="margin-left:11%; margin-top: 1em"><i>TEST&minus;ENTRY</i>
:= <i>netaddr</i>,[<i>proto</i>:]<i>port</i></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>netaddr</i> := <i>ip</i>[/<i>cidr</i>]</p>

<p style="margin-left:11%; margin-top: 1em">Optional
<b>create</b> options: <b><br>
family</b> { <b>inet</b> | <b>inet6</b> }</p>

<p style="margin-left:22%;">The protocol family of the IP
addresses to be stored in the set. The default is
<b>inet</b>, i.e IPv4.</p>

<p style="margin-left:11%;"><b>hashsize</b>
<i>value</i></p>

<p style="margin-left:22%;">The initial hash size for the
set, default is 1024. The hash size must be a power of two,
the kernel automatically rounds up non power of two hash
sizes to the first correct value.</p>

<p style="margin-left:11%;"><b>maxelem</b> <i>value</i></p>

<p style="margin-left:22%;">The maximal number of elements
which can be stored in the set, default 65536.</p>

<p style="margin-left:11%; margin-top: 1em">For the
<i>netaddr</i> part of the elements see the description at
the <b>hash:net</b> set type. For the
[<i>proto</i>:]<i>port</i> part of the elements see the
description at the <b>hash:ip,port</b> set type.</p>

<p style="margin-left:11%; margin-top: 1em">When
adding/deleting/testing entries, if the cidr prefix
parameter is not specified, then the host prefix value is
assumed. When adding/deleting entries, the exact element is
added/deleted and overlapping elements are not checked by
the kernel. When testing entries, if a host address is
tested, then the kernel tries to match the host address in
the networks added to the set and reports the result
accordingly.</p>

<p style="margin-left:11%; margin-top: 1em">From the
<b>set</b> netfilter match point of view the searching for a
match always starts from the smallest size of netblock (most
specific prefix) to the largest one (least specific prefix)
added to the set. When adding/deleting IP addresses to the
set by the <b>SET</b> netfilter target, it will be
added/deleted by the most specific prefix which can be found
in the set, or by the host prefix value if the set is
empty.</p>

<p style="margin-left:11%; margin-top: 1em">The lookup time
grows linearly with the number of the different prefix
values added to the set.</p>

<p style="margin-left:11%; margin-top: 1em">Examples:</p>

<p style="margin-left:22%; margin-top: 1em">ipset create
foo hash:net,port</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.0/24,25</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
10.1.0.0/16,80</p>

<p style="margin-left:22%; margin-top: 1em">ipset test foo
192.168.0/24,25</p>


<p style="margin-left:11%; margin-top: 1em"><b>hash:ip,port,ip</b>
<br>
The <b>hash:ip,port,ip</b> set type uses a hash to store IP
address, port number and a second IP address triples. The
port number is interpreted together with a protocol (default
TCP) and zero protocol number cannot be used.</p>


<p style="margin-left:11%; margin-top: 1em"><i>CREATE&minus;OPTIONS</i>
:= [ <b>family</b> { <b>inet</b> | <b>inet6</b> } ] | [
<b>hashsize</b> <i>value</i> ] [ <b>maxelem</b> <i>value</i>
] [ <b>timeout</b> <i>value</i> ] [ <b>counters</b> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;ENTRY</i>
:= <i>ipaddr</i>,[<i>proto</i>:]<i>port</i>,<i>ip</i></p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;OPTIONS</i>
:= [ <b>timeout</b> <i>value</i> ] [ <b>packets</b>
<i>value</i> ] [ <b>bytes</b> <i>value</i> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>DEL&minus;ENTRY</i>
:= <i>ipaddr</i>,[<i>proto</i>:]<i>port</i>,<i>ip</i></p>


<p style="margin-left:11%; margin-top: 1em"><i>TEST&minus;ENTRY</i>
:= <i>ipaddr</i>,[<i>proto</i>:]<i>port</i>,<i>ip</i></p>

<p style="margin-left:11%; margin-top: 1em">For the first
<i>ipaddr</i> and [<i>proto</i>:]<i>port</i> parts of the
elements see the descriptions at the <b>hash:ip,port</b> set
type.</p>

<p style="margin-left:11%; margin-top: 1em">Optional
<b>create</b> options: <b><br>
family</b> { <b>inet</b> | <b>inet6</b> }</p>

<p style="margin-left:22%;">The protocol family of the IP
addresses to be stored in the set. The default is
<b>inet</b>, i.e IPv4.</p>

<p style="margin-left:11%;"><b>hashsize</b>
<i>value</i></p>

<p style="margin-left:22%;">The initial hash size for the
set, default is 1024. The hash size must be a power of two,
the kernel automatically rounds up non power of two hash
sizes to the first correct value.</p>

<p style="margin-left:11%;"><b>maxelem</b> <i>value</i></p>

<p style="margin-left:22%;">The maximal number of elements
which can be stored in the set, default 65536.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>hash:ip,port,ip</b> type of sets require three
<b>src</b>/<b>dst</b> parameters of the <b>set</b> match and
<b>SET</b> target kernel modules.</p>

<p style="margin-left:11%; margin-top: 1em">Examples:</p>

<p style="margin-left:22%; margin-top: 1em">ipset create
foo hash:ip,port,ip</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.1.1,80,10.0.0.1</p>

<p style="margin-left:22%; margin-top: 1em">ipset test foo
192.168.1.1,udp:53,10.0.0.1</p>


<p style="margin-left:11%; margin-top: 1em"><b>hash:ip,port,net</b>
<br>
The <b>hash:ip,port,net</b> set type uses a hash to store IP
address, port number and IP network address triples. The
port number is interpreted together with a protocol (default
TCP) and zero protocol number cannot be used. Network
address with zero prefix size cannot be stored either.</p>


<p style="margin-left:11%; margin-top: 1em"><i>CREATE&minus;OPTIONS</i>
:= [ <b>family</b> { <b>inet</b> | <b>inet6</b> } ] | [
<b>hashsize</b> <i>value</i> ] [ <b>maxelem</b> <i>value</i>
] [ <b>timeout</b> <i>value</i> ] [ <b>counters</b> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;ENTRY</i>
:=
<i>ipaddr</i>,[<i>proto</i>:]<i>port</i>,<i>netaddr</i></p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;OPTIONS</i>
:= [ <b>timeout</b> <i>value</i> ] [ <b>nomatch</b> ] [
<b>packets</b> <i>value</i> ] [ <b>bytes</b> <i>value</i>
]</p>


<p style="margin-left:11%; margin-top: 1em"><i>DEL&minus;ENTRY</i>
:=
<i>ipaddr</i>,[<i>proto</i>:]<i>port</i>,<i>netaddr</i></p>


<p style="margin-left:11%; margin-top: 1em"><i>TEST&minus;ENTRY</i>
:=
<i>ipaddr</i>,[<i>proto</i>:]<i>port</i>,<i>netaddr</i></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>netaddr</i> := <i>ip</i>[/<i>cidr</i>]</p>

<p style="margin-left:11%; margin-top: 1em">For the
<i>ipaddr</i> and [<i>proto</i>:]<i>port</i> parts of the
elements see the descriptions at the <b>hash:ip,port</b> set
type. For the <i>netaddr</i> part of the elements see the
description at the <b>hash:net</b> set type.</p>

<p style="margin-left:11%; margin-top: 1em">Optional
<b>create</b> options: <b><br>
family</b> { <b>inet</b> | <b>inet6</b> }</p>

<p style="margin-left:22%;">The protocol family of the IP
addresses to be stored in the set. The default is
<b>inet</b>, i.e IPv4.</p>

<p style="margin-left:11%;"><b>hashsize</b>
<i>value</i></p>

<p style="margin-left:22%;">The initial hash size for the
set, default is 1024. The hash size must be a power of two,
the kernel automatically rounds up non power of two hash
sizes to the first correct value.</p>

<p style="margin-left:11%;"><b>maxelem</b> <i>value</i></p>

<p style="margin-left:22%;">The maximal number of elements
which can be stored in the set, default 65536.</p>

<p style="margin-left:11%; margin-top: 1em">From the
<b>set</b> netfilter match point of view the searching for a
match always starts from the smallest size of netblock (most
specific cidr) to the largest one (least specific cidr)
added to the set. When adding/deleting triples to the set by
the <b>SET</b> netfilter target, it will be added/deleted by
the most specific cidr which can be found in the set, or by
the host cidr value if the set is empty.</p>

<p style="margin-left:11%; margin-top: 1em">The lookup time
grows linearly with the number of the different <i>cidr</i>
values added to the set.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>hash:ip,port,net</b> type of sets require three
<b>src</b>/<b>dst</b> parameters of the <b>set</b> match and
<b>SET</b> target kernel modules.</p>

<p style="margin-left:11%; margin-top: 1em">Examples:</p>

<p style="margin-left:22%; margin-top: 1em">ipset create
foo hash:ip,port,net</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.1,80,10.0.0/24</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.2,25,10.1.0.0/16</p>

<p style="margin-left:22%; margin-top: 1em">ipset test foo
192.168.1,80.10.0.0/24</p>


<p style="margin-left:11%; margin-top: 1em"><b>hash:net,iface</b>
<br>
The <b>hash:net,iface</b> set type uses a hash to store
different sized IP network address and interface name
pairs.</p>


<p style="margin-left:11%; margin-top: 1em"><i>CREATE&minus;OPTIONS</i>
:= [ <b>family</b> { <b>inet</b> | <b>inet6</b> } ] | [
<b>hashsize</b> <i>value</i> ] [ <b>maxelem</b> <i>value</i>
] [ <b>timeout</b> <i>value</i> ] [ <b>counters</b> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;ENTRY</i>
:= <i>netaddr</i>,[<b>physdev</b>:]<i>iface</i></p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;OPTIONS</i>
:= [ <b>timeout</b> <i>value</i> ] [ <b>nomatch</b> ] [
<b>packets</b> <i>value</i> ] [ <b>bytes</b> <i>value</i>
]</p>


<p style="margin-left:11%; margin-top: 1em"><i>DEL&minus;ENTRY</i>
:= <i>netaddr</i>,[<b>physdev</b>:]<i>iface</i></p>


<p style="margin-left:11%; margin-top: 1em"><i>TEST&minus;ENTRY</i>
:= <i>netaddr</i>,[<b>physdev</b>:]<i>iface</i></p>

<p style="margin-left:11%; margin-top: 1em">where
<i>netaddr</i> := <i>ip</i>[/<i>cidr</i>]</p>

<p style="margin-left:11%; margin-top: 1em">Optional
<b>create</b> options: <b><br>
family</b> { <b>inet</b> | <b>inet6</b> }</p>

<p style="margin-left:22%;">The protocol family of the IP
addresses to be stored in the set. The default is
<b>inet</b>, i.e IPv4.</p>

<p style="margin-left:11%;"><b>hashsize</b>
<i>value</i></p>

<p style="margin-left:22%;">The initial hash size for the
set, default is 1024. The hash size must be a power of two,
the kernel automatically rounds up non power of two hash
sizes to the first correct value.</p>

<p style="margin-left:11%;"><b>maxelem</b> <i>value</i></p>

<p style="margin-left:22%;">The maximal number of elements
which can be stored in the set, default 65536.</p>

<p style="margin-left:11%; margin-top: 1em">For the
<i>netaddr</i> part of the elements see the description at
the <b>hash:net</b> set type.</p>

<p style="margin-left:11%; margin-top: 1em">When
adding/deleting/testing entries, if the cidr prefix
parameter is not specified, then the host prefix value is
assumed. When adding/deleting entries, the exact element is
added/deleted and overlapping elements are not checked by
the kernel. When testing entries, if a host address is
tested, then the kernel tries to match the host address in
the networks added to the set and reports the result
accordingly.</p>

<p style="margin-left:11%; margin-top: 1em">From the
<b>set</b> netfilter match point of view the searching for a
match always starts from the smallest size of netblock (most
specific prefix) to the largest one (least specific prefix)
added to the set. When adding/deleting IP addresses to the
set by the <b>SET</b> netfilter target, it will be
added/deleted by the most specific prefix which can be found
in the set, or by the host prefix value if the set is
empty.</p>

<p style="margin-left:11%; margin-top: 1em">The second
direction parameter of the <b>set</b> match and <b>SET</b>
target modules corresponds to the incoming/outgoing
interface: <b>src</b> to the incoming one (similar to the
<b>&minus;i</b> flag of iptables), while <b>dst</b> to the
outgoing one (similar to the <b>&minus;o</b> flag of
iptables). When the interface is flagged with
<b>physdev:</b>, the interface is interpreted as the
incoming/outgoing bridge port.</p>

<p style="margin-left:11%; margin-top: 1em">The lookup time
grows linearly with the number of the different prefix
values added to the set.</p>

<p style="margin-left:11%; margin-top: 1em">The internal
restriction of the <b>hash:net,iface</b> set type is that
the same network prefix cannot be stored with more than 64
different interfaces in a single set.</p>

<p style="margin-left:11%; margin-top: 1em">Examples:</p>

<p style="margin-left:22%; margin-top: 1em">ipset create
foo hash:net,iface</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
192.168.0/24,eth0</p>

<p style="margin-left:22%; margin-top: 1em">ipset add foo
10.1.0.0/16,eth1</p>

<p style="margin-left:22%; margin-top: 1em">ipset test foo
192.168.0/24,eth0</p>


<p style="margin-left:11%; margin-top: 1em"><b>list:set</b>
<br>
The <b>list:set</b> type uses a simple list in which you can
store set names.</p>


<p style="margin-left:11%; margin-top: 1em"><i>CREATE&minus;OPTIONS</i>
:= [ <b>size</b> <i>value</i> ] [ <b>timeout</b>
<i>value</i> ] [ <b>counters</b> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;ENTRY</i>
:= <i>setname</i> [ { <b>before</b> | <b>after</b> }
<i>setname</i> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>ADD&minus;OPTIONS</i>
:= [ <b>timeout</b> <i>value</i> ] [ <b>packets</b>
<i>value</i> ] [ <b>bytes</b> <i>value</i> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>DEL&minus;ENTRY</i>
:= <i>setname</i> [ { <b>before</b> | <b>after</b> }
<i>setname</i> ]</p>


<p style="margin-left:11%; margin-top: 1em"><i>TEST&minus;ENTRY</i>
:= <i>setname</i> [ { <b>before</b> | <b>after</b> }
<i>setname</i> ]</p>

<p style="margin-left:11%; margin-top: 1em">Optional
<b>create</b> options: <b><br>
size</b> <i>value</i></p>

<p style="margin-left:22%;">The size of the list, the
default is 8.</p>

<p style="margin-left:11%; margin-top: 1em">By the
<b>ipset</b> command you can add, delete and test set names
in a <b>list:set</b> type of set.</p>

<p style="margin-left:11%; margin-top: 1em">By the
<b>set</b> match or <b>SET</b> target of netfilter you can
test, add or delete entries in the sets added to the
<b>list:set</b> type of set. The match will try to find a
matching entry in the sets and the target will try to add an
entry to the first set to which it can be added. The number
of direction options of the match and target are important:
sets which require more parameters than specified are
skipped, while sets with equal or less parameters are
checked, elements added/deleted. For example if <i>a</i> and
<i>b</i> are <b>list:set</b> type of sets then in the
command</p>

<p style="margin-left:22%; margin-top: 1em">iptables
&minus;m set &minus;&minus;match&minus;set a src,dst
&minus;j SET &minus;&minus;add&minus;set b src,dst</p>

<p style="margin-left:11%; margin-top: 1em">the match and
target will skip any set in <i>a</i> and <i>b</i> which
stores data triples, but will match all sets with single or
double data storage in <i>a</i> set and stop matching at the
first successful set, and add src to the first single or
src,dst to the first double data storage set in <i>b</i> to
which the entry can be added. You can imagine a
<b>list:set</b> type of set as an ordered union of the set
elements.</p>

<p style="margin-left:11%; margin-top: 1em">Please note: by
the <b>ipset</b> command you can add, delete and <b>test</b>
the setnames in a <b>list:set</b> type of set, and
<b>not</b> the presence of a set&rsquo;s member (such as an
IP address).</p>

<h2>GENERAL RESTRICTIONS
<a name="GENERAL RESTRICTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Zero valued set
entries cannot be used with hash methods. Zero protocol
value with ports cannot be used.</p>

<h2>COMMENTS
<a name="COMMENTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">If you want to
store same size subnets from a given network (say /24 blocks
from a /8 network), use the <b>bitmap:ip</b> set type. If
you want to store random same size networks (say random /24
blocks), use the <b>hash:ip</b> set type. If you have got
random size of netblocks, use <b>hash:net</b>.</p>

<p style="margin-left:11%; margin-top: 1em">Backward
compatibility is maintained and old <b>ipset</b> syntax is
still supported.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>iptree</b> and <b>iptreemap</b> set types are removed: if
you refer to them, they are automatically replaced by
<b>hash:ip</b> type of sets.</p>

<h2>DIAGNOSTICS
<a name="DIAGNOSTICS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Various error
messages are printed to standard error. The exit code is 0
for correct functioning.</p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Bugs? No, just
funny features. :&minus;) OK, just kidding...</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>iptables</b>(8),
<b>ip6tables</b>(8)</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Jozsef
Kadlecsik wrote ipset, which is based on ippool by Joakim
Axelsson, Patrick Schaaf and Martin Josefsson. <br>
Sven Wegener wrote the iptreemap type.</p>

<h2>LAST REMARK
<a name="LAST REMARK"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>I stand on
the shoulders of giants.</b></p>
<hr>
</body>
</html>
