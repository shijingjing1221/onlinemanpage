<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Sat Nov 12 02:22:55 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>SLAPO-RETCODE</title>

</head>
<body>

<h1 align="center">SLAPO-RETCODE</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#SCHEMA">SCHEMA</a><br>
<a href="#EXAMPLE">EXAMPLE</a><br>
<a href="#FILES">FILES</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#ACKNOWLEDGEMENTS">ACKNOWLEDGEMENTS</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">slapo&minus;retcode
&minus; return code overlay to slapd</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">/etc/openldap/slapd.conf</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<b>retcode</b> overlay to <b>slapd</b>(8) is useful to test
the behavior of clients when server-generated erroneous
and/or unusual responses occur, e.g. error codes, referrals,
excessive response times and so on.</p>

<p style="margin-left:11%; margin-top: 1em">The error
responses are generated according to different
strategies.</p>

<p style="margin-left:11%; margin-top: 1em">In the first
case, all operations targeted at a specific configurable
subtree cause the object related to the request DN to be
looked up and checked for return code data: a response code,
plus an optional textual message, an optional configurable
delay, an optional matched DN field, and, when the response
code is &quot;referral&quot;, a (list of) referral(s).</p>

<p style="margin-left:11%; margin-top: 1em">Well-known
response codes from standard track documents are provided in
<b>retcode.conf</b>, which can be included after
instantiating the overlay.</p>

<p style="margin-left:11%; margin-top: 1em">In the second
case, objects of classes inherited from the
<b>errAbsObject</b>, like <b>errObject</b> or
<b>errAuxObject</b>, when returned as intermediate responses
of a search request, are changed into the response dictated
by their content.</p>

<p style="margin-left:11%; margin-top: 1em">A third mode
causes objects to be looked up from the underlying database
to discover if their class inherits from
<b>errABsObject</b>; in that case, their content is used to
compute the corresponding response.</p>

<p style="margin-left:11%; margin-top: 1em">The behavior is
disabled by using the <b>manageDSAit</b> control (RFC 3296);
in that case, the resulting object, either present in the
directory or dynamically generated by the overlay, or
contained in the request, is handled as usual.</p>

<p style="margin-left:11%; margin-top: 1em">The config
directives that are specific to the <b>retcode</b> overlay
must be prefixed by <b>retcode&minus;</b>, to avoid
conflicts with directives specific to the underlying
database or to other stacked overlays. The following
specific directives can be used to configure the retcode
overlay: <b><br>
retcode&minus;parent &lt;DN&gt;</b></p>

<p style="margin-left:22%;">This directive defines the
parent DN where dynamically generated entries reside. If not
defined, the suffix of the database is used.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="89%">


<p style="margin-top: 1em"><b>retcode&minus;item
&lt;RDN&gt; &lt;errCode&gt; [op=&lt;oplist&gt;]
[text=&lt;message&gt;]</b></p> </td></tr>
</table>

<p style="margin-left:11%;"><b>[ref=&lt;referral&gt;]
[sleeptime=&lt;sec&gt;] [matched=&lt;DN&gt;]
[unsolicited=&lt;OID&gt;[:&lt;data&gt;]]
[flags=[{pre|post}&minus;]disconnect[,...]]</b></p>

<p style="margin-left:22%;">A dynamically generated entry,
located below <b>retcode&minus;parent</b>. The
<b>errCode</b> is the number of the response code; it can be
in any format supported by <b>strtol</b>(3). The optional
<b>oplist</b> is a list of operations that cause response
code generation; if absent, all operations are affected. The
<b>matched</b> field is the matched DN that is returned
along with the error, while the <b>text</b> field is an
optional diagnostics message. The <b>ref</b> field is only
allowed for the <b>referral</b> response code. The
<b>sleeptime</b> field causes <b>slapd</b>(8) to sleep the
specified number of seconds before proceeding with the
operation. The <b>unsolicited</b> field can be used to cause
the return of an RFC 4511 unsolicited response message; if
<b>OID</b> is not &quot;0&quot;, an extended response is
generated, with the optional <b>data</b> appended. If
<b>flags</b> contains <b>disconnect</b>, or
<b>pre&minus;disconnect</b>, <b>slapd</b>(8) disconnects
abruptly, without notice; <b>post&minus;disconnect</b>
causes disconnection right after sending response as
appropriate.</p>

<p style="margin-left:11%;"><b>retcode&minus;indir</b></p>

<p style="margin-left:22%;">Enables exploitation of
in-directory stored errAbsObject. May result in a lot of
unnecessary overhead.</p>

<p style="margin-left:11%;"><b>retcode&minus;sleep
[&minus;]&lt;n&gt;</b></p>

<p style="margin-left:22%;">Defines a sleep time in seconds
that is spent before actually handling any operation. If
negative, a random time between 0 and the absolute value of
the argument is used.</p>

<h2>SCHEMA
<a name="SCHEMA"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<b>retcode</b> overlay utilizes the &quot;return code&quot;
schema described herein. This schema is specifically
designed for use with this overlay and is not intended to be
used otherwise. It is also noted that the schema described
here is <i>a work in progress</i>, and hence subject to
change without notice. The schema is loaded automatically by
the overlay.</p>

<p style="margin-left:11%; margin-top: 1em">The schema
includes a number of object classes and associated attribute
types as described below.</p>

<p style="margin-left:11%; margin-top: 1em">The error
code:</p>

<p style="margin-left:17%;">( 1.3.6.1.4.1.4203.666.11.4.1.1
<br>
NAME ( &rsquo;errCode&rsquo; ) <br>
DESC &rsquo;LDAP error code&rsquo; <br>
EQUALITY integerMatch <br>
ORDERING integerOrderingMatch <br>
SYNTAX 1.3.6.1.4.1.1466.115.121.1.27 <br>
SINGLE&minus;VALUE )</p>

<p style="margin-left:11%; margin-top: 1em">The operations
that trigger the response code:</p>

<p style="margin-left:17%;">( 1.3.6.1.4.1.4203.666.11.4.1.2
<br>
NAME ( &rsquo;errOp&rsquo; ) <br>
DESC &rsquo;Operations the errObject applies to&rsquo; <br>
EQUALITY caseIgnoreMatch <br>
SUBSTR caseIgnoreSubstringsMatch <br>
SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 )</p>

<p style="margin-left:11%; margin-top: 1em">The text
message:</p>

<p style="margin-left:17%;">( 1.3.6.1.4.1.4203.666.11.4.1.3
<br>
NAME ( &rsquo;errText&rsquo; ) <br>
DESC &rsquo;LDAP error textual description&rsquo; <br>
EQUALITY caseIgnoreMatch <br>
SUBSTR caseIgnoreSubstringsMatch <br>
SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 <br>
SINGLE&minus;VALUE )</p>

<p style="margin-left:11%; margin-top: 1em">The sleep time
before the response is actually returned to the client:</p>

<p style="margin-left:17%;">( 1.3.6.1.4.1.4203.666.11.4.1.4
<br>
NAME ( &rsquo;errSleepTime&rsquo; ) <br>
DESC &rsquo;Time to wait before returning the error&rsquo;
<br>
EQUALITY integerMatch <br>
SYNTAX 1.3.6.1.4.1.1466.115.121.1.27 <br>
SINGLE&minus;VALUE )</p>

<p style="margin-left:11%; margin-top: 1em">The matched DN
returned to the client:</p>

<p style="margin-left:17%;">( 1.3.6.1.4.1.4203.666.11.4.1.5
<br>
NAME ( &rsquo;errMatchedDN&rsquo; ) <br>
DESC &rsquo;Value to be returned as matched DN&rsquo; <br>
EQUALITY distinguishedNameMatch <br>
SYNTAX 1.3.6.1.4.1.1466.115.121.1.12 <br>
SINGLE&minus;VALUE )</p>

<p style="margin-left:11%; margin-top: 1em">The OID to be
returned as extended response OID in RFC 4511 unsolicited
responses (&quot;0&quot; generates a regular response with
msgid set to 0):</p>

<p style="margin-left:17%;">( 1.3.6.1.4.1.4203.666.11.4.1.6
<br>
NAME ( &rsquo;errUnsolicitedOID&rsquo; ) <br>
DESC &rsquo;OID to be returned within unsolicited
response&rsquo; <br>
EQUALITY objectIdentifierMatch <br>
SYNTAX 1.3.6.1.4.1.1466.115.121.1.38 <br>
SINGLE&minus;VALUE )</p>

<p style="margin-left:11%; margin-top: 1em">The octet
string to be returned as extended response data in RFC 4511
unsolicited response:</p>

<p style="margin-left:17%;">( 1.3.6.1.4.1.4203.666.11.4.1.7
<br>
NAME ( &rsquo;errUnsolicitedData&rsquo; ) <br>
DESC &rsquo;Data to be returned within unsolicited
response&rsquo; <br>
SYNTAX 1.3.6.1.4.1.1466.115.121.1.40 <br>
SINGLE&minus;VALUE )</p>

<p style="margin-left:11%; margin-top: 1em">If TRUE,
<b>slapd</b>(8) disconnects abruptly without notice; if
FALSE, it disconnects after sending response as
appropriate:</p>

<p style="margin-left:17%;">( 1.3.6.1.4.1.4203.666.11.4.1.8
<br>
NAME ( &rsquo;errDisconnect&rsquo; ) <br>
DESC &rsquo;Disconnect without notice&rsquo; <br>
SYNTAX 1.3.6.1.4.1.1466.115.121.1.7 <br>
SINGLE&minus;VALUE )</p>

<p style="margin-left:11%; margin-top: 1em">The abstract
class that triggers the overlay:</p>

<p style="margin-left:17%;">( 1.3.6.1.4.1.4203.666.11.4.3.0
<br>
NAME ( &rsquo;errAbsObject&rsquo; ) <br>
SUP top ABSTRACT <br>
MUST ( errCode ) <br>
MAY ( cn $ description $ errOp $ errText $ errSleepTime <br>
$ errMatchedDN ) )</p>

<p style="margin-left:11%; margin-top: 1em">The standalone
structural objectclass for specifically created data:</p>

<p style="margin-left:17%;">( 1.3.6.1.4.1.4203.666.11.4.3.1
<br>
NAME ( &rsquo;errObject&rsquo; ) <br>
SUP errAbsObject STRUCTURAL )</p>

<p style="margin-left:11%; margin-top: 1em">The auxiliary
objectclass to alter the behavior of existing objects:</p>

<p style="margin-left:17%;">( 1.3.6.1.4.1.4203.666.11.4.3.2
<br>
NAME ( &rsquo;errAuxObject&rsquo; ) <br>
SUP errAbsObject AUXILIARY )</p>

<h2>EXAMPLE
<a name="EXAMPLE"></a>
</h2>


<p style="margin-left:22%; margin-top: 1em">overlay retcode
<br>
retcode&minus;parent
&quot;ou=RetCodes,dc=example,dc=com&quot;</p>

<p style="margin-left:22%; margin-top: 1em"># retcode.conf
is found in tests/data/ of the source tree <br>
include ./retcode.conf</p>

<p style="margin-left:22%; margin-top: 1em"># Wait 10
seconds, then return success (0x00) <br>
retcode&minus;item &quot;cn=Success after 10 seconds&quot;
0x00 sleeptime=10 <br>
# Wait 10 seconds, then return timelimitExceeded (0x03) <br>
retcode&minus;item &quot;cn=Timelimit after 10 seconds&quot;
0x03 sleeptime=10</p>

<h2>FILES
<a name="FILES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">/etc/openldap/slapd.conf</p>

<p style="margin-left:22%;">default slapd configuration
file</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>slapd.conf</b>(5),
<b>slapd&minus;config</b>(5), <b>slapd</b>(8). The
<b>slapo&minus;retcode</b>(5) overlay supports dynamic
configuration via <b>back-config</b>.</p>

<h2>ACKNOWLEDGEMENTS
<a name="ACKNOWLEDGEMENTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This module was
written in 2005 by Pierangelo Masarati for SysNet s.n.c.</p>
<hr>
</body>
</html>
