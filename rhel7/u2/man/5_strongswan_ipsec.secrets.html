<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Sat Nov  5 22:14:54 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>IPSEC.SECRETS</title>

</head>
<body>

<h1 align="center">IPSEC.SECRETS</h1>

<a href="#NAME">NAME</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#FILES">FILES</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#HISTORY">HISTORY</a><br>
<a href="#BUGS">BUGS</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">ipsec.secrets
&minus; secrets for IKE/IPsec authentication</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The file
<i>ipsec.secrets</i> holds a table of secrets. These secrets
are used by the strongSwan Internet Key Exchange (IKE)
daemons pluto (IKEv1) and charon (IKEv2) to authenticate
other hosts.</p>

<p style="margin-left:11%; margin-top: 1em">It is vital
that these secrets be protected. The file should be owned by
the super-user, and its permissions should be set to block
all access by others.</p>

<p style="margin-left:11%; margin-top: 1em">The file is a
sequence of entries and include directives. Here is an
example.</p>

<p style="margin-left:22%; margin-top: 1em">#
/etc/ipsec.secrets - strongSwan IPsec secrets file <br>
192.168.0.1 %any : PSK
&quot;v+NkxY9LLZvwj4qCC2o/gGrWDF2d21jL&quot;</p>

<p style="margin-left:22%; margin-top: 1em">: RSA
moonKey.pem</p>


<p style="margin-left:22%; margin-top: 1em">alice@strongswan.org
: EAP &quot;x3.dEhgN&quot;</p>

<p style="margin-left:22%; margin-top: 1em">carol : XAUTH
&quot;4iChxLT3&quot;</p>

<p style="margin-left:22%; margin-top: 1em">dave : XAUTH
&quot;ryftzG4A&quot;</p>

<p style="margin-left:22%; margin-top: 1em"># get secrets
from other files <br>
include ipsec.*.secrets</p>

<p style="margin-left:11%; margin-top: 1em">Each entry in
the file is a list of optional ID selectors, followed by a
secret. The two parts are separated by a colon (<b>:</b>)
that is surrounded by whitespace. If no ID selectors are
specified the line must start with a colon.</p>

<p style="margin-left:11%; margin-top: 1em">A selector is
an IP address, a Fully Qualified Domain Name, user@FQDN,
<b>%any</b> or <b>%any6</b> (other kinds may come).</p>

<p style="margin-left:11%; margin-top: 1em">Matching IDs
with selectors is fairly straightforward: they have to be
equal. In the case of a &lsquo;&lsquo;Road
Warrior&rsquo;&rsquo; connection, if an equal match is not
found for the Peer&rsquo;s ID, and it is in the form of an
IP address, a selector of <b>%any</b> will match the
peer&rsquo;s IP address if IPV4 and <b>%any6</b> will match
a the peer&rsquo;s IP address if IPV6. Currently, the
obsolete notation <b>0.0.0.0</b> may be used in place of
<b>%any</b>.</p>

<p style="margin-left:11%; margin-top: 1em">In IKEv1 an
additional complexity arises in the case of authentication
by preshared secret: the responder will need to look up the
secret before the Peer&rsquo;s ID payload has been decoded,
so the ID used will be the IP address.</p>

<p style="margin-left:11%; margin-top: 1em">To authenticate
a connection between two hosts, the entry that most
specifically matches the host and peer IDs is used. An entry
with no selectors will match any host and peer. More
specifically, an entry with one selector will match a host
and peer if the selector matches the host&rsquo;s ID (the
peer isn&rsquo;t considered). Still more specifically, an
entry with multiple selectors will match a host and peer if
the host ID and peer ID each match one of the selectors. If
the key is for an asymmetric authentication technique (i.e.
a public key system such as RSA), an entry with multiple
selectors will match a host and peer even if only the host
ID matches a selector (it is presumed that the selectors are
all identities of the host). It is acceptable for two
entries to be the best match as long as they agree about the
secret or private key.</p>

<p style="margin-left:11%; margin-top: 1em">Authentication
by preshared secret requires that both systems find the
identical secret (the secret is not actually transmitted by
the IKE protocol). If both the host and peer appear in the
selector list, the same entry will be suitable for both
systems so verbatim copying between systems can be used.
This naturally extends to larger groups sharing the same
secret. Thus multiple-selector entries are best for PSK
authentication.</p>

<p style="margin-left:11%; margin-top: 1em">Authentication
by public key systems such as RSA requires that each host
have its own private key. A host could reasonably use a
different private keys for different interfaces and for
different peers. But it would not be normal to share entries
between systems. Thus thus no-selector and one-selector
forms of entry often make sense for public key
authentication.</p>

<p style="margin-left:11%; margin-top: 1em">The key part of
an entry must start with a token indicating the kind of key.
The following types of secrets are currently supported:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>PSK</b></p></td>
<td width="4%"></td>
<td width="43%">


<p>defines a pre-shared key</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>RSA</b></p></td>
<td width="4%"></td>
<td width="43%">


<p>defines an RSA private key</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>ECDSA</b></p></td>
<td width="4%"></td>
<td width="43%">


<p>defines an ECDSA private key</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>P12</b></p></td>
<td width="4%"></td>
<td width="43%">


<p>defines a PKCS#12 container</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>EAP</b></p></td>
<td width="4%"></td>
<td width="43%">


<p>defines EAP credentials</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>NTLM</b></p></td>
<td width="4%"></td>
<td width="43%">


<p>defines NTLM credentials</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>XAUTH</b></p></td>
<td width="4%"></td>
<td width="43%">


<p>defines XAUTH credentials</p></td>
<td width="35%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>PIN</b></p></td>
<td width="4%"></td>
<td width="43%">


<p>defines a smartcard PIN</p></td>
<td width="35%">
</td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">Details on each
type of secret are given below.</p>

<p style="margin-left:11%; margin-top: 1em">Whitespace at
the end of a line is ignored. At the start of a line or
after whitespace, <b>#</b> and the following text up to the
end of the line is treated as a comment.</p>

<p style="margin-left:11%; margin-top: 1em">An include
directive causes the contents of the named file to be
processed before continuing with the current file. The
filename is subject to &lsquo;&lsquo;globbing&rsquo;&rsquo;
as in <i>sh</i>(1), so every file with a matching name is
processed. Includes may be nested to a modest depth (10,
currently). If the filename doesn&rsquo;t start with a
<b>/</b>, the directory containing the current file is
prepended to the name. The include directive is a line that
starts with the word <b>include</b>, followed by whitespace,
followed by the filename (which must not contain
whitespace).</p>

<p style="margin-left:11%; margin-top: 1em"><b>TYPES OF
SECRETS <br>
[ &lt;selectors&gt; ] : PSK &lt;secret&gt;</b></p>

<p style="margin-left:22%;">A preshared <i>secret</i> is
most conveniently represented as a sequence of characters,
which is delimited by double-quote characters
(<b>&quot;</b>). The sequence cannot contain newline or
double-quote characters. <br>
Alternatively, preshared secrets can be represented as
hexadecimal or Base64 encoded binary values. A character
sequence beginning with <b>0x</b> is interpreted as sequence
of hexadecimal digits. Similarly, a character sequence
beginning with <b>0s</b> is interpreted as Base64 encoded
binary data.</p>

<p style="margin-left:11%;"><b>: RSA &lt;private key
file&gt; [ &lt;passphrase&gt; | %prompt ] <br>
: ECDSA &lt;private key file&gt; [ &lt;passphrase&gt; |
%prompt ]</b></p>

<p style="margin-left:22%;">For the private key file both
absolute paths or paths relative to
<i>/etc/ipsec.d/private</i> are accepted. If the private key
file is encrypted, the <i>passphrase</i> must be defined.
Instead of a passphrase <b>%prompt</b> can be used which
then causes the daemon to ask the user for the password
whenever it is required to decrypt the key.</p>

<p style="margin-left:11%;"><b>: P12 &lt;PKCS#12 file&gt; [
&lt;passphrase&gt; | %prompt ]</b></p>

<p style="margin-left:22%;">For the PKCS#12 file both
absolute paths or paths relative to
<i>/etc/ipsec.d/private</i> are accepted. If the container
is encrypted, the <i>passphrase</i> must be defined. Instead
of a passphrase <b>%prompt</b> can be used which then causes
the daemon to ask the user for the password whenever it is
required to decrypt the container. Private keys, client and
CA certificates are extracted from the container. To use
such a client certificate in a connection set leftid to one
of the subjects of the certificate.</p>

<p style="margin-left:11%;"><b>&lt;user id&gt; : EAP
&lt;secret&gt;</b></p>

<p style="margin-left:22%;">The format of <i>secret</i> is
the same as that of <b>PSK</b> secrets. <b><br>
EAP</b> secrets are IKEv2 only.</p>

<p style="margin-left:11%;"><b>&lt;user id&gt; : NTLM
&lt;secret&gt;</b></p>

<p style="margin-left:22%;">The format of <i>secret</i> is
the same as that of <b>PSK</b> secrets, but the secret is
stored as NTLM hash, which is MD4(UTF-16LE(secret)), instead
of as cleartext. <b><br>
NTLM</b> secrets can only be used with the
<b>eap-mschapv2</b> plugin.</p>

<p style="margin-left:11%;"><b>[ &lt;servername&gt; ]
&lt;username&gt; : XAUTH &lt;password&gt;</b></p>

<p style="margin-left:22%;">The format of <i>password</i>
is the same as that of <b>PSK</b> secrets. <b>XAUTH</b>
secrets are IKEv1 only.</p>

<p style="margin-left:11%;"><b>: PIN %smartcard[&lt;slot
nr&gt;[@&lt;module&gt;]]:&lt;keyid&gt; &lt;pin code&gt; |
%prompt</b></p>

<p style="margin-left:22%;">The smartcard selector always
requires a keyid to uniquely select the correct key. The
slot number defines the slot on the token, the module name
refers to the module name defined in strongswan.conf(5).
Instead of specifying the pin code statically,
<b>%prompt</b> can be specified, which causes the daemon to
ask the user for the pin code.</p>

<h2>FILES
<a name="FILES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">/etc/ipsec.secrets</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">ipsec.conf(5),
strongswan.conf(5), ipsec(8)</p>

<h2>HISTORY
<a name="HISTORY"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Originally
written for the FreeS/WAN project by D. Hugh Redelmeier.
Updated and extended for the strongSwan project
&lt;http://www.strongswan.org&gt; by Tobias Brunner and
Andreas Steffen.</p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">If an ID is
<b>0.0.0.0</b>, it will match <b>%any</b>; if it is
<b>0::0</b>, it will match <b>%any6</b>.</p>
<hr>
</body>
</html>
