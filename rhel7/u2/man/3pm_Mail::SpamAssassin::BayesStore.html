<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 01:57:54 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>Mail::SpamAssassin::BayesStore</title>

</head>
<body>

<h1 align="center">Mail::SpamAssassin::BayesStore</h1>

<a href="#NAME">NAME</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#METHODS">METHODS</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">Mail::SpamAssassin::BayesStore
&minus; Storage Module for default Bayes classifier</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This is the
public <small>API</small> for the Bayesian store methods.
Any implementation of the storage module for the default
Bayes classifier must implement these methods.</p>

<h2>METHODS
<a name="METHODS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p style="margin-top: 1em">new</p></td>
<td width="2%"></td>
<td width="75%">


<p style="margin-top: 1em">public class
(Mail::SpamAssassin::BayesStore) new
(Mail::SpamAssassin::Plugin::Bayes <tt>$bayes</tt>)</p></td>
<td width="8%">
</td></tr>
</table>

<p style="margin-left:17%; margin-top: 1em">Description:
This method creates a new instance of the
Mail::SpamAssassin::BayesStore object. You must pass in an
instance of the Mail::SpamAssassin::Plugin::Bayes object,
which is stashed for use throughout the module.</p>

<p style="margin-left:11%;"><small>DB_VERSION</small></p>

<p style="margin-left:17%;">public instance (Integer)
<small>DB_VERSION \fIs0()</small></p>


<p style="margin-left:17%; margin-top: 1em"><small>Description:
This method returns the currently supported database version
for the implementation.</small></p>


<p style="margin-left:11%;"><small>read_db_configs</small></p>

<p style="margin-left:17%;">public instance ()
read_db_configs ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method reads any needed config variables from the
configuration object and then calls the
Mail::SpamAssassin::Plugin::Bayes read_db_configs
method.</p>

<p style="margin-left:11%;">prefork_init</p>

<p style="margin-left:17%;">public instance (Boolean)
prefork_init ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This optional method is called in the parent process shortly
before forking off child processes.</p>

<p style="margin-left:11%;">spamd_child_init</p>

<p style="margin-left:17%;">public instance (Boolean)
spamd_child_init ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This optional method is called in a child process shortly
after being spawned.</p>

<p style="margin-left:11%;">tie_db_readonly</p>

<p style="margin-left:17%;">public instance (Boolean)
tie_db_readonly ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method opens up the database in readonly mode.</p>

<p style="margin-left:11%;">tie_db_writable</p>

<p style="margin-left:17%;">public instance (Boolean)
tie_db_writable ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method opens up the database in writable mode.</p>

<p style="margin-left:17%; margin-top: 1em">Any callers of
this methods should ensure that they call <i>untie_db()</i>
afterwards.</p>

<p style="margin-left:11%;">untie_db</p>

<p style="margin-left:17%;">public instance () untie_db
()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method unties the database.</p>

<p style="margin-left:11%;">calculate_expire_delta</p>

<p style="margin-left:17%;">public instance (%)
calculate_expire_delta (Integer <tt>$newest_atime</tt>, <br>
Integer <tt>$start</tt>, <br>
Integer <tt>$max_expire_mult</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method performs a calculation on the data to determine
the optimum atime for token expiration.</p>

<p style="margin-left:11%;">token_expiration</p>

<p style="margin-left:17%;">public instance (Integer,
Integer, <br>
Integer, Integer) token_expiration(\% <tt>$opts</tt>, <br>
Integer <tt>$newest_atime</tt>, <br>
Integer <tt>$newdelta</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method performs the database specific expiration of
tokens based on the passed in <tt>$newest_atime</tt> and
<tt>$newdelta</tt>.</p>

<p style="margin-left:11%;">expire_old_tokens</p>

<p style="margin-left:17%;">public instance (Boolean)
expire_old_tokens (\% hashref)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method expires old tokens from the database.</p>

<p style="margin-left:11%;">expire_old_tokens_trapped</p>

<p style="margin-left:17%;">public instance (Boolean)
expire_old_tokens_trapped (\% <tt>$opts</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This methods does the actual token expiration.</p>


<p style="margin-left:17%; margin-top: 1em"><small>XXX</small>
More docs here about the methodology and what not</p>

<p style="margin-left:11%;">sync_due</p>

<p style="margin-left:17%;">public instance (Boolean)
sync_due ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This methods determines if a sync is due.</p>

<p style="margin-left:11%;">expiry_due</p>

<p style="margin-left:17%;">public instance (Boolean)
expiry_due ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This methods determines if an expire is due.</p>

<p style="margin-left:11%;">seen_get</p>

<p style="margin-left:17%;">public instance (Char) seen_get
(String <tt>$msgid</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method retrieves the stored value, if any, for
<tt>$msgid</tt>. The return value is the stored string
(&rsquo;s&rsquo; for spam and &rsquo;h&rsquo; for ham) or
undef if <tt>$msgid</tt> is not found.</p>

<p style="margin-left:11%;">seen_put</p>

<p style="margin-left:17%;">public instance (Boolean)
seen_put (String <tt>$msgid</tt>, Char <tt>$flag</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method records <tt>$msgid</tt> as the type given by
<tt>$flag</tt>. <tt>$flag</tt> is one of two values
&rsquo;s&rsquo; for spam and &rsquo;h&rsquo; for ham.</p>

<p style="margin-left:11%;">seen_delete</p>

<p style="margin-left:17%;">public instance (Boolean)
seen_delete (String <tt>$msgid</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method removes <tt>$msgid</tt> from storage.</p>

<p style="margin-left:11%;">get_storage_variables</p>

<p style="margin-left:17%;">public instance (@)
get_storage_variables ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method retrieves the various administrative variables
used by the Bayes storage implementation.</p>

<p style="margin-left:17%; margin-top: 1em">The values
returned in the array are in the following order:</p>

<p style="margin-left:17%; margin-top: 1em">0: scan count
base</p>

<p style="margin-left:17%; margin-top: 1em">1: number of
spam</p>

<p style="margin-left:17%; margin-top: 1em">2: number of
ham</p>

<p style="margin-left:17%; margin-top: 1em">3: number of
tokens in db</p>

<p style="margin-left:17%; margin-top: 1em">4: last expire
atime</p>

<p style="margin-left:17%; margin-top: 1em">5: oldest token
in db atime</p>

<p style="margin-left:17%; margin-top: 1em">6: db version
value</p>

<p style="margin-left:17%; margin-top: 1em">7: last journal
sync</p>

<p style="margin-left:17%; margin-top: 1em">8: last atime
delta</p>

<p style="margin-left:17%; margin-top: 1em">9: last expire
reduction count</p>

<p style="margin-left:17%; margin-top: 1em">10: newest
token in db atime</p>

<p style="margin-left:11%;">dump_db_toks</p>

<p style="margin-left:17%;">public instance () dump_db_toks
(String <tt>$template</tt>, String <tt>$regex</tt>, @
<tt>@vars</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method loops over all tokens, computing the probability
for the token and then printing it out according to the
passed in template.</p>

<p style="margin-left:11%;">set_last_expire</p>

<p style="margin-left:17%;">public instance (Boolean)
_set_last_expire (Integer <tt>$time</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method sets the last expire time.</p>

<p style="margin-left:11%;">get_running_expire_tok</p>

<p style="margin-left:17%;">public instance (Time)
get_running_expire_tok ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method determines if an expire is currently running and
returns the time the expire started.</p>

<p style="margin-left:11%;">set_running_expire_tok</p>

<p style="margin-left:17%;">public instance (Time)
set_running_expire_tok ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method sets the running expire time to the current
time.</p>

<p style="margin-left:11%;">remove_running_expire_tok</p>

<p style="margin-left:17%;">public instance (Boolean)
remove_running_expire_tok ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method removes a currently set running expire time.</p>

<p style="margin-left:11%;">tok_get</p>

<p style="margin-left:17%;">public instance (Integer,
Integer, Time) tok_get (String <tt>$token</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method retrieves the specified token (<tt>$token</tt>)
from storage and returns it&rsquo;s spam count, ham acount
and last access time.</p>

<p style="margin-left:11%;">tok_get_all</p>

<p style="margin-left:17%;">public instance (\@)
tok_get_all (@ <tt>@tokens</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method retrieves the specified tokens
(<tt>@tokens</tt>) from storage and returns an array ref of
arrays spam count, ham count and last access time.</p>

<p style="margin-left:11%;">tok_count_change</p>

<p style="margin-left:17%;">public instance (Boolean)
tok_count_change (Integer <tt>$spam_count</tt>, <br>
Integer <tt>$ham_count</tt>, <br>
String <tt>$token</tt>, <br>
Time <tt>$atime</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method takes a <tt>$spam_count</tt> and
<tt>$ham_count</tt> and adds it to <tt>$token</tt> along
with updating <tt>$token</tt>s atime with
<tt>$atime</tt>.</p>

<p style="margin-left:11%;">multi_tok_count_change</p>

<p style="margin-left:17%;">public instance (Boolean)
multi_tok_count_change (Integer <tt>$spam_count</tt>, <br>
Integer <tt>$ham_count</tt>, \% <tt>$tokens</tt>, String
<tt>$atime</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method takes a <tt>$spam_count</tt> and
<tt>$ham_count</tt> and adds it to all of the tokens in the
<tt>$tokens</tt> hash ref along with updating each tokens
atime with <tt>$atime</tt>.</p>

<p style="margin-left:11%;">nspam_nham_get</p>

<p style="margin-left:17%;">public instance (Integer,
Integer) nspam_nham_get ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method retrieves the total number of spam and the total
number of ham currently under storage.</p>

<p style="margin-left:11%;">nspam_nham_change</p>

<p style="margin-left:17%;">public instance (Boolean)
nspam_nham_change (Integer <tt>$num_spam</tt>, <br>
Integer <tt>$num_ham</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method updates the number of spam and the number of ham
in the database.</p>

<p style="margin-left:11%;">tok_touch</p>

<p style="margin-left:17%;">public instance (Boolean)
tok_touch (String <tt>$token</tt>, <br>
Time <tt>$atime</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method updates the given tokens (<tt>$token</tt>)
access time.</p>

<p style="margin-left:11%;">tok_touch_all</p>

<p style="margin-left:17%;">public instance (Boolean)
tok_touch_all (\@ <tt>$tokens</tt>, <br>
Time <tt>$atime</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method does a mass update of the given list of tokens
<tt>$tokens</tt>, if the existing token atime is &lt;
<tt>$atime</tt>.</p>

<p style="margin-left:11%;">cleanup</p>

<p style="margin-left:17%;">public instance (Boolean)
cleanup ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method performs any cleanup necessary before moving
onto the next operation.</p>

<p style="margin-left:11%;">get_magic_re</p>

<p style="margin-left:17%;">public instance get_magic_re
(String)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method returns a regexp which indicates a magic
token.</p>

<p style="margin-left:11%;">sync</p>

<p style="margin-left:17%;">public instance (Boolean) sync
(\% <tt>$opts</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method performs a sync of the database.</p>

<p style="margin-left:11%;">perform_upgrade</p>

<p style="margin-left:17%;">public instance (Boolean)
perform_upgrade (\% <tt>$opts</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method is a utility method that performs any necessary
upgrades between versions. It should know how to handle
previous versions and what needs to happen to upgrade
them.</p>

<p style="margin-left:17%; margin-top: 1em">A true return
value indicates success.</p>

<p style="margin-left:11%;">clear_database</p>

<p style="margin-left:17%;">public instance (Boolean)
clear_database ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method deletes all records for a particular user.</p>

<p style="margin-left:17%; margin-top: 1em">Callers should
be aware that any errors returned by this method could
causes the database to be inconsistent for the given
user.</p>

<p style="margin-left:11%;">backup_database</p>

<p style="margin-left:17%;">public instance (Boolean)
backup_database ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method will dump the users database in a machine
readable format.</p>

<p style="margin-left:11%;">restore_database</p>

<p style="margin-left:17%;">public instance (Boolean)
restore_database (String <tt>$filename</tt>, Boolean
<tt>$showdots</tt>)</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method restores a database from the given filename,
<tt>$filename</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">Callers should
be aware that any errors returned by this method could
causes the database to be inconsistent for the given
user.</p>

<p style="margin-left:11%;">db_readable</p>

<p style="margin-left:17%;">public instance (Boolean)
db_readable ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method returns whether or not the Bayes
<small>DB</small> is available in a readable state.</p>

<p style="margin-left:11%;">db_writable</p>

<p style="margin-left:17%;">public instance (Boolean)
db_writable ()</p>

<p style="margin-left:17%; margin-top: 1em">Description:
This method returns whether or not the Bayes
<small>DB</small> is available in a writable state.</p>
<hr>
</body>
</html>
