<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 02:34:32 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>TRACE&minus;CMD.DAT</title>

</head>
<body>

<h1 align="center">TRACE&minus;CMD.DAT</h1>

<a href="#NAME">NAME</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#INITIAL FORMAT">INITIAL FORMAT</a><br>
<a href="#HEADER INFO FORMAT">HEADER INFO FORMAT</a><br>
<a href="#FTRACE EVENT FORMATS">FTRACE EVENT FORMATS</a><br>
<a href="#EVENT FORMATS">EVENT FORMATS</a><br>
<a href="#KALLSYMS INFORMATION">KALLSYMS INFORMATION</a><br>
<a href="#TRACE_PRINTK INFORMATION">TRACE_PRINTK INFORMATION</a><br>
<a href="#PROCESS INFORMATION">PROCESS INFORMATION</a><br>
<a href="#REST OF TRACE-CMD HEADER">REST OF TRACE-CMD HEADER</a><br>
<a href="#CPU DATA">CPU DATA</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#AUTHOR">AUTHOR</a><br>
<a href="#RESOURCES">RESOURCES</a><br>
<a href="#COPYING">COPYING</a><br>
<a href="#NOTES">NOTES</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">trace-cmd.dat
&minus; trace&minus;cmd file format</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
trace&minus;cmd(1) utility produces a &quot;trace.dat&quot;
file. The file may also be named anything depending if the
user specifies a different output name, but it must have a
certain binary format. The file is used by trace&minus;cmd
to save kernel traces into it and be able to extract the
trace from it at a later point (see
<b>trace&minus;cmd&minus;report(1)</b>).</p>

<h2>INITIAL FORMAT
<a name="INITIAL FORMAT"></a>
</h2>


<p style="margin-left:17%; margin-top: 1em">The first three
bytes contain the magic value:</p>

<p style="margin-left:17%; margin-top: 1em">0x17 0x08
0x44</p>

<p style="margin-left:17%; margin-top: 1em">The next 7
bytes contain the characters:</p>


<p style="margin-left:17%; margin-top: 1em">&quot;tracing&quot;</p>

<p style="margin-left:17%; margin-top: 1em">The next set of
characters contain a null '\0' terminated string <br>
that contains the version of the file (for example):</p>


<p style="margin-left:17%; margin-top: 1em">&quot;6\0&quot;</p>

<p style="margin-left:17%; margin-top: 1em">The next 1 byte
contains the flags for the file endianess:</p>

<p style="margin-left:17%; margin-top: 1em">0 = little
endian <br>
1 = big endian</p>

<p style="margin-left:17%; margin-top: 1em">The next byte
contains the number of bytes per &quot;long&quot; value:</p>

<p style="margin-left:17%; margin-top: 1em">4 &minus;
32&minus;bit long values <br>
8 &minus; 64&minus;bit long values</p>

<p style="margin-left:17%; margin-top: 1em">Note: This is
the long size of the target's userspace. Not the <br>
kernel space size.</p>

<p style="margin-left:17%; margin-top: 1em">[ Now all
numbers are written in file defined endianess. ]</p>

<p style="margin-left:17%; margin-top: 1em">The next 4
bytes are a 32&minus;bit word that defines what the traced
<br>
host machine page size was.</p>

<h2>HEADER INFO FORMAT
<a name="HEADER INFO FORMAT"></a>
</h2>


<p style="margin-left:17%; margin-top: 1em">Directly after
the initial format comes information about the <br>
trace headers recorded from the target box.</p>

<p style="margin-left:17%; margin-top: 1em">The next 12
bytes contain the string:</p>


<p style="margin-left:17%; margin-top: 1em">&quot;header_page\0&quot;</p>

<p style="margin-left:17%; margin-top: 1em">The next 8
bytes are a 64&minus;bit word containing the size of the
<br>
page header information stored next.</p>

<p style="margin-left:17%; margin-top: 1em">The next set of
data is of the size read from the previous 8 bytes, <br>
and contains the data retrieved from
debugfs/tracing/events/header_page.</p>

<p style="margin-left:17%; margin-top: 1em">Note: The size
of the second field \fBcommit\fR contains the target <br>
kernel long size. For example:</p>

<p style="margin-left:17%; margin-top: 1em">field: local_t
commit; offset:8; \fBsize:8;\fR signed:1;</p>

<p style="margin-left:17%; margin-top: 1em">shows the
kernel has a 64&minus;bit long.</p>

<p style="margin-left:17%; margin-top: 1em">The next 13
bytes contain the string:</p>


<p style="margin-left:17%; margin-top: 1em">&quot;header_event\0&quot;</p>

<p style="margin-left:17%; margin-top: 1em">The next 8
bytes are a 64&minus;bit word containing the size of the
<br>
event header information stored next.</p>

<p style="margin-left:17%; margin-top: 1em">The next set of
data is of the size read from the previous 8 bytes <br>
and contains the data retrieved from
debugfs/tracing/events/header_event.</p>

<p style="margin-left:17%; margin-top: 1em">This data
allows the trace&minus;cmd tool to know if the ring buffer
format <br>
of the kernel made any changes.</p>

<h2>FTRACE EVENT FORMATS
<a name="FTRACE EVENT FORMATS"></a>
</h2>


<p style="margin-left:17%; margin-top: 1em">Directly after
the header information comes the information about <br>
the Ftrace specific events. These are the events used by the
Ftrace plugins <br>
and are not enabled by the event tracing.</p>

<p style="margin-left:17%; margin-top: 1em">The next 4
bytes contain a 32&minus;bit word of the number of Ftrace
event <br>
format files that are stored in the file.</p>

<p style="margin-left:17%; margin-top: 1em">For the number
of times defined by the previous 4 bytes is the <br>
following:</p>

<p style="margin-left:17%; margin-top: 1em">8 bytes for the
size of the Ftrace event format file.</p>

<p style="margin-left:17%; margin-top: 1em">The Ftrace
event format file copied from the target machine: <br>
debugfs/tracing/events/ftrace/&lt;event&gt;/format</p>

<h2>EVENT FORMATS
<a name="EVENT FORMATS"></a>
</h2>


<p style="margin-left:17%; margin-top: 1em">Directly after
the Ftrace formats comes the information about <br>
the event layout.</p>

<p style="margin-left:17%; margin-top: 1em">The next 4
bytes are a 32&minus;bit word containing the number of <br>
event systems that are stored in the file. These are the
<br>
directories in debugfs/tracing/events excluding the
\fBftrace\fR <br>
directory.</p>

<p style="margin-left:17%; margin-top: 1em">For the number
of times defined by the previous 4 bytes is the <br>
following:</p>

<p style="margin-left:17%; margin-top: 1em">A
null&minus;terminated string containing the system name.</p>

<p style="margin-left:17%; margin-top: 1em">4 bytes
containing a 32&minus;bit word containing the number <br>
of events within the system.</p>

<p style="margin-left:17%; margin-top: 1em">For the number
of times defined in the previous 4 bytes is the <br>
following:</p>

<p style="margin-left:17%; margin-top: 1em">8 bytes for the
size of the event format file.</p>

<p style="margin-left:17%; margin-top: 1em">The event
format file copied from the target machine: <br>

debugfs/tracing/events/&lt;system&gt;/&lt;event&gt;/format</p>

<h2>KALLSYMS INFORMATION
<a name="KALLSYMS INFORMATION"></a>
</h2>


<p style="margin-left:17%; margin-top: 1em">Directly after
the event formats comes the information of the mapping <br>
of function addresses to the function names.</p>

<p style="margin-left:17%; margin-top: 1em">The next 4
bytes are a 32&minus;bit word containing the size of the
<br>
data holding the function mappings.</p>

<p style="margin-left:17%; margin-top: 1em">The next set of
data is of the size defined by the previous 4 bytes <br>
and contains the information from the target machine's file:
<br>
/proc/kallsyms</p>

<h2>TRACE_PRINTK INFORMATION
<a name="TRACE_PRINTK INFORMATION"></a>
</h2>


<p style="margin-left:17%; margin-top: 1em">If a developer
used trace_printk() within the kernel, it may <br>
store the format string outside the ring buffer. <br>
This information can be found in: <br>
debugfs/tracing/printk_formats</p>

<p style="margin-left:17%; margin-top: 1em">The next 4
bytes are a 32&minus;bit word containing the size of the
<br>
data holding the printk formats.</p>

<p style="margin-left:17%; margin-top: 1em">The next set of
data is of the size defined by the previous 4 bytes <br>
and contains the information from
debugfs/tracing/printk_formats.</p>

<h2>PROCESS INFORMATION
<a name="PROCESS INFORMATION"></a>
</h2>


<p style="margin-left:17%; margin-top: 1em">Directly after
the trace_printk formats comes the information mapping <br>
a PID to a process name.</p>

<p style="margin-left:17%; margin-top: 1em">The next 8
bytes contain a 64&minus;bit word that holds the size of the
<br>
data mapping the PID to a process name.</p>

<p style="margin-left:17%; margin-top: 1em">The next set of
data is of the size defined by the previous 8 bytes <br>
and contains the information from
debugfs/tracing/saved_cmdlines.</p>

<h2>REST OF TRACE-CMD HEADER
<a name="REST OF TRACE-CMD HEADER"></a>
</h2>


<p style="margin-left:17%; margin-top: 1em">Directly after
the process information comes the last bit of the <br>
trace.dat file header.</p>

<p style="margin-left:17%; margin-top: 1em">The next 4
bytes are a 32&minus;bit word defining the number of CPUs
that <br>
were discovered on the target machine (and has matching
trace data <br>
for it).</p>

<p style="margin-left:17%; margin-top: 1em">The next 10
bytes are one of the following:</p>

<p style="margin-left:17%; margin-top: 1em">&quot;options
\0&quot;</p>

<p style="margin-left:17%; margin-top: 1em">&quot;latency
\0&quot;</p>


<p style="margin-left:17%; margin-top: 1em">&quot;flyrecord\0&quot;</p>

<p style="margin-left:17%; margin-top: 1em">If it is
&quot;options \0&quot; then:</p>

<p style="margin-left:17%; margin-top: 1em">The next 2
bytes are a 16&minus;bit word defining the current option.
<br>
If the the value is zero then there are no more options.</p>

<p style="margin-left:17%; margin-top: 1em">Otherwise, the
next 4 bytes contain a 32&minus;bit word containing the <br>
option size. If the reader does not know how to handle the
option <br>
it can simply skip it. Currently there are no options
defined, <br>
but this is here to extend the data.</p>

<p style="margin-left:17%; margin-top: 1em">The next option
will be directly after the previous option, and <br>
the options ends with a zero in the option type field.</p>

<p style="margin-left:17%; margin-top: 1em">The next 10
bytes after the options are one of the following:</p>

<p style="margin-left:17%; margin-top: 1em">&quot;latency
\0&quot;</p>


<p style="margin-left:17%; margin-top: 1em">&quot;flyrecord\0&quot;</p>

<p style="margin-left:17%; margin-top: 1em">which would
follow the same as if options were not present.</p>

<p style="margin-left:17%; margin-top: 1em">If the value is
&quot;latency \0&quot;, then the rest of the file is <br>
simply ASCII text that was taken from the target's: <br>
debugfs/tracing/trace</p>

<p style="margin-left:17%; margin-top: 1em">If the value is
&quot;flyrecord\0&quot;, the following is present:</p>

<p style="margin-left:17%; margin-top: 1em">For the number
of CPUs that were read earlier, the <br>
following is present:</p>

<p style="margin-left:17%; margin-top: 1em">8 bytes that
are a 64&minus;bit word containing the offset into the file
<br>
that holds the data for the CPU.</p>

<p style="margin-left:17%; margin-top: 1em">8 bytes that
are a 64&minus;bit word containing the size of the CPU <br>
data at that offset.</p>

<h2>CPU DATA
<a name="CPU DATA"></a>
</h2>


<p style="margin-left:17%; margin-top: 1em">The CPU data is
located in the part of the file that is specified <br>
in the end of the header. Padding is placed between the
header and <br>
the CPU data, placing the CPU data at a page aligned (target
page) position <br>
in the file.</p>

<p style="margin-left:17%; margin-top: 1em">This data is
copied directly from the Ftrace ring buffer and is of the
<br>
same format as the ring buffer specified by the event header
files <br>
loaded in the header format file.</p>

<p style="margin-left:17%; margin-top: 1em">The
trace&minus;cmd tool will try to \fBmmap(2)\fR the data page
by page with the <br>
target's page size if possible. If it fails to mmap, it will
just read the <br>
data instead.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">trace&minus;cmd(1),
trace&minus;cmd&minus;record(1),
trace&minus;cmd&minus;report(1),
trace&minus;cmd&minus;start(1),
trace&minus;cmd&minus;stop(1),
trace&minus;cmd&minus;extract(1),
trace&minus;cmd&minus;reset(1),
trace&minus;cmd&minus;split(1),
trace&minus;cmd&minus;list(1),
trace&minus;cmd&minus;listen(1), trace&minus;cmd.dat(5)</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Written by
Steven Rostedt,
&lt;<b><font color="#0000FF">rostedt@goodmis.org</font></b>
<small><font color="#000000">[1]</font></small>
<font color="#000000">&gt;</font></p>

<h2>RESOURCES
<a name="RESOURCES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><font color="#000000">git://git.kernel.org/pub/scm/linux/kernel/git/rostedt/trace&minus;cmd.git</font></p>

<h2>COPYING
<a name="COPYING"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><font color="#000000">Copyright
(C) 2010 Red Hat, Inc. Free use of this software is granted
under the terms of the GNU Public License (GPL).</font></p>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="12%"></td>
<td width="3%">



<p style="margin-top: 1em"><font color="#000000">1.</font></p> </td>
<td width="2%"></td>
<td width="29%">



<p style="margin-top: 1em"><font color="#000000">rostedt@goodmis.org</font></p> </td>
<td width="54%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">mailto:rostedt@goodmis.org</font></p>
<hr>
</body>
</html>
