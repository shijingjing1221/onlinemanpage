<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 02:02:52 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>ntp-keygen</title>

</head>
<body>

<h1 align="center">ntp-keygen</h1>

<a href="#NAME">NAME</a><br>
<a href="#&nbsp;">&nbsp;</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#RUNNING THE PROGRAM">RUNNING THE PROGRAM</a><br>
<a href="#TRUSTED HOSTS AND SECURE GROUPS">TRUSTED HOSTS AND SECURE GROUPS</a><br>
<a href="#IDENTITY SCHEMES">IDENTITY SCHEMES</a><br>
<a href="#COMMAND LINE OPTIONS">COMMAND LINE OPTIONS</a><br>
<a href="#RANDOM SEED FILE">RANDOM SEED FILE</a><br>
<a href="#CRYPTOGRAPHIC DATA FILES">CRYPTOGRAPHIC DATA FILES</a><br>
<a href="#BUGS">BUGS</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">ntp-keygen -
generate public and private keys</p>

<h2>&nbsp;
<a name="&nbsp;"></a>
</h2>


<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>ntp-keygen [
-deGHIMPT ] [ -b</b> <i>modulus</i> <b>] [ -c [RSA-MD2 |
RSA-MD5 | RSA-SHA | RSA-SHA1 | RSA-MDC2 | RSA-RIPEMD160 |
DSA-SHA | DSA-SHA1 ] ] [ -C</b> <i>cipher</i> <b>] [ -i</b>
<i>group</i> <b>] [ -m</b> <i>modulus</i> <b>] [ -p</b>
<i>passwd2</i> <b>] [ -q</b> <i>passwd1</i> <b>] [ -S [ RSA
| DSA ] ] [ -s</b> <i>host</i> <b>] [ -V</b> <i>nkeys</i>
<b>]</b></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This program
generates cryptographic data files used by the NTPv4
authentication and identity schemes. It can generate message
digest keys used in symmetric key cryptography and, if the
OpenSSL software library has been installed, it can generate
host keys, sign keys, certificates and identity keys used by
the Autokey public key cryptography. The message digest keys
file is generated in a format compatible with NTPv3. All
other files are in PEM-encoded printable ASCII format so
they can be embedded as MIME attachments in mail to other
sites.</p>

<p style="margin-left:11%; margin-top: 1em">When used to
generate message digest keys, the program produces a file
containing ten pseudo-random printable ASCII strings
suitable for the MD5 message digest algorithm included in
the distribution. If the OpenSSL library is installed, it
produces an additional ten hex-encoded random bit strings
suitable for the SHA1 and other message digest algorithms.
Printable ASCII keys can have length from one to 20
characters, inclusive. Bit string keys have length 20 octets
(40 hex characters). All keys are 160 bits in length.</p>

<p style="margin-left:11%; margin-top: 1em">The file can be
edited later with purpose-chosen passwords for the
<b>ntpq</b> and <b>ntpdc</b> programs. Each line of the file
contains three fields, first an integer between 1 and 65534,
inclusive, representing the key identifier used in the
<b>server</b> and <b>peer</b> configuration commands. Next
is the key type for the message digest algorithm, which in
the absence of the OpenSSL library should be the string
<b>MD5</b> to designate the MD5 message digest algorithm. If
the OpenSSL library is installed, the key type can be any
message digest algorithm supported by that library. However,
if compatibility with FIPS 140-2 is required, the key type
must be either <b>SHA</b> or <b>SHA1</b>.Finally is the key
itself as a printable ASCII string excluding the space and #
characters. If not greater than 20 characters in length, the
string is the key itself; otherwise, it is interpreted as a
hex-encoded bit string. As is custom, # and the remaining
characters on the line are ignored. Later, this file can be
edited to include the passwords for the <b>ntpq</b> and
<b>ntpdc</b> utilities. If this is the only need, run
<b>ntp-keygen</b> with the <b>-M</b> option and disregard
the remainder of this page.</p>

<p style="margin-left:11%; margin-top: 1em">The remaining
generated files are compatible with other OpenSSL
applications and other Public Key Infrastructure (PKI)
resources. Certificates generated by this program should be
compatible with extant industry practice, although some
users might find the interpretation of X509v3 extension
fields somewhat liberal. However, the identity keys are
probably not compatible with anything other than
Autokey.</p>

<p style="margin-left:11%; margin-top: 1em">Most files used
by this program are encrypted using a private password. The
<b>-p</b> option specifies the password for local files and
the <b>-q</b> option the password for files sent to remote
sites. If no local password is specified, the host name
returned by the Unix <b>gethostname()</b> function, normally
the DNS name of the host, is used. If no remote password is
specified, the local password is used.</p>

<p style="margin-left:11%; margin-top: 1em">The <b>pw</b>
option of the <b>crypto</b> configuration command specifies
the read password for previously encrypted files. This must
match the local password used by this program. If not
specified, the host name is used. Thus, if files are
generated by this program without password, they can be read
back by <b>ntpd</b> without password, but only on the same
host.</p>

<p style="margin-left:11%; margin-top: 1em">All files and
links are usually installed in the directory
<b>/usr/local/etc</b>, which is normally in a shared
filesystem in NFS-mounted networks and cannot be changed by
shared clients. The location of the keys directory can be
changed by the <b>keysdir</b> configuration command in such
cases. Normally, encrypted files for each host are generated
by that host and used only by that host, although exceptions
exist as noted later on this page.</p>

<p style="margin-left:11%; margin-top: 1em">This program
directs commentary and error messages to the standard error
stream <b>stderr</b> and remote files to the standard output
stream <b>stdout</b> where they can be piped to other
applications or redirected to a file. The names used for
generated files and links all begin with the string
<b>ntpkey</b> and include the file type, generating host and
filestamp, as described in the Cryptographic Data Files
section below</p>

<h2>RUNNING THE PROGRAM
<a name="RUNNING THE PROGRAM"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">To test and
gain experience with Autokey concepts, log in as root and
change to the keys directory, usually <b>/usr/local/etc</b>.
When run for the first time, or if all files with names
beginning <b>ntpkey</b> have been removed, use the
<b>ntp-keygen</b> command without arguments to generate a
default RSA host key and matching RSA-MD5 certificate with
expiration date one year hence. If run again, the program
uses the existing keys and parameters and generates only a
new certificate with new expiration date one year hence;
however, the certificate is not generated if the <b>-e</b>
or <b>-q</b> options are present.</p>

<p style="margin-left:11%; margin-top: 1em">Run the command
on as many hosts as necessary. Designate one of them as the
trusted host (TH) using <b>ntp-keygen</b> with the <b>-T</b>
option and configure it to synchronize from reliable
Internet servers. Then configure the other hosts to
synchronize to the TH directly or indirectly. A certificate
trail is created when Autokey asks the immediately ascendant
host towards the TH to sign its certificate, which is then
provided to the immediately descendant host on request. All
group hosts should have acyclic certificate trails ending on
the TH.</p>

<p style="margin-left:11%; margin-top: 1em">The host key is
used to encrypt the cookie when required and so must be RSA
type. By default, the host key is also the sign key used to
encrypt signatures. A different sign key can be assigned
using the <b>-S</b> option and this can be either RSA or DSA
type. By default, the signature message digest type is MD5,
but any combination of sign key type and sign digest type
supported by the OpenSSL library can be specified using the
<b>-c</b> option. At the moment, legacy considerations
require the NTP packet header digest type to be MD5.</p>

<h2>TRUSTED HOSTS AND SECURE GROUPS
<a name="TRUSTED HOSTS AND SECURE GROUPS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">As described on
the Authentication Options page, an NTP secure group
consists of one or more low-stratum THs as the root from
which all other group hosts derive synchronization directly
or indirectly. For authentication purposes all hosts in a
group must have the same group name specified by the
<b>-i</b> option and matching the <b>ident</b> option of the
<b>crypto</b> configuration command. The group name is used
in the subject and issuer fields of trusted, self-signed
certificates and when constructing the file names for
identity keys. All hosts must have different host names,
either the default host name or as specified by the
<b>-s</b> option and matching the <b>host</b> option of the
<b>crypto</b> configuration command. Most installations need
not specify the <b>-i</b> option nor the <b>host</b> option.
Host names are used in the subject and issuer fields of
self-signed, nontrusted certificates and when constructing
the file names for host and sign keys and certificates. Host
and group names are used only for authentication purposes
and have nothing to do with DNS names.</p>

<h2>IDENTITY SCHEMES
<a name="IDENTITY SCHEMES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">As described on
the Authentication Options page, there are five identity
schemes, three of which - IFF, GQ and MV - require identity
keys specific to each scheme. There are two types of files
for each scheme, an encrypted keys file and a nonencrypted
parameters file, which usually contains a subset of the keys
file. In general, NTP secondary servers operating as
certificate signing authorities (CSA) use the keys file and
clients use the parameters file. Both files are generated by
the TA operating as a certificate authority (CA) on behalf
of all servers and clients in the group.</p>

<p style="margin-left:11%; margin-top: 1em">The parameters
files are public; they can be stored in a public place and
sent in the clear. The keys files are encrypted with the
local password. To retrieve the keys file, a host can send a
mail request to the TA including its local password. The TA
encrypts the keys file with this password and returns it as
an attachment. The attachment is then copied intact to the
keys directory with name given in the first line of the
file, but all in lower case and with the filestamp deleted.
Alternatively, the parameters file can be retrieved from a
secure web site.</p>

<p style="margin-left:11%; margin-top: 1em">For example,
the TA generates default host key, IFF keys and trusted
certificate using the command</p>

<p style="margin-left:11%; margin-top: 1em"><b>ntp-keygen
-p</b> <i>local_passwd</i> <b>-T -I
-i</b><i>group_name</i></p>

<p style="margin-left:11%; margin-top: 1em">Each group host
generates default host keys and nontrusted certificate use
the same command line but omitting the <b>-i</b> option.
Once these media have been generated, the TA can then
generate the public parameters using the command</p>

<p style="margin-left:11%; margin-top: 1em"><b>ntp-keygen
-p local_passwd -e &gt;</b><i>parameters_file</i></p>

<p style="margin-left:11%; margin-top: 1em">where the
<b>-e</b> option redirects the unencrypted parameters to the
standard output stream for a mail application or stored
locally for later distribution. In a similar fashion the
<b>-q</b> option redirects the encrypted server keys to the
standard output stream.</p>

<h2>COMMAND LINE OPTIONS
<a name="COMMAND LINE OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>-b</b>
<i>modulus</i></p>

<p style="margin-left:23%;">Set the modulus for generating
identity keys to <i>modulus</i> bits. The modulus defaults
to 256, but can be set from 256 (32 octets) to 2048 (256
octets). Use the larger moduli with caution, as this can
consume considerable computing resources and increases the
size of authenticated packets.</p>

<p style="margin-left:11%;"><b>-c [ RSA-MD2 | RSA-MD5 |
RSA-SHA | RSA-SHA1 | RSA-MDC2 | RSA-RIPEMD160 <br>
| DSA-SHA | DSA-SHA1 ]</b></p>

<p style="margin-left:23%;">Select certificate and message
digest/signature encryption scheme. Note that RSA schemes
must be used with a RSA sign key and DSA schemes must be
used with a DSA sign key. The default without this option is
<b>RSA-MD5</b>. If compatibility with FIPS 140-2 is
required, either the <b>DSA-SHA</b> or <b>DSA-SHA1</b>
scheme must be used.</p>

<p style="margin-left:11%;"><b>-C</b> <i>cipher</i></p>

<p style="margin-left:23%;">Select the cipher which is used
to encrypt the files containing private keys. The default is
three-key triple DES in CBC mode, equivalent to &quot;-C
des-ede3-cbc&quot;. The openssl tool lists ciphers available
in &quot;openssl -h&quot; output.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-d</b></p></td>
<td width="9%"></td>
<td width="77%">


<p>Enable debugging. This option displays the cryptographic
data produced for eye-friendly billboards.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-e</b></p></td>
<td width="9%"></td>
<td width="77%">


<p>Extract the IFF or GQ public parameters from the
<b>IFFkey</b> or <b>GQkey</b> keys file previously
specified. Send the unencrypted data to the standard output
stream <b>stdout</b>. While the IFF parameters do not reveal
the private group key, the GQ parameters should be used with
caution, as they include the group key. Use the <b>-q</b>
option with password instead. Note: a new certificate is not
generated when this option is present. This allows multiple
commands with this option but without disturbing existing
media.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-G</b></p></td>
<td width="9%"></td>
<td width="77%">


<p>Generate a new encrypted GQ key file and link for the
Guillou-Quisquater (GQ) identity scheme.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-H</b></p></td>
<td width="9%"></td>
<td width="77%">


<p>Generate a new encrypted RSA public/private host key
file and link. Note that if the sign key is the same as the
host key, generating a new host key invalidates all
certificates signed with the old host key.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>-i</b> <i>group</i></p>

<p style="margin-left:23%;">Set the group name to
<i>group</i>. This is used in the identity file names. It
must match the group name specified in the <b>ident</b>
option of the <b>crypto</b> configuration command.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-I</b></p></td>
<td width="9%"></td>
<td width="77%">


<p>Generate a new encrypted IFF key file and link for the
Schnorr (IFF) identity scheme.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>-m</b> <i>modulus</i></p>

<p style="margin-left:23%;">Set the modulus for generating
files to <i>modulus</i> bits. The modulus defaults to 512,
but can be set from 256 (32 octets) to 2048 (256
octets).</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-M</b></p></td>
<td width="9%"></td>
<td width="77%">


<p>Generate a new MD5 key file containing 16, 128-bit
pseudo-random keys for symmetric cryptography..</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>-P</b></p></td>
<td width="9%"></td>
<td width="77%">


<p>Generate a new private certificate used by the PC
identity scheme. By default, the program generates public
certificates. Note: the PC identity scheme is not
recommended for new installations.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>-p</b> <i>passwd</i></p>

<p style="margin-left:23%;">Set the password for reading
and writing encrypted files to <i>passwd</i>. By default,
the password is the host name.</p>

<p style="margin-left:11%;"><b>-q</b> <i>passwd</i></p>

<p style="margin-left:23%;">Extract the encrypted IFF or GQ
server keys from the <b>IFFkey</b> or <b>GQkey</b> key file
previously generated. The data are sent to the standard
output stream <b>stdout</b>. Set the password for writing
the data, which is also the password to read the data file
in another host. By default, the password is the host name.
Note: a new certificate is not generated when this option is
present. This allows multiple commands with this option but
without disturbing existing media.</p>

<p style="margin-left:11%;"><b>-S [ RSA | DSA ]</b></p>

<p style="margin-left:23%;">Generate a new sign key of the
specified type. By default, the sign key is the host key and
has the same type. If compatibly with FIPS 140-2 is
required, the sign key type must be <b>DSA</b>. Note that
generating a new sign key invalidates all certificates
signed with the old sign key.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="11%">


<p><b>-s</b> <i>host</i></p></td>
<td width="1%"></td>
<td width="77%">


<p>Set the host name to <i>host</i>. This is used in the
host and sign key file names. It must match the host name
specified in the <b>host</b> option of the <b>crypto</b>
configuration command.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="11%">


<p><b>-T</b></p></td>
<td width="1%"></td>
<td width="77%">


<p>Generate a trusted certificate. By default, the program
generates nontrusted certificates.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>-V</b> <i>nkeys</i></p>

<p style="margin-left:23%;">Generate server parameters
<b>MV</b> and <i>nkeys</i> client keys for the
Mu-Varadharajan (MV) identity scheme. Note: support for this
option should be considered a work in progress.</p>

<h2>RANDOM SEED FILE
<a name="RANDOM SEED FILE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">All
cryptographically sound key generation schemes must have
means to randomize the entropy seed used to initialize the
internal pseudo-random number generator used by the OpenSSL
library routines. If a site supports <b>ssh</b>, it is very
likely that means to do this are already available. The
entropy seed used by the OpenSSL library is contained in a
file, usually called <b>.rnd</b>, which must be available
when starting the <b>ntp-keygen</b> program or <b>ntpd</b>
daemon.</p>

<p style="margin-left:11%; margin-top: 1em">The OpenSSL
library looks for the file using the path specified by the
<b>RANDFILE</b> environment variable in the user home
directory, whether root or some other user. If the
<b>RANDFILE</b> environment variable is not present, the
library looks for the <b>.rnd</b> file in the user home
directory. Since both the <b>ntp-keygen</b> program and
<b>ntpd</b> daemon must run as root, the logical place to
put this file is in <b>/.rnd</b> or <b>/root/.rnd</b>. If
the file is not available or cannot be written, the program
exits with a message to the system log.</p>

<h2>CRYPTOGRAPHIC DATA FILES
<a name="CRYPTOGRAPHIC DATA FILES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">File and link
names are in the form
<b>ntpkey_</b><i>key</i><b>_</b><i>name</i><b>.</b><i>fstamp</i>,
where <i>key</i> is the key or parameter type, <i>name</i>
is the host or group name and <i>fstamp</i> is the filestamp
(NTP seconds) when the file was created). By convention, key
fields in generated file names include both upper and lower
case alphanumeric characters, while key fields in generated
link names include only lower case characters. The filestamp
is not used in generated link names.</p>

<p style="margin-left:11%; margin-top: 1em">The key type is
a string defining the cryptographic function. Key types
include public/private keys <b>host</b> and <b>sign</b>,
certificate <b>cert</b> and several challenge/response key
types. By convention, files used for challenges have a
<b>par</b> subtype, as in the IFF challenge <b>IFFpar</b>,
while files for responses have a <b>key</b> subtype, as in
the GQ response <b>GQkey</b>.</p>

<p style="margin-left:11%; margin-top: 1em">All files begin
with two nonencrypted lines. The first line contains the
file name in the format
<b>ntpkey_</b><i>key</i><b>_</b><i>host</i><b>.</b><i>fstamp</i>.
The second line contains the datestamp in conventional Unix
<b>date</b> format. Lines beginning with <b>#</b> are
ignored.</p>

<p style="margin-left:11%; margin-top: 1em">The remainder
of the file contains cryptographic data encoded first using
ASN.1 rules, then encrypted using the cipher selected with
<b>-C</b> and given password and finally written in
PEM-encoded printable ASCII text preceded and followed by
MIME content identifier lines.</p>

<p style="margin-left:11%; margin-top: 1em">The format of
the symmetric keys file is somewhat different than the other
files in the interest of backward compatibility. Since
DES-CBC is deprecated in NTPv4, the only key format of
interest is MD5 alphanumeric strings. Following the header
the keys are entered one per line in the format</p>

<p style="margin-left:11%; margin-top: 1em"><b>keyno type
key</b></p>

<p style="margin-left:11%; margin-top: 1em">where
<b>keyno</b> is a positive integer in the range 1-65,535,
<b>type</b> is the string <b>MD5</b> defining the key format
and <b>key</b> is the key itself, which is a printable ASCII
string 16 characters or less in length. Each character is
chosen from the 93 printable characters in the range 0x21
through 0x7f excluding space and the &rsquo;#&rsquo;
character.</p>

<p style="margin-left:11%; margin-top: 1em">Note that the
keys used by the <b>ntpq</b> and <b>ntpdc</b> programs are
checked against passwords requested by the programs and
entered by hand, so it is generally appropriate to specify
these keys in human readable ASCII format.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>ntp-keygen</b> program generates a MD5 symmetric keys
file <b>ntpkey_MD5key_</b><i>hostname.filestamp</i>. Since
the file contains private shared keys, it should be visible
only to root and distributed by secure means to other subnet
hosts. The NTP daemon loads the file <b>ntp.keys</b>, so
<b>ntp-keygen</b> installs a soft link from this name to the
generated file. Subsequently, similar soft links must be
installed by manual or automated means on the other subnet
hosts. While this file is not used with the Autokey Version
2 protocol, it is needed to authenticate some remote
configuration commands used by the <b>ntpq</b> and
<b>ntpdc</b> utilities.</p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">It can take
quite a while to generate some cryptographic values, from
one to several minutes with modern architectures such as
UltraSPARC and up to tens of minutes to an hour with older
architectures such as SPARC IPC.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">ntpd(8),
ntp_auth(5)</p>

<p style="margin-left:11%; margin-top: 1em">The official
HTML documentation.</p>

<p style="margin-left:11%; margin-top: 1em">This file was
automatically generated from HTML source.</p>
<hr>
</body>
</html>
