<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 02:37:14 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>virt-builder</title>

</head>
<body>

<h1 align="center">virt-builder</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#REFERENCE">REFERENCE</a><br>
<a href="#MACHINE READABLE OUTPUT">MACHINE READABLE OUTPUT</a><br>
<a href="#ENVIRONMENT VARIABLES">ENVIRONMENT VARIABLES</a><br>
<a href="#EXIT STATUS">EXIT STATUS</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#AUTHOR">AUTHOR</a><br>
<a href="#COPYRIGHT">COPYRIGHT</a><br>
<a href="#LICENSE">LICENSE</a><br>
<a href="#BUGS">BUGS</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">virt&minus;builder
&minus; Build virtual machine images quickly</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder os&minus;version
    [&minus;o|&minus;&minus;output DISKIMAGE] [&minus;&minus;size SIZE] [&minus;&minus;format raw|qcow2]
    [&minus;&minus;arch ARCHITECTURE] [&minus;&minus;attach ISOFILE]
    [&minus;&minus;chmod PERMISSIONS:FILE] [&minus;&minus;delete PATH] [&minus;&minus;edit FILE:EXPR]
    [&minus;&minus;firstboot SCRIPT] [&minus;&minus;firstboot&minus;command 'CMD+ARGS']
    [&minus;&minus;firstboot&minus;install PKG,PKG..] [&minus;&minus;hostname HOSTNAME]
    [&minus;&minus;install PKG,PKG..] [&minus;&minus;link TARGET:LINK[:LINK..]] [&minus;&minus;mkdir DIR]
    [&minus;&minus;password USER:SELECTOR] [&minus;&minus;root&minus;password SELECTOR]
    [&minus;&minus;run SCRIPT] [&minus;&minus;run&minus;command 'CMD+ARGS'] [&minus;&minus;scrub FILE]
    [&minus;&minus;timezone TIMEZONE] [&minus;&minus;update] [&minus;&minus;upload FILE:DEST]
    [&minus;&minus;write FILE:CONTENT] [&minus;&minus;no&minus;logfile]
    [&minus;&minus;password&minus;crypto md5|sha256|sha512] [&minus;&minus;selinux&minus;relabel]
 virt&minus;builder &minus;l|&minus;&minus;list [&minus;&minus;long] [&minus;&minus;list&minus;format short|long|json]
 virt&minus;builder &minus;&minus;notes os&minus;version
 virt&minus;builder &minus;&minus;print&minus;cache
 virt&minus;builder &minus;&minus;cache&minus;all&minus;templates
 virt&minus;builder &minus;&minus;delete&minus;cache
 virt&minus;builder &minus;&minus;get&minus;kernel DISKIMAGE
    [&minus;&minus;format raw|qcow2] [&minus;&minus;output OUTPUTDIR]</pre>


<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Virt-builder is
a tool for quickly building new virtual machines. You can
build a variety of VMs for local or cloud use, usually
within a few minutes or less. Virt-builder also has many
ways to customize these VMs. Everything is run from the
command line and nothing requires root privileges, so
automation and scripting is simple.</p>

<p style="margin-left:11%; margin-top: 1em">Note that
virt-builder does not install guests from scratch. It takes
cleanly prepared, digitally signed <small>OS</small>
templates and customizes them. This approach is used because
it is much faster, but if you need to do fresh installs you
may want to look at <i>virt&minus;install</i>(1) and
<i>oz&minus;install</i>(1).</p>

<p style="margin-left:11%; margin-top: 1em">The easiest way
to get started is by looking at the examples in the next
section.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>List the
virtual machines available</b></p>

<pre style="margin-left:11%;"> virt&minus;builder &minus;&minus;list</pre>


<p style="margin-left:11%; margin-top: 1em">will list out
the operating systems available to install. A selection of
freely redistributable OSes is available as standard. You
can add your own too (see below).</p>

<p style="margin-left:11%; margin-top: 1em">After choosing
a guest from the list, you may want to see if there are any
installation notes:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder &minus;&minus;notes fedora&minus;20</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Build a
virtual machine</b></p>

<pre style="margin-left:11%;"> virt&minus;builder fedora&minus;20</pre>


<p style="margin-left:11%; margin-top: 1em">will build a
Fedora 20 image for the same architecture as virt-builder
(so running it from an i386 installation will try to build
an i386 image, if available). This will have all default
configuration (minimal size, no user accounts, random root
password, only the bare minimum installed software,
etc.).</p>

<p style="margin-left:11%; margin-top: 1em">You <i>do
not</i> need to run this command as root.</p>

<p style="margin-left:11%; margin-top: 1em">The first time
this runs it has to download the template over the network,
but this gets cached (see &quot;
<small>CACHING&quot;</small> ).</p>

<p style="margin-left:11%; margin-top: 1em">The name of the
output file is derived from the template name, so above it
will be <tt>&quot;fedora&minus;20.img&quot;</tt>. You can
change the output filename using the <i>&minus;o</i>
option:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 &minus;o mydisk.img</pre>


<p style="margin-left:11%; margin-top: 1em">You can also
use the <i>&minus;o</i> option to write to existing devices
or logical volumes.</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 &minus;&minus;format qcow2</pre>


<p style="margin-left:11%; margin-top: 1em">As above, but
write the output in qcow2 format to
<tt>&quot;fedora&minus;20.qcow2&quot;</tt>.</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 &minus;&minus;size 20G</pre>


<p style="margin-left:11%; margin-top: 1em">As above, but
the output size will be 20 <small>GB.</small> The guest
<small>OS</small> is resized as it is copied to the output
(automatically, using <i>virt&minus;resize</i>(1)).</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 &minus;&minus;arch i386</pre>


<p style="margin-left:11%; margin-top: 1em">As above, but
using an i386 template, if available.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Setting the
root password</b></p>

<pre style="margin-left:11%;"> virt&minus;builder fedora&minus;20 &minus;&minus;root&minus;password file:/tmp/rootpw</pre>


<p style="margin-left:11%; margin-top: 1em">Create a Fedora
20 image. The root password is taken from the file
<tt>&quot;/tmp/rootpw&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">Note if you
<i>don&rsquo;t</i> set
<i>&minus;&minus;root&minus;password</i> then the guest is
given a <i>random</i> root password.</p>

<p style="margin-left:11%; margin-top: 1em">You can also
create user accounts. See &quot; <small>USERS AND
PASSWORDS&quot;</small> below.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Set the
hostname</b></p>

<pre style="margin-left:11%;"> virt&minus;builder fedora&minus;20 &minus;&minus;hostname virt.example.com</pre>


<p style="margin-left:11%; margin-top: 1em">Set the
hostname to <tt>&quot;virt.example.com&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Installing
software</b> <br>
To install packages from the ordinary (guest) software
repository (eg. yum or apt):</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 &minus;&minus;install &quot;inkscape,@Xfce Desktop&quot;</pre>


<p style="margin-left:11%; margin-top: 1em">(In Fedora,
<tt>&quot;@&quot;</tt> is used to install groups of
packages. On Debian you would install a meta-package
instead.)</p>

<p style="margin-left:11%; margin-top: 1em">To update the
core packages to the latest version:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder debian&minus;7 &minus;&minus;update</pre>


<p style="margin-left:11%; margin-top: 1em">For guests
which use SELinux, like Fedora and Red Hat Enterprise Linux,
you may need to do SELinux relabelling after installing or
updating packages (see &quot; <small>SELINUX&quot;</small>
below):</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 &minus;&minus;update &minus;&minus;selinux&minus;relabel</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Customizing
the installation</b> <br>
There are many options that let you customize the
installation. These include:
<i>&minus;&minus;run</i>/<i>&minus;&minus;run&minus;command</i>,
which run a shell script or command while the disk image is
being generated and lets you add or edit files that go into
the disk image.
<i>&minus;&minus;firstboot</i>/<i>&minus;&minus;firstboot&minus;command</i>,
which let you add scripts/commands that are run the first
time the guest boots. <i>&minus;&minus;edit</i> to edit
files. <i>&minus;&minus;upload</i> to upload files.</p>

<p style="margin-left:11%; margin-top: 1em">For
example:</p>

<pre style="margin-left:11%; margin-top: 1em"> cat &lt;&lt;'EOF' &gt; /tmp/yum&minus;update.sh
 yum &minus;y update
 EOF
 virt&minus;builder fedora&minus;20 &minus;&minus;firstboot /tmp/yum&minus;update.sh</pre>


<p style="margin-left:11%; margin-top: 1em">or simply:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 &minus;&minus;firstboot&minus;command 'yum &minus;y update'</pre>


<p style="margin-left:11%; margin-top: 1em">which makes the
<i>yum</i>(8) <tt>&quot;update&quot;</tt> command run once
the first time the guest boots.</p>

<p style="margin-left:11%; margin-top: 1em">Or:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 &minus;&minus;edit '/etc/yum.conf: s/gpgcheck=1/gpgcheck=0/'</pre>


<p style="margin-left:11%; margin-top: 1em">which edits
<tt>&quot;/etc/yum.conf&quot;</tt> inside the disk image
(during disk image creation, long before boot).</p>

<p style="margin-left:11%; margin-top: 1em">You can combine
these options, and have multiple options of all types.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;help</b></p>

<p style="margin-left:17%;">Display help.</p>

<p style="margin-left:11%;"><b>&minus;&minus;arch</b>
<small>ARCHITECTURE</small></p>

<p style="margin-left:17%;">Use the specified architecture
for the output image. This means there must be sources
providing the requested template for the requested
architecture.</p>

<p style="margin-left:17%; margin-top: 1em">See also &quot;
<small>ARCHITECTURE&quot;</small> .</p>

<p style="margin-left:11%;"><b>&minus;&minus;attach</b>
<small>ISOFILE</small></p>

<p style="margin-left:17%;">During the customization phase,
the given disk is attached to the libguestfs appliance. This
is used to provide extra software repositories or other data
for customization.</p>

<p style="margin-left:17%; margin-top: 1em">You probably
want to ensure the volume(s) or filesystems in the attached
disks are labelled (or use an <small>ISO</small> volume
name) so that you can mount them by label in your
run-scripts:</p>

<pre style="margin-left:17%; margin-top: 1em"> mkdir /tmp/mount
 mount LABEL=EXTRA /tmp/mount</pre>


<p style="margin-left:17%; margin-top: 1em">You can have
multiple <i>&minus;&minus;attach</i> options, and the format
can be any disk format (not just an <small>ISO</small>
).</p>

<p style="margin-left:17%; margin-top: 1em">See also:
<i>&minus;&minus;run</i>, &quot;Installing packages at build
time from a side repository&quot;, <i>genisoimage</i>(1),
<i>virt&minus;make&minus;fs</i>(1).</p>


<p style="margin-left:11%;"><b>&minus;&minus;attach&minus;format</b>
<small>FORMAT</small></p>

<p style="margin-left:17%;">Specify the disk format for the
next <i>&minus;&minus;attach</i> option. The
<tt>&quot;FORMAT&quot;</tt> is usually
<tt>&quot;raw&quot;</tt> or <tt>&quot;qcow2&quot;</tt>. Use
<tt>&quot;raw&quot;</tt> for ISOs.</p>

<p style="margin-left:11%;"><b>&minus;&minus;cache</b>
<small>DIR</small> <b><br>
&minus;&minus;no&minus;cache</b></p>

<p style="margin-left:17%;"><i>&minus;&minus;cache</i>
<small>DIR</small> sets the directory to use/check for
cached template files. If not set, defaults to either
<tt>&quot;$XDG_CACHE_HOME/virt&minus;builder/&quot;</tt> or
<tt>&quot;$HOME/.cache/virt&minus;builder/&quot;</tt>.</p>


<p style="margin-left:17%; margin-top: 1em"><i>&minus;&minus;no&minus;cache</i>
disables template caching.</p>


<p style="margin-left:11%;"><b>&minus;&minus;cache&minus;all&minus;templates</b></p>

<p style="margin-left:17%;">Download all templates to the
cache and then exit. See &quot; <small>CACHING&quot;</small>
.</p>

<p style="margin-left:17%; margin-top: 1em">Note this
doesn&rsquo;t cache everything. More templates might be
uploaded. Also this doesn&rsquo;t cache packages (the
<i>&minus;&minus;install</i>, <i>&minus;&minus;update</i>
options).</p>


<p style="margin-left:11%;"><b>&minus;&minus;check&minus;signature
<br>
&minus;&minus;no&minus;check&minus;signature</b></p>

<p style="margin-left:17%;">Check/don&rsquo;t check the
digital signature of the <small>OS</small> template. The
default is to check the signature and exit if it is not
correct. Using
<i>&minus;&minus;no&minus;check&minus;signature</i> bypasses
this check.</p>

<p style="margin-left:17%; margin-top: 1em">See also
<i>&minus;&minus;fingerprint</i>.</p>

<p style="margin-left:11%;"><b>&minus;&minus;curl</b>
<small>CURL</small></p>

<p style="margin-left:17%;">Specify an alternate
<i>curl</i>(1) binary. You can also use this to add curl
parameters, for example to disable https certificate
checks:</p>

<pre style="margin-left:17%; margin-top: 1em"> virt&minus;builder &minus;&minus;curl &quot;curl &minus;&minus;insecure&quot; [...]</pre>



<p style="margin-left:11%;"><b>&minus;&minus;delete&minus;cache</b></p>

<p style="margin-left:17%;">Delete the template cache. See
&quot; <small>CACHING&quot;</small> .</p>


<p style="margin-left:11%;"><b>&minus;&minus;no&minus;delete&minus;on&minus;failure</b></p>

<p style="margin-left:17%;">Don&rsquo;t delete the output
file on failure to build. You can use this to debug failures
to run scripts. See &quot; <small>DEBUGGING
BUILDS&quot;</small> for ways to debug images.</p>

<p style="margin-left:17%; margin-top: 1em">The default is
to delete the output file if virt-builder fails (or, for
example, some script that it runs fails).</p>


<p style="margin-left:11%;"><b>&minus;&minus;fingerprint</b>
&rsquo; <small>AAAA BBBB ...</small> &rsquo;</p>

<p style="margin-left:17%;">Check that the index and
templates are signed by the key with the given fingerprint.
(The fingerprint is a long string, usually written as 10
groups of 4 hexadecimal digits).</p>

<p style="margin-left:17%; margin-top: 1em">You can give
this option multiple times. If you have multiple source
URLs, then you can have either no fingerprint, one
fingerprint or multiple fingerprints. If you have multiple,
then each must correspond 1&minus;1 with a source
<small>URL.</small></p>

<p style="margin-left:11%;"><b>&minus;&minus;format</b>
qcow2 <b><br>
&minus;&minus;format</b> raw</p>

<p style="margin-left:17%;">For ordinary builds, this
selects the output format. The default is <i>raw</i>.</p>

<p style="margin-left:17%; margin-top: 1em">With
<i>&minus;&minus;get&minus;kernel</i> this specifies the
input format.</p>


<p style="margin-left:11%;"><b>&minus;&minus;get&minus;kernel</b>
<small>IMAGE</small></p>

<p style="margin-left:17%;">This option extracts the kernel
and initramfs from a previously built disk image called
<tt>&quot;IMAGE&quot;</tt> (in fact it works for any
<small>VM</small> disk image, not just ones built using
virt-builder).</p>

<p style="margin-left:17%; margin-top: 1em">The kernel and
initramfs are written to the current directory, unless you
also specify the <i>&minus;&minus;output</i>
<tt>&quot;outputdir&quot;</tt> <b>directory</b> name.</p>

<p style="margin-left:17%; margin-top: 1em">The format of
the disk image is automatically detected unless you specify
it by using the <i>&minus;&minus;format</i> option.</p>

<p style="margin-left:17%; margin-top: 1em">In the case
where the guest contains multiple kernels, the one with the
highest version number is chosen. To extract arbitrary
kernels from the disk image, see <i>guestfish</i>(1). To
extract the entire <tt>&quot;/boot&quot;</tt> directory of a
guest, see <i>virt&minus;copy&minus;out</i>(1).</p>

<p style="margin-left:11%;"><b>&minus;&minus;gpg</b>
<small>GPG</small></p>

<p style="margin-left:17%;">Specify an alternate
<i>gpg</i>(1) ( <small>GNU</small> Privacy Guard) binary.
You can also use this to add gpg parameters, for example to
specify an alternate home directory:</p>

<pre style="margin-left:17%; margin-top: 1em"> virt&minus;builder &minus;&minus;gpg &quot;gpg &minus;&minus;homedir /tmp&quot; [...]</pre>



<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;l</b></p></td>
<td width="86%">
</td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;&minus;list <br>
&minus;&minus;list &minus;&minus;list&minus;format</b>
format <b><br>
&minus;&minus;list &minus;&minus;long</b></p>

<p style="margin-left:17%;">List available templates.</p>

<p style="margin-left:17%; margin-top: 1em">It is possible
to choose with <i>&minus;&minus;list&minus;format</i> the
output format for the list templates: <b><br>
short</b></p>

<p style="margin-left:23%;">The default format, prints only
the template identifier and, next to it, its short
description.</p>

<p style="margin-left:17%;"><b>long</b></p>

<p style="margin-left:23%;">Prints a textual list with the
details of the available sources, followed by the details of
the available templates.</p>

<p style="margin-left:17%;"><b>json</b></p>

<p style="margin-left:23%;">Prints a <small>JSON</small>
object with the details of the available sources and the
details of the available templates.</p>

<p style="margin-left:23%; margin-top: 1em">The
<tt>&quot;version&quot;</tt> key in the main object
represents the &quot;compatibility version&quot;, and it is
bumped every time the resulting <small>JSON</small> output
is incompatible with the previous versions (for example the
structure has changed, or non-optional keys are no more
present).</p>


<p style="margin-left:17%; margin-top: 1em"><i>&minus;&minus;long</i>
is a shorthand for the <tt>&quot;long&quot;</tt> format.</p>

<p style="margin-left:17%; margin-top: 1em">See also:
<i>&minus;&minus;source</i>, <i>&minus;&minus;notes</i>,
&quot; <small>SOURCES OF TEMPLATES&quot;</small> .</p>


<p style="margin-left:11%;"><b>&minus;&minus;machine&minus;readable</b></p>

<p style="margin-left:17%;">This option is used to make the
output more machine friendly when being parsed by other
programs. See &quot; <small>MACHINE READABLE
OUTPUT&quot;</small> below.</p>

<p style="margin-left:11%;"><b>&minus;m</b>
<small>MB</small> <b><br>
&minus;&minus;memsize</b> <small>MB</small></p>

<p style="margin-left:17%;">Change the amount of memory
allocated to <i>&minus;&minus;run</i> scripts. Increase this
if you find that <i>&minus;&minus;run</i> scripts or the
<i>&minus;&minus;install</i> option are running out of
memory.</p>

<p style="margin-left:17%; margin-top: 1em">The default can
be found with this command:</p>

<pre style="margin-left:17%; margin-top: 1em"> guestfish get&minus;memsize</pre>


<p style="margin-left:11%;"><b>&minus;&minus;network <br>
&minus;&minus;no&minus;network</b></p>

<p style="margin-left:17%;">Enable or disable network
access from the guest during the installation.</p>

<p style="margin-left:17%; margin-top: 1em">Enabled is the
default. Use <i>&minus;&minus;no&minus;network</i> to
disable access.</p>

<p style="margin-left:17%; margin-top: 1em">The network
only allows outgoing connections and has other minor
limitations. See &quot; <small>NETWORK&quot;</small> in
<i>virt&minus;rescue</i>(1).</p>

<p style="margin-left:17%; margin-top: 1em">If you use
<i>&minus;&minus;no&minus;network</i> then certain other
options such as <i>&minus;&minus;install</i> will not
work.</p>

<p style="margin-left:17%; margin-top: 1em">This does not
affect whether the guest can access the network once it has
been booted, because that is controlled by your hypervisor
or cloud environment and has nothing to do with
virt-builder.</p>

<p style="margin-left:17%; margin-top: 1em">Generally
speaking you should <i>not</i> use
<i>&minus;&minus;no&minus;network</i>. But here are some
reasons why you might want to:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="17%"></td>
<td width="3%">


<p>1.</p></td>
<td width="3%"></td>
<td width="77%">


<p>Because the libguestfs backend that you are using
doesn&rsquo;t support the network. (See: &quot;
<small>BACKEND&quot;</small> in <i>guestfs</i>(3)).</p></td></tr>
<tr valign="top" align="left">
<td width="17%"></td>
<td width="3%">


<p>2.</p></td>
<td width="3%"></td>
<td width="77%">


<p>Any software you need to install comes from an attached
<small>ISO,</small> so you don&rsquo;t need the network.</p></td></tr>
<tr valign="top" align="left">
<td width="17%"></td>
<td width="3%">


<p>3.</p></td>
<td width="3%"></td>
<td width="77%">


<p>You don&rsquo;t want untrusted guest code trying to
access your host network when running virt-builder. This is
particularly an issue when you don&rsquo;t trust the source
of the operating system templates. (See &quot;
<small>SECURITY&quot;</small> below).</p></td></tr>
<tr valign="top" align="left">
<td width="17%"></td>
<td width="3%">


<p>4.</p></td>
<td width="3%"></td>
<td width="77%">


<p>You don&rsquo;t have a host network (eg. in
secure/restricted environments).</p></td></tr>
</table>


<p style="margin-left:11%;"><b>&minus;&minus;no&minus;sync</b></p>

<p style="margin-left:17%;">Do not sync the output file on
exit.</p>

<p style="margin-left:17%; margin-top: 1em">Virt-builder
fsync&rsquo;s the output file or disk image when it
exits.</p>

<p style="margin-left:17%; margin-top: 1em">The reason is
that qemu/KVM&rsquo;s default caching mode is
<tt>&quot;none&quot;</tt> or
<tt>&quot;directsync&quot;</tt>, both of which bypass the
host page cache. Therefore these would not work correctly if
you immediately started the guest after running virt-builder
&minus; they would not see the complete output file. (Note
that you should not use these caching modes &minus; they are
fundamentally broken for this and other reasons.)</p>

<p style="margin-left:17%; margin-top: 1em">If you are not
using these broken caching modes, you can use
<i>&minus;&minus;no&minus;sync</i> to avoid this unnecessary
sync and gain considerable extra performance.</p>

<p style="margin-left:11%;"><b>&minus;&minus;notes</b>
os-version</p>

<p style="margin-left:17%;">List any notes associated with
this guest, then exit (this does not do the install).</p>

<p style="margin-left:11%;"><b>&minus;o</b> filename
<b><br>
&minus;&minus;output</b> filename</p>

<p style="margin-left:17%;">Write the output to
<tt>&quot;filename&quot;</tt>. If you don&rsquo;t specify
this option, then the output filename is generated by taking
the <tt>&quot;os&minus;version&quot;</tt> string and adding
<tt>&quot;.img&quot;</tt> (for raw format) or
<tt>&quot;.qcow2&quot;</tt> (for qcow2 format).</p>

<p style="margin-left:17%; margin-top: 1em">Note that the
output filename could be a device, partition or logical
volume.</p>

<p style="margin-left:17%; margin-top: 1em">When used with
<i>&minus;&minus;get&minus;kernel</i>, this option specifies
the output directory.</p>


<p style="margin-left:11%;"><b>&minus;&minus;print&minus;cache</b></p>

<p style="margin-left:17%;">Print information about the
template cache. See &quot; <small>CACHING&quot;</small>
.</p>

<p style="margin-left:11%;"><b>&minus;&minus;quiet</b></p>

<p style="margin-left:17%;">Don&rsquo;t print ordinary
progress messages.</p>

<p style="margin-left:11%;"><b>&minus;&minus;size</b>
<small>SIZE</small></p>

<p style="margin-left:17%;">Select the size of the output
disk, where the size can be specified using common names
such as <tt>&quot;32G&quot;</tt> (32 gigabytes) etc.</p>

<p style="margin-left:17%; margin-top: 1em">Virt-builder
will resize filesystems inside the disk image
automatically.</p>

<p style="margin-left:17%; margin-top: 1em">If the size is
not specified, then one of two things happens. If the output
is a file, then the size is the same as the template. If the
output is a device, partition, etc then the size of that
device is used.</p>

<p style="margin-left:17%; margin-top: 1em">To specify size
in bytes, the number must be followed by the lowercase
letter <i>b</i>, eg:
<tt>&quot;&minus;&minus;size&nbsp;10737418240b&quot;</tt>.</p>

<p style="margin-left:11%;"><b>&minus;&minus;smp</b> N</p>

<p style="margin-left:17%;">Enable N &ge; 2 virtual CPUs
for <i>&minus;&minus;run</i> scripts to use.</p>

<p style="margin-left:11%;"><b>&minus;&minus;source</b>
<small>URL</small></p>

<p style="margin-left:17%;">Set the source
<small>URL</small> to look for indexes.</p>

<p style="margin-left:17%; margin-top: 1em">You can give
this option multiple times to specify multiple sources.</p>

<p style="margin-left:17%; margin-top: 1em">See also &quot;
<small>SOURCES OF TEMPLATES&quot;</small> below.</p>

<p style="margin-left:17%; margin-top: 1em">Note that you
should not point <i>&minus;&minus;source</i> to sources that
you don&rsquo;t trust (unless the source is signed by
someone you do trust). See also the
<i>&minus;&minus;no&minus;network</i> option.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;v</b></p></td>
<td width="86%">
</td></tr>
</table>


<p style="margin-left:11%;"><b>&minus;&minus;verbose</b></p>

<p style="margin-left:17%;">Enable debug messages and/or
produce verbose output.</p>

<p style="margin-left:17%; margin-top: 1em">When reporting
bugs, use this option and attach the complete output to your
bug report.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;V</b></p></td>
<td width="86%">
</td></tr>
</table>


<p style="margin-left:11%;"><b>&minus;&minus;version</b></p>

<p style="margin-left:17%;">Display version number and
exit.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;x</b></p></td>
<td width="3%"></td>
<td width="60%">


<p>Enable tracing of libguestfs <small>API</small>
calls.</p> </td>
<td width="23%">
</td></tr>
</table>


<p style="margin-left:11%; margin-top: 1em"><b>Customization
options <br>
&minus;&minus;chmod</b> <small>PERMISSIONS:FILE</small></p>

<p style="margin-left:17%;">Change the permissions of
<tt>&quot;FILE&quot;</tt> to
<tt>&quot;PERMISSIONS&quot;</tt>.</p>

<p style="margin-left:17%; margin-top: 1em"><i>Note</i>:
<tt>&quot;PERMISSIONS&quot;</tt> by default would be
decimal, unless you prefix it with <tt>0</tt> to get octal,
ie. use <tt>0700</tt> not <tt>700</tt>.</p>

<p style="margin-left:11%;"><b>&minus;&minus;delete</b>
<small>PATH</small></p>

<p style="margin-left:17%;">Delete a file from the guest.
Or delete a directory (and all its contents,
recursively).</p>

<p style="margin-left:17%; margin-top: 1em">See also:
<i>&minus;&minus;upload</i>, <i>&minus;&minus;scrub</i>.</p>

<p style="margin-left:11%;"><b>&minus;&minus;edit</b>
<small>FILE:EXPR</small></p>

<p style="margin-left:17%;">Edit <tt>&quot;FILE&quot;</tt>
using the Perl expression <tt>&quot;EXPR&quot;</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">Be careful to
properly quote the expression to prevent it from being
altered by the shell.</p>

<p style="margin-left:17%; margin-top: 1em">Note that this
option is only available when Perl 5 is installed.</p>

<p style="margin-left:17%; margin-top: 1em">See
&quot;NON-INTERACTIVE <small>EDITING&quot;</small> in
<i>virt&minus;edit</i>(1).</p>

<p style="margin-left:11%;"><b>&minus;&minus;firstboot</b>
<small>SCRIPT</small></p>

<p style="margin-left:17%;">Install
<tt>&quot;SCRIPT&quot;</tt> inside the guest, so that when
the guest first boots up, the script runs (as root, late in
the boot process).</p>

<p style="margin-left:17%; margin-top: 1em">The script is
automatically chmod +x after installation in the guest.</p>

<p style="margin-left:17%; margin-top: 1em">The alternative
version <i>&minus;&minus;firstboot&minus;command</i> is the
same, but it conveniently wraps the command up in a single
line script for you.</p>

<p style="margin-left:17%; margin-top: 1em">You can have
multiple <i>&minus;&minus;firstboot</i> options. They run in
the same order that they appear on the command line.</p>

<p style="margin-left:17%; margin-top: 1em">See also
<i>&minus;&minus;run</i>.</p>


<p style="margin-left:11%;"><b>&minus;&minus;firstboot&minus;command</b>
&rsquo; <small>CMD+ARGS</small> &rsquo;</p>

<p style="margin-left:17%;">Run command (and arguments)
inside the guest when the guest first boots up (as root,
late in the boot process).</p>

<p style="margin-left:17%; margin-top: 1em">You can have
multiple <i>&minus;&minus;firstboot</i> options. They run in
the same order that they appear on the command line.</p>

<p style="margin-left:17%; margin-top: 1em">See also
<i>&minus;&minus;run</i>.</p>


<p style="margin-left:11%;"><b>&minus;&minus;firstboot&minus;install</b>
<small>PKG,PKG..</small></p>

<p style="margin-left:17%;">Install the named packages (a
comma-separated list). These are installed when the guest
first boots using the guest&rsquo;s package manager (eg.
apt, yum, etc.) and the guest&rsquo;s network
connection.</p>

<p style="margin-left:17%; margin-top: 1em">For an overview
on the different ways to install packages, see &quot;
<small>INSTALLING PACKAGES&quot;</small> in
<i>virt&minus;builder</i>(1).</p>

<p style="margin-left:11%;"><b>&minus;&minus;hostname</b>
<small>HOSTNAME</small></p>

<p style="margin-left:17%;">Set the hostname of the guest
to <tt>&quot;HOSTNAME&quot;</tt>. You can use a dotted
hostname.domainname ( <small>FQDN</small> ) if you want.</p>

<p style="margin-left:11%;"><b>&minus;&minus;install</b>
<small>PKG,PKG..</small></p>

<p style="margin-left:17%;">Install the named packages (a
comma-separated list). These are installed during the image
build using the guest&rsquo;s package manager (eg. apt, yum,
etc.) and the host&rsquo;s network connection.</p>

<p style="margin-left:17%; margin-top: 1em">For an overview
on the different ways to install packages, see &quot;
<small>INSTALLING PACKAGES&quot;</small> in
<i>virt&minus;builder</i>(1).</p>

<p style="margin-left:17%; margin-top: 1em">See also
<i>&minus;&minus;update</i>.</p>

<p style="margin-left:11%;"><b>&minus;&minus;link</b>
TARGET:LINK[:LINK..]</p>

<p style="margin-left:17%;">Create symbolic link(s) in the
guest, starting at <tt>&quot;LINK&quot;</tt> and pointing at
<tt>&quot;TARGET&quot;</tt>.</p>

<p style="margin-left:11%;"><b>&minus;&minus;mkdir</b>
<small>DIR</small></p>

<p style="margin-left:17%;">Create a directory in the
guest.</p>

<p style="margin-left:17%; margin-top: 1em">This uses
<tt>&quot;mkdir&nbsp;&minus;p&quot;</tt> so any intermediate
directories are created, and it also works if the directory
already exists.</p>


<p style="margin-left:11%;"><b>&minus;&minus;no&minus;logfile</b></p>

<p style="margin-left:17%;">Scrub
<tt>&quot;builder.log&quot;</tt> (log file from build
commands) from the image after building is complete. If you
don&rsquo;t want to reveal precisely how the image was
built, use this option.</p>

<p style="margin-left:17%; margin-top: 1em">See also:
&quot; <small>LOG FILE&quot;</small> .</p>

<p style="margin-left:11%;"><b>&minus;&minus;password</b>
<small>USER:SELECTOR</small></p>

<p style="margin-left:17%;">Set the password for
<tt>&quot;USER&quot;</tt>. (Note this option does <i>not</i>
create the user account).</p>

<p style="margin-left:17%; margin-top: 1em">See &quot;
<small>USERS AND PASSWORDS&quot;</small> in
<i>virt&minus;builder</i>(1) for the format of the
<tt>&quot;SELECTOR&quot;</tt> field, and also how to set up
user accounts.</p>


<p style="margin-left:11%;"><b>&minus;&minus;password&minus;crypto</b>
md5|sha256|sha512</p>

<p style="margin-left:17%;">When the virt tools change or
set a password in the guest, this option sets the password
encryption of that password to <tt>&quot;md5&quot;</tt>,
<tt>&quot;sha256&quot;</tt> or
<tt>&quot;sha512&quot;</tt>.</p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;sha256&quot;</tt>
and <tt>&quot;sha512&quot;</tt> require glibc &ge; 2.7
(check <i>crypt</i>(3) inside the guest).</p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;md5&quot;</tt>
will work with relatively old Linux guests (eg. <small>RHEL
3</small> ), but is not secure against modern attacks.</p>

<p style="margin-left:17%; margin-top: 1em">The default is
<tt>&quot;sha512&quot;</tt> unless libguestfs detects an old
guest that didn&rsquo;t have support for
<small>SHA&minus;512,</small> in which case it will use
<tt>&quot;md5&quot;</tt>. You can override libguestfs by
specifying this option.</p>

<p style="margin-left:17%; margin-top: 1em">Note this does
not change the default password encryption used by the guest
when you create new user accounts inside the guest. If you
want to do that, then you should use the
<i>&minus;&minus;edit</i> option to modify
<tt>&quot;/etc/sysconfig/authconfig&quot;</tt> (Fedora,
<small>RHEL</small> ) or
<tt>&quot;/etc/pam.d/common&minus;password&quot;</tt>
(Debian, Ubuntu).</p>


<p style="margin-left:11%;"><b>&minus;&minus;root&minus;password</b>
<small>SELECTOR</small></p>

<p style="margin-left:17%;">Set the root password.</p>

<p style="margin-left:17%; margin-top: 1em">See &quot;
<small>USERS AND PASSWORDS&quot;</small> in
<i>virt&minus;builder</i>(1) for the format of the
<tt>&quot;SELECTOR&quot;</tt> field, and also how to set up
user accounts.</p>

<p style="margin-left:17%; margin-top: 1em">Note: In
virt-builder, if you <i>don&rsquo;t</i> set
<i>&minus;&minus;root&minus;password</i> then the guest is
given a <i>random</i> root password.</p>

<p style="margin-left:11%;"><b>&minus;&minus;run</b>
<small>SCRIPT</small></p>

<p style="margin-left:17%;">Run the shell script (or any
program) called <tt>&quot;SCRIPT&quot;</tt> on the disk
image. The script runs virtualized inside a small appliance,
chrooted into the guest filesystem.</p>

<p style="margin-left:17%; margin-top: 1em">The script is
automatically chmod +x.</p>

<p style="margin-left:17%; margin-top: 1em">If libguestfs
supports it then a limited network connection is available
but it only allows outgoing network connections. You can
also attach data disks (eg. <small>ISO</small> files) as
another way to provide data (eg. software packages) to the
script without needing a network connection
(<i>&minus;&minus;attach</i>). You can also upload data
files (<i>&minus;&minus;upload</i>).</p>

<p style="margin-left:17%; margin-top: 1em">You can have
multiple <i>&minus;&minus;run</i> options. They run in the
same order that they appear on the command line.</p>

<p style="margin-left:17%; margin-top: 1em">See also:
<i>&minus;&minus;firstboot</i>, <i>&minus;&minus;attach</i>,
<i>&minus;&minus;upload</i>.</p>


<p style="margin-left:11%;"><b>&minus;&minus;run&minus;command</b>
&rsquo; <small>CMD+ARGS</small> &rsquo;</p>

<p style="margin-left:17%;">Run the command and arguments
on the disk image. The command runs virtualized inside a
small appliance, chrooted into the guest filesystem.</p>

<p style="margin-left:17%; margin-top: 1em">If libguestfs
supports it then a limited network connection is available
but it only allows outgoing network connections. You can
also attach data disks (eg. <small>ISO</small> files) as
another way to provide data (eg. software packages) to the
script without needing a network connection
(<i>&minus;&minus;attach</i>). You can also upload data
files (<i>&minus;&minus;upload</i>).</p>

<p style="margin-left:17%; margin-top: 1em">You can have
multiple <i>&minus;&minus;run&minus;command</i> options.
They run in the same order that they appear on the command
line.</p>

<p style="margin-left:17%; margin-top: 1em">See also:
<i>&minus;&minus;firstboot</i>, <i>&minus;&minus;attach</i>,
<i>&minus;&minus;upload</i>.</p>

<p style="margin-left:11%;"><b>&minus;&minus;scrub</b>
<small>FILE</small></p>

<p style="margin-left:17%;">Scrub a file from the guest.
This is like <i>&minus;&minus;delete</i> except that:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="17%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="77%">


<p>It scrubs the data so a guest could not recover it.</p></td></tr>
<tr valign="top" align="left">
<td width="17%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="77%">


<p>It cannot delete directories, only regular files.</p></td></tr>
</table>


<p style="margin-left:11%;"><b>&minus;&minus;selinux&minus;relabel</b></p>

<p style="margin-left:17%;">Relabel files in the guest so
that they have the correct SELinux label.</p>

<p style="margin-left:17%; margin-top: 1em">You should only
use this option for guests which support SELinux.</p>

<p style="margin-left:11%;"><b>&minus;&minus;timezone</b>
<small>TIMEZONE</small></p>

<p style="margin-left:17%;">Set the default timezone of the
guest to <tt>&quot;TIMEZONE&quot;</tt>. Use a location
string like <tt>&quot;Europe/London&quot;</tt></p>


<p style="margin-left:11%;"><b>&minus;&minus;update</b></p>

<p style="margin-left:17%;">Do the equivalent of
<tt>&quot;yum update&quot;</tt>, <tt>&quot;apt&minus;get
upgrade&quot;</tt>, or whatever command is required to
update the packages already installed in the template to
their latest versions.</p>

<p style="margin-left:17%; margin-top: 1em">See also
<i>&minus;&minus;install</i>.</p>

<p style="margin-left:11%;"><b>&minus;&minus;upload</b>
<small>FILE:DEST</small></p>

<p style="margin-left:17%;">Upload local file
<tt>&quot;FILE&quot;</tt> to destination
<tt>&quot;DEST&quot;</tt> in the disk image. File owner and
permissions from the original are preserved, so you should
set them to what you want them to be in the disk image.</p>


<p style="margin-left:17%; margin-top: 1em"><tt>&quot;DEST&quot;</tt>
could be the final filename. This can be used to rename the
file on upload.</p>

<p style="margin-left:17%; margin-top: 1em">If
<tt>&quot;DEST&quot;</tt> is a directory name (which must
already exist in the guest) then the file is uploaded into
that directory, and it keeps the same name as on the local
filesystem.</p>

<p style="margin-left:17%; margin-top: 1em">See also:
<i>&minus;&minus;mkdir</i>, <i>&minus;&minus;delete</i>,
<i>&minus;&minus;scrub</i>.</p>

<p style="margin-left:11%;"><b>&minus;&minus;write</b>
<small>FILE:CONTENT</small></p>

<p style="margin-left:17%;">Write
<tt>&quot;CONTENT&quot;</tt> to
<tt>&quot;FILE&quot;</tt>.</p>

<h2>REFERENCE
<a name="REFERENCE"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b><small>INSTALLING
PACKAGES</small></b> <br>
There are several approaches to installing packages or
applications in the guest which have different
trade-offs.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Installing
packages at build time</i></p>

<p style="margin-left:11%; margin-top: 1em">If the guest
<small>OS</small> you are installing is similar to the host
<small>OS</small> (eg. both are Linux), and if libguestfs
supports network connections, then you can use
<i>&minus;&minus;install</i> to install packages like
this:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 &minus;&minus;install inkscape</pre>


<p style="margin-left:11%; margin-top: 1em">This uses the
guest&rsquo;s package manager and the host&rsquo;s network
connection.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Updating
packages at build time</i></p>

<p style="margin-left:11%; margin-top: 1em">To update the
core set of packages in the template at build time:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 &minus;&minus;update</pre>


<p style="margin-left:11%; margin-top: 1em">Most of the
templates that ship with virt-builder come with a very
minimal selection of packages (known as a &quot;
<small>JEOS&quot;</small> or &quot;Just Enough Operating
System&quot;), which are up to date at the time the template
is created, but could be out of date by the time you come to
install an <small>OS</small> from the template. This option
updates those template packages.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Installing
packages at first boot</i></p>

<p style="margin-left:11%; margin-top: 1em">Another option
is to install the packages when the guest first boots:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 &minus;&minus;firstboot&minus;install inkscape</pre>


<p style="margin-left:11%; margin-top: 1em">This uses the
guest&rsquo;s package manager and the guest&rsquo;s network
connection.</p>

<p style="margin-left:11%; margin-top: 1em">The downsides
are that it will take the guest a lot longer to boot first
time, and there&rsquo;s nothing much you can do if package
installation fails (eg. if a network problem means the guest
can&rsquo;t reach the package repositories).</p>

<p style="margin-left:11%; margin-top: 1em"><i>Installing
packages at build time from a side repository</i></p>

<p style="margin-left:11%; margin-top: 1em">If the software
you want to install is not available in the main package
repository of the guest, then you can add a side repository.
Usually this is presented as an <small>ISO</small> (
<small>CD</small> disk image) file containing extra
packages.</p>

<p style="margin-left:11%; margin-top: 1em">You can create
the disk image using either <i>genisoimage</i>(1) or
<i>virt&minus;make&minus;fs</i>(1). For genisoimage, use a
command like this:</p>

<pre style="margin-left:11%; margin-top: 1em"> genisoimage &minus;o extra&minus;packages.iso &minus;R &minus;J &minus;V EXTRA cdcontents/</pre>


<p style="margin-left:11%; margin-top: 1em">Create a script
that mounts the <small>ISO</small> and sets up the
repository. For yum, create /tmp/install.sh containing:</p>

<pre style="margin-left:11%; margin-top: 1em"> mkdir /tmp/mount
 mount LABEL=EXTRA /tmp/mount
 cat &lt;&lt;'EOF' &gt; /etc/yum.repos.d/extra.repo
 [extra]
 name=extra
 baseurl=file:///tmp/mount
 enabled=1
 EOF
 yum &minus;y install famousdatabase</pre>


<p style="margin-left:11%; margin-top: 1em">For apt, create
/tmp/install.sh containing:</p>

<pre style="margin-left:11%; margin-top: 1em"> mkdir /tmp/mount
 mount LABEL=EXTRA /tmp/mount
 apt&minus;cdrom &minus;d=/tmp/mount add
 apt&minus;get &minus;y install famousdatabase</pre>


<p style="margin-left:11%; margin-top: 1em">Use the
<i>&minus;&minus;attach</i> option to attach the <small>CD
/</small> disk image and the <i>&minus;&minus;run</i> option
to run the script:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 \
   &minus;&minus;attach extra&minus;packages.iso \
   &minus;&minus;run /tmp/install.sh</pre>



<p style="margin-left:11%; margin-top: 1em"><b><small>USERS
AND PASSWORDS</small></b> <br>
The <i>&minus;&minus;root&minus;password</i> option is used
to change the root password (otherwise a random password is
used). This option takes a password
<tt>&quot;SELECTOR&quot;</tt> in one of the following
formats: <b><br>
&minus;&minus;root&minus;password</b> file:FILENAME</p>

<p style="margin-left:17%;">Read the root password from
<tt>&quot;FILENAME&quot;</tt>. The whole first line of this
file is the replacement password. Any other lines are
ignored. You should create the file with mode 0600 to ensure
no one else can read it.</p>


<p style="margin-left:11%;"><b>&minus;&minus;root&minus;password</b>
password:PASSWORD</p>

<p style="margin-left:17%;">Set the root password to the
literal string <tt>&quot;PASSWORD&quot;</tt>.</p>

<p style="margin-left:17%; margin-top: 1em"><b>Note: this
is not secure</b> since any user on the same machine can see
the cleartext password using <i>ps</i>(1).</p>


<p style="margin-left:11%;"><b>&minus;&minus;root&minus;password</b>
random</p>

<p style="margin-left:17%;">Choose a random password, which
is printed on stdout. The password has approximately 120
bits of randomness.</p>

<p style="margin-left:17%; margin-top: 1em">This is the
default.</p>


<p style="margin-left:11%;"><b>&minus;&minus;root&minus;password</b>
disabled</p>

<p style="margin-left:17%;">The root account password is
disabled. This is like putting <tt>&quot;*&quot;</tt> in the
password field.</p>


<p style="margin-left:11%;"><b>&minus;&minus;root&minus;password</b>
locked:file:FILENAME <b><br>
&minus;&minus;root&minus;password</b>
locked:password:PASSWORD <b><br>
&minus;&minus;root&minus;password</b> locked:random</p>

<p style="margin-left:17%;">The root account is locked, but
a password is placed on the account. If first unlocked
(using <tt>&quot;passwd &minus;u&quot;</tt>) then logins
will use the given password.</p>


<p style="margin-left:11%;"><b>&minus;&minus;root&minus;password</b>
locked <b><br>
&minus;&minus;root&minus;password</b> locked:disabled</p>

<p style="margin-left:17%;">The root account is locked
<i>and</i> password is disabled.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Creating
user accounts</i></p>

<p style="margin-left:11%; margin-top: 1em">To create user
accounts, use the <i>useradd</i>(8) command with
&minus;&minus;firstboot&minus;command like this:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder &minus;&minus;firstboot&minus;command \
    'useradd &minus;m &minus;p &quot;&quot; rjones ; chage &minus;d 0 rjones'</pre>


<p style="margin-left:11%; margin-top: 1em">The above
command will create an <tt>&quot;rjones&quot;</tt> account
with no password, and force the user to set a password when
they first log in. There are other ways to manage passwords,
see <i>useradd</i>(8) for details.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>KEYBOARD
LAYOUT</small></b> <br>
Because there are so many different ways to set the keyboard
layout in Linux distributions, virt-builder does not yet
attempt to have a simple command line option. This section
describes how to set the keyboard for some common Linux
distributions.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Keyboard
layout with systemd</i></p>

<p style="margin-left:11%; margin-top: 1em">For distros
that use systemd <tt>&quot;localectl&quot;</tt>, use a
command like this:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 \
   &minus;&minus;firstboot&minus;command 'localectl set&minus;keymap uk'</pre>


<p style="margin-left:11%; margin-top: 1em">See
<i>localectl</i>(1) and
https://www.happyassassin.net/2013/11/23/keyboard&minus;layouts&minus;in&minus;fedora&minus;20&minus;and&minus;previously/
for more details.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Keyboard
layout using &quot;/etc/sysconfig/keyboard&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">For
<small>RHEL</small> &le; 6, Fedora &le; 18 and similar,
upload or modify the keyboard configuration file using the
<i>&minus;&minus;upload</i>, <i>&minus;&minus;write</i> or
<i>&minus;&minus;edit</i> options. For example:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder centos&minus;6 \
   &minus;&minus;edit '/etc/sysconfig/keyboard: s/^KEYTABLE=.*/KEYTABLE=&quot;uk&quot;/'</pre>


<p style="margin-left:11%; margin-top: 1em">The format of
this file can be found documented in many places online.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Keyboard
layout with Debian-derived distros</i></p>

<p style="margin-left:11%; margin-top: 1em">For
Debian-derived distros using
<tt>&quot;/etc/default/keyboard&quot;</tt>, upload or modify
the keyboard file using the <i>&minus;&minus;upload</i>,
<i>&minus;&minus;write</i> or <i>&minus;&minus;edit</i>
options. For example:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder debian&minus;7 \
   &minus;&minus;edit '/etc/default/keyboard: s/^XKBLAYOUT=.*/XKBLAYOUT=&quot;gb&quot;/'</pre>


<p style="margin-left:11%; margin-top: 1em">See
https://wiki.debian.org/Keyboard.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>LANGUAGE</small></b>
<br>
Most Linux distributions support multiple locale settings so
that you can have guest messages printed in another language
such as Russian.</p>

<p style="margin-left:11%; margin-top: 1em">However there
is no single setting which controls this, since extra
packages may need to be installed to support console and X
fonts, and keyboard input methods. The packages required,
and their configuration is highly distro-specific, and it is
outside the scope of virt-builder to do this.</p>

<p style="margin-left:11%; margin-top: 1em">This section
contains examples for some common Linux distributions.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Setting
Japanese in Fedora 20</i></p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 \
   &minus;&minus;size 20G \
   &minus;&minus;update \
   &minus;&minus;install @japanese&minus;support \
   &minus;&minus;install @xfce \
   &minus;&minus;install xorg&minus;x11&minus;server&minus;Xorg,xorg&minus;x11&minus;drivers,rsyslog \
   &minus;&minus;link /usr/lib/systemd/system/graphical.target:/etc/systemd/system/default.target \
   &minus;&minus;firstboot&minus;command 'localectl set&minus;locale LANG=ja_JP.utf8' \
   &minus;&minus;firstboot&minus;command 'localectl set&minus;keymap jp' \
   &minus;&minus;firstboot&minus;command 'systemctl isolate graphical.target'</pre>


<p style="margin-left:11%; margin-top: 1em"><i>Setting
Japanese in Debian 7 (Wheezy)</i></p>

<p style="margin-left:11%; margin-top: 1em">Note that
although this enables Japanese in the text console too, it
is unlikely that you will see properly rendered Japanese
there. However Japanese is properly rendered in X
applications and terminals.</p>

<pre style="margin-left:11%; margin-top: 1em"> pkgs=locales,xfce4,\
 ibus,ibus&minus;anthy,\
 ttf&minus;sazanami&minus;gothic,ttf&minus;sazanami&minus;mincho,\
 fonts&minus;takao&minus;mincho,\
 xfonts&minus;intl&minus;japanese,xfonts&minus;intl&minus;japanese&minus;big,\
 iceweasel&minus;l10n&minus;ja,manpages&minus;ja
 virt&minus;builder debian&minus;7 \
   &minus;&minus;size 20G \
   &minus;&minus;install $pkgs \
   &minus;&minus;edit '/etc/inittab: s,^#([1&minus;9].*respawn.*/sbin/getty.*),$1,' \
   &minus;&minus;edit '/etc/locale.gen: s,^#\s*ja,ja,' \
   &minus;&minus;write '/etc/default/locale:LANG=&quot;ja_JP.UTF&minus;8&quot;' \
   &minus;&minus;run&minus;command &quot;locale&minus;gen&quot;</pre>


<p style="margin-left:11%; margin-top: 1em"><b><small>LOG
FILE</small></b> <br>
Scripts and package installation that runs at build time
(<i>&minus;&minus;run</i>,
<i>&minus;&minus;run&minus;command</i>,
<i>&minus;&minus;install</i>, <i>&minus;&minus;update</i>,
but <i>not</i> firstboot) is logged in one of the following
locations: <br>
&quot;/tmp/builder.log&quot;</p>

<p style="margin-left:17%;">On Linux, <small>BSD</small>
and other guests.</p>


<p style="margin-left:11%;">&quot;C:\Temp\builder.log&quot;</p>

<p style="margin-left:17%;">On Windows, <small>DOS</small>
guests.</p>

<p style="margin-left:11%;">&quot;/builder.log&quot;</p>

<p style="margin-left:17%;">If <tt>&quot;/tmp&quot;</tt> or
<tt>&quot;C:\Temp&quot;</tt> is missing.</p>

<p style="margin-left:11%; margin-top: 1em">If you
don&rsquo;t want the log file to appear in the final image,
then use the <i>&minus;&minus;no&minus;logfile</i> command
line option.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>INSTALLATION
PROCESS</small></b> <br>
When you invoke virt-builder, installation proceeds as
follows:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="51%">


<p>The template image is downloaded.</p></td>
<td width="32%">
</td></tr>
</table>

<p style="margin-left:17%; margin-top: 1em">If the template
image is present in the cache, the cached version is used
instead. (See &quot; <small>CACHING&quot;</small> ).</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p style="margin-top: 1em">The template signature is
checked.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>The template is uncompressed to a tmp file.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>The template image is resized into the destination,
using <i>virt&minus;resize</i>(1).</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>Extra disks are attached
(<i>&minus;&minus;attach</i>).</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>A new random seed is generated for the guest.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>Guest customization is performed, in the order specified
on the command line.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>SELinux relabelling is done
(<i>&minus;&minus;selinux&minus;relabel</i>).</p> </td></tr>
</table>


<p style="margin-left:11%; margin-top: 1em"><b><small>IMPORTING
THE DISK IMAGE</small></b> <i><br>
Importing into libvirt</i></p>

<p style="margin-left:11%; margin-top: 1em">Import the disk
image into libvirt using <i>virt&minus;install</i>(1)
<i>&minus;&minus;import</i> option.</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;install &minus;&minus;import \
   &minus;&minus;name guest &minus;&minus;ram 2048 \
   &minus;&minus;disk path=disk.img,format=raw &minus;&minus;os&minus;variant fedora20</pre>


<p style="margin-left:11%; margin-top: 1em">Notes:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em">1.</p></td>
<td width="3%"></td>
<td width="83%">


<p style="margin-top: 1em">You <i>must</i> specify the
correct format. The format is <tt>&quot;raw&quot;</tt>
unless you used virt-builder&rsquo;s
<i>&minus;&minus;format</i> option.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p>2.</p></td>
<td width="3%"></td>
<td width="83%">


<p><i>&minus;&minus;os&minus;variant</i> is highly
recommended, because it will present optimum devices to
enable the guest to run most efficiently. To get a list of
all variants, do:</p></td></tr>
</table>

<pre style="margin-left:17%; margin-top: 1em"> virt&minus;install &minus;&minus;os&minus;variant list</pre>



<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p style="margin-top: 1em">3.</p></td>
<td width="3%"></td>
<td width="83%">


<p style="margin-top: 1em">You can run virt-install as root
or non-root. Each works slightly differently because libvirt
manages a different set of virtual machines for each user.
In particular virt-manager normally shows the root-owned
VMs, whereas Boxes shows the user-owned VMs, and other tools
probably work differently as well.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em"><i>Importing
into OpenStack</i></p>

<p style="margin-left:11%; margin-top: 1em">Import the
image into Glance (the OpenStack image store) by doing:</p>

<pre style="margin-left:11%; margin-top: 1em"> glance image&minus;create &minus;&minus;name fedora&minus;20&minus;image &minus;&minus;file fedora&minus;20.img \
   &minus;&minus;disk&minus;format raw &minus;&minus;container&minus;format bare \
   &minus;&minus;is&minus;public True</pre>


<p style="margin-left:11%; margin-top: 1em">The
<i>&minus;&minus;file</i> parameter is the
virt-builder-generated disk image. It should match
virt-builder&rsquo;s <i>&minus;&minus;output</i> option. The
<i>&minus;&minus;disk&minus;format</i> parameter should
match virt-builder&rsquo;s <i>&minus;&minus;format</i>
option (or <tt>&quot;raw&quot;</tt> if you didn&rsquo;t use
that option). The
<i>&minus;&minus;container&minus;format</i> should always be
<tt>&quot;bare&quot;</tt> since virt-builder doesn&rsquo;t
put images into containers.</p>

<p style="margin-left:11%; margin-top: 1em">You can use the
<tt>&quot;glance&nbsp;image&minus;show&nbsp;</tt><i>fedora&minus;20&minus;image</i><tt>&quot;</tt>
command to display the properties of the image.</p>

<p style="margin-left:11%; margin-top: 1em">To boot up an
instance of your image on a Nova compute node, do:</p>

<pre style="margin-left:11%; margin-top: 1em"> nova boot fedora&minus;20&minus;server &minus;&minus;image fedora&minus;20&minus;image \
   &minus;&minus;flavor m1.medium</pre>


<p style="margin-left:11%; margin-top: 1em">Use
<tt>&quot;nova&nbsp;flavor&minus;list&quot;</tt> to list
possible machine flavors. Use
<tt>&quot;nova&nbsp;list&quot;</tt> to list running
instances.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Booting
directly using qemu or <small>KVM</small></i></p>

<p style="margin-left:11%; margin-top: 1em">The qemu
command line is not very stable or easy to use, hence
libvirt should be used if possible. However a command line
similar to the following could be used to boot the virtual
machine:</p>

<pre style="margin-left:11%; margin-top: 1em"> qemu&minus;system&minus;x86_64 \
   &minus;machine accel=kvm:tcg \
   &minus;cpu host \
   &minus;m 2048 \
   &minus;drive file=disk.img,format=raw,if=virtio</pre>


<p style="margin-left:11%; margin-top: 1em">As with
libvirt, it is very important that the correct format is
chosen. It will be <tt>&quot;raw&quot;</tt> unless the
<i>&minus;&minus;format</i> option was used.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>CONFIGURATION
MANAGEMENT</small></b> <i><br>
Puppet</i></p>

<p style="margin-left:11%; margin-top: 1em">To enable the
Puppet agent in a guest, install the package, point the
configuration at your Puppetmaster, and ensure the agent
runs at boot.</p>

<p style="margin-left:11%; margin-top: 1em">A typical
virt-builder command would be:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora&minus;20 \
   &minus;&minus;hostname client.example.com \
   &minus;&minus;update \
   &minus;&minus;install puppet \
   &minus;&minus;edit '/etc/puppet/puppet.conf:
       s/^\[agent\]/[agent]\n  server = puppetmaster.example.com/' \
   &minus;&minus;run&minus;command 'systemctl enable puppet' \
   &minus;&minus;selinux&minus;relabel</pre>


<p style="margin-left:11%; margin-top: 1em">The precise
instructions vary according to the Linux distro. For further
information see:
http://docs.puppetlabs.com/guides/installation.htm</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DEBUGGING
BUILDS</small></b> <br>
If virt-builder itself fails, then enable debugging
(<i>&minus;v</i>) and report a bug (see &quot;
<small>BUGS&quot;</small> below).</p>

<p style="margin-left:11%; margin-top: 1em">If virt-builder
fails because some script or package it is installing fails,
try using
<i>&minus;&minus;no&minus;delete&minus;on&minus;failure</i>
to preserve the output file, and continue reading this
section.</p>

<p style="margin-left:11%; margin-top: 1em">If virt-builder
is successful but the image doesn&rsquo;t work, here are
some things to try: <br>
Use virt-rescue</p>

<p style="margin-left:17%;">Run <i>virt&minus;rescue</i>(1)
on the disk image:</p>

<pre style="margin-left:17%; margin-top: 1em"> virt&minus;rescue &minus;a disk.img</pre>


<p style="margin-left:17%; margin-top: 1em">This gives you
a rescue shell. You can mount the filesystems from the disk
image on <tt>&quot;/sysroot&quot;</tt> and examine them
using ordinary Linux commands. You can also chroot into the
guest to reinstall the bootloader. The virt-rescue man page
has a lot more information and examples.</p>

<p style="margin-left:11%;">Use guestfish</p>

<p style="margin-left:17%;">Run <i>guestfish</i>(1) on the
disk image:</p>

<pre style="margin-left:17%; margin-top: 1em"> guestfish &minus;a disk.img &minus;i</pre>


<p style="margin-left:17%; margin-top: 1em">Use guestfish
commands like <tt>&quot;ll /directory&quot;</tt> and
<tt>&quot;cat /file&quot;</tt> to examine directories and
files.</p>

<p style="margin-left:11%;">Use guestmount</p>

<p style="margin-left:17%;">Mount the disk image safely on
the host using <small>FUSE</small> and
<i>guestmount</i>(1):</p>

<pre style="margin-left:17%; margin-top: 1em"> mkdir /tmp/mp
 guestmount &minus;a disk.img &minus;i /tmp/mp
 cd /tmp/mp</pre>


<p style="margin-left:17%; margin-top: 1em">To unmount the
disk image do:</p>

<pre style="margin-left:17%; margin-top: 1em"> fusermount &minus;u /tmp/mp</pre>


<p style="margin-left:11%;">Add a serial console</p>

<p style="margin-left:17%;">If the guest hangs during boot,
it can be helpful to add a serial console to the guest, and
direct kernel messages to the serial console. Adding the
serial console will involve looking at the documentation for
your hypervisor. To direct kernel messages to the serial
console, add the following on the kernel command line:</p>

<pre style="margin-left:17%; margin-top: 1em"> console=tty0 console=ttyS0,115200</pre>



<p style="margin-left:11%; margin-top: 1em"><b><small>SOURCES
OF TEMPLATES</small></b> <br>
virt-builder reads the available sources from configuration
files, with the <i>.conf</i> extension and located in the
following paths:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p><tt>$XDG_CONFIG_HOME</tt>/virt&minus;builder/repos.d/
(<tt>$XDG_CONFIG_HOME</tt> is
<tt>&quot;$HOME/.config&quot;</tt> if not set).</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p><tt>$XDG_CONFIG_DIRS</tt>/virt&minus;builder/repos.d/
(where <tt>$XDG_CONFIG_DIRS</tt> means any of the
directories in that environment variable, or just
<tt>&quot;/etc/xdg&quot;</tt> if not set)</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">Each
<i>.conf</i> file in those paths has a simple text format
like the following:</p>

<pre style="margin-left:11%; margin-top: 1em"> [libguestfs.org]
 uri=http://libguestfs.org/download/builder/index.asc
 gpgkey=file:///etc/xdg/virt&minus;builder/repos.d/libguestfs.gpg</pre>


<p style="margin-left:11%; margin-top: 1em">The part in
square brackets is the repository identifier, which is used
as unique identifier.</p>

<p style="margin-left:11%; margin-top: 1em">The following
fields can appear: <br>
&quot;uri=URI&quot;</p>

<p style="margin-left:17%;">The <small>URI</small> of the
index file which this repository refers to.</p>

<p style="margin-left:17%; margin-top: 1em">This field is
required.</p>

<p style="margin-left:11%;">&quot;gpgkey=URI&quot;</p>

<p style="margin-left:17%;">This optional field represents
the <small>URI</small> (although only <i>file://</i> URIs
are accepted) of the key used to sign the index file. If not
present, the index file referred by <i>uri=..</i> is not
signed.</p>

<p style="margin-left:11%;">&quot;proxy=MODE&quot;</p>

<p style="margin-left:17%;">This optional field specifies
the proxy mode, to be used when downloading the index file
of this repository. The possible values are: <b><br>
no</b>, <b>off</b></p>

<p style="margin-left:23%;">No proxy is being used at all,
even overriding the system configuration.</p>

<p style="margin-left:17%;"><b>system</b></p>

<p style="margin-left:23%;">The proxy used is the system
one.</p>

<p style="margin-left:17%;"><i>anything else</i></p>

<p style="margin-left:23%;">Specifies the actual proxy
configuration to be used, overriding the system
configuration.</p>

<p style="margin-left:17%; margin-top: 1em">If not present,
the assumed value is to respect the proxy settings of the
system (i.e. as if <b>system</b> would be specified).</p>

<p style="margin-left:11%; margin-top: 1em">For serious
virt-builder use, you may want to create your own repository
of templates.</p>


<p style="margin-left:11%; margin-top: 1em"><i>Libguestfs.org
repository</i></p>

<p style="margin-left:11%; margin-top: 1em">Out of the box,
virt-builder downloads the file
http://libguestfs.org/download/builder/index.asc which is an
index of available templates plus some information about
each one, wrapped up in a digital signature. The command
<tt>&quot;virt&minus;builder &minus;&minus;list&quot;</tt>
lists out the information in this index file.</p>

<p style="margin-left:11%; margin-top: 1em">The templates
hosted on libguestfs.org were created using shell scripts,
kickstart files and preseed files which can be found in the
libguestfs source tree, in
<tt>&quot;builder/website&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Setting up
the repository</i></p>

<p style="margin-left:11%; margin-top: 1em">You can set up
your own site containing an index file and some templates,
and then point virt-builder at the site by creating a
<i>.conf</i> file pointing to it.</p>

<p style="margin-left:11%; margin-top: 1em">Note that if
your index is signed, you will need to properly fill
<i>gpgkey=..</i> in your <i>.conf</i> file, making sure to
deploy also the <small>GPG</small> key file.</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder &minus;&minus;source https://example.com/builder/index.asc \
    &minus;&minus;fingerprint 'AAAA BBBB ...' \
    &minus;&minus;list</pre>


<p style="margin-left:11%; margin-top: 1em">You can host
this on any web or <small>FTP</small> server, or a local or
network filesystem.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Setting up a
<small>GPG</small> key</i></p>

<p style="margin-left:11%; margin-top: 1em">If you
don&rsquo;t have a GnuPG key, you will need to set one up.
(Strictly speaking this is optional, but if your index and
template files are not signed then virt-builder users will
have to use the
<i>&minus;&minus;no&minus;check&minus;signature</i> flag
every time they use virt-builder.)</p>

<p style="margin-left:11%; margin-top: 1em">To create a
key, see the <small>GPG</small> manual
http://www.gnupg.org/gph/en/manual.html.</p>

<p style="margin-left:11%; margin-top: 1em">Export your
<small>GPG</small> public key:</p>

<pre style="margin-left:11%; margin-top: 1em"> gpg &minus;&minus;export &minus;a &quot;you@example.com&quot; &gt; pubkey</pre>


<p style="margin-left:11%; margin-top: 1em"><i>Create the
templates</i></p>

<p style="margin-left:11%; margin-top: 1em">There are many
ways to create the templates. For example you could clone
existing guests (see <i>virt&minus;sysprep</i>(1)), or you
could install a guest by hand
(<i>virt&minus;install</i>(1)). To see how the templates
were created for virt-builder, look at the scripts in
<tt>&quot;builder/website&quot;</tt></p>

<p style="margin-left:11%; margin-top: 1em">For best
results when compressing the templates, use the following xz
options (see <i>nbdkit&minus;xz&minus;plugin</i>(1) for
further explanation):</p>

<pre style="margin-left:11%; margin-top: 1em"> xz &minus;&minus;best &minus;&minus;block&minus;size=16777216 disk</pre>


<p style="margin-left:11%; margin-top: 1em"><i>Creating and
signing the index file</i></p>

<p style="margin-left:11%; margin-top: 1em">The index file
has a simple text format (shown here without the digital
signature):</p>

<pre style="margin-left:11%; margin-top: 1em"> [fedora&minus;18]
 name=Fedora&reg; 18
 osinfo=fedora18
 arch=x86_64
 file=fedora&minus;18.xz
 checksum[sha512]=...
 format=raw
 size=6442450944
 compressed_size=148947524
 expand=/dev/sda3
 [fedora&minus;19]
 name=Fedora&reg; 19
 osinfo=fedora19
 arch=x86_64
 file=fedora&minus;19.xz
 checksum[sha512]=...
 revision=3
 format=raw
 size=4294967296
 compressed_size=172190964
 expand=/dev/sda3</pre>


<p style="margin-left:11%; margin-top: 1em">The part in
square brackets is the
<tt>&quot;os&minus;version&quot;</tt>, which is the same
string that is used on the virt-builder command line to
build that <small>OS.</small></p>

<p style="margin-left:11%; margin-top: 1em">After preparing
the <tt>&quot;index&quot;</tt> file in the correct format,
clearsign it using the following command:</p>

<pre style="margin-left:11%; margin-top: 1em"> gpg &minus;&minus;clearsign &minus;&minus;armor index</pre>


<p style="margin-left:11%; margin-top: 1em">This will
create the final file called <tt>&quot;index.asc&quot;</tt>
which can be uploaded to the server (and is the
<i>uri=..</i> <small>URL</small> ). As noted above, signing
the index file is optional, but recommended.</p>

<p style="margin-left:11%; margin-top: 1em">The following
fields can appear: <br>
&quot;name=NAME&quot;</p>

<p style="margin-left:17%;">The user-friendly name of this
template. This is displayed in the <i>&minus;&minus;list</i>
output but is otherwise not significant.</p>

<p style="margin-left:11%;">&quot;osinfo=ID&quot;</p>

<p style="margin-left:17%;">This optional field maps the
operating system to the associated libosinfo
<small>ID.</small> Virt-builder does not use it (yet).</p>

<p style="margin-left:11%;">&quot;arch=ARCH&quot;</p>

<p style="margin-left:17%;">The architecture of the
operating system installed within the template. This field
is required.</p>

<p style="margin-left:11%;">&quot;file=PATH&quot;</p>

<p style="margin-left:17%;">The path (relative to the
index) of the xz-compressed template.</p>

<p style="margin-left:17%; margin-top: 1em">Note that
absolute paths or URIs are <b>not</b> permitted here. This
is because virt-builder has a &quot;same origin&quot; policy
for templates so they cannot come from other servers.</p>

<p style="margin-left:11%;">&quot;sig=PATH&quot;</p>

<p style="margin-left:17%;"><b>This option is
deprecated</b>. Use the checksum field instead.</p>

<p style="margin-left:17%; margin-top: 1em">The path
(relative to the index) of the <small>GPG</small> detached
signature of the xz file.</p>

<p style="margin-left:17%; margin-top: 1em">Note that
absolute paths or URIs are <b>not</b> permitted here. This
is because virt-builder has a &quot;same origin&quot; policy
for templates so they cannot come from other servers.</p>

<p style="margin-left:17%; margin-top: 1em">The file can be
created as follows:</p>

<pre style="margin-left:17%; margin-top: 1em"> gpg &minus;&minus;detach&minus;sign &minus;&minus;armor &minus;o disk.xz.sig disk.xz</pre>



<p style="margin-left:11%;">&quot;checksum[sha512]=7b882fe9b82eb0fef...&quot;</p>

<p style="margin-left:17%;">The
<small>SHA&minus;512</small> checksum of the
<b>compressed</b> file is checked after it is downloaded. To
work out the signature, do:</p>

<pre style="margin-left:17%; margin-top: 1em"> sha512sum disk.xz</pre>


<p style="margin-left:17%; margin-top: 1em">Note if you use
this, you don&rsquo;t need to sign the file, ie. don&rsquo;t
use <tt>&quot;sig&quot;</tt>. This option overrides
<tt>&quot;sig&quot;</tt>.</p>


<p style="margin-left:11%;">&quot;checksum=7b882fe9b82eb0fef...&quot;</p>

<p style="margin-left:17%;"><tt>&quot;checksum&quot;</tt>
is an alias for <tt>&quot;checksum[sha512]&quot;</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">If you need to
interoperate with virt-builder = 1.24.0 then you have to use
<tt>&quot;checksum&quot;</tt> because that version would
give a parse error with square brackets and numbers in the
key of a field. This is fixed in virt-builder &ge;
1.24.1.</p>

<p style="margin-left:11%;">&quot;revision=N&quot;</p>

<p style="margin-left:17%;">The revision is an integer
which is used to control the template cache. Increasing the
revision number causes clients to download the template
again even if they have a copy in the cache.</p>

<p style="margin-left:17%; margin-top: 1em">The revision
number is optional. If omitted it defaults to
<tt>1</tt>.</p>

<p style="margin-left:11%;">&quot;format=raw&quot; <br>
&quot;format=qcow2&quot;</p>

<p style="margin-left:17%;">Specify the format of the disk
image (before it was compressed). If not given, the format
is autodetected, but generally it is better to be explicit
about the intended format.</p>

<p style="margin-left:17%; margin-top: 1em">Note this is
the source format, which is different from the
<i>&minus;&minus;format</i> option (requested output
format). Virt-builder does on-the-fly conversion from the
source format to the requested output format.</p>

<p style="margin-left:11%;">&quot;size=NNN&quot;</p>

<p style="margin-left:17%;">The virtual size of the image
in bytes. This is the size of the image when uncompressed.
If using a non-raw format such as qcow2 then it means the
virtual disk size, not the size of the qcow2 file.</p>

<p style="margin-left:17%; margin-top: 1em">This field is
required.</p>

<p style="margin-left:17%; margin-top: 1em">Virt-builder
also uses this as the minimum size that users can request
via the <i>&minus;&minus;size</i> option, or as the default
size if there is no <i>&minus;&minus;size</i> option.</p>


<p style="margin-left:11%;">&quot;compressed_size=NNN&quot;</p>

<p style="margin-left:17%;">The compressed size of the disk
image in bytes. This is just used for information (when
using <i>&minus;&minus;list &minus;&minus;long</i>).</p>


<p style="margin-left:11%;">&quot;expand=/dev/sdaX&quot;</p>

<p style="margin-left:17%;">When expanding the image to its
final size, instruct <i>virt&minus;resize</i>(1) to expand
the named partition in the guest image to fill up all
available space. This works like the virt-resize
<i>&minus;&minus;expand</i> option.</p>

<p style="margin-left:17%; margin-top: 1em">You should
usually put the device name of the guest&rsquo;s root
filesystem here.</p>

<p style="margin-left:17%; margin-top: 1em">It&rsquo;s a
good idea to use this, but not required. If the field is
omitted then virt-resize will create an extra partition at
the end of the disk to cover the free space, which is much
less user-friendly.</p>


<p style="margin-left:11%;">&quot;lvexpand=/dev/VolGroup/LogVol&quot;</p>

<p style="margin-left:17%;">When expanding the image to its
final size, instruct <i>virt&minus;resize</i>(1) to expand
the named logical volume in the guest image to fill up all
available space. This works like the virt-resize
<i>&minus;&minus;lv&minus;expand</i> option.</p>

<p style="margin-left:17%; margin-top: 1em">If the guest
uses <small>LVM2</small> you should usually put the
<small>LV</small> of the guest&rsquo;s root filesystem here.
If the guest does not use <small>LVM2</small> or its root
filesystem is not on an <small>LV,</small> don&rsquo;t use
this option.</p>

<p style="margin-left:11%;">&quot;notes=NOTES&quot;</p>

<p style="margin-left:17%;">Any notes that go with this
image, especially notes describing what packages are in the
image, how the image was prepared, and licensing
information.</p>

<p style="margin-left:17%; margin-top: 1em">This
information is shown in the <i>&minus;&minus;notes</i> and
<i>&minus;&minus;list &minus;&minus;long</i> modes.</p>

<p style="margin-left:17%; margin-top: 1em">You can use
multi-line notes here by indenting each new line with at
least one character of whitespace (even on blank lines):</p>

<pre style="margin-left:17%; margin-top: 1em"> notes=This image was prepared using
  the following kickstart script:
                                &lt;&minus;&minus; one space at beginning of line
  part /boot &minus;&minus;fstype ext3
  ...</pre>


<p style="margin-left:11%;">&quot;hidden=true&quot;</p>

<p style="margin-left:17%;">Using the hidden flag prevents
the template from being listed by the
<i>&minus;&minus;list</i> option (but it is still
installable). This is used for test images.</p>

<p style="margin-left:11%;">&quot;aliases=ALIAS1 ALIAS2
...&quot;</p>

<p style="margin-left:17%;">This optional field specifies a
list of aliases, separated by spaces, for the image. For
example, an alias could be used to always point to the
latest version of a certain image, leaving the old versions
available in the index instead of updating the same image
(see the <tt>&quot;revision&quot;</tt> field).</p>

<p style="margin-left:11%; margin-top: 1em"><i>Running
virt-builder against multiple sources</i></p>

<p style="margin-left:11%; margin-top: 1em">It is possible
to use multiple sources with virt-builder. The recommended
way is to deploy <i>.conf</i> files pointing to the index
files. Another way is to specify the sources using multiple
<i>&minus;&minus;source</i> and/or
<i>&minus;&minus;fingerprint</i> options:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder \
   &minus;&minus;source http://example.com/s1/index.asc \
   &minus;&minus;source http://example.com/s2/index.asc</pre>


<p style="margin-left:11%; margin-top: 1em">You can provide
N or 1 fingerprints. In the case where you provide N
fingerprints, N = number of sources and there is a 1&minus;1
correspondence between each source and each fingerprint:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder \
   &minus;&minus;source http://example.com/s1/index.asc &minus;&minus;fingerprint '0123 ...' \
   &minus;&minus;source http://example.com/s2/index.asc &minus;&minus;fingerprint '9876 ...'</pre>


<p style="margin-left:11%; margin-top: 1em">In the case
where you provide 1 fingerprint, the same fingerprint is
used for all sources.</p>

<p style="margin-left:11%; margin-top: 1em">You
<tt>&quot;must&quot;</tt> provide at least 1
fingerprint.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Licensing of
templates</i></p>

<p style="margin-left:11%; margin-top: 1em">You should be
aware of the licensing of images that you distribute. For
open source guests, provide a link to the source code in the
<tt>&quot;notes&quot;</tt> field and comply with other
requirements (eg. around trademarks).</p>

<p style="margin-left:11%; margin-top: 1em"><i>Formal
specification of the index file</i></p>

<p style="margin-left:11%; margin-top: 1em">The index file
format has a formal specification defined by the flex
scanner and bison parser used to parse the file. This can be
found in the following files in the libguestfs source
tree:</p>

<pre style="margin-left:11%; margin-top: 1em"> builder/index&minus;scan.l
 builder/index&minus;parse.y</pre>


<p style="margin-left:11%; margin-top: 1em">A tool called
<i>virt&minus;index&minus;validate</i>(1) is available to
validate the index file to ensure it is correct.</p>

<p style="margin-left:11%; margin-top: 1em">Note that the
parser and tool can work on either the signed or unsigned
index file (ie. <tt>&quot;index&quot;</tt> or
<tt>&quot;index.asc&quot;</tt>).</p>

<p style="margin-left:11%; margin-top: 1em">The index is
always encoded in <small>UTF&minus;8.</small></p>


<p style="margin-left:11%; margin-top: 1em"><small><b>CACHING</b></small>
<i><br>
Caching templates</i></p>

<p style="margin-left:11%; margin-top: 1em">Since the
templates are usually very large, downloaded templates are
cached in the user&rsquo;s home directory.</p>

<p style="margin-left:11%; margin-top: 1em">The location of
the cache is
<tt>&quot;$XDG_CACHE_HOME/virt&minus;builder/&quot;</tt> or
<tt>&quot;$HOME/.cache/virt&minus;builder&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">You can print
out information about the cache directory, including which
guests are currently cached, by doing:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder &minus;&minus;print&minus;cache</pre>


<p style="margin-left:11%; margin-top: 1em">The cache can
be deleted if you want to save space by doing:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder &minus;&minus;delete&minus;cache</pre>


<p style="margin-left:11%; margin-top: 1em">You can
download all (current) templates to the local cache by
doing:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder &minus;&minus;cache&minus;all&minus;templates</pre>


<p style="margin-left:11%; margin-top: 1em">To disable the
template cache, use <i>&minus;&minus;no&minus;cache</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Only templates
are cached. The index and detached digital signatures are
not cached.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Caching
packages</i></p>

<p style="margin-left:11%; margin-top: 1em">Virt-builder
uses <i>curl</i>(1) to download files and it also uses the
current <tt>&quot;http_proxy&quot;</tt> (etc) settings when
installing packages (<i>&minus;&minus;install</i>,
<i>&minus;&minus;update</i>).</p>

<p style="margin-left:11%; margin-top: 1em">You may
therefore want to set those environment variables in order
to maximize the amount of local caching that happens. See
&quot; <small>ENVIRONMENT VARIABLES&quot;</small> and
<i>curl</i>(1).</p>

<p style="margin-left:11%; margin-top: 1em"><i>Local
mirrors</i></p>

<p style="margin-left:11%; margin-top: 1em">To increase
both speed and reliability of installing packages, you can
set up a local mirror of the target distribution, and point
the guest package manager at that.</p>

<p style="margin-left:11%; margin-top: 1em">Because of the
order in which each phase of installation happens, you
cannot use <i>&minus;&minus;write</i> (to point the package
manager at a repo) followed by <i>&minus;&minus;install</i>
(to install from that repo). The <i>&minus;&minus;write</i>
and <i>&minus;&minus;install</i> steps run in the opposite
order, regardless of their order on the command line. You
have to do this using <i>&minus;&minus;run&minus;command</i>
instead of <i>&minus;&minus;install</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Using a local
mirror with Fedora</p>

<p style="margin-left:11%; margin-top: 1em">To install a
Fedora guest using a local mirror:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora 20 \
   &minus;&minus;edit '/etc/yum.repos.d/fedora.repo:
       s{.*baseurl=.*}{baseurl=http://example.com/mirror/};
       s{.*metalink=.*}{};
   ' \
   &minus;&minus;edit '/etc/yum.repos.d/fedora&minus;updates.repo:
       s{.*baseurl=.*}{baseurl=http://example.com/mirror&minus;updates/};
       s{.*metalink=.*}{};
   ' \
   &minus;&minus;run&minus;command 'yum &minus;y update' \
   &minus;&minus;run&minus;command 'yum &minus;y install pkg1 pkg2 ...'</pre>


<p style="margin-left:11%; margin-top: 1em">Using a local
mirror with Debian</p>

<p style="margin-left:11%; margin-top: 1em">Assuming that
you are using <tt>&quot;apt&minus;proxy&quot;</tt> to mirror
the repository, you should create a new
<tt>&quot;sources.list&quot;</tt> file to point to your
proxy (see https://help.ubuntu.com/community/AptProxy) and
then do:</p>

<pre style="margin-left:11%; margin-top: 1em"> virt&minus;builder fedora 20 \
   &minus;&minus;upload sources.list:/etc/apt/sources.list \
   &minus;&minus;run&minus;command 'apt&minus;get &minus;y update' \
   &minus;&minus;run&minus;command 'apt&minus;get &minus;y install pkg1 pkg2 ...'</pre>



<p style="margin-left:11%; margin-top: 1em"><b><small>DIGITAL
SIGNATURES</small></b> <br>
Virt-builder uses <small>GNU</small> Privacy Guard (GnuPG or
gpg) to verify that the index and templates have not been
tampered with.</p>

<p style="margin-left:11%; margin-top: 1em">The source
points to an index file, which is optionally signed.</p>

<p style="margin-left:11%; margin-top: 1em">Virt-builder
downloads the index and checks that the signature is valid
and the signer&rsquo;s fingerprint matches the specified
fingerprint (ie. the one specified in <i>gpgkey=..</i> in
the <i>.conf</i>, or with <i>&minus;&minus;fingerprint</i>,
in that order).</p>

<p style="margin-left:11%; margin-top: 1em">For checking
against the built-in public key/fingerprint, this requires
importing the public key into the user&rsquo;s local gpg
keyring (that&rsquo;s just the way that gpg works).</p>

<p style="margin-left:11%; margin-top: 1em">When a template
is downloaded, its signature is checked in the same way.</p>

<p style="margin-left:11%; margin-top: 1em">Although the
signatures are optional, if you don&rsquo;t have them then
virt-builder users will have to use
<i>&minus;&minus;no&minus;check&minus;signature</i> on the
command line. This prevents an attacker from replacing the
signed index file with an unsigned index file and having
virt-builder silently work without checking the signature.
In any case it is highly recommended that you always create
signed index and templates.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>ARCHITECTURE</small></b>
<br>
Virt-builder can build a guest for any architecture no
matter what the host architecture is. For example an
x86&minus;64 guest on an <small>ARM</small> host.</p>

<p style="margin-left:11%; margin-top: 1em">However certain
options may not work, specifically options that require
running commands in the guest during the build process:
<i>&minus;&minus;install</i>, <i>&minus;&minus;update</i>,
<i>&minus;&minus;run</i>,
<i>&minus;&minus;run&minus;command</i>. You may need to
replace these with their firstboot-equivalents.</p>

<p style="margin-left:11%; margin-top: 1em">An x86&minus;64
host building 32 bit i686 guests should work without any
special steps.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>SECURITY</small></b>
<br>
Virt-builder does not need to run as root (in fact, should
not be run as root), and doesn&rsquo;t use setuid,
<tt>&quot;sudo&quot;</tt> or any similar mechanism.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&minus;&minus;install</i>,
<i>&minus;&minus;update</i>, <i>&minus;&minus;run</i> and
<i>&minus;&minus;run&minus;command</i> are implemented using
an appliance (a small virtual machine) so these commands do
not run on the host. If you are using the libguestfs libvirt
backend and have SELinux enabled then the virtual machine is
additionally encapsulated in an SELinux container
(sVirt).</p>

<p style="margin-left:11%; margin-top: 1em">However these
options will have access to the host&rsquo;s network and
since the template may contain untrusted code, the code
might try to access host network resources which it should
not. You can use <i>&minus;&minus;no&minus;network</i> to
prevent this.</p>

<p style="margin-left:11%; margin-top: 1em">Firstboot
commands run in the context of the guest when it is booted,
and so the security of your hypervisor / cloud should be
considered.</p>

<p style="margin-left:11%; margin-top: 1em">Virt-builder
injects a random seed into every guest which it builds. This
helps to ensure that <small>TCP</small> sequence numbers,
UUIDs, ssh host keys etc are truly random when the guest
boots.</p>

<p style="margin-left:11%; margin-top: 1em">You should
check digital signatures and not ignore any signing
errors.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>CLONES</small></b>
<br>
If you wish to create many new guests of the same type, it
is tempting to run virt-builder once and then copy the
output file. You should <b>not</b> do this. You should run
virt-builder once for each new guest you need.</p>

<p style="margin-left:11%; margin-top: 1em">The reason is
that each clone needs to have (at least) a separate random
seed, and possibly other unique features (such as filesystem
UUIDs) in future versions of virt-builder.</p>

<p style="margin-left:11%; margin-top: 1em">Another thing
you should <i>not</i> do is to boot the guest, then clone
the booted disk image. The reason is that some guests create
unique machine IDs, <small>SSH</small> host keys and so on
at first boot, and you would not want clones to have
duplicate identities.</p>

<p style="margin-left:11%; margin-top: 1em">See also:
<i>virt&minus;sysprep</i>(1).</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>PERFORMANCE</small></b>
<br>
The most important aspect of getting good performance is
caching. Templates gets downloaded into the cache the first
time they are used, or if you use the
<i>&minus;&minus;cache&minus;all&minus;templates</i> option.
See &quot; <small>CACHING&quot;</small> above for further
information.</p>

<p style="margin-left:11%; margin-top: 1em">Packages
required for the <i>&minus;&minus;install</i> and
<i>&minus;&minus;update</i> options are downloaded using the
host network connection. Setting the
<tt>&quot;http_proxy&quot;</tt>,
<tt>&quot;https_proxy&quot;</tt> and
<tt>&quot;ftp_proxy&quot;</tt> environment variables to
point to a local web cache may ensure they only need to be
downloaded once. You can also try using a local package
repository, although this can be complex to set up and
varies according to which Linux distro you are trying to
install.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Using
&minus;&minus;no&minus;sync</i></p>

<p style="margin-left:11%; margin-top: 1em">Use
<i>&minus;&minus;no&minus;sync</i>. However read the caveats
in the &quot; <small>OPTIONS&quot;</small> section above,
since this can cause disk corruption if not used
correctly.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Skipping
virt-resize</i></p>

<p style="margin-left:11%; margin-top: 1em">Virt-builder
can skip the virt-resize step under certain conditions. This
makes virt-builder much faster. The conditions are:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>the output must be a regular file (not a block device),
<b>and</b></p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>the user did <b>not</b> use the
<i>&minus;&minus;size</i> option, <b>and</b></p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>the output format is the same as the template format
(usually raw).</p></td></tr>
</table>


<p style="margin-left:11%; margin-top: 1em"><i>pxzcat</i></p>

<p style="margin-left:11%; margin-top: 1em">Virt-builder
uses an internal implementation of pxzcat (parallel xzcat)
if liblzma was found at build time. If liblzma was not found
at build time, regular <tt>&quot;xzcat&quot;</tt> is used
which is single-threaded.</p>

<p style="margin-left:11%; margin-top: 1em"><i>User-Mode
Linux</i></p>

<p style="margin-left:11%; margin-top: 1em">You can use
virt-builder with the User-Mode Linux ( <small>UML</small> )
backend. This may be faster when running virt-builder inside
a virtual machine (eg. in the cloud).</p>

<p style="margin-left:11%; margin-top: 1em">To enable the
<small>UML</small> backend, read the instructions in
&quot;USER-MODE <small>LINUX BACKEND&quot;</small> in
<i>guestfs</i>(3).</p>

<p style="margin-left:11%; margin-top: 1em">Currently you
have to use the <i>&minus;&minus;no&minus;network</i>
option. This should be fixed in a future version.</p>

<p style="margin-left:11%; margin-top: 1em">The qcow2
output format is not supported by <small>UML.</small> You
can only create raw-format guests.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>SELINUX</small></b>
<br>
Guests which use SELinux (such as Fedora and Red Hat
Enterprise Linux) require that each file has a correct
SELinux label.</p>

<p style="margin-left:11%; margin-top: 1em">Virt-builder
does not know how to give new files a label, so there are
two possible strategies it can use to ensure correct
labelling: <br>
Using <i>&minus;&minus;selinux&minus;relabel</i></p>

<p style="margin-left:17%;">This runs <i>fixfiles</i>(8)
just before finalizing the guest, which sets SELinux labels
correctly in the disk image.</p>

<p style="margin-left:17%; margin-top: 1em">Sometimes
fixfiles is not possible during installation, in which case
this option falls back on:</p>

<p style="margin-left:11%;">Touching
&quot;/.autorelabel&quot;</p>

<p style="margin-left:17%;">Guest templates may already
contain a file called <tt>&quot;/.autorelabel&quot;</tt>, or
it is touched if <i>&minus;&minus;selinux&minus;relabel</i>
cannot run fixfiles.</p>

<p style="margin-left:17%; margin-top: 1em">For guests that
use SELinux, this causes fixfiles to run at first boot.
Guests will reboot themselves once the first time you use
them, which is normal and harmless.</p>

<h2>MACHINE READABLE OUTPUT
<a name="MACHINE READABLE OUTPUT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<i>&minus;&minus;machine&minus;readable</i> option can be
used to make the output more machine friendly, which is
useful when calling virt-builder from other programs, GUIs
etc.</p>

<p style="margin-left:11%; margin-top: 1em">Use the option
on its own to query the capabilities of the virt-builder
binary. Typical output looks like this:</p>

<pre style="margin-left:11%; margin-top: 1em"> $ virt&minus;builder &minus;&minus;machine&minus;readable
 virt&minus;builder
 arch
 config&minus;file
 customize
 json&minus;list
 pxzcat</pre>


<p style="margin-left:11%; margin-top: 1em">A list of
features is printed, one per line, and the program exits
with status 0.</p>

<h2>ENVIRONMENT VARIABLES
<a name="ENVIRONMENT VARIABLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">For other
environment variables which affect all libguestfs programs,
see &quot; <small>ENVIRONMENT VARIABLES&quot;</small> in
<i>guestfs</i>(3). <br>
&quot;http_proxy&quot; <br>
&quot;https_proxy&quot; <br>
&quot;no_proxy&quot;</p>

<p style="margin-left:17%;">Set the proxy for downloads.
These environment variables (and more) are actually
interpreted by <i>curl</i>(1), not virt-builder.</p>

<p style="margin-left:11%;">&quot;HOME&quot;</p>

<p style="margin-left:17%;">Used to determine the location
of the template cache, and the location of the user&rsquo;
sources. See &quot; <small>CACHING&quot;</small> and &quot;
<small>SOURCES OF TEMPLATES&quot;</small> .</p>


<p style="margin-left:11%;">&quot;VIRT_TOOLS_DATA_DIR&quot;</p>

<p style="margin-left:17%;">This can point to the directory
containing data files used for Windows firstboot
installation.</p>

<p style="margin-left:17%; margin-top: 1em">Normally you do
not need to set this. If not set, a compiled-in default will
be used (something like
<tt>&quot;/usr/share/virt&minus;tools&quot;</tt>).</p>

<p style="margin-left:17%; margin-top: 1em">This directory
may contain the following files: <br>
&quot;rhsrvany.exe&quot;</p>

<p style="margin-left:23%;">This is the RHSrvAny Windows
binary, used to install a &quot;firstboot&quot; script in
Windows guests. It is required if you intend to use the
<i>&minus;&minus;firstboot</i> or
<i>&minus;&minus;firstboot&minus;command</i> options with
Windows guests.</p>

<p style="margin-left:23%; margin-top: 1em">See also:
<tt>&quot;https://github.com/rwmjones/rhsrvany&quot;</tt></p>

<p style="margin-left:11%;">&quot;XDG_CACHE_HOME&quot;</p>

<p style="margin-left:17%;">Used to determine the location
of the template cache. See &quot;
<small>CACHING&quot;</small> .</p>


<p style="margin-left:11%;">&quot;XDG_CONFIG_HOME&quot;</p>

<p style="margin-left:17%;">Used to determine the location
of the user&rsquo; sources. See &quot; <small>SOURCES OF
TEMPLATES&quot;</small> .</p>


<p style="margin-left:11%;">&quot;XDG_CONFIG_DIRS&quot;</p>

<p style="margin-left:17%;">Used to determine the location
of the system sources. See &quot; <small>SOURCES OF
TEMPLATES&quot;</small> .</p>

<h2>EXIT STATUS
<a name="EXIT STATUS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This program
returns 0 if successful, or non-zero if there was an
error.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><i>guestfs</i>(3),
<i>guestfish</i>(1), <i>guestmount</i>(1),
<i>virt&minus;copy&minus;out</i>(1),
<i>virt&minus;customize</i>(1),
<i>virt&minus;install</i>(1), <i>virt&minus;rescue</i>(1),
<i>virt&minus;resize</i>(1), <i>virt&minus;sysprep</i>(1),
<i>oz&minus;install</i>(1), <i>gpg</i>(1), <i>curl</i>(1),
<i>virt&minus;make&minus;fs</i>(1), <i>genisoimage</i>(1),
<i>fixfiles</i>(8), http://libguestfs.org/.</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Richard W.M.
Jones http://people.redhat.com/~rjones/</p>

<h2>COPYRIGHT
<a name="COPYRIGHT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Copyright (C)
2013 Red Hat Inc.</p>

<h2>LICENSE
<a name="LICENSE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This program is
free software; you can redistribute it and/or modify it
under the terms of the <small>GNU</small> General Public
License as published by the Free Software Foundation; either
version 2 of the License, or (at your option) any later
version.</p>

<p style="margin-left:11%; margin-top: 1em">This program is
distributed in the hope that it will be useful, but
<small>WITHOUT ANY WARRANTY</small> ; without even the
implied warranty of <small>MERCHANTABILITY</small> or
<small>FITNESS FOR A PARTICULAR PURPOSE.</small> See the
<small>GNU</small> General Public License for more
details.</p>

<p style="margin-left:11%; margin-top: 1em">You should have
received a copy of the <small>GNU</small> General Public
License along with this program; if not, write to the Free
Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
Boston, <small>MA 02110&minus;1301 USA.</small></p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">To get a list
of bugs against libguestfs, use this link:
https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools</p>

<p style="margin-left:11%; margin-top: 1em">To report a new
bug against libguestfs, use this link:
https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools</p>

<p style="margin-left:11%; margin-top: 1em">When reporting
a bug, please supply:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>The version of libguestfs.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>Where you got libguestfs (eg. which Linux distro,
compiled from source, etc)</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>Describe the bug accurately and give a way to reproduce
it.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>Run <i>libguestfs&minus;test&minus;tool</i>(1) and paste
the <b>complete, unedited</b> output into the bug
report.</p> </td></tr>
 </table>
<hr>
</body>
</html>
