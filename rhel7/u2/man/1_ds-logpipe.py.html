<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 01:30:33 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>DS-LOGPIPE.PY</title>

</head>
<body>

<h1 align="center">DS-LOGPIPE.PY</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#DIRECTORY SERVER NOTES">DIRECTORY SERVER NOTES</a><br>
<a href="#AUTHOR">AUTHOR</a><br>
<a href="#REPORTING BUGS">REPORTING BUGS</a><br>
<a href="#COPYRIGHT">COPYRIGHT</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">ds-logpipe.py
&minus; Create and read from a named pipe instead of a log
file</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>ds&minus;logpipe.py</b>
/full/path/to/namedpipe <br>
[<i>-m maxlinestobuffer</i>] [<i>-u userid</i>] [<i>-s
serverpidfile</i>] [<i>-t servertimeout</i>]
[<i>--plugin=/path/to/pluginfile.py</i>]
[<i>pluginfile.arg=value</i>]</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The Named Pipe
Log Script allows you to replace a log file with a named
pipe attached to a script. The server can then send the log
output to a script instead of to a log file. This allows you
to do many different things such as:</p>

<p style="margin-left:11%; margin-top: 1em">* log only
certain events e.g. failed binds, connections from certain
ip addresses, etc. <br>
* log only lines that match a certain pattern <br>
* log only the last N lines - useful for enabling full error
log debug levels in production environments <br>
* send an email or other notification when a certain event
is detected</p>

<p style="margin-left:11%; margin-top: 1em">The script is
written in python, and allows plugins. By default, the
script will log the last N lines (default 1000). There are
two plugins provided - one to log only failed bind attempts,
and one that will log only lines that match given regular
expressions.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">A summary of
options is included below. <b><br>
/full/path/to/namedpipe</b></p>

<p style="margin-left:22%;">Required - full path and file
name of the named pipe. If this does not exist, it will be
created. If it exists and is a named pipe, the script will
use it. If it exists and is not a pipe, the script will
abort. The ownership will be the same as the user running
the script (or see the &minus;u option below).</p>


<p style="margin-left:11%;"><b>&minus;m|&minus;&minus;maxlines=N</b></p>

<p style="margin-left:22%;">Number of lines to buffer -
default is 1000</p>


<p style="margin-left:11%;"><b>&minus;u|&minus;&minus;userid=user</b></p>

<p style="margin-left:22%;">The pipe and any other files
created by the script will be chown()&rsquo;d to this
userid. This may be a string userid name or a numeric userid
value.</p>


<p style="margin-left:11%;"><b>&minus;s|&minus;&minus;serverpidfile=/path/to/servername.pid</b></p>

<p style="margin-left:22%;">If you want the script to exit
when a particular directory server exists, specify the full
path to the file containing the server pid. The default is
usually something like
/var/run/dirsrv/slapd-&lt;instancename&gt;.pid where
&lt;instancename&gt; is usually the hostname</p>


<p style="margin-left:11%;"><b>&minus;t|&minus;&minus;servertimeout=N</b></p>

<p style="margin-left:22%;">Since the serverpidfile may not
exist yet when the script is run, the script will wait by
default 60 seconds for the pid file to exist and the server
to be started. Use this option to specify a different
timeout. The &minus;t option only applies when using
&minus;s or &minus;&minus;serverpid - otherwise it does
nothing.</p>


<p style="margin-left:11%;"><b>&minus;&minus;serverpid=P</b></p>

<p style="margin-left:22%;">IF the server you want to track
is already running, you can specify it using this argument.
If the specified pid is not valid, the script will
abort.</p>


<p style="margin-left:11%;"><b>&minus;p|&minus;&minus;plugin=/full/path/to/pluginname.py</b></p>

<p style="margin-left:22%;">Specify a plugin to use. The
plugin must be a python file and must end in <i>.py</i>. It
must specify a function called <i>plugin</i> and may specify
functions called <i>pre</i> and <i>post</i>.</p>

<p style="margin-left:11%;"><b>pluginname.arg1=value ...
pluginname.argN=value</b></p>

<p style="margin-left:22%;">You can specify arguments to
plugins on the command line. If there is a plugin specified
as &minus;&minus;plugin=/full/path/to/pluginname.py, the
arguments for that plugin are specified as
<i>pluginname.argname=value</i>. The script parses these
arguments and passes them to the plugin <i>pre</i> function
as a python dict. IF there is more than one argument named
<i>pluginname.argname</i> the values are passed as a python
list.</p>

<h2>DIRECTORY SERVER NOTES
<a name="DIRECTORY SERVER NOTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The directory
server will usually need to be configured to log to the
named pipe instead of the usual log file. For example, use
the following LDIF to tell the server to use the file
<i>access.pipe</i> for the access log: <br>
dn: cn=config <br>
changetype: modify <br>
replace: nsslapd-accesslog-maxlogsperdir <br>
nsslapd-accesslog-maxlogsperdir: 1 <br>
- <br>
replace: nsslapd-accesslog-logexpirationtime <br>
nsslapd-accesslog-logexpirationtime: &minus;1 <br>
- <br>
replace: nsslapd-accesslog-logrotationtime <br>
nsslapd-accesslog-logrotationtime: &minus;1 <br>
- <br>
replace: nsslapd-accesslog <br>
nsslapd-accesslog:
/var/log/dirsrv/slapd-localhost/access.pipe <br>
- <br>
replace: nsslapd-accesslog-logbuffering <br>
nsslapd-accesslog-logbuffering: off</p>

<p style="margin-left:11%; margin-top: 1em">NOTE: Before
doing this, you should save your current configuration so
you can restore it later. <br>
ldapsearch ... &minus;s base &minus;b &quot;cn=config&quot;
nsslapd-accesslog-maxlogsperdir
nsslapd-accesslog-logexpirationtime
nsslapd-accesslog-logrotationtime nsslapd-accesslog
nsslapd-accesslog &gt; savedaccesslog.ldif</p>

<p style="margin-left:11%; margin-top: 1em">The error log
and audit log have similarly named configuration attributes
e.g. nsslapd-errorlog, nsslapd-auditlog. Note that the audit
log is disabled by default - use
nsslapd-auditlog-logging-enabled: on to enable it.</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">ds-logpipe.py
was written by the 389 Project.</p>

<h2>REPORTING BUGS
<a name="REPORTING BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Report bugs to
https://fedorahosted.org/389/newticket.</p>

<h2>COPYRIGHT
<a name="COPYRIGHT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Copyright
&copy; 2009 Red Hat, Inc. <br>
This is free software. You may redistribute copies of it
under the terms of the Directory Server license found in the
LICENSE file of this software distribution. This license is
essentially the GNU General Public License version 2 with an
exception for plug-in distribution.</p>
<hr>
</body>
</html>
