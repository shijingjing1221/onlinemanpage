<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 01:23:55 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>Date::Manip::Calc</title>

</head>
<body>

<h1 align="center">Date::Manip::Calc</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#MODE">MODE</a><br>
<a href="#TIMEZONE CONSIDERATIONS">TIMEZONE CONSIDERATIONS</a><br>
<a href="#BUSINESS MODE CONSIDERATIONS">BUSINESS MODE CONSIDERATIONS</a><br>
<a href="#EXACT, SEMI-EXACT, AND APPROXIMATE DATE-DELTA CALCULATIONS">EXACT, SEMI-EXACT, AND APPROXIMATE DATE-DELTA CALCULATIONS</a><br>
<a href="#EXACT, SEMI-EXACT, AND APPROXIMATE DATE-DATE CALCULATIONS">EXACT, SEMI-EXACT, AND APPROXIMATE DATE-DATE CALCULATIONS</a><br>
<a href="#SUBTRACTION">SUBTRACTION</a><br>
<a href="#APPROXIMATE DATE/DATE CALCULATION">APPROXIMATE DATE/DATE CALCULATION</a><br>
<a href="#KNOWN BUGS">KNOWN BUGS</a><br>
<a href="#BUGS AND QUESTIONS">BUGS AND QUESTIONS</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#LICENSE">LICENSE</a><br>
<a href="#AUTHOR">AUTHOR</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">Date::Manip::Calc
&minus; describes date calculations</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Two objects
(both of which are either Date::Manip::Date or
Date::Manip::Delta objects) may be used to creates a third
object based on those two.</p>

<pre style="margin-left:11%; margin-top: 1em">   $delta  = $date&minus;&gt;calc($date2 [,$subtract] [,$mode]);
   $date2  = $date&minus;&gt;calc($delta [,$subtract]);
   $date2  = $delta&minus;&gt;calc($date1 [,$subtract]);
   $delta3 = $delta1&minus;&gt;calc($delta2 [,$subtract] [,$no_normalize]);</pre>


<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This document
describes date calculations. Date calculations involve two
types of Date::Manip objects: dates and deltas. These are
described in the Date::Manip::Date and Date::Manip::Delta
manuals respectively.</p>

<p style="margin-left:11%; margin-top: 1em">Two objects
(two dates, two deltas, or one of each) are used. In all
cases, if a second object is not passed in, undef is
returned.</p>

<p style="margin-left:11%; margin-top: 1em">There are 3
types of date calculations: <b><br>
Date-Date calculations</b></p>

<pre style="margin-left:17%;">   $delta  = $date1&minus;&gt;calc($date2 [,$subtract] [,$mode]);</pre>


<p style="margin-left:17%; margin-top: 1em">Two dates can
be worked with and a delta will be produced which is the
amount of time between the two dates.</p>


<p style="margin-left:17%; margin-top: 1em"><tt>$date1</tt>
and <tt>$date2</tt> are Date::Manip::Date objects with valid
dates. The Date::Manip::Delta object returned is the amount
of time between them. If <tt>$subtract</tt> is not passed in
(or is 0), the delta produced is:</p>

<pre style="margin-left:17%; margin-top: 1em">   DELTA = DATE2 &minus; DATE1</pre>


<p style="margin-left:17%; margin-top: 1em">If
<tt>$subtract</tt> is non-zero, the delta produced is:</p>

<pre style="margin-left:17%; margin-top: 1em">   DELTA = DATE1 &minus; DATE2</pre>


<p style="margin-left:17%; margin-top: 1em">The
<tt>$subtract</tt> argument has special importance when
doing approximate calculations, and this is described
below.</p>

<p style="margin-left:17%; margin-top: 1em">If either date
is invalid, a delta object will be returned which has an
error associated with it.</p>

<p style="margin-left:17%; margin-top: 1em">The
<tt>$mode</tt> argument describes the type of delta is
produced and is described below.</p>

<p style="margin-left:11%;"><b>Date-Delta
calculations</b></p>

<p style="margin-left:17%;">Date-delta calculations can be
performed using either a Date::Manip::Date or
Date::Manip::Delta object as the primary object:</p>

<pre style="margin-left:17%; margin-top: 1em">   $date2  = $date1&minus;&gt;calc($delta [,$subtract]);
   $date2  = $delta&minus;&gt;calc($date1 [,$subtract]);</pre>


<p style="margin-left:17%; margin-top: 1em">A date and
delta can be combined to yield a date that is the given
amount of time before or after it.</p>


<p style="margin-left:17%; margin-top: 1em"><tt>$date1</tt>
and <tt>$delta</tt> are Date::Manip::Date and
Date::Manip::Delta objects respectively. A new
Date::Manip::Date object is produced. If either
<tt>$date1</tt> or <tt>$delta</tt> are invalid, the new date
object will have an error associated with it.</p>

<p style="margin-left:17%; margin-top: 1em">Both of the
calls above perform the same function and produce exactly
the same results.</p>

<p style="margin-left:17%; margin-top: 1em">If
<tt>$subtract</tt> is not passed in, or is 0, the resulting
date is formed as:</p>

<pre style="margin-left:17%; margin-top: 1em">   DATE2 = DATE1 + DELTA</pre>


<p style="margin-left:17%; margin-top: 1em">If
<tt>$subtract</tt> is non-zero, the resulting date is:</p>

<pre style="margin-left:17%; margin-top: 1em">   DATE2 = DATE1 &minus; DELTA</pre>


<p style="margin-left:17%; margin-top: 1em">The
<tt>$subtract</tt> argument has special importance when
doing approximate calculations, and this is described
below.</p>

<p style="margin-left:11%;"><b>Delta-Delta
calculations</b></p>

<p style="margin-left:17%;">Delta-delta calculations can be
performed to add two amounts of time together, or subtract
them.</p>

<pre style="margin-left:17%; margin-top: 1em">   $delta3 = $delta1&minus;&gt;calc($delta2 [,$subtract] [,$no_normalize]);</pre>


<p style="margin-left:17%; margin-top: 1em">If
<tt>$subtract</tt> is not passed in, or is 0, the resulting
delta formed is:</p>

<pre style="margin-left:17%; margin-top: 1em">   DELTA3 = DELTA1 + DELTA2</pre>


<p style="margin-left:17%; margin-top: 1em">If
<tt>$subtract</tt> is non-zero, then the resulting delta
is:</p>

<pre style="margin-left:17%; margin-top: 1em">   DELTA3 = DELTA1 &minus; DELTA2</pre>


<p style="margin-left:17%; margin-top: 1em">$delta1 and
<tt>$delta2</tt> are valid Date::Manip::Delta objects, and a
new Date::Manip::Delta object is produced.</p>


<p style="margin-left:17%; margin-top: 1em"><tt>$no_normalize</tt>
can be the string &rsquo;nonormalize&rsquo; or a non-zero
value (in which case <tt>$subtract</tt> <small>MUST</small>
be entered).</p>

<h2>MODE
<a name="MODE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Date::Manip
calculations can be divide into two different categories:
business and non-business; and within those are three
sub-categories: exact, semi-exact, and approximate. <b><br>
Business and non-business calculations</b></p>

<p style="margin-left:17%;">A business calculation is one
where the length of the day is determined by the length of
the work day, and only business days (i.e. days in which
business is conducted) count. Holidays and weekends are
omitted (though there is some flexibility in defining what
exactly constitutes the work week as described in the
Date::Manip::Config manual). This is described in more
detail below.</p>

<p style="margin-left:17%; margin-top: 1em">A non-business
mode calculation is the normal type of calculation where no
days are ignored, and all days are full length.</p>

<p style="margin-left:11%;"><b>Exact, semi-exact, and
approximate calculations</b></p>

<p style="margin-left:17%;">An exact calculation is one in
which the delta used (or produced) is an exact delta. An
exact delta is described in the Date::Manip::Delta manual,
but the short explanation is that it is a delta which only
involves fields of an exactly known length (hours, minutes,
and seconds). Business deltas also include days in the exact
part. The value of all other fields in the delta will be
zero.</p>

<p style="margin-left:17%; margin-top: 1em">A semi-exact
calculation is one in which the deltas used (or produced) is
a semi-exact delta. This is also described in the
Date::Manip::Delta manual, but the short explanation is that
it includes days and weeks (for standard calculations) or
weeks (for business calculations) in addition to the exact
fields.</p>

<p style="margin-left:17%; margin-top: 1em">A semi-exact
day is defined as the same clock time on two successive
days. So noon to noon is 1 day (even though it may not be
exactly 24 hours due to a daylight saving time transition).
A week is defined as 7 days. This is described in more
detail below.</p>

<p style="margin-left:17%; margin-top: 1em">An approximate
calculation is one in which the deltas used (or produced)
are approximate, and may include any of the fields.</p>

<p style="margin-left:11%; margin-top: 1em">In date-delta
and delta-delta calculations, the mode of the calculation
will be determined automatically by the delta. In the case
of date-date calculations, the mode is supplied as an
argument. <b><br>
Mode in date-date calculations</b></p>

<p style="margin-left:17%;">When doing a date-date
calculation, the following call is used:</p>

<pre style="margin-left:17%; margin-top: 1em">   $delta = $date1&minus;&gt;calc($date2 [,$subtract] [,$mode]);</pre>


<p style="margin-left:17%; margin-top: 1em">$mode defaults
to &quot;exact&quot;. The delta produced will be be either a
business or non-business delta; exact, semi-exact, or
approximate, as specified by <tt>$mode</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">Currently, the
possible values that <tt>$mode</tt> can have are:</p>

<pre style="margin-left:17%; margin-top: 1em">   exact    : an exact, non&minus;business calculation
   semi     : a semi&minus;exact, non&minus;business calculation
   approx   : an approximate, non&minus;business calculation
   business : an exact, business alculation
   bsemi    : a semi&minus;exact, business calculation
   bapprox  : an approximate, business calculation</pre>


<p style="margin-left:11%;"><b>Mode in date-delta
calculations</b></p>

<p style="margin-left:17%;">When doing calculations of a
date and a delta:</p>

<pre style="margin-left:17%; margin-top: 1em">   $date2 = $date1&minus;&gt;calc($delta [,$subtract]);
   $date2 = $delta&minus;&gt;calc($date1 [,$subtract]);</pre>


<p style="margin-left:17%; margin-top: 1em">the mode is not
passed in. It is determined exclusively by the delta. If
<tt>$delta</tt> is a business delta, A business calculation
is done. If <tt>$delta</tt> is a non-business delta, a
non-business calculation will be done.</p>

<p style="margin-left:17%; margin-top: 1em">The
<tt>$delta</tt> will also be classified as exact,
semi-exact, or approximate based on which fields are
non-zero.</p>

<p style="margin-left:11%;"><b>Mode in delta-delta
calculations</b></p>

<p style="margin-left:17%;">When doing calculations with
two deltas:</p>

<pre style="margin-left:17%; margin-top: 1em">   $delta3 = $delta1&minus;&gt;calc($delta2 [,$subtract]);</pre>


<p style="margin-left:17%; margin-top: 1em">the mode is not
passed in. It is determined by the two deltas.</p>

<p style="margin-left:17%; margin-top: 1em">If both deltas
are business mode, or both are non-business mode, a new
delta will be produced of the same type.</p>

<p style="margin-left:17%; margin-top: 1em">It one of the
deltas is a business mode and the other is not, the
resulting delta will have an error condition since there is
no direct correlation between the two types of deltas. Even
though it would be easy to add the two together, it would be
impossible to come up with a result that is meaningful.</p>

<p style="margin-left:17%; margin-top: 1em">If both deltas
are exact, semi-exact, or approximate, the resulting delta
is the same. If one delta is approximate and one is not,
then the resulting delta is approximate. It is
<small>NOT</small> treated as an error. Likewise, if one is
semi-exact and the other exact, a semi-exact delta is
produced.</p>

<h2>TIMEZONE CONSIDERATIONS
<a name="TIMEZONE CONSIDERATIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>date-date
calculations</b></p>

<p style="margin-left:17%;">When doing a business
calculation, both dates must be in the same time zone or an
error is produced.</p>

<p style="margin-left:17%; margin-top: 1em">For the exact,
semi-exact, and approx calculations, when calculating the
difference between two dates in different time zones,
<tt>$date2</tt> will be converted to the same timezone as
<tt>$date1</tt> and the returned date will be in this
timezone.</p>

<p style="margin-left:11%;"><b>date-delta
calculations</b></p>

<p style="margin-left:17%;">When adding a delta to a date,
the resulting date will be in the same time zone as the
original date.</p>

<p style="margin-left:11%;"><b>delta-delta
calculations</b></p>

<p style="margin-left:17%;">No timezone information
applies.</p>

<p style="margin-left:11%; margin-top: 1em">It should also
be noted that daylight saving time considerations are
currently ignored when doing business calculations. In
common usage, daylight saving time changes occurs outside of
the business day, so the business day length is constant. As
a result, daylight saving time is ignored.</p>

<h2>BUSINESS MODE CONSIDERATIONS
<a name="BUSINESS MODE CONSIDERATIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">In order to
correctly do business mode calculations, a config file
should exist which contains the section defining holidays
(otherwise, weekends will be ignored, but all other days
will be counted as business days). This is documented below,
and in the Date::Manip::Config section of the documentation.
Some config variables (namely WorkWeekBeg, WorkWeekEnd,
WorkDayBeg, WorkDayEnd, and WorkDay24Hr) defined the length
of the work week and work day.</p>

<p style="margin-left:11%; margin-top: 1em">If the workday
is defined as 08:00 to 18:00, a work week consisting of
Mon-Sat, and the standard (American) holidays, then from
Tuesday at 12:00 to the following Monday at 14:00 is 5 days
and 2 hours. If the &quot;end&quot; of the day is reached in
a calculation, it automatically switches to the next day.
So, Tuesday at 12:00 plus 6 hours is Wednesday at 08:00
(provided Wed is not a holiday). Also, a date that is not
during a workday automatically becomes the start of the next
workday. So, Sunday 12:00 and Monday at 03:00 both
automatically becomes Monday at 08:00 (provided Monday is
not a holiday).</p>

<p style="margin-left:11%; margin-top: 1em">Note that a
business week is treated the same as an exact week (i.e.
from Tuesday to Tuesday, regardless of holidays). Because
this means that the relationship between days and weeks is
<small>NOT</small> unambiguous, when a semi-exact delta is
produced from two dates, it will be in terms of d/h/mn/s
(i.e. no week field).</p>

<p style="margin-left:11%; margin-top: 1em">Anyone using
business mode is going to notice a few quirks about it which
should be explained. When I designed business mode, I had in
mind what a business which promises 1 business day
turnaround really means.</p>

<p style="margin-left:11%; margin-top: 1em">If you do a
business calculation (with the workday set to
9:00&minus;17:00), you will get the following:</p>

<pre style="margin-left:11%; margin-top: 1em">   Saturday at noon + 1 business day = Tuesday at 9:00
   Saturday at noon &minus; 1 business day = Friday at 9:00</pre>


<p style="margin-left:11%; margin-top: 1em">What does this
mean?</p>

<p style="margin-left:11%; margin-top: 1em">As an example,
say I use a business that works 9&minus;5 and they have a
drop box so I can drop things off over the weekend and they
promise 1 business day turnaround. If I drop something off
Friday night, Saturday, or Sunday, it doesn&rsquo;t matter.
They&rsquo;re going to get started on it Monday morning.
It&rsquo;ll be 1 business day to finish the job, so the
earliest I can expect it to be done is around 17:00 Monday
or 9:00 Tuesday morning. Unfortunately, there is some
ambiguity as to what day 17:00 really falls on, similar to
the ambiguity that occurs when you ask what day midnight
falls on. Although it&rsquo;s not the only answer,
Date::Manip treats midnight as the beginning of a day rather
than the end of one. In the same way, 17:00 is equivalent to
9:00 the next day and any time the date calculations
encounter 17:00, it automatically switch to 9:00 the next
day. Although this introduces some quirks, I think this is
justified. I also think that it is the way most people think
of it. If I drop something off first thing Monday morning, I
would expect to pick it up first thing Tuesday if there is 1
business day turnaround.</p>

<p style="margin-left:11%; margin-top: 1em">Equivalently,
if I want a job to be finished on Saturday (despite the fact
that I cannot pick it up since the business is closed), I
have to drop it off no later than Friday at 9:00. That gives
them a full business day to finish it off. Of course, I
could just as easily drop it off at 17:00 Thursday, or any
time between then and 9:00 Friday. Again, it&rsquo;s a
matter of treating 17:00 as ambiguous.</p>

<p style="margin-left:11%; margin-top: 1em">So Saturday + 1
business day = Tuesday at 9:00 (which means anything from
Monday 17:00 to Tuesday 9:00), but Monday at 9:01 + 1
business day = Tuesday at 9:01 which is unambiguous.</p>

<p style="margin-left:11%; margin-top: 1em">It should be
noted that when adding years, months, and weeks, the
business day is ignored. Once they&rsquo;ve been added, the
resulting date is forced to be a business time (i.e. it
moves to the start of the next business day if it
wasn&rsquo;t one already) before proceeding with the days,
hours, minutes, and seconds part.</p>

<h2>EXACT, SEMI-EXACT, AND APPROXIMATE DATE-DELTA CALCULATIONS
<a name="EXACT, SEMI-EXACT, AND APPROXIMATE DATE-DELTA CALCULATIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">In many cases,
it is somewhat ambiguous what amount of time a delta
actually refers to. Some relationships between fields in the
delta are known. These include:</p>

<pre style="margin-left:11%; margin-top: 1em">  1 year   = 12 months
  1 week   = 7 days
  1 hour   = 60 minutes
  1 minute = 60 seconds</pre>


<p style="margin-left:11%; margin-top: 1em">Other
relationships are not known. These include:</p>

<pre style="margin-left:11%; margin-top: 1em">  1 month  = ? days
  1 day    = ? hours</pre>


<p style="margin-left:11%; margin-top: 1em">For
non-business calculations, a day is usually 24 hours long.
Due to daylight saving time transitions which might make a
day be 23 or 25 hours long (or in some cases, some other
length), the relation is not exact. Whenever possible, a day
is actually measured as the same time on two days (i.e.
Tuesday at noon to Wednesday at noon) even if that period is
not precisely 24 hours. For business calculations, a days
length is determined by the length of the work day and is
known exactly.</p>

<p style="margin-left:11%; margin-top: 1em">Exact
calculations involve <small>ONLY</small> quantities of time
with a known length, so there is no ambiguity in them.</p>

<p style="margin-left:11%; margin-top: 1em">Approximate and
semi-exact calculations involve variable length fields, and
so they must be treated specially.</p>

<p style="margin-left:11%; margin-top: 1em">In order to do
an approximate or semi-exact calculation, the delta is added
to a date in pieces, where the fields in each piece have an
exact and known relationship.</p>

<p style="margin-left:11%; margin-top: 1em">For a
non-business calculation, a calculation occurs in the
following steps:</p>

<pre style="margin-left:11%; margin-top: 1em">  year/month fields added
  week/day fields added
  hour/minute/second fields added</pre>


<p style="margin-left:11%; margin-top: 1em">For a business
calculation, the steps are:</p>

<pre style="margin-left:11%; margin-top: 1em">  year/month fields added
  week field added
  day field added
  hour/minute/second fields added</pre>


<p style="margin-left:11%; margin-top: 1em">After each
step, a valid date must be present, or it will be adjusted
before proceeding to the next step. Note however that for
business calculations, the first step must produce a valid
date, but not necessarily a business date. The second step
will produce a valid business date.</p>

<p style="margin-left:11%; margin-top: 1em">A series of
examples will illustrate this. <b><br>
A date and non-business approximate delta</b></p>

<pre style="margin-left:17%;">   date  = Mar 31 2001 at 12:00:00
   delta = 1 year, 1 month, 1 day, 1 hour</pre>


<p style="margin-left:17%; margin-top: 1em">First, the
year/month fields are added without modifying any other
field. This would produce:</p>

<pre style="margin-left:17%; margin-top: 1em">   Apr 31, 2002 at 12:00</pre>


<p style="margin-left:17%; margin-top: 1em">which is not
valid. Any time the year/month fields produce a day past the
end of the month, the result is &rsquo;truncated&rsquo; to
the last day of the month, so this produces:</p>

<pre style="margin-left:17%; margin-top: 1em">   Apr 30, 2002 at 12:00</pre>


<p style="margin-left:17%; margin-top: 1em">Next the
week/day fields are added producing:</p>

<pre style="margin-left:17%; margin-top: 1em">   May 1, 2002 at 12:00</pre>


<p style="margin-left:17%; margin-top: 1em">and finally,
the exact fields (hour/minute/second) are added to
produce:</p>

<pre style="margin-left:17%; margin-top: 1em">   May 1, 2002 at 13:00</pre>


<p style="margin-left:11%;"><b>A simple business
calculation</b></p>

<p style="margin-left:17%;">Assuming a normal Monday-Friday
work week from 8:00 &minus; 17:00:</p>

<pre style="margin-left:17%; margin-top: 1em">   date  = Wed, Nov 23, 2011 at 12:00
   delta = 1 week, 1 day, 1 hour</pre>


<p style="margin-left:17%; margin-top: 1em">First, the week
field is added:</p>

<pre style="margin-left:17%; margin-top: 1em">   Wed, Nov 30, 2011 at 12:00</pre>


<p style="margin-left:17%; margin-top: 1em">Then the day
field is added:</p>

<pre style="margin-left:17%; margin-top: 1em">   Thu, Dec 1, 2011 at 12:00</pre>


<p style="margin-left:17%; margin-top: 1em">Then the exact
fields are added:</p>

<pre style="margin-left:17%; margin-top: 1em">   Thu, Dec 1, 2011 at 13:00</pre>


<p style="margin-left:11%;"><b>A business example where a
holiday impacts it</b></p>

<p style="margin-left:17%;">In America, Jul 4 is a holiday,
so Mon, Jul 4, 2011 is not a work day.</p>

<pre style="margin-left:17%; margin-top: 1em">   date  = Mon, Jun 27, 2011 at 12:00
   delta = 1 week, 1 day, 1 hour</pre>


<p style="margin-left:17%; margin-top: 1em">First, the week
field is added:</p>

<pre style="margin-left:17%; margin-top: 1em">   Mon, Jul 4, 2011 at 12:00</pre>


<p style="margin-left:17%; margin-top: 1em">Since that is
not a work day, it immediately becomes:</p>

<pre style="margin-left:17%; margin-top: 1em">   Tue, Jul 5, 2011 at 8:00</pre>


<p style="margin-left:17%; margin-top: 1em">Then the day
field is added:</p>

<pre style="margin-left:17%; margin-top: 1em">   Wed, Jul 6, 2011 at 8:00</pre>


<p style="margin-left:17%; margin-top: 1em">and finally the
remaining fields:</p>

<pre style="margin-left:17%; margin-top: 1em">   Wed, Jul 6, 2011 at 9:00</pre>


<p style="margin-left:11%;"><b>Calculation where daylight
savings time impacts it (fall example)</b></p>

<p style="margin-left:17%;">In the America/New_York
timezone (Eastern time), on November 6, 2011, the following
time change occurred:</p>

<pre style="margin-left:17%; margin-top: 1em">   2011&minus;11&minus;06 02:00  EDT  =&gt; 2011&minus;11&minus;06 01:00  EST</pre>


<p style="margin-left:17%; margin-top: 1em">Three simple
calculations illustrate how this is handled:</p>

<pre style="margin-left:17%; margin-top: 1em">   date  = 2011&minus;11&minus;05 02:30 EDT
   delta = 1 day</pre>


<p style="margin-left:17%; margin-top: 1em">Adding the day
produces:</p>

<pre style="margin-left:17%; margin-top: 1em">   2011&minus;11&minus;06 02:30  EDT</pre>


<p style="margin-left:17%; margin-top: 1em">which is valid,
so that is the result.</p>

<p style="margin-left:17%; margin-top: 1em">Similarly:</p>

<pre style="margin-left:17%; margin-top: 1em">   date  = 2011&minus;11&minus;07 02:30 EST
   delta = &minus;1 day</pre>


<p style="margin-left:17%; margin-top: 1em">produces:</p>

<pre style="margin-left:17%; margin-top: 1em">   2011&minus;11&minus;06 02:30 EST</pre>


<p style="margin-left:17%; margin-top: 1em">which is
valid.</p>

<p style="margin-left:17%; margin-top: 1em">Finally:</p>

<pre style="margin-left:17%; margin-top: 1em">   date  = 2011&minus;11&minus;05 02:30 EDT
   delta = 2 days</pre>


<p style="margin-left:17%; margin-top: 1em">produces:</p>

<pre style="margin-left:17%; margin-top: 1em">   2011&minus;11&minus;07 02:30  EST</pre>


<p style="margin-left:17%; margin-top: 1em">The calculation
will preserve the savings time where possible so the
resulting day will have the same offset from
<small>UTC.</small> If that is not possible, but the
resulting day is valid in the other offset, that will be
used instead.</p>

<p style="margin-left:11%;"><b>Calculation where daylight
savings time impacts it (spring example)</b></p>

<p style="margin-left:17%;">In the America/New_York
timezone (Eastern time), on March 13, the following time
change occurred:</p>

<pre style="margin-left:17%; margin-top: 1em">   2011&minus;03&minus;13 02:00  EST  =&gt; 2011&minus;03&minus;13 03:00  EDT</pre>


<p style="margin-left:17%; margin-top: 1em">In this case, a
calculation may produce an invalid date.</p>

<pre style="margin-left:17%; margin-top: 1em">   date  = 2011&minus;03&minus;12 02:30 EST
   delta = 1 day</pre>


<p style="margin-left:17%; margin-top: 1em">produces:</p>

<pre style="margin-left:17%; margin-top: 1em">   2011&minus;03&minus;13 02:30 EST</pre>


<p style="margin-left:17%; margin-top: 1em">This is not
valid. Neither is:</p>

<pre style="margin-left:17%; margin-top: 1em">   2011&minus;03&minus;13 02:30 EDT</pre>


<p style="margin-left:17%; margin-top: 1em">In this case,
the calculation will be redone converting days to
24&minus;hour periods, so the calculation becomes:</p>

<pre style="margin-left:17%; margin-top: 1em">   date  = 2011&minus;03&minus;12 02:30 EST
   delta = 24 hours</pre>


<p style="margin-left:17%; margin-top: 1em">which will
produce a valid date:</p>

<pre style="margin-left:17%; margin-top: 1em">   2011&minus;03&minus;13 03:30 EDT</pre>



<h2>EXACT, SEMI-EXACT, AND APPROXIMATE DATE-DATE CALCULATIONS

<a name="EXACT, SEMI-EXACT, AND APPROXIMATE DATE-DATE CALCULATIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">When
calculating the delta between two dates, the delta may take
different forms depending on the mode passed in. An exact
calculation will produce a delta which included only exact
fields. A semi-exact calculation may produce a semi-exact
delta, and an approximate calculation may produce an
approximate delta. Note that if the two dates are close
enough together, an exact delta will be produced (even if
the mode is semi-exact or approximate), or it may produce a
semi-exact delta in approximate mode.</p>

<p style="margin-left:11%; margin-top: 1em">For example,
the two dates &quot;Mar 12 1995 12:00&quot; and &quot;Apr 13
1995 12:00&quot; would have an exact delta of &quot;744
hours&quot;, and a semi-exact delta of &quot;31 days&quot;.
It would have an approximate delta of &quot;1 month 1
day&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">Two dates,
&quot;Mar 31 12:00&quot; and &quot;Apr 30 12:00&quot; would
have deltas &quot;720 hours&quot; (exact), &quot;30
days&quot; (semi-exact) or &quot;1 month&quot;
(approximate).</p>

<p style="margin-left:11%; margin-top: 1em">Approximate
mode is a more human way of looking at things (you&rsquo;d
say 1 month and 2 days more often then 33 days), but it is
less meaningful in terms of absolute time.</p>

<p style="margin-left:11%; margin-top: 1em">One thing to
remember is that an exact delta is exactly the amount of
time that has passed, including all effects of daylight
saving time. Semi-exact and approximate deltas usually
ignore the affects of daylight saving time.</p>

<h2>SUBTRACTION
<a name="SUBTRACTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">In exact
calculations, and in delta-delta calculations, the the
<tt>$subtract</tt> argument is easy to understand. When
working with an approximate delta however (either when
adding an approximate delta to a date, or when taking two
dates to get an approximate delta), there is a degree of
uncertainty in how the calculation is done, and the
<tt>$subtract</tt> argument is used to specify exactly how
the approximate delta is to be use. An example illustrates
this quite well.</p>

<p style="margin-left:11%; margin-top: 1em">If you take the
date Jan 4, 2000 and subtract a delta of &quot;1 month 1
week&quot; from it, you end up with Nov 27, 1999 (Jan 4,
2000 minus 1 month is Dec 4, 1999; minus 1 week is Nov 27,
1999). But Nov 27, 1999 plus a delta of &quot;1 month 1
week&quot; is Jan 3, 2000 (Nov 27, 1999 plus 1 month is Dec
27, 1999; plus 1 week is Jan 3, 2000).</p>

<p style="margin-left:11%; margin-top: 1em">In other words
the approximate delta (but <small>NOT</small> the exact
delta) is different depending on whether you move from
earlier date to the later date, or vice versa. And depending
on what you are calculating, both are useful.</p>

<p style="margin-left:11%; margin-top: 1em">In order to
resolve this, the <tt>$subtract</tt> argument can take on
the values 0, 1, or 2, and have the meanings described next.
<b><br>
$subtract in approximate date-date calculations</b></p>

<p style="margin-left:17%;">In the call:</p>

<pre style="margin-left:17%; margin-top: 1em">   $delta = $date1&minus;&gt;calc($date2,$subtract,&quot;approx&quot;);</pre>


<p style="margin-left:17%; margin-top: 1em">if
<tt>$subtract</tt> is 0, the resulting delta can be added to
<tt>$date1</tt> to get <tt>$date2</tt>. Obviously
<tt>$delta</tt> may still be negative (if <tt>$date2</tt>
comes before <tt>$date1</tt>).</p>

<p style="margin-left:17%; margin-top: 1em">If
<tt>$subtract</tt> is 1, the resulting delta can be
subtracted from <tt>$date1</tt> to get <tt>$date2</tt> (the
deltas from these two are identical except for having an
opposite sign).</p>

<p style="margin-left:17%; margin-top: 1em">If
<tt>$subtract</tt> is 2, the resulting delta can be added to
<tt>$date2</tt> to get <tt>$date1</tt>. In other words, the
following are identical:</p>

<pre style="margin-left:17%; margin-top: 1em">   $delta = $date1&minus;&gt;calc($date2,2,&quot;approx&quot;);
   $delta = $date2&minus;&gt;calc($date1,&quot;approx&quot;);</pre>


<p style="margin-left:11%;"><b>$subtract in approximate
date-delta calculations</b></p>

<p style="margin-left:17%;">In the call:</p>

<pre style="margin-left:17%; margin-top: 1em">   $date2 = $date1&minus;&gt;calc($delta,$subtract);</pre>


<p style="margin-left:17%; margin-top: 1em">If
<tt>$subtract</tt> is 0, the resulting date is determined by
adding <tt>$delta</tt> to <tt>$date1</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">If
<tt>$subtract</tt> is 1, the resulting date is determined by
subtracting <tt>$delta</tt> from <tt>$date1</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">If
<tt>$subtract</tt> is 2, the resulting date is the date
which <tt>$delta</tt> can be added to to get
<tt>$date1</tt>.</p>

<p style="margin-left:17%; margin-top: 1em">For business
mode calculations, <tt>$date1</tt> will first be adjusted to
be a valid work day (if it isn&rsquo;t already), so this may
lead to non-intuitive results.</p>

<p style="margin-left:17%; margin-top: 1em">In some cases,
it is impossible to do a calculation with <tt>$subtract</tt>
= 2. As an example, if the date is &quot;Dec 31&quot; and
the delta is &quot;1 month&quot;, there is no date which you
can add &quot;1 month&quot; to to get &quot;Dec 31&quot;.
When this occurs, the date returned has an error flag.</p>

<h2>APPROXIMATE DATE/DATE CALCULATION
<a name="APPROXIMATE DATE/DATE CALCULATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">There are two
different ways to look at the approximate delta between two
dates.</p>

<p style="margin-left:11%; margin-top: 1em">In Date::Manip
5.xx, the approximate delta between the two dates:</p>

<pre style="margin-left:11%; margin-top: 1em">   Jan 10 1996 noon
   Jan  7 1998 noon</pre>


<p style="margin-left:11%; margin-top: 1em">was
1:11:4:0:0:0:0 (or 1 year, 11 months, 4 weeks). In
calculating this, the first date was adjusted as far as it
could go towards the second date without going past it with
each unit starting with the years and ending with the
seconds.</p>

<p style="margin-left:11%; margin-top: 1em">This gave a
strictly positive or negative delta, but it isn&rsquo;t
actually how most people would think of the delta.</p>

<p style="margin-left:11%; margin-top: 1em">As of
Date::Manip 6.0, the delta is 2:0:0:&minus;3:0:0:0 (or 2
years minus 3 days). Although this leads to mixed-sign
deltas, it is actually how more people would think about the
delta. It has the additional advantage of being easier to
calculate.</p>

<p style="margin-left:11%; margin-top: 1em">For
non-business mode calculations, the year/month part of the
approximate delta will move a date from the year/month of
the first date into the year/month of the second date. The
remainder of the delta will adjust the
days/hours/minutes/seconds as appropriate.</p>

<p style="margin-left:11%; margin-top: 1em">For approximate
business mode calculations, the year, date, and week parts
will be done approximately, and the remainder will be done
exactly.</p>

<h2>KNOWN BUGS
<a name="KNOWN BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">None known.</p>

<h2>BUGS AND QUESTIONS
<a name="BUGS AND QUESTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Please refer to
the Date::Manip::Problems documentation for information on
submitting bug reports or questions to the author.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Date::Manip
&minus; main module documentation</p>

<h2>LICENSE
<a name="LICENSE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This script is
free software; you can redistribute it and/or modify it
under the same terms as Perl itself.</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Sullivan Beck
(sbeck@cpan.org)</p>
<hr>
</body>
</html>
