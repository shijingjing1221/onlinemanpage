<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 01:11:45 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>NFSTEST</title>

</head>
<body>

<h1 align="center">NFSTEST</h1>

<a href="#NAME">NAME</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#REQUIREMENTS AND LIMITATIONS">REQUIREMENTS AND LIMITATIONS</a><br>
<a href="#TESTS">TESTS</a><br>
<a href="#INSTALLATION">INSTALLATION</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#USEFUL OPTIONS">USEFUL OPTIONS</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#BUGS">BUGS</a><br>
<a href="#AUTHOR">AUTHOR</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">NFStest - NFS
Test Suite</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Provides a set
of tools for testing either the NFS client or the NFS
server, included tests focused mainly on testing the client.
These tools include the following:</p>

<p style="margin-left:11%; margin-top: 1em"><b>Test
utilities package (nfstest)</b> <br>
Provides a set of tools for testing either the NFS client or
the NFS server, most of the functionality is focused mainly
on testing the client. These tools include the
following:</p>

<p style="margin-left:11%; margin-top: 1em">- Process
command line arguments <br>
- Provide functionality for PASS/FAIL <br>
- Provide test grouping functionality <br>
- Provide multiple client support <br>
- Logging mechanism <br>
- Debug info control <br>
- Mount/Unmount control <br>
- Create files/directories <br>
- Provide mechanism to start a packet trace <br>
- Provide mechanism to simulate a network partition <br>
- Support for pNFS testing</p>

<p style="margin-left:11%; margin-top: 1em"><b>Packet trace
package (packet)</b> <br>
Testing NFS has mostly been done using test tools like
connectathon test suite, filebench, iozone and others. But
mostly using the connectathon test suite. These are good
tools for testing, but they are outdated and they also
cannot be used for testing pNFS thoroughly.</p>

<p style="margin-left:11%; margin-top: 1em">For example,
you can run the connectathon test suite on pNFS, it runs, it
passes all the tests -- but how can we make sure that pNFS
worked properly. How can we verify that a layout is granted,
but not only that a layout is granted, what type of layout
was granted (read, rw). Did the client sent IO to the data
servers or to the metadata server.</p>

<p style="margin-left:11%; margin-top: 1em">The Packet
trace module takes a trace file created by tcpdump and
unpacks the contents of each packet. You can decode one
packet at a time, or do a search for specific packets. The
main difference between this modules and other tools used to
decode trace files is that you can use this module to
completely automate your tests.</p>

<p style="margin-left:11%; margin-top: 1em">How does it
work? It opens the trace file and reads one record at a time
keeping track where each record starts. This way, very large
trace files can be opened without having to wait for the
file to load and avoid loading the whole file into
memory.</p>

<p style="margin-left:11%; margin-top: 1em">Packet layers
supported: <br>
- Ethernet II (RFC 894) <br>
- IP layer (supports v4 only) <br>
- TCP layer <br>
- RPC layer <br>
- NFS v4.0 <br>
- NFS v4.1 including pNFS file layouts</p>

<h2>REQUIREMENTS AND LIMITATIONS
<a name="REQUIREMENTS AND LIMITATIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">In order to run
the included tests, the user id in all the client hosts must
have access to run commands as root using the
&rsquo;sudo&rsquo; command without the need for a password,
this includes the host where the test is being executed.
This is used to run commands like &rsquo;mount&rsquo; and
&rsquo;umount&rsquo;. Furthermore, the user id must be able
to ssh to remote hosts without the need for a password if
test requires the use of multiple clients.</p>

<p style="margin-left:11%; margin-top: 1em">Network
partition is simulated by the use of &rsquo;iptables&rsquo;,
please be advised that after every test is run the iptables
is flushed and reset so any rules previously setup will be
lost. Currently, there is no mechanism to restore the
iptables rules to their original state.</p>

<h2>TESTS
<a name="TESTS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>nfstest_cache</b>
<br>
Verify consistency of attribute caching by varying acregmin,
acregmax, acdirmin, acdirmax and actimo. Verify consistency
of data caching by varying acregmin, acregmax, acdirmin,
acdirmax and actimo.</p>

<p style="margin-left:11%; margin-top: 1em">Valid for any
version of NFS</p>


<p style="margin-left:11%; margin-top: 1em"><b>nfstest_delegation</b>
<br>
Basic delegation tests verify that a correct delegation is
granted when opening a file for reading or writing. Also,
another OPEN should not be sent for the same file when the
client is holding a delegation. Verify that the stateid of
all I/O operations should be the delegation stateid. Reads
from a different process on the same file should not cause
the client to send additional READ packets when the client
is holding a read delegation. Furthermore, a LOCK packet
should not be sent to the server when the client is holding
a delegation.</p>

<p style="margin-left:11%; margin-top: 1em">Recall
delegation tests verify the delegation is recalled when a
conflicting operation is sent to the server from a different
client. Conflicting operations are reading, writing and
changing the permissions on the same file. Note, that
reading a file from a different client can only recall a
read delegation. Also, verify that a delegation is not
recalled when a different client is granted a read
delegation. After a delegation is recalled, the client
should send an OPEN with CLAIM_DELEGATE_CUR before returning
the delegation and the stateid should be the same as the
original OPEN stateid. Also, a delegation should not be
granted when re-opening the file right before returning the
delegation. Verify client flushes all written data before
returning the WRITE delegation. The LOCK should be sent as
well right before returning a delegation which has been
recalled. A delegation should not be granted on the second
client who cause the delegation recall on the first
client.</p>

<p style="margin-left:11%; margin-top: 1em">Valid for any
version of NFS granting delegations</p>


<p style="margin-left:11%; margin-top: 1em"><b>nfstest_dio</b>
<br>
Functional direct I/O tests verify that every READ/WRITE is
sent to the server instead of the client caching the
requests. Client bypasses read ahead by sending the READ
with only the requested bytes. Verify the client correctly
handles eof marker when reading the whole file. Verify
client ignores delegation while writing a file.</p>

<p style="margin-left:11%; margin-top: 1em">Direct I/O on
pNFS tests verify the client sends the READ/WRITE to the
correct DS or the MDS if using a PAGESIZE aligned buffer or
not, respectively.</p>

<p style="margin-left:11%; margin-top: 1em">Direct I/O data
correctness tests verify that a file written with buffered
I/O is read correctly with direct I/O. Verify that a file
written with direct I/O is read correctly with buffered
I/O.</p>

<p style="margin-left:11%; margin-top: 1em">Vectored I/O
tests verify coalescence of multiple vectors into one
READ/WRITE packet when all vectors are PAGESIZE aligned.
Vectors with different alignments are sent on separate
packets.</p>

<p style="margin-left:11%; margin-top: 1em">Valid for
NFSv4.0 and NFSv4.1 including pNFS</p>


<p style="margin-left:11%; margin-top: 1em"><b>nfstest_pnfs</b>
<br>
Verify basic pNFS functionality for file (both READ and
WRITE), including opening a second file within the same
mount and having a lock on the file. Also, verify basic pNFS
functionality for a file opened for both READ and WRITE
while reading the file first and then writing to it or the
other way around by writing to the file fist and then
reading the file. These tests verify proper functionality of
pNFS and NFSv4.1 as well:</p>

<p style="margin-left:11%; margin-top: 1em">- Verify
EXCHANGE_ID is sent to MDS <br>
- Verify CREATE_SESSION is sent to MDS <br>
- Verify LAYOUTGET is sent to MDS (check layout type,
iomode, layout range) <br>
- Verify GETDEVICEINFO is sent to MDS <br>
- Verify EXCHANGE_ID is sent to the correct DS <br>
- Verify CREATE_SESSION is sent to DS <br>
- Verify READ/WRITE is sent to DS (check correct stateid,
correct offset and size) <br>
- Verify no GETATTR is sent to DS</p>

<p style="margin-left:11%; margin-top: 1em">Only valid
using NFSv4.1 with pNFS enabled and file layout type</p>


<p style="margin-left:11%; margin-top: 1em"><b>nfstest_posix</b>
<br>
Verify POSIX file system level access over the specified
path using positive and negative testing.</p>

<p style="margin-left:11%; margin-top: 1em">Valid for any
version of NFS</p>

<h2>INSTALLATION
<a name="INSTALLATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">1. Install
package using one of the following methods: <br>
a. Install the rpm as root: <br>
# rpm -i NFStest-1.0.1-1.noarch.rpm</p>

<p style="margin-left:11%; margin-top: 1em">All manual
pages are available <br>
$ man nfstest</p>

<p style="margin-left:11%; margin-top: 1em">Run tests: <br>
$ nfstest_pnfs --help</p>

<p style="margin-left:11%; margin-top: 1em">b. Untar the
tarball: <br>
$ cd ~ <br>
$ tar -zxvf NFStest-1.0.1.tar.gz</p>

<p style="margin-left:11%; margin-top: 1em">The tests can
run without installation, just set the python path <br>
environment variable: <br>
$ export PYTHONPATH=~/NFStest-1.0.1 <br>
$ cd NFStest-1.0.1/test <br>
$ ./nfstest_pnfs --help</p>

<p style="margin-left:11%; margin-top: 1em">Or install to
standard python site-packages and executable directories:
<br>
$ cd ~/NFStest-1.0.1 <br>
$ sudo python setup.py install</p>

<p style="margin-left:11%; margin-top: 1em">All manual
pages are available <br>
$ man nfstest</p>

<p style="margin-left:11%; margin-top: 1em">Run tests: <br>
$ nfstest_pnfs --help</p>

<p style="margin-left:11%; margin-top: 1em">c. Clone the
git repository: <br>
$ cd ~ <br>
$ git clone
git://git.linux-nfs.org/projects/mora/nfstest.git</p>

<p style="margin-left:11%; margin-top: 1em">The tests can
run without installation, just set the python path <br>
environment variable: <br>
$ export PYTHONPATH=~/nfstest <br>
$ cd nfstest/test <br>
$ ./nfstest_pnfs --help</p>

<p style="margin-left:11%; margin-top: 1em">Or install to
standard python site-packages and executable directories:
<br>
$ cd ~/nfstest <br>
$ sudo python setup.py install</p>

<p style="margin-left:11%; margin-top: 1em">All manual
pages are available <br>
$ man nfstest</p>

<p style="margin-left:11%; margin-top: 1em">Run tests: <br>
$ nfstest_pnfs --help</p>

<p style="margin-left:11%; margin-top: 1em">2. Make sure
user running the tests can run commands using
&rsquo;sudo&rsquo; without <br>
the need for a password.</p>

<p style="margin-left:11%; margin-top: 1em">3. Make sure
user running the tests can run commands remotely using
&rsquo;ssh&rsquo; <br>
without the need for a password. This is only needed for
tests which <br>
require multiple clients.</p>

<p style="margin-left:11%; margin-top: 1em">4. Create the
mount point specified by the --mtpoint (default: /mnt/t)
option <br>
on all the clients. <br>
$ sudo mkdir /mnt/t <br>
$ sudo chmod 777 /mnt/t</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The only
required option is --server <br>
$ nfstest_pnfs --server 192.168.0.11</p>

<p style="margin-left:11%; margin-top: 1em">Required
options are --server and --client <br>
$ nfstest_cache --server 192.168.0.11 --client
192.168.0.20</p>

<p style="margin-left:11%; margin-top: 1em">Testing with
different values of --acmin and --acmax (this takes a long
time) <br>
$ nfstest_cache --server 192.168.0.11 --client 192.168.0.20
--acmin 10,20 --acmax 20,30,60,80</p>

<p style="margin-left:11%; margin-top: 1em">The only
required option is --server but only the basic delegation
tests will be run. In order to run the recall tests the
--client option must be used <br>
$ nfstest_delegation --server 192.168.0.11 --client
192.168.0.20</p>

<p style="margin-left:11%; margin-top: 1em">The only
required option is --server <br>
$ nfstest_dio --server 192.168.0.11</p>

<p style="margin-left:11%; margin-top: 1em">The only
required option is --server <br>
$ nfstest_posix --server 192.168.0.11</p>

<h2>USEFUL OPTIONS
<a name="USEFUL OPTIONS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p style="margin-top: 1em"><b>--help</b></p></td>
<td width="2%"></td>
<td width="78%">


<p style="margin-top: 1em">All tests have this option to
display usage information and options available</p></td></tr>
</table>

<p style="margin-left:11%;"><b>--createlog</b></p>

<p style="margin-left:22%;">Create log file when
specified</p>

<p style="margin-left:11%;"><b>--keeptraces</b></p>

<p style="margin-left:22%;">Do not remove any trace files
at the end of execution</p>

<p style="margin-left:11%;"><b>--verbose
&lt;none|opts|info|debug|all|intbitmask&gt;</b></p>

<p style="margin-left:22%;">Verbose level for info/debug
messages</p>

<p style="margin-left:22%; margin-top: 1em">Example: <br>
$ nfstest_posix --server 192.168.0.11 --verbose all <br>
$ nfstest_posix --server 192.168.0.11 --verbose 0x0F</p>

<p style="margin-left:11%;"><b>--runtest
&lt;[^]testname1[,testname2[,...]]&gt;</b></p>

<p style="margin-left:22%;">Comma separated list of tests
to run, if the first character on the list is
&rsquo;^&rsquo; then run all the tests except the ones
listed.</p>

<p style="margin-left:22%; margin-top: 1em">Example: <br>
Run only the access, chdir, creat and fcntl tests <br>
$ nfstest_posix --server 192.168.0.11 --runtest
access,chdir,creat,fcntl</p>

<p style="margin-left:22%; margin-top: 1em">Run all the
tests except for open and chmod <br>
$ nfstest_posix --server 192.168.0.11 --runtest
^open,chmod</p>

<p style="margin-left:11%;"><b>--tverbose
&lt;group|normal|verbose&gt;</b></p>

<p style="margin-left:22%;">Verbose level for test messages
(default: normal) When tverbose=group, only the test groups
are displayed as PASS if all the tests in the group passed,
otherwise it will FAIL. In some of the tests tverbose could
be &rsquo;verbose&rsquo; for a greater level of verbosity in
which a particular test have many sub-tests (&gt;100)</p>

<p style="margin-left:22%; margin-top: 1em">Example: <br>
$ nfstest_posix --server 192.168.0.11 <br>
*** Verify POSIX API access() on NFSv4 <br>
PASS: access - file access allowed with mode F_OK <br>
PASS: access - file access not allowed with mode F_OK for a
non-existent file <br>
PASS: access - file access allowed with mode R_OK for file
with permissions 0777 <br>
PASS: access - file access allowed with mode W_OK for file
with permissions 0777 <br>
PASS: access - file access allowed with mode X_OK for file
with permissions 0777 <br>
...</p>

<p style="margin-left:22%; margin-top: 1em">$ nfstest_posix
--server 192.168.0.11 --tverbose group <br>
PASS: Verify POSIX API access() on NFSv4 (58 passed, 0
failed)</p>

<p style="margin-left:11%;"><b>--bugmsgs
&lt;filename&gt;</b></p>

<p style="margin-left:22%;">File containing test messages
to mark as bugs if they failed. When at least one of the
tests fails the exit code is set to 1. When this option is
specified, all known bugs are not counted as failures so the
whole test execution is not failed. If the known bugs
actually passed, using this option will fail the test to let
the user know that the bug has been fixed.</p>

<p style="margin-left:11%;"><b>--ignore</b></p>

<p style="margin-left:22%;">Ignore all bugs given by
bugmsgs. If this option is specified all failures given by
bugmsgs are ignored. On the other hand, if a test passes
which is marked as a bug, using this option the test will
not failed as when using the bugmsgs option alone.</p>

<p style="margin-left:11%;"><b>--nfsdebug
&lt;flags&gt;</b></p>

<p style="margin-left:22%;">Set NFS kernel debug flags and
save log messages. Use any of the valid flags given for
module &rsquo;nfs&rsquo; on command
&rsquo;rpcdebug&rsquo;.</p>

<p style="margin-left:11%;"><b>--rpcdebug
&lt;flags&gt;</b></p>

<p style="margin-left:22%;">Set RPC kernel debug flags and
save log messages. Use any of the valid flags given for
module &rsquo;rpc&rsquo; on command
&rsquo;rpcdebug&rsquo;.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>nfstest_cache</b>(1),
<b>nfstest_delegation</b>(1), <b>nfstest_dio</b>(1),
<b>nfstest_pnfs</b>(1), <b>nfstest_posix</b>(1)</p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">No known
bugs.</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Jorge Mora
(mora@netapp.com)</p>
<hr>
</body>
</html>
