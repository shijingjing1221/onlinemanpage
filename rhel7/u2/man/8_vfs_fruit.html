<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 02:36:57 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>VFS_FRUIT</title>

</head>
<body>

<h1 align="center">VFS_FRUIT</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#AUTHOR">AUTHOR</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">vfs_fruit
&minus; Enhanced OS X and Netatalk interoperability</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="29%">


<p style="margin-top: 1em">vfs objects = fruit</p></td>
<td width="60%">
</td></tr>
</table>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This VFS module
is part of the <b>samba</b>(7) suite.</p>

<p style="margin-left:11%; margin-top: 1em">The vfs_fruit
module provides enhanced compatibility with Apple SMB
clients and interoperability with a Netatalk 3 AFP
fileserver.</p>

<p style="margin-left:11%; margin-top: 1em">The module
should be stacked with vfs_catia if enabling character
conversion and must be stacked with vfs_streams_xattr, see
the example section for the correct config.</p>

<p style="margin-left:11%; margin-top: 1em">The module
enables alternate data streams (ADS) support for a share,
intercepts the OS X special streams &quot;AFP_AfpInfo&quot;
and &quot;AFP_Resource&quot; and handles them in a special
way. All other named streams are deferred to
vfs_streams_xattr which must be loaded together with
vfs_fruit.</p>

<p style="margin-left:11%; margin-top: 1em">Having shares
with ADS support enabled for OS X client is worthwhile
because it resembles the behaviour of Apple's own SMB server
implementation and it avoids certain severe performance
degradations caused by Samba's case sensitivity
semantics.</p>

<p style="margin-left:11%; margin-top: 1em">The OS X
metadata and resource fork stream can be stored in a way
compatible with Netatalk 3 by setting fruit:resource = file
and fruit:metadata = netatalk.</p>

<p style="margin-left:11%; margin-top: 1em">OS X maps NTFS
illegal characters to the Unicode private range in SMB
requests. By setting fruit:encoding = native, all mapped
characters are converted to native ASCII characters.</p>

<p style="margin-left:11%; margin-top: 1em">Finally, share
access modes are optionally checked against Netatalk AFP
sharing modes by setting fruit:locking = netatalk.</p>

<p style="margin-left:11%; margin-top: 1em">This module is
not stackable other then described in this manpage.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">fruit:resource
= [ file | xattr | stream ]</p>

<p style="margin-left:17%;">Controls where the OS X
resource fork is stored:</p>

<p style="margin-left:23%; margin-top: 1em">&bull; file
(default) &minus; use a ._ AppleDouble file compatible with
OS X and Netatalk</p>

<p style="margin-left:23%; margin-top: 1em">&bull; xattr
&minus; use a xattr, requires a filesystem with large xattr
support and a file IO API compatible with xattrs, this boils
down to Solaris and derived platforms and ZFS</p>

<p style="margin-left:23%; margin-top: 1em">&bull; stream
&minus; pass the stream on to the next module in the VFS
stack</p>

<p style="margin-left:11%; margin-top: 1em">fruit:metadata
= [ stream | netatalk ]</p>

<p style="margin-left:17%;">Controls where the OS X
metadata stream is stored:</p>

<p style="margin-left:23%; margin-top: 1em">&bull; netatalk
(default) &minus; use Netatalk compatible xattr</p>

<p style="margin-left:23%; margin-top: 1em">&bull; stream
&minus; pass the stream on to the next module in the VFS
stack</p>

<p style="margin-left:11%; margin-top: 1em">fruit:locking =
[ netatalk | none ]</p>

<p style="margin-left:23%; margin-top: 1em">&bull; none
(default) &minus; no cross protocol locking</p>

<p style="margin-left:23%; margin-top: 1em">&bull; netatalk
&minus; use cross protocol locking with Netatalk</p>

<p style="margin-left:11%; margin-top: 1em">fruit:encoding
= [ native | private ]</p>

<p style="margin-left:17%;">Controls how the set of illegal
NTFS ASCII character, commonly used by OS X clients, are
stored in the filesystem:</p>

<p style="margin-left:23%; margin-top: 1em">&bull; private
(default) &minus; store characters as encoded by the OS X
client: mapped to the Unicode private range</p>

<p style="margin-left:23%; margin-top: 1em">&bull; native
&minus; store characters with their native ASCII value</p>

<p style="margin-left:11%; margin-top: 1em">fruit:aapl =
yes | no</p>

<p style="margin-left:17%;">A global option whether to
enable Apple's SMB2+ extension codenamed AAPL. Default
<i>yes</i>. This extension enhances several deficiencies
when connecting from Macs:</p>

<p style="margin-left:23%; margin-top: 1em">&bull;
directory enumeration is enriched with Mac relevant
filesystem metadata (UNIX mode, FinderInfo, resource fork
size and effective permission), as a result the Mac client
doesn't need to fetch this metadata individuallly per
directory entry resulting in an often tremendous performance
increase.</p>

<p style="margin-left:23%; margin-top: 1em">&bull; The
ability to query and modify the UNIX mode of directory
entries.</p>

<p style="margin-left:11%; margin-top: 1em">There's a set
of per share options that can be used to disable the
computation of specific Mac metadata in the directory
enumeration context, all are enabled by default:</p>

<p style="margin-left:17%; margin-top: 1em">&bull;
readdir_attr:aapl_rsize = true | false</p>

<p style="margin-left:17%; margin-top: 1em">&bull;
readdir_attr:aapl_finder_info = true | false</p>

<p style="margin-left:17%; margin-top: 1em">&bull;
readdir_attr:aapl_max_access = true | false</p>

<p style="margin-left:11%; margin-top: 1em">fruit:nfs_aces
= yes | no</p>

<p style="margin-left:17%;">Whether support for querying
and modifying the UNIX mode of directory entries via NFS
ACEs is enabled, default <i>yes</i>.</p>


<p style="margin-left:11%; margin-top: 1em">fruit:veto_appledouble
= yes | no</p>

<p style="margin-left:17%;">Whether ._ AppleDouble files
are vetoed which prevents the client from seing and
accessing internal AppleDouble files created by vfs_fruit
itself for the purpose of storing a Mac resource fork.</p>

<p style="margin-left:17%; margin-top: 1em">Vetoing ._
files may break some applications, eg extracting Mac ZIP
archives from Mac clients failes, because they contain ._
files. Setting this option to false will fix this, but the
abstraction leak of exposing the internally created ._ files
may have other unknown side effects.</p>

<p style="margin-left:17%; margin-top: 1em">The default is
<i>yes</i>.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>



<p style="margin-left:17%; margin-top: 1em"><i>[share]</i></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p><b><font color="#0000FF">vfs objects = catia fruit
streams_xattr</font></b></p> </td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p><b><font color="#0000FF">fruit:resource =
file</font></b></p> </td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p><b><font color="#0000FF">fruit:metadata =
netatalk</font></b></p> </td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p><b><font color="#0000FF">fruit:locking =
netatalk</font></b></p> </td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p><b><font color="#0000FF">fruit:encoding =
native</font></b></p> </td></tr>
</table>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><font color="#000000">The
original Samba software and related utilities were created
by Andrew Tridgell. Samba is now developed by the Samba Team
as an Open Source project similar to the way the Linux
kernel is developed.</font></p>
<hr>
</body>
</html>
