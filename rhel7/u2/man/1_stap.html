<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 02:25:51 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>STAP</title>

</head>
<body>

<h1 align="center">STAP</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#ARGUMENTS">ARGUMENTS</a><br>
<a href="#SCRIPT LANGUAGE">SCRIPT LANGUAGE</a><br>
<a href="#PROCESSING">PROCESSING</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#CACHING">CACHING</a><br>
<a href="#SAFETY AND SECURITY">SAFETY AND SECURITY</a><br>
<a href="#UNPRIVILEGED USERS">UNPRIVILEGED USERS</a><br>
<a href="#ALTERNATE RUNTIMES">ALTERNATE RUNTIMES</a><br>
<a href="#EXIT STATUS">EXIT STATUS</a><br>
<a href="#DEPRECATION">DEPRECATION</a><br>
<a href="#FILES">FILES</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#BUGS">BUGS</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">stap &minus;
systemtap script translator/driver</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>stap</b> [
<i>OPTIONS</i> ] <i>FILENAME</i> [ <i>ARGUMENTS</i> ]
<b><br>
stap</b> [ <i>OPTIONS</i> ] <b>&minus;</b> [
<i>ARGUMENTS</i> ] <b><br>
stap</b> [ <i>OPTIONS</i> ] <b>&minus;e</b> <i>SCRIPT</i> [
<i>ARGUMENTS</i> ] <b><br>
stap</b> [ <i>OPTIONS</i> ] <b>&minus;l</b> <i>PROBE</i> [
<i>ARGUMENTS</i> ] <b><br>
stap</b> [ <i>OPTIONS</i> ] <b>&minus;L</b> <i>PROBE</i> [
<i>ARGUMENTS</i> ] <b><br>
stap</b> [ <i>OPTIONS</i> ]
<b>&minus;&minus;dump-probe-types <br>
stap</b> [ <i>OPTIONS</i> ]
<b>&minus;&minus;dump-probe-aliases <br>
stap</b> [ <i>OPTIONS</i> ]
<b>&minus;&minus;dump-functions</b></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The <i>stap</i>
program is the front-end to the Systemtap tool. It accepts
probing instructions written in a simple domain-specific
language, translates those instructions into C code,
compiles this C code, and loads the resulting module into a
running Linux kernel or a DynInst user-space mutator, to
perform the requested system trace/probe functions. You can
supply the script in a named file (FILENAME), from standard
input (use &minus; instead of FILENAME), or from the command
line (using &minus;e SCRIPT). The program runs until it is
interrupted by the user, or if the script voluntarily
invokes the <i>exit()</i> function, or by sufficient number
of soft errors.</p>

<p style="margin-left:11%; margin-top: 1em">The language,
which is described the <i>SCRIPT LANGUAGE</i> section below,
is strictly typed, expressive, declaration free, procedural,
prototyping-friendly, and inspired by <i>awk</i> and
<i>C</i>. It allows source code points or events in the
system to be associated with handlers, which are subroutines
that are executed synchronously. It is somewhat similar
conceptually to &quot;breakpoint command lists&quot; in the
<i>gdb</i> debugger.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The systemtap
translator supports the following options. Any other option
prints a list of supported options. Options may be given on
the command line, as usual. If the file $SYSTEMTAP_DIR/rc
exist, options are also loaded from there and interpreted
first. ($SYSTEMTAP_DIR defaults to $HOME/.systemtap if
unset.)</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p><b>&minus;</b></p></td>
<td width="10%"></td>
<td width="78%">


<p>Use standard input instead of a given FILENAME as probe
language input, unless &minus;e SCRIPT is given.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;h
&minus;&minus;help</b></p>

<p style="margin-left:22%;">Show help message.</p>

<p style="margin-left:11%;"><b>&minus;V
&minus;&minus;version</b></p>

<p style="margin-left:22%;">Show version message.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;p</b> <i>NUM</i></p></td>
<td width="2%"></td>
<td width="78%">


<p>Stop after pass NUM. The passes are numbered 1-5: parse,
elaborate, translate, compile, run. See the
<b>PROCESSING</b> section for details.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;v</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Increase verbosity for all passes. Produce a larger
volume of informative (?) output each time option
repeated.</p> </td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;&minus;vp
ABCDE</b></p>

<p style="margin-left:22%;">Increase verbosity on a
per-pass basis. For example,
&quot;&minus;&minus;vp&nbsp;002&quot; adds 2 units of
verbosity to pass 3 only. The combination
&quot;&minus;v&nbsp;&minus;&minus;vp&nbsp;00004&quot; adds 1
unit of verbosity for all passes, and 4 more for pass 5.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;k</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Keep the temporary directory after all processing. This
may be useful in order to examine the generated C code, or
to reuse the compiled kernel object.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;g</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Guru mode. Enable parsing of unsafe expert-level
constructs like embedded C.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;P</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Prologue-searching mode. Activate heuristics to work
around incorrect debugging information for function
parameter $context variables.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;u</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Unoptimized mode. Disable unused code elision and many
other optimizations during elaboration / translation.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;w</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Suppressed warnings mode. Disables all warning
messages.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;W</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Treat all warnings as errors.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;b</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Use bulk mode (percpu files) for kernel-to-user data
transfer. Use the <i>stap&minus;merge</i> program to
multiplex them back together later.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;t</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Collect timing information on the number of times probe
executes and average amount of time spent in each
probe-point. Also shows the derivation for each
probe-point.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;s</b><i>NUM</i></p></td>
<td width="2%"></td>
<td width="78%">


<p>Use NUM megabyte buffers for kernel-to-user data
transfer. On a multiprocessor in bulk mode, this is a
per-processor amount.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;I</b> <i>DIR</i></p></td>
<td width="2%"></td>
<td width="78%">


<p>Add the given directory to the tapset search directory.
See the description of pass 2 for details.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;D</b>
<i>NAME=VALUE</i></p>

<p style="margin-left:22%;">Add the given C preprocessor
directive to the module Makefile. These can be used to
override limit parameters described below.</p>

<p style="margin-left:11%;"><b>&minus;B</b>
<i>NAME=VALUE</i></p>

<p style="margin-left:22%;">Add the given make directive to
the kernel module build&rsquo;s make invocation. These can
be used to add or override kconfig options.</p>

<p style="margin-left:11%;"><b>&minus;a</b> <i>ARCH</i></p>

<p style="margin-left:22%;">Use a cross-compilation mode
for the given target architecture. This requires access to
the cross-compiler and the kernel build tree, and goes along
with the <b>&minus;B
CROSS_COMPILE=arch&minus;tool&minus;prefix&minus;</b> and
<b>&minus;r /build/tree</b> options.</p>

<p style="margin-left:11%;"><b>&minus;&minus;modinfo</b>
<i>NAME=VALUE</i></p>

<p style="margin-left:22%;">Add the name/value pair as a
MODULE_INFO macro call to the generated module. This may be
useful to inform or override various module-related checks
in the kernel.</p>

<p style="margin-left:11%;"><b>&minus;G</b>
<i>NAME=VALUE</i></p>

<p style="margin-left:22%;">Sets the value of global
variable NAME to VALUE when staprun is invoked. This applies
to scalar variables declared global in the
script/tapset.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;R</b> <i>DIR</i></p></td>
<td width="2%"></td>
<td width="78%">


<p>Look for the systemtap runtime sources in the given
directory.</p> </td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;r</b> <i>/DIR</i></p>

<p style="margin-left:22%;">Build for kernel in given build
tree. Can also be set with the <i>SYSTEMTAP_RELEASE</i>
environment variable.</p>

<p style="margin-left:11%;"><b>&minus;r</b>
<i>RELEASE</i></p>

<p style="margin-left:22%;">Build for kernel in build tree
<b>/lib/modules/RELEASE/build</b>. Can also be set with the
<i>SYSTEMTAP_RELEASE</i> environment variable.</p>

<p style="margin-left:11%;"><b>&minus;m</b>
<i>MODULE</i></p>

<p style="margin-left:22%;">Use the given name for the
generated kernel object module, instead of a unique
randomized name. The generated kernel object module is
copied to the current directory.</p>

<p style="margin-left:11%;"><b>&minus;d</b>
<i>MODULE</i></p>

<p style="margin-left:22%;">Add symbol/unwind information
for the given module into the kernel object module. This may
enable symbolic tracebacks from those modules/programs, even
if they do not have an explicit probe placed into them.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>&minus;&minus;ldd</b></p></td>
<td width="4%"></td>
<td width="78%">


<p>Add symbol/unwind information for all shared libraries
suspected by ldd to be necessary for user-space binaries
being probe or listed with the &minus;d option. Caution:
this can make the probe modules considerably larger.</p></td></tr>
</table>


<p style="margin-left:11%;"><b>&minus;&minus;all&minus;modules</b></p>

<p style="margin-left:22%;">Equivalent to specifying
&quot;&minus;dkernel&quot; and a &quot;&minus;d&quot; for
each kernel module that is currently loaded. Caution: this
can make the probe modules considerably larger.</p>

<p style="margin-left:11%;"><b>&minus;o</b> <i>FILE</i></p>

<p style="margin-left:22%;">Send standard output to named
file. In bulk mode, percpu files will start with FILE_
(FILE_cpu with &minus;F) followed by the cpu number. This
supports strftime(3) formats for FILE.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;c</b> <i>CMD</i></p></td>
<td width="2%"></td>
<td width="78%">


<p>Start the probes, run CMD, and exit when CMD finishes.
This also has the effect of setting target() to the pid of
the command ran.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;x</b> <i>PID</i></p></td>
<td width="2%"></td>
<td width="78%">


<p>Sets target() to PID. This allows scripts to be written
that filter on a specific process. Scripts run independent
of the PID&rsquo;s lifespan.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;e</b>
<i>SCRIPT</i></p>

<p style="margin-left:22%;">Run the given SCRIPT specified
on the command line.</p>

<p style="margin-left:11%;"><b>&minus;E</b>
<i>SCRIPT</i></p>

<p style="margin-left:22%;">Run the given SCRIPT specified.
This SCRIPT is run in addition to the main script specified,
through -e, or as a script file. This option can be repeated
to run multiple scripts, and can be used in listing mode
(&minus;l/&minus;L).</p>

<p style="margin-left:11%;"><b>&minus;l</b>
<i>PROBE</i></p>

<p style="margin-left:22%;">Instead of running a probe
script, just list all available probe points matching the
given single probe point. The pattern may include wildcards
and aliases, but not comma-separated multiple probe points.
The process result code will indicate failure if there are
no matches.</p>

<p style="margin-left:11%;"><b>&minus;L</b>
<i>PROBE</i></p>

<p style="margin-left:22%;">Similar to
&quot;&minus;l&quot;, but list probe points and script-level
local variables.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;F</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Without &minus;o option, load module and start probes,
then detach from the module leaving the probes running. With
&minus;o option, run staprun in background as a daemon and
show its pid.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;S</b>
<i>size[,N]</i></p>

<p style="margin-left:22%;">Sets the maximum size of output
file and the maximum number of output files. If the size of
output file will exceed <b>size</b> , systemtap switches
output file to the next file. And if the number of output
files exceed <b>N</b> , systemtap removes the oldest output
file. You can omit the second argument.</p>


<p style="margin-left:11%;"><b>&minus;&minus;skip&minus;badvars</b></p>

<p style="margin-left:22%;">Ignore unresolvable or
run-time-inaccessible context variables and substitute with
0, without errors.</p>


<p style="margin-left:11%;"><b>&minus;&minus;suppress&minus;handler&minus;errors</b></p>

<p style="margin-left:22%;">Wrap all probe handlers into
something like this</p>

<p style="margin-left:22%; margin-top: 1em">try { ... }
catch { next }</p>

<p style="margin-left:22%; margin-top: 1em">block, which
causes any runtime errors to be quietly suppressed.
Suppressed errors do not count against <b>MAXERRORS</b>
limits. In this mode, the <b>MAXSKIPPED</b> limits are also
suppressed, so that many errors and skipped probes may be
accumulated during a script&rsquo;s runtime. Any overall
counts will still be reported at shutdown.</p>


<p style="margin-left:11%;"><b>&minus;&minus;compatible</b>
<i>VERSION</i></p>

<p style="margin-left:22%;">Suppress recent script language
or tapset changes which are incompatible with given older
version of systemtap. This may be useful if a much older
systemtap script fails to run. See the DEPRECATION section
for more details.</p>


<p style="margin-left:11%;"><b>&minus;&minus;check&minus;version</b></p>

<p style="margin-left:22%;">This option is used to check if
the active script has any constructs that may be systemtap
version specific. See the DEPRECATION section for more
details.</p>


<p style="margin-left:11%;"><b>&minus;&minus;clean&minus;cache</b></p>

<p style="margin-left:22%;">This option prunes stale
entries from the cache directory. This is normally done
automatically after successful runs, but this option will
trigger the cleanup manually and then exit. See the CACHING
section for more details about cache limits.</p>


<p style="margin-left:11%;"><b>&minus;&minus;color</b>[=<i>WHEN</i>],
<b>&minus;&minus;colour</b>[=<i>WHEN</i>]</p>

<p style="margin-left:22%;">This option controls coloring
of error messages. WHEN can be either &quot;never&quot;,
&quot;always&quot;, or &quot;auto&quot; (i.e. enable only if
at a terminal). If WHEN is missing, then &quot;always&quot;
is assumed. If the option is missing, then &quot;auto&quot;
is assumed.</p>

<p style="margin-left:22%; margin-top: 1em">Colors can be
modified using the SYSTEMTAP_COLORS environment variable.
The format must be of the form
<b>key1=val1:key2=val2:key3=val3</b> ...etc. Valid keys are
&quot;error&quot;, &quot;warning&quot;, &quot;source&quot;,
&quot;caret&quot;, and &quot;token&quot;. Values constitute
Select Graphic Rendition (SGR) parameter(s). Consult the
documentation of your terminal for the SGRs it supports. As
an example, the default colors would be expressed as
<b>error=01;31:warning=00;33:source=00;34:caret=01:token=01</b>.
If SYSTEMTAP_COLORS is absent, the default colors will be
used. If it is empty or invalid, coloring is turned off.</p>


<p style="margin-left:11%;"><b>&minus;&minus;disable&minus;cache</b></p>

<p style="margin-left:22%;">This option disables all use of
the cache directory. No files will be either read from or
written to the cache.</p>


<p style="margin-left:11%;"><b>&minus;&minus;poison&minus;cache</b></p>

<p style="margin-left:22%;">This option treats files in the
cache directory as invalid. No files will be read from the
cache, but resulting files from this run will still be
written to the cache. This is meant as a troubleshooting aid
when stap&rsquo;s cached behavior seems to be
misbehaving.</p>


<p style="margin-left:11%;"><b>&minus;&minus;privilege</b>[=<i>stapusr</i>
| =<i>stapsys</i> | =<i>stapdev</i>]</p>

<p style="margin-left:22%;">This option instructs
<i>stap</i> to examine the script looking for constructs
which are not allowed for the specified privilege level (see
<i>UNPRIVILEGED USERS</i>). Compilation fails if any such
constructs are used. If <i>stapusr</i> or <i>stapsys</i> are
specified when using a compile server (see
<i>&minus;&minus;use&minus;server</i>), the server will
examine the script and, if compilation succeeds, the server
will cryptographically sign the resulting kernel module,
certifying that is it safe for use by users at the specified
privilege level.</p>

<p style="margin-left:22%; margin-top: 1em">If
<i>&minus;&minus;privilege</i> has not been specified,
<i>&minus;pN</i> has not been specified with N &lt; 5, and
the invoking user is not <i>root</i>, and is not a member of
the group <i>stapdev</i>, then <i>stap</i> will
automatically add the appropriate
<i>&minus;&minus;privilege</i> option to the options already
specified.</p>


<p style="margin-left:11%;"><b>&minus;&minus;unprivileged</b></p>

<p style="margin-left:22%;">This option is equivalent to
<i>&minus;&minus;privilege=stapusr</i>.</p>


<p style="margin-left:11%;"><b>&minus;&minus;use&minus;server</b>[=<i>HOSTNAME</i>[<i>:PORT</i>]
| =<i>IP_ADDRESS</i>[<i>:PORT</i>] |
=<i>CERT_SERIAL</i>]</p>

<p style="margin-left:22%;">Specify compile&minus;server(s)
to be used for compilation and/or in conjunction with
<i>&minus;&minus;list&minus;servers</i> and
<i>&minus;&minus;trust&minus;servers</i> (see below). If no
argument is supplied, then the default in unprivileged mode
(see <i>&minus;&minus;privilege</i>) is to select compatible
servers which are trusted as SSL peers and as module signers
and currently online. Otherwise the default is to select
compatible servers which are trusted as SSL peers and
currently online. <i>&minus;&minus;use&minus;server</i> may
be specified more than once, in which case a list of servers
is accumulated in the order specified. Servers may be
specified by host name, ip address, or by certificate serial
number (obtained using
<i>&minus;&minus;list&minus;servers</i>). The latter is most
commonly used when adding or revoking trust in a server (see
<i>&minus;&minus;trust&minus;servers</i> below). If a server
is specified by host name or ip address, then an optional
port number may be specified. This is useful for accessing
servers which are not on the local network or to specify a
particular server.</p>

<p style="margin-left:22%; margin-top: 1em">IP addresses
may be IPv4 or IPv6 addresses.</p>

<p style="margin-left:22%; margin-top: 1em">If a particular
IPv6 address is link local and exists on more than one
interface, the intended interface may be specified by
appending the address with a percent sign (%) followed by
the intended interface name. For example,
&quot;fe80::5eff:35ff:fe07:55ca%eth0&quot;.</p>

<p style="margin-left:22%; margin-top: 1em">In order to
specify a port number with an IPv6 address, it is necessary
to enclose the IPv6 address in square brackets ([]) in order
to separate the port number from the rest of the address.
For example, &quot;[fe80::5eff:35ff:fe07:55ca]:5000&quot; or
&quot;[fe80::5eff:35ff:fe07:55ca%eth0]:5000&quot;.</p>

<p style="margin-left:22%; margin-top: 1em">If
<i>&minus;&minus;use&minus;server</i> has not been
specified, <i>&minus;pN</i> has not been specified with N
&lt; 5, and the invoking user not <i>root</i>, is not a
member of the group <i>stapdev</i>, but is a member of the
group <i>stapusr</i>, then <i>stap</i> will automatically
add <i>&minus;&minus;use&minus;server</i> to the options
already specified.</p>


<p style="margin-left:11%;"><b>&minus;&minus;use&minus;server&minus;on&minus;error</b>[=<b>yes</b>|=<b>no</b>]</p>

<p style="margin-left:22%;">Instructs stap to retry
compilation of a script using a compile server if
compilation on the local host fails in a manner which
suggests that it might succeed using a server. If this
option is not specified, the default is <i>no</i>. If no
argument is provided, then the default is <i>yes</i>.
Compilation will be retried for certain types of errors
(e.g. insufficient data or resources) which may not occur
during re&minus;compilation by a compile server. Compile
servers will be selected automatically for the
re&minus;compilation attempt as if
<i>&minus;&minus;use&minus;server</i> was specified with no
arguments.</p>


<p style="margin-left:11%;"><b>&minus;&minus;list&minus;servers</b><i>[=SERVERS]</i></p>

<p style="margin-left:22%;">Display the status of the
requested <i>SERVERS</i>, where <i>SERVERS</i> is a
comma&minus;separated list of server attributes. The list of
attributes is combined to filter the list of servers
displayed. Supported attributes are:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="4%">


<p><b>all</b></p></td>
<td width="6%"></td>
<td width="68%">


<p>specifies all known servers (trusted SSL peers, trusted
module signers, online servers).</p></td></tr>
</table>

<p style="margin-left:22%;"><b>specified</b></p>

<p style="margin-left:32%;">specifies servers specified
using <i>&minus;&minus;use&minus;server</i>.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="9%">


<p><b>online</b></p></td>
<td width="1%"></td>
<td width="68%">


<p>filters the output by retaining information about
servers which are currently online.</p></td></tr>
</table>

<p style="margin-left:22%;"><b>trusted</b></p>

<p style="margin-left:32%;">filters the output by retaining
information about servers which are trusted as SSL
peers.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="9%">


<p><b>signer</b></p></td>
<td width="1%"></td>
<td width="68%">


<p>filters the output by retaining information about
servers which are trusted as module signers (see
<i>&minus;&minus;privilege</i>).</p> </td></tr>
</table>

<p style="margin-left:22%;"><b>compatible</b></p>

<p style="margin-left:32%;">filters the output by retaining
information about servers which are compatible with the
current kernel release and architecture.</p>

<p style="margin-left:22%; margin-top: 1em">If no argument
is provided, then the default is <b>specified</b>. If no
servers were specified using
<i>&minus;&minus;use&minus;server</i>, then the default
servers for <i>&minus;&minus;use&minus;server</i> are
listed.</p>

<p style="margin-left:22%; margin-top: 1em">Note that
<i>&minus;&minus;list&minus;servers</i> uses the
<i>avahi&minus;daemon</i> service to detect online servers.
If this service is not available, then
<i>&minus;&minus;list&minus;servers</i> will fail to detect
any <i>online</i> servers. In order for
<i>&minus;&minus;list&minus;servers</i> to detect servers
listening on IPv6 addresses, the <i>avahi&minus;daemon</i>
configuration file <i>/etc/avahi/avahi-daemon.conf</i> must
contain an active &quot;use-ipv6=yes&quot; line. The service
must be restarted after adding this line in order for IPv6
to be enabled.</p>


<p style="margin-left:11%;"><b>&minus;&minus;trust&minus;servers</b><i>[=TRUST_SPEC]</i></p>

<p style="margin-left:22%;">Grant or revoke trust in
compile&minus;servers, specified using
<i>&minus;&minus;use&minus;server</i> as specified by
TRUST_SPEC, where TRUST_SPEC is a comma&minus;separated list
specifying the trust which is to be granted or revoked.
Supported elements are:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="9%">


<p><b>ssl</b></p></td>
<td width="1%"></td>
<td width="68%">


<p>trust the specified servers as SSL peers.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="9%">


<p><b>signer</b></p></td>
<td width="1%"></td>
<td width="68%">


<p>trust the specified servers as module signers (see
<i>&minus;&minus;privilege</i>). Only root can specify
<b>signer.</b></p> </td></tr>
</table>

<p style="margin-left:22%;"><b>all&minus;users</b></p>

<p style="margin-left:32%;">grant trust as an ssl peer for
all users on the local host. The default is to grant trust
as an ssl peer for the current user only. Trust as a module
signer is always granted for all users. Only root can
specify <b>all&minus;users</b>.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="9%">


<p><b>revoke</b></p></td>
<td width="1%"></td>
<td width="68%">


<p>revoke the specified trust. The default is to grant
it.</p> </td></tr>
</table>

<p style="margin-left:22%;"><b>no&minus;prompt</b></p>

<p style="margin-left:32%;">do not prompt the user for
confirmation before carrying out the requested action. The
default is to prompt the user for confirmation.</p>

<p style="margin-left:22%; margin-top: 1em">If no argument
is provided, then the default is <b>ssl</b>. If no servers
were specified using <i>&minus;&minus;use&minus;server</i>,
then no trust will be granted or revoked.</p>

<p style="margin-left:22%; margin-top: 1em">Unless
<b>no&minus;prompt</b> has been specified, the user will be
prompted to confirm the trust to be granted or revoked
before the operation is performed.</p>


<p style="margin-left:11%;"><b>&minus;&minus;dump-probe-types</b></p>

<p style="margin-left:22%;">Dumps a list of supported probe
types and exits. If <i>&minus;&minus;privilege=stapusr</i>
is also specified, the list will be limited to probe types
available to unprivileged users.</p>


<p style="margin-left:11%;"><b>&minus;&minus;dump-probe-aliases</b></p>

<p style="margin-left:22%;">Dumps a list of all probe
aliases found in library files and exits.</p>


<p style="margin-left:11%;"><b>&minus;&minus;dump-functions</b></p>

<p style="margin-left:22%;">Dumps a list of all functions
found in library files and exits. Also includes their
parameters and types. A function of type
&rsquo;unknown&rsquo; indicates a function that does not
return a value. Note that not all function/parameter types
may be resolved (these are also shown by
&rsquo;unknown&rsquo;). This features is very
memory-intensive and thus may not work properly with
<i>--use-server</i> if the target server imposes an rlimit
on process memory (i.e. through the
<i>~stap-server/.systemtap/rc</i> configuration file, see
<i>stap-server</i>(8)).</p>

<p style="margin-left:11%;"><b>&minus;&minus;remote</b>
<i>URL</i></p>

<p style="margin-left:22%;">Set the execution target to the
given host. This option may be repeated to target multiple
execution targets. Passes 1-4 are completed locally as
normal to build the script, and then pass 5 will copy the
module to the target and run it. Acceptable URL forms
include: <b><br>
[USER@]HOSTNAME</b>, <b>ssh://[USER@]HOSTNAME</b></p>

<p style="margin-left:32%;">This mode uses ssh, optionally
using a username not matching your own. If a custom
ssh_config file is in use, add <b>SendEnv LANG</b> to retain
internationalization functionality.</p>

<p style="margin-left:22%;"><b>libvirt://DOMAIN</b>,
<b>libvirt://DOMAIN/LIBVIRT_URI</b></p>

<p style="margin-left:32%;">This mode uses <i>stapvirt</i>
to execute the script on a domain managed by libvirt.
Optionally, LIBVIRT_URI may be specified to connect to a
specific driver and/or a remote host. For example, to
connect to the local privileged QEMU driver, use:</p>

<p style="margin-left:32%; margin-top: 1em">--remote
libvirt://MyDomain/qemu:///system</p>

<p style="margin-left:32%; margin-top: 1em">See the page at
&lt;http://libvirt.org/uri.html&gt; for supported URIs. Also
see <i>stapvirt</i>(1) for more information on how to
prepare the domain for stap probing.</p>

<p style="margin-left:22%;"><b>unix:PATH</b></p>

<p style="margin-left:32%;">This mode connects to a UNIX
socket. This can be used with a QEMU virtio-serial port for
executing scripts inside a running virtual machine.</p>

<p style="margin-left:22%;"><b>direct://</b></p>

<p style="margin-left:32%;">Special loopback mode to run on
the local host.</p>


<p style="margin-left:11%;"><b>&minus;&minus;remote&minus;prefix</b></p>

<p style="margin-left:22%;">Prefix each line of remote
output with &quot;N: &quot;, where N is the index of the
remote execution target from which the given line
originated.</p>


<p style="margin-left:11%;"><b>&minus;&minus;download&minus;debuginfo</b><i>[=OPTION]</i></p>

<p style="margin-left:22%;">Enable, disable or set a
timeout for the automatic debuginfo downloading feature
offered by abrt as specified by OPTION, where OPTION is one
of the following:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="4%">


<p><b>yes</b></p></td>
<td width="6%"></td>
<td width="68%">


<p>enable automatic downloading of debuginfo with no
timeout. This is the same as not providing an OPTION value
to <i>&minus;&minus;download&minus;debuginfo</i></p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="4%">


<p><b>no</b></p></td>
<td width="6%"></td>
<td width="68%">


<p>explicitly disable automatic downloading of debuginfo.
This is the same as not using the option at all.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="4%">


<p><b>ask</b></p></td>
<td width="6%"></td>
<td width="68%">


<p>show abrt output, and ask before continuing download. No
timeout will be set.</p></td></tr>
</table>

<p style="margin-left:22%;"><b>&lt;timeout&gt;</b></p>

<p style="margin-left:32%;">specify a timeout as a positive
number to stop the download if it is taking too long.</p>


<p style="margin-left:11%;"><b>&minus;&minus;rlimit-as</b><i>=NUM</i></p>

<p style="margin-left:22%;">Specify the maximum size of the
process&rsquo;s virtual memory (address space), in bytes. If
nothing is specified, no limits are imposed.</p>


<p style="margin-left:11%;"><b>&minus;&minus;rlimit-cpu</b><i>=NUM</i></p>

<p style="margin-left:22%;">Specify the CPU time limit, in
seconds. If nothing is specified, no limits are imposed.</p>


<p style="margin-left:11%;"><b>&minus;&minus;rlimit-nproc</b><i>=NUM</i></p>

<p style="margin-left:22%;">Specify the maximum number of
processes that can be created. If nothing is specified, no
limits are imposed.</p>


<p style="margin-left:11%;"><b>&minus;&minus;rlimit-stack</b><i>=NUM</i></p>

<p style="margin-left:22%;">Specify the maximum size of the
process stack, in bytes. If nothing is specified, no limits
are imposed.</p>


<p style="margin-left:11%;"><b>&minus;&minus;rlimit-fsize</b><i>=NUM</i></p>

<p style="margin-left:22%;">Specify the maximum size of
files that the process may create, in bytes. If nothing is
specified, no limits are imposed.</p>


<p style="margin-left:11%;"><b>&minus;&minus;sysroot</b><i>=DIR</i></p>

<p style="margin-left:22%;">Specify sysroot directory where
target files (executables, libraries, etc.) are located.
With <i>&minus;r RELEASE</i>, the sysroot will be searched
for the appropriate kernel build directory. With <i>&minus;r
/DIR</i>, however, the sysroot will not be used to find the
kernel build.</p>


<p style="margin-left:11%;"><b>&minus;&minus;sysenv</b><i>=VAR=VALUE</i></p>

<p style="margin-left:22%;">Provide an alternate value for
an environment variable where the value on a remote system
differs. Path variables (e.g. PATH, LD_LIBRARY_PATH) are
assumed to be relative to the directory provided by
<i>&minus;&minus;sysroot</i>, if provided.</p>


<p style="margin-left:11%;"><b>&minus;&minus;suppress&minus;time&minus;limits</b></p>

<p style="margin-left:22%;">Disable &minus;DSTP_OVERLOAD
related options as well as &minus;DMAXACTION and
&minus;DMAXTRYLOCK. This option requires guru mode.</p>


<p style="margin-left:11%;"><b>&minus;&minus;runtime</b><i>=MODE</i></p>

<p style="margin-left:22%;">Set the pass-5 runtime mode.
Valid options are <i>kernel</i> (default) and
<i>dyninst</i>. See <b>ALTERNATE&nbsp;RUNTIMES</b> below for
more information.</p>


<p style="margin-left:11%;"><b>&minus;&minus;dyninst</b></p>

<p style="margin-left:22%;">Shorthand for
<i>&minus;&minus;runtime=dyninst</i>.</p>


<p style="margin-left:11%;"><b>&minus;&minus;save-uprobes</b></p>

<p style="margin-left:22%;">On machines that require
SystemTap to build its own uprobes module (kernels prior to
version 3.5), this option instructs SystemTap to also save a
copy of the module in the current directory (creating a new
&quot;uprobes&quot; directory first).</p>


<p style="margin-left:11%;"><b>&minus;&minus;target-namespaces</b><i>=PID</i></p>

<p style="margin-left:22%;">Allow for a set of target
namespaces to be set based on the namespaces the given PID
is in. This is for namespace&minus;aware tapset functions.
If the target namespaces was not set, the target defaults to
the stap process&rsquo; namespaces.</p>

<h2>ARGUMENTS
<a name="ARGUMENTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Any additional
arguments on the command line are passed to the script
parser for substitution. See below.</p>

<h2>SCRIPT LANGUAGE
<a name="SCRIPT LANGUAGE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The systemtap
script language resembles <i>awk</i> and <i>C</i>. There are
two main outermost constructs: probes and functions. Within
these, statements and expressions use C-like operator syntax
and precedence.</p>

<p style="margin-left:11%; margin-top: 1em"><b>GENERAL
SYNTAX</b> <br>
Whitespace is ignored. Three forms of comments are
supported:</p>

<p style="margin-left:22%;"><b>#</b> ... shell style, to
the end of line, except for $# and @# <b><br>
//</b> ... C++ style, to the end of line <b><br>
/*</b> ... C style ... <b>*/</b></p>

<p style="margin-left:11%;">Literals are either strings
enclosed in double-quotes (passing through the usual C
escape codes with backslashes, and with adjacent string
literals glued together, also as in C), or integers (in
decimal, hexadecimal, or octal, using the same notation as
in C). All strings are limited in length to some reasonable
value (a few hundred bytes). Integers are 64-bit signed
quantities, although the parser also accepts (and wraps
around) values above positive 2**63.</p>

<p style="margin-left:11%; margin-top: 1em">In addition,
script arguments given at the end of the command line may be
inserted. Use <b>$1 ... $&lt;NN&gt;</b> for insertion
unquoted, <b>@1 ... @&lt;NN&gt;</b> for insertion as a
string literal. The number of arguments may be accessed
through <b>$#</b> (as an unquoted number) or through
<b>@#</b> (as a quoted number). These may be used at any
place a token may begin, including within the preprocessing
stage. Reference to an argument number beyond what was
actually given is an error.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PREPROCESSING</b>
<br>
A simple conditional preprocessing stage is run as a part of
parsing. The general form is similar to the cond <b>?</b>
exp1 <b>:</b> exp2 ternary operator:</p>

<p style="margin-left:22%; margin-top: 1em"><b>%(</b>
CONDITION <b>%?</b> TRUE-TOKENS <b>%) <br>
%(</b> CONDITION <b>%?</b> TRUE-TOKENS <b>%:</b>
FALSE-TOKENS <b>%)</b></p>

<p style="margin-left:11%; margin-top: 1em">The CONDITION
is either an expression whose format is determined by its
first keyword, or a string literals comparison or a numeric
literals comparison. It can be also composed of many
alternatives and conjunctions of CONDITIONs (meant as in
previous sentence) using || and &amp;&amp; respectively.
However, parentheses are not supported yet, so remembering
that conjunction takes precedence over alternative is
important.</p>

<p style="margin-left:11%; margin-top: 1em">If the first
part is the identifier <b>kernel_vr</b> or <b>kernel_v</b>
to refer to the kernel version number, with
(&quot;2.6.13&minus;1.322FC3smp&quot;) or without
(&quot;2.6.13&quot;) the release code suffix, then the
second part is one of the six standard numeric comparison
operators <b>&lt;</b>, <b>&lt;=</b>, <b>==</b>, <b>!=</b>,
<b>&gt;</b>, and <b>&gt;=</b>, and the third part is a
string literal that contains an RPM-style version-release
value. The condition is deemed satisfied if the version of
the target kernel (as optionally overridden by the
<b>&minus;r</b> option) compares to the given version
string. The comparison is performed by the glibc function
<b>strverscmp</b>. As a special case, if the operator is for
simple equality (<b>==</b>), or inequality (<b>!=</b>), and
the third part contains any wildcard characters (<b>*</b> or
<b>?</b> or <b>[</b>), then the expression is treated as a
wildcard (mis)match as evaluated by <b>fnmatch</b>.</p>

<p style="margin-left:11%; margin-top: 1em">If, on the
other hand, the first part is the identifier <b>arch</b> to
refer to the processor architecture (as named by the kernel
build system ARCH/SUBARCH), then the second part is one of
the two string comparison operators <b>==</b> or <b>!=</b>,
and the third part is a string literal for matching it. This
comparison is a wildcard (mis)match.</p>

<p style="margin-left:11%; margin-top: 1em">Similarly, if
the first part is an identifier like <b>CONFIG_something</b>
to refer to a kernel configuration option, then the second
part is <b>==</b> or <b>!=</b>, and the third part is a
string literal for matching the value (commonly
&quot;y&quot; or &quot;m&quot;). Nonexistent or unset kernel
configuration options are represented by the empty string.
This comparison is also a wildcard (mis)match.</p>

<p style="margin-left:11%; margin-top: 1em">If the first
part is the identifier <b>systemtap_v</b>, the test refers
to the systemtap compatibility version, which may be
overridden for old scripts with the
<b>&minus;&minus;compatible</b> flag. The comparison
operator is as is for <b>kernel_v</b> and the right operand
is a version string. See also the DEPRECATION section
below.</p>

<p style="margin-left:11%; margin-top: 1em">If the first
part is the identifier <b>systemtap_privilege</b>, the test
refers to the privilege level that the systemtap script is
compiled with. Here the second part is <b>==</b> or
<b>!=</b>, and the third part is a string literal, either
&quot;stapusr&quot; or &quot;stapsys&quot; or
&quot;stapdev&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">If the first
part is the identifier <b>guru_mode</b>, the test refers to
if the systemtap script is compiled with guru_mode. Here the
second part is <b>==</b> or <b>!=</b>, and the third part is
a number, either 1 or 0.</p>

<p style="margin-left:11%; margin-top: 1em">If the first
part is the identifier <b>runtime</b>, the test refers to
the systemtap runtime mode. See
<b>ALTERNATE&nbsp;RUNTIMES</b> below for more information on
runtimes. The second part is one of the two string
comparison operators <b>==</b> or <b>!=</b>, and the third
part is a string literal for matching it. This comparison is
a wildcard (mis)match.</p>

<p style="margin-left:11%; margin-top: 1em">Otherwise, the
CONDITION is expected to be a comparison between two string
literals or two numeric literals. In this case, the
arguments are the only variables usable.</p>

<p style="margin-left:11%; margin-top: 1em">The TRUE-TOKENS
and FALSE-TOKENS are zero or more general parser tokens
(possibly including nested preprocessor conditionals), and
are passed into the input stream if the condition is true or
false. For example, the following code induces a parse error
unless the target kernel version is newer than 2.6.5:</p>

<p style="margin-left:22%; margin-top: 1em">%( kernel_v
&lt;= &quot;2.6.5&quot; %? **ERROR** %) # invalid token
sequence</p>

<p style="margin-left:11%; margin-top: 1em">The following
code might adapt to hypothetical kernel version drift:</p>

<p style="margin-left:22%; margin-top: 1em">probe
kernel.function ( <br>
%( kernel_v &lt;= &quot;2.6.12&quot; %?
&quot;__mm_do_fault&quot; %: <br>
%( kernel_vr == &quot;2.6.13*smp&quot; %?
&quot;do_page_fault&quot; %: <br>
UNSUPPORTED %) %) <br>
) { /* ... */ }</p>

<p style="margin-left:22%; margin-top: 1em">%( arch ==
&quot;ia64&quot; %? <br>
probe syscall.vliw =
kernel.function(&quot;vliw_widget&quot;) {} <br>
%)</p>


<p style="margin-left:11%; margin-top: 1em"><b>PREPROCESSOR
MACROS</b> <br>
The preprocessor also supports a simple macro facility, run
as a separate pass before conditional preprocessing.</p>

<p style="margin-left:11%; margin-top: 1em">Macros are
defined using the following construct:</p>

<p style="margin-left:22%; margin-top: 1em">@define NAME %(
BODY %) <br>
@define NAME(PARAM_1, PARAM_2, ...) %( BODY %)</p>

<p style="margin-left:11%; margin-top: 1em">Macros, and
parameters inside a macro body, are both invoked by
prefixing the macro name with an @ symbol:</p>

<p style="margin-left:22%; margin-top: 1em">@define foo %(
x %) <br>
@define add(a,b) %( ((@a)+(@b)) %)</p>

<p style="margin-left:22%; margin-top: 1em">@foo =
@add(2,2)</p>

<p style="margin-left:11%; margin-top: 1em">Macro expansion
is currently performed in a separate pass before conditional
compilation. Therefore, both TRUE- and FALSE-tokens in
conditional expressions will be macroexpanded regardless of
how the condition is evaluated. This can sometimes lead to
errors:</p>

<p style="margin-left:22%; margin-top: 1em">// The
following results in a conflict: <br>
%( CONFIG_UTRACE == &quot;y&quot; %? <br>
@define foo %( process.syscall %) <br>
%: <br>
@define foo %( **ERROR** %) <br>
%)</p>

<p style="margin-left:22%; margin-top: 1em">// The
following works properly as expected: <br>
@define foo %( <br>
%( CONFIG_UTRACE == &quot;y&quot; %? process.syscall %:
**ERROR** %) <br>
%)</p>

<p style="margin-left:11%; margin-top: 1em">The first
example is incorrect because both @defines are evaluated in
a pass prior to the conditional being evaluated.</p>

<p style="margin-left:11%; margin-top: 1em">Normally, a
macro definition is local to the file it occurs in. Thus,
defining a macro in a tapset does not make it available to
the user of the tapset. Publically available library macros
can be defined by including .stpm files on the tapset search
path. These files may only contain @define constructs, which
become visible across all tapsets and user scripts.</p>


<p style="margin-left:11%; margin-top: 1em"><b>VARIABLES</b>
<br>
Identifiers for variables and functions are an alphanumeric
sequence, and may include <b>_</b> and <b>$</b> characters.
They may not start with a plain digit, as in C. Each
variable is by default local to the probe or function
statement block within which it is mentioned, and therefore
its scope and lifetime is limited to a particular probe or
function invocation.</p>

<p style="margin-left:11%; margin-top: 1em">Scalar
variables are implicitly typed as either string or integer.
Associative arrays also have a string or integer value, and
a tuple of strings and/or integers serving as a key. Here
are a few basic expressions.</p>

<p style="margin-left:22%; margin-top: 1em">var1 = 5 <br>
var2 = &quot;bar&quot; <br>
array1 [pid()] = &quot;name&quot; # single numeric key <br>
array2 [&quot;foo&quot;,4,i++] += 5 # vector of
string/num/num keys <br>
if ([&quot;hello&quot;,5,4] in array2) println
(&quot;yes&quot;) # membership test</p>

<p style="margin-left:11%; margin-top: 1em">The translator
performs <i>type inference</i> on all identifiers, including
array indexes and function parameters. Inconsistent
type-related use of identifiers signals an error.</p>

<p style="margin-left:11%; margin-top: 1em">Variables may
be declared global, so that they are shared amongst all
probes and live as long as the entire systemtap session.
There is one namespace for all global variables, regardless
of which script file they are found within. Concurrent
access to global variables is automatically protected with
locks, see the <b>SAFETY AND SECURITY</b> section for more
details. A global declaration may be written at the
outermost level anywhere, not within a block of code. Global
variables which are written but never read will be displayed
automatically at session shutdown. The translator will infer
for each its value type, and if it is used as an array, its
key types. Optionally, scalar globals may be initialized
with a string or number literal. The following declaration
marks variables as global.</p>

<p style="margin-left:22%; margin-top: 1em"><b>global</b>
var1<b>,</b> var2<b>,</b> var3=4</p>

<p style="margin-left:11%; margin-top: 1em">Global
variables can also be set as module options. One can do this
by either using the &minus;G option, or the module must
first be compiled using stap &minus;p4. Global variables can
then be set on the command line when calling staprun on the
module generated by stap &minus;p4. See <i>staprun</i>(8)
for more information.</p>

<p style="margin-left:11%; margin-top: 1em">Arrays are
limited in size by the MAXMAPENTRIES variable -- see the
<b>SAFETY AND SECURITY</b> section for details. Optionally,
global arrays may be declared with a maximum size in
brackets, overriding MAXMAPENTRIES for that array only. Note
that this doesn&rsquo;t indicate the type of keys for the
array, just the size.</p>

<p style="margin-left:22%; margin-top: 1em"><b>global</b>
tiny_array[10]<b>,</b> normal_array<b>,</b>
big_array[50000]</p>

<p style="margin-left:11%; margin-top: 1em">Arrays may be
configured for wrapping using the &rsquo;%&rsquo; suffix.
This causes older elements to be overwritten if more
elements are inserted than the array can hold. This works
for both associative and statistics typed arrays.</p>

<p style="margin-left:22%; margin-top: 1em"><b>global</b>
wrapped_array1%[10]<b>,</b> wrapped_array2%</p>

<p style="margin-left:11%; margin-top: 1em">Many types of
probe points provide context variables, which are run-time
values, safely extracted from the kernel or userspace
program being probed. These are prefixed with the <b>$</b>
character. The CONTEXT VARIABLES section in
<i>stapprobes</i>(3stap) lists what is available for each
type of probe point. These context variables become normal
string or numeric scalars once they are stored in normal
script variables. See the TYPECASTING section below on how
to to turn them back into typed pointers for further
processing as context variables.</p>


<p style="margin-left:11%; margin-top: 1em"><b>STATEMENTS</b>
<br>
Statements enable procedural control flow. They may occur
within functions and probe handlers. The total number of
statements executed in response to any single probe event is
limited to some number defined by a macro in the translated
C code, and is in the neighbourhood of 1000.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p>EXP</p></td>
<td width="7%"></td>
<td width="78%">


<p>Execute the string- or integer-valued expression and
throw away the value.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>{</b> STMT1 STMT2 ...
<b>}</b></p>

<p style="margin-left:22%;">Execute each statement in
sequence in this block. Note that separators or terminators
are generally not necessary between statements.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p><b>;</b></p></td>
<td width="10%"></td>
<td width="78%">


<p>Null statement, do nothing. It is useful as an optional
separator between statements to improve syntax-error
detection and to handle certain grammar ambiguities.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>if</b> (EXP) STMT1 [
<b>else</b> STMT2 ]</p>

<p style="margin-left:22%;">Compare integer-valued EXP to
zero. Execute the first (non-zero) or second STMT
(zero).</p>

<p style="margin-left:11%;"><b>while</b> (EXP) STMT</p>

<p style="margin-left:22%;">While integer-valued EXP
evaluates to non-zero, execute STMT.</p>

<p style="margin-left:11%;"><b>for</b> (EXP1; EXP2; EXP3)
STMT</p>

<p style="margin-left:22%;">Execute EXP1 as initialization.
While EXP2 is non-zero, execute STMT, then the iteration
expression EXP3.</p>

<p style="margin-left:11%;"><b>foreach</b> (VAR <b>in</b>
ARRAY [ <b>limit</b> EXP ]) STMT</p>

<p style="margin-left:22%;">Loop over each element of the
named global array, assigning current key to VAR. The array
may not be modified within the statement. By adding a single
<b>+</b> or <b>&minus;</b> operator after the VAR or the
ARRAY identifier, the iteration will proceed in a sorted
order, by ascending or descending index or value. If the
array contains statistics aggregates, adding the desired
<b>@operator</b> between the ARRAY identifier and the
<b>+</b> or <b>&minus;</b> will specify the sorting
aggregate function. See the STATISTICS section below for the
ones available. Default is <b>@count</b>. Using the optional
<b>limit</b> keyword limits the number of loop iterations to
EXP times. EXP is evaluated once at the beginning of the
loop.</p>

<p style="margin-left:11%;"><b>foreach</b> ([VAR1, VAR2,
...] <b>in</b> ARRAY [ <b>limit</b> EXP ]) STMT</p>

<p style="margin-left:22%;">Same as above, used when the
array is indexed with a tuple of keys. A sorting suffix may
be used on at most one VAR or ARRAY identifier.</p>

<p style="margin-left:11%;"><b>foreach</b> ([VAR1, VAR2,
...] <b>in</b> ARRAY [INDEX1, INDEX2, ...] [ <b>limit</b>
EXP <br>
]) STMT</p>

<p style="margin-left:22%;">Same as above, where iterations
are limited to elements in the array where the keys match
the index values specified. The symbol * can be used to
specify an index and will be treated as a wildcard.</p>

<p style="margin-left:11%;"><b>foreach</b> (VALUE = VAR
<b>in</b> ARRAY [ <b>limit</b> EXP ]) STMT</p>

<p style="margin-left:22%;">This variant of foreach saves
current value into VALUE on each iteration, so it is the
same as ARRAY[VAR]. This also works with a tuple of keys.
Sorting suffixes on VALUE have the same effect as on
ARRAY.</p>

<p style="margin-left:11%;"><b>foreach</b> (VALUE = VAR
<b>in</b> ARRAY [INDEX1, INDEX2, ...] [ <b>limit</b> EXP ])
STMT</p>

<p style="margin-left:22%;">Same as above, where iterations
are limited to elements in the array where the keys match
the index values specified. The symbol * can be used to
specify an index and will be treated as a wildcard.</p>

<p style="margin-left:11%;"><b>break</b>,
<b>continue</b></p>

<p style="margin-left:22%;">Exit or iterate the innermost
nesting loop (<b>while</b> or <b>for</b> or <b>foreach</b>)
statement.</p>

<p style="margin-left:11%;"><b>return</b> EXP</p>

<p style="margin-left:22%;">Return EXP value from enclosing
function. If the function&rsquo;s value is not taken
anywhere, then a return statement is not needed, and the
function will have a special &quot;unknown&quot; type with
no return value.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><b>next</b></p></td>
<td width="5%"></td>
<td width="78%">


<p>Return now from enclosing probe handler. This is
especially useful in probe aliases that apply event
filtering predicates.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>try</b> { STMT1 }
<b>catch</b> { STMT2 }</p>

<p style="margin-left:22%;">Run the statements in the first
block. Upon any run-time errors, abort STMT1 and start
executing STMT2. Any errors in STMT2 will propagate to outer
try/catch blocks, if any.</p>

<p style="margin-left:11%;"><b>try</b> { STMT1 }
<b>catch</b>(VAR) { STMT2 }</p>

<p style="margin-left:22%;">Same as above, plus assign the
error message to the string scalar variable VAR.</p>

<p style="margin-left:11%;"><b>delete</b> ARRAY[INDEX1,
INDEX2, ...]</p>

<p style="margin-left:22%;">Remove from ARRAY the element
specified by the index tuple. If the index tuple contains a
* in place of an index, the * is treated as a wildcard and
all elements with keys that match the index tuple will be
removed from ARRAY. The value will no longer be available,
and subsequent iterations will not report the element. It is
not an error to delete an element that does not exist.</p>

<p style="margin-left:11%;"><b>delete</b> ARRAY</p>

<p style="margin-left:22%;">Remove all elements from
ARRAY.</p>

<p style="margin-left:11%;"><b>delete</b> SCALAR</p>

<p style="margin-left:22%;">Removes the value of SCALAR.
Integers and strings are cleared to 0 and &quot;&quot;
respectively, while statistics are reset to the initial
empty state.</p>


<p style="margin-left:11%; margin-top: 1em"><b>EXPRESSIONS</b>
<br>
Systemtap supports a number of operators that have the same
general syntax, semantics, and precedence as in C and awk.
Arithmetic is performed as per typical C rules for signed
integers. Division by zero or overflow is detected and
results in an error. <br>
binary numeric operators</p>

<p style="margin-left:22%;"><b>* / % + &minus; &gt;&gt;
&lt;&lt; &amp; ^ | &amp;&amp; ||</b></p>

<p style="margin-left:11%;">binary string operators</p>

<p style="margin-left:22%;"><b>.</b> (string
concatenation)</p>

<p style="margin-left:11%;">numeric assignment
operators</p>

<p style="margin-left:22%;"><b>= *= /= %= += &minus;=
&gt;&gt;= &lt;&lt;= &amp;= ^= |=</b></p>

<p style="margin-left:11%;">string assignment operators</p>

<p style="margin-left:22%;"><b>= .=</b></p>

<p style="margin-left:11%;">unary numeric operators</p>

<p style="margin-left:22%;"><b>+ &minus; ! ~ ++
&minus;&minus;</b></p>

<p style="margin-left:11%;">binary numeric, string
comparison or regex matching operators</p>

<p style="margin-left:22%;"><b>&lt; &gt; &lt;= &gt;= == !=
=~ !~</b></p>

<p style="margin-left:11%;">ternary operator</p>

<p style="margin-left:22%;">cond <b>?</b> exp1 <b>:</b>
exp2</p>

<p style="margin-left:11%;">grouping operator</p>

<p style="margin-left:22%;"><b>(</b> exp <b>)</b></p>

<p style="margin-left:11%;">function call</p>

<p style="margin-left:22%;">fn <b>(</b>[ arg1, arg2, ...
]<b>)</b></p>

<p style="margin-left:11%;">array membership check</p>

<p style="margin-left:22%;">exp <b>in</b> array <b><br>
[</b>exp1<b>,</b> exp2<b>,</b> ...<b>] in</b> array <b><br>
[</b>*<b>,</b> *<b>, ...</b> ]<b>in</b> array</p>

<p style="margin-left:11%; margin-top: 1em"><b>REGULAR
EXPRESSION MATCHING</b> <br>
The scripting language supports regular expression matching.
The basic syntax is as follows:</p>

<p style="margin-left:22%; margin-top: 1em"><b>exp</b> =~
<b>regex <br>
exp</b> !~ <b>regex</b></p>

<p style="margin-left:11%; margin-top: 1em">(The first
operand must be an expression evaluating to a string; the
second operand must be a string literal containing a
syntactically valid regular expression.)</p>

<p style="margin-left:11%; margin-top: 1em">The regular
expression syntax supports most of the features of POSIX
Extended Regular Expressions, except for subexpression reuse
(&quot;\1&quot;) functionality. The ability to capture and
extract the contents of the matched string and
subexpressions has not yet been implemented.</p>

<p style="margin-left:11%; margin-top: 1em"><b>PROBES</b>
<br>
The main construct in the scripting language identifies
probes. Probes associate abstract events with a statement
block (&quot;probe handler&quot;) that is to be executed
when any of those events occur. The general syntax is as
follows:</p>

<p style="margin-left:22%; margin-top: 1em"><b>probe</b>
PROBEPOINT [<b>,</b> PROBEPOINT] <b>{</b> [STMT ...] <b>}
<br>
probe</b> PROBEPOINT [<b>,</b> PROBEPOINT] <b>if
(</b>CONDITION<b>) {</b> [STMT ...] <b>}</b></p>

<p style="margin-left:11%; margin-top: 1em">Events are
specified in a special syntax called &quot;probe
points&quot;. There are several varieties of probe points
defined by the translator, and tapset scripts may define
further ones using aliases. Probe points may be wildcarded,
grouped, or listed in preference sequences, or declared
optional. More details on probe point syntax and semantics
are listed on the <i>stapprobes</i>(3stap) manual page.</p>

<p style="margin-left:11%; margin-top: 1em">The probe
handler is interpreted relative to the context of each
event. For events associated with kernel code, this context
may include <i>variables</i> defined in the <i>source
code</i> at that spot. These &quot;context variables&quot;
are presented to the script as variables whose names are
prefixed with &quot;$&quot;. They may be accessed only if
the kernel&rsquo;s compiler preserved them despite
optimization. This is the same constraint that a debugger
user faces when working with optimized code. In addition,
the objects must exist in paged-in memory at the moment of
the systemtap probe handler&rsquo;s execution, because
systemtap must not cause (suppresses) any additional paging.
Some probe types have very little context. See the
<i>stapprobes</i>(3stap) man pages to see the kinds of
context variables available at each kind of probe point.</p>

<p style="margin-left:11%; margin-top: 1em">Probes may be
decorated with an <i>arming condition</i>, consisting of a
simple boolean expression on read-only global script
variables. While disarmed (condition evaluates to false),
some probe types reduce or eliminate their run-time
overheads. When an arming condition evaluates to true,
probes will be <i>soon</i> re-armed, and their probe
handlers will start getting called as the events fire. (Some
events may be lost during the arming interval. If this is
unacceptable, do not use arming conditions for those
probes.)</p>

<p style="margin-left:11%; margin-top: 1em">New probe
points may be defined using &quot;aliases&quot;. Probe point
aliases look similar to probe definitions, but instead of
activating a probe at the given point, it just defines a new
probe point name as an alias to an existing one. There are
two types of alias, i.e. the prologue style and the epilogue
style which are identified by &quot;=&quot; and
&quot;+=&quot; respectively.</p>

<p style="margin-left:11%; margin-top: 1em">For prologue
style alias, the statement block that follows an alias
definition is implicitly added as a prologue to any probe
that refers to the alias. While for the epilogue style
alias, the statement block that follows an alias definition
is implicitly added as an epilogue to any probe that refers
to the alias. For example:</p>

<p style="margin-left:22%; margin-top: 1em">probe
syscall.read = kernel.function(&quot;sys_read&quot;) { <br>
fildes = $fd <br>
if (execname() == &quot;init&quot;) next # skip rest of
probe <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">defines a new
probe point <i>syscall.read</i>, which expands to
<i>kernel.function(&quot;sys_read&quot;)</i>, with the given
statement as a prologue, which is useful to predefine some
variables for the alias user and/or to skip probe processing
entirely based on some conditions. And</p>

<p style="margin-left:22%; margin-top: 1em">probe
syscall.read += kernel.function(&quot;sys_read&quot;) { <br>
if (tracethis) println ($fd) <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">defines a new
probe point with the given statement as an epilogue, which
is useful to take actions based upon variables set or left
over by the the alias user. Please note that in each case,
the statements in the alias handler block are treated
ordinarily, so that variables assigned there constitute mere
initialization, not a macro substitution.</p>

<p style="margin-left:11%; margin-top: 1em">An alias is
used just like a built-in probe type.</p>

<p style="margin-left:22%; margin-top: 1em">probe
syscall.read { <br>
printf(&quot;reading fd=%d0, fildes) <br>
if (fildes &gt; 10) tracethis = 1 <br>
}</p>


<p style="margin-left:11%; margin-top: 1em"><b>FUNCTIONS</b>
<br>
Systemtap scripts may define subroutines to factor out
common work. Functions take any number of scalar (integer or
string) arguments, and must return a single scalar (integer
or string). An example function declaration looks like
this:</p>

<p style="margin-left:22%; margin-top: 1em">function thisfn
(arg1, arg2) { <br>
return arg1 + arg2 <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">Note the
general absence of type declarations, which are instead
inferred by the translator. However, if desired, a function
definition may include explicit type declarations for its
return value and/or its arguments. This is especially
helpful for embedded-C functions. In the following example,
the type inference engine need only infer type type of arg2
(a string).</p>

<p style="margin-left:22%; margin-top: 1em">function
thatfn:string (arg1:long, arg2) { <br>
return sprint(arg1) . arg2 <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">Functions may
call others or themselves recursively, up to a fixed nesting
limit. This limit is defined by a macro in the translated C
code and is in the neighbourhood of 10.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PRINTING</b>
<br>
There are a set of function names that are specially treated
by the translator. They format values for printing to the
standard systemtap output stream in a more convenient way.
The <i>sprint*</i> variants return the formatted string
instead of printing it. <b><br>
print</b>, <b>sprint</b></p>

<p style="margin-left:22%;">Print one or more values of any
type, concatenated directly together.</p>

<p style="margin-left:11%;"><b>println</b>,
<b>sprintln</b></p>

<p style="margin-left:22%;">Print values like <i>print</i>
and <i>sprint</i>, but also append a newline.</p>

<p style="margin-left:11%;"><b>printd</b>,
<b>sprintd</b></p>

<p style="margin-left:22%;">Take a string delimiter and two
or more values of any type, and print the values with the
delimiter interposed. The delimiter must be a literal string
constant.</p>

<p style="margin-left:11%;"><b>printdln</b>,
<b>sprintdln</b></p>

<p style="margin-left:22%;">Print values with a delimiter
like <i>printd</i> and <i>sprintd</i>, but also append a
newline.</p>

<p style="margin-left:11%;"><b>printf</b>,
<b>sprintf</b></p>

<p style="margin-left:22%;">Take a formatting string and a
number of values of corresponding types, and print them all.
The format must be a literal string constant.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>printf</i> formatting directives similar to those of C,
except that they are fully type-checked by the
translator:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="7%">


<p>%b</p></td>
<td width="3%"></td>
<td width="68%">


<p>Writes a binary blob of the value given, instead of
ASCII text. The width specifier determines the number of
bytes to write; valid specifiers are %b %1b %2b %4b %8b.
Default (%b) is 8 bytes.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="7%">


<p>%c</p></td>
<td width="3%"></td>
<td width="68%">


<p>Character.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="7%">


<p>%d,%i</p></td>
<td width="3%"></td>
<td width="68%">


<p>Signed decimal.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="7%">


<p>%m</p></td>
<td width="3%"></td>
<td width="68%">


<p>Safely reads kernel memory at the given address, outputs
its content. The optional precision specifier (not field
width) determines the number of bytes to read - default is 1
byte. %10.4m prints 4 bytes of the memory in a
10-character-wide field.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="7%">


<p>%M</p></td>
<td width="3%"></td>
<td width="68%">


<p>Same as %m, but outputs in hexadecimal. The minimal size
of output is double the optional precision specifier -
default is 1 byte (2 hex chars). %10.4M prints 4 bytes of
the memory as 8 hexadecimal characters in a
10-character-wide field.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="7%">


<p>%o</p></td>
<td width="3%"></td>
<td width="68%">


<p>Unsigned octal.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="7%">


<p>%p</p></td>
<td width="3%"></td>
<td width="68%">


<p>Unsigned pointer address.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="7%">


<p>%s</p></td>
<td width="3%"></td>
<td width="68%">


<p>String.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="7%">


<p>%u</p></td>
<td width="3%"></td>
<td width="68%">


<p>Unsigned decimal.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="7%">


<p>%x</p></td>
<td width="3%"></td>
<td width="68%">


<p>Unsigned hex value, in all lower-case.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="7%">


<p>%X</p></td>
<td width="3%"></td>
<td width="68%">


<p>Unsigned hex value, in all upper-case.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="7%">


<p>%%</p></td>
<td width="3%"></td>
<td width="68%">


<p>Writes a %.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">The <i>#</i>
flag selects the alternate forms. For octal, this prefixes a
0. For hex, this prefixes 0x or 0X, depending on case. For
characters, this escapes non-printing values with either
C-like escapes or raw octal.</p>

<p style="margin-left:11%; margin-top: 1em">Examples:</p>

<p style="margin-left:22%; margin-top: 1em">a =
&quot;alice&quot;, b = &quot;bob&quot;, p = 0x1234abcd, i =
123, j = &minus;1, id[a] = 1234, id[b] = 4567 <br>
print(&quot;hello&quot;)</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>Prints: hello</p></td></tr>
</table>

<p style="margin-left:22%;">println(b)</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>Prints: bob\n</p></td></tr>
</table>

<p style="margin-left:22%;">println(a . &quot; is &quot; .
sprint(16))</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>Prints: alice is 16</p></td></tr>
</table>

<p style="margin-left:22%;">foreach (name in id)
printdln(&quot;|&quot;, strlen(name), name, id[name])</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>Prints: 5|alice|1234\n3|bob|4567</p></td></tr>
</table>

<p style="margin-left:22%;">printf(&quot;%c is %s; %x or %X
or %p; %d or %u\n&quot;,97,a,p,p,p,j,j)</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>Prints: a is alice; 1234abcd or 1234ABCD or 0x1234abcd;
&minus;1 or 18446744073709551615\n</p></td></tr>
</table>

<p style="margin-left:22%;">printf(&quot;2 bytes of kernel
buffer at address %p: %2m&quot;, p, p)</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>Prints: 2 byte of kernel buffer at address 0x1234abcd:
&lt;binary data&gt;</p></td></tr>
</table>

<p style="margin-left:22%;">printf(&quot;%4b&quot;, p)</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>Prints (these values as binary data): 0x1234abcd</p></td></tr>
</table>

<p style="margin-left:22%;">printf(&quot;%#o %#x
%#X\n&quot;, 1, 2, 3)</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>Prints: 01 0x2 0X3</p></td></tr>
</table>

<p style="margin-left:22%;">printf(&quot;%#c %#c
%#c\n&quot;, 0, 9, 42)</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>Prints: \000 \t *</p></td></tr>
</table>


<p style="margin-left:11%; margin-top: 1em"><b>STATISTICS</b>
<br>
It is often desirable to collect statistics in a way that
avoids the penalties of repeatedly exclusive locking the
global variables those numbers are being put into. Systemtap
provides a solution using a special operator to accumulate
values, and several pseudo-functions to extract the
statistical aggregates.</p>

<p style="margin-left:11%; margin-top: 1em">The aggregation
operator is <i>&lt;&lt;&lt;</i>, and resembles an
assignment, or a C++ output-streaming operation. The left
operand specifies a scalar or array-index lvalue, which must
be declared global. The right operand is a numeric
expression. The meaning is intuitive: add the given number
to the pile of numbers to compute statistics of. (The
specific list of statistics to gather is given separately,
by the extraction functions.)</p>

<p style="margin-left:22%; margin-top: 1em">foo
&lt;&lt;&lt; 1 <br>
stats[pid()] &lt;&lt;&lt; memsize</p>

<p style="margin-left:11%; margin-top: 1em">The extraction
functions are also special. For each appearance of a
distinct extraction function operating on a given
identifier, the translator arranges to compute a set of
statistics that satisfy it. The statistics system is thereby
&quot;on-demand&quot;. Each execution of an extraction
function causes the aggregation to be computed for that
moment across all processors.</p>

<p style="margin-left:11%; margin-top: 1em">Here is the set
of extractor functions. The first argument of each is the
same style of lvalue used on the left hand side of the
accumulate operation. The <i>@count(v)</i>, <i>@sum(v)</i>,
<i>@min(v)</i>, <i>@max(v)</i>, <i>@avg(v)</i> extractor
functions compute the number/total/minimum/maximum/average
of all accumulated values. The resulting values are all
simple integers. Arrays containing aggregates may be sorted
and iterated. See the <b>foreach</b> construct above.</p>

<p style="margin-left:11%; margin-top: 1em">Histograms are
also available, but are more complicated because they have a
vector rather than scalar value.
<i>@hist_linear(v,start,stop,interval)</i> represents a
linear histogram from &quot;start&quot; to &quot;stop&quot;
by increments of &quot;interval&quot;. The interval must be
positive. Similarly, <i>@hist_log(v)</i> represents a base-2
logarithmic histogram. Printing a histogram with the
<i>print</i> family of functions renders a histogram object
as a tabular &quot;ASCII art&quot; bar chart.</p>

<p style="margin-left:22%; margin-top: 1em">probe
timer.profile { <br>
x[1] &lt;&lt;&lt; pid() <br>
x[2] &lt;&lt;&lt; uid() <br>
y &lt;&lt;&lt; tid() <br>
} <br>
global x // an array containing aggregates <br>
global y // a scalar <br>
probe end { <br>
foreach ([i] in x @count+) { <br>
printf (&quot;x[%d]: avg %d = sum %d / count %d\n&quot;,
<br>
i, @avg(x[i]), @sum(x[i]), @count(x[i])) <br>
println (@hist_log(x[i])) <br>
} <br>
println (&quot;y:&quot;) <br>
println (@hist_log(y)) <br>
}</p>


<p style="margin-left:11%; margin-top: 1em"><b>TYPECASTING</b>
<br>
Once a pointer (see the CONTEXT VARIABLES section of
<i>stapprobes</i>(3stap)) has been saved into a script
integer variable, the translator loses the type information
necessary to access members from that pointer. Using the
<i>@cast()</i> operator tells the translator how to
interpret the number as a typed pointer.</p>

<p style="margin-left:22%; margin-top: 1em">@cast(p,
&quot;type_name&quot;[,
&quot;module&quot;])&minus;&gt;member</p>

<p style="margin-left:11%; margin-top: 1em">This will
interpret <i>p</i> as a pointer to a struct/union named
<i>type_name</i> and dereference the <i>member</i> value.
Further <i>&minus;&gt;subfield</i> expressions may be
appended to dereference more levels. NOTE: the same
dereferencing operator <i>&minus;&gt;</i> is used to refer
to both direct containment or pointer indirection. Systemtap
automatically determines which. The optional <i>module</i>
tells the translator where to look for information about
that type. Multiple modules may be specified as a list with
<i>:</i> separators. If the module is not specified, it will
default either to the probe module for dwarf probes, or to
&quot;kernel&quot; for functions and all other probes
types.</p>

<p style="margin-left:11%; margin-top: 1em">The translator
can create its own module with type information from a
header surrounded by angle brackets, in case normal
debuginfo is not available. For kernel headers, prefix it
with &quot;kernel&quot; to use the appropriate build system.
All other headers are build with default GCC parameters into
a user module. Multiple headers may be specified in sequence
to resolve a codependency.</p>

<p style="margin-left:22%; margin-top: 1em">@cast(tv,
&quot;timeval&quot;,
&quot;&lt;sys/time.h&gt;&quot;)&minus;&gt;tv_sec <br>
@cast(task, &quot;task_struct&quot;,
&quot;kernel&lt;linux/sched.h&gt;&quot;)&minus;&gt;tgid <br>
@cast(task, &quot;task_struct&quot;, <br>

&quot;kernel&lt;linux/sched.h&gt;&lt;linux/fs_struct.h&gt;&quot;)&minus;&gt;fs&minus;&gt;umask</p>

<p style="margin-left:11%; margin-top: 1em">Values acquired
by <b>@cast</b> may be pretty-printed by the <b>$</b> and
<b>$$</b> suffix operators, the same way as described in the
CONTEXT VARIABLES section of the <i>stapprobes</i>(3stap)
manual page.</p>

<p style="margin-left:11%; margin-top: 1em">When in guru
mode, the translator will also allow scripts to assign new
values to members of typecasted pointers.</p>

<p style="margin-left:11%; margin-top: 1em">Typecasting is
also useful in the case of <i>void*</i> members whose type
may be determinable at runtime.</p>

<p style="margin-left:22%; margin-top: 1em">probe foo {
<br>
if ($var&minus;&gt;type == 1) { <br>
value = @cast($var&minus;&gt;data,
&quot;type1&quot;)&minus;&gt;bar <br>
} else { <br>
value = @cast($var&minus;&gt;data,
&quot;type2&quot;)&minus;&gt;baz <br>
} <br>
print(value) <br>
}</p>

<p style="margin-left:11%; margin-top: 1em"><b>EMBEDDED
C</b> <br>
When in guru mode, the translator accepts embedded code in
the top level of the script. Such code is enclosed between
<i>%{</i> and <i>%}</i> markers, and is transcribed
verbatim, without analysis, in some sequence, into the top
level of the generated C code. At the outermost level, this
may be useful to add <i>#include</i> instructions, and any
auxiliary definitions for use by other embedded code.</p>

<p style="margin-left:11%; margin-top: 1em">Another place
where embedded code is permitted is as a function body. In
this case, the script language body is replaced entirely by
a piece of C code enclosed again between <i>%{</i> and
<i>%}</i> markers. This C code may do anything reasonable
and safe. There are a number of undocumented but complex
safety constraints on atomicity, concurrency, resource
consumption, and run time limits, so this is an advanced
technique.</p>

<p style="margin-left:11%; margin-top: 1em">The memory
locations set aside for input and output values are made
available to it using macros <i>STAP_ARG_*</i> and
<i>STAP_RETVALUE</i>. Errors may be signalled with
STAP_ERROR. The function may return early with STAP_RETURN.
Here are some examples:</p>

<p style="margin-left:22%; margin-top: 1em">function
integer_ops (val) %{ <br>
STAP_RETVALUE = STAP_ARG_val + 1; <br>
if (STAP_RETVALUE == 4) <br>
STAP_ERROR(&quot;wrong guess: %d&quot;, (int)
STAP_RETVALUE); <br>
if (STAP_RETVALUE == 3) <br>
STAP_RETURN(0); <br>
STAP_RETVALUE ++; <br>
%} <br>
function string_ops (val) %{ <br>
strlcpy (STAP_RETVALUE, STAP_ARG_val, MAXSTRINGLEN); <br>
strlcat (STAP_RETVALUE, &quot;one&quot;, MAXSTRINGLEN); <br>
if (strcmp (STAP_RETVALUE, &quot;three-two-one&quot;)) <br>
STAP_RETURN(&quot;parameter should be three-two-&quot;);
<br>
%} <br>
function no_ops () %{ <br>
STAP_RETURN(); /* function inferred with no return value */
<br>
%}</p>

<p style="margin-left:11%; margin-top: 1em">The function
argument and return value types have to be inferred by the
translator from the call sites in order for this to work.
The user should examine C code generated for ordinary
script-language functions in order to write compatible
embedded-C ones.</p>

<p style="margin-left:11%; margin-top: 1em">The last place
where embedded code is permitted is as an expression rvalue.
In this case, the C code enclosed between <i>%{</i> and
<i>%}</i> markers is interpreted as an ordinary expression
value. It is assumed to be a normal 64-bit signed number,
unless the marker <i>/* string */</i> is included, in which
case it&rsquo;s treated as a string.</p>

<p style="margin-left:22%; margin-top: 1em">function
add_one (val) { <br>
return val + %{ 1 %} <br>
} <br>
function add_string_two (val) { <br>
return val . %{ /* string */ &quot;two&quot; %} <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">The embedded-C
code may contain markers to assert optimization and safety
properties. <i><br>
/* pure */</i></p>

<p style="margin-left:22%;">means that the C code has no
side effects and may be elided entirely if its value is not
used by script code.</p>

<p style="margin-left:11%;"><i>/* unprivileged */</i></p>

<p style="margin-left:22%;">means that the C code is so
safe that even unprivileged users are permitted to use
it.</p>

<p style="margin-left:11%;"><i>/* myproc&minus;unprivileged
*/</i></p>

<p style="margin-left:22%;">means that the C code is so
safe that even unprivileged users are permitted to use it,
provided that the target of the current probe is within the
user&rsquo;s own process.</p>

<p style="margin-left:11%;"><i>/* guru */</i></p>

<p style="margin-left:22%;">means that the C code is so
unsafe that a systemtap user must specify <i>&minus;g</i>
(guru mode) to use this.</p>

<p style="margin-left:11%;"><i>/* unmangled */</i></p>

<p style="margin-left:22%;">in an embedded-C function,
means that the legacy (pre-1.8) argument access syntax
should be made available inside the function. Hence, in
addition to <i>STAP_ARG_foo</i> and <i>STAP_RETVALUE</i> one
can use <i>THIS-&gt;foo</i> and <i>THIS-&gt;__retvalue</i>
respectively inside the function. This is useful for quickly
migrating code written for SystemTap version 1.7 and
earlier.</p>

<p style="margin-left:11%;"><i>/* unmodified-fnargs
*/</i></p>

<p style="margin-left:22%;">in an embedded-C function,
means that the function arguments are not modified inside
the function body.</p>

<p style="margin-left:11%;"><i>/* string */</i></p>

<p style="margin-left:22%;">in embedded-C expressions only,
means that the expression has <i>const char *</i> type and
should be treated as a string value, instead of the default
long numeric.</p>


<p style="margin-left:11%; margin-top: 1em"><b>BUILT-INS</b>
<br>
A set of builtin probe point aliases are provided by the
scripts installed in the directory specified in the
<i>stappaths</i>(7) manual page. The functions are described
in the <i>stapprobes</i>(3stap) manual page.</p>

<h2>PROCESSING
<a name="PROCESSING"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The translator
begins pass 1 by parsing the given input script, and all
scripts (files named <i>*.stp</i>) found in a tapset
directory. The directories listed with <b>&minus;I</b> are
processed in sequence, each processed in &quot;guru
mode&quot;. For each directory, a number of subdirectories
are also searched. These subdirectories are derived from the
selected kernel version (the <b>&minus;R</b> option), in
order to allow more kernel-version-specific scripts to
override less specific ones. For example, for a kernel
version <i>2.6.12&minus;23.FC3</i> the following patterns
would be searched, in sequence:
<i>2.6.12&minus;23.FC3/*.stp</i>, <i>2.6.12/*.stp</i>,
<i>2.6/*.stp</i>, and finally <i>*.stp</i>. Stopping the
translator after pass 1 causes it to print the parse
trees.</p>

<p style="margin-left:11%; margin-top: 1em">In pass 2, the
translator analyzes the input script to resolve symbols and
types. References to variables, functions, and probe aliases
that are unresolved internally are satisfied by searching
through the parsed tapset script files. If any tapset script
file is selected because it defines an unresolved symbol,
then the entirety of that file is added to the
translator&rsquo;s resolution queue. This process iterates
until all symbols are resolved and a subset of tapset script
files is selected.</p>

<p style="margin-left:11%; margin-top: 1em">Next, all probe
point descriptions are validated against the wide variety
supported by the translator. Probe points that refer to code
locations (&quot;synchronous probe points&quot;) require the
appropriate kernel debugging information to be installed. In
the associated probe handlers, target-side variables (whose
names begin with &quot;$&quot;) are found and have their
run-time locations decoded.</p>

<p style="margin-left:11%; margin-top: 1em">Next, all
probes and functions are analyzed for optimization
opportunities, in order to remove variables, expressions,
and functions that have no useful value and no side-effect.
Embedded-C functions are assumed to have side-effects unless
they include the magic string <b>/*&nbsp;pure&nbsp;*/</b>.
Since this optimization can hide latent code errors such as
type mismatches or invalid $context variables, it sometimes
may be useful to disable the optimizations with the
<b>&minus;u</b> option.</p>

<p style="margin-left:11%; margin-top: 1em">Finally, all
variable, function, parameter, array, and index types are
inferred from context (literals and operators). Stopping the
translator after pass 2 causes it to list all the probes,
functions, and variables, along with all inferred types. Any
inconsistent or unresolved types cause an error.</p>

<p style="margin-left:11%; margin-top: 1em">In pass 3, the
translator writes C code that represents the actions of all
selected script files, and creates a <i>Makefile</i> to
build that into a kernel object. These files are placed into
a temporary directory. Stopping the translator at this point
causes it to print the contents of the C file.</p>

<p style="margin-left:11%; margin-top: 1em">In pass 4, the
translator invokes the Linux kernel build system to create
the actual kernel object file. This involves running
<i>make</i> in the temporary directory, and requires a
kernel module build system (headers, config and Makefiles)
to be installed in the usual spot
<i>/lib/modules/VERSION/build</i>. Stopping the translator
after pass 4 is the last chance before running the kernel
object. This may be useful if you want to archive the
file.</p>

<p style="margin-left:11%; margin-top: 1em">In pass 5, the
translator invokes the systemtap auxiliary program
<i>staprun</i> program for the given kernel object. This
program arranges to load the module then communicates with
it, copying trace data from the kernel into temporary files,
until the user sends an interrupt signal. Any run-time error
encountered by the probe handlers, such as running out of
memory, division by zero, exceeding nesting or runtime
limits, results in a soft error indication. Soft errors in
excess of MAXERRORS block of all subsequent probes (except
error-handling probes), and terminate the session. Finally,
<i>staprun</i> unloads the module, and cleans up.</p>

<p style="margin-left:11%; margin-top: 1em"><b>ABNORMAL
TERMINATION</b> <br>
One should avoid killing the stap process forcibly, for
example with SIGKILL, because the stapio process (a child
process of the stap process) and the loaded module may be
left running on the system. If this happens, send SIGTERM or
SIGINT to any remaining stapio processes, then use rmmod to
unload the systemtap module.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">See the
<i>stapex</i>(3stap) manual page for a brief collection of
samples, or a large set of installed samples under the
systemtap documentation/testsuite directories. See
<i>stappaths</i>(7stap) for the likely location of these on
the system.</p>

<h2>CACHING
<a name="CACHING"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The systemtap
translator caches the pass 3 output (the generated C code)
and the pass 4 output (the compiled kernel module) if pass 4
completes successfully. This cached output is reused if the
same script is translated again assuming the same conditions
exist (same kernel version, same systemtap version, etc.).
Cached files are stored in the <i>$SYSTEMTAP_DIR/cache</i>
directory. The cache can be limited by having the file
<i>cache_mb_limit</i> placed in the cache directory (shown
above) containing only an ASCII integer representing how
many MiB the cache should not exceed. In the absence of this
file, a default will be created with the limit set to
256MiB. This is a &rsquo;soft&rsquo; limit in that the cache
will be cleaned after a new entry is added if the cache
clean interval is exceeded, so the total cache size may
temporarily exceed this limit. This interval can be
specified by having the file <i>cache_clean_interval_s</i>
placed in the cache directory (shown above) containing only
an ASCII integer representing the interval in seconds. In
the absence of this file, a default will be created with the
interval set to 300 s.</p>

<h2>SAFETY AND SECURITY
<a name="SAFETY AND SECURITY"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Systemtap is
may be used as a powerful administrative tool. It can expose
kernel internal data structures and potentially private user
information. (In <b>dyninst</b> runtime mode, this is not
the case, see the <i>ALTERNATE RUNTIMES</i> section
below.)</p>

<p style="margin-left:11%; margin-top: 1em">The translator
asserts many safety constraints during compilation and more
during run-time. It aims to ensure that no handler routine
can run for very long, allocate boundless memory, perform
unsafe operations, or in unintentionally interfere with the
system. Uses of script global variables are automatically
read/write locked as appropriate, to protect against
manipulation by concurrent probe handlers. (Deadlocks are
detected with timeouts. Use the <b>&minus;t</b> flag to
receive reports of excessive lock contention.) Experimenting
with scripts is therefore generally <b>safe</b>. The
guru-mode <b>&minus;g</b> option allows administrators to
bypass most safety measures, which permits invasive or
state-changing operations, embedded-C code, and increases
the risk of upset. By default, overload prevention is turned
on for all modules. If you would like to disable overload
processing, use the
<b>&minus;&minus;suppress&minus;time&minus;limits</b>
option.</p>

<p style="margin-left:11%; margin-top: 1em">Errors that are
caught at run time normally result in a clean script
shutdown and a pass-5 error message. The
<b>&minus;&minus;suppress&minus;handler&minus;errors</b>
option lets scripts tolerate soft errors without shutting
down.</p>


<p style="margin-left:11%; margin-top: 1em"><b>PERMISSIONS</b>
<br>
For the normal linux-kernel-module runtime, to run the
kernel objects systemtap builds, a user must be one of the
following:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="71%">


<p>the root user;</p></td>
<td width="12%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="71%">


<p>a member of the <i>stapdev</i> and <i>stapusr</i>
groups;</p> </td>
<td width="12%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="71%">


<p>a member of the <i>stapsys</i> and <i>stapusr</i>
groups; or</p></td>
<td width="12%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="71%">


<p>a member of the <i>stapusr</i> group.</p></td>
<td width="12%">
</td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">The root user
or a user who is a member of both the <i>stapdev</i> and
<i>stapusr</i> groups can build and run any systemtap
script.</p>

<p style="margin-left:11%; margin-top: 1em">A user who is a
member of both the <i>stapsys</i> and <i>stapusr</i> groups
can only use pre&minus;built modules under the following
conditions:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p style="margin-top: 1em">The module has been signed by a
trusted signer. Trusted signers are normally systemtap
compile&minus;servers which sign modules when the
<i>&minus;&minus;privilege</i> option is specified by the
client. See the <i>stap&minus;server</i>(8) manual page for
more information.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>The module was built using the
<i>&minus;&minus;privilege=stapsys</i> or the
<i>&minus;&minus;privilege=stapusr</i> options.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">Members of only
the <i>stapusr</i> group can only use pre&minus;built
modules under the following conditions:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p style="margin-top: 1em">The module is located in the
/lib/modules/VERSION/systemtap directory. This directory
must be owned by root and not be world writable.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">or</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p style="margin-top: 1em">The module has been signed by a
trusted signer. Trusted signers are normally systemtap
compile&minus;servers which sign modules when the
<i>&minus;&minus;privilege</i> option is specified by the
client. See the <i>stap&minus;server</i>(8) manual page for
more information.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>The module was built using the
&minus;&minus;privilege=stapusr option.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">The kernel
modules generated by <i>stap</i> program are run by the
<i>staprun</i> program. The latter is a part of the
Systemtap package, dedicated to module loading and unloading
(but only in the white zone), and kernel-to-user data
transfer. Since <i>staprun</i> does not perform any
additional security checks on the kernel objects it is
given, it would be unwise for a system administrator to add
untrusted users to the <i>stapdev</i> or <i>stapusr</i>
groups.</p>


<p style="margin-left:11%; margin-top: 1em"><b>SECUREBOOT</b>
<br>
If the current system has SecureBoot turned on in the UEFI
firmware, all kernel modules must be signed. (Some kernels
may allow disabling SecureBoot long after booting with a key
sequence such as SysRq-X, making it unnecessary to sign
modules.) The systemtap compile server can sign modules with
a MOK (Machine Owner Key) that it has in common with a
client system. See the following wiki page for more
details:</p>


<p style="margin-left:22%; margin-top: 1em"><b>https://sourceware.org/systemtap/wiki/SecureBoot</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>RESOURCE
LIMITS</b> <br>
Many resource use limits are set by macros in the generated
C code. These may be overridden with <b>&minus;D</b> flags.
A selection of these is as follows: <br>
MAXNESTING</p>

<p style="margin-left:22%;">Maximum number of nested
function calls. Default determined by script analysis, with
a bonus 10 slots added for recursive scripts.</p>

<p style="margin-left:11%;">MAXSTRINGLEN</p>

<p style="margin-left:22%;">Maximum length of strings,
default 128.</p>

<p style="margin-left:11%;">MAXTRYLOCK</p>

<p style="margin-left:22%;">Maximum number of iterations to
wait for locks on global variables before declaring possible
deadlock and skipping the probe, default 1000.</p>

<p style="margin-left:11%;">MAXACTION</p>

<p style="margin-left:22%;">Maximum number of statements to
execute during any single probe hit (with interrupts
disabled), default 1000. Note that for straight-through
probe handlers lacking loops or recursion, due to
optimization, this parameter may be interpreted too
conservatively.</p>

<p style="margin-left:11%;">MAXACTION_INTERRUPTIBLE</p>

<p style="margin-left:22%;">Maximum number of statements to
execute during any single probe hit which is executed with
interrupts enabled (such as begin/end probes), default
(MAXACTION * 10).</p>

<p style="margin-left:11%;">MAXBACKTRACE</p>

<p style="margin-left:22%;">Maximum number of stack frames
that will be be processed by the stap runtime unwinder as
produced by the backtrace functions in the
[u]context-unwind.stp tapsets, default 20.</p>

<p style="margin-left:11%;">MAXMAPENTRIES</p>

<p style="margin-left:22%;">Default maximum number of rows
in any single global array, default 2048. Individual arrays
may be declared with a larger or smaller limit instead:</p>

<p style="margin-left:22%; margin-top: 1em">global
big[10000],little[5]</p>

<p style="margin-left:22%; margin-top: 1em">or denoted with
<i>%</i> to make them wrap-around automatically.</p>

<p style="margin-left:11%;">MAXERRORS</p>

<p style="margin-left:22%;">Maximum number of soft errors
before an exit is triggered, default 0, which means that the
first error will exit the script. Note that with the
<b>&minus;&minus;suppress&minus;handler&minus;errors</b>
option, this limit is not enforced.</p>

<p style="margin-left:11%;">MAXSKIPPED</p>

<p style="margin-left:22%;">Maximum number of skipped
probes before an exit is triggered, default 100. Running
systemtap with &minus;t (timing) mode gives more details
about skipped probes. With the default
&minus;DINTERRUPTIBLE=1 setting, probes skipped due to
reentrancy are not accumulated against this limit. Note that
with the
<b>&minus;&minus;suppress&minus;handler&minus;errors</b>
option, this limit is not enforced.</p>

<p style="margin-left:11%;">MINSTACKSPACE</p>

<p style="margin-left:22%;">Minimum number of free kernel
stack bytes required in order to run a probe handler,
default 1024. This number should be large enough for the
probe handler&rsquo;s own needs, plus a safety margin.</p>

<p style="margin-left:11%;">MAXUPROBES</p>

<p style="margin-left:22%;">Maximum number of concurrently
armed user-space probes (uprobes), default somewhat larger
than the number of user-space probe points named in the
script. This pool needs to be potentially large because
individual uprobe objects (about 64 bytes each) are
allocated for each process for each matching script-level
probe.</p>

<p style="margin-left:11%;">STP_MAXMEMORY</p>

<p style="margin-left:22%;">Maximum amount of memory (in
kilobytes) that the systemtap module should use, default
unlimited. The memory size includes the size of the module
itself, plus any additional allocations. This only tracks
direct allocations by the systemtap runtime. This does not
track indirect allocations (as done by kprobes/uprobes/etc.
internals).</p>

<p style="margin-left:11%;">STP_OVEROAD_THRESHOLD,
STP_OVERLOAD_INTERVAL</p>

<p style="margin-left:22%;">Maximum number of machine
cycles spent in probes on any cpu per given interval, before
an overload condition is declared and the script shut down.
The defaults are 500 million and 1 billion, so as to limit
stap script cpu consumption at around 50%.</p>

<p style="margin-left:11%;">STP_PROCFS_BUFSIZE</p>

<p style="margin-left:22%;">Size of procfs probe read
buffers (in bytes). Defaults to <i>MAXSTRINGLEN</i>. This
value can be overridden on a per-procfs file basis using the
procfs read probe <i>.maxsize(MAXSIZE)</i> parameter.</p>

<p style="margin-left:11%; margin-top: 1em">With scripts
that contain probes on any interrupt path, it is possible
that those interrupts may occur in the middle of another
probe handler. The probe in the interrupt handler would be
skipped in this case to avoid reentrance. To work around
this issue, execute stap with the option
<b>&minus;DINTERRUPTIBLE=0</b> to mask interrupts throughout
the probe handler. This does add some extra overhead to the
probes, but it may prevent reentrance for common problem
cases. However, probes in NMI handlers and in the callpath
of the stap runtime may still be skipped due to
reentrance.</p>

<p style="margin-left:11%; margin-top: 1em">Multiple
scripts can write data into a relay buffer concurrently. A
host script provides an interface for accessing its relay
buffer to guest scripts. Then, the output of the guests are
merged into the output of the host. To run a script as a
host, execute stap with <b>&minus;DRELAYHOST[=name]</b>
option. The <b>name</b> identifies your host script among
several hosts. While running the host, execute stap with
<b>&minus;DRELAYGUEST[=name]</b> to add a guest script to
the host. Note that you must unload guests before unloading
a host. If there are some guests connected to the host,
unloading the host will be failed.</p>

<p style="margin-left:11%; margin-top: 1em">In case
something goes wrong with <i>stap</i> or <i>staprun</i>
after a probe has already started running, one may safely
kill both user processes, and remove the active probe kernel
module with <i>rmmod</i>. Any pending trace messages may be
lost.</p>

<h2>UNPRIVILEGED USERS
<a name="UNPRIVILEGED USERS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Systemtap
exposes kernel internal data structures and potentially
private user information. Because of this, use of
systemtap&rsquo;s full capabilities are restricted to root
and to users who are members of the groups stapdev and
stapusr.</p>

<p style="margin-left:11%; margin-top: 1em">However, a
restricted set of systemtap&rsquo;s features can be made
available to trusted, unprivileged users. These users are
members of the group stapusr only, or members of the groups
stapusr and stapsys. These users can load systemtap modules
which have been compiled and certified by a trusted
systemtap compile&minus;server. See the descriptions of the
options <i>&minus;&minus;privilege</i> and
<i>&minus;&minus;use&minus;server</i>. See
<i>README.unprivileged</i> in the systemtap source code for
information about setting up a trusted compile server.</p>

<p style="margin-left:11%; margin-top: 1em">The
restrictions enforced when
<i>&minus;&minus;privilege=stapsys</i> is specified are
designed to prevent unprivileged users from:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="47%">


<p>harming the system maliciously.</p></td>
<td width="25%">
</td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">The
restrictions enforced when
<i>&minus;&minus;privilege=stapusr</i> is specified are
designed to prevent unprivileged users from:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p style="margin-top: 1em">harming the system
maliciously.</p> </td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p>gaining access to information which would not normally
be available to an unprivileged user.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p>disrupting the performance of processes owned by other
users of the system. Some overhead to the system in general
is unavoidable since the unprivileged user&rsquo;s probes
will be triggered at the appropriate times. What we would
like to avoid is targeted interruption of another
user&rsquo;s processes which would not normally be possible
by an unprivileged user.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em"><b>PROBE
RESTRICTIONS</b> <br>
A member of the groups stapusr and stapsys may use all probe
points.</p>

<p style="margin-left:11%; margin-top: 1em">A member of
only the group stapusr may use only the following
probes:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p style="margin-top: 1em">begin, begin(n)</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p>end, end(n)</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p>error(n)</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p>never</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p>process.*, where the target process is owned by the
user.</p> </td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p>timer.{jiffies,s,sec,ms,msec,us,usec,ns,nsec}(n)*</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p>timer.hz(n)</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em"><b>SCRIPT
LANGUAGE RESTRICTIONS</b> <br>
The following scripting language features are unavailable to
all unprivileged users:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p style="margin-top: 1em">any feature enabled by the Guru
Mode (&minus;g) option.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p>embedded C code.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em"><b>RUNTIME
RESTRICTIONS</b> <br>
The following runtime restrictions are placed upon all
unprivileged users:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p style="margin-top: 1em">Only the default runtime code
(see <i>-R</i>) may be used.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">Additional
restrictions are placed on members of only the group
stapusr:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p style="margin-top: 1em">Probing of processes owned by
other users is not permitted.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p>Access of kernel memory (read and write) is not
permitted.</p> </td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em"><b>COMMAND LINE
OPTION RESTRICTIONS</b> <br>
Some command line options provide access to features which
must not be available to all unprivileged users:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p style="margin-top: 1em">&minus;g may not be
specified.</p> </td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="72%">


<p>The following options may not be used by the
compile-server client:</p></td></tr>
</table>

<p style="margin-left:28%; margin-top: 1em">&minus;a,
&minus;B, &minus;D, &minus;I, &minus;r, &minus;R</p>

<p style="margin-left:11%; margin-top: 1em"><b>ENVIRONMENT
RESTRICTIONS</b> <br>
The following environment variables must not be set for all
unprivileged users:</p>


<p style="margin-left:22%; margin-top: 1em">SYSTEMTAP_RUNTIME
<br>
SYSTEMTAP_TAPSET <br>
SYSTEMTAP_DEBUGINFO_PATH</p>

<p style="margin-left:11%; margin-top: 1em"><b>TAPSET
RESTRICTIONS</b> <br>
In general, tapset functions are only available for members
of the group stapusr when they do not gather information
that an ordinary program running with that user&rsquo;s
privileges would be denied access to.</p>

<p style="margin-left:11%; margin-top: 1em">There are two
categories of unprivileged tapset functions. The first
category consists of utility functions that are
unconditionally available to all users; these include such
things as:</p>

<p style="margin-left:22%; margin-top: 1em">cpu:long ()
<br>
exit () <br>
str_replace:string (prnt_str:string, srch_str:string,
rplc_str:string)</p>

<p style="margin-left:11%; margin-top: 1em">The second
category consists of so-called <i>myproc-unprivileged</i>
functions that can only gather information within their own
processes. Scripts that wish to use these functions must
test the result of the tapset function <i>is_myproc</i> and
only call these functions if the result is 1. The script
will exit immediately if any of these functions are called
by an unprivileged user within a probe within a process
which is not owned by that user. Examples of
<i>myproc-unprivileged</i> functions include:</p>

<p style="margin-left:22%; margin-top: 1em">print_usyms
(stk:string) <br>
user_int:long (addr:long) <br>
usymname:string (addr:long)</p>

<p style="margin-left:11%; margin-top: 1em">A compile error
is triggered when any function not in either of the above
categories is used by members of only the group stapusr.</p>

<p style="margin-left:11%; margin-top: 1em">No other
built-in tapset functions may be used by members of only the
group stapusr.</p>

<h2>ALTERNATE RUNTIMES
<a name="ALTERNATE RUNTIMES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">As described
above, systemtap&rsquo;s default runtime mode involves
building and loading kernel modules, with various security
tradeoffs presented. Systemtap now includes a new prototype
backend, selected with <i>&minus;&minus;runtime=dyninst</i>,
which uses Dyninst to instrument a user&rsquo;s own
processes at runtime. This backend does not use kernel
modules, and does not require root privileges, but is
restricted with respect to the kinds of probes and other
constructs that a script may use.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>dyninst</i> runtime operates in target-attach mode, so it
does require a <i>&minus;c COMMAND</i> or <i>&minus;x
PID</i> process. For example:</p>

<p style="margin-left:22%; margin-top: 1em">stap
&minus;&minus;runtime=dyninst &minus;c &rsquo;stap
&minus;V&rsquo; \ <br>
&minus;e &rsquo;probe process.function(&quot;main&quot;)
<br>
{ println(&quot;hi from dyninst!&quot;) }&rsquo;</p>

<p style="margin-left:11%; margin-top: 1em">It may be
necessary to disable a conflicting selinux check with</p>

<p style="margin-left:22%; margin-top: 1em"># setsebool
allow_execstack 1</p>

<h2>EXIT STATUS
<a name="EXIT STATUS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The systemtap
translator generally returns with a success code of 0 if the
requested script was processed and executed successfully
through the requested pass. Otherwise, errors may be printed
to stderr and a failure code is returned. Use
<i>&minus;v</i> or <i>&minus;vp N</i> to increase (global or
per-pass) verbosity to identify the source of the
trouble.</p>

<p style="margin-left:11%; margin-top: 1em">In listings
mode (<i>&minus;l</i> and <i>&minus;L</i>), error messages
are normally suppressed. A success code of 0 is returned if
at least one matching probe was found.</p>

<p style="margin-left:11%; margin-top: 1em">A script
executing in pass 5 that is interrupted with ^C / SIGINT is
considered to be successful.</p>

<h2>DEPRECATION
<a name="DEPRECATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Over time, some
features of the script language and the tapset library may
undergo incompatible changes, so that a script written
against an old version of systemtap may no longer run. In
these cases, it may help to run systemtap with the
<i>&minus;&minus;compatible VERSION</i> flag, specifying the
last known working version. Running systemtap with the
<i>&minus;&minus;check&minus;version</i> flag will output a
warning if any possible incompatible elements have been
parsed. Deprecation historical details may be found in the
NEWS file.</p>

<h2>FILES
<a name="FILES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Important files
and their corresponding paths can be located in the</p>

<p style="margin-left:22%;">stappaths (7) manual page.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><i>stapprobes</i>(3stap),
<i><br>
function::*</i>(3stap), <i><br>
probe::*</i>(3stap), <i><br>
tapset::*</i>(3stap), <i><br>
stappaths</i>(7), <i><br>
staprun</i>(8), <i><br>
stapdyn</i>(8), <i><br>
systemtap</i>(8), <i><br>
stapvars</i>(3stap), <i><br>
stapex</i>(3stap), <i><br>
stap&minus;server</i>(8), <i><br>
stap&minus;prep</i>(1), <i><br>
stapref</i>(1), <i><br>
awk</i>(1), <i><br>
gdb</i>(1)</p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Use the
Bugzilla link of the project web page or our mailing list.
<b>http://sourceware.org/systemtap/</b>,
<b>&lt;systemtap@sourceware.org&gt;</b>.</p>


<p style="margin-left:11%; margin-top: 1em"><i>error::reporting</i>(7stap),
<b>https://sourceware.org/systemtap/wiki/HowToReportBugs</b></p>
<hr>
</body>
</html>
