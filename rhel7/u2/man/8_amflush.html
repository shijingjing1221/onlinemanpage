<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 01:14:10 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>AMFLUSH</title>

</head>
<body>

<h1 align="center">AMFLUSH</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#EXAMPLE">EXAMPLE</a><br>
<a href="#EXIT CODE">EXIT CODE</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#AUTHORS">AUTHORS</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">amflush &minus;
flush Amanda backup files from holding disk to tape</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="84%">


<p style="margin-top: 1em"><b>amflush</b> [&minus;b]
[&minus;f] [&minus;&minus;exact&minus;match] [&minus;s]
[&minus;D&nbsp;<i>datestamp</i>]
[<b>&minus;o&nbsp;</b><i>configoption</i>...] <i>config</i>
[<i>host&nbsp;</i>[<i>disk</i>...]...]</p> </td>
<td width="5%">
</td></tr>
</table>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Amflush</b>
writes Amanda backups from the holding disks to tape, and
updates the Amanda info database and <b>tapelist</b>(5)
accordingly. It is similar to amdump, but does not perform
any backup operations on Amanda clients. Backups may stay in
a holding disk when something is wrong with the tape at the
time <b>amdump</b> is run. When this happens, the problem
must be corrected and <b>amflush</b> run by hand.</p>

<p style="margin-left:11%; margin-top: 1em">The command
optionally takes a set of DLE specifications (see
<b>amanda-match</b>(7)) to narrow the DLEs for which dumps
will be flushed. All dumps in holding are flushed if no
expressions are given.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>&minus;b</b></p>

<p style="margin-left:17%;">Run <b>amflush</b> in batch
mode. All datestamps are selected unless specified. The
flush is started without confirmation.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;f</b></p>

<p style="margin-left:17%;">Run <b>amflush</b> in
foreground. <b>Amflush</b> normally detaches itself from the
tty and runs as a background process. With the
<b>&minus;f</b> option, <b>amflush</b> stays in the
foreground. This is useful if <b>amflush</b> is run as part
of another script that, for example, advances the tape after
the flush is completed.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;s</b></p>

<p style="margin-left:17%;">Write log to stdout/stderr
instead of the amflush log file. Requires the
<b>&minus;f</b> option.</p>

<p style="margin-left:11%; margin-top: 1em"><b>&minus;D
datestamp</b></p>

<p style="margin-left:17%;">specify a datestamp expression
you want to flush; see <b>amanda-match</b>(7) for details on
the format of this expression. <b>&minus;D
20001225&minus;7</b> will flush all dumps from 25 december
2000 to 27 december 2000.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;exact&minus;match</b></p>

<p style="margin-left:17%;">The host and disk are parsed as
exact values</p>

<p style="margin-left:11%; margin-top: 1em"><i>host</i>
[<i>disk</i>]*</p>

<p style="margin-left:17%;">Specify the host and disk on
which the command will work &minus;&minus; see the
description of DLE specifications in
<b>amanda-match</b>(7).</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;o</b>
<i>configoption</i></p>

<p style="margin-left:17%;">See the &quot;CONFIGURATION
OVERRIDE&quot; section in <b>amanda</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em">You can specify
many host/disk expressions, only disks that match an
expression will be flushed. All disks are flushed if no
expressions are given. see the &quot;HOST &amp; DISK
EXPRESSION&quot; section of <b>amanda</b>(8) for a
description.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Amflush</b>
will look in the holding disks specified by the
<i>amanda.conf</i> file in
/usr/local/etc/amanda/<i>config</i> for any non&minus;empty
Amanda work directories. It then prompts you to select a
directory or to process all of the directories. The work
directories in the holding disks are named by the date at
the time <b>amdump</b> was run, e.g. 19910215.</p>

<p style="margin-left:11%; margin-top: 1em">See the
<b>amanda</b>(8) man page for more details about Amanda.</p>

<h2>EXAMPLE
<a name="EXAMPLE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Amflush</b>
will search for holding areas associated with the
<i>daily</i> configuration. After you select which holding
area to flush, <b>amflush</b> writes the data to tape,
updates the databases and sends a mail report similar to
<b>amdump</b>(8). <br>
% amflush MyConfig <br>
Scanning /amanda&minus;hold... <br>
20001113: found Amanda directory. <br>
20001114: found Amanda directory.</p>

<p style="margin-left:11%; margin-top: 1em">Multiple Amanda
directories, please pick one by letter: <br>
A. 20001113 <br>
B. 20001114 <br>
Select directories to flush [A..B]: [ALL] all</p>

<p style="margin-left:11%; margin-top: 1em">Flushing dumps
in 20001113, 20001114, <br>
today: 20001117 <br>
to tape drive /dev/rmt/0mn. <br>
Expecting tape DMP014 or a new tape. (The last dumps were to
tape DMP013) <br>
Are you sure you want to do this? yes <br>
Running in background, you can log off now. <br>
You'll get mail when amflush is finished.</p>

<p style="margin-left:11%; margin-top: 1em">The following
example causes amflush to flush everything to tape, then
ejects tape, using 'at' to run the task in the background.
<br>
% echo 'amflush &minus;b &minus;f MyConfig &amp;&amp; mt
offline' | at now</p>

<h2>EXIT CODE
<a name="EXIT CODE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The exit code
of <b>amflush</b> is the ORed value of: <br>
0 = success <br>
1 = error <br>
4 = a dle failed <br>
8 = Don't know the status of a dle (RESULT_MISSING in the
report) <br>
16 = tape error or no more tape</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>amanda</b>(8),
<b>amdump</b>(8), <b>amanda-match</b>(7)</p>

<p style="margin-left:11%; margin-top: 1em">The Amanda
Wiki: : http://wiki.zmanda.com/</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>James da
Silva</b> &lt;jds@amanda.org&gt;</p>

<p style="margin-left:11%; margin-top: 1em"><b>Stefan G.
Weichinger</b> &lt;sgw@amanda.org&gt;</p>
<hr>
</body>
</html>
