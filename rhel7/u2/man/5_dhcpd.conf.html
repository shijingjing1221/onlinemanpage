<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 01:27:38 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>dhcpd.conf</title>

</head>
<body>

<h1 align="center">dhcpd.conf</h1>

<a href="#NAME">NAME</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#ADDRESS POOLS">ADDRESS POOLS</a><br>
<a href="#DYNAMIC ADDRESS ALLOCATION">DYNAMIC ADDRESS ALLOCATION</a><br>
<a href="#IP ADDRESS CONFLICT PREVENTION">IP ADDRESS CONFLICT PREVENTION</a><br>
<a href="#DHCP FAILOVER">DHCP FAILOVER</a><br>
<a href="#FAILOVER STARTUP">FAILOVER STARTUP</a><br>
<a href="#CONFIGURING FAILOVER">CONFIGURING FAILOVER</a><br>
<a href="#CLIENT CLASSING">CLIENT CLASSING</a><br>
<a href="#SUBCLASSES">SUBCLASSES</a><br>
<a href="#PER-CLASS LIMITS ON DYNAMIC ADDRESS ALLOCATION">PER-CLASS LIMITS ON DYNAMIC ADDRESS ALLOCATION</a><br>
<a href="#SPAWNING CLASSES">SPAWNING CLASSES</a><br>
<a href="#COMBINING MATCH, MATCH IF AND SPAWN WITH">COMBINING MATCH, MATCH IF AND SPAWN WITH</a><br>
<a href="#DYNAMIC DNS UPDATES">DYNAMIC DNS UPDATES</a><br>
<a href="#THE AD-HOC DNS UPDATE SCHEME">THE AD-HOC DNS UPDATE SCHEME</a><br>
<a href="#THE INTERIM DNS UPDATE SCHEME">THE INTERIM DNS UPDATE SCHEME</a><br>
<a href="#DYNAMIC DNS UPDATE SECURITY">DYNAMIC DNS UPDATE SECURITY</a><br>
<a href="#REFERENCE: EVENTS">REFERENCE: EVENTS</a><br>
<a href="#REFERENCE: DECLARATIONS">REFERENCE: DECLARATIONS</a><br>
<a href="#REFERENCE: ALLOW AND DENY">REFERENCE: ALLOW AND DENY</a><br>
<a href="#ALLOW DENY AND IGNORE IN SCOPE">ALLOW DENY AND IGNORE IN SCOPE</a><br>
<a href="#ALLOW AND DENY WITHIN POOL DECLARATIONS">ALLOW AND DENY WITHIN POOL DECLARATIONS</a><br>
<a href="#REFERENCE: PARAMETERS">REFERENCE: PARAMETERS</a><br>
<a href="#SETTING PARAMETER VALUES USING EXPRESSIONS">SETTING PARAMETER VALUES USING EXPRESSIONS</a><br>
<a href="#RESERVED LEASES">RESERVED LEASES</a><br>
<a href="#REFERENCE: OPTION STATEMENTS">REFERENCE: OPTION STATEMENTS</a><br>
<a href="#REFERENCE: EXPRESSIONS">REFERENCE: EXPRESSIONS</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#AUTHOR">AUTHOR</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">dhcpd.conf -
dhcpd configuration file</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The dhcpd.conf
file contains configuration information for <i>dhcpd,</i>
the Internet Systems Consortium DHCP Server.</p>

<p style="margin-left:11%; margin-top: 1em">The dhcpd.conf
file is a free-form ASCII text file. It is parsed by the
recursive-descent parser built into dhcpd. The file may
contain extra tabs and newlines for formatting purposes.
Keywords in the file are case-insensitive. Comments may be
placed anywhere within the file (except within quotes).
Comments begin with the # character and end at the end of
the line.</p>

<p style="margin-left:11%; margin-top: 1em">The file
essentially consists of a list of statements. Statements
fall into two broad categories - parameters and
declarations.</p>

<p style="margin-left:11%; margin-top: 1em">Parameter
statements either say how to do something (e.g., how long a
lease to offer), whether to do something (e.g., should dhcpd
provide addresses to unknown clients), or what parameters to
provide to the client (e.g., use gateway 220.177.244.7).</p>

<p style="margin-left:11%; margin-top: 1em">Declarations
are used to describe the topology of the network, to
describe clients on the network, to provide addresses that
can be assigned to clients, or to apply a group of
parameters to a group of declarations. In any group of
parameters and declarations, all parameters must be
specified before any declarations which depend on those
parameters may be specified.</p>

<p style="margin-left:11%; margin-top: 1em">Declarations
about network topology include the <i>shared-network</i> and
the <i>subnet</i> declarations. If clients on a subnet are
to be assigned addresses dynamically, a <i>range</i>
declaration must appear within the <i>subnet</i>
declaration. For clients with statically assigned addresses,
or for installations where only known clients will be
served, each such client must have a <i>host</i>
declaration. If parameters are to be applied to a group of
declarations which are not related strictly on a per-subnet
basis, the <i>group</i> declaration can be used.</p>

<p style="margin-left:11%; margin-top: 1em">For every
subnet which will be served, and for every subnet to which
the dhcp server is connected, there must be one
<i>subnet</i> declaration, which tells dhcpd how to
recognize that an address is on that subnet. A <i>subnet</i>
declaration is required for each subnet even if no addresses
will be dynamically allocated on that subnet.</p>

<p style="margin-left:11%; margin-top: 1em">Some
installations have physical networks on which more than one
IP subnet operates. For example, if there is a site-wide
requirement that 8-bit subnet masks be used, but a
department with a single physical ethernet network expands
to the point where it has more than 254 nodes, it may be
necessary to run two 8-bit subnets on the same ethernet
until such time as a new physical network can be added. In
this case, the <i>subnet</i> declarations for these two
networks must be enclosed in a <i>shared-network</i>
declaration.</p>

<p style="margin-left:11%; margin-top: 1em">Note that even
when the <i>shared-network</i> declaration is absent, an
empty one is created by the server to contain the
<i>subnet</i> (and any scoped parameters included in the
<i>subnet</i>). For practical purposes, this means that
&quot;stateless&quot; DHCP clients, which are not tied to
addresses (and therefore subnets) will receive the same
configuration as stateful ones.</p>

<p style="margin-left:11%; margin-top: 1em">Some sites may
have departments which have clients on more than one subnet,
but it may be desirable to offer those clients a uniform set
of parameters which are different than what would be offered
to clients from other departments on the same subnet. For
clients which will be declared explicitly with <i>host</i>
declarations, these declarations can be enclosed in a
<i>group</i> declaration along with the parameters which are
common to that department. For clients whose addresses will
be dynamically assigned, class declarations and conditional
declarations may be used to group parameter assignments
based on information the client sends.</p>

<p style="margin-left:11%; margin-top: 1em">When a client
is to be booted, its boot parameters are determined by
consulting that client&rsquo;s <i>host</i> declaration (if
any), and then consulting any <i>class</i> declarations
matching the client, followed by the <i>pool</i>,
<i>subnet</i> and <i>shared-network</i> declarations for the
IP address assigned to the client. Each of these
declarations itself appears within a lexical scope, and all
declarations at less specific lexical scopes are also
consulted for client option declarations. Scopes are never
considered twice, and if parameters are declared in more
than one scope, the parameter declared in the most specific
scope is the one that is used.</p>

<p style="margin-left:11%; margin-top: 1em">When dhcpd
tries to find a <i>host</i> declaration for a client, it
first looks for a <i>host</i> declaration which has a
<i>fixed-address</i> declaration that lists an IP address
that is valid for the subnet or shared network on which the
client is booting. If it doesn&rsquo;t find any such entry,
it tries to find an entry which has no <i>fixed-address</i>
declaration.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">A typical
dhcpd.conf file will look something like this:</p>

<p style="margin-left:11%; margin-top: 1em"><i>global
parameters...</i></p>

<p style="margin-left:11%; margin-top: 1em">subnet
204.254.239.0 netmask 255.255.255.224 { <i><br>
subnet-specific parameters...</i> <br>
range 204.254.239.10 204.254.239.30; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">subnet
204.254.239.32 netmask 255.255.255.224 { <i><br>
subnet-specific parameters...</i> <br>
range 204.254.239.42 204.254.239.62; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">subnet
204.254.239.64 netmask 255.255.255.224 { <i><br>
subnet-specific parameters...</i> <br>
range 204.254.239.74 204.254.239.94; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">group { <i><br>
group-specific parameters...</i> <br>
host zappo.test.isc.org { <i><br>
host-specific parameters...</i> <br>
} <br>
host beppo.test.isc.org { <i><br>
host-specific parameters...</i> <br>
} <br>
host harpo.test.isc.org { <i><br>
host-specific parameters...</i> <br>
} <br>
}</p>

<p align="center" style="margin-top: 1em">Figure 1</p>

<p style="margin-top: 1em">Notice that at the beginning of
the file, there&rsquo;s a place for global parameters. These
might be things like the organization&rsquo;s domain name,
the addresses of the name servers (if they are common to the
entire organization), and so on. So, for example:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>option domain-name &quot;isc.org&quot;;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>option domain-name-servers ns1.isc.org, ns2.isc.org;</p></td></tr>
</table>

<p align="center" style="margin-top: 1em">Figure 2</p>

<p style="margin-top: 1em">As you can see in Figure 2, you
can specify host addresses in parameters using their domain
names rather than their numeric IP addresses. If a given
hostname resolves to more than one IP address (for example,
if that host has two ethernet interfaces), then where
possible, both addresses are supplied to the client.</p>

<p style="margin-top: 1em">The most obvious reason for
having subnet-specific parameters as shown in Figure 1 is
that each subnet, of necessity, has its own router. So for
the first subnet, for example, there should be something
like:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>option routers 204.254.239.1;</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">Note that the
address here is specified numerically. This is not required
- if you have a different domain name for each interface on
your router, it&rsquo;s perfectly legitimate to use the
domain name for that interface instead of the numeric
address. However, in many cases there may be only one domain
name for all of a router&rsquo;s IP addresses, and it would
not be appropriate to use that name here.</p>

<p style="margin-left:11%; margin-top: 1em">In Figure 1
there is also a <i>group</i> statement, which provides
common parameters for a set of three hosts - zappo, beppo
and harpo. As you can see, these hosts are all in the
test.isc.org domain, so it might make sense for a
group-specific parameter to override the domain name
supplied to these hosts:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>option domain-name &quot;test.isc.org&quot;;</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">Also, given the
domain they&rsquo;re in, these are probably test machines.
If we wanted to test the DHCP leasing mechanism, we might
set the lease timeout somewhat shorter than the default:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>max-lease-time 120;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>default-lease-time 120;</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">You may have
noticed that while some parameters start with the
<i>option</i> keyword, some do not. Parameters starting with
the <i>option</i> keyword correspond to actual DHCP options,
while parameters that do not start with the option keyword
either control the behavior of the DHCP server (e.g., how
long a lease dhcpd will give out), or specify client
parameters that are not optional in the DHCP protocol (for
example, server-name and filename).</p>

<p style="margin-left:11%; margin-top: 1em">In Figure 1,
each host had <i>host-specific parameters</i>. These could
include such things as the <i>hostname</i> option, the name
of a file to upload (the <i>filename</i> parameter) and the
address of the server from which to upload the file (the
<i>next-server</i> parameter). In general, any parameter can
appear anywhere that parameters are allowed, and will be
applied according to the scope in which the parameter
appears.</p>

<p style="margin-left:11%; margin-top: 1em">Imagine that
you have a site with a lot of NCD X-Terminals. These
terminals come in a variety of models, and you want to
specify the boot files for each model. One way to do this
would be to have host declarations for each server and group
them by model:</p>

<p style="margin-left:11%; margin-top: 1em">group { <br>
filename &quot;Xncd19r&quot;; <br>
next-server ncd-booter;</p>

<p style="margin-left:11%; margin-top: 1em">host ncd1 {
hardware ethernet 0:c0:c3:49:2b:57; } <br>
host ncd4 { hardware ethernet 0:c0:c3:80:fc:32; } <br>
host ncd8 { hardware ethernet 0:c0:c3:22:46:81; } <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">group { <br>
filename &quot;Xncd19c&quot;; <br>
next-server ncd-booter;</p>

<p style="margin-left:11%; margin-top: 1em">host ncd2 {
hardware ethernet 0:c0:c3:88:2d:81; } <br>
host ncd3 { hardware ethernet 0:c0:c3:00:14:11; } <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">group { <br>
filename &quot;XncdHMX&quot;; <br>
next-server ncd-booter;</p>

<p style="margin-left:11%; margin-top: 1em">host ncd1 {
hardware ethernet 0:c0:c3:11:90:23; } <br>
host ncd4 { hardware ethernet 0:c0:c3:91:a7:8; } <br>
host ncd8 { hardware ethernet 0:c0:c3:cc:a:8f; } <br>
}</p>

<h2>ADDRESS POOLS
<a name="ADDRESS POOLS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The <b>pool</b>
declaration can be used to specify a pool of addresses that
will be treated differently than another pool of addresses,
even on the same network segment or subnet. For example, you
may want to provide a large set of addresses that can be
assigned to DHCP clients that are registered to your DHCP
server, while providing a smaller set of addresses, possibly
with short lease times, that are available for unknown
clients. If you have a firewall, you may be able to arrange
for addresses from one pool to be allowed access to the
Internet, while addresses in another pool are not, thus
encouraging users to register their DHCP clients. To do
this, you would set up a pair of pool declarations:</p>

<p style="margin-left:11%; margin-top: 1em">subnet 10.0.0.0
netmask 255.255.255.0 { <br>
option routers 10.0.0.254;</p>

<p style="margin-left:11%; margin-top: 1em"># Unknown
clients get this pool. <br>
pool { <br>
option domain-name-servers bogus.example.com; <br>
max-lease-time 300; <br>
range 10.0.0.200 10.0.0.253; <br>
allow unknown-clients; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em"># Known clients
get this pool. <br>
pool { <br>
option domain-name-servers ns1.example.com, ns2.example.com;
<br>
max-lease-time 28800; <br>
range 10.0.0.5 10.0.0.199; <br>
deny unknown-clients; <br>
} <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">It is also
possible to set up entirely different subnets for known and
unknown clients - address pools exist at the level of shared
networks, so address ranges within pool declarations can be
on different subnets.</p>

<p style="margin-left:11%; margin-top: 1em">As you can see
in the preceding example, pools can have permit lists that
control which clients are allowed access to the pool and
which aren&rsquo;t. Each entry in a pool&rsquo;s permit list
is introduced with the <i>allow</i> or <i>deny</i> keyword.
If a pool has a permit list, then only those clients that
match specific entries on the permit list will be eligible
to be assigned addresses from the pool. If a pool has a deny
list, then only those clients that do not match any entries
on the deny list will be eligible. If both permit and deny
lists exist for a pool, then only clients that match the
permit list and do not match the deny list will be allowed
access.</p>

<h2>DYNAMIC ADDRESS ALLOCATION
<a name="DYNAMIC ADDRESS ALLOCATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Address
allocation is actually only done when a client is in the
INIT state and has sent a DHCPDISCOVER message. If the
client thinks it has a valid lease and sends a DHCPREQUEST
to initiate or renew that lease, the server has only three
choices - it can ignore the DHCPREQUEST, send a DHCPNAK to
tell the client it should stop using the address, or send a
DHCPACK, telling the client to go ahead and use the address
for a while.</p>

<p style="margin-left:11%; margin-top: 1em">If the server
finds the address the client is requesting, and that address
is available to the client, the server will send a DHCPACK.
If the address is no longer available, or the client
isn&rsquo;t permitted to have it, the server will send a
DHCPNAK. If the server knows nothing about the address, it
will remain silent, unless the address is incorrect for the
network segment to which the client has been attached and
the server is authoritative for that network segment, in
which case the server will send a DHCPNAK even though it
doesn&rsquo;t know about the address.</p>

<p style="margin-left:11%; margin-top: 1em">There may be a
host declaration matching the client&rsquo;s identification.
If that host declaration contains a fixed-address
declaration that lists an IP address that is valid for the
network segment to which the client is connected. In this
case, the DHCP server will never do dynamic address
allocation. In this case, the client is <i>required</i> to
take the address specified in the host declaration. If the
client sends a DHCPREQUEST for some other address, the
server will respond with a DHCPNAK.</p>

<p style="margin-left:11%; margin-top: 1em">When the DHCP
server allocates a new address for a client (remember, this
only happens if the client has sent a DHCPDISCOVER), it
first looks to see if the client already has a valid lease
on an IP address, or if there is an old IP address the
client had before that hasn&rsquo;t yet been reassigned. In
that case, the server will take that address and check it to
see if the client is still permitted to use it. If the
client is no longer permitted to use it, the lease is freed
if the server thought it was still in use - the fact that
the client has sent a DHCPDISCOVER proves to the server that
the client is no longer using the lease.</p>

<p style="margin-left:11%; margin-top: 1em">If no existing
lease is found, or if the client is forbidden to receive the
existing lease, then the server will look in the list of
address pools for the network segment to which the client is
attached for a lease that is not in use and that the client
is permitted to have. It looks through each pool declaration
in sequence (all <i>range</i> declarations that appear
outside of pool declarations are grouped into a single pool
with no permit list). If the permit list for the pool allows
the client to be allocated an address from that pool, the
pool is examined to see if there is an address available. If
so, then the client is tentatively assigned that address.
Otherwise, the next pool is tested. If no addresses are
found that can be assigned to the client, no response is
sent to the client.</p>

<p style="margin-left:11%; margin-top: 1em">If an address
is found that the client is permitted to have, and that has
never been assigned to any client before, the address is
immediately allocated to the client. If the address is
available for allocation but has been previously assigned to
a different client, the server will keep looking in hopes of
finding an address that has never before been assigned to a
client.</p>

<p style="margin-left:11%; margin-top: 1em">The DHCP server
generates the list of available IP addresses from a hash
table. This means that the addresses are not sorted in any
particular order, and so it is not possible to predict the
order in which the DHCP server will allocate IP addresses.
Users of previous versions of the ISC DHCP server may have
become accustomed to the DHCP server allocating IP addresses
in ascending order, but this is no longer possible, and
there is no way to configure this behavior with version 3 of
the ISC DHCP server.</p>

<h2>IP ADDRESS CONFLICT PREVENTION
<a name="IP ADDRESS CONFLICT PREVENTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The DHCP server
checks IP addresses to see if they are in use before
allocating them to clients. It does this by sending an ICMP
Echo request message to the IP address being allocated. If
no ICMP Echo reply is received within a second, the address
is assumed to be free. This is only done for leases that
have been specified in range statements, and only when the
lease is thought by the DHCP server to be free - i.e., the
DHCP server or its failover peer has not listed the lease as
in use.</p>

<p style="margin-left:11%; margin-top: 1em">If a response
is received to an ICMP Echo request, the DHCP server assumes
that there is a configuration error - the IP address is in
use by some host on the network that is not a DHCP client.
It marks the address as abandoned, and will not assign it to
clients.</p>

<p style="margin-left:11%; margin-top: 1em">If a DHCP
client tries to get an IP address, but none are available,
but there are abandoned IP addresses, then the DHCP server
will attempt to reclaim an abandoned IP address. It marks
one IP address as free, and then does the same ICMP Echo
request check described previously. If there is no answer to
the ICMP Echo request, the address is assigned to the
client.</p>

<p style="margin-left:11%; margin-top: 1em">The DHCP server
does not cycle through abandoned IP addresses if the first
IP address it tries to reclaim is free. Rather, when the
next DHCPDISCOVER comes in from the client, it will attempt
a new allocation using the same method described here, and
will typically try a new IP address.</p>

<h2>DHCP FAILOVER
<a name="DHCP FAILOVER"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This version of
the ISC DHCP server supports the DHCP failover protocol as
documented in draft-ietf-dhc-failover-12.txt. This is not a
final protocol document, and we have not done
interoperability testing with other vendors&rsquo;
implementations of this protocol, so you must not assume
that this implementation conforms to the standard. If you
wish to use the failover protocol, make sure that both
failover peers are running the same version of the ISC DHCP
server.</p>

<p style="margin-left:11%; margin-top: 1em">The failover
protocol allows two DHCP servers (and no more than two) to
share a common address pool. Each server will have about
half of the available IP addresses in the pool at any given
time for allocation. If one server fails, the other server
will continue to renew leases out of the pool, and will
allocate new addresses out of the roughly half of available
addresses that it had when communications with the other
server were lost.</p>

<p style="margin-left:11%; margin-top: 1em">It is possible
during a prolonged failure to tell the remaining server that
the other server is down, in which case the remaining server
will (over time) reclaim all the addresses the other server
had available for allocation, and begin to reuse them. This
is called putting the server into the PARTNER-DOWN
state.</p>

<p style="margin-left:11%; margin-top: 1em">You can put the
server into the PARTNER-DOWN state either by using the
<b>omshell (1)</b> command or by stopping the server,
editing the last failover state declaration in the lease
file, and restarting the server. If you use this last
method, change the &quot;my state&quot; line to:</p>

<p style="margin-left:11%; margin-top: 1em"><b>failover
peer</b> <i>name</i> <b>state { <br>
my state partner-down; <br>
peer state</b> <i>state</i> <b>at</b> <i>date</i><b>; <br>
}</b></p>

<p style="margin-left:11%; margin-top: 1em">It is only
required to change &quot;my state&quot; as shown above.</p>

<p style="margin-left:11%; margin-top: 1em">When the other
server comes back online, it should automatically detect
that it has been offline and request a complete update from
the server that was running in the PARTNER-DOWN state, and
then both servers will resume processing together.</p>

<p style="margin-left:11%; margin-top: 1em">It is possible
to get into a dangerous situation: if you put one server
into the PARTNER-DOWN state, and then *that* server goes
down, and the other server comes back up, the other server
will not know that the first server was in the PARTNER-DOWN
state, and may issue addresses previously issued by the
other server to different clients, resulting in IP address
conflicts. Before putting a server into PARTNER-DOWN state,
therefore, make <i>sure</i> that the other server will not
restart automatically.</p>

<p style="margin-left:11%; margin-top: 1em">The failover
protocol defines a primary server role and a secondary
server role. There are some differences in how primaries and
secondaries act, but most of the differences simply have to
do with providing a way for each peer to behave in the
opposite way from the other. So one server must be
configured as primary, and the other must be configured as
secondary, and it doesn&rsquo;t matter too much which one is
which.</p>

<h2>FAILOVER STARTUP
<a name="FAILOVER STARTUP"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">When a server
starts that has not previously communicated with its
failover peer, it must establish communications with its
failover peer and synchronize with it before it can serve
clients. This can happen either because you have just
configured your DHCP servers to perform failover for the
first time, or because one of your failover servers has
failed catastrophically and lost its database.</p>

<p style="margin-left:11%; margin-top: 1em">The initial
recovery process is designed to ensure that when one
failover peer loses its database and then resynchronizes,
any leases that the failed server gave out before it failed
will be honored. When the failed server starts up, it
notices that it has no saved failover state, and attempts to
contact its peer.</p>

<p style="margin-left:11%; margin-top: 1em">When it has
established contact, it asks the peer for a complete copy
its peer&rsquo;s lease database. The peer then sends its
complete database, and sends a message indicating that it is
done. The failed server then waits until MCLT has passed,
and once MCLT has passed both servers make the transition
back into normal operation. This waiting period ensures that
any leases the failed server may have given out while out of
contact with its partner will have expired.</p>

<p style="margin-left:11%; margin-top: 1em">While the
failed server is recovering, its partner remains in the
partner-down state, which means that it is serving all
clients. The failed server provides no service at all to
DHCP clients until it has made the transition into normal
operation.</p>

<p style="margin-left:11%; margin-top: 1em">In the case
where both servers detect that they have never before
communicated with their partner, they both come up in this
recovery state and follow the procedure we have just
described. In this case, no service will be provided to DHCP
clients until MCLT has expired.</p>

<h2>CONFIGURING FAILOVER
<a name="CONFIGURING FAILOVER"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">In order to
configure failover, you need to write a peer declaration
that configures the failover protocol, and you need to write
peer references in each pool declaration for which you want
to do failover. You do not have to do failover for all pools
on a given network segment. You must not tell one server
it&rsquo;s doing failover on a particular address pool and
tell the other it is not. You must not have any common
address pools on which you are not doing failover. A pool
declaration that utilizes failover would look like this:</p>

<p style="margin-left:11%; margin-top: 1em">pool {</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>failover peer &quot;foo&quot;;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p><i>pool specific parameters</i></p></td></tr>
</table>

<p style="margin-left:11%;">};</p>

<p style="margin-left:11%; margin-top: 1em">Dynamic BOOTP
leases are not compatible with failover, and, as such, you
need to disallow BOOTP in pools that you are using failover
for.</p>

<p style="margin-left:11%; margin-top: 1em">The server
currently does very little sanity checking, so if you
configure it wrong, it will just fail in odd ways. I would
recommend therefore that you either do failover or
don&rsquo;t do failover, but don&rsquo;t do any mixed pools.
Also, use the same master configuration file for both
servers, and have a separate file that contains the peer
declaration and includes the master file. This will help you
to avoid configuration mismatches. As our implementation
evolves, this will become less of a problem. A basic sample
dhcpd.conf file for a primary server might look like
this:</p>

<p style="margin-left:11%; margin-top: 1em">failover peer
&quot;foo&quot; { <br>
primary; <br>
address anthrax.rc.vix.com; <br>
port 647; <br>
peer address trantor.rc.vix.com; <br>
peer port 847; <br>
max-response-delay 60; <br>
max-unacked-updates 10; <br>
mclt 3600; <br>
split 128; <br>
load balance max seconds 3; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">include
&quot;/etc/dhcpd.master&quot;;</p>

<p style="margin-left:11%; margin-top: 1em">The statements
in the peer declaration are as follows:</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>primary</i> and <i>secondary</i> statements</p>

<p style="margin-left:14%; margin-top: 1em">[
<b>primary</b> | <b>secondary</b> ]<b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">This determines
whether the server is primary or secondary, as described
earlier under DHCP FAILOVER.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>address</i> statement</p>

<p style="margin-left:14%; margin-top: 1em"><b>address</b>
<i>address</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The
<b>address</b> statement declares the IP address or DNS name
on which the server should listen for connections from its
failover peer, and also the value to use for the DHCP
Failover Protocol server identifier. Because this value is
used as an identifier, it may not be omitted.</p>

<p style="margin-left:11%; margin-top: 1em">The <i>peer
address</i> statement</p>

<p style="margin-left:14%; margin-top: 1em"><b>peer
address</b> <i>address</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The <b>peer
address</b> statement declares the IP address or DNS name to
which the server should connect to reach its failover peer
for failover messages.</p>

<p style="margin-left:11%; margin-top: 1em">The <i>port</i>
statement</p>

<p style="margin-left:14%; margin-top: 1em"><b>port</b>
<i>port-number</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The <b>port</b>
statement declares the TCP port on which the server should
listen for connections from its failover peer. This
statement may be omitted, in which case the IANA assigned
port number 647 will be used by default.</p>

<p style="margin-left:11%; margin-top: 1em">The <i>peer
port</i> statement</p>

<p style="margin-left:14%; margin-top: 1em"><b>peer
port</b> <i>port-number</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The <b>peer
port</b> statement declares the TCP port to which the server
should connect to reach its failover peer for failover
messages. This statement may be omitted, in which case the
IANA assigned port number 647 will be used by default.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>max-response-delay</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>max-response-delay</b>
<i>seconds</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The
<b>max-response-delay</b> statement tells the DHCP server
how many seconds may pass without receiving a message from
its failover peer before it assumes that connection has
failed. This number should be small enough that a transient
network failure that breaks the connection will not result
in the servers being out of communication for a long time,
but large enough that the server isn&rsquo;t constantly
making and breaking connections. This parameter must be
specified.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>max-unacked-updates</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>max-unacked-updates</b>
<i>count</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The
<b>max-unacked-updates</b> statement tells the remote DHCP
server how many BNDUPD messages it can send before it
receives a BNDACK from the local system. We don&rsquo;t have
enough operational experience to say what a good value for
this is, but 10 seems to work. This parameter must be
specified.</p>

<p style="margin-left:11%; margin-top: 1em">The <i>mclt</i>
statement</p>

<p style="margin-left:14%; margin-top: 1em"><b>mclt</b>
<i>seconds</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The <b>mclt</b>
statement defines the Maximum Client Lead Time. It must be
specified on the primary, and may not be specified on the
secondary. This is the length of time for which a lease may
be renewed by either failover peer without contacting the
other. The longer you set this, the longer it will take for
the running server to recover IP addresses after moving into
PARTNER-DOWN state. The shorter you set it, the more load
your servers will experience when they are not
communicating. A value of something like 3600 is probably
reasonable, but again bear in mind that we have no real
operational experience with this.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>split</i> statement</p>

<p style="margin-left:14%; margin-top: 1em"><b>split</b>
<i>index</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The split
statement specifies the split between the primary and
secondary for the purposes of load balancing. Whenever a
client makes a DHCP request, the DHCP server runs a hash on
the client identification, resulting in value from 0 to 255.
This is used as an index into a 256 bit field. If the bit at
that index is set, the primary is responsible. If the bit at
that index is not set, the secondary is responsible. The
<b>split</b> value determines how many of the leading bits
are set to one. So, in practice, higher split values will
cause the primary to serve more clients than the secondary.
Lower split values, the converse. Legal values are between 0
and 255, of which the most reasonable is 128.</p>

<p style="margin-left:11%; margin-top: 1em">The <i>hba</i>
statement</p>

<p style="margin-left:14%; margin-top: 1em"><b>hba</b>
<i>colon-separated-hex-list</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The hba
statement specifies the split between the primary and
secondary as a bitmap rather than a cutoff, which
theoretically allows for finer-grained control. In practice,
there is probably no need for such fine-grained control,
however. An example hba statement:</p>

<p style="margin-left:14%; margin-top: 1em">hba
ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff: <br>
00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00;</p>

<p style="margin-left:14%; margin-top: 1em">This is
equivalent to a <b>split 128;</b> statement, and identical.
The following two examples are also equivalent to a
<b>split</b> of 128, but are not identical:</p>

<p style="margin-left:14%; margin-top: 1em">hba
aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa: <br>
aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa;</p>

<p style="margin-left:14%; margin-top: 1em">hba
55:55:55:55:55:55:55:55:55:55:55:55:55:55:55:55: <br>
55:55:55:55:55:55:55:55:55:55:55:55:55:55:55:55;</p>

<p style="margin-left:14%; margin-top: 1em">They are
equivalent, because half the bits are set to 0, half are set
to 1 (0xa and 0x5 are 1010 and 0101 binary respectively) and
consequently this would roughly divide the clients equally
between the servers. They are not identical, because the
actual peers this would load balance to each server are
different for each example.</p>

<p style="margin-left:14%; margin-top: 1em">You must only
have <b>split</b> or <b>hba</b> defined, never both. For
most cases, the fine-grained control that <b>hba</b> offers
isn&rsquo;t necessary, and <b>split</b> should be used.</p>

<p style="margin-left:11%; margin-top: 1em">The <i>load
balance max seconds</i> statement</p>

<p style="margin-left:14%; margin-top: 1em"><b>load balance
max seconds</b> <i>seconds</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">This statement
allows you to configure a cutoff after which load balancing
is disabled. The cutoff is based on the number of seconds
since the client sent its first DHCPDISCOVER or DHCPREQUEST
message, and only works with clients that correctly
implement the <i>secs</i> field - fortunately most clients
do. We recommend setting this to something like 3 or 5. The
effect of this is that if one of the failover peers gets
into a state where it is responding to failover messages but
not responding to some client requests, the other failover
peer will take over its client load automatically as the
clients retry.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>auto-partner-down</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>auto-partner-down</b>
<i>seconds</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">This statement
instructs the server to initiate a timed delay upon entering
the communications-interrupted state (any situation of being
out-of-contact with the remote failover peer). At the
conclusion of the timer, the server will automatically enter
the partner-down state. This permits the server to allocate
leases from the partner&rsquo;s free lease pool after an
STOS+MCLT timer expires, which can be dangerous if the
partner is in fact operating at the time (the two servers
will give conflicting bindings).</p>

<p style="margin-left:14%; margin-top: 1em">Think very
carefully before enabling this feature. The partner-down and
communications-interrupted states are intentionally
segregated because there do exist situations where a
failover server can fail to communicate with its peer, but
still has the ability to receive and reply to requests from
DHCP clients. In general, this feature should only be used
in those deployments where the failover servers are directly
connected to one another, such as by a dedicated hardwired
link (&quot;a heartbeat cable&quot;).</p>

<p style="margin-left:14%; margin-top: 1em">A zero value
disables the auto-partner-down feature (also the default),
and any positive value indicates the time in seconds to wait
before automatically entering partner-down.</p>

<p style="margin-left:11%; margin-top: 1em">The Failover
pool balance statements.</p>


<p style="margin-left:14%; margin-top: 1em"><b>max-lease-misbalance</b>
<i>percentage</i><b>; <br>
max-lease-ownership</b> <i>percentage</i><b>; <br>
min-balance</b> <i>seconds</i><b>; <br>
max-balance</b> <i>seconds</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">This version of
the DHCP Server evaluates pool balance on a schedule, rather
than on demand as leases are allocated. The latter approach
proved to be slightly klunky when pool misbalanced reach
total saturation...when any server ran out of leases to
assign, it also lost its ability to notice it had run
dry.</p>

<p style="margin-left:14%; margin-top: 1em">In order to
understand pool balance, some elements of its operation
first need to be defined. First, there are
&acute;free&acute; and &acute;backup&acute; leases. Both of
these are referred to as &acute;free state leases&acute;.
&acute;free&acute; and &acute;backup&acute; are &acute;the
free states&acute; for the purpose of this document. The
difference is that only the primary may allocate from
&acute;free&acute; leases unless under special
circumstances, and only the secondary may allocate
&acute;backup&acute; leases.</p>

<p style="margin-left:14%; margin-top: 1em">When pool
balance is performed, the only plausible expectation is to
provide a 50/50 split of the free state leases between the
two servers. This is because no one can predict which server
will fail, regardless of the relative load placed upon the
two servers, so giving each server half the leases gives
both servers the same amount of &acute;failure
endurance&acute;. Therefore, there is no way to configure
any different behaviour, outside of some very small windows
we will describe shortly.</p>

<p style="margin-left:14%; margin-top: 1em">The first thing
calculated on any pool balance run is a value referred to as
&acute;lts&acute;, or &quot;Leases To Send&quot;. This,
simply, is the difference in the count of free and backup
leases, divided by two. For the secondary, it is the
difference in the backup and free leases, divided by two.
The resulting value is signed: if it is positive, the local
server is expected to hand out leases to retain a 50/50
balance. If it is negative, the remote server would need to
send leases to balance the pool. Once the lts value reaches
zero, the pool is perfectly balanced (give or take one lease
in the case of an odd number of total free state
leases).</p>

<p style="margin-left:14%; margin-top: 1em">The current
approach is still something of a hybrid of the old approach,
marked by the presence of the <b>max-lease-misbalance</b>
statement. This parameter configures what used to be a 10%
fixed value in previous versions: if lts is less than
free+backup * <b>max-lease-misbalance</b> percent, then the
server will skip balancing a given pool (it won&rsquo;t
bother moving any leases, even if some leases
&quot;should&quot; be moved). The meaning of this value is
also somewhat overloaded, however, in that it also governs
the estimation of when to attempt to balance the pool (which
may then also be skipped over). The oldest leases in the
free and backup states are examined. The time they have
resided in their respective queues is used as an estimate to
indicate how much time it is probable it would take before
the leases at the top of the list would be consumed (and
thus, how long it would take to use all leases in that
state). This percentage is directly multiplied by this time,
and fit into the schedule if it falls within the
<b>min-balance</b> and <b>max-balance</b> configured values.
The scheduled pool check time is only moved in a downwards
direction, it is never increased. Lastly, if the lts is more
than double this number in the negative direction, the local
server will &acute;panic&acute; and transmit a Failover
protocol POOLREQ message, in the hopes that the remote
system will be woken up into action.</p>

<p style="margin-left:14%; margin-top: 1em">Once the lts
value exceeds the <b>max-lease-misbalance</b> percentage of
total free state leases as described above, leases are moved
to the remote server. This is done in two passes.</p>

<p style="margin-left:14%; margin-top: 1em">In the first
pass, only leases whose most recent bound client would have
been served by the remote server - according to the Load
Balance Algorithm (see above <b>split</b> and <b>hba</b>
configuration statements) - are given away to the peer. This
first pass will happily continue to give away leases,
decrementing the lts value by one for each, until the lts
value has reached the negative of the total number of leases
multiplied by the <b>max-lease-ownership</b> percentage. So
it is through this value that you can permit a small
misbalance of the lease pools - for the purpose of giving
the peer more than a 50/50 share of leases in the hopes that
their clients might some day return and be allocated by the
peer (operating normally). This process is referred to as
&acute;MAC Address Affinity&acute;, but this is somewhat
misnamed: it applies equally to DHCP Client Identifier
options. Note also that affinity is applied to leases when
they enter the state &acute;free&acute; from
&acute;expired&acute; or &acute;released&acute;. In this
case also, leases will not be moved from free to backup if
the secondary already has more than its share.</p>

<p style="margin-left:14%; margin-top: 1em">The second pass
is only entered into if the first pass fails to reduce the
lts underneath the total number of free state leases
multiplied by the <b>max-lease-ownership</b> percentage. In
this pass, the oldest leases are given over to the peer
without second thought about the Load Balance Algorithm, and
this continues until the lts falls under this value. In this
way, the local server will also happily keep a small
percentage of the leases that would normally load balance to
itself.</p>

<p style="margin-left:14%; margin-top: 1em">So, the
<b>max-lease-misbalance</b> value acts as a behavioural
gate. Smaller values will cause more leases to transition
states to balance the pools over time, higher values will
decrease the amount of change (but may lead to pool
starvation if there&rsquo;s a run on leases).</p>

<p style="margin-left:14%; margin-top: 1em">The
<b>max-lease-ownership</b> value permits a small
(percentage) skew in the lease balance of a percentage of
the total number of free state leases.</p>

<p style="margin-left:14%; margin-top: 1em">Finally, the
<b>min-balance</b> and <b>max-balance</b> make certain that
a scheduled rebalance event happens within a reasonable
timeframe (not to be thrown off by, for example, a 7 year
old free lease).</p>

<p style="margin-left:14%; margin-top: 1em">Plausible
values for the percentages lie between 0 and 100, inclusive,
but values over 50 are indistinguishable from one another
(once lts exceeds 50% of the free state leases, one server
must therefore have 100% of the leases in its respective
free state). It is recommended to select a
<b>max-lease-ownership</b> value that is lower than the
value selected for the <b>max-lease-misbalance</b> value.
<b>max-lease-ownership</b> defaults to 10, and
<b>max-lease-misbalance</b> defaults to 15.</p>

<p style="margin-left:14%; margin-top: 1em">Plausible
values for the <b>min-balance</b> and <b>max-balance</b>
times also range from 0 to (2^32)-1 (or the limit of your
local time_t value), but default to values 60 and 3600
respectively (to place balance events between 1 minute and 1
hour).</p>

<h2>CLIENT CLASSING
<a name="CLIENT CLASSING"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Clients can be
separated into classes, and treated differently depending on
what class they are in. This separation can be done either
with a conditional statement, or with a match statement
within the class declaration. It is possible to specify a
limit on the total number of clients within a particular
class or subclass that may hold leases at one time, and it
is possible to specify automatic subclassing based on the
contents of the client packet.</p>

<p style="margin-left:11%; margin-top: 1em">To add clients
to classes based on conditional evaluation, you can specify
a matching expression in the class statement:</p>

<p style="margin-left:11%; margin-top: 1em">class
&quot;ras-clients&quot; { <br>
match if substring (option dhcp-client-identifier, 1, 3) =
&quot;RAS&quot;; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">Note that
whether you use matching expressions or add statements (or
both) to classify clients, you must always write a class
declaration for any class that you use. If there will be no
match statement and no in-scope statements for a class, the
declaration should look like this:</p>

<p style="margin-left:11%; margin-top: 1em">class
&quot;ras-clients&quot; { <br>
}</p>

<h2>SUBCLASSES
<a name="SUBCLASSES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">In addition to
classes, it is possible to declare subclasses. A subclass is
a class with the same name as a regular class, but with a
specific submatch expression which is hashed for quick
matching. This is essentially a speed hack - the main
difference between five classes with match expressions and
one class with five subclasses is that it will be quicker to
find the subclasses. Subclasses work as follows:</p>

<p style="margin-left:11%; margin-top: 1em">class
&quot;allocation-class-1&quot; { <br>
match pick-first-value (option dhcp-client-identifier,
hardware); <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">class
&quot;allocation-class-2&quot; { <br>
match pick-first-value (option dhcp-client-identifier,
hardware); <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">subclass
&quot;allocation-class-1&quot; 1:8:0:2b:4c:39:ad; <br>
subclass &quot;allocation-class-2&quot; 1:8:0:2b:a9:cc:e3;
<br>
subclass &quot;allocation-class-1&quot;
1:0:0:c4:aa:29:44;</p>

<p style="margin-left:11%; margin-top: 1em">subnet 10.0.0.0
netmask 255.255.255.0 { <br>
pool { <br>
allow members of &quot;allocation-class-1&quot;; <br>
range 10.0.0.11 10.0.0.50; <br>
} <br>
pool { <br>
allow members of &quot;allocation-class-2&quot;; <br>
range 10.0.0.51 10.0.0.100; <br>
} <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">The data
following the class name in the subclass declaration is a
constant value to use in matching the match expression for
the class. When class matching is done, the server will
evaluate the match expression and then look the result up in
the hash table. If it finds a match, the client is
considered a member of both the class and the subclass.</p>

<p style="margin-left:11%; margin-top: 1em">Subclasses can
be declared with or without scope. In the above example, the
sole purpose of the subclass is to allow some clients access
to one address pool, while other clients are given access to
the other pool, so these subclasses are declared without
scopes. If part of the purpose of the subclass were to
define different parameter values for some clients, you
might want to declare some subclasses with scopes.</p>

<p style="margin-left:11%; margin-top: 1em">In the above
example, if you had a single client that needed some
configuration parameters, while most didn&rsquo;t, you might
write the following subclass declaration for that
client:</p>

<p style="margin-left:11%; margin-top: 1em">subclass
&quot;allocation-class-2&quot; 1:08:00:2b:a1:11:31 { <br>
option root-path &quot;samsara:/var/diskless/alphapc&quot;;
<br>
filename &quot;/tftpboot/netbsd.alphapc-diskless&quot;; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">In this
example, we&rsquo;ve used subclassing as a way to control
address allocation on a per-client basis. However,
it&rsquo;s also possible to use subclassing in ways that are
not specific to clients - for example, to use the value of
the vendor-class-identifier option to determine what values
to send in the vendor-encapsulated-options option. An
example of this is shown under the VENDOR ENCAPSULATED
OPTIONS head in the <b>dhcp-options(5)</b> manual page.</p>

<h2>PER-CLASS LIMITS ON DYNAMIC ADDRESS ALLOCATION
<a name="PER-CLASS LIMITS ON DYNAMIC ADDRESS ALLOCATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">You may specify
a limit to the number of clients in a class that can be
assigned leases. The effect of this will be to make it
difficult for a new client in a class to get an address.
Once a class with such a limit has reached its limit, the
only way a new client in that class can get a lease is for
an existing client to relinquish its lease, either by
letting it expire, or by sending a DHCPRELEASE packet.
Classes with lease limits are specified as follows:</p>

<p style="margin-left:11%; margin-top: 1em">class
&quot;limited-1&quot; { <br>
lease limit 4; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">This will
produce a class in which a maximum of four members may hold
a lease at one time.</p>

<h2>SPAWNING CLASSES
<a name="SPAWNING CLASSES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">It is possible
to declare a <i>spawning class</i>. A spawning class is a
class that automatically produces subclasses based on what
the client sends. The reason that spawning classes were
created was to make it possible to create lease-limited
classes on the fly. The envisioned application is a
cable-modem environment where the ISP wishes to provide
clients at a particular site with more than one IP address,
but does not wish to provide such clients with their own
subnet, nor give them an unlimited number of IP addresses
from the network segment to which they are connected.</p>

<p style="margin-left:11%; margin-top: 1em">Many cable
modem head-end systems can be configured to add a Relay
Agent Information option to DHCP packets when relaying them
to the DHCP server. These systems typically add a circuit ID
or remote ID option that uniquely identifies the customer
site. To take advantage of this, you can write a class
declaration as follows:</p>

<p style="margin-left:11%; margin-top: 1em">class
&quot;customer&quot; { <br>
spawn with option agent.circuit-id; <br>
lease limit 4; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">Now whenever a
request comes in from a customer site, the circuit ID option
will be checked against the class&rsquo;s hash table. If a
subclass is found that matches the circuit ID, the client
will be classified in that subclass and treated accordingly.
If no subclass is found matching the circuit ID, a new one
will be created and logged in the <b>dhcpd.leases</b> file,
and the client will be classified in this new class. Once
the client has been classified, it will be treated according
to the rules of the class, including, in this case, being
subject to the per-site limit of four leases.</p>

<p style="margin-left:11%; margin-top: 1em">The use of the
subclass spawning mechanism is not restricted to relay agent
options - this particular example is given only because it
is a fairly straightforward one.</p>

<h2>COMBINING MATCH, MATCH IF AND SPAWN WITH
<a name="COMBINING MATCH, MATCH IF AND SPAWN WITH"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">In some cases,
it may be useful to use one expression to assign a client to
a particular class, and a second expression to put it into a
subclass of that class. This can be done by combining the
<b>match if</b> and <b>spawn with</b> statements, or the
<b>match if</b> and <b>match</b> statements. For
example:</p>

<p style="margin-left:11%; margin-top: 1em">class
&quot;jr-cable-modems&quot; { <br>
match if option dhcp-vendor-identifier = &quot;jrcm&quot;;
<br>
spawn with option agent.circuit-id; <br>
lease limit 4; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">class
&quot;dv-dsl-modems&quot; { <br>
match if option dhcp-vendor-identifier = &quot;dvdsl&quot;;
<br>
spawn with option agent.circuit-id; <br>
lease limit 16; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">This allows you
to have two classes that both have the same <b>spawn
with</b> expression without getting the clients in the two
classes confused with each other.</p>

<h2>DYNAMIC DNS UPDATES
<a name="DYNAMIC DNS UPDATES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The DHCP server
has the ability to dynamically update the Domain Name
System. Within the configuration files, you can define how
you want the Domain Name System to be updated. These updates
are RFC 2136 compliant so any DNS server supporting RFC 2136
should be able to accept updates from the DHCP server.</p>

<p style="margin-left:11%; margin-top: 1em">Two DNS update
schemes are currently implemented, and another is planned.
The two that are currently implemented are the ad-hoc DNS
update mode and the interim DHCP-DNS interaction draft
update mode. In the future we plan to add a third mode which
will be the standard DNS update method based on the RFCS for
DHCP-DNS interaction and DHCID The DHCP server must be
configured to use one of the two currently-supported
methods, or not to do dns updates. This can be done with the
<i>ddns-update-style</i> configuration parameter.</p>

<h2>THE AD-HOC DNS UPDATE SCHEME
<a name="THE AD-HOC DNS UPDATE SCHEME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The ad-hoc
Dynamic DNS update scheme is <b>now deprecated</b> and
<b>does not work.</b> In future releases of the ISC DHCP
server, this scheme will not likely be available. The
interim scheme works, allows for failover, and should now be
used. The following description is left here for
informational purposes only.</p>

<p style="margin-left:11%; margin-top: 1em">The ad-hoc
Dynamic DNS update scheme implemented in this version of the
ISC DHCP server is a prototype design, which does not have
much to do with the standard update method that is being
standardized in the IETF DHC working group, but rather
implements some very basic, yet useful, update capabilities.
This mode <b>does not work</b> with the <i>failover
protocol</i> because it does not account for the possibility
of two different DHCP servers updating the same set of DNS
records.</p>

<p style="margin-left:11%; margin-top: 1em">For the ad-hoc
DNS update method, the client&rsquo;s FQDN is derived in two
parts. First, the hostname is determined. Then, the domain
name is determined, and appended to the hostname.</p>

<p style="margin-left:11%; margin-top: 1em">The DHCP server
determines the client&rsquo;s hostname by first looking for
a <i>ddns-hostname</i> configuration option, and using that
if it is present. If no such option is present, the server
looks for a valid hostname in the FQDN option sent by the
client. If one is found, it is used; otherwise, if the
client sent a host-name option, that is used. Otherwise, if
there is a host declaration that applies to the client, the
name from that declaration will be used. If none of these
applies, the server will not have a hostname for the client,
and will not be able to do a DNS update.</p>

<p style="margin-left:11%; margin-top: 1em">The domain name
is determined from the <i>ddns-domainname</i> configuration
option. The default configuration for this option is:</p>

<p style="margin-left:11%; margin-top: 1em">option
server.ddns-domainname = config-option domain-name;</p>

<p style="margin-left:11%; margin-top: 1em">So if this
configuration option is not configured to a different value
(over-riding the above default), or if a domain-name option
has not been configured for the client&rsquo;s scope, then
the server will not attempt to perform a DNS update.</p>

<p style="margin-left:11%; margin-top: 1em">The
client&rsquo;s fully-qualified domain name, derived as we
have described, is used as the name on which an
&quot;A&quot; record will be stored. The A record will
contain the IP address that the client was assigned in its
lease. If there is already an A record with the same name in
the DNS server, no update of either the A or PTR records
will occur - this prevents a client from claiming that its
hostname is the name of some network server. For example, if
you have a fileserver called &quot;fs.sneedville.edu&quot;,
and the client claims its hostname is &quot;fs&quot;, no DNS
update will be done for that client, and an error message
will be logged.</p>

<p style="margin-left:11%; margin-top: 1em">If the A record
update succeeds, a PTR record update for the assigned IP
address will be done, pointing to the A record. This update
is unconditional - it will be done even if another PTR
record of the same name exists. Since the IP address has
been assigned to the DHCP server, this should be safe.</p>

<p style="margin-left:11%; margin-top: 1em">Please note
that the current implementation assumes clients only have a
single network interface. A client with two network
interfaces will see unpredictable behavior. This is
considered a bug, and will be fixed in a later release. It
may be helpful to enable the <i>one-lease-per-client</i>
parameter so that roaming clients do not trigger this same
behavior.</p>

<p style="margin-left:11%; margin-top: 1em">The DHCP
protocol normally involves a four-packet exchange - first
the client sends a DHCPDISCOVER message, then the server
sends a DHCPOFFER, then the client sends a DHCPREQUEST, then
the server sends a DHCPACK. In the current version of the
server, the server will do a DNS update after it has
received the DHCPREQUEST, and before it has sent the
DHCPACK. It only sends the DNS update if it has not sent one
for the client&rsquo;s address before, in order to minimize
the impact on the DHCP server.</p>

<p style="margin-left:11%; margin-top: 1em">When the
client&rsquo;s lease expires, the DHCP server (if it is
operating at the time, or when next it operates) will remove
the client&rsquo;s A and PTR records from the DNS database.
If the client releases its lease by sending a DHCPRELEASE
message, the server will likewise remove the A and PTR
records.</p>

<h2>THE INTERIM DNS UPDATE SCHEME
<a name="THE INTERIM DNS UPDATE SCHEME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The interim DNS
update scheme operates mostly according to several drafts
considered by the IETF. While the drafts have since become
RFCs the code was written before they were finalized and
there are some differences between our code and the final
RFCs. We plan to update our code, probably adding a standard
DNS update option, at some time. The basic framework is
similar with the main material difference being that a DHCID
RR was assigned in the RFCs whereas our code continues to
use an experimental TXT record. The format of the TXT record
bears a resemblance to the DHCID RR but it is not equivalent
(MD5 vs SHA1, field length differences etc). The standard
RFCs are:</p>

<p align="center" style="margin-top: 1em">RFC 4701 (updated
by RF5494) <br>
RFC 4702 <br>
RFC 4703</p>

<p style="margin-top: 1em">And the corresponding drafts
were:</p>


<p align="center" style="margin-top: 1em">draft-ietf-dnsext-dhcid-rr-??.txt
<br>
draft-ietf-dhc-fqdn-option-??.txt <br>
draft-ietf-dhc-ddns-resolution-??.txt</p>

<p style="margin-top: 1em">Because our implementation is
slightly different than the standard, we will briefly
document the operation of this update style here.</p>

<p style="margin-top: 1em">The first point to understand
about this style of DNS update is that unlike the ad-hoc
style, the DHCP server does not necessarily always update
both the A and the PTR records. The FQDN option includes a
flag which, when sent by the client, indicates that the
client wishes to update its own A record. In that case, the
server can be configured either to honor the client&rsquo;s
intentions or ignore them. This is done with the statement
<i>allow client-updates;</i> or the statement <i>ignore
client-updates;</i>. By default, client updates are
allowed.</p>

<p style="margin-top: 1em">If the server is configured to
allow client updates, then if the client sends a
fully-qualified domain name in the FQDN option, the server
will use that name the client sent in the FQDN option to
update the PTR record. For example, let us say that the
client is a visitor from the &quot;radish.org&quot; domain,
whose hostname is &quot;jschmoe&quot;. The server is for the
&quot;example.org&quot; domain. The DHCP client indicates in
the FQDN option that its FQDN is
&quot;jschmoe.radish.org.&quot;. It also indicates that it
wants to update its own A record. The DHCP server therefore
does not attempt to set up an A record for the client, but
does set up a PTR record for the IP address that it assigns
the client, pointing at jschmoe.radish.org. Once the DHCP
client has an IP address, it can update its own A record,
assuming that the &quot;radish.org&quot; DNS server will
allow it to do so.</p>

<p style="margin-top: 1em">If the server is configured not
to allow client updates, or if the client doesn&rsquo;t want
to do its own update, the server will simply choose a name
for the client from either the fqdn option (if present) or
the hostname option (if present). It will use its own domain
name for the client, just as in the ad-hoc update scheme. It
will then update both the A and PTR record, using the name
that it chose for the client. If the client sends a
fully-qualified domain name in the fqdn option, the server
uses only the leftmost part of the domain name - in the
example above, &quot;jschmoe&quot; instead of
&quot;jschmoe.radish.org&quot;.</p>

<p style="margin-top: 1em">Further, if the <i>ignore
client-updates;</i> directive is used, then the server will
in addition send a response in the DHCP packet, using the
FQDN Option, that implies to the client that it should
perform its own updates if it chooses to do so. With <i>deny
client-updates;</i>, a response is sent which indicates the
client may not perform updates.</p>

<p style="margin-top: 1em">Also, if the
<i>use-host-decl-names</i> configuration option is enabled,
then the host declaration&rsquo;s <i>hostname</i> will be
used in place of the <i>hostname</i> option, and the same
rules will apply as described above.</p>

<p style="margin-top: 1em">The other difference between the
ad-hoc scheme and the interim scheme is that with the
interim scheme, a method is used that allows more than one
DHCP server to update the DNS database without accidentally
deleting A records that shouldn&rsquo;t be deleted nor
failing to add A records that should be added. The scheme
works as follows:</p>

<p style="margin-top: 1em">When the DHCP server issues a
client a new lease, it creates a text string that is an MD5
hash over the DHCP client&rsquo;s identification (see
draft-ietf-dnsext-dhcid-rr-??.txt for details). The update
adds an A record with the name the server chose and a TXT
record containing the hashed identifier string (hashid). If
this update succeeds, the server is done.</p>

<p style="margin-top: 1em">If the update fails because the
A record already exists, then the DHCP server attempts to
add the A record with the prerequisite that there must be a
TXT record in the same name as the new A record, and that
TXT record&rsquo;s contents must be equal to hashid. If this
update succeeds, then the client has its A record and PTR
record. If it fails, then the name the client has been
assigned (or requested) is in use, and can&rsquo;t be used
by the client. At this point the DHCP server gives up trying
to do a DNS update for the client until the client chooses a
new name.</p>

<p style="margin-top: 1em">The interim DNS update scheme is
called interim for two reasons. First, it does not quite
follow the RFCs. The RFCs call for a new DHCID RRtype while
he interim DNS update scheme uses a TXT record. The
ddns-resolution draft called for the DHCP server to put a
DHCID RR on the PTR record, but the <i>interim</i> update
method does not do this. In the final RFC this requirement
was relaxed such that a server may add a DHCID RR to the PTR
record.</p>

<p style="margin-top: 1em">In addition to these
differences, the server also does not update very
aggressively. Because each DNS update involves a round trip
to the DNS server, there is a cost associated with doing
updates even if they do not actually modify the DNS
database. So the DHCP server tracks whether or not it has
updated the record in the past (this information is stored
on the lease) and does not attempt to update records that it
thinks it has already updated.</p>

<p style="margin-top: 1em">This can lead to cases where the
DHCP server adds a record, and then the record is deleted
through some other mechanism, but the server never again
updates the DNS because it thinks the data is already there.
In this case the data can be removed from the lease through
operator intervention, and once this has been done, the DNS
will be updated the next time the client renews.</p>

<h2>DYNAMIC DNS UPDATE SECURITY
<a name="DYNAMIC DNS UPDATE SECURITY"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">When you set
your DNS server up to allow updates from the DHCP server,
you may be exposing it to unauthorized updates. To avoid
this, you should use TSIG signatures - a method of
cryptographically signing updates using a shared secret key.
As long as you protect the secrecy of this key, your updates
should also be secure. Note, however, that the DHCP protocol
itself provides no security, and that clients can therefore
provide information to the DHCP server which the DHCP server
will then use in its updates, with the constraints described
previously.</p>

<p style="margin-left:11%; margin-top: 1em">The DNS server
must be configured to allow updates for any zone that the
DHCP server will be updating. For example, let us say that
clients in the sneedville.edu domain will be assigned
addresses on the 10.10.17.0/24 subnet. In that case, you
will need a key declaration for the TSIG key you will be
using, and also two zone declarations - one for the zone
containing A records that will be updates and one for the
zone containing PTR records - for ISC BIND, something like
this:</p>

<p style="margin-left:11%; margin-top: 1em">key
DHCP_UPDATER { <br>
algorithm hmac-md5; <br>
secret pRP5FapFoJ95JEL06sv4PQ==; <br>
};</p>

<p style="margin-left:11%; margin-top: 1em">zone
&quot;example.org&quot; {</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>type master;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>file &quot;example.org.db&quot;;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>allow-update { key DHCP_UPDATER; };</p></td></tr>
</table>

<p style="margin-left:11%;">};</p>

<p style="margin-left:11%; margin-top: 1em">zone
&quot;17.10.10.in-addr.arpa&quot; {</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>type master;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>file &quot;10.10.17.db&quot;;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>allow-update { key DHCP_UPDATER; };</p></td></tr>
</table>

<p style="margin-left:11%;">};</p>

<p style="margin-left:11%; margin-top: 1em">You will also
have to configure your DHCP server to do updates to these
zones. To do so, you need to add something like this to your
dhcpd.conf file:</p>

<p style="margin-left:11%; margin-top: 1em">key
DHCP_UPDATER { <br>
algorithm hmac-md5; <br>
secret pRP5FapFoJ95JEL06sv4PQ==; <br>
};</p>

<p style="margin-left:11%; margin-top: 1em">zone
EXAMPLE.ORG. { <br>
primary 127.0.0.1; <br>
key DHCP_UPDATER; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">zone
17.127.10.in-addr.arpa. { <br>
primary 127.0.0.1; <br>
key DHCP_UPDATER; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>primary</i> statement specifies the IP address of the
name server whose zone information is to be updated. In
addition to the <i>primary</i> statement there are also the
<i>primary6</i> , <i>secondary</i> and <i>secondary6</i>
statements. The <i>primary6</i> statement specifies an IPv6
address for the name server. The secondaries provide for
additional addresses for name servers to be used if the
primary does not respond. The number of name servers the
DDNS code will attempt to use before giving up is limited
and is currently set to three.</p>

<p style="margin-left:11%; margin-top: 1em">Note that the
zone declarations have to correspond to authority records in
your name server - in the above example, there must be an
SOA record for &quot;example.org.&quot; and for
&quot;17.10.10.in-addr.arpa.&quot;. For example, if there
were a subdomain &quot;foo.example.org&quot; with no
separate SOA, you could not write a zone declaration for
&quot;foo.example.org.&quot; Also keep in mind that zone
names in your DHCP configuration should end in a
&quot;.&quot;; this is the preferred syntax. If you do not
end your zone name in a &quot;.&quot;, the DHCP server will
figure it out. Also note that in the DHCP configuration,
zone names are not encapsulated in quotes where there are in
the DNS configuration.</p>

<p style="margin-left:11%; margin-top: 1em">You should
choose your own secret key, of course. The ISC BIND 8 and 9
distributions come with a program for generating secret keys
called dnssec-keygen. The version that comes with BIND 9 is
likely to produce a substantially more random key, so we
recommend you use that one even if you are not using BIND 9
as your DNS server. If you are using BIND 9&rsquo;s
dnssec-keygen, the above key would be created as
follows:</p>

<p style="margin-left:11%; margin-top: 1em">dnssec-keygen
-a HMAC-MD5 -b 128 -n USER DHCP_UPDATER</p>

<p style="margin-left:11%; margin-top: 1em">If you are
using the BIND 8 dnskeygen program, the following command
will generate a key as seen above:</p>

<p style="margin-left:11%; margin-top: 1em">dnskeygen -H
128 -u -c -n DHCP_UPDATER</p>

<p style="margin-left:11%; margin-top: 1em">You may wish to
enable logging of DNS updates on your DNS server. To do so,
you might write a logging statement like the following:</p>

<p style="margin-left:11%; margin-top: 1em">logging {</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>channel update_debug {</p></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="46%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="8%">


<p>file &quot;/var/log/update-debug.log&quot;;</p></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="46%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="8%">


<p>severity</p></td>
<td width="7%"></td>
<td width="8%">


<p>debug 3;</p></td>
<td width="8%"></td>
<td width="46%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="8%">


<p>print-category</p></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%">


<p>yes;</p></td>
<td width="46%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="8%">


<p>print-severity</p></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%">


<p>yes;</p></td>
<td width="46%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="8%">


<p>print-time</p></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%">


<p>yes;</p></td>
<td width="46%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>};</p></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="46%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>channel security_info</p></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="46%">


<p>{</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="8%">


<p>file</p></td>
<td width="7%">


<p>&quot;/var/log/named-auth.info&quot;;</p></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="46%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="8%">


<p>severity</p></td>
<td width="7%"></td>
<td width="8%">


<p>info;</p></td>
<td width="8%"></td>
<td width="46%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="8%">


<p>print-category</p></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%">


<p>yes;</p></td>
<td width="46%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="8%">


<p>print-severity</p></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%">


<p>yes;</p></td>
<td width="46%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="8%">


<p>print-time</p></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%">


<p>yes;</p></td>
<td width="46%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>};</p></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="46%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>category update { update_debug; };</p></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="46%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>category security { security_info; };</p></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="46%">
</td></tr>
</table>

<p style="margin-left:11%;">};</p>

<p style="margin-left:11%; margin-top: 1em">You must create
the /var/log/named-auth.info and /var/log/update-debug.log
files before starting the name server. For more information
on configuring ISC BIND, consult the documentation that
accompanies it.</p>

<h2>REFERENCE: EVENTS
<a name="REFERENCE: EVENTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">There are three
kinds of events that can happen regarding a lease, and it is
possible to declare statements that occur when any of these
events happen. These events are the commit event, when the
server has made a commitment of a certain lease to a client,
the release event, when the client has released the server
from its commitment, and the expiry event, when the
commitment expires.</p>

<p style="margin-left:11%; margin-top: 1em">To declare a
set of statements to execute when an event happens, you must
use the <b>on</b> statement, followed by the name of the
event, followed by a series of statements to execute when
the event happens, enclosed in braces. Events are used to
implement DNS updates, so you should not define your own
event handlers if you are using the built-in DNS update
mechanism.</p>

<p style="margin-left:11%; margin-top: 1em">The built-in
version of the DNS update mechanism is in a text string
towards the top of server/dhcpd.c. If you want to use events
for things other than DNS updates, and you also want DNS
updates, you will have to start out by copying this code
into your dhcpd.conf file and modifying it.</p>

<h2>REFERENCE: DECLARATIONS
<a name="REFERENCE: DECLARATIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>include</i> <b>statement</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>include</b>
<i>&quot;filename&quot;</i><b>;</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<i>include</i> statement is used to read in a named file,
and process the contents of that file as though it were
entered in place of the include statement.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>shared-network</i> <b>statement</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>shared-network</b>
<i>name</i> <b>{</b> <br>
[ <i>parameters</i> ] <br>
[ <i>declarations</i> ] <b><br>
}</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<i>shared-network</i> statement is used to inform the DHCP
server that some IP subnets actually share the same physical
network. Any subnets in a shared network should be declared
within a <i>shared-network</i> statement. Parameters
specified in the <i>shared-network</i> statement will be
used when booting clients on those subnets unless parameters
provided at the subnet or host level override them. If any
subnet in a shared network has addresses available for
dynamic allocation, those addresses are collected into a
common pool for that shared network and assigned to clients
as needed. There is no way to distinguish on which subnet of
a shared network a client should boot.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Name</i>
should be the name of the shared network. This name is used
when printing debugging messages, so it should be
descriptive for the shared network. The name may have the
syntax of a valid domain name (although it will never be
used as such), or it may be any arbitrary name, enclosed in
quotes.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>subnet</i> <b>statement</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>subnet</b>
<i>subnet-number</i> <b>netmask</b> <i>netmask</i> <b>{</b>
<br>
[ <i>parameters</i> ] <br>
[ <i>declarations</i> ] <b><br>
}</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<i>subnet</i> statement is used to provide dhcpd with enough
information to tell whether or not an IP address is on that
subnet. It may also be used to provide subnet-specific
parameters and to specify what addresses may be dynamically
allocated to clients booting on that subnet. Such addresses
are specified using the <i>range</i> declaration.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>subnet-number</i> should be an IP address or domain name
which resolves to the subnet number of the subnet being
described. The <i>netmask</i> should be an IP address or
domain name which resolves to the subnet mask of the subnet
being described. The subnet number, together with the
netmask, are sufficient to determine whether any given IP
address is on the specified subnet.</p>

<p style="margin-left:11%; margin-top: 1em">Although a
netmask must be given with every subnet declaration, it is
recommended that if there is any variance in subnet masks at
a site, a subnet-mask option statement be used in each
subnet declaration to set the desired subnet mask, since any
subnet-mask option statement will override the subnet mask
declared in the subnet statement.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>subnet6</i> <b>statement</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>subnet6</b>
<i>subnet6-number</i> <b>{</b> <br>
[ <i>parameters</i> ] <br>
[ <i>declarations</i> ] <b><br>
}</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<i>subnet6</i> statement is used to provide dhcpd with
enough information to tell whether or not an IPv6 address is
on that subnet6. It may also be used to provide
subnet-specific parameters and to specify what addresses may
be dynamically allocated to clients booting on that
subnet.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>subnet6-number</i> should be an IPv6 network identifier,
specified as ip6-address/bits.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>range</i> <b>statement</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>range</b> [
<b>dynamic-bootp</b> ] <i>low-address</i> [
<i>high-address</i>]<b>;</b></p>

<p style="margin-left:11%; margin-top: 1em">For any subnet
on which addresses will be assigned dynamically, there must
be at least one <i>range</i> statement. The range statement
gives the lowest and highest IP addresses in a range. All IP
addresses in the range should be in the subnet in which the
<i>range</i> statement is declared. The <i>dynamic-bootp</i>
flag may be specified if addresses in the specified range
may be dynamically assigned to BOOTP clients as well as DHCP
clients. When specifying a single address,
<i>high-address</i> can be omitted.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>range6</i> <b>statement</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>range6</b>
<i>low-address high-address</i><b>; <br>
range6</b> <i>subnet6-number</i><b>; <br>
range6</b> <i>subnet6-number</i> <b>temporary; <br>
range6</b> <i>address</i> <b>temporary;</b></p>

<p style="margin-left:11%; margin-top: 1em">For any IPv6
subnet6 on which addresses will be assigned dynamically,
there must be at least one <i>range6</i> statement. The
<i>range6</i> statement can either be the lowest and highest
IPv6 addresses in a <i>range6</i>, or use CIDR notation,
specified as ip6-address/bits. All IP addresses in the
<i>range6</i> should be in the subnet6 in which the
<i>range6</i> statement is declared.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>temporary</i> variant makes the prefix (by default on 64
bits) available for temporary (RFC 4941) addresses. A new
address per prefix in the shared network is computed at each
request with an IA_TA option. Release and Confirm ignores
temporary addresses.</p>

<p style="margin-left:11%; margin-top: 1em">Any IPv6
addresses given to hosts with <i>fixed-address6</i> are
excluded from the <i>range6</i>, as are IPv6 addresses on
the server itself.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>prefix6</i> <b>statement</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>prefix6</b>
<i>low-address high-address</i> <b>/</b>
<i>bits</i><b>;</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<i>prefix6</i> is the <i>range6</i> equivalent for Prefix
Delegation (RFC 3633). Prefixes of <i>bits</i> length are
assigned between <i>low-address</i> and
<i>high-address</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Any IPv6
prefixes given to static entries (hosts) with
<i>fixed-prefix6</i> are excluded from the
<i>prefix6</i>.</p>

<p style="margin-left:11%; margin-top: 1em">This statement
is currently global but it should have a shared-network
scope.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>host</i> <b>statement</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>host</b>
<i>hostname</i> { <br>
[ <i>parameters</i> ] <br>
[ <i>declarations</i> ] <b><br>
}</b></p>

<p style="margin-left:11%; margin-top: 1em">The <b>host</b>
declaration provides a scope in which to provide
configuration information about a specific client, and also
provides a way to assign a client a fixed address. The host
declaration provides a way for the DHCP server to identify a
DHCP or BOOTP client, and also a way to assign the client a
static IP address.</p>

<p style="margin-left:11%; margin-top: 1em">If it is
desirable to be able to boot a DHCP or BOOTP client on more
than one subnet with fixed addresses, more than one address
may be specified in the <i>fixed-address</i> declaration, or
more than one <b>host</b> statement may be specified
matching the same client.</p>

<p style="margin-left:11%; margin-top: 1em">If
client-specific boot parameters must change based on the
network to which the client is attached, then multiple
<b>host</b> declarations should be used. The <b>host</b>
declarations will only match a client if one of their
<i>fixed-address</i> statements is viable on the subnet (or
shared network) where the client is attached. Conversely,
for a <b>host</b> declaration to match a client being
allocated a dynamic address, it must not have any
<i>fixed-address</i> statements. You may therefore need a
mixture of <b>host</b> declarations for any given
client...some having <i>fixed-address</i> statements, others
without.</p>


<p style="margin-left:11%; margin-top: 1em"><i>hostname</i>
should be a name identifying the host. If a <i>hostname</i>
option is not specified for the host, <i>hostname</i> is
used.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Host</i>
declarations are matched to actual DHCP or BOOTP clients by
matching the <i>dhcp-client-identifier</i> or
<i>pxe-client-id</i> options specified in the <i>host</i>
declaration to the one supplied by the client, or, if the
<i>host</i> declaration or the client does not provide a
<i>dhcp-client-identifier</i> or <i>pxe-client-id</i>
options, by matching the <i>hardware</i> parameter in the
<i>host</i> declaration to the network hardware address
supplied by the client. BOOTP clients do not normally
provide a <i>dhcp-client-identifier</i>, so the hardware
address must be used for all clients that may boot using the
BOOTP protocol.</p>

<p style="margin-left:11%; margin-top: 1em">DHCPv6 servers
can use the <i>host-identifier option</i> parameter in the
<i>host</i> declaration, and specify any option with a fixed
value to identify hosts.</p>

<p style="margin-left:11%; margin-top: 1em">Please be aware
that <b>only</b> the <i>dhcp-client-identifier</i> and
<i>pxe-client-id</i> options and the hardware address can be
used to match a host declaration, or the <i>host-identifier
option</i> parameter for DHCPv6 servers. For example, it is
not possible to match a host declaration to a
<i>host-name</i> option. This is because the host-name
option cannot be guaranteed to be unique for any given
client, whereas both the hardware address and
<i>dhcp-client-identifier</i> option are at least
theoretically guaranteed to be unique to a given client.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>group</i> <b>statement</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>group</b> {
<br>
[ <i>parameters</i> ] <br>
[ <i>declarations</i> ] <b><br>
}</b></p>

<p style="margin-left:11%; margin-top: 1em">The group
statement is used simply to apply one or more parameters to
a group of declarations. It can be used to group hosts,
shared networks, subnets, or even other groups.</p>

<h2>REFERENCE: ALLOW AND DENY
<a name="REFERENCE: ALLOW AND DENY"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<i>allow</i> and <i>deny</i> statements can be used to
control the response of the DHCP server to various sorts of
requests. The allow and deny keywords actually have
different meanings depending on the context. In a pool
context, these keywords can be used to set up access lists
for address allocation pools. In other contexts, the
keywords simply control general server behavior with respect
to clients based on scope. In a non-pool context, the
<i>ignore</i> keyword can be used in place of the
<i>deny</i> keyword to prevent logging of denied
requests.</p>

<h2>ALLOW DENY AND IGNORE IN SCOPE
<a name="ALLOW DENY AND IGNORE IN SCOPE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The following
usages of allow and deny will work in any scope, although it
is not recommended that they be used in pool
declarations.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>unknown-clients</i> <b>keyword</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>allow
unknown-clients; <br>
deny unknown-clients; <br>
ignore unknown-clients;</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<b>unknown-clients</b> flag is used to tell dhcpd whether or
not to dynamically assign addresses to unknown clients.
Dynamic address assignment to unknown clients is
<b>allow</b>ed by default. An unknown client is simply a
client that has no host declaration.</p>

<p style="margin-left:11%; margin-top: 1em">The use of this
option is now <i>deprecated</i>. If you are trying to
restrict access on your network to known clients, you should
use <b>deny unknown-clients;</b> inside of your address
pool, as described under the heading ALLOW AND DENY WITHIN
POOL DECLARATIONS.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>bootp</i> <b>keyword</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>allow bootp;
<br>
deny bootp; <br>
ignore bootp;</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<b>bootp</b> flag is used to tell dhcpd whether or not to
respond to bootp queries. Bootp queries are <b>allow</b>ed
by default.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>booting</i> <b>keyword</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>allow
booting; <br>
deny booting; <br>
ignore booting;</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<b>booting</b> flag is used to tell dhcpd whether or not to
respond to queries from a particular client. This keyword
only has meaning when it appears in a host declaration. By
default, booting is <b>allow</b>ed, but if it is disabled
for a particular client, then that client will not be able
to get an address from the DHCP server.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>duplicates</i> <b>keyword</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>allow
duplicates; <br>
deny duplicates;</b></p>

<p style="margin-left:11%; margin-top: 1em">Host
declarations can match client messages based on the DHCP
Client Identifier option or based on the client&rsquo;s
network hardware type and MAC address. If the MAC address is
used, the host declaration will match any client with that
MAC address - even clients with different client
identifiers. This doesn&rsquo;t normally happen, but is
possible when one computer has more than one operating
system installed on it - for example, Microsoft Windows and
NetBSD or Linux.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>duplicates</b> flag tells the DHCP server that if a
request is received from a client that matches the MAC
address of a host declaration, any other leases matching
that MAC address should be discarded by the server, even if
the UID is not the same. This is a violation of the DHCP
protocol, but can prevent clients whose client identifiers
change regularly from holding many leases at the same time.
By default, duplicates are <b>allow</b>ed.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>declines</i> <b>keyword</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>allow
declines; <br>
deny declines; <br>
ignore declines;</b></p>

<p style="margin-left:11%; margin-top: 1em">The DHCPDECLINE
message is used by DHCP clients to indicate that the lease
the server has offered is not valid. When the server
receives a DHCPDECLINE for a particular address, it normally
abandons that address, assuming that some unauthorized
system is using it. Unfortunately, a malicious or buggy
client can, using DHCPDECLINE messages, completely exhaust
the DHCP server&rsquo;s allocation pool. The server will
reclaim these leases, but while the client is running
through the pool, it may cause serious thrashing in the DNS,
and it will also cause the DHCP server to forget old DHCP
client address allocations.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>declines</b> flag tells the DHCP server whether or not to
honor DHCPDECLINE messages. If it is set to <b>deny</b> or
<b>ignore</b> in a particular scope, the DHCP server will
not respond to DHCPDECLINE messages.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>client-updates</i> <b>keyword</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>allow
client-updates; <br>
deny client-updates;</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<b>client-updates</b> flag tells the DHCP server whether or
not to honor the client&rsquo;s intention to do its own
update of its A record. This is only relevant when doing
<i>interim</i> DNS updates. See the documentation under the
heading THE INTERIM DNS UPDATE SCHEME for details.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>leasequery</i> <b>keyword</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>allow
leasequery; <br>
deny leasequery;</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<b>leasequery</b> flag tells the DHCP server whether or not
to answer DHCPLEASEQUERY packets. The answer to a
DHCPLEASEQUERY packet includes information about a specific
lease, such as when it was issued and when it will expire.
By default, the server will not respond to these
packets.</p>

<h2>ALLOW AND DENY WITHIN POOL DECLARATIONS
<a name="ALLOW AND DENY WITHIN POOL DECLARATIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The uses of the
allow and deny keywords shown in the previous section work
pretty much the same way whether the client is sending a
DHCPDISCOVER or a DHCPREQUEST message - an address will be
allocated to the client (either the old address it&rsquo;s
requesting, or a new address) and then that address will be
tested to see if it&rsquo;s okay to let the client have it.
If the client requested it, and it&rsquo;s not okay, the
server will send a DHCPNAK message. Otherwise, the server
will simply not respond to the client. If it is okay to give
the address to the client, the server will send a DHCPACK
message.</p>

<p style="margin-left:11%; margin-top: 1em">The primary
motivation behind pool declarations is to have address
allocation pools whose allocation policies are different. A
client may be denied access to one pool, but allowed access
to another pool on the same network segment. In order for
this to work, access control has to be done during address
allocation, not after address allocation is done.</p>

<p style="margin-left:11%; margin-top: 1em">When a
DHCPREQUEST message is processed, address allocation simply
consists of looking up the address the client is requesting
and seeing if it&rsquo;s still available for the client. If
it is, then the DHCP server checks both the address pool
permit lists and the relevant in-scope allow and deny
statements to see if it&rsquo;s okay to give the lease to
the client. In the case of a DHCPDISCOVER message, the
allocation process is done as described previously in the
ADDRESS ALLOCATION section.</p>

<p style="margin-left:11%; margin-top: 1em">When declaring
permit lists for address allocation pools, the following
syntaxes are recognized following the allow or deny
keywords:</p>


<p style="margin-left:11%; margin-top: 1em"><b>known-clients;</b></p>

<p style="margin-left:11%; margin-top: 1em">If specified,
this statement either allows or prevents allocation from
this pool to any client that has a host declaration (i.e.,
is known). A client is known if it has a host declaration in
<i>any</i> scope, not just the current scope.</p>


<p style="margin-left:11%; margin-top: 1em"><b>unknown-clients;</b></p>

<p style="margin-left:11%; margin-top: 1em">If specified,
this statement either allows or prevents allocation from
this pool to any client that has no host declaration (i.e.,
is not known).</p>

<p style="margin-left:11%; margin-top: 1em"><b>members of
&quot;</b>class<b>&quot;;</b></p>

<p style="margin-left:11%; margin-top: 1em">If specified,
this statement either allows or prevents allocation from
this pool to any client that is a member of the named
class.</p>

<p style="margin-left:11%; margin-top: 1em"><b>dynamic
bootp clients;</b></p>

<p style="margin-left:11%; margin-top: 1em">If specified,
this statement either allows or prevents allocation from
this pool to any bootp client.</p>


<p style="margin-left:11%; margin-top: 1em"><b>authenticated
clients;</b></p>

<p style="margin-left:11%; margin-top: 1em">If specified,
this statement either allows or prevents allocation from
this pool to any client that has been authenticated using
the DHCP authentication protocol. This is not yet
supported.</p>


<p style="margin-left:11%; margin-top: 1em"><b>unauthenticated
clients;</b></p>

<p style="margin-left:11%; margin-top: 1em">If specified,
this statement either allows or prevents allocation from
this pool to any client that has not been authenticated
using the DHCP authentication protocol. This is not yet
supported.</p>

<p style="margin-left:11%; margin-top: 1em"><b>all
clients;</b></p>

<p style="margin-left:11%; margin-top: 1em">If specified,
this statement either allows or prevents allocation from
this pool to all clients. This can be used when you want to
write a pool declaration for some reason, but hold it in
reserve, or when you want to renumber your network quickly,
and thus want the server to force all clients that have been
allocated addresses from this pool to obtain new addresses
immediately when they next renew.</p>

<p style="margin-left:11%; margin-top: 1em"><b>after</b>
<i>time</i><b>;</b></p>

<p style="margin-left:11%; margin-top: 1em">If specified,
this statement either allows or prevents allocation from
this pool after a given date. This can be used when you want
to move clients from one pool to another. The server adjusts
the regular lease time so that the latest expiry time is at
the given time+min-lease-time. A short min-lease-time
enforces a step change, whereas a longer min-lease-time
allows for a gradual change. <i>time</i> is either second
since epoch, or a UTC time string e.g. 4 2007/08/24 09:14:32
or a string with time zone offset in seconds e.g. 4
2007/08/24 11:14:32 -7200</p>

<h2>REFERENCE: PARAMETERS
<a name="REFERENCE: PARAMETERS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<i>adaptive-lease-time-threshold</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>adaptive-lease-time-threshold</b>
<i>percentage</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">When the number
of allocated leases within a pool rises above the
<i>percentage</i> given in this statement, the DHCP server
decreases the lease length for new clients within this pool
to <i>min-lease-time</i> seconds. Clients renewing an
already valid (long) leases get at least the remaining time
from the current lease. Since the leases expire faster, the
server may either recover more quickly or avoid pool
exhaustion entirely. Once the number of allocated leases
drop below the threshold, the server reverts back to normal
lease times. Valid percentages are between 1 and 99.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>always-broadcast</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>always-broadcast</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The DHCP and
BOOTP protocols both require DHCP and BOOTP clients to set
the broadcast bit in the flags field of the BOOTP message
header. Unfortunately, some DHCP and BOOTP clients do not do
this, and therefore may not receive responses from the DHCP
server. The DHCP server can be made to always broadcast its
responses to clients by setting this flag to
&acute;on&acute; for the relevant scope; relevant scopes
would be inside a conditional statement, as a parameter for
a class, or as a parameter for a host declaration. To avoid
creating excess broadcast traffic on your network, we
recommend that you restrict the use of this option to as few
clients as possible. For example, the Microsoft DHCP client
is known not to have this problem, as are the OpenTransport
and ISC DHCP clients.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>always-reply-rfc1048</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>always-reply-rfc1048</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">Some BOOTP
clients expect RFC1048-style responses, but do not follow
RFC1048 when sending their requests. You can tell that a
client is having this problem if it is not getting the
options you have configured for it and if you see in the
server log the message &quot;(non-rfc1048)&quot; printed
with each BOOTREQUEST that is logged.</p>

<p style="margin-left:14%; margin-top: 1em">If you want to
send rfc1048 options to such a client, you can set the
<b>always-reply-rfc1048</b> option in that client&rsquo;s
host declaration, and the DHCP server will respond with an
RFC-1048-style vendor options field. This flag can be set in
any scope, and will affect all clients covered by that
scope.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>authoritative</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>authoritative;</b></p>

<p style="margin-left:14%; margin-top: 1em"><b>not
authoritative;</b></p>

<p style="margin-left:14%; margin-top: 1em">The DHCP server
will normally assume that the configuration information
about a given network segment is not known to be correct and
is not authoritative. This is so that if a naive user
installs a DHCP server not fully understanding how to
configure it, it does not send spurious DHCPNAK messages to
clients that have obtained addresses from a legitimate DHCP
server on the network.</p>

<p style="margin-left:14%; margin-top: 1em">Network
administrators setting up authoritative DHCP servers for
their networks should always write <b>authoritative;</b> at
the top of their configuration file to indicate that the
DHCP server <i>should</i> send DHCPNAK messages to
misconfigured clients. If this is not done, clients will be
unable to get a correct IP address after changing subnets
until their old lease has expired, which could take quite a
long time.</p>

<p style="margin-left:14%; margin-top: 1em">Usually,
writing <b>authoritative;</b> at the top level of the file
should be sufficient. However, if a DHCP server is to be set
up so that it is aware of some networks for which it is
authoritative and some networks for which it is not, it may
be more appropriate to declare authority on a
per-network-segment basis.</p>

<p style="margin-left:14%; margin-top: 1em">Note that the
most specific scope for which the concept of authority makes
any sense is the physical network segment - either a
shared-network statement or a subnet statement that is not
contained within a shared-network statement. It is not
meaningful to specify that the server is authoritative for
some subnets within a shared network, but not authoritative
for others, nor is it meaningful to specify that the server
is authoritative for some host declarations and not
others.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>boot-unknown-clients</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>boot-unknown-clients</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">If the
<i>boot-unknown-clients</i> statement is present and has a
value of <i>false</i> or <i>off</i>, then clients for which
there is no <i>host</i> declaration will not be allowed to
obtain IP addresses. If this statement is not present or has
a value of <i>true</i> or <i>on</i>, then clients without
host declarations will be allowed to obtain IP addresses, as
long as those addresses are not restricted by <i>allow</i>
and <i>deny</i> statements within their <i>pool</i>
declarations.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>db-time-format</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>db-time-format</b>
[ <i>default</i> | <i>local</i> ] <b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The DHCP server
software outputs several timestamps when writing leases to
persistent storage. This configuration parameter selects one
of two output formats. The <i>default</i> format prints the
day, date, and time in UTC, while the <i>local</i> format
prints the system seconds-since-epoch, and helpfully
provides the day and time in the system timezone in a
comment. The time formats are described in detail in the
dhcpd.leases(5) manpage.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>ddns-hostname</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>ddns-hostname</b>
<i>name</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The <i>name</i>
parameter should be the hostname that will be used in
setting up the client&rsquo;s A and PTR records. If no
ddns-hostname is specified in scope, then the server will
derive the hostname automatically, using an algorithm that
varies for each of the different update methods.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>ddns-domainname</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>ddns-domainname</b>
<i>name</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The <i>name</i>
parameter should be the domain name that will be appended to
the client&rsquo;s hostname to form a fully-qualified
domain-name (FQDN).</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>ddns-rev-domainname</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>ddns-rev-domainname</b>
<i>name</i><b>;</b> The <i>name</i> parameter should be the
domain name that will be appended to the client&rsquo;s
reversed IP address to produce a name for use in the
client&rsquo;s PTR record. By default, this is
&quot;in-addr.arpa.&quot;, but the default can be overridden
here.</p>

<p style="margin-left:14%; margin-top: 1em">The reversed IP
address to which this domain name is appended is always the
IP address of the client, in dotted quad notation, reversed
- for example, if the IP address assigned to the client is
10.17.92.74, then the reversed IP address is 74.92.17.10. So
a client with that IP address would, by default, be given a
PTR record of 10.17.92.74.in-addr.arpa.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>ddns-update-style</i> parameter</p>


<p style="margin-left:14%; margin-top: 1em"><b>ddns-update-style</b>
<i>style</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The
<i>style</i> parameter must be one of <b>ad-hoc</b>,
<b>interim</b> or <b>none</b>. The <i>ddns-update-style</i>
statement is only meaningful in the outer scope - it is
evaluated once after reading the dhcpd.conf file, rather
than each time a client is assigned an IP address, so there
is no way to use different DNS update styles for different
clients. The default is <b>none</b>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>The</b>
<i>ddns-updates</i> <b>statement</b></p>


<p style="margin-left:14%; margin-top: 1em"><b>ddns-updates</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The
<i>ddns-updates</i> parameter controls whether or not the
server will attempt to do a DNS update when a lease is
confirmed. Set this to <i>off</i> if the server should not
attempt to do updates within a certain scope. The
<i>ddns-updates</i> parameter is on by default. To disable
DNS updates in all scopes, it is preferable to use the
<i>ddns-update-style</i> statement, setting the style to
<i>none</i>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>default-lease-time</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>default-lease-time</b>
<i>time</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em"><i>Time</i>
should be the length in seconds that will be assigned to a
lease if the client requesting the lease does not ask for a
specific expiration time. This is used for both DHCPv4 and
DHCPv6 leases (it is also known as the &quot;valid
lifetime&quot; in DHCPv6). The default is 43200 seconds.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>delayed-ack</i> and <i>max-ack-delay</i> statements</p>


<p style="margin-left:14%; margin-top: 1em"><b>delayed-ack</b>
<i>count</i><b>; max-ack-delay</b>
<i>microseconds</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em"><i>Count</i>
should be an integer value from zero to 2^16-1, and defaults
to 28. The count represents how many DHCPv4 replies maximum
will be queued pending transmission until after a database
commit event. If this number is reached, a database commit
event (commonly resulting in fsync() and representing a
performance penalty) will be made, and the reply packets
will be transmitted in a batch afterwards. This preserves
the RFC2131 direction that &quot;stable storage&quot; be
updated prior to replying to clients. Should the DHCPv4
sockets &quot;go dry&quot; (select() returns immediately
with no read sockets), the commit is made and any queued
packets are transmitted.</p>

<p style="margin-left:14%; margin-top: 1em">Similarly,
<i>microseconds</i> indicates how many microseconds are
permitted to pass inbetween queuing a packet pending an
fsync, and performing the fsync. Valid values range from 0
to 2^32-1, and defaults to 250,000 (1/4 of a second).</p>

<p style="margin-left:14%; margin-top: 1em">Please note
that as delayed-ack is currently experimental, the
delayed-ack feature is not compiled in by default, but must
be enabled at compile time with &acute;./configure
--enable-delayed-ack&acute;.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>do-forward-updates</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>do-forward-updates</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The
<i>do-forward-updates</i> statement instructs the DHCP
server as to whether it should attempt to update a DHCP
client&rsquo;s A record when the client acquires or renews a
lease. This statement has no effect unless DNS updates are
enabled and <b>ddns-update-style</b> is set to
<b>interim</b>. Forward updates are enabled by default. If
this statement is used to disable forward updates, the DHCP
server will never attempt to update the client&rsquo;s A
record, and will only ever attempt to update the
client&rsquo;s PTR record if the client supplies an FQDN
that should be placed in the PTR record using the fqdn
option. If forward updates are enabled, the DHCP server will
still honor the setting of the <b>client-updates</b>
flag.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>dynamic-bootp-lease-cutoff</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>dynamic-bootp-lease-cutoff</b>
<i>date</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The
<i>dynamic-bootp-lease-cutoff</i> statement sets the ending
time for all leases assigned dynamically to BOOTP clients.
Because BOOTP clients do not have any way of renewing
leases, and don&rsquo;t know that their leases could expire,
by default dhcpd assigns infinite leases to all BOOTP
clients. However, it may make sense in some situations to
set a cutoff date for all BOOTP leases - for example, the
end of a school term, or the time at night when a facility
is closed and all machines are required to be powered
off.</p>

<p style="margin-left:14%; margin-top: 1em"><i>Date</i>
should be the date on which all assigned BOOTP leases will
end. The date is specified in the form:</p>

<p align="center" style="margin-top: 1em">W YYYY/MM/DD
HH:MM:SS</p>

<p style="margin-top: 1em">W is the day of the week
expressed as a number from zero (Sunday) to six (Saturday).
YYYY is the year, including the century. MM is the month
expressed as a number from 1 to 12. DD is the day of the
month, counting from 1. HH is the hour, from zero to 23. MM
is the minute and SS is the second. The time is always in
Coordinated Universal Time (UTC), not local time.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>dynamic-bootp-lease-length</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>dynamic-bootp-lease-length</b>
<i>length</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The
<i>dynamic-bootp-lease-length</i> statement is used to set
the length of leases dynamically assigned to BOOTP clients.
At some sites, it may be possible to assume that a lease is
no longer in use if its holder has not used BOOTP or DHCP to
get its address within a certain time period. The period is
specified in <i>length</i> as a number of seconds. If a
client reboots using BOOTP during the timeout period, the
lease duration is reset to <i>length</i>, so a BOOTP client
that boots frequently enough will never lose its lease.
Needless to say, this parameter should be adjusted with
extreme caution.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>filename</i> statement</p>

<p style="margin-left:14%; margin-top: 1em"><b>filename
&quot;</b><i>filename</i><b>&quot;;</b></p>

<p style="margin-left:14%; margin-top: 1em">The
<i>filename</i> statement can be used to specify the name of
the initial boot file which is to be loaded by a client. The
<i>filename</i> should be a filename recognizable to
whatever file transfer protocol the client can be expected
to use to load the file.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>fixed-address</i> declaration</p>


<p style="margin-left:14%; margin-top: 1em"><b>fixed-address
address</b> [<b>,</b> <i>address</i> ... ]<b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The
<i>fixed-address</i> declaration is used to assign one or
more fixed IP addresses to a client. It should only appear
in a <i>host</i> declaration. If more than one address is
supplied, then when the client boots, it will be assigned
the address that corresponds to the network on which it is
booting. If none of the addresses in the
<i>fixed-address</i> statement are valid for the network to
which the client is connected, that client will not match
the <i>host</i> declaration containing that
<i>fixed-address</i> declaration. Each <i>address</i> in the
<i>fixed-address</i> declaration should be either an IP
address or a domain name that resolves to one or more IP
addresses.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>fixed-address6</i> declaration</p>


<p style="margin-left:14%; margin-top: 1em"><b>fixed-address6
ip6-address</b> ;</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>fixed-address6</i> declaration is used to assign a fixed
IPv6 addresses to a client. It should only appear in a
<i>host</i> declaration.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>get-lease-hostnames</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>get-lease-hostnames</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The
<i>get-lease-hostnames</i> statement is used to tell dhcpd
whether or not to look up the domain name corresponding to
the IP address of each address in the lease pool and use
that address for the DHCP <i>hostname</i> option. If
<i>flag</i> is true, then this lookup is done for all
addresses in the current scope. By default, or if
<i>flag</i> is false, no lookups are done.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>hardware</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>hardware</b>
<i>hardware-type hardware-address</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">In order for a
BOOTP client to be recognized, its network hardware address
must be declared using a <i>hardware</i> clause in the
<i>host</i> statement. <i>hardware-type</i> must be the name
of a physical hardware interface type. Currently, only the
<b>ethernet</b> and <b>token-ring</b> types are recognized,
although support for a <b>fddi</b> hardware type (and
others) would also be desirable. The <i>hardware-address</i>
should be a set of hexadecimal octets (numbers from 0
through ff) separated by colons. The <i>hardware</i>
statement may also be used for DHCP clients.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>host-identifier option</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>host-identifier
option</b> <i>option-name option-data</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">This identifies
a DHCPv6 client in a <i>host</i> statement.
<i>option-name</i> is any option, and <i>option-data</i> is
the value for the option that the client will send. The
<i>option-data</i> must be a constant value.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>infinite-is-reserved</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>infinite-is-reserved</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">ISC DHCP now
supports &acute;reserved&acute; leases. See the section on
RESERVED LEASES below. If this <i>flag</i> is on, the server
will automatically reserve leases allocated to clients which
requested an infinite (0xffffffff) lease-time.</p>

<p style="margin-left:14%; margin-top: 1em">The default is
off.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>lease-file-name</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>lease-file-name</b>
<i>name</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em"><i>Name</i>
should be the name of the DHCP server&rsquo;s lease file. By
default, this is /var/lib/dhcpd/dhcpd.leases. This statement
<b>must</b> appear in the outer scope of the configuration
file - if it appears in some other scope, it will have no
effect. Furthermore, it has no effect if overridden by the
<b>-lf</b> flag or the <b>PATH_DHCPD_DB</b> environment
variable.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>limit-addrs-per-ia</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>limit-addrs-per-ia</b>
<i>number</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">By default, the
DHCPv6 server will limit clients to one IAADDR per IA
option, meaning one address. If you wish to permit clients
to hang onto multiple addresses at a time, configure a
larger <i>number</i> here.</p>

<p style="margin-left:14%; margin-top: 1em">Note that there
is no present method to configure the server to forcibly
configure the client with one IP address per each subnet on
a shared network. This is left to future work.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>dhcpv6-lease-file-name</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>dhcpv6-lease-file-name</b>
<i>name</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em"><i>Name</i> is
the name of the lease file to use if and only if the server
is running in DHCPv6 mode. By default, this is
/var/lib/dhcpd/dhcpd6.leases. This statement, like
<i>lease-file-name,</i> <b>must</b> appear in the outer
scope of the configuration file. It has no effect if
overridden by the <b>-lf</b> flag or the
<b>PATH_DHCPD6_DB</b> environment variable. If
<i>dhcpv6-lease-file-name</i> is not specified, but
<i>lease-file-name</i> is, the latter value will be
used.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>local-port</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>local-port</b>
<i>port</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">This statement
causes the DHCP server to listen for DHCP requests on the
UDP port specified in <i>port</i>, rather than on port
67.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>local-address</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>local-address</b>
<i>address</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">This statement
causes the DHCP server to listen for DHCP requests sent to
the specified <i>address</i>, rather than requests sent to
all addresses. Since serving directly attached DHCP clients
implies that the server must respond to requests sent to the
all-ones IP address, this option cannot be used if clients
are on directly attached networks...it is only realistically
useful for a server whose only clients are reached via
unicasts, such as via DHCP relay agents.</p>

<p style="margin-left:14%; margin-top: 1em">Note: This
statement is only effective if the server was compiled using
the USE_SOCKETS #define statement, which is default on a
small number of operating systems, and must be explicitly
chosen at compile-time for all others. You can be sure if
your server is compiled with USE_SOCKETS if you see lines of
this format at startup:</p>

<p style="margin-left:14%; margin-top: 1em">Listening on
Socket/eth0</p>

<p style="margin-left:14%; margin-top: 1em">Note also that
since this bind()s all DHCP sockets to the specified
address, that only one address may be supported in a daemon
at a given time.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>log-facility</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>log-facility</b>
<i>facility</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">This statement
causes the DHCP server to do all of its logging on the
specified log facility once the dhcpd.conf file has been
read. By default the DHCP server logs to the daemon
facility. Possible log facilities include auth, authpriv,
cron, daemon, ftp, kern, lpr, mail, mark, news, ntp,
security, syslog, user, uucp, and local0 through local7. Not
all of these facilities are available on all systems, and
there may be other facilities available on other
systems.</p>

<p style="margin-left:14%; margin-top: 1em">In addition to
setting this value, you may need to modify your
<i>syslog.conf</i> file to configure logging of the DHCP
server. For example, you might add a line like this:</p>

<p style="margin-left:14%; margin-top: 1em">local7.debug
/var/log/dhcpd.log</p>

<p style="margin-left:14%; margin-top: 1em">The syntax of
the <i>syslog.conf</i> file may be different on some
operating systems - consult the <i>syslog.conf</i> manual
page to be sure. To get syslog to start logging to the new
file, you must first create the file with correct ownership
and permissions (usually, the same owner and permissions of
your /var/log/messages or /usr/adm/messages file should be
fine) and send a SIGHUP to syslogd. Some systems support log
rollover using a shell script or program called newsyslog or
logrotate, and you may be able to configure this as well so
that your log file doesn&rsquo;t grow uncontrollably.</p>

<p style="margin-left:14%; margin-top: 1em">Because the
<i>log-facility</i> setting is controlled by the dhcpd.conf
file, log messages printed while parsing the dhcpd.conf file
or before parsing it are logged to the default log facility.
To prevent this, see the README file included with this
distribution, which describes how to change the default log
facility. When this parameter is used, the DHCP server
prints its startup message a second time after parsing the
configuration file, so that the log will be as complete as
possible.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>max-lease-time</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>max-lease-time</b>
<i>time</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em"><i>Time</i>
should be the maximum length in seconds that will be
assigned to a lease. If not defined, the default maximum
lease time is 86400. The only exception to this is that
Dynamic BOOTP lease lengths, which are not specified by the
client, are not limited by this maximum.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>min-lease-time</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>min-lease-time</b>
<i>time</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em"><i>Time</i>
should be the minimum length in seconds that will be
assigned to a lease. The default is the minimum of 300
seconds or <b>max-lease-time</b>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>min-secs</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>min-secs</b>
<i>seconds</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em"><i>Seconds</i>
should be the minimum number of seconds since a client began
trying to acquire a new lease before the DHCP server will
respond to its request. The number of seconds is based on
what the client reports, and the maximum value that the
client can report is 255 seconds. Generally, setting this to
one will result in the DHCP server not responding to the
client&rsquo;s first request, but always responding to its
second request.</p>

<p style="margin-left:14%; margin-top: 1em">This can be
used to set up a secondary DHCP server which never offers an
address to a client until the primary server has been given
a chance to do so. If the primary server is down, the client
will bind to the secondary server, but otherwise clients
should always bind to the primary. Note that this does not,
by itself, permit a primary server and a secondary server to
share a pool of dynamically-allocatable addresses.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>next-server</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>next-server</b>
<i>server-name</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The
<i>next-server</i> statement is used to specify the host
address of the server from which the initial boot file
(specified in the <i>filename</i> statement) is to be
loaded. <i>Server-name</i> should be a numeric IP address or
a domain name. If no <i>next-server</i> statement applies to
a given client, the address 0.0.0.0 is used.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>omapi-port</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>omapi-port</b>
<i>port</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">The
<i>omapi-port</i> statement causes the DHCP server to listen
for OMAPI connections on the specified port. This statement
is required to enable the OMAPI protocol, which is used to
examine and modify the state of the DHCP server as it is
running.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>one-lease-per-client</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>one-lease-per-client</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em">If this flag is
enabled, whenever a client sends a DHCPREQUEST for a
particular lease, the server will automatically free any
other leases the client holds. This presumes that when the
client sends a DHCPREQUEST, it has forgotten any lease not
mentioned in the DHCPREQUEST - i.e., the client has only a
single network interface <i>and</i> it does not remember
leases it&rsquo;s holding on networks to which it is not
currently attached. Neither of these assumptions are
guaranteed or provable, so we urge caution in the use of
this statement.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>pid-file-name</i> statement</p>


<p style="margin-left:14%; margin-top: 1em"><b>pid-file-name</b>
<i>name</i><b>;</b></p>

<p style="margin-left:14%; margin-top: 1em"><i>Name</i>
should be the name of the DHCP server&rsquo;s process ID
file. This is the file in which the DHCP server&rsquo;s
process ID is stored when the server starts. By default,
this is /var/run/dhcpd.pid. Like the <i>lease-file-name</i>
statement, this statement must appear in the outer scope of
the configuration file. It has no effect if overridden by
the <b>-pf</b> flag or the <b>PATH_DHCPD_PID</b> environment
variable.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>dhcpv6-pid-file-name</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>dhcpv6-pid-file-name</b>
<i>name</i><b>;</b></p>

<p style="margin-left:18%; margin-top: 1em"><i>Name</i> is
the name of the pid file to use if and only if the server is
running in DHCPv6 mode. By default, this is
/var/lib/dhcpd/dhcpd6.pid. This statement, like
<i>pid-file-name,</i> <b>must</b> appear in the outer scope
of the configuration file. It has no effect if overridden by
the <b>-pf</b> flag or the <b>PATH_DHCPD6_PID</b>
environment variable. If <i>dhcpv6-pid-file-name</i> is not
specified, but <i>pid-file-name</i> is, the latter value
will be used.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>ping-check</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>ping-check</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">When the DHCP
server is considering dynamically allocating an IP address
to a client, it first sends an ICMP Echo request (a
<i>ping</i>) to the address being assigned. It waits for a
second, and if no ICMP Echo response has been heard, it
assigns the address. If a response <i>is</i> heard, the
lease is abandoned, and the server does not respond to the
client.</p>

<p style="margin-left:18%; margin-top: 1em">This <i>ping
check</i> introduces a default one-second delay in
responding to DHCPDISCOVER messages, which can be a problem
for some clients. The default delay of one second may be
configured using the ping-timeout parameter. The ping-check
configuration parameter can be used to control checking - if
its value is false, no ping check is done.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>ping-timeout</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>ping-timeout</b>
<i>seconds</i><b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">If the DHCP
server determined it should send an ICMP echo request (a
<i>ping</i>) because the ping-check statement is true,
ping-timeout allows you to configure how many seconds the
DHCP server should wait for an ICMP Echo response to be
heard, if no ICMP Echo response has been received before the
timeout expires, it assigns the address. If a response
<i>is</i> heard, the lease is abandoned, and the server does
not respond to the client. If no value is set, ping-timeout
defaults to 1 second.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>preferred-lifetime</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>preferred-lifetime</b>
<i>seconds</i><b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">IPv6 addresses
have &acute;valid&acute; and &acute;preferred&acute;
lifetimes. The valid lifetime determines at what point at
lease might be said to have expired, and is no longer
useable. A preferred lifetime is an advisory condition to
help applications move off of the address and onto currently
valid addresses (should there still be any open TCP sockets
or similar).</p>

<p style="margin-left:18%; margin-top: 1em">The preferred
lifetime defaults to the renew+rebind timers, or 3/4 the
default lease time if none were specified.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>remote-port</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>remote-port</b>
<i>port</i><b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">This statement
causes the DHCP server to transmit DHCP responses to DHCP
clients upon the UDP port specified in <i>port</i>, rather
than on port 68. In the event that the UDP response is
transmitted to a DHCP Relay, the server generally uses the
<b>local-port</b> configuration value. Should the DHCP Relay
happen to be addressed as 127.0.0.1, however, the DHCP
Server transmits its response to the <b>remote-port</b>
configuration value. This is generally only useful for
testing purposes, and this configuration value should
generally not be used.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>server-identifier</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>server-identifier</b>
<i>hostname</i><b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">The
server-identifier statement can be used to define the value
that is sent in the DHCP Server Identifier option for a
given scope. The value specified <b>must</b> be an IP
address for the DHCP server, and must be reachable by all
clients served by a particular scope.</p>

<p style="margin-left:18%; margin-top: 1em">The use of the
server-identifier statement is not recommended - the only
reason to use it is to force a value other than the default
value to be sent on occasions where the default value would
be incorrect. The default value is the first IP address
associated with the physical network interface on which the
request arrived.</p>

<p style="margin-left:18%; margin-top: 1em">The usual case
where the <i>server-identifier</i> statement needs to be
sent is when a physical interface has more than one IP
address, and the one being sent by default isn&rsquo;t
appropriate for some or all clients served by that
interface. Another common case is when an alias is defined
for the purpose of having a consistent IP address for the
DHCP server, and it is desired that the clients use this IP
address when contacting the server.</p>

<p style="margin-left:18%; margin-top: 1em">Supplying a
value for the dhcp-server-identifier option is equivalent to
using the server-identifier statement.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>server-duid</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>server-duid</b>
<i>LLT</i> [ <i>hardware-type timestamp hardware-address</i>
] <b>;</b></p>


<p style="margin-left:18%; margin-top: 1em"><b>server-duid</b>
<i>EN enterprise-number enterprise-identifier</i>
<b>;</b></p>


<p style="margin-left:18%; margin-top: 1em"><b>server-duid</b>
<i>LL</i> [ <i>hardware-type hardware-address</i> ]
<b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">The server-duid
statement configures the server DUID. You may pick either
LLT (link local address plus time), EN (enterprise), or LL
(link local).</p>

<p style="margin-left:18%; margin-top: 1em">If you choose
LLT or LL, you may specify the exact contents of the DUID.
Otherwise the server will generate a DUID of the specified
type.</p>

<p style="margin-left:18%; margin-top: 1em">If you choose
EN, you must include the enterprise number and the
enterprise-identifier.</p>

<p style="margin-left:18%; margin-top: 1em">The default
server-duid type is LLT.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>server-name</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>server-name</b>
<i>name</i> <b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">The
<i>server-name</i> statement can be used to inform the
client of the name of the server from which it is booting.
<i>Name</i> should be the name that will be provided to the
client.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>site-option-space</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>site-option-space</b>
<i>name</i> <b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">The
<i>site-option-space</i> statement can be used to determine
from what option space site-local options will be taken.
This can be used in much the same way as the
<i>vendor-option-space</i> statement. Site-local options in
DHCP are those options whose numeric codes are greater than
224. These options are intended for site-specific uses, but
are frequently used by vendors of embedded hardware that
contains DHCP clients. Because site-specific options are
allocated on an ad hoc basis, it is quite possible that one
vendor&rsquo;s DHCP client might use the same option code
that another vendor&rsquo;s client uses, for different
purposes. The <i>site-option-space</i> option can be used to
assign a different set of site-specific options for each
such vendor, using conditional evaluation (see <b>dhcp-eval
(5)</b> for details).</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>stash-agent-options</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>stash-agent-options</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">If the
<i>stash-agent-options</i> parameter is true for a given
client, the server will record the relay agent information
options sent during the client&rsquo;s initial DHCPREQUEST
message when the client was in the SELECTING state and
behave as if those options are included in all subsequent
DHCPREQUEST messages sent in the RENEWING state. This works
around a problem with relay agent information options, which
is that they usually not appear in DHCPREQUEST messages sent
by the client in the RENEWING state, because such messages
are unicast directly to the server and not sent through a
relay agent.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>update-conflict-detection</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>update-conflict-detection</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">If the
<i>update-conflict-detection</i> parameter is true, the
server will perform standard DHCID multiple-client, one-name
conflict detection. If the parameter has been set false, the
server will skip this check and instead simply tear down any
previous bindings to install the new binding without
question. The default is true.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>update-optimization</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>update-optimization</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">If the
<i>update-optimization</i> parameter is false for a given
client, the server will attempt a DNS update for that client
each time the client renews its lease, rather than only
attempting an update when it appears to be necessary. This
will allow the DNS to heal from database inconsistencies
more easily, but the cost is that the DHCP server must do
many more DNS updates. We recommend leaving this option
enabled, which is the default. This option only affects the
behavior of the interim DNS update scheme, and has no effect
on the ad-hoc DNS update scheme. If this parameter is not
specified, or is true, the DHCP server will only update when
the client information changes, the client gets a different
lease, or the client&rsquo;s lease expires.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>update-static-leases</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>update-static-leases</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">The
<i>update-static-leases</i> flag, if enabled, causes the
DHCP server to do DNS updates for clients even if those
clients are being assigned their IP address using a
<i>fixed-address</i> statement - that is, the client is
being given a static assignment. This can only work with the
<i>interim</i> DNS update scheme. It is not recommended
because the DHCP server has no way to tell that the update
has been done, and therefore will not delete the record when
it is not in use. Also, the server must attempt the update
each time the client renews its lease, which could have a
significant performance impact in environments that place
heavy demands on the DHCP server.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>use-host-decl-names</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>use-host-decl-names</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">If the
<i>use-host-decl-names</i> parameter is true in a given
scope, then for every host declaration within that scope,
the name provided for the host declaration will be supplied
to the client as its hostname. So, for example,</p>

<p style="margin-left:18%; margin-top: 1em">group { <br>
use-host-decl-names on;</p>

<p style="margin-left:18%; margin-top: 1em">host joe { <br>
hardware ethernet 08:00:2b:4c:29:32; <br>
fixed-address joe.fugue.com; <br>
} <br>
}</p>

<p style="margin-left:18%; margin-top: 1em">is equivalent
to</p>

<p style="margin-left:18%; margin-top: 1em">host joe { <br>
hardware ethernet 08:00:2b:4c:29:32; <br>
fixed-address joe.fugue.com; <br>
option host-name &quot;joe&quot;; <br>
}</p>

<p style="margin-left:18%; margin-top: 1em">An <i>option
host-name</i> statement within a host declaration will
override the use of the name in the host declaration.</p>

<p style="margin-left:18%; margin-top: 1em">It should be
noted here that most DHCP clients completely ignore the
host-name option sent by the DHCP server, and there is no
way to configure them not to do this. So you generally have
a choice of either not having any hostname to client IP
address mapping that the client will recognize, or doing DNS
updates. It is beyond the scope of this document to describe
how to make this determination.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>use-lease-addr-for-default-route</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>use-lease-addr-for-default-route</b>
<i>flag</i><b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">If the
<i>use-lease-addr-for-default-route</i> parameter is true in
a given scope, then instead of sending the value specified
in the routers option (or sending no value at all), the IP
address of the lease being assigned is sent to the client.
This supposedly causes Win95 machines to ARP for all IP
addresses, which can be helpful if your router is configured
for proxy ARP. The use of this feature is not recommended,
because it won&rsquo;t work for many DHCP clients.</p>

<p style="margin-left:14%; margin-top: 1em">The
<i>vendor-option-space</i> statement</p>


<p style="margin-left:18%; margin-top: 1em"><b>vendor-option-space</b>
<i>string</i><b>;</b></p>

<p style="margin-left:18%; margin-top: 1em">The
<i>vendor-option-space</i> parameter determines from what
option space vendor options are taken. The use of this
configuration parameter is illustrated in the
<b>dhcp-options(5)</b> manual page, in the <i>VENDOR
ENCAPSULATED OPTIONS</i> section.</p>

<h2>SETTING PARAMETER VALUES USING EXPRESSIONS
<a name="SETTING PARAMETER VALUES USING EXPRESSIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Sometimes
it&rsquo;s helpful to be able to set the value of a DHCP
server parameter based on some value that the client has
sent. To do this, you can use expression evaluation. The
<b>dhcp-eval(5)</b> manual page describes how to write
expressions. To assign the result of an evaluation to an
option, define the option as follows:</p>


<p style="margin-left:11%; margin-top: 1em"><i>my-parameter</i>
<b>=</b> <i>expression</i> <b>;</b></p>

<p style="margin-left:11%; margin-top: 1em">For
example:</p>

<p style="margin-left:11%; margin-top: 1em">ddns-hostname =
binary-to-ascii (16, 8, &quot;-&quot;, <br>
substring (hardware, 1, 6));</p>

<h2>RESERVED LEASES
<a name="RESERVED LEASES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">It&rsquo;s
often useful to allocate a single address to a single
client, in approximate perpetuity. Host statements with
<b>fixed-address</b> clauses exist to a certain extent to
serve this purpose, but because host statements are intended
to approximate &acute;static configuration&acute;, they
suffer from not being referenced in a littany of other
Server Services, such as dynamic DNS, failover, &acute;on
events&acute; and so forth.</p>

<p style="margin-left:11%; margin-top: 1em">If a standard
dynamic lease, as from any range statement, is marked
&acute;reserved&acute;, then the server will only allocate
this lease to the client it is identified by (be that by
client identifier or hardware address).</p>

<p style="margin-left:11%; margin-top: 1em">In practice,
this means that the lease follows the normal state engine,
enters ACTIVE state when the client is bound to it, expires,
or is released, and any events or services that would
normally be supplied during these events are processed
normally, as with any other dynamic lease. The only
difference is that failover servers treat reserved leases as
special when they enter the FREE or BACKUP states - each
server applies the lease into the state it may allocate from
- and the leases are not placed on the queue for allocation
to other clients. Instead they may only be
&acute;found&acute; by client identity. The result is that
the lease is only offered to the returning client.</p>

<p style="margin-left:11%; margin-top: 1em">Care should
probably be taken to ensure that the client only has one
lease within a given subnet that it is identified by.</p>

<p style="margin-left:11%; margin-top: 1em">Leases may be
set &acute;reserved&acute; either through OMAPI, or through
the &acute;infinite-is-reserved&acute; configuration option
(if this is applicable to your environment and mixture of
clients).</p>

<p style="margin-left:11%; margin-top: 1em">It should also
be noted that leases marked &acute;reserved&acute; are
effectively treated the same as leases marked
&acute;bootp&acute;.</p>

<h2>REFERENCE: OPTION STATEMENTS
<a name="REFERENCE: OPTION STATEMENTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">DHCP option
statements are documented in the <b>dhcp-options(5)</b>
manual page.</p>

<h2>REFERENCE: EXPRESSIONS
<a name="REFERENCE: EXPRESSIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Expressions
used in DHCP option statements and elsewhere are documented
in the <b>dhcp-eval(5)</b> manual page.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">dhcpd(8),
dhcpd.leases(5), dhcp-options(5), dhcp-eval(5), RFC2132,
RFC2131.</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>dhcpd.conf(5)</b>
was written by Ted Lemon under a contract with Vixie Labs.
Funding for this project was provided by Internet Systems
Consortium. Information about Internet Systems Consortium
can be found at <b>https://www.isc.org.</b></p>
<hr>
</body>
</html>
