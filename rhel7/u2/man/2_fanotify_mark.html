<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 01:08:16 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>FANOTIFY_MARK</title>

</head>
<body>

<h1 align="center">FANOTIFY_MARK</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#RETURN VALUE">RETURN VALUE</a><br>
<a href="#ERRORS">ERRORS</a><br>
<a href="#VERSIONS">VERSIONS</a><br>
<a href="#CONFORMING TO">CONFORMING TO</a><br>
<a href="#BUGS">BUGS</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#COLOPHON">COLOPHON</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">fanotify_mark
&minus; add, remove, or modify an fanotify mark on a
filesystem object</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>#include
&lt;sys/fanotify.h&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
fanotify_mark(int</b> <i>fanotify_fd</i><b>, unsigned
int</b> <i>flags</i><b>, <br>
uint64_t</b> <i>mask</i><b>, int</b> <i>dirfd</i><b>, const
char *</b><i>pathname</i><b>);</b></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">For an overview
of the fanotify API, see <b>fanotify</b>(7).</p>


<p style="margin-left:11%; margin-top: 1em"><b>fanotify_mark</b>(2)
adds, removes, or modifies an fanotify mark on a filesystem
object. The caller must have read permission on the
filesystem object that is to be marked.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>fanotify_fd</i> argument is a file descriptor returned by
<b>fanotify_init</b>(2).</p>

<p style="margin-left:11%; margin-top: 1em"><i>flags</i> is
a bit mask describing the modification to perform. It must
include exactly one of the following values: <b><br>
FAN_MARK_ADD</b></p>

<p style="margin-left:22%;">The events in <i>mask</i> will
be added to the mark mask (or to the ignore mask).
<i>mask</i> must be nonempty or the error <b>EINVAL</b> will
occur.</p>

<p style="margin-left:11%;"><b>FAN_MARK_REMOVE</b></p>

<p style="margin-left:22%;">The events in argument
<i>mask</i> will be removed from the mark mask (or from the
ignore mask). <i>mask</i> must be nonempty or the error
<b>EINVAL</b> will occur.</p>

<p style="margin-left:11%;"><b>FAN_MARK_FLUSH</b></p>

<p style="margin-left:22%;">Remove either all mount or all
non-mount marks from the fanotify group. If <i>flag</i>
contains <b>FAN_MARK_MOUNT</b>, all marks for mounts are
removed from the group. Otherwise, all marks for directories
and files are removed. No flag other than
<b>FAN_MARK_MOUNT</b> can be used in conjunction with
<b>FAN_MARK_FLUSH</b>. <i>mask</i> is ignored.</p>

<p style="margin-left:11%; margin-top: 1em">If none of the
values above is specified, or more than one is specified,
the call fails with the error <b>EINVAL</b>.</p>

<p style="margin-left:11%; margin-top: 1em">In addition,
zero or more of the following values may be ORed into
<i>flags</i>: <b><br>
FAN_MARK_DONT_FOLLOW</b></p>

<p style="margin-left:22%;">If <i>pathname</i> is a
symbolic link, mark the link itself, rather than the file to
which it refers. (By default, <b>fanotify_mark</b>()
dereferences <i>pathname</i> if it is a symbolic link.)</p>

<p style="margin-left:11%;"><b>FAN_MARK_ONLYDIR</b></p>

<p style="margin-left:22%;">If the filesystem object to be
marked is not a directory, the error <b>ENOTDIR</b> shall be
raised.</p>

<p style="margin-left:11%;"><b>FAN_MARK_MOUNT</b></p>

<p style="margin-left:22%;">Mark the mount point specified
by <i>pathname</i>. If <i>pathname</i> is not itself a mount
point, the mount point containing <i>pathname</i> will be
marked. All directories, subdirectories, and the contained
files of the mount point will be monitored.</p>


<p style="margin-left:11%;"><b>FAN_MARK_IGNORED_MASK</b></p>

<p style="margin-left:22%;">The events in <i>mask</i> shall
be added to or removed from the ignore mask.</p>


<p style="margin-left:11%;"><b>FAN_MARK_IGNORED_SURV_MODIFY</b></p>

<p style="margin-left:22%;">The ignore mask shall survive
modify events. If this flag is not set, the ignore mask is
cleared when a modify event occurs for the ignored file or
directory.</p>

<p style="margin-left:11%; margin-top: 1em"><i>mask</i>
defines which events shall be listened for (or which shall
be ignored). It is a bit mask composed of the following
values: <b><br>
FAN_ACCESS</b></p>

<p style="margin-left:22%;">Create an event when a file or
directory (but see BUGS) is accessed (read).</p>

<p style="margin-left:11%;"><b>FAN_MODIFY</b></p>

<p style="margin-left:22%;">Create an event when a file is
modified (write).</p>

<p style="margin-left:11%;"><b>FAN_CLOSE_WRITE</b></p>

<p style="margin-left:22%;">Create an event when a writable
file is closed.</p>

<p style="margin-left:11%;"><b>FAN_CLOSE_NOWRITE</b></p>

<p style="margin-left:22%;">Create an event when a
read-only file or directory is closed.</p>

<p style="margin-left:11%;"><b>FAN_OPEN</b></p>

<p style="margin-left:22%;">Create an event when a file or
directory is opened.</p>

<p style="margin-left:11%;"><b>FAN_OPEN_PERM</b></p>

<p style="margin-left:22%;">Create an event when a
permission to open a file or directory is requested. An
fanotify file descriptor created with
<b>FAN_CLASS_PRE_CONTENT</b> or <b>FAN_CLASS_CONTENT</b> is
required.</p>

<p style="margin-left:11%;"><b>FAN_ACCESS_PERM</b></p>

<p style="margin-left:22%;">Create an event when a
permission to read a file or directory is requested. An
fanotify file descriptor created with
<b>FAN_CLASS_PRE_CONTENT</b> or <b>FAN_CLASS_CONTENT</b> is
required.</p>

<p style="margin-left:11%;"><b>FAN_ONDIR</b></p>

<p style="margin-left:22%;">Create events for
directories&mdash;for example, when <b>opendir</b>(3),
<b>readdir</b>(3) (but see BUGS), and <b>closedir</b>(3) are
called. Without this flag, only events for files are
created.</p>

<p style="margin-left:11%;"><b>FAN_EVENT_ON_CHILD</b></p>

<p style="margin-left:22%;">Events for the immediate
children of marked directories shall be created. The flag
has no effect when marking mounts. Note that events are not
generated for children of the subdirectories of marked
directories. To monitor complete directory trees it is
necessary to mark the relevant mount.</p>

<p style="margin-left:11%; margin-top: 1em">The following
composed value is defined: <b><br>
FAN_CLOSE</b></p>

<p style="margin-left:22%;">A file is closed
(<b>FAN_CLOSE_WRITE</b>|<b>FAN_CLOSE_NOWRITE</b>).</p>

<p style="margin-left:11%; margin-top: 1em">The filesystem
object to be marked is determined by the file descriptor
<i>dirfd</i> and the pathname specified in
<i>pathname</i>:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>*</p></td>
<td width="3%"></td>
<td width="85%">


<p>If <i>pathname</i> is NULL, <i>dirfd</i> defines the
filesystem object to be marked.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>*</p></td>
<td width="3%"></td>
<td width="85%">


<p>If <i>pathname</i> is NULL, and <i>dirfd</i> takes the
special value <b>AT_FDCWD</b>, the current working directory
is to be marked.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>*</p></td>
<td width="3%"></td>
<td width="85%">


<p>If <i>pathname</i> is absolute, it defines the
filesystem object to be marked, and <i>dirfd</i> is
ignored.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>*</p></td>
<td width="3%"></td>
<td width="85%">


<p>If <i>pathname</i> is relative, and <i>dirfd</i> does
not have the value <b>AT_FDCWD</b>, then the filesystem
object to be marked is determined by interpreting
<i>pathname</i> relative the directory referred to by
<i>dirfd</i>.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>*</p></td>
<td width="3%"></td>
<td width="85%">


<p>If <i>pathname</i> is relative, and <i>dirfd</i> has the
value <b>AT_FDCWD</b>, then the filesystem object to be
marked is determined by interpreting <i>pathname</i>
relative the current working directory.</p></td></tr>
</table>

<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">On success,
<b>fanotify_mark</b>() returns 0. On error, &minus;1 is
returned, and <i>errno</i> is set to indicate the error.</p>

<h2>ERRORS
<a name="ERRORS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p style="margin-top: 1em"><b>EBADF</b></p></td>
<td width="2%"></td>
<td width="78%">


<p style="margin-top: 1em">An invalid file descriptor was
passed in <i>fanotify_fd</i>.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>EINVAL</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>An invalid value was passed in <i>flags</i> or
<i>mask</i>, or <i>fanotify_fd</i> was not an fanotify file
descriptor.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>EINVAL</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>The fanotify file descriptor was opened with
<b>FAN_CLASS_NOTIF</b> and mask contains a flag for
permission events (<b>FAN_OPEN_PERM</b> or
<b>FAN_ACCESS_PERM</b>).</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>ENOENT</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>The filesystem object indicated by <i>dirfd</i> and
<i>pathname</i> does not exist. This error also occurs when
trying to remove a mark from an object which is not
marked.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>ENOMEM</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>The necessary memory could not be allocated.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>ENOSPC</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>The number of marks exceeds the limit of 8192 and the
<b>FAN_UNLIMITED_MARKS</b> flag was not specified when the
fanotify file descriptor was created with
<b>fanotify_init</b>(2).</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>ENOSYS</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>This kernel does not implement <b>fanotify_mark</b>().
The fanotify API is available only if the kernel was
configured with <b>CONFIG_FANOTIFY</b>.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>ENOTDIR</b></p>

<p style="margin-left:22%;"><i>flags</i> contains
<b>FAN_MARK_ONLYDIR</b>, and <i>dirfd</i> and
<i>pathname</i> do not specify a directory.</p>

<h2>VERSIONS
<a name="VERSIONS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>fanotify_mark</b>()
was introduced in version 2.6.36 of the Linux kernel and
enabled in version 2.6.37.</p>

<h2>CONFORMING TO
<a name="CONFORMING TO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This system
call is Linux-specific.</p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The following
bugs were present in Linux kernels before version 3.16:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>*</p></td>
<td width="3%"></td>
<td width="85%">


<p>If <i>flags</i> contains <b>FAN_MARK_FLUSH</b>,
<i>dirfd</i> and <i>pathname</i> must specify a valid
filesystem object, even though this object is not used.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>*</p></td>
<td width="3%"></td>
<td width="85%">


<p><b>readdir</b>(2) does not generate a <b>FAN_ACCESS</b>
event.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>*</p></td>
<td width="3%"></td>
<td width="85%">


<p>If <b>fanotify_mark</b>(2) is called with
<b>FAN_MARK_FLUSH</b>, <i>flags</i> is not checked for
invalid values.</p></td></tr>
</table>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>fanotify_init</b>(2),
<b>fanotify</b>(7)</p>

<h2>COLOPHON
<a name="COLOPHON"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This page is
part of release 3.75 of the Linux <i>man-pages</i> project.
A description of the project, information about reporting
bugs, and the latest version of this page, can be found at
http://www.kernel.org/doc/man&minus;pages/.</p>
<hr>
</body>
</html>
