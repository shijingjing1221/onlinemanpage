<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Fri Nov 11 01:14:05 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>AMANDA&minus;AUTH</title>

</head>
<body>

<h1 align="center">AMANDA&minus;AUTH</h1>

<a href="#NAME">NAME</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#COMPILATION AND GENERAL INFORMATION">COMPILATION AND GENERAL INFORMATION</a><br>
<a href="#BSD, BSDUDP, AND BSDTCP COMMUNICATION AND AUTHENTICATION">BSD, BSDUDP, AND BSDTCP COMMUNICATION AND AUTHENTICATION</a><br>
<a href="#KERBEROS COMMUNICATION AND AUTHENTICATION">KERBEROS COMMUNICATION AND AUTHENTICATION</a><br>
<a href="#LOCAL COMMUNICATION">LOCAL COMMUNICATION</a><br>
<a href="#RSH COMMUNICATION AND AUTHENTICATION">RSH COMMUNICATION AND AUTHENTICATION</a><br>
<a href="#SSH COMMUNICATION AND AUTHENTICATION">SSH COMMUNICATION AND AUTHENTICATION</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#AUTHORS">AUTHORS</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">amanda-auth
&minus; Communication/Authentication methods between Amanda
server and client</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Amanda offers 7
methods of communication between Amanda server (sometimes
also called the tape server) and clients, each with its own
authentication method. The desired communication method is
specified by the <i>auth</i> parameter in the amanda.conf
file (<b>amanda.conf</b>(5)) commonly as a dumptype. Valid
values to the <i>auth</i> parameter are <b>bsd</b>,
<b>bsdudp</b>, <b>bsdtcp</b>, <b>krb5</b>, <b>local</b>,
<b>rsh</b>, and <b>ssh</b>. The authentication and
communication method is used during the backup process
<b>amdump</b> (amdump(8)) as well as the recovery process
<b>amrecover</b> (amrecover(8)).</p>

<h2>COMPILATION AND GENERAL INFORMATION
<a name="COMPILATION AND GENERAL INFORMATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
communication method and thus type of authentication that
will be used by the Amanda server is specified by the
<i>auth</i> parameter in the dumptype for each disklist
entry (DLE). The <i>auth</i> parameter thus may be easily
and globally specified in the &quot;global&quot; dumptype.
If <i>auth</i> is not specified, the <b>bsdtcp</b>
communication method is used. See <b>amanda.conf</b>(5) for
more information on Amanda configuration and dumptypes, and
<b>disklist</b>(5) for more information on disklists.</p>

<p style="margin-left:11%; margin-top: 1em">On the client
side, the Amanda daemon <b>amandad</b> validates the
connection depending on the value of the <b>auth</b>
argument passed to it (see Amanda(8)). Also, when it comes
to recovery, the <b>auth</b> parameter can be specified in
the <b>amanda-client.conf</b>(5) file to specify the
communication method to be used by the client to the
server.</p>

<p style="margin-left:11%; margin-top: 1em">When Amanda is
being built from source code, desired communication and thus
authentication methods (shown as &quot;Authentication&quot;)
must be specified as configure options at compilation
time.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%">


<p>Authentication</p></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="69%">


<p>Configure option(s)</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%">


<p>bsd</p></td>
<td width="8%">
</td>
<td width="8%">
</td>
<td width="69%">


<p>&minus;&minus;with&minus;bsd&minus;security
&minus;&minus;with&minus;amandahosts (pre&minus;2.6)</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%">


<p>bsdtcp</p></td>
<td width="8%"></td>
<td width="8%">
</td>
<td width="69%">


<p>&minus;&minus;with&minus;bsdtcp&minus;security
&minus;&minus;with&minus;amandahosts (pre&minus;2.6)</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%">


<p>bsdudp</p></td>
<td width="8%"></td>
<td width="8%">
</td>
<td width="69%">


<p>&minus;&minus;with&minus;bsdudp&minus;security
&minus;&minus;with&minus;amandahosts (pre&minus;2.6)</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%">


<p>krb5</p></td>
<td width="8%"></td>
<td width="8%">
</td>
<td width="69%">


<p>&minus;&minus;with&minus;krb5&minus;security</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%">


<p>local</p></td>
<td width="8%"></td>
<td width="8%">
</td>
<td width="69%">


<p>(always included)</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%">


<p>rsh</p></td>
<td width="8%">
</td>
<td width="8%">
</td>
<td width="69%">


<p>&minus;&minus;with&minus;rsh&minus;security</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%">


<p>ssh</p></td>
<td width="8%">
</td>
<td width="8%">
</td>
<td width="69%">


<p>&minus;&minus;with&minus;ssh&minus;security</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">There are
additional configure options for <b>bsd</b>, <b>bsdudp</b>,
and <b>bsdtcp</b> to allow for specifying explicit UDP and
TCP port ranges.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;with&minus;udpportrange
<br>
&minus;&minus;with&minus;tcpportrange <br>
&minus;&minus;with&minus;low&minus;tcpportrange</p>

<p style="margin-left:11%; margin-top: 1em">See <b>PORT
USAGE</b> below for more information.</p>

<p style="margin-left:11%; margin-top: 1em">There are
additional configure options for Kerberos if you so desire.
All but the last option are for Kerberos 4. Defaults shown
in square brackets.</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;with&minus;server&minus;principal=ARG
server host principal [amanda] <br>
&minus;&minus;with&minus;server&minus;instance=ARG server
host instance [] <br>
&minus;&minus;with&minus;server&minus;keyfile=ARG server
host key file [/.amanda] <br>
&minus;&minus;with&minus;client&minus;principal=ARG client
host principal [rcmd] <br>
&minus;&minus;with&minus;client&minus;instance=ARG client
host instance [HOSTNAME_INSTANCE] <br>
&minus;&minus;with&minus;client&minus;keyfile=ARG client
host key file [KEYFILE] <br>
&minus;&minus;with&minus;ticket&minus;lifetime=ARG ticket
lifetime [128] <br>
&minus;&minus;with&minus;krb5&minus;security=DIR where
libkrb.a lives [see below]</p>

<p style="margin-left:11%; margin-top: 1em">If configuring
with &minus;&minus;with&minus;krb5&minus;security, the
configure script will search under /usr/kerberos/lib,
/usr/cygnus/lib, /usr/lib, and /opt/kerberos/lib for the
kerberos bits, libkrb.a, in this order. Kerberos support
will not be added if it does not find them. If the kerberos
bits are found under some other hierarchy, you can specify
this via &minus;&minus;with&minus;krb5&minus;security=DIR
where DIR is where the kerberos bits live. The configure
script will then look in the 'lib' directory under this
hierarchy for libkrb.a.</p>

<p style="margin-left:11%; margin-top: 1em">The <b>auth</b>
parameter selects a communication/authentication method to
use between the client and the backup server. These methods
are described each in their own section below.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Usernames</b>
<br>
When Amanda is built, a username is specified with the
<b>&minus;&minus;with&minus;user</b> option. Most Amanda
processes run under this user's identity, to minimize
security risks. In binary distributions, this username is
usually one of 'amanda', 'amandabackup', or 'backup'. The
examples below use 'amandabackup' since it is unambiguous.
You may need to adjust accordingly for your system.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Authenticated
Peer Hostnames</b> <br>
Amanda's authentication mechanisms provide an authenticated
hostname of the system on the other end of the connection,
which is used to restrict access to only particular hosts.
The degree of &quot;authentication&quot; performed on this
hostname varies with the authentication mechanism, and is
discussed below.</p>

<h2>BSD, BSDUDP, AND BSDTCP COMMUNICATION AND AUTHENTICATION
<a name="BSD, BSDUDP, AND BSDTCP COMMUNICATION AND AUTHENTICATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">For additional
information including example configurations, see
http://wiki.zmanda.com/index.php/Configuring_bsd/bsdudp/bsdtcp_authentication.</p>

<p style="margin-left:11%; margin-top: 1em">The <b>bsd</b>,
<b>bsdudp</b>, and <b>bsdtcp</b> communication methods use
either UDP, TCP, or both protocols operating as a network
service to authenticate and exchange data between server and
clients.</p>

<p style="margin-left:11%; margin-top: 1em">The
authentication proceeds as follows: for a new, incoming
connection, Amanda verifies that the source port is in the
reserved range (less than 1024), which for UNIX hosts
suggests that the remote user has root privileges. Amanda
then verifies that the reverse DNS for the remote address
matches the forward DNS; that is, that the address maps to a
hostname which maps back to the same address. Finally, the
remote system must provide a username that matches the
username in .amandahosts.</p>

<p style="margin-left:11%; margin-top: 1em">In addition to
compilation and general configuration (see <b>COMPILATION
AND GENERAL INFORMATION</b> above), the authentication
method that the client is configured to receive is specified
by the <b>auth</b> parameter in the network service
configuration for Amanda. The authentication method used by
an Amanda client to reach the server during recovery is the
authentication method specified by the <i>auth</i> parameter
in the client's Amanda network service configuration or in
its amanda&minus;client.conf file (see
amanda&minus;client.conf(5)).</p>

<p style="margin-left:11%; margin-top: 1em">By default,
Amanda use the &quot;amanda&quot; service name and
associated port set in /etc/services. It can be changed by
setting the dumptype <i>client&minus;port</i> option to a
different port number or a different service name. All
examples are for the service name &quot;amanda&quot; that
uses the default port 10080.</p>


<p style="margin-left:11%; margin-top: 1em"><b>.amandahosts
file</b> <br>
Servers and clients using the bsd, bsdudp, and bsdtcp
authentication methods refer to the .amandahosts file to
control access. Amanda should be compiled for this access
control if one of these methods will be used and is the
default compilation option for Amanda 2.6 (use
&minus;&minus;with&minus;amandahosts when compiling
pre&minus;2.6 versions of Amanda).</p>

<p style="margin-left:11%; margin-top: 1em">Amanda looks
for the .amandahosts file in the Amanda user's home
directory, commonly /var/lib/amanda.</p>

<p style="margin-left:11%; margin-top: 1em">Each
authorization is on its own line in the following format</p>


<p style="margin-left:11%; margin-top: 1em"><i>hostname</i>
[ <i>username</i> [ <i>service...</i> ] ]</p>

<p style="margin-left:11%; margin-top: 1em">If
<i>username</i> is ommitted, it defaults to the user running
<b>amandad</b>, i.e. the user listed in the <b>inetd</b> or
<b>xinetd</b> configuration file.</p>


<p style="margin-left:11%; margin-top: 1em"><i>service...</i>
is a space&minus;delimited list of services the client is
authorized to execute: <b>noop</b>, <b>selfcheck</b>,
<b>sendsize</b>, <b>sendbackup</b>, <b>amdump</b> (a
shortcut for the previous four services which are required
on clients), <b>amindexd</b>, and <b>amidxtaped</b>. The
last two services are required on a server for clients to
connect to it using <b>amrecover</b>.</p>

<p style="margin-left:11%; margin-top: 1em">If service is
omitted, it defaults to <b>noop selfcheck sendsize
sendbackup</b> (which is equivalent to <b>amdump</b>).</p>

<p style="margin-left:11%; margin-top: 1em">Example of the
.amandahosts file on an Amanda client, where 'amandabackup'
is the Amanda dumpuser.</p>


<p style="margin-left:11%; margin-top: 1em"><b>amandaserver.example.com
amandabackup amdump</b></p>

<p style="margin-left:11%; margin-top: 1em">Example of the
.amandahosts file on an Amanda server</p>


<p style="margin-left:11%; margin-top: 1em"><b>amandaclient1.example.com
root amindexd amidxtaped</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>bsd
communication and authentication</b> <br>
The authentication is done using .amandahosts file in the
Amanda user's home directory. The protocol between Amanda
server and client is UDP. The number of disk list entries
(DLEs)&minus;&minus;number of Amanda clients&minus;&minus;is
limited by the UDP packet size. This authentication protocol
will use a different port for each data stream (see PORT
USAGE below)</p>

<p style="margin-left:11%; margin-top: 1em"><b>bsdudp
communication and authentication</b> <br>
The authentication is done using .amandahosts files in the
Amanda user's home directory. It uses UDP protocol between
Amanda server and client for data and hence the number of
DLEs is limited by the UDP packet size. It uses one TCP port
to establish the connection and multiplexes all data streams
using one port on the server (see PORT USAGE below).</p>

<p style="margin-left:11%; margin-top: 1em"><b>bsdtcp
communication and authentication</b> <br>
The authentication is done using .amandahosts files in the
backup user's (for example: amandabackup) home directory. It
uses TCP protocol between Amanda server and client. On the
client, two reserved ports are used. On the server, all data
streams are multiplexed to one port (see PORT USAGE
below).</p>

<p style="margin-left:11%; margin-top: 1em"><b>USING INETD
SERVER</b> <br>
Template for Amanda client inetd service entry</p>


<p style="margin-left:11%; margin-top: 1em"><i>service_name
socket_type protocol wait/nowait amanda_backup_user
absolute_path_to_amandad</i> amandad <i>server_args</i></p>

<p style="margin-left:11%; margin-top: 1em">Client example
of using <b>bsd</b> authorization for inetd server given
Amanda user is &quot;amandabackup&quot;:</p>

<p style="margin-left:11%; margin-top: 1em"><b>amanda dgram
udp wait amandabackup /path/to/amandad amandad
&minus;auth=bsd amdump</b></p>

<p style="margin-left:11%; margin-top: 1em">The same could
be used for <b>bsdudp</b> if specifying &minus;auth=bsdudp
instead of &minus;auth=bsd.</p>

<p style="margin-left:11%; margin-top: 1em">Client example
of using <b>bsdtcp</b> authorization for inetd server given
Amanda user is &quot;amandabackup&quot;:</p>

<p style="margin-left:11%; margin-top: 1em"><b>amanda
stream tcp nowait amandabackup /path/to/amandad amandad
&minus;auth=bsdtcp amdump</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>amindexd</b>
and <b>amidxtaped</b> would typically be added at the end of
the line as <b>amandad</b> server arguments for an Amanda
server.</p>

<p style="margin-left:11%; margin-top: 1em">Server example
of using <b>bsdtcp</b> authorization for inetd server given
Amanda user is &quot;amandabackup&quot;:</p>

<p style="margin-left:11%; margin-top: 1em"><b>amanda
stream tcp nowait amandabackup /path/to/amandad amandad
&minus;auth=bsdtcp amdump amindexd amidxtaped</b></p>

<p style="margin-left:11%; margin-top: 1em">For Amanda
version 2.5.0 and earlier, remember that neither
<b>bsdudp</b> nor <b>bsdtcp</b> are supported and the Amanda
daemon <b>amandad</b> accepts no arguments. Because of the
latter, <b>amrecover</b> as of Amanda version 2.5.1 is not
compatible with 2.5.0 and earlier servers. Thus, servers
that are 2.5.0 or earlier must, in addition to the
<i>amanda</i> service, run <i>amindexd</i> and
<i>amidxtaped</i> Amanda services as their own network
services, amandaidx and amidxtape, respectively (see
below).</p>

<p style="margin-left:11%; margin-top: 1em">There are no
compatibility issues if server and clients are all 2.5.0 or
earlier. If your server is 2.5.1 or later, you can still
have clients that are 2.5.0 and earlier although you must
then use <b>bsd</b> communication/authentication with these
clients and must also run <i>amindexd</i> and
<i>amidxtaped</i> Amanda services on the server as their own
network services, amandaidx and amidxtape, respectively (see
below). If you have a server that is 2.5.0 and earlier,
clients of a later version on which you wish to run
<b>amrecover</b> must use <b>amoldrecover</b> instead and,
again, the server must be running the amandaidx and
amidxtape network services.</p>

<p style="margin-left:11%; margin-top: 1em">Example of
amindexd and amidxtaped Amanda daemon services configured as
their own network services for a 2.5.0 or earlier server or
a newer server having 2.5.0 or earlier clients</p>

<p style="margin-left:11%; margin-top: 1em"><b>amandaidx
stream tcp nowait amandabackup
/usr/local/libexec/amanda/current/amindexd amindexd <br>
amidxtape stream tcp nowait amandabackup
/usr/local/libexec/amanda/current/amidxtaped
amidxtaped</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>USING XINETD
SERVER</b> <br>
Template for Amanda client xinetd service file</p>

<p style="margin-left:11%; margin-top: 1em">service amanda
<br>
{</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>only_from = <i>Amanda server</i></p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>socket_type = <i>socket type</i></p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>protocol = <i>protocol</i></p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>wait = <i>yes/no</i></p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>user = <i>amanda backup user</i></p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>group = <i>amanda backup user group id</i></p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>groups = yes</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>server = <i>absolute path to amandad</i></p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>server_args = <i>amandad server arguments</i></p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>disable = no</p></td></tr>
</table>

<p style="margin-left:11%;">}</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>only_from</i> parameter can be used with xinetd but is
usually in addition to the primary form of access control
via the .amandahosts file.</p>

<p style="margin-left:11%; margin-top: 1em">Client example
of using <b>bsd</b> authorization for xinetd server and for
Amanda user &quot;amandabackup&quot;:</p>

<p style="margin-left:11%; margin-top: 1em">service amanda
<br>
{</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>only_from = amandaserver.example.com</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>socket_type = dgram</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>protocol = udp</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>wait = yes</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>user = amandabackup</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>group = disk</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>groups = yes</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>server = /path/to/amandad</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>server_args = &minus;auth=bsd amdump</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>disable = no</p></td></tr>
</table>

<p style="margin-left:11%;">}</p>

<p style="margin-left:11%; margin-top: 1em">The same could
be used for <b>bsdudp</b> if specifying &minus;auth=bsdudp
instead of &minus;auth=bsd.</p>

<p style="margin-left:11%; margin-top: 1em">Client example
of using <b>bsdtcp</b> authorization for xinetd server and
for Amanda user &quot;amandabackup&quot;:</p>

<p style="margin-left:11%; margin-top: 1em">service amanda
<br>
{</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>only_from = amandaserver.example.com
amandaclient.example.com</p> </td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>socket_type = stream</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>protocol = tcp</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>wait = no</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>user = amandabackup</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>group = disk</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>groups = yes</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>server = /path/to/amandad</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>server_args = &minus;auth=bsdtcp amdump</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="92%">


<p>disable = no</p></td></tr>
</table>

<p style="margin-left:11%;">}</p>


<p style="margin-left:11%; margin-top: 1em"><b>amindexd</b>
and <b>amidxtaped</b> would typically be added as additional
<b>amandad</b> <i>server_args</i> for an Amanda server.</p>

<p style="margin-left:11%; margin-top: 1em">For Amanda
version 2.5.0 and earlier, remember that neither
<b>bsdudp</b> nor <b>bsdtcp</b> are supported and the Amanda
daemon <b>amandad</b> accepts no arguments. Because of the
latter, <b>amrecover</b> as of Amanda version 2.5.1 is not
compatible with 2.5.0 and earlier servers. Thus, servers
that are 2.5.0 or earlier must, in addition to the
<i>amanda</i> service, run <i>amindexd</i> and
<i>amidxtaped</i> Amanda services as their own network
services, amandaidx and amidxtape, respectively (see
below).</p>

<p style="margin-left:11%; margin-top: 1em">There are no
compatibility issues if server and clients are all 2.5.0 or
earlier. If your server is 2.5.1 or later, you can still
have clients that are 2.5.0 and earlier although you must
then use <b>bsd</b> communication/authentication with these
clients and must also run <i>amindexd</i> and
<i>amidxtaped</i> Amanda services on the server as their own
network services, amandaidx and amidxtape, respectively (see
below). If you have a server that is 2.5.0 and earlier,
clients of a later version on which you wish to run
<b>amrecover</b> must use <b>amoldrecover</b> instead and,
again, the server must be running the amandaidx and
amidxtape network services.</p>

<p style="margin-left:11%; margin-top: 1em">Example of
amindexd and amidxtaped Amanda daemon services configured as
their own network services for a 2.5.0 or earlier server or
a newer server having 2.5.0 or earlier clients</p>

<p style="margin-left:11%; margin-top: 1em">service
amandaidx <br>
{</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>socket_type</p></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">
</td>
<td width="54%">


<p>= stream</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>protocol</p></td>
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>= tcp</p></td>
<td width="54%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>wait</p></td>
<td width="8%">
</td>
<td width="7%">
</td>
<td width="8%">


<p>= no</p></td>
<td width="54%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>user</p></td>
<td width="8%">
</td>
<td width="7%">
</td>
<td width="8%">


<p>= amanda</p></td>
<td width="54%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>group</p></td>
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="54%">


<p>= disk</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>server</p></td>
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="54%">


<p>= /usr/local/libexec/amanda/amindexd</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>disable</p></td>
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="54%">


<p>= no</p></td></tr>
</table>

<p style="margin-left:11%;">}</p>

<p style="margin-left:11%; margin-top: 1em">service
amidxtape <br>
{</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>socket_type</p></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">
</td>
<td width="54%">


<p>= stream</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>protocol</p></td>
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>= tcp</p></td>
<td width="54%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>wait</p></td>
<td width="8%">
</td>
<td width="7%">
</td>
<td width="8%">


<p>= no</p></td>
<td width="54%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>user</p></td>
<td width="8%">
</td>
<td width="7%">
</td>
<td width="8%">


<p>= amanda</p></td>
<td width="54%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>group</p></td>
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="54%">


<p>= disk</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>server</p></td>
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="54%">


<p>= /usr/local/libexec/amanda/amidxtaped</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">


<p>disable</p></td>
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="54%">


<p>= no</p></td></tr>
</table>

<p style="margin-left:11%;">}</p>

<p style="margin-left:11%; margin-top: 1em"><b>PORT
USAGE</b> <br>
List of TCP/UDP ports used by network service communication
methods for Amanda server and client.</p>

<p style="margin-left:11%; margin-top: 1em">Key: <br>
UP = Unreserved Port <br>
RPpAP = Reserved Port per Amanda Process <br>
UPpDLE = Unreserved Port per DLE <br>
[..] = Configure options that can be used at compile time to
define port ranges</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%">


<p>Authentication</p></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%">


<p>Protocol</p></td>
<td width="8%">


<p>Amanda server</p></td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%">
</td>
<td width="8%">
</td>
<td width="7%">
</td>
<td width="8%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>Amanda client</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%">


<p>bsd</p></td>
<td width="8%">
</td>
<td width="8%">
</td>
<td width="7%">


<p>udp</p></td>
<td width="8%">
</td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>1 RPpAP [&minus;&minus;with&minus;udpportrange]</p></td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>10080</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="8%">
</td>
<td width="7%">


<p>tcp</p></td>
<td width="8%">
</td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>1 UP [&minus;&minus;with&minus;tcpportrange]</p></td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>3 UPpDLE [&minus;&minus;with&minus;tcpportrange]</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%">


<p>bsdudp</p></td>
<td width="8%"></td>
<td width="8%">
</td>
<td width="7%">


<p>udp</p></td>
<td width="8%">
</td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>1 RPpAP [&minus;&minus;with&minus;udpportrange]</p></td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>10080</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%">
</td>
<td width="8%">
</td>
<td width="8%">
</td>
<td width="7%">


<p>tcp</p></td>
<td width="8%">
</td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>1 UP [&minus;with&minus;tcpportrange]</p></td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>1 UPpDLE [&minus;&minus;with&minus;tcpportrange]</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%">


<p>bsdtcp</p></td>
<td width="8%"></td>
<td width="8%">
</td>
<td width="7%">


<p>tcp</p></td>
<td width="8%">
</td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="-3%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>1 RPpAP
[&minus;&minus;with&minus;low&minus;tcpportrange]</p> </td>
<td width="16%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">


<p>10080</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">Amanda server
also uses two ports (dumper process) to communicate with the
chunker/taper processes. These ports are in the range set by
&minus;&minus;with&minus;tcpportrange.</p>

<p style="margin-left:11%; margin-top: 1em">You can
override the default port ranges that Amanda was compiled
with in each configuration using the
<i>reserved&minus;udp&minus;port</i>,
<i>reserved&minus;tcp&minus;port</i>, and
<i>unreserved&minus;tcp&minus;port</i> parameters in
amanda.conf and amanda&minus;client.conf configuration files
(see <b>amanda.conf</b>(5) and
<b>amanda-client.conf</b>(5)).</p>


<p style="margin-left:11%; margin-top: 1em"><b>Authenticated
Peer Hostnames with BSD Authentications</b> <br>
The BSD authentication mechanisms only verify that the
remote host's DNS is configured correctly and that the
remote user has access to reserved ports. As such, the peer
hostname should only be trusted to the extent that the local
DNS service is trusted.</p>

<h2>KERBEROS COMMUNICATION AND AUTHENTICATION
<a name="KERBEROS COMMUNICATION AND AUTHENTICATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">For more
detail, see
http://wiki.zmanda.com/index.php/Kerberos_authentication.</p>

<p style="margin-left:11%; margin-top: 1em">Amanda supports
Kerberos 5 communication methods between Amanda server and
client.</p>

<p style="margin-left:11%; margin-top: 1em">General
information including compilation are given above (see
<b>COMPILATION AND GENERAL INFORMATION</b> above).</p>

<p style="margin-left:11%; margin-top: 1em">Kerberos 5 uses
TCP and the server uses only one TCP port and data streams
are multiplexed to this port.</p>

<p style="margin-left:11%; margin-top: 1em">The <b>krb5</b>
driver script defaults to: <br>
/* <br>
* The lifetime of our tickets in minutes. <br>
*/ <br>
#define AMANDA_TKT_LIFETIME (12*60)</p>

<p style="margin-left:11%; margin-top: 1em">/* <br>
* The name of the service in /etc/services. <br>
*/ <br>
#define AMANDA_KRB5_SERVICE_NAME &quot;k5amanda&quot;</p>

<p style="margin-left:11%; margin-top: 1em">You can
currently only override these by editing the source
code.</p>

<p style="margin-left:11%; margin-top: 1em">The kerberized
AMANDA service uses a different port on the client hosts.
The /etc/services line is: <br>
k5amanda 10082/tcp</p>

<p style="margin-left:11%; margin-top: 1em">And the
/etc/inetd.conf line is:</p>

<p style="margin-left:11%; margin-top: 1em">k5amanda stream
tcp nowait root /usr/local/libexec/amanda/amandad amandad
&minus;auth=krb5</p>

<p style="margin-left:11%; margin-top: 1em">Note that
you're running this as root, rather than as your dump user.
AMANDA will set its UID down to the dump user at times it
doesn't need to read the keytab file, and give up root
permissions entirely before it goes off and runs dump.
Alternately you can change your keytab files to be readable
by user amanda. You should understand the security
implications of this before changing the permissions on the
keytab.</p>

<p style="margin-left:11%; margin-top: 1em">The following
dumptype options apply to <b>krb5</b>:</p>

<p style="margin-left:11%; margin-top: 1em">auth
&quot;krb5&quot; # use krb5 auth for this host <br>
# (you can mingle krb hosts and bsd .rhosts in one conf)</p>

<p style="margin-left:11%; margin-top: 1em">The principal
and keytab files that Amanda uses must be set in the
amanda.conf file for kerberos 5 dumps to work. You can
hardcode this in the source code if you really want to
(common&minus;src/krb5&minus;security.c)</p>

<p style="margin-left:11%; margin-top: 1em">krb5keytab <br>
krb5principal</p>

<p style="margin-left:11%; margin-top: 1em">For
example:</p>

<p style="margin-left:11%; margin-top: 1em">krb5keytab
&quot;/etc/krb5.keytab&minus;amanda&quot; <br>
krb5principal &quot;amanda/saidin.omniscient.com&quot;</p>

<p style="margin-left:11%; margin-top: 1em">The principal
in the second option must be contained in the first. The
keytab should be readable by the amanda user (and definitely
not world readable!) and is (obviously) on the server. In
MIT's kadmin, the following:</p>

<p style="margin-left:11%; margin-top: 1em">addprinc
&minus;randkey amanda/saidin.omniscient.com <br>
ktadd &minus;k /etc/krb5.keytab&minus;amanda
amanda/saidin.omniscient.com</p>

<p style="margin-left:11%; margin-top: 1em">will do the
trick. You will obviously want to change the principal name
to reflect something appropriate for the conventions at your
site.</p>

<p style="margin-left:11%; margin-top: 1em">You must also
configure each client to allow the amanda principal in for
dumps.</p>

<p style="margin-left:11%; margin-top: 1em">There are
several ways to go about authorizing a server to connect to
a client.</p>

<p style="margin-left:11%; margin-top: 1em">The normal way
is via a .k5amandausers file or a .k5login file in the
client user's home directory. The determination of which
file to use is based on the way you ran configure on AMANDA.
By default, AMANDA will use .k5amandahosts, but if you
configured with &minus;&minus;without&minus;amandahosts,
AMANDA will use .k5login. (similar to the default for
.rhosts/.amandahosts&minus;style security). The .k5login
file syntax is a superset of the default <b>krb5</b>
.k5login. The routines to check it are implemented in amanda
rather than using krb5_kuserok because the connections are
actually gssapi based.</p>

<p style="margin-left:11%; margin-top: 1em">This
.k5amandahosts/.k5login is a hybrid of the .amandahosts and
a .k5login file. You can just list principal names, as in a
.k5login file and the principal will be permitted in from
any host. If you do NOT specify a realm, then there is no
attempt to validate the realm (this is only really a concern
if you have cross&minus;realm authentication set up with
another realm or something else that allows you multiple
realms in your kdc. If you do specify a realm, only that
principal@realm will be permitted to connect.</p>

<p style="margin-left:11%; margin-top: 1em">You may prepend
this with a hostname and whitespace, and only that principal
(with optional realm as above) will be permitted to access
from that hostname.</p>

<p style="margin-left:11%; margin-top: 1em">Here are
examples of valid entries in the .k5amandahosts:</p>

<p style="margin-left:11%; margin-top: 1em">service/amanda
<br>
service/amanda@TEST.COM <br>
dumpmaster.test.com service/amanda <br>
dumpmaster.test.com service/amanda@TEST.COM</p>

<p style="margin-left:11%; margin-top: 1em">Rather than
using a .k5amandahosts or .k5login file, the easiest way is
to use a principal named after the destination user, (such
as amanda@TEST.COM in our example) and not have either a
.k5amandahosts or .k5login file in the destination user's
home directory.</p>

<p style="margin-left:11%; margin-top: 1em">There is no
attempt to verify the realm in this case (only a concern if
you have cross&minus;realm authentication setup).</p>


<p style="margin-left:11%; margin-top: 1em"><b>Authenticated
Peer Hostnames with Kerberos Authentication</b> <br>
When accepting a new incoming connection, the Kerberos
authentication mechanism performs a similar check to that
done by the BSD authentications: the forward and reverse DNS
entries for the remote host must match. As such, while
Kerberos authentication can cryptographically ensure that
the remote system is recognized (since it has a ticket), its
assurances about the remote host's identity are weaker and
depend on the integrity of the DNS.</p>

<h2>LOCAL COMMUNICATION
<a name="LOCAL COMMUNICATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The Amanda
server communicates with the client internally versus over
the network, ie. the client is also the server.</p>

<p style="margin-left:11%; margin-top: 1em">This is the
only method that requires no authentication as it is clearly
not needed.</p>

<p style="margin-left:11%; margin-top: 1em">The
authenticated peer hostname for this authentication is
always &quot;localhost&quot;.</p>

<h2>RSH COMMUNICATION AND AUTHENTICATION
<a name="RSH COMMUNICATION AND AUTHENTICATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">For more
detail, see
http://wiki.zmanda.com/index.php/Configuring_rsh_authentication.</p>

<p style="margin-left:11%; margin-top: 1em">The Amanda
server communicates with its client as the Amanda user via
the RSH protocol.</p>

<p style="margin-left:11%; margin-top: 1em">Please note
that RSH protocol itself is insecure and should be used with
caution especially on any servers and clients with public
IPs.</p>

<p style="margin-left:11%; margin-top: 1em">Each Amanda
client communicates with the server using one TCP port and
all data streams from the client are multiplexed over one
port. The number of Amanda clients is limited by the number
of reserved ports available on the Amanda server. Some
versions of RSH do not use reserved ports and, thus, this
restriction is not valid.</p>

<p style="margin-left:11%; margin-top: 1em">General
information including compilation is given above (see
<b>COMPILATION AND GENERAL INFORMATION</b> above).</p>

<p style="margin-left:11%; margin-top: 1em">In addition to
specifying the <i>auth</i> field in dumptype definition, it
might be required to specify <i>client&minus;username</i>
and <b>amandad</b> fields. If the backup user name is
different on the Amanda client, the user name is specified
as <b>client&minus;username</b>. If the location of the
Amanda daemon <b>amandad</b> is different on the Amanda
client, the location is specified as
<i>amandad&minus;path</i> field value.</p>

<p style="margin-left:11%; margin-top: 1em">For example:
<br>
define dumptype rsh_example { <br>
... <br>
auth &quot;rsh&quot; <br>
client&minus;username &quot;amandabackup&quot; <br>
amandad&minus;path &quot;/usr/lib/exec/amandad&quot; <br>
... <br>
}</p>


<p style="margin-left:11%; margin-top: 1em"><b>Authenticated
Peer Hostnames with RSH Authentication</b> <br>
The RSH authentication mechanism does not provide an
authenticated peer hostname.</p>

<h2>SSH COMMUNICATION AND AUTHENTICATION
<a name="SSH COMMUNICATION AND AUTHENTICATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">For more
detail, see
http://wiki.zmanda.com/index.php/How_To:Set_up_transport_encryption_with_SSH.</p>

<p style="margin-left:11%; margin-top: 1em">Amanda client
sends data to the server using SSH. SSH keys have to be set
up so that Amanda server can communicate with its clients
using SSH.</p>

<p style="margin-left:11%; margin-top: 1em">General
information including compilation is given above (see
<b>COMPILATION AND GENERAL INFORMATION</b> above).</p>

<p style="margin-left:11%; margin-top: 1em">SSH provides
transport encryption and authentication. To set up an SSH
authentication session, Amanda will run the equivalent of
the following to start the backup process.</p>


<p style="margin-left:11%; margin-top: 1em"><b>/path/to/ssh
&minus;l</b> <i>user_name</i> <b>client.zmanda.com
$libexecdir/amandad</b></p>

<p style="margin-left:11%; margin-top: 1em">To use SSH, you
need to set up SSH keys either by storing the passphrase in
cleartext, using ssh&minus;agent, or using no passphrase at
all. All of these options have security implications which
should be carefully considered before adoption.</p>

<p style="margin-left:11%; margin-top: 1em">When you use a
public key on the client to do data encryption (see
http://wiki.zmanda.com/index.php/How_To:Set_up_data_encryption),
you can lock away the private key in a secure place. Both,
transport and storage will be encrypted with such a setup.
See http://wiki.zmanda.com/index.php/Encryption for an
overview of encryption options.</p>

<p style="margin-left:11%; margin-top: 1em">Enable SSH
authentication and set the <b>ssh&minus;keys</b> option in
all DLEs for that host by adding the following to the DLE
itself or to the corresponding dumptype in amanda.conf:</p>

<p style="margin-left:11%; margin-top: 1em">auth
&quot;ssh&quot; <br>
ssh&minus;keys
&quot;/home/amandabackup/.ssh/id_rsa_amdump&quot;</p>


<p style="margin-left:11%; margin-top: 1em"><b>ssh&minus;keys</b>
is the path to the private key on the client. If the
username to which Amanda should connect is different from
the default, then you should also add</p>


<p style="margin-left:11%; margin-top: 1em">client&minus;username
&quot;otherusername&quot;</p>

<p style="margin-left:11%; margin-top: 1em">If your server
<b>amandad</b> path and client <b>amandad</b> path are
different, you should also add</p>


<p style="margin-left:11%; margin-top: 1em">amandad&minus;path
&quot;/client/amandad/path&quot;</p>

<p style="margin-left:11%; margin-top: 1em">For a marginal
increase in security, prepend the keys used for AMANDA in
the clients' authorized_keys file with the following:</p>


<p style="margin-left:11%; margin-top: 1em">from=&quot;amanda_server.your.domain.com&quot;,no&minus;port&minus;forwarding,no&minus;X11&minus;forwarding,no&minus;agent&minus;forwarding,command=&quot;/absolute/path/to/amandad
&minus;auth=ssh amdump&quot;</p>

<p style="margin-left:11%; margin-top: 1em">This will limit
that key to connect only from Amanda server and only be able
to execute <b>amandad</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em">In the same
way, prepend the key used for AMANDA in the server's
authorized_keys file with:</p>


<p style="margin-left:11%; margin-top: 1em">from=&quot;amanda_client.your.domain.com&quot;,no&minus;port&minus;forwarding,no&minus;X11&minus;forwarding,no&minus;agent&minus;forwarding,command=&quot;/absolute/path/to/amandad
&minus;auth=ssh amindexd amidxtaped&quot;</p>

<p style="margin-left:11%; margin-top: 1em">You can omit
the from=.. option if you have too many clients to list,
although this has obvious security implications.</p>

<p style="margin-left:11%; margin-top: 1em">Set
<b>ssh&minus;keys</b> and any other necessary options in
/etc/amanda/amanda_client.conf:</p>

<p style="margin-left:11%; margin-top: 1em">auth
&quot;ssh&quot; <br>
ssh&minus;keys &quot;/root/.ssh/id_rsa_amrecover&quot; <br>
client&minus;username &quot;amanda&quot; <br>
amandad&minus;path &quot;/server/amandad/path&quot;</p>

<p style="margin-left:11%; margin-top: 1em">Besides user
keys, SSH uses host keys to uniquely identify each host, to
prevent one host from impersonating another. Unfortunately,
the only easy way to set up these host keys is to make a
connection and tell SSH that you trust the identity:</p>

<p style="margin-left:11%; margin-top: 1em">$ ssh
client1.zmanda.com <br>
The authenticity of host 'client1.zmanda.com (192.168.10.1)'
can't be established. <br>
RSA key fingerprint is
26:4e:df:a2:be:c8:cb:20:1c:68:8b:cc:c0:3b:8e:9d. <br>
Are you sure you want to continue connecting
(yes/no)?yes</p>

<p style="margin-left:11%; margin-top: 1em">As Amanda will
not answer this question itself, you must manually make
every connection (server to client and client to server)
that you expect Amanda to make. Note that you must use the
same username that Amanda will use (that is, ssh client and
ssh client.domain.com are distinct).</p>


<p style="margin-left:11%; margin-top: 1em"><b>Authenticated
Peer Hostnames with SSH Authentication</b> <br>
When accepting an incoming conneciton, the SSH daemon gives
Amanda information about the remote system in the
$SSH_CONNECTION environment variable. Amanda parses this
information to determine the remote address, and then
performs a similar check to that done by the BSD
authentications: the forward and reverse DNS entries for the
remote host must match. As such, while SSH authentication
can cryptographically ensure that the remote system is
recognized (since it had a recognized secret key), its
assurances about the remote host's identity are weaker and
depend on the integrity of the DNS.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>amanda</b>(8),
<b>amanda.conf</b>(5), <b>amanda-client.conf</b>(5),
<b>disklist</b>(5), <b>amdump</b>(8),
<b>amrecover</b>(8)</p>

<p style="margin-left:11%; margin-top: 1em">The Amanda
Wiki: : http://wiki.zmanda.com/</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>Jean&minus;Louis
Martineau</b> &lt;martineau@zmanda.com&gt;</p>

<p style="margin-left:17%;">Zmanda, Inc.
(http://www.zmanda.com)</p>

<p style="margin-left:11%; margin-top: 1em"><b>Dustin J.
Mitchell</b> &lt;dustin@zmanda.com&gt;</p>

<p style="margin-left:17%;">Zmanda, Inc.
(http://www.zmanda.com)</p>

<p style="margin-left:11%; margin-top: 1em"><b>Paul
Yeatman</b> &lt;pyeatman@zmanda.com&gt;</p>

<p style="margin-left:17%;">Zmanda, Inc.
(http://www.zmanda.com)</p>
<hr>
</body>
</html>
