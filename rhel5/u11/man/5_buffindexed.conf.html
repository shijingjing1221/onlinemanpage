<!-- Creator     : groff version 1.18.1.1 -->
<!-- CreationDate: Sat Nov 12 05:07:17 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>BUFFINDEXED.CONF(5) BUFFINDEXED.CONF(5)</p>

<p>NAME buffindexed.conf - configuration file for
buffindexed ovmethod</p>

<p>DESCRIPTION The file &lt;pathetc in
inn.conf&gt;/buffindexed.conf is required if buffind- exed
ovmethod is used.</p>

<p>Buffindexed is one of ovmethod which is specified in
inn.conf. It uses preconfigured buffer files to store
overview data and index, and never needs more disk space
other than those files. The files are divided into 8 KB
blocks internally; a given block is allocated for either
overview index or overview data. A block is never shared
among multi- ple newsgroups. There is a database file:
&lt;pathdb in inn.conf&gt;/group.index that includes
information about each newsgroup: the pointer to the index
block for the group, high mark, low mark, flag of the group,
the number of articles, and etc. This file is created
automatically when all buffers are initialized and must not
be edited manually. If all buffers are filled up, innd(8)
throttles itself. Note that the buffer files are never
rolled over and overwritten the way CNFS does. You need to
append another buffer file in this event. You can see the
buffer usage with inndf(8) with -o option.</p>

<p>The file consists of a series of lines; blank lines and
lines beginning with a number sign (#) are ignored. There is
only one kind of con- figuration line. The order of lines in
this file is not important.</p>

<p>index:file_name:buffer_size</p>

<p>Index is an index of overview buffer. Index must be
between 0 and 65535. File_name is the path to overview
buffer file. The length of this path should be not more than
63 characters. Buffer_size is the length of buffer file in
kilobytes in decimal (1 KB = 1024 bytes). If the file_name
is not a special device, the actual file size must be
buffer_size * 1024 bytes. You can NOT use buffers over 2 GB
even if you specify &lt;--with-largefiles at configure&gt;,
or buffers will be broken. Itll be fixed in the future.</p>

<p>When creating new overview buffer, there are two
different methods for creating the files.</p>

<p>1. Create a big file on top of a standard
filesystem.</p>

<p>Use &quot;dd&quot; to create the overview buffer files,
such as &quot;dd if=/dev/zero of=/path/to/ovbuff bs=1024
count=N&quot; where N is the buffer_size.</p>

<p>2. Use block disk devices directly.</p>

<p>If your operating system will allow you to mmap() block
disk devices (Solaris does, FreeBSD does not), this is the
recom- mended method. But note that Solaris (at least 2.6)
seems to have a problem in regional locking of block disk
devices, and should not be used as overview data will be
corrupted.</p>

<p>Partition the disks to make each partition slightly
larger (a few MB larger) than the intended size of each
overview buffer. It is not recommend to use the block device
files already located in /dev; instead, use
&quot;mknod&quot; to create a new set of block device files.
In order to do this, do an &quot;ls -Ll&quot; of the
/dev/dsk partition. The major and minor device numbers are
in the fifth and sixth columns (right before the date),
respec- tively. This information should be fed to
&quot;mknod&quot; to make a &quot;block-type special
file&quot; (b). Here is a short script that accomplishes
this when fed the name of the partition as listed in
/dev/dsk/:</p>

<p>#!/bin/sh disk=$1 major=ls -l /dev/dsk/$disk | awk
{print $5} | tr -d , minor=ls -l /dev/dsk/$disk | awk {print
$6} mkdir /ovbuff mknod /ovbuff/$disk b $major $minor</p>

<p>The created device files themselves consume very little
space.</p>

<p>In either case, make certain that each overview buffer
file is owned by &lt;USER specified with --with-news-user at
configure&gt;, &lt;GROUP speci- fied with --with-news-group
at configure&gt;, and has read/write modes for the owner and
group (mode 0664 or 0660).</p>

<p>When you first start innd(8) and everything is
configured properly, you should see messages in &lt;pathlog
in inn.conf&gt;/news.notice which look like:</p>

<p>Aug 27 00:00:00 kevlar innd: buffindexed: No magic
cookie found for buffindexed 0, initializing</p>

<p>You MUST entirely recreate overview if you remove or
relpace buffers. You need not recreate if you just append
new buffers. And whenever you recreate the overview data
base, you need to clean all the buffers.</p>

<p>HISTORY Written by Katsuhiro Kondou
&lt;kondou@nec.co.jp&gt; for InterNetNews. This is revision
5909, dated 2002-12-03.</p>

<p>SEE ALSO inn.conf(5).</p>

<p>BUFFINDEXED.CONF(5)</p>
<hr>
</body>
</html>
