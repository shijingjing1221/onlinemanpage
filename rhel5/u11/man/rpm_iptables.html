<!-- Creator     : groff version 1.18.1.1 -->
<!-- CreationDate: Sat Nov 12 05:13:44 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>RPM(8) Red Hat Linux RPM(8)</p>

<p>NAME rpm - RPM Package Manager</p>

<p>SYNOPSIS QUERYING AND VERIFYING PACKAGES: rpm
{-q|--query} [select-options] [query-options]</p>

<p>rpm {-V|--verify} [select-options] [verify-options]</p>

<p>rpm --import PUBKEY ...</p>

<p>rpm {-K|--checksig} [--nosignature] [--nodigest]
PACKAGE_FILE ...</p>

<p>INSTALLING, UPGRADING, AND REMOVING PACKAGES: rpm
{-i|--install} [install-options] PACKAGE_FILE ...</p>

<p>rpm {-U|--upgrade} [install-options] PACKAGE_FILE
...</p>

<p>rpm {-F|--freshen} [install-options] PACKAGE_FILE
...</p>

<p>rpm {-e|--erase} [--allmatches] [--nodeps] [--noscripts]
[--notriggers] [--repackage] [--test] PACKAGE_NAME ...</p>

<p>MISCELLANEOUS: rpm {--initdb|--rebuilddb}</p>

<p>rpm {--addsign|--resign} PACKAGE_FILE ...</p>

<p>rpm {--querytags|--showrc}</p>

<p>rpm {--setperms|--setugids} PACKAGE_NAME ...</p>

<p>select-options [PACKAGE_NAME] [-a,--all] [-f,--file
FILE] [-g,--group GROUP] {-p,--package PACKAGE_FILE]
[--fileid MD5] [--hdrid SHA1] [--pkgid MD5] [--tid TID]
[--querybynumber HDRNUM] [--triggeredby PACKAGE_NAME]
[--whatprovides CAPABILITY] [--whatrequires CAPABILITY]</p>

<p>query-options [--changelog] [-c,--configfiles]
[-d,--docfiles] [--dump] [--filesbypkg] [-i,--info] [--last]
[-l,--list] [--provides] [--qf,--queryformat QUERYFMT]
[-R,--requires] [--scripts] [-s,--state]
[--triggers,--triggerscripts]</p>

<p>verify-options [--nodeps] [--nofiles] [--noscripts]
[--nodigest] [--nosignature] [--nolinkto] [--nomd5]
[--nosize] [--nouser] [--nogroup] [--nomtime] [--nomode]
[--nordev]</p>

<p>install-options [--aid] [--allfiles] [--badreloc]
[--excludepath OLDPATH] [--excludedocs] [--force]
[-h,--hash] [--ignoresize] [--ignorearch] [--ignoreos]
[--includedocs] [--justdb] [--nodeps] [--nodigest]
[--nosignature] [--nosuggest] [--noorder] [--noscripts]
[--notriggers] [--oldpackage] [--percent] [--prefix NEWPATH]
[--relocate OLDPATH=NEWPATH] [--repackage] [--replacefiles]
[--replacepkgs] [--test]</p>

<p>DESCRIPTION rpm is a powerful Package Manager, which can
be used to build, install, query, verify, update, and erase
individual software packages. A pack- age consists of an
archive of files and meta-data used to install and erase the
archive files. The meta-data includes helper scripts, file
attributes, and descriptive information about the package.
Packages come in two varieties: binary packages, used to
encapsulate software to be installed, and source packages,
containing the source code and recipe necessary to produce
binary packages.</p>

<p>One of the following basic modes must be selected:
Query, Verify, Sig- nature Check, Install/Upgrade/Freshen,
Uninstall, Initialize Database, Rebuild Database, Resign,
Add Signature, Set Owners/Groups, Show Query- tags, and Show
Configuration.</p>

<p>GENERAL OPTIONS These options can be used in all the
different modes.</p>

<p>-?, --help Print a longer usage message then normal.</p>

<p>--version Print a single line containing the version
number of rpm being used.</p>

<p>--quiet Print as little as possible - normally only
error messages will be displayed.</p>

<p>-v Print verbose information - normally routine progress
messages will be displayed.</p>

<p>-vv Print lots of ugly debugging information.</p>

<p>--rcfile FILELIST Each of the files in the colon
separated FILELIST is read sequentially by rpm for
configuration information. Only the first file in the list
must exist, and tildes will be expanded to the value of
$HOME. The default FILELIST is
/usr/lib/rpm/rpmrc:/usr/lib/rpm/red-
hat/rpmrc:/etc/rpmrc:~/.rpmrc.</p>

<p>--pipe CMD Pipes the output of rpm to the command
CMD.</p>

<p>--dbpath DIRECTORY Use the database in DIRECTORY rather
than the default path /var/lib/rpm</p>

<p>--root DIRECTORY Use the file system tree rooted at
DIRECTORY for all operations. Note that this means the
database within DIRECTORY will be used for dependency checks
and any scriptlet(s) (e.g. %post if installing, or %prep if
building, a package) will be run after a chroot(2) to
DIRECTORY.</p>

<p>-D, --defineMACRO EXPR Defines MACRO with value
EXPR.</p>

<p>-E, --evalEXPR Prints macro expansion of EXPR.</p>

<p>INSTALL AND UPGRADE OPTIONS The general form of an rpm
install command is</p>

<p>rpm {-i|--install} [install-options] PACKAGE_FILE
...</p>

<p>This installs a new package.</p>

<p>The general form of an rpm upgrade command is</p>

<p>rpm {-U|--upgrade} [install-options] PACKAGE_FILE
...</p>

<p>This upgrades or installs the package currently
installed to a newer version. This is the same as install,
except all other version(s) of the package are removed after
the new package is installed.</p>

<p>rpm {-F|--freshen} [install-options] PACKAGE_FILE
...</p>

<p>This will upgrade packages, but only if an earlier
version currently exists. The PACKAGE_FILE may be specified
as an ftp or http URL, in which case the package will be
downloaded before being installed. See FTP/HTTP OPTIONS for
information on rpms internal ftp and http client
support.</p>

<p>--aid Add suggested packages to the transaction set when
needed.</p>

<p>--allfiles Installs or upgrades all the missingok files
in the package, regardless if they exist.</p>

<p>--badreloc Used with --relocate, permit relocations on
all file paths, not just those OLDPATHs included in the
binary package relocation hint(s).</p>

<p>--excludepath OLDPATH Dont install files whose name
begins with OLDPATH.</p>

<p>--excludedocs Don t install any files which are marked
as documentation (which includes man pages and texinfo
documents).</p>

<p>--force Same as using --replacepkgs, --replacefiles, and
--oldpackage.</p>

<p>-h, --hash Print 50 hash marks as the package archive is
unpacked. Use with -v|--verbose for a nicer display.</p>

<p>--ignoresize Dont check mount file systems for
sufficient disk space before installing this package.</p>

<p>--ignorearch Allow installation or upgrading even if the
architectures of the binary package and host dont match.</p>

<p>--ignoreos Allow installation or upgrading even if the
operating systems of the binary package and host dont
match.</p>

<p>--includedocs Install documentation files. This is the
default behavior.</p>

<p>--justdb Update only the database, not the
filesystem.</p>

<p>--nodigest Dont verify package or header digests when
reading.</p>

<p>--nosignature Don t verify package or header signatures
when reading.</p>

<p>--nodeps Dont do a dependency check before installing or
upgrading a package.</p>

<p>--nosuggest Don t suggest package(s) that provide a
missing dependency.</p>

<p>--noorder Dont reorder the packages for an install. The
list of packages would normally be reordered to satisfy
dependencies.</p>

<p>--noscripts</p>

<p>--nopre</p>

<p>--nopost</p>

<p>--nopreun</p>

<p>--nopostun Dont execute the scriptlet of the same name.
The --noscripts option is equivalent to</p>

<p>--nopre --nopost --nopreun --nopostun</p>

<p>and turns off the execution of the corresponding %pre,
%post, %preun, and %postun scriptlet(s).</p>

<p>--notriggers</p>

<p>--notriggerin</p>

<p>--notriggerun</p>

<p>--notriggerpostun Dont execute any trigger scriptlet of
the named type. The --notriggers option is equivalent to</p>

<p>--notriggerin --notriggerun --notriggerpostun</p>

<p>and turns off execution of the corresponding %triggerin,
%trig- gerun, and %triggerpostun scriptlet(s).</p>

<p>--oldpackage Allow an upgrade to replace a newer package
with an older one.</p>

<p>--percent Print percentages as files are unpacked from
the package archive. This is intended to make rpm easy to
run from other tools.</p>

<p>--prefix NEWPATH For relocatable binary packages,
translate all file paths that start with the installation
prefix in the package relocation hint(s) to NEWPATH.</p>

<p>--relocate OLDPATH=NEWPATH For relocatable binary
packages, translate all file paths that start with OLDPATH
in the package relocation hint(s) to NEWPATH. This option
can be used repeatedly if several OLDPATHs in the package
are to be relocated.</p>

<p>--repackage Re-package the files before erasing. The
previously installed package will be named according to the
macro %_repack- age_name_fmt and will be created in the
directory named by the macro %_repackage_dir (default value
is /var/spool/repackage).</p>

<p>--replacefiles Install the packages even if they replace
files from other, already installed, packages.</p>

<p>--replacepkgs Install the packages even if some of them
are already installed on this system.</p>

<p>--test Do not install the package, simply check for and
report poten- tial conflicts.</p>

<p>ERASE OPTIONS The general form of an rpm erase command
is</p>

<p>rpm {-e|--erase} [--allmatches] [--nodeps] [--noscripts]
[--notriggers] [--repackage] [--test] PACKAGE_NAME ...</p>

<p>The following options may also be used:</p>

<p>--allmatches Remove all versions of the package which
match PACKAGE_NAME. Normally an error is issued if
PACKAGE_NAME matches multiple packages.</p>

<p>--nodeps Dont check dependencies before uninstalling the
packages.</p>

<p>--noscripts</p>

<p>--nopreun</p>

<p>--nopostun Don t execute the scriptlet of the same name.
The --noscripts option during package erase is equivalent
to</p>

<p>--nopreun --nopostun</p>

<p>and turns off the execution of the corresponding %preun,
and %postun scriptlet(s).</p>

<p>--notriggers</p>

<p>--notriggerun</p>

<p>--notriggerpostun Don t execute any trigger scriptlet of
the named type. The --notriggers option is equivalent to</p>

<p>--notriggerun --notriggerpostun</p>

<p>and turns off execution of the corresponding %triggerun,
and %triggerpostun scriptlet(s).</p>

<p>--repackage Re-package the files before erasing. The
previously installed package will be named according to the
macro %_repack- age_name_fmt and will be created in the
directory named by the macro %_repackage_dir (default value
is /var/spool/repackage).</p>

<p>--test Dont really uninstall anything, just go through
the motions. Useful in conjunction with the -vv option for
debugging.</p>

<p>QUERY OPTIONS The general form of an rpm query command
is</p>

<p>rpm {-q|--query} [select-options] [query-options]</p>

<p>You may specify the format that package information
should be printed in. To do this, you use the</p>

<p>--qf|--queryformat QUERYFMT</p>

<p>option, followed by the QUERYFMT format string. Query
formats are mod- ified versions of the standard printf(3)
formatting. The format is made up of static strings (which
may include standard C character escapes for newlines, tabs,
and other special characters) and printf(3) type formatters.
As rpm already knows the type to print, the type specifier
must be omitted however, and replaced by the name of the
header tag to be printed, enclosed by {} characters. Tag
names are case insensitive, and the leading RPMTAG_ portion
of the tag name may be omitted as well.</p>

<p>Alternate output formats may be requested by following
the tag with :typetag. Currently, the following types are
supported:</p>

<p>:armor Wrap a public key in ASCII armor.</p>

<p>:base64 Encode binary data using base64.</p>

<p>:date Use strftime(3) &quot;%c&quot; format.</p>

<p>:day Use strftime(3) &quot;%a %b %d %Y&quot; format.</p>

<p>:depflags Format dependency flags.</p>

<p>:fflags Format file flags.</p>

<p>:hex Format in hexadecimal.</p>

<p>:octal Format in octal.</p>

<p>:perms Format file permissions.</p>

<p>:shescape Escape single quotes for use in a script.</p>

<p>:triggertype Display trigger suffix.</p>

<p>For example, to print only the names of the packages
queried, you could use %{NAME} as the format string. To
print the packages name and dis- tribution information in
two columns, you could use %-30{NAME}%{DISTRI- BUTION}. rpm
will print a list of all of the tags it knows about when it
is invoked with the --querytags argument.</p>

<p>There are two subsets of options for querying: package
selection, and information selection.</p>

<p>PACKAGE SELECTION OPTIONS: PACKAGE_NAME Query installed
package named PACKAGE_NAME.</p>

<p>-a, --all Query all installed packages.</p>

<p>-f, --file FILE Query package owning FILE.</p>

<p>--fileid MD5 Query package that contains a given file
identifier, i.e. the MD5 digest of the file contents.</p>

<p>-g, --group GROUP Query packages with the group of
GROUP.</p>

<p>--hdrid SHA1 Query package that contains a given header
identifier, i.e. the SHA1 digest of the immutable header
region.</p>

<p>-p, --package PACKAGE_FILE Query an (uninstalled)
package PACKAGE_FILE. The PACKAGE_FILE may be specified as
an ftp or http style URL, in which case the package header
will be downloaded and queried. See FTP/HTTP OPTIONS for
information on rpms internal ftp and http client support.
The PACKAGE_FILE argument(s), if not a binary package, will
be interpreted as an ASCII package manifest. Comments are
permitted, starting with a #, and each line of a package
mani- fest file may include white space separated glob
expressions, including URLs with remote glob expressions,
that will be expanded to paths that are substituted in place
of the package manifest as additional PACKAGE_FILE arguments
to the query.</p>

<p>--pkgid MD5 Query package that contains a given package
identifier, i.e. the MD5 digest of the combined header and
payload contents.</p>

<p>--querybynumber HDRNUM Query the HDRNUMth database entry
directly; this is useful only for debugging.</p>

<p>--specfile SPECFILE Parse and query SPECFILE as if it
were a package. Although not all the information (e.g. file
lists) is available, this type of query permits rpm to be
used to extract information from spec files without having
to write a specfile parser.</p>

<p>--tid TID Query package(s) that have a given TID
transaction identifier. A unix time stamp is currently used
as a transaction identifier. All package(s) installed or
erased within a single transaction have a common
identifier.</p>

<p>--triggeredby PACKAGE_NAME Query packages that are
triggered by package(s) PACKAGE_NAME.</p>

<p>--whatprovides CAPABILITY Query all packages that
provide the CAPABILITY capability.</p>

<p>--whatrequires CAPABILITY Query all packages that
requires CAPABILITY for proper function- ing.</p>

<p>PACKAGE QUERY OPTIONS: --changelog Display change
information for the package.</p>

<p>-c, --configfiles List only configuration files (implies
-l).</p>

<p>-d, --docfiles List only documentation files (implies
-l).</p>

<p>--dump Dump file information as follows (implies
-l):</p>

<p>path size mtime md5sum mode owner group isconfig isdoc
rdev symlink</p>

<p>--filesbypkg List all the files in each selected
package.</p>

<p>-i, --info Display package information, including name,
version, and description. This uses the --queryformat if one
was specified.</p>

<p>--last Orders the package listing by install time such
that the latest packages are at the top.</p>

<p>-l, --list List files in package.</p>

<p>--provides List capabilities this package provides.</p>

<p>-R, --requires List packages on which this package
depends.</p>

<p>--scripts List the package specific scriptlet(s) that
are used as part of the installation and uninstallation
processes.</p>

<p>-s, --state Display the states of files in the package
(implies -l). The state of each file is one of normal, not
installed, or replaced.</p>

<p>--triggers, --triggerscripts Display the trigger
scripts, if any, which are contained in the package.</p>

<p>VERIFY OPTIONS The general form of an rpm verify command
is</p>

<p>rpm {-V|--verify} [select-options] [verify-options]</p>

<p>Verifying a package compares information about the
installed files in the package with information about the
files taken from the package metadata stored in the rpm
database. Among other things, verifying compares the size,
MD5 sum, permissions, type, owner and group of each file.
Any discrepancies are displayed. Files that were not
installed from the package, for example, documentation files
excluded on instal- lation using the
&quot;--excludedocs&quot; option, will be silently
ignored.</p>

<p>The package selection options are the same as for
package querying (including package manifest files as
arguments). Other options unique to verify mode are:</p>

<p>--nodeps Dont verify dependencies of packages.</p>

<p>--nodigest Dont verify package or header digests when
reading.</p>

<p>--nofiles Dont verify any attributes of package
files.</p>

<p>--noscripts Don t execute the %verifyscript scriptlet
(if any).</p>

<p>--nosignature Dont verify package or header signatures
when reading.</p>

<p>--nolinkto</p>

<p>--nomd5</p>

<p>--nosize</p>

<p>--nouser</p>

<p>--nogroup</p>

<p>--nomtime</p>

<p>--nomode</p>

<p>--nordev Dont verify the corresponding file
attribute.</p>

<p>The format of the output is a string of 8 characters, a
possible attribute marker:</p>

<p>c %config configuration file. d %doc documentation file.
g %ghost file (i.e. the file contents are not included in
the package payload). l %license license file. r %readme
readme file.</p>

<p>from the package header, followed by the file name. Each
of the 8 characters denotes the result of a comparison of
attribute(s) of the file to the value of those attribute(s)
recorded in the database. A single &quot;.&quot; (period)
means the test passed, while a single &quot;?&quot;
(question mark) indicates the test could not be performed
(e.g. file permissions prevent reading). Otherwise, the
(mnemonically emBoldened) character denotes failure of the
corresponding --verify test:</p>

<p>S file Size differs M Mode differs (includes permissions
and file type) 5 MD5 sum differs D Device major/minor number
mismatch L readLink(2) path mismatch U User ownership
differs G Group ownership differs T mTime differs</p>

<p>DIGITAL SIGNATURE AND DIGEST VERIFICATION The general
forms of rpm digital signature commands are</p>

<p>rpm --import PUBKEY ...</p>

<p>rpm {--checksig} [--nosignature] [--nodigest]
PACKAGE_FILE ...</p>

<p>The --checksig option checks all the digests and
signatures contained in PACKAGE_FILE to ensure the integrity
and origin of the package. Note that signatures are now
verified whenever a package is read, and --checksig is
useful to verify all of the digests and signatures asso-
ciated with a package.</p>

<p>Digital signatures cannot be verified without a public
key. An ASCII armored public key can be added to the rpm
database using --import. An imported public key is carried
in a header, and key ring management is performed exactly
like package management. For example, all currently imported
public keys can be displayed by:</p>

<p>rpm -qa gpg-pubkey*</p>

<p>Details about a specific public key, when imported, can
be displayed by querying. Heres information about the Red
Hat GPG/DSA key:</p>

<p>rpm -qi gpg-pubkey-db42a60e</p>

<p>Finally, public keys can be erased after importing just
like packages. Heres how to remove the Red Hat GPG/DSA
key</p>

<p>rpm -e gpg-pubkey-db42a60e</p>

<p>SIGNING A PACKAGE rpm --addsign|--resign PACKAGE_FILE
...</p>

<p>Both of the --addsign and --resign options generate and
insert new sig- natures for each package PACKAGE_FILE given,
replacing any existing signatures. There are two options for
historical reasons, there is no difference in behavior
currently.</p>

<p>USING GPG TO SIGN PACKAGES In order to sign packages
using GPG, rpm must be configured to run GPG and be able to
find a key ring with the appropriate keys. By default, rpm
uses the same conventions as GPG to find key rings, namely
the $GNUPGHOME environment variable. If your key rings are
not located where GPG expects them to be, you will need to
configure the macro %_gpg_path to be the location of the GPG
key rings to use.</p>

<p>For compatibility with older versions of GPG, PGP, and
rpm, only V3 OpenPGP signature packets should be configured.
Either DSA or RSA ver- ification algorithms can be used, but
DSA is preferred.</p>

<p>If you want to be able to sign packages you create
yourself, you also need to create your own public and secret
key pair (see the GPG man- ual). You will also need to
configure the rpm macros</p>

<p>%_signature The signature type. Right now only gpg and
pgp are supported.</p>

<p>%_gpg_name The name of the &quot;user&quot; whose key
you wish to use to sign your packages.</p>

<p>For example, to be able to use GPG to sign packages as
the user &quot;John Doe &lt;jdoe@foo.com&gt;&quot; from the
key rings located in /etc/rpm/.gpg using the executable
/usr/bin/gpg you would include</p>

<p>%_signature gpg %_gpg_path /etc/rpm/.gpg %_gpg_name John
Doe &lt;jdoe@foo.com&gt; %_gpgbin /usr/bin/gpg</p>

<p>in a macro configuration file. Use /etc/rpm/macros for
per-system con- figuration and ~/.rpmmacros for per-user
configuration.</p>

<p>REBUILD DATABASE OPTIONS The general form of an rpm
rebuild database command is</p>

<p>rpm {--initdb|--rebuilddb} [-v] [--dbpath DIRECTORY]
[--root DIRECTORY]</p>

<p>Use --initdb to create a new database if one doesnt
already exist (existing database is not overwritten), use
--rebuilddb to rebuild the database indices from the
installed package headers.</p>

<p>SHOWRC The command</p>

<p>rpm --showrc</p>

<p>shows the values rpm will use for all of the options are
currently set in rpmrc and macros configuration file(s).</p>

<p>FTP/HTTP OPTIONS rpm can act as an FTP and/or HTTP
client so that packages can be queried or installed from the
internet. Package files for install, upgrade, and query
operations may be specified as an ftp or http style URL:</p>

<p>ftp://USER:PASSWORD@HOST:PORT/path/to/package.rpm</p>

<p>If the :PASSWORD portion is omitted, the password will
be prompted for (once per user/hostname pair). If both the
user and password are omit- ted, anonymous ftp is used. In
all cases, passive (PASV) ftp transfers are performed.</p>

<p>rpm allows the following options to be used with ftp
URLs:</p>

<p>--ftpproxy HOST The host HOST will be used as a proxy
server for all ftp trans- fers, which allows users to ftp
through firewall machines which use proxy systems. This
option may also be specified by config- uring the macro
%_ftpproxy.</p>

<p>--ftpport PORT The TCP PORT number to use for the ftp
connection on the proxy ftp server instead of the default
port. This option may also be specified by configuring the
macro %_ftpport.</p>

<p>rpm allows the following options to be used with http
URLs:</p>

<p>--httpproxy HOST The host HOST will be used as a proxy
server for all http trans- fers. This option may also be
specified by configuring the macro %_httpproxy.</p>

<p>--httpport PORT The TCP PORT number to use for the http
connection on the proxy http server instead of the default
port. This option may also be specified by configuring the
macro %_httpport.</p>

<p>LEGACY ISSUES Executing rpmbuild The build modes of rpm
are now resident in the /usr/bin/rpmbuild exe- cutable.
Although legacy compatibility provided by the popt aliases
below has been adequate, the compatibility is not perfect;
hence build mode compatibility through popt aliases is being
removed from rpm. Install the package containing rpmbuild
(usually rpm-build) and see rpmbuild(8) for documentation of
all the rpm build modes previously documented here in
rpm(8).</p>

<p>Add the following lines to /etc/popt if you wish to
continue invoking rpmbuild from the rpm command line:</p>

<p>rpm exec --bp rpmb -bp rpm exec --bc rpmb -bc rpm exec
--bi rpmb -bi rpm exec --bl rpmb -bl rpm exec --ba rpmb -ba
rpm exec --bb rpmb -bb rpm exec --bs rpmb -bs rpm exec --tp
rpmb -tp rpm exec --tc rpmb -tc rpm exec --ti rpmb -ti rpm
exec --tl rpmb -tl rpm exec --ta rpmb -ta rpm exec --tb rpmb
-tb rpm exec --ts rpmb -ts rpm exec --rebuild rpmb --rebuild
rpm exec --recompile rpmb --recompile rpm exec --clean rpmb
--clean rpm exec --rmsource rpmb --rmsource rpm exec
--rmspec rpmb --rmspec rpm exec --target rpmb --target rpm
exec --short-circuit rpmb --short-circuit</p>

<p>FILES rpmrc Configuration /usr/lib/rpm/rpmrc
/usr/lib/rpm/redhat/rpmrc /etc/rpmrc ~/.rpmrc</p>

<p>Macro Configuration /usr/lib/rpm/macros
/usr/lib/rpm/redhat/macros /etc/rpm/macros ~/.rpmmacros</p>

<p>Database /var/lib/rpm/Basenames
/var/lib/rpm/Conflictname /var/lib/rpm/Dirnames
/var/lib/rpm/Filemd5s /var/lib/rpm/Group
/var/lib/rpm/Installtid /var/lib/rpm/Name
/var/lib/rpm/Packages /var/lib/rpm/Providename
/var/lib/rpm/Provideversion /var/lib/rpm/Pubkeys
/var/lib/rpm/Removed /var/lib/rpm/Requirename
/var/lib/rpm/Requireversion /var/lib/rpm/Sha1header
/var/lib/rpm/Sigmd5 /var/lib/rpm/Triggername</p>

<p>Temporary /var/tmp/rpm*</p>

<p>SEE ALSO popt(3), rpm2cpio(8), rpmbuild(8),</p>

<p>rpm --help - as rpm supports customizing the options via
popt aliases its impossible to guarantee that whats
described in the manual matches whats available.</p>

<p>http://www.rpm.org/ &lt;URL:http://www.rpm.org/&gt;</p>

<p>AUTHORS Marc Ewing &lt;marc@redhat.com&gt; Jeff Johnson
&lt;jbj@redhat.com&gt; Erik Troan &lt;ewt@redhat.com&gt;</p>

<p>Red Hat, Inc. 09 June 2002 RPM(8) IPTABLES(8)
IPTABLES(8)</p>

<p>NAME iptables - administration tool for IPv4 packet
filtering and NAT</p>

<p>SYNOPSIS iptables [-t table] -[AD] chain
rule-specification [options] iptables [-t table] -I chain
[rulenum] rule-specification [options] iptables [-t table]
-R chain rulenum rule-specification [options] iptables [-t
table] -D chain rulenum [options] iptables [-t table] -[LFZ]
[chain] [options] iptables [-t table] -N chain iptables [-t
table] -X [chain] iptables [-t table] -P chain target
[options] iptables [-t table] -E old-chain-name
new-chain-name</p>

<p>DESCRIPTION Iptables is used to set up, maintain, and
inspect the tables of IP packet filter rules in the Linux
kernel. Several different tables may be defined. Each table
contains a number of built-in chains and may also contain
user-defined chains.</p>

<p>Each chain is a list of rules which can match a set of
packets. Each rule specifies what to do with a packet that
matches. This is called a target, which may be a jump to a
user-defined chain in the same ta- ble.</p>

<p>TARGETS A firewall rule specifies criteria for a packet,
and a target. If the packet does not match, the next rule in
the chain is the examined; if it does match, then the next
rule is specified by the value of the tar- get, which can be
the name of a user-defined chain or one of the spe- cial
values ACCEPT, DROP, QUEUE, or RETURN.</p>

<p>ACCEPT means to let the packet through. DROP means to
drop the packet on the floor. QUEUE means to pass the packet
to userspace. (How the packet can be received by a userspace
process differs by the particular queue handler. 2.4.x and
2.6.x kernels up to 2.6.13 include the ip_queue queue
handler. Kernels 2.6.14 and later additionally include the
nfnetlink_queue queue handler. Packets with a target of
QUEUE will be sent to queue number 0 in this case. Please
also see the NFQUEUE target as described later in this man
page.) RETURN means stop traversing this chain and resume at
the next rule in the previous (calling) chain. If the end of
a built-in chain is reached or a rule in a built-in chain
with target RETURN is matched, the target specified by the
chain policy determines the fate of the packet.</p>

<p>TABLES There are currently three independent tables
(which tables are present at any time depends on the kernel
configuration options and which mod- ules are present).</p>

<p>-t, --table table This option specifies the packet
matching table which the com- mand should operate on. If the
kernel is configured with auto- matic module loading, an
attempt will be made to load the appro- priate module for
that table if it is not already there.</p>

<p>The tables are as follows:</p>

<p>filter: This is the default table (if no -t option is
passed). It contains the built-in chains INPUT (for packets
destined to local sockets), FORWARD (for packets being
routed through the box), and OUTPUT (for locally-generated
packets).</p>

<p>nat: This table is consulted when a packet that creates
a new connection is encountered. It consists of three
built-ins: PREROUTING (for altering packets as soon as they
come in), OUTPUT (for altering locally-generated packets
before rout- ing), and POSTROUTING (for altering packets as
they are about to go out).</p>

<p>mangle: This table is used for specialized packet
alteration. Until kernel 2.4.17 it had two built-in chains:
PREROUTING (for altering incoming packets before routing)
and OUTPUT (for altering locally-generated packets before
routing). Since kernel 2.4.18, three other built-in chains
are also sup- ported: INPUT (for packets coming into the box
itself), FOR- WARD (for altering packets being routed
through the box), and POSTROUTING (for altering packets as
they are about to go out).</p>

<p>raw: This table is used mainly for configuring
exemptions from connection tracking in combination with the
NOTRACK target. It registers at the netfilter hooks with
higher priority and is thus called before ip_conntrack, or
any other IP tables. It provides the following built-in
chains: PREROUTING (for packets arriving via any network
interface) OUTPUT (for packets generated by local
processes)</p>

<p>OPTIONS The options that are recognized by iptables can
be divided into several different groups.</p>

<p>COMMANDS These options specify the specific action to
perform. Only one of them can be specified on the command
line unless otherwise specified below. For all the long
versions of the command and option names, you need to use
only enough letters to ensure that iptables can
differentiate it from all other options.</p>

<p>-A, --append chain rule-specification Append one or more
rules to the end of the selected chain. When the source
and/or destination names resolve to more than one address, a
rule will be added for each possible address combina-
tion.</p>

<p>-D, --delete chain rule-specification -D, --delete chain
rulenum Delete one or more rules from the selected chain.
There are two versions of this command: the rule can be
specified as a number in the chain (starting at 1 for the
first rule) or a rule to match.</p>

<p>-I, --insert chain [rulenum] rule-specification Insert
one or more rules in the selected chain as the given rule
number. So, if the rule number is 1, the rule or rules are
inserted at the head of the chain. This is also the default
if no rule number is specified.</p>

<p>-R, --replace chain rulenum rule-specification Replace a
rule in the selected chain. If the source and/or des-
tination names resolve to multiple addresses, the command
will fail. Rules are numbered starting at 1.</p>

<p>-L, --list [chain] List all rules in the selected chain.
If no chain is selected, all chains are listed. As every
other iptables command, it applies to the specified table
(filter is the default), so NAT rules get listed by iptables
-t nat -n -L Please note that it is often used with the -n
option, in order to avoid long reverse DNS lookups. It is
legal to specify the -Z (zero) option as well, in which case
the chain(s) will be atomically listed and zeroed. The exact
output is affected by the other arguments given. The exact
rules are suppressed until you use iptables -L -v</p>

<p>-F, --flush [chain] Flush the selected chain (all the
chains in the table if none is given). This is equivalent to
deleting all the rules one by one.</p>

<p>-Z, --zero [chain] Zero the packet and byte counters in
all chains. It is legal to specify the -L, --list (list)
option as well, to see the coun- ters immediately before
they are cleared. (See above.)</p>

<p>-N, --new-chain chain Create a new user-defined chain by
the given name. There must be no target of that name
already.</p>

<p>-X, --delete-chain [chain] Delete the optional
user-defined chain specified. There must be no references to
the chain. If there are, you must delete or replace the
referring rules before the chain can be deleted. The chain
must be empty, i.e. not contain any rules. If no argument is
given, it will attempt to delete every non-builtin chain in
the table.</p>

<p>-P, --policy chain target Set the policy for the chain
to the given target. See the sec- tion TARGETS for the legal
targets. Only built-in (non-user- defined) chains can have
policies, and neither built-in nor user-defined chains can
be policy targets.</p>

<p>-E, --rename-chain old-chain new-chain Rename the user
specified chain to the user supplied name. This is cosmetic,
and has no effect on the structure of the table.</p>

<p>-h Help. Give a (currently very brief) description of
the command syntax.</p>

<p>PARAMETERS The following parameters make up a rule
specification (as used in the add, delete, insert, replace
and append commands).</p>

<p>-p, --protocol [!] protocol The protocol of the rule or
of the packet to check. The speci- fied protocol can be one
of tcp, udp, icmp, or all, or it can be a numeric value,
representing one of these protocols or a dif- ferent one. A
protocol name from /etc/protocols is also allowed. A
&quot;!&quot; argument before the protocol inverts the test.
The number zero is equivalent to all. Protocol all will
match with all protocols and is taken as default when this
option is omitted.</p>

<p>-s, --source [!] address[/mask] Source specification.
Address can be either a network name, a hostname (please
note that specifying any name to be resolved with a remote
query such as DNS is a really bad idea), a network IP
address (with /mask), or a plain IP address. The mask can be
either a network mask or a plain number, specifying the
number of 1s at the left side of the network mask. Thus, a
mask of 24 is equivalent to 255.255.255.0. A &quot;!&quot;
argument before the address specification inverts the sense
of the address. The flag --src is an alias for this
option.</p>

<p>-d, --destination [!] address[/mask] Destination
specification. See the description of the -s (source) flag
for a detailed description of the syntax. The flag --dst is
an alias for this option.</p>

<p>-j, --jump target This specifies the target of the rule;
i.e., what to do if the packet matches it. The target can be
a user-defined chain (other than the one this rule is in),
one of the special builtin targets which decide the fate of
the packet immediately, or an extension (see EXTENSIONS
below). If this option is omitted in a rule (and -g is not
used), then matching the rule will have no effect on the
packets fate, but the counters on the rule will be
incremented.</p>

<p>-g, --goto chain This specifies that the processing
should continue in a user specified chain. Unlike the --jump
option return will not con- tinue processing in this chain
but instead in the chain that called us via --jump.</p>

<p>-i, --in-interface [!] name Name of an interface via
which a packet was received (only for packets entering the
INPUT, FORWARD and PREROUTING chains). When the
&quot;!&quot; argument is used before the interface name,
the sense is inverted. If the interface name ends in a
&quot;+&quot;, then any interface which begins with this
name will match. If this option is omitted, any interface
name will match.</p>

<p>-o, --out-interface [!] name Name of an interface via
which a packet is going to be sent (for packets entering the
FORWARD, OUTPUT and POSTROUTING chains). When the
&quot;!&quot; argument is used before the interface name,
the sense is inverted. If the interface name ends in a
&quot;+&quot;, then any interface which begins with this
name will match. If this option is omitted, any interface
name will match.</p>

<p>[!] -f, --fragment This means that the rule only refers
to second and further frag- ments of fragmented packets.
Since there is no way to tell the source or destination
ports of such a packet (or ICMP type), such a packet will
not match any rules which specify them. When the
&quot;!&quot; argument precedes the &quot;-f&quot; flag, the
rule will only match head fragments, or unfragmented
packets.</p>

<p>-c, --set-counters PKTS BYTES This enables the
administrator to initialize the packet and byte counters of
a rule (during INSERT, APPEND, REPLACE operations).</p>

<p>OTHER OPTIONS The following additional options can be
specified:</p>

<p>-v, --verbose Verbose output. This option makes the list
command show the interface name, the rule options (if any),
and the TOS masks. The packet and byte counters are also
listed, with the suffix K , M or G for 1000, 1,000,000 and
1,000,000,000 multipli- ers respectively (but see the -x
flag to change this). For appending, insertion, deletion and
replacement, this causes detailed information on the rule or
rules to be printed.</p>

<p>-n, --numeric Numeric output. IP addresses and port
numbers will be printed in numeric format. By default, the
program will try to display them as host names, network
names, or services (whenever appli- cable).</p>

<p>-x, --exact Expand numbers. Display the exact value of
the packet and byte counters, instead of only the rounded
number in K s (multiples of 1000) Ms (multiples of 1000K) or
G s (multiples of 1000M). This option is only relevant for
the -L command.</p>

<p>--line-numbers When listing rules, add line numbers to
the beginning of each rule, corresponding to that rules
position in the chain.</p>

<p>--modprobe=command When adding or inserting rules into a
chain, use command to load any necessary modules (targets,
match extensions, etc).</p>

<p>MATCH EXTENSIONS iptables can use extended packet
matching modules. These are loaded in two ways: implicitly,
when -p or --protocol is specified, or with the -m or
--match options, followed by the matching module name; after
these, various extra command line options become available,
depending on the specific module. You can specify multiple
extended match mod- ules in one line, and you can use the -h
or --help options after the module has been specified to
receive help specific to that module.</p>

<p>The following are included in the base package, and most
of these can be preceded by a ! to invert the sense of the
match.</p>

<p>account Account traffic for all hosts in defined
network/netmask.</p>

<p>Features:</p>

<p>- long (one counter per protocol TCP/UDP/IMCP/Other) and
short statis- tics</p>

<p>- one iptables rule for all hosts in network/netmask</p>

<p>- loading/saving counters (by reading/writting to procfs
entries)</p>

<p>--aaddr network/netmask defines network/netmask for
which make statistics.</p>

<p>--aname name defines name of list where statistics will
be kept. If no is specified DEFAULT will be used.</p>

<p>--ashort table will colect only short statistics (only
total counters without splitting it into protocols.</p>

<p>Example usage:</p>

<p>account traffic for/to 192.168.0.0/24 network into table
mynetwork:</p>

<p># iptables -A FORWARD -m account --aname mynetwork
--aaddr 192.168.0.0/24</p>

<p>account traffic for/to WWW serwer for 192.168.0.0/24
network into table mywwwserver:</p>

<p># iptables -A INPUT -p tcp --dport 80 -m account --aname
mywwwserver --aaddr 192.168.0.0/24 --ashort</p>

<p># iptables -A OUTPUT -p tcp --sport 80 -m account
--aname mywwwserver --aaddr 192.168.0.0/24 --ashort</p>

<p>read counters:</p>

<p># cat /proc/net/ipt_account/mynetwork # cat
/proc/net/ipt_account/mywwwserver</p>

<p>set counters:</p>

<p># echo &quot;ip = 192.168.0.1 packets_src = 0&quot; &gt;
/proc/net/ipt_account/mywwserver</p>

<p>Webpage:
http://www.barbara.eu.org/~quaker/ipt_account/</p>

<p>addrtype This module matches packets based on their
address type. Address types are used within the kernel
networking stack and categorize addresses into various
groups. The exact definition of that group depends on the
specific layer three protocol.</p>

<p>The following address types are possible:</p>

<p>UNSPEC an unspecified address (i.e. 0.0.0.0) UNICAST an
unicast address LOCAL a local address BROADCAST a broadcast
address ANYCAST an anycast packet MULTICAST a multicast
address BLACKHOLE a black- hole address UNREACHABLE an
unreachable address PROHIBIT a pro- hibited address THROW
FIXME NAT FIXME XRESOLVE FIXME</p>

<p>--src-type type Matches if the source address is of
given type</p>

<p>--dst-type type Matches if the destination address is of
given type</p>

<p>ah This module matches the SPIs in Authentication header
of IPsec packets.</p>

<p>--ahspi [!] spi[:spi]</p>

<p>childlevel This is an experimental module. It matches on
whether the packet is part of a master connection or one of
its children (or grandchildren, etc). For instance, most
packets are level 0. FTP data transfer is level 1.</p>

<p>--childlevel [!] level</p>

<p>comment Allows you to add comments (up to 256
characters) to any rule.</p>

<p>--comment comment</p>

<p>Example: iptables -A INPUT -s 192.168.0.0/16 -m comment
--comment &quot;A pri- vatized IP block&quot;</p>

<p>condition This matches if a specific /proc filename is 0
or 1.</p>

<p>--condition [!] filename Match on boolean value stored
in /proc/net/ipt_condition/file- name file</p>

<p>connbytes Match by how many bytes or packets a
connection (or one of the two flows constituting the
connection) have tranferred so far, or by aver- age bytes
per packet.</p>

<p>The counters are 64bit and are thus not expected to
overflow ;)</p>

<p>The primary use is to detect long-lived downloads and
mark them to be scheduled using a lower priority band in
traffic control.</p>

<p>The transfered bytes per connection can also be viewed
through /proc/net/ip_conntrack and accessed via
ctnetlink</p>

<p>[!] --connbytes from:[to] match packets from a
connection whose packets/bytes/average packet size is more
than FROM and less than TO bytes/packets. if TO is omitted
only FROM check is done. &quot;!&quot; is used to match
packets not falling in the range.</p>

<p>--connbytes-dir [original|reply|both] which packets to
consider</p>

<p>--connbytes-mode [packets|bytes|avgpkt] whether to check
the amount of packets, number of bytes trans- ferred or the
average size (in bytes) of all packets received so far. Note
that when &quot;both&quot; is used together with
&quot;avgpkt&quot;, and data is going (mainly) only in one
direction (for example HTTP), the average packet size will
be about half of the actual data packets.</p>

<p>Example: iptables .. -m connbytes --connbytes
10000:100000 --connbytes- dir both --connbytes-mode bytes
...</p>

<p>connlimit Allows you to restrict the number of parallel
TCP connections to a server per client IP address (or
address block).</p>

<p>[!] --connlimit-above n match if the number of existing
tcp connections is (not) above n</p>

<p>--connlimit-mask bits group hosts using mask</p>

<p>Examples:</p>

<p># allow 2 telnet connections per client host iptables -p
tcp --syn --dport 23 -m connlimit --connlimit-above 2 -j
REJECT</p>

<p># you can also match the other way around: iptables -p
tcp --syn --dport 23 -m connlimit ! --connlimit- above 2 -j
ACCEPT</p>

<p># limit the nr of parallel http requests to 16 per class
C sized net- work (24 bit netmask) iptables -p tcp --syn
--dport 80 -m connlimit --connlimit-above 16
--connlimit-mask 24 -j REJECT</p>

<p>connmark This module matches the netfilter mark field
associated with a connec- tion (which can be set using the
CONNMARK target below).</p>

<p>--mark value[/mask] Matches packets in connections with
the given mark value (if a mask is specified, this is
logically ANDed with the mark before the comparison).</p>

<p>connrate This module matches the current transfer rate
in a connection.</p>

<p>--connrate [!] [from]:[to] Match against the current
connection transfer rate being within from and to bytes per
second. When the &quot;!&quot; argument is used before the
range, the sense of the match is inverted.</p>

<p>conntrack This module, when combined with connection
tracking, allows access to more connection tracking
information than the &quot;state&quot; match. (this module
is present only if iptables was compiled under a kernel
support- ing this feature)</p>

<p>--ctstate state Where state is a comma separated list of
the connection states to match. Possible states are INVALID
meaning that the packet is associated with no known
connection, ESTABLISHED meaning that the packet is
associated with a connection which has seen pack- ets in
both directions, NEW meaning that the packet has started a
new connection, or otherwise associated with a connection
which has not seen packets in both directions, and RELATED
mean- ing that the packet is starting a new connection, but
is associ- ated with an existing connection, such as an FTP
data transfer, or an ICMP error. SNAT A virtual state,
matching if the origi- nal source address differs from the
reply destination. DNAT A virtual state, matching if the
original destination differs from the reply source.</p>

<p>--ctproto proto Protocol to match (by number or
name)</p>

<p>--ctorigsrc [!] address[/mask] Match against original
source address</p>

<p>--ctorigdst [!] address[/mask] Match against original
destination address</p>

<p>--ctreplsrc [!] address[/mask] Match against reply
source address</p>

<p>--ctrepldst [!] address[/mask] Match against reply
destination address</p>

<p>--ctstatus [NONE|EXPECTED|SEEN_REPLY|ASSURED][,...]
Match against internal conntrack states</p>

<p>--ctexpire time[:time] Match remaining lifetime in
seconds against given value or range of values
(inclusive)</p>

<p>dccp --source-port,--sport [!] port[:port]</p>

<p>--destination-port,--dport [!] port[:port]</p>

<p>--dccp-types [!] mask Match when the DCCP packet type is
one of mask . mask is a comma-separated list of packet
types. Packet types are: REQUEST RESPONSE DATA ACK DATAACK
CLOSEREQ CLOSE RESET SYNC SYNCACK INVALID.</p>

<p>--dccp-option [!] number Match if DCP option set.</p>

<p>dscp This module matches the 6 bit DSCP field within the
TOS field in the IP header. DSCP has superseded TOS within
the IETF.</p>

<p>--dscp value Match against a numeric (decimal or hex)
value [0-63].</p>

<p>--dscp-class DiffServ Class Match the DiffServ class.
This value may be any of the BE, EF, AFxx or CSx classes. It
will then be converted into its according numeric value.</p>

<p>dstlimit This module allows you to limit the packet per
second (pps) rate on a per destination IP or per destination
port base. As opposed to the limit match, every destination
ip / destination port has its own limit.</p>

<p>THIS MODULE IS DEPRECATED AND HAS BEEN REPLACED BY
hashlimit</p>

<p>--dstlimit avg Maximum average match rate (packets per
second unless followed by /sec /minute /hour /day
postfixes).</p>

<p>--dstlimit-mode mode The limiting hashmode. Is the
specified limit per dstip, dstip- dstport tuple, srcip-dstip
tuple, or per srcipdstip-dstport tuple.</p>

<p>--dstlimit-name name Name for /proc/net/ipt_dstlimit/*
file entry</p>

<p>[--dstlimit-burst burst] Number of packets to match in a
burst. Default: 5</p>

<p>[--dstlimit-htable-size size] Number of buckets in the
hashtable</p>

<p>[--dstlimit-htable-max max] Maximum number of entries in
the hashtable</p>

<p>[--dstlimit-htable-gcinterval interval] Interval between
garbage collection runs of the hashtable (in miliseconds).
Default is 1000 (1 second).</p>

<p>[--dstlimit-htable-expire time After which time are idle
entries expired from hashtable (in miliseconds)? Default is
10000 (10 seconds).</p>

<p>ecn This allows you to match the ECN bits of the IPv4
and TCP header. ECN is the Explicit Congestion Notification
mechanism as specified in RFC3168</p>

<p>--ecn-tcp-cwr This matches if the TCP ECN CWR
(Congestion Window Received) bit is set.</p>

<p>--ecn-tcp-ece This matches if the TCP ECN ECE (ECN Echo)
bit is set.</p>

<p>--ecn-ip-ect num This matches a particular IPv4 ECT
(ECN-Capable Transport). You have to specify a number
between 0 and 3.</p>

<p>esp This module matches the SPIs in ESP header of IPsec
packets.</p>

<p>--espspi [!] spi[:spi]</p>

<p>fuzzy This module matches a rate limit based on a fuzzy
logic controller [FLC]</p>

<p>--lower-limit number Specifies the lower limit (in
packets per second).</p>

<p>--upper-limit number Specifies the upper limit (in
packets per second).</p>

<p>hashlimit This patch adds a new match called hashlimit.
The idea is to have something like limit, but either per
destination-ip or per (des- tip,destport) tuple.</p>

<p>It gives you the ability to express</p>

<p>1000 packets per second for every host in
192.168.0.0/16</p>

<p>100 packets per second for every service of
192.168.1.1</p>

<p>with a single iptables rule.</p>

<p>--hashlimit rate A rate just like the limit match</p>

<p>--hashlimit-burst num Burst value, just like limit
match</p>

<p>--hashlimit-mode destip | destip-destport Limit per IP
or per port</p>

<p>--hashlimit-name foo The name for the
/proc/net/ipt_hashlimit/foo entry</p>

<p>--hashlimit-htable-size num The number of buckets of the
hash table</p>

<p>--hashlimit-htable-max num Maximum entries in the
hash</p>

<p>--hashlimit-htable-expire num After how many miliseconds
do hash entries expire</p>

<p>--hashlimit-htable-gcinterval num How many miliseconds
between garbage collection intervals</p>

<p>helper This module matches packets related to a specific
conntrack-helper.</p>

<p>--helper string Matches packets related to the specified
conntrack-helper.</p>

<p>string can be &quot;ftp&quot; for packets related to a
ftp-session on default port. For other ports append -portnr
to the value, ie. &quot;ftp-2121&quot;.</p>

<p>Same rules apply for other conntrack-helpers.</p>

<p>icmp This extension is loaded if --protocol icmp is
specified. It pro- vides the following option:</p>

<p>--icmp-type [!] typename This allows specification of
the ICMP type, which can be a numeric ICMP type, or one of
the ICMP type names shown by the command iptables -p icmp
-h</p>

<p>iprange This matches on a given arbitrary range of IPv4
addresses</p>

<p>[!]--src-range ip-ip Match source IP in the specified
range.</p>

<p>[!]--dst-range ip-ip Match destination IP in the
specified range.</p>

<p>ipv4options Match on IPv4 header options like source
routing, record route, times- tamp and router-alert.</p>

<p>--ssrr To match packets with the flag strict source
routing.</p>

<p>--lsrr To match packets with the flag loose source
routing.</p>

<p>--no-srr To match packets with no flag for source
routing.</p>

<p>[!] --rr To match packets with the RR flag.</p>

<p>[!] --ts To match packets with the TS flag.</p>

<p>[!] --ra To match packets with the router-alert
option.</p>

<p>[!] --any-opt To match a packet with at least one IP
option, or no IP option at all if ! is chosen.</p>

<p>Examples:</p>

<p>$ iptables -A input -m ipv4options --rr -j DROP will
drop packets with the record-route flag.</p>

<p>$ iptables -A input -m ipv4options --ts -j DROP will
drop packets with the timestamp flag.</p>

<p>length This module matches the length of a packet
against a specific value or range of values.</p>

<p>--length [!] length[:length]</p>

<p>limit This module matches at a limited rate using a
token bucket filter. A rule using this extension will match
until this limit is reached (unless the ! flag is used). It
can be used in combination with the LOG target to give
limited logging, for example.</p>

<p>--limit rate Maximum average matching rate: specified as
a number, with an optional /second, /minute, /hour, or /day
suffix; the default is 3/hour.</p>

<p>--limit-burst number Maximum initial number of packets
to match: this number gets recharged by one every time the
limit specified above is not reached, up to this number; the
default is 5.</p>

<p>mac --mac-source [!] address Match source MAC address.
It must be of the form XX:XX:XX:XX:XX:XX. Note that this
only makes sense for packets coming from an Ethernet device
and entering the PREROUTING, FOR- WARD or INPUT chains.</p>

<p>mark This module matches the netfilter mark field
associated with a packet (which can be set using the MARK
target below).</p>

<p>--mark value[/mask] Matches packets with the given
unsigned mark value (if a mask is specified, this is
logically ANDed with the mask before the com- parison).</p>

<p>mport This module matches a set of source or destination
ports. Up to 15 ports can be specified. It can only be used
in conjunction with -p tcp or -p udp.</p>

<p>--source-ports port[,port[,port...]] Match if the source
port is one of the given ports. The flag --sports is a
convenient alias for this option.</p>

<p>--destination-ports port[,port[,port...]] Match if the
destination port is one of the given ports. The flag
--dports is a convenient alias for this option.</p>

<p>--ports port[,port[,port...]] Match if the both the
source and destination ports are equal to each other and to
one of the given ports.</p>

<p>multiport This module matches a set of source or
destination ports. Up to 15 ports can be specified. A port
range (port:port) counts as two ports. It can only be used
in conjunction with -p tcp or -p udp.</p>

<p>--source-ports [!] port[,port[,port:port...]] Match if
the source port is one of the given ports. The flag --sports
is a convenient alias for this option.</p>

<p>--destination-ports [!] port[,port[,port:port...]] Match
if the destination port is one of the given ports. The flag
--dports is a convenient alias for this option.</p>

<p>--ports [!] port[,port[,port:port...]] Match if either
the source or destination ports are equal to one of the
given ports.</p>

<p>nth This module matches every nth packet</p>

<p>--every value Match every value packet</p>

<p>[--counter num] Use internal counter number num. Default
is 0.</p>

<p>[--start num] Initialize the counter at the number num
insetad of 0. Most between 0 and value-1.</p>

<p>[--packet num] Match on num packet. Most be between 0
and value -1.</p>

<p>osf The idea of passive OS fingerprint matching exists
for quite a long time, but was created as extension fo
OpenBSD pf only some weeks ago. Original idea was lurked in
some OpenBSD mailing list (thanks grange@open...) and than
adopted for Linux netfilter in form of this code.</p>

<p>Original fingerprint table was created by Michal
Zalewski &lt;lcamtuf@coredump.cx&gt;.</p>

<p>This module compares some data(WS, MSS, options and its
order, ttl, df and others) from first SYN packet (actually
from packets with SYN bit set) with dynamically loaded OS
fingerprints.</p>

<p>--log 1/0 If present, OSF will log determined genres
even if they dont match desired one. 0 - log all determined
entries, 1 - only first one.</p>

<p>In syslog you find something like this:</p>

<p>ipt_osf: Windows [2000:SP3:Windows XP Pro SP1, 2000
SP3]: 11.22.33.55:4024 -&gt; 11.22.33.44:139</p>

<p>ipt_osf: Unknown: 16384:106:1:48:020405B401010402
44.33.22.11:1239 -&gt; 11.22.33.44:80</p>

<p>--smart if present, OSF will use some smartness to
determine remote OS. OSF will use initial TTL only if source
of connection is in our local network.</p>

<p>--netlink If present, OSF will log all events also
through netlink NETLINK_NFLOG groupt 1.</p>

<p>--genre [!] string Match a OS genre by passive
fingerprinting</p>

<p>Example:</p>

<p>#iptables -I INPUT -j ACCEPT -p tcp -m osf --genre Linux
--log 1 --smart</p>

<p>NOTE: -p tcp is obviously required as it is a TCP
match.</p>

<p>Fingerprints can be loaded and read through
/proc/sys/net/ipv4/osf file. One can flush all fingerprints
with following command:</p>

<p>echo -en FLUSH &gt; /proc/sys/net/ipv4/osf</p>

<p>Only one fingerprint per open/write/close.</p>

<p>Fingerprints can be downloaded from
http://www.openbsd.org/cgi- bin/cvsweb/src/etc/pf.os</p>

<p>owner This module attempts to match various
characteristics of the packet creator, for locally-generated
packets. It is only valid in the OUTPUT chain, and even this
some packets (such as ICMP ping responses) may have no
owner, and hence never match.</p>

<p>--uid-owner userid Matches if the packet was created by
a process with the given effective user id.</p>

<p>--gid-owner groupid Matches if the packet was created by
a process with the given effective group id.</p>

<p>--pid-owner processid Matches if the packet was created
by a process with the given process id.</p>

<p>--sid-owner sessionid Matches if the packet was created
by a process in the given ses- sion group.</p>

<p>--cmd-owner name Matches if the packet was created by a
process with the given command name. (this option is present
only if iptables was com- piled under a kernel supporting
this feature)</p>

<p>NOTE: pid, sid and command matching are broken on
SMP</p>

<p>physdev This module matches on the bridge port input and
output devices enslaved to a bridge device. This module is a
part of the infrastruc- ture that enables a transparent
bridging IP firewall and is only useful for kernel versions
above version 2.5.44.</p>

<p>--physdev-in [!] name Name of a bridge port via which a
packet is received (only for packets entering the INPUT,
FORWARD and PREROUTING chains). If the interface name ends
in a &quot;+&quot;, then any interface which begins with
this name will match. If the packet didnt arrive through a
bridge device, this packet wont match this option, unless !
is used.</p>

<p>--physdev-out [!] name Name of a bridge port via which a
packet is going to be sent (for packets entering the
FORWARD, OUTPUT and POSTROUTING chains). If the interface
name ends in a &quot;+&quot;, then any inter- face which
begins with this name will match. Note that in the nat and
mangle OUTPUT chains one cannot match on the bridge out- put
port, however one can in the filter OUTPUT chain. If the
packet won t leave by a bridge device or it is yet unknown
what the output device will be, then the packet won t match
this option, unless</p>

<p>[!] --physdev-is-in Matches if the packet has entered
through a bridge interface.</p>

<p>[!] --physdev-is-out Matches if the packet will leave
through a bridge interface.</p>

<p>[!] --physdev-is-bridged Matches if the packet is being
bridged and therefore is not being routed. This is only
useful in the FORWARD and POSTROUT- ING chains.</p>

<p>pkttype This module matches the link-layer packet
type.</p>

<p>--pkt-type [unicast|broadcast|multicast]</p>

<p>policy This modules matches the policy used by IPsec for
handling a packet.</p>

<p>--dir in|out Used to select whether to match the policy
used for decapsula- tion or the policy that will be used for
encapsulation. in is valid in the PREROUTING, INPUT and
FORWARD chains, out is valid in the POSTROUTING, OUTPUT and
FORWARD chains.</p>

<p>--pol none|ipsec Matches if the packet is subject to
IPsec processing.</p>

<p>--strict Selects whether to match the exact policy or
match if any rule of the policy matches the given
policy.</p>

<p>--reqid id Matches the reqid of the policy rule. The
reqid can be specified with setkey(8) using unique:id as
level.</p>

<p>--spi spi Matches the SPI of the SA.</p>

<p>--proto ah|esp|ipcomp Matches the encapsulation
protocol.</p>

<p>--mode tunnel|transport Matches the encapsulation
mode.</p>

<p>--tunnel-src addr[/mask] Matches the source end-point
address of a tunnel mode SA. Only valid with --mode
tunnel.</p>

<p>--tunnel-dst addr[/mask] Matches the destination
end-point address of a tunnel mode SA. Only valid with
--mode tunnel.</p>

<p>--next Start the next element in the policy
specification. Can only be used with --strict</p>

<p>psd Attempt to detect TCP and UDP port scans. This match
was derived from Solar Designers scanlogd.</p>

<p>--psd-weight-threshold threshold Total weight of the
latest TCP/UDP packets with different desti- nation ports
coming from the same host to be treated as port scan
sequence.</p>

<p>--psd-delay-threshold delay Delay (in hundredths of
second) for the packets with different destination ports
coming from the same host to be treated as possible port
scan subsequence.</p>

<p>--psd-lo-ports-weight weight Weight of the packet with
privileged (&lt;=1024) destination port.</p>

<p>--psd-hi-ports-weight weight Weight of the packet with
non-priviliged destination port.</p>

<p>quota Implements network quotas by decrementing a byte
counter with each packet.</p>

<p>--quota bytes The quota in bytes.</p>

<p>KNOWN BUGS: this does not work on SMP systems.</p>

<p>random This module randomly matches a certain percentage
of all packets.</p>

<p>--average percent Matches the given percentage. If
omitted, a probability of 50% is set.</p>

<p>realm This matches the routing realm. Routing realms are
used in complex routing setups involving dynamic routing
protocols like BGP.</p>

<p>--realm [!]value[/mask] Matches a given realm number
(and optionally mask).</p>

<p>recent Allows you to dynamically create a list of IP
addresses and then match against that list in a few
different ways.</p>

<p>For example, you can create a badguy list out of people
attempting to connect to port 139 on your firewall and then
DROP all future packets from them without considering
them.</p>

<p>--name name Specify the list to use for the commands. If
no name is given then DEFAULT will be used.</p>

<p>[!] --set This will add the source address of the packet
to the list. If the source address is already in the list,
this will update the existing entry. This will always return
success (or failure if ! is passed in).</p>

<p>[!] --rcheck Check if the source address of the packet
is currently in the list.</p>

<p>[!] --update Like --rcheck, except it will update the
&quot;last seen&quot; timestamp if it matches.</p>

<p>[!] --remove Check if the source address of the packet
is currently in the list and if so that address will be
removed from the list and the rule will return true. If the
address is not found, false is returned.</p>

<p>[!] --seconds seconds This option must be used in
conjunction with one of --rcheck or --update. When used,
this will narrow the match to only happen when the address
is in the list and was seen within the last given number of
seconds.</p>

<p>[!] --hitcount hits This option must be used in
conjunction with one of --rcheck or --update. When used,
this will narrow the match to only happen when the address
is in the list and packets had been received greater than or
equal to the given value. This option may be used along with
--seconds to create an even narrower match requiring a
certain number of hits within a specific time frame.</p>

<p>--rttl This option must be used in conjunction with one
of --rcheck or --update. When used, this will narrow the
match to only happen when the address is in the list and the
TTL of the current packet matches that of the packet which
hit the --set rule. This may be useful if you have problems
with people faking their source address in order to DoS you
via this module by disallow- ing others access to your site
by sending bogus packets to you.</p>

<p>Examples:</p>

<p># iptables -A FORWARD -m recent --name badguy --rcheck
--seconds 60 -j DROP</p>

<p># iptables -A FORWARD -p tcp -i eth0 --dport 139 -m
recent --name badguy --set -j DROP</p>

<p>Official website
(http://snowman.net/projects/ipt_recent/) also has some
examples of usage.</p>

<p>/proc/net/ipt_recent/* are the current lists of
addresses and informa- tion about each entry of each
list.</p>

<p>Each file in /proc/net/ipt_recent/ can be read from to
see the current list or written two using the following
commands to modify the list:</p>

<p>echo xx.xx.xx.xx &gt; /proc/net/ipt_recent/DEFAULT to
Add to the DEFAULT list</p>

<p>echo -xx.xx.xx.xx &gt; /proc/net/ipt_recent/DEFAULT to
Remove from the DEFAULT list</p>

<p>echo clear &gt; /proc/net/ipt_recent/DEFAULT to empty
the DEFAULT list.</p>

<p>The module itself accepts parameters, defaults
shown:</p>

<p>ip_list_tot=100 Number of addresses remembered per
table</p>

<p>ip_pkt_list_tot=20 Number of packets per address
remembered</p>

<p>ip_list_hash_size=0 Hash table size. 0 means to
calculate it based on ip_list_tot, default: 512</p>

<p>ip_list_perms=0644 Permissions for
/proc/net/ipt_recent/* files</p>

<p>debug=0 Set to 1 to get lots of debugging info</p>

<p>sctp --source-port,--sport [!] port[:port]</p>

<p>--destination-port,--dport [!] port[:port]</p>

<p>--chunk-types [!] all|any|only chunktype[:flags] [...]
The flag letter in upper case indicates that the flag is to
match if set, in the lower case indicates to match if
unset.</p>

<p>Chunk types: DATA INIT INIT_ACK SACK HEARTBEAT
HEARTBEAT_ACK ABORT SHUTDOWN SHUTDOWN_ACK ERROR COOKIE_ECHO
COOKIE_ACK ECN_ECNE ECN_CWR SHUTDOWN_COMPLETE ASCONF
ASCONF_ACK</p>

<p>chunk type available flags DATA U B E u b e ABORT T t
SHUTDOWN_COMPLETE T t</p>

<p>(lowercase means flag should be &quot;off&quot;,
uppercase means &quot;on&quot;)</p>

<p>Examples:</p>

<p>iptables -A INPUT -p sctp --dport 80 -j DROP</p>

<p>iptables -A INPUT -p sctp --chunk-types any DATA,INIT -j
DROP</p>

<p>iptables -A INPUT -p sctp --chunk-types any DATA:Be -j
ACCEPT</p>

<p>set This modules macthes IP sets which can be defined by
ipset(8).</p>

<p>--set setname flag[,flag...] where flags are src and/or
dst and there can be no more than six of them. Hence the
command iptables -A FORWARD -m set --set test src,dst will
match packets, for which (depending on the type of the set)
the source address or port number of the packet can be found
in the specified set. If there is a binding belonging to the
mached set element or there is a default binding for the
given set, then the rule will match the packet only if
additionally (depending on the type of the set) the
destination address or port number of the packet can be
found in the set according to the binding.</p>

<p>state This module, when combined with connection
tracking, allows access to the connection tracking state for
this packet.</p>

<p>--state state Where state is a comma separated list of
the connection states to match. Possible states are INVALID
meaning that the packet could not be identified for some
reason which includes running out of memory and ICMP errors
which don t correspond to any known connection, ESTABLISHED
meaning that the packet is associ- ated with a connection
which has seen packets in both direc- tions, NEW meaning
that the packet has started a new connection, or otherwise
associated with a connection which has not seen packets in
both directions, and RELATED meaning that the packet is
starting a new connection, but is associated with an
existing connection, such as an FTP data transfer, or an
ICMP error.</p>

<p>statistic This module matches packets based on some
statistic condition. It sup- ports two distinct modes
settable with the --mode option.</p>

<p>Supported options:</p>

<p>--mode mode Set the matching mode of the matching rule,
supported modes are random and nth.</p>

<p>--probability p Set the probability from 0 to 1 for a
packet to be randomly matched. It works only with the random
mode.</p>

<p>--every n Match one packet every nth packet. It works
only with the nth mode (see also the --packet option).</p>

<p>--packet p Set the initial counter value (0 &lt;= p
&lt;= n-1, default 0) for the nth mode.</p>

<p>string This modules matches a given string by using some
pattern matching strategy. It requires a linux kernel &gt;=
2.6.14.</p>

<p>--algo bm|kmp Select the pattern matching strategy. (bm
= Boyer-Moore, kmp = Knuth-Pratt-Morris)</p>

<p>--from offset Set the offset from which it starts
looking for any matching. If not passed, default is 0.</p>

<p>--to offset Set the offset from which it starts looking
for any matching. If not passed, default is the packet
size.</p>

<p>--string pattern Matches the given pattern. --hex-string
pattern Matches the given pattern in hex notation.</p>

<p>tcp These extensions are loaded if --protocol tcp is
specified. It pro- vides the following options:</p>

<p>--source-port [!] port[:port] Source port or port range
specification. This can either be a service name or a port
number. An inclusive range can also be specified, using the
format port:port. If the first port is omitted,
&quot;0&quot; is assumed; if the last is omitted,
&quot;65535&quot; is assumed. If the second port greater
then the first they will be swapped. The flag --sport is a
convenient alias for this option.</p>

<p>--destination-port [!] port[:port] Destination port or
port range specification. The flag --dport is a convenient
alias for this option.</p>

<p>--tcp-flags [!] mask comp Match when the TCP flags are
as specified. The first argument is the flags which we
should examine, written as a comma-sepa- rated list, and the
second argument is a comma-separated list of flags which
must be set. Flags are: SYN ACK FIN RST URG PSH ALL NONE.
Hence the command iptables -A FORWARD -p tcp --tcp-flags
SYN,ACK,FIN,RST SYN will only match packets with the SYN
flag set, and the ACK, FIN and RST flags unset.</p>

<p>[!] --syn Only match TCP packets with the SYN bit set
and the ACK,RST and FIN bits cleared. Such packets are used
to request TCP connec- tion initiation; for example,
blocking such packets coming in an interface will prevent
incoming TCP connections, but outgoing TCP connections will
be unaffected. It is equivalent to --tcp- flags
SYN,RST,ACK,FIN SYN. If the &quot;!&quot; flag precedes the
&quot;--syn&quot;, the sense of the option is inverted.</p>

<p>--tcp-option [!] number Match if TCP option set.</p>

<p>--mss value[:value] Match TCP SYN or SYN/ACK packets
with the specified MSS value (or range), which control the
maximum packet size for that con- nection.</p>

<p>tcpmss This matches the TCP MSS (maximum segment size)
field of the TCP header. You can only use this on TCP SYN or
SYN/ACK packets, since the MSS is only negotiated during the
TCP handshake at connection startup time.</p>

<p>[!] --mss value[:value]&quot; Match a given TCP MSS
value or range.</p>

<p>time This matches if the packet arrival time/date is
within a given range. All options are facultative.</p>

<p>--timestart value Match only if it is after value
(Inclusive, format: HH:MM ; default 00:00).</p>

<p>--timestop value Match only if it is before value
(Inclusive, format: HH:MM ; default 23:59).</p>

<p>--days listofdays Match only if today is one of the
given days. (format: Mon,Tue,Wed,Thu,Fri,Sat,Sun ; default
everyday)</p>

<p>--datestart date Match only if it is after date
(Inclusive, format: YYYY[:MM[:DD[:hh[:mm[:ss]]]]] ; h,m,s
start from 0 ; default to 1970)</p>

<p>--datestop date Match only if it is before date
(Inclusive, format: YYYY[:MM[:DD[:hh[:mm[:ss]]]]] ; h,m,s
start from 0 ; default to 2037)</p>

<p>tos This module matches the 8 bits of Type of Service
field in the IP header (ie. including the precedence
bits).</p>

<p>--tos tos The argument is either a standard name, (use
iptables -m tos -h to see the list), or a numeric value to
match.</p>

<p>ttl This module matches the time to live field in the IP
header.</p>

<p>--ttl-eq ttl Matches the given TTL value.</p>

<p>--ttl-gt ttl Matches if TTL is greater than the given
TTL value.</p>

<p>--ttl-lt ttl Matches if TTL is less than the given TTL
value.</p>

<p>u32 U32 allows you to extract quantities of up to 4
bytes from a packet, AND them with specified masks, shift
them by specified amounts and test whether the results are
in any of a set of specified ranges. The spec- ification of
what to extract is general enough to skip over headers with
lengths stored in the packet, as in IP or TCP header
lengths.</p>

<p>Details and examples are in the kernel module
source.</p>

<p>udp These extensions are loaded if --protocol udp is
specified. It pro- vides the following options:</p>

<p>--source-port [!] port[:port] Source port or port range
specification. See the description of the --source-port
option of the TCP extension for details.</p>

<p>--destination-port [!] port[:port] Destination port or
port range specification. See the descrip- tion of the
--destination-port option of the TCP extension for
details.</p>

<p>unclean This module takes no options, but attempts to
match packets which seem malformed or unusual. This is
regarded as experimental.</p>

<p>TARGET EXTENSIONS iptables can use extended target
modules: the following are included in the standard
distribution.</p>

<p>BALANCE This allows you to DNAT connections in a
round-robin way over a given range of destination
addresses.</p>

<p>--to-destination ipaddr-ipaddr Address range to
round-robin over.</p>

<p>CLASSIFY This module allows you to set the
skb-&gt;priority value (and thus clas- sify the packet into
a specific CBQ class).</p>

<p>--set-class MAJOR:MINOR Set the major and minor class
value.</p>

<p>CLUSTERIP This module allows you to configure a simple
cluster of nodes that share a certain IP and MAC address
without an explicit load balancer in front of them.
Connections are statically distributed between the nodes in
this cluster.</p>

<p>--new Create a new ClusterIP. You always have to set
this on the first rule for a given ClusterIP.</p>

<p>--hashmode mode Specify the hashing mode. Has to be one
of sourceip, sourceip- sourceport,
sourceip-sourceport-destport</p>

<p>--clustermac mac Specify the ClusterIP MAC address. Has
to be a link-layer mul- ticast address</p>

<p>--total-nodes num Number of total nodes within this
cluster.</p>

<p>--local-node num Local node number within this
cluster.</p>

<p>--hash-init rnd Specify the random seed used for hash
initialization.</p>

<p>CONNMARK This module sets the netfilter mark value
associated with a connection</p>

<p>--set-mark mark[/mask] Set connection mark. If a mask is
specified then only those bits set in the mask is
modified.</p>

<p>--save-mark [--mask mask] Copy the netfilter packet mark
value to the connection mark. If a mask is specified then
only those bits are copied.</p>

<p>--restore-mark [--mask mask] Copy the connection mark
value to the packet. If a mask is spec- ified then only
those bits are copied. This is only valid in the mangle
table.</p>

<p>DNAT This target is only valid in the nat table, in the
PREROUTING and OUT- PUT chains, and user-defined chains
which are only called from those chains. It specifies that
the destination address of the packet should be modified
(and all future packets in this connection will also be
mangled), and rules should cease being examined. It takes
one type of option:</p>

<p>--to-destination ipaddr[-ipaddr][:port-port] which can
specify a single new destination IP address, an inclu- sive
range of IP addresses, and optionally, a port range (which
is only valid if the rule also specifies -p tcp or -p udp).
If no port range is specified, then the destination port
will never be modified.</p>

<p>In Kernels up to 2.6.10 you can add several
--to-destination options. For those kernels, if you specify
more than one desti- nation address, either via an address
range or multiple --to- destination options, a simple
round-robin (one after another in cycle) load balancing
takes place between these addresses. Later Kernels (&gt;=
2.6.11-rc1) dont have the ability to NAT to multiple ranges
anymore.</p>

<p>DSCP This target allows to alter the value of the DSCP
bits within the TOS header of the IPv4 packet. As this
manipulates a packet, it can only be used in the mangle
table.</p>

<p>--set-dscp value Set the DSCP field to a numerical value
(can be decimal or hex)</p>

<p>--set-dscp-class class Set the DSCP field to a DiffServ
class.</p>

<p>ECN This target allows to selectively work around known
ECN blackholes. It can only be used in the mangle table.</p>

<p>--ecn-tcp-remove Remove all ECN bits from the TCP
header. Of course, it can only be used in conjunction with
-p tcp.</p>

<p>IPMARK Allows you to mark a received packet basing on
its IP address. This can replace many mangle/mark entries
with only one, if you use firewall based classifier.</p>

<p>This target is to be used inside the mangle table, in
the PREROUTING, POSTROUTING or FORWARD hooks.</p>

<p>--addr src/dst Use source or destination IP address.</p>

<p>--and-mask mask Perform bitwise and on the IP address
and this mask.</p>

<p>--or-mask mask Perform bitwise or on the IP address and
this mask.</p>

<p>The order of IP address bytes is reversed to meet
&quot;human order of bytes&quot;: 192.168.0.1 is 0xc0a80001.
At first the and operation is per- formed, then or.</p>

<p>Examples:</p>

<p>We create a queue for each user, the queue number is
adequate to the IP address of the user, e.g.: all packets
going to/from 192.168.5.2 are directed to 1:0502 queue,
192.168.5.12 -&gt; 1:050c etc.</p>

<p>We have one classifier rule:</p>

<p>tc filter add dev eth3 parent 1:0 protocol ip fw</p>

<p>Earlier we had many rules just like below:</p>

<p>iptables -t mangle -A POSTROUTING -o eth3 -d 192.168.5.2
-j MARK --set-mark 0x10502</p>

<p>iptables -t mangle -A POSTROUTING -o eth3 -d 192.168.5.3
-j MARK --set-mark 0x10503</p>

<p>Using IPMARK target we can replace all the mangle/mark
rules with only one:</p>

<p>iptables -t mangle -A POSTROUTING -o eth3 -j IPMARK
--addr=dst --and-mask=0xffff --or-mask=0x10000</p>

<p>On the routers with hundreds of users there should be
significant load decrease (e.g. twice).</p>

<p>IPV4OPTSSTRIP Strip all the IP options from a
packet.</p>

<p>The target doesnt take any option, and therefore is
extremly easy to use :</p>

<p># iptables -t mangle -A PREROUTING -j IPV4OPTSSTRIP</p>

<p>LOG Turn on kernel logging of matching packets. When
this option is set for a rule, the Linux kernel will print
some information on all match- ing packets (like most IP
header fields) via the kernel log (where it can be read with
dmesg or syslogd(8)). This is a &quot;non-terminating tar-
get&quot;, i.e. rule traversal continues at the next rule.
So if you want to LOG the packets you refuse, use two
separate rules with the same matching criteria, first using
target LOG then DROP (or REJECT).</p>

<p>--log-level level Level of logging (numeric or see
syslog.conf(5)).</p>

<p>--log-prefix prefix Prefix log messages with the
specified prefix; up to 29 letters long, and useful for
distinguishing messages in the logs.</p>

<p>--log-tcp-sequence Log TCP sequence numbers. This is a
security risk if the log is readable by users.</p>

<p>--log-tcp-options Log options from the TCP packet
header.</p>

<p>--log-ip-options Log options from the IP packet
header.</p>

<p>--log-uid Log the userid of the process which generated
the packet.</p>

<p>MARK This is used to set the netfilter mark value
associated with the packet. It is only valid in the mangle
table. It can for example be used in conjunction with
iproute2.</p>

<p>--set-mark mark</p>

<p>MASQUERADE This target is only valid in the nat table,
in the POSTROUTING chain. It should only be used with
dynamically assigned IP (dialup) connec- tions: if you have
a static IP address, you should use the SNAT target.
Masquerading is equivalent to specifying a mapping to the IP
address of the interface the packet is going out, but also
has the effect that connections are forgotten when the
interface goes down. This is the correct behavior when the
next dialup is unlikely to have the same interface address
(and hence any established connections are lost any- way).
It takes one option:</p>

<p>--to-ports port[-port] This specifies a range of source
ports to use, overriding the default SNAT source
port-selection heuristics (see above). This is only valid if
the rule also specifies -p tcp or -p udp.</p>

<p>MIRROR This is an experimental demonstration target
which inverts the source and destination fields in the IP
header and retransmits the packet. It is only valid in the
INPUT, FORWARD and PREROUTING chains, and user- defined
chains which are only called from those chains. Note that
the outgoing packets are NOT seen by any packet filtering
chains, connec- tion tracking or NAT, to avoid loops and
other problems.</p>

<p>NETMAP This target allows you to statically map a whole
network of addresses onto another network of addresses. It
can only be used from rules in the nat table.</p>

<p>--to address[/mask] Network address to map to. The
resulting address will be con- structed in the following
way: All one bits in the mask are filled in from the new
address. All bits that are zero in the mask are filled in
from the original address.</p>

<p>NFQUEUE This target is an extension of the QUEUE target.
As opposed to QUEUE, it allows you to put a packet into any
specific queue, identified by its 16-bit queue number.</p>

<p>--queue-num value This specifies the QUEUE number to
use. Valud queue numbers are 0 to 65535. The default value
is 0.</p>

<p>It can only be used with Kernel versions 2.6.14 or
later, since it requires the nfnetlink_queue kernel
support.</p>

<p>NOTRACK This target disables connection tracking for all
packets matching that rule.</p>

<p>It can only be used in the raw table.</p>

<p>REDIRECT This target is only valid in the nat table, in
the PREROUTING and OUT- PUT chains, and user-defined chains
which are only called from those chains. It redirects the
packet to the machine itself by changing the destination IP
to the primary address of the incoming interface
(locally-generated packets are mapped to the 127.0.0.1
address). It takes one option:</p>

<p>--to-ports port[-port] This specifies a destination port
or range of ports to use: without this, the destination port
is never altered. This is only valid if the rule also
specifies -p tcp or -p udp.</p>

<p>REJECT This is used to send back an error packet in
response to the matched packet: otherwise it is equivalent
to DROP so it is a terminating TAR- GET, ending rule
traversal. This target is only valid in the INPUT, FORWARD
and OUTPUT chains, and user-defined chains which are only
called from those chains. The following option controls the
nature of the error packet returned:</p>

<p>--reject-with type The type given can be
icmp-net-unreachable icmp-host-unreachable
icmp-port-unreachable icmp-proto-unreachable
icmp-net-prohibited icmp-host-prohibited or
icmp-admin-prohibited (*) which return the appropriate ICMP
error message (port-unreach- able is the default). The
option tcp-reset can be used on rules which only match the
TCP protocol: this causes a TCP RST packet to be sent back.
This is mainly useful for blocking ident (113/tcp) probes
which frequently occur when sending mail to broken mail
hosts (which won t accept your mail otherwise).</p>

<p>(*) Using icmp-admin-prohibited with kernels that do not
support it will result in a plain DROP instead of REJECT</p>

<p>SAME Similar to SNAT/DNAT depending on chain: it takes a
range of addresses ( --to 1.2.3.4-1.2.3.7 ) and gives a
client the same source-/destina- tion-address for each
connection.</p>

<p>--to &lt;ipaddr&gt;-&lt;ipaddr&gt; Addresses to map
source to. May be specified more than once for multiple
ranges.</p>

<p>--nodst Don t use the destination-ip in the calculations
when selecting the new source-ip</p>

<p>SET This modules adds and/or deletes entries from IP
sets which can be defined by ipset(8).</p>

<p>--add-set setname flag[,flag...] add the
address(es)/port(s) of the packet to the sets</p>

<p>--del-set setname flag[,flag...] delete the
address(es)/port(s) of the packet from the sets, where flags
are src and/or dst and there can be no more than six of
them.</p>

<p>The bindings to follow must previously be defined in
order to use multilevel adding/deleting by the SET
target.</p>

<p>SNAT This target is only valid in the nat table, in the
POSTROUTING chain. It specifies that the source address of
the packet should be modified (and all future packets in
this connection will also be mangled), and rules should
cease being examined. It takes one type of option:</p>

<p>--to-source ipaddr[-ipaddr][:port-port] which can
specify a single new source IP address, an inclusive range
of IP addresses, and optionally, a port range (which is only
valid if the rule also specifies -p tcp or -p udp). If no
port range is specified, then source ports below 512 will be
mapped to other ports below 512: those between 512 and 1023
inclusive will be mapped to ports below 1024, and other
ports will be mapped to 1024 or above. Where possible, no
port alter- ation will occur.</p>

<p>In Kernels up to 2.6.10, you can add several --to-source
options. For those kernels, if you specify more than one
source address, either via an address range or multiple
--to-source options, a simple round-robin (one after another
in cycle) takes place between these addresses. Later Kernels
(&gt;= 2.6.11-rc1) don t have the ability to NAT to multiple
ranges anymore.</p>

<p>TARPIT Captures and holds incoming TCP connections using
no local per-connec- tion resources. Connections are
accepted, but immediately switched to the persist state (0
byte window), in which the remote side stops send- ing data
and asks to continue every 60-240 seconds. Attempts to close
the connection are ignored, forcing the remote side to time
out the connection in 12-24 minutes.</p>

<p>This offers similar functionality to LaBrea
&lt;http://www.hack- busters.net/LaBrea/&gt; but doesnt
require dedicated hardware or IPs. Any TCP port that you
would normally DROP or REJECT can instead become a
tarpit.</p>

<p>To tarpit connections to TCP port 80 destined for the
current machine:</p>

<p>iptables -A INPUT -p tcp -m tcp --dport 80 -j TARPIT</p>

<p>To significantly slow down Code Red/Nimda-style scans of
unused address space, forward unused ip addresses to a Linux
box not acting as a router (e.g. &quot;ip route 10.0.0.0
255.0.0.0 ip.of.linux.box&quot; on a Cisco), enable IP
forwarding on the Linux box, and add:</p>

<p>iptables -A FORWARD -p tcp -j TARPIT</p>

<p>iptables -A FORWARD -j DROP</p>

<p>NOTE: If you use the conntrack module while you are
using TARPIT, you should also use the NOTRACK target, or the
kernel will unneces- sarily allocate resources for each
TARPITted connection. To TARPIT incoming connections to the
standard IRC port while using conntrack, you could:</p>

<p>iptables -t raw -A PREROUTING -p tcp --dport 6667 -j
NOTRACK</p>

<p>iptables -A INPUT -p tcp --dport 6667 -j TARPIT</p>

<p>TCPMSS This target allows to alter the MSS value of TCP
SYN packets, to con- trol the maximum size for that
connection (usually limiting it to your outgoing interfaces
MTU minus 40). Of course, it can only be used in conjunction
with -p tcp. It is only valid in the mangle table. This
target is used to overcome criminally braindead ISPs or
servers which block ICMP Fragmentation Needed packets. The
symptoms of this problem are that everything works fine from
your Linux firewall/router, but machines behind it can never
exchange large packets: 1) Web browsers connect, then hang
with no data received. 2) Small mail works fine, but large
emails hang. 3) ssh works fine, but scp hangs after initial
handshaking. Workaround: activate this option and add a rule
to your firewall con- figuration like: iptables -t mangle -A
FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS
--clamp-mss-to-pmtu</p>

<p>--set-mss value Explicitly set MSS option to specified
value.</p>

<p>--clamp-mss-to-pmtu Automatically clamp MSS value to
(path_MTU - 40).</p>

<p>These options are mutually exclusive.</p>

<p>TOS This is used to set the 8-bit Type of Service field
in the IP header. It is only valid in the mangle table.</p>

<p>--set-tos tos You can use a numeric TOS values, or use
iptables -j TOS -h to see the list of valid TOS names.</p>

<p>TRACE This target has no options. It just turns on
packet tracing for all packets that match this rule.</p>

<p>TTL This is used to modify the IPv4 TTL header field.
The TTL field deter- mines how many hops (routers) a packet
can traverse until its time to live is exceeded.</p>

<p>Setting or incrementing the TTL field can potentially be
very danger- ous, so it should be avoided at any cost.</p>

<p>Dot ever set or increment the value on packets that
leave your local network! mangle table.</p>

<p>--ttl-set value Set the TTL value to value.</p>

<p>--ttl-dec value Decrement the TTL value value times.</p>

<p>--ttl-inc value Increment the TTL value value times.</p>

<p>ULOG This target provides userspace logging of matching
packets. When this target is set for a rule, the Linux
kernel will multicast this packet through a netlink socket.
One or more userspace processes may then sub- scribe to
various multicast groups and receive the packets. Like LOG,
this is a &quot;non-terminating target&quot;, i.e. rule
traversal continues at the next rule.</p>

<p>--ulog-nlgroup nlgroup This specifies the netlink group
(1-32) to which the packet is sent. Default value is 1.</p>

<p>--ulog-prefix prefix Prefix log messages with the
specified prefix; up to 32 charac- ters long, and useful for
distinguishing messages in the logs.</p>

<p>--ulog-cprange size Number of bytes to be copied to
userspace. A value of 0 always copies the entire packet,
regardless of its size. Default is 0.</p>

<p>--ulog-qthreshold size Number of packet to queue inside
kernel. Setting this value to, e.g. 10 accumulates ten
packets inside the kernel and transmits them as one netlink
multipart message to userspace. Default is 1 (for backwards
compatibility).</p>

<p>XOR Encrypt TCP and UDP traffic using a simple XOR
encryption</p>

<p>--key string Set key to &quot;string&quot;</p>

<p>--block-size Set block size</p>

<p>DIAGNOSTICS Various error messages are printed to
standard error. The exit code is 0 for correct functioning.
Errors which appear to be caused by invalid or abused
command line parameters cause an exit code of 2, and other
errors cause an exit code of 1.</p>

<p>BUGS Bugs? Whats this? ;-) Well, you might want to have
a look at http://bugzilla.netfilter.org/</p>

<p>COMPATIBILITY WITH IPCHAINS This iptables is very
similar to ipchains by Rusty Russell. The main difference is
that the chains INPUT and OUTPUT are only traversed for
packets coming into the local host and originating from the
local host respectively. Hence every packet only passes
through one of the three chains (except loopback traffic,
which involves both INPUT and OUTPUT chains); previously a
forwarded packet would pass through all three.</p>

<p>The other main difference is that -i refers to the input
interface; -o refers to the output interface, and both are
available for packets entering the FORWARD chain.</p>

<p>iptables is a pure packet filter when using the default
filter table, with optional extension modules. This should
simplify much of the pre- vious confusion over the
combination of IP masquerading and packet fil- tering seen
previously. So the following options are handled differ-
ently: -j MASQ -M -S -M -L There are several other changes
in iptables.</p>

<p>SEE ALSO iptables-save(8), iptables-restore(8),
ip6tables(8), ip6tables-save(8), ip6tables-restore(8),
libipq(3).</p>

<p>The packet-filtering-HOWTO details iptables usage for
packet filtering, the NAT-HOWTO details NAT, the
netfilter-extensions-HOWTO details the extensions that are
not in the standard distribution, and the netfil-
ter-hacking-HOWTO details the netfilter internals. See
http://www.netfilter.org/.</p>

<p>AUTHORS Rusty Russell originally wrote iptables, in
early consultation with Michael Neuling.</p>

<p>Marc Boucher made Rusty abandon ipnatctl by lobbying for
a generic packet selection framework in iptables, then wrote
the mangle table, the owner match, the mark stuff, and ran
around doing cool stuff every- where.</p>

<p>James Morris wrote the TOS target, and tos match.</p>

<p>Jozsef Kadlecsik wrote the REJECT target.</p>

<p>Harald Welte wrote the ULOG and NFQUEUE target, the new
libiptc, as well as the TTL, DSCP, ECN matches and
targets.</p>

<p>The Netfilter Core Team is: Marc Boucher, Martin
Josefsson, Jozsef Kadlecsik, Patrick McHardy, James Morris,
Harald Welte and Rusty Rus- sell.</p>

<p>Man page originally written by Herve Eychenne
&lt;rv@wallfire.org&gt;.</p>

<p>Mar 09, 2002 IPTABLES(8)</p>
<hr>
</body>
</html>
