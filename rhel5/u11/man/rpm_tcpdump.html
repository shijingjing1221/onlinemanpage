<!-- Creator     : groff version 1.18.1.1 -->
<!-- CreationDate: Sat Nov 12 05:25:12 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>RPM(8) Red Hat Linux RPM(8)</p>

<p>NAME rpm - RPM Package Manager</p>

<p>SYNOPSIS QUERYING AND VERIFYING PACKAGES: rpm
{-q|--query} [select-options] [query-options]</p>

<p>rpm {-V|--verify} [select-options] [verify-options]</p>

<p>rpm --import PUBKEY ...</p>

<p>rpm {-K|--checksig} [--nosignature] [--nodigest]
PACKAGE_FILE ...</p>

<p>INSTALLING, UPGRADING, AND REMOVING PACKAGES: rpm
{-i|--install} [install-options] PACKAGE_FILE ...</p>

<p>rpm {-U|--upgrade} [install-options] PACKAGE_FILE
...</p>

<p>rpm {-F|--freshen} [install-options] PACKAGE_FILE
...</p>

<p>rpm {-e|--erase} [--allmatches] [--nodeps] [--noscripts]
[--notriggers] [--repackage] [--test] PACKAGE_NAME ...</p>

<p>MISCELLANEOUS: rpm {--initdb|--rebuilddb}</p>

<p>rpm {--addsign|--resign} PACKAGE_FILE ...</p>

<p>rpm {--querytags|--showrc}</p>

<p>rpm {--setperms|--setugids} PACKAGE_NAME ...</p>

<p>select-options [PACKAGE_NAME] [-a,--all] [-f,--file
FILE] [-g,--group GROUP] {-p,--package PACKAGE_FILE]
[--fileid MD5] [--hdrid SHA1] [--pkgid MD5] [--tid TID]
[--querybynumber HDRNUM] [--triggeredby PACKAGE_NAME]
[--whatprovides CAPABILITY] [--whatrequires CAPABILITY]</p>

<p>query-options [--changelog] [-c,--configfiles]
[-d,--docfiles] [--dump] [--filesbypkg] [-i,--info] [--last]
[-l,--list] [--provides] [--qf,--queryformat QUERYFMT]
[-R,--requires] [--scripts] [-s,--state]
[--triggers,--triggerscripts]</p>

<p>verify-options [--nodeps] [--nofiles] [--noscripts]
[--nodigest] [--nosignature] [--nolinkto] [--nomd5]
[--nosize] [--nouser] [--nogroup] [--nomtime] [--nomode]
[--nordev]</p>

<p>install-options [--aid] [--allfiles] [--badreloc]
[--excludepath OLDPATH] [--excludedocs] [--force]
[-h,--hash] [--ignoresize] [--ignorearch] [--ignoreos]
[--includedocs] [--justdb] [--nodeps] [--nodigest]
[--nosignature] [--nosuggest] [--noorder] [--noscripts]
[--notriggers] [--oldpackage] [--percent] [--prefix NEWPATH]
[--relocate OLDPATH=NEWPATH] [--repackage] [--replacefiles]
[--replacepkgs] [--test]</p>

<p>DESCRIPTION rpm is a powerful Package Manager, which can
be used to build, install, query, verify, update, and erase
individual software packages. A pack- age consists of an
archive of files and meta-data used to install and erase the
archive files. The meta-data includes helper scripts, file
attributes, and descriptive information about the package.
Packages come in two varieties: binary packages, used to
encapsulate software to be installed, and source packages,
containing the source code and recipe necessary to produce
binary packages.</p>

<p>One of the following basic modes must be selected:
Query, Verify, Sig- nature Check, Install/Upgrade/Freshen,
Uninstall, Initialize Database, Rebuild Database, Resign,
Add Signature, Set Owners/Groups, Show Query- tags, and Show
Configuration.</p>

<p>GENERAL OPTIONS These options can be used in all the
different modes.</p>

<p>-?, --help Print a longer usage message then normal.</p>

<p>--version Print a single line containing the version
number of rpm being used.</p>

<p>--quiet Print as little as possible - normally only
error messages will be displayed.</p>

<p>-v Print verbose information - normally routine progress
messages will be displayed.</p>

<p>-vv Print lots of ugly debugging information.</p>

<p>--rcfile FILELIST Each of the files in the colon
separated FILELIST is read sequentially by rpm for
configuration information. Only the first file in the list
must exist, and tildes will be expanded to the value of
$HOME. The default FILELIST is
/usr/lib/rpm/rpmrc:/usr/lib/rpm/red-
hat/rpmrc:/etc/rpmrc:~/.rpmrc.</p>

<p>--pipe CMD Pipes the output of rpm to the command
CMD.</p>

<p>--dbpath DIRECTORY Use the database in DIRECTORY rather
than the default path /var/lib/rpm</p>

<p>--root DIRECTORY Use the file system tree rooted at
DIRECTORY for all operations. Note that this means the
database within DIRECTORY will be used for dependency checks
and any scriptlet(s) (e.g. %post if installing, or %prep if
building, a package) will be run after a chroot(2) to
DIRECTORY.</p>

<p>-D, --defineMACRO EXPR Defines MACRO with value
EXPR.</p>

<p>-E, --evalEXPR Prints macro expansion of EXPR.</p>

<p>INSTALL AND UPGRADE OPTIONS The general form of an rpm
install command is</p>

<p>rpm {-i|--install} [install-options] PACKAGE_FILE
...</p>

<p>This installs a new package.</p>

<p>The general form of an rpm upgrade command is</p>

<p>rpm {-U|--upgrade} [install-options] PACKAGE_FILE
...</p>

<p>This upgrades or installs the package currently
installed to a newer version. This is the same as install,
except all other version(s) of the package are removed after
the new package is installed.</p>

<p>rpm {-F|--freshen} [install-options] PACKAGE_FILE
...</p>

<p>This will upgrade packages, but only if an earlier
version currently exists. The PACKAGE_FILE may be specified
as an ftp or http URL, in which case the package will be
downloaded before being installed. See FTP/HTTP OPTIONS for
information on rpms internal ftp and http client
support.</p>

<p>--aid Add suggested packages to the transaction set when
needed.</p>

<p>--allfiles Installs or upgrades all the missingok files
in the package, regardless if they exist.</p>

<p>--badreloc Used with --relocate, permit relocations on
all file paths, not just those OLDPATHs included in the
binary package relocation hint(s).</p>

<p>--excludepath OLDPATH Dont install files whose name
begins with OLDPATH.</p>

<p>--excludedocs Don t install any files which are marked
as documentation (which includes man pages and texinfo
documents).</p>

<p>--force Same as using --replacepkgs, --replacefiles, and
--oldpackage.</p>

<p>-h, --hash Print 50 hash marks as the package archive is
unpacked. Use with -v|--verbose for a nicer display.</p>

<p>--ignoresize Dont check mount file systems for
sufficient disk space before installing this package.</p>

<p>--ignorearch Allow installation or upgrading even if the
architectures of the binary package and host dont match.</p>

<p>--ignoreos Allow installation or upgrading even if the
operating systems of the binary package and host dont
match.</p>

<p>--includedocs Install documentation files. This is the
default behavior.</p>

<p>--justdb Update only the database, not the
filesystem.</p>

<p>--nodigest Dont verify package or header digests when
reading.</p>

<p>--nosignature Don t verify package or header signatures
when reading.</p>

<p>--nodeps Dont do a dependency check before installing or
upgrading a package.</p>

<p>--nosuggest Don t suggest package(s) that provide a
missing dependency.</p>

<p>--noorder Dont reorder the packages for an install. The
list of packages would normally be reordered to satisfy
dependencies.</p>

<p>--noscripts</p>

<p>--nopre</p>

<p>--nopost</p>

<p>--nopreun</p>

<p>--nopostun Dont execute the scriptlet of the same name.
The --noscripts option is equivalent to</p>

<p>--nopre --nopost --nopreun --nopostun</p>

<p>and turns off the execution of the corresponding %pre,
%post, %preun, and %postun scriptlet(s).</p>

<p>--notriggers</p>

<p>--notriggerin</p>

<p>--notriggerun</p>

<p>--notriggerpostun Dont execute any trigger scriptlet of
the named type. The --notriggers option is equivalent to</p>

<p>--notriggerin --notriggerun --notriggerpostun</p>

<p>and turns off execution of the corresponding %triggerin,
%trig- gerun, and %triggerpostun scriptlet(s).</p>

<p>--oldpackage Allow an upgrade to replace a newer package
with an older one.</p>

<p>--percent Print percentages as files are unpacked from
the package archive. This is intended to make rpm easy to
run from other tools.</p>

<p>--prefix NEWPATH For relocatable binary packages,
translate all file paths that start with the installation
prefix in the package relocation hint(s) to NEWPATH.</p>

<p>--relocate OLDPATH=NEWPATH For relocatable binary
packages, translate all file paths that start with OLDPATH
in the package relocation hint(s) to NEWPATH. This option
can be used repeatedly if several OLDPATHs in the package
are to be relocated.</p>

<p>--repackage Re-package the files before erasing. The
previously installed package will be named according to the
macro %_repack- age_name_fmt and will be created in the
directory named by the macro %_repackage_dir (default value
is /var/spool/repackage).</p>

<p>--replacefiles Install the packages even if they replace
files from other, already installed, packages.</p>

<p>--replacepkgs Install the packages even if some of them
are already installed on this system.</p>

<p>--test Do not install the package, simply check for and
report poten- tial conflicts.</p>

<p>ERASE OPTIONS The general form of an rpm erase command
is</p>

<p>rpm {-e|--erase} [--allmatches] [--nodeps] [--noscripts]
[--notriggers] [--repackage] [--test] PACKAGE_NAME ...</p>

<p>The following options may also be used:</p>

<p>--allmatches Remove all versions of the package which
match PACKAGE_NAME. Normally an error is issued if
PACKAGE_NAME matches multiple packages.</p>

<p>--nodeps Dont check dependencies before uninstalling the
packages.</p>

<p>--noscripts</p>

<p>--nopreun</p>

<p>--nopostun Don t execute the scriptlet of the same name.
The --noscripts option during package erase is equivalent
to</p>

<p>--nopreun --nopostun</p>

<p>and turns off the execution of the corresponding %preun,
and %postun scriptlet(s).</p>

<p>--notriggers</p>

<p>--notriggerun</p>

<p>--notriggerpostun Don t execute any trigger scriptlet of
the named type. The --notriggers option is equivalent to</p>

<p>--notriggerun --notriggerpostun</p>

<p>and turns off execution of the corresponding %triggerun,
and %triggerpostun scriptlet(s).</p>

<p>--repackage Re-package the files before erasing. The
previously installed package will be named according to the
macro %_repack- age_name_fmt and will be created in the
directory named by the macro %_repackage_dir (default value
is /var/spool/repackage).</p>

<p>--test Dont really uninstall anything, just go through
the motions. Useful in conjunction with the -vv option for
debugging.</p>

<p>QUERY OPTIONS The general form of an rpm query command
is</p>

<p>rpm {-q|--query} [select-options] [query-options]</p>

<p>You may specify the format that package information
should be printed in. To do this, you use the</p>

<p>--qf|--queryformat QUERYFMT</p>

<p>option, followed by the QUERYFMT format string. Query
formats are mod- ified versions of the standard printf(3)
formatting. The format is made up of static strings (which
may include standard C character escapes for newlines, tabs,
and other special characters) and printf(3) type formatters.
As rpm already knows the type to print, the type specifier
must be omitted however, and replaced by the name of the
header tag to be printed, enclosed by {} characters. Tag
names are case insensitive, and the leading RPMTAG_ portion
of the tag name may be omitted as well.</p>

<p>Alternate output formats may be requested by following
the tag with :typetag. Currently, the following types are
supported:</p>

<p>:armor Wrap a public key in ASCII armor.</p>

<p>:base64 Encode binary data using base64.</p>

<p>:date Use strftime(3) &quot;%c&quot; format.</p>

<p>:day Use strftime(3) &quot;%a %b %d %Y&quot; format.</p>

<p>:depflags Format dependency flags.</p>

<p>:fflags Format file flags.</p>

<p>:hex Format in hexadecimal.</p>

<p>:octal Format in octal.</p>

<p>:perms Format file permissions.</p>

<p>:shescape Escape single quotes for use in a script.</p>

<p>:triggertype Display trigger suffix.</p>

<p>For example, to print only the names of the packages
queried, you could use %{NAME} as the format string. To
print the packages name and dis- tribution information in
two columns, you could use %-30{NAME}%{DISTRI- BUTION}. rpm
will print a list of all of the tags it knows about when it
is invoked with the --querytags argument.</p>

<p>There are two subsets of options for querying: package
selection, and information selection.</p>

<p>PACKAGE SELECTION OPTIONS: PACKAGE_NAME Query installed
package named PACKAGE_NAME.</p>

<p>-a, --all Query all installed packages.</p>

<p>-f, --file FILE Query package owning FILE.</p>

<p>--fileid MD5 Query package that contains a given file
identifier, i.e. the MD5 digest of the file contents.</p>

<p>-g, --group GROUP Query packages with the group of
GROUP.</p>

<p>--hdrid SHA1 Query package that contains a given header
identifier, i.e. the SHA1 digest of the immutable header
region.</p>

<p>-p, --package PACKAGE_FILE Query an (uninstalled)
package PACKAGE_FILE. The PACKAGE_FILE may be specified as
an ftp or http style URL, in which case the package header
will be downloaded and queried. See FTP/HTTP OPTIONS for
information on rpms internal ftp and http client support.
The PACKAGE_FILE argument(s), if not a binary package, will
be interpreted as an ASCII package manifest. Comments are
permitted, starting with a #, and each line of a package
mani- fest file may include white space separated glob
expressions, including URLs with remote glob expressions,
that will be expanded to paths that are substituted in place
of the package manifest as additional PACKAGE_FILE arguments
to the query.</p>

<p>--pkgid MD5 Query package that contains a given package
identifier, i.e. the MD5 digest of the combined header and
payload contents.</p>

<p>--querybynumber HDRNUM Query the HDRNUMth database entry
directly; this is useful only for debugging.</p>

<p>--specfile SPECFILE Parse and query SPECFILE as if it
were a package. Although not all the information (e.g. file
lists) is available, this type of query permits rpm to be
used to extract information from spec files without having
to write a specfile parser.</p>

<p>--tid TID Query package(s) that have a given TID
transaction identifier. A unix time stamp is currently used
as a transaction identifier. All package(s) installed or
erased within a single transaction have a common
identifier.</p>

<p>--triggeredby PACKAGE_NAME Query packages that are
triggered by package(s) PACKAGE_NAME.</p>

<p>--whatprovides CAPABILITY Query all packages that
provide the CAPABILITY capability.</p>

<p>--whatrequires CAPABILITY Query all packages that
requires CAPABILITY for proper function- ing.</p>

<p>PACKAGE QUERY OPTIONS: --changelog Display change
information for the package.</p>

<p>-c, --configfiles List only configuration files (implies
-l).</p>

<p>-d, --docfiles List only documentation files (implies
-l).</p>

<p>--dump Dump file information as follows (implies
-l):</p>

<p>path size mtime md5sum mode owner group isconfig isdoc
rdev symlink</p>

<p>--filesbypkg List all the files in each selected
package.</p>

<p>-i, --info Display package information, including name,
version, and description. This uses the --queryformat if one
was specified.</p>

<p>--last Orders the package listing by install time such
that the latest packages are at the top.</p>

<p>-l, --list List files in package.</p>

<p>--provides List capabilities this package provides.</p>

<p>-R, --requires List packages on which this package
depends.</p>

<p>--scripts List the package specific scriptlet(s) that
are used as part of the installation and uninstallation
processes.</p>

<p>-s, --state Display the states of files in the package
(implies -l). The state of each file is one of normal, not
installed, or replaced.</p>

<p>--triggers, --triggerscripts Display the trigger
scripts, if any, which are contained in the package.</p>

<p>VERIFY OPTIONS The general form of an rpm verify command
is</p>

<p>rpm {-V|--verify} [select-options] [verify-options]</p>

<p>Verifying a package compares information about the
installed files in the package with information about the
files taken from the package metadata stored in the rpm
database. Among other things, verifying compares the size,
MD5 sum, permissions, type, owner and group of each file.
Any discrepancies are displayed. Files that were not
installed from the package, for example, documentation files
excluded on instal- lation using the
&quot;--excludedocs&quot; option, will be silently
ignored.</p>

<p>The package selection options are the same as for
package querying (including package manifest files as
arguments). Other options unique to verify mode are:</p>

<p>--nodeps Dont verify dependencies of packages.</p>

<p>--nodigest Dont verify package or header digests when
reading.</p>

<p>--nofiles Dont verify any attributes of package
files.</p>

<p>--noscripts Don t execute the %verifyscript scriptlet
(if any).</p>

<p>--nosignature Dont verify package or header signatures
when reading.</p>

<p>--nolinkto</p>

<p>--nomd5</p>

<p>--nosize</p>

<p>--nouser</p>

<p>--nogroup</p>

<p>--nomtime</p>

<p>--nomode</p>

<p>--nordev Dont verify the corresponding file
attribute.</p>

<p>The format of the output is a string of 8 characters, a
possible attribute marker:</p>

<p>c %config configuration file. d %doc documentation file.
g %ghost file (i.e. the file contents are not included in
the package payload). l %license license file. r %readme
readme file.</p>

<p>from the package header, followed by the file name. Each
of the 8 characters denotes the result of a comparison of
attribute(s) of the file to the value of those attribute(s)
recorded in the database. A single &quot;.&quot; (period)
means the test passed, while a single &quot;?&quot;
(question mark) indicates the test could not be performed
(e.g. file permissions prevent reading). Otherwise, the
(mnemonically emBoldened) character denotes failure of the
corresponding --verify test:</p>

<p>S file Size differs M Mode differs (includes permissions
and file type) 5 MD5 sum differs D Device major/minor number
mismatch L readLink(2) path mismatch U User ownership
differs G Group ownership differs T mTime differs</p>

<p>DIGITAL SIGNATURE AND DIGEST VERIFICATION The general
forms of rpm digital signature commands are</p>

<p>rpm --import PUBKEY ...</p>

<p>rpm {--checksig} [--nosignature] [--nodigest]
PACKAGE_FILE ...</p>

<p>The --checksig option checks all the digests and
signatures contained in PACKAGE_FILE to ensure the integrity
and origin of the package. Note that signatures are now
verified whenever a package is read, and --checksig is
useful to verify all of the digests and signatures asso-
ciated with a package.</p>

<p>Digital signatures cannot be verified without a public
key. An ASCII armored public key can be added to the rpm
database using --import. An imported public key is carried
in a header, and key ring management is performed exactly
like package management. For example, all currently imported
public keys can be displayed by:</p>

<p>rpm -qa gpg-pubkey*</p>

<p>Details about a specific public key, when imported, can
be displayed by querying. Heres information about the Red
Hat GPG/DSA key:</p>

<p>rpm -qi gpg-pubkey-db42a60e</p>

<p>Finally, public keys can be erased after importing just
like packages. Heres how to remove the Red Hat GPG/DSA
key</p>

<p>rpm -e gpg-pubkey-db42a60e</p>

<p>SIGNING A PACKAGE rpm --addsign|--resign PACKAGE_FILE
...</p>

<p>Both of the --addsign and --resign options generate and
insert new sig- natures for each package PACKAGE_FILE given,
replacing any existing signatures. There are two options for
historical reasons, there is no difference in behavior
currently.</p>

<p>USING GPG TO SIGN PACKAGES In order to sign packages
using GPG, rpm must be configured to run GPG and be able to
find a key ring with the appropriate keys. By default, rpm
uses the same conventions as GPG to find key rings, namely
the $GNUPGHOME environment variable. If your key rings are
not located where GPG expects them to be, you will need to
configure the macro %_gpg_path to be the location of the GPG
key rings to use.</p>

<p>For compatibility with older versions of GPG, PGP, and
rpm, only V3 OpenPGP signature packets should be configured.
Either DSA or RSA ver- ification algorithms can be used, but
DSA is preferred.</p>

<p>If you want to be able to sign packages you create
yourself, you also need to create your own public and secret
key pair (see the GPG man- ual). You will also need to
configure the rpm macros</p>

<p>%_signature The signature type. Right now only gpg and
pgp are supported.</p>

<p>%_gpg_name The name of the &quot;user&quot; whose key
you wish to use to sign your packages.</p>

<p>For example, to be able to use GPG to sign packages as
the user &quot;John Doe &lt;jdoe@foo.com&gt;&quot; from the
key rings located in /etc/rpm/.gpg using the executable
/usr/bin/gpg you would include</p>

<p>%_signature gpg %_gpg_path /etc/rpm/.gpg %_gpg_name John
Doe &lt;jdoe@foo.com&gt; %_gpgbin /usr/bin/gpg</p>

<p>in a macro configuration file. Use /etc/rpm/macros for
per-system con- figuration and ~/.rpmmacros for per-user
configuration.</p>

<p>REBUILD DATABASE OPTIONS The general form of an rpm
rebuild database command is</p>

<p>rpm {--initdb|--rebuilddb} [-v] [--dbpath DIRECTORY]
[--root DIRECTORY]</p>

<p>Use --initdb to create a new database if one doesnt
already exist (existing database is not overwritten), use
--rebuilddb to rebuild the database indices from the
installed package headers.</p>

<p>SHOWRC The command</p>

<p>rpm --showrc</p>

<p>shows the values rpm will use for all of the options are
currently set in rpmrc and macros configuration file(s).</p>

<p>FTP/HTTP OPTIONS rpm can act as an FTP and/or HTTP
client so that packages can be queried or installed from the
internet. Package files for install, upgrade, and query
operations may be specified as an ftp or http style URL:</p>

<p>ftp://USER:PASSWORD@HOST:PORT/path/to/package.rpm</p>

<p>If the :PASSWORD portion is omitted, the password will
be prompted for (once per user/hostname pair). If both the
user and password are omit- ted, anonymous ftp is used. In
all cases, passive (PASV) ftp transfers are performed.</p>

<p>rpm allows the following options to be used with ftp
URLs:</p>

<p>--ftpproxy HOST The host HOST will be used as a proxy
server for all ftp trans- fers, which allows users to ftp
through firewall machines which use proxy systems. This
option may also be specified by config- uring the macro
%_ftpproxy.</p>

<p>--ftpport PORT The TCP PORT number to use for the ftp
connection on the proxy ftp server instead of the default
port. This option may also be specified by configuring the
macro %_ftpport.</p>

<p>rpm allows the following options to be used with http
URLs:</p>

<p>--httpproxy HOST The host HOST will be used as a proxy
server for all http trans- fers. This option may also be
specified by configuring the macro %_httpproxy.</p>

<p>--httpport PORT The TCP PORT number to use for the http
connection on the proxy http server instead of the default
port. This option may also be specified by configuring the
macro %_httpport.</p>

<p>LEGACY ISSUES Executing rpmbuild The build modes of rpm
are now resident in the /usr/bin/rpmbuild exe- cutable.
Although legacy compatibility provided by the popt aliases
below has been adequate, the compatibility is not perfect;
hence build mode compatibility through popt aliases is being
removed from rpm. Install the package containing rpmbuild
(usually rpm-build) and see rpmbuild(8) for documentation of
all the rpm build modes previously documented here in
rpm(8).</p>

<p>Add the following lines to /etc/popt if you wish to
continue invoking rpmbuild from the rpm command line:</p>

<p>rpm exec --bp rpmb -bp rpm exec --bc rpmb -bc rpm exec
--bi rpmb -bi rpm exec --bl rpmb -bl rpm exec --ba rpmb -ba
rpm exec --bb rpmb -bb rpm exec --bs rpmb -bs rpm exec --tp
rpmb -tp rpm exec --tc rpmb -tc rpm exec --ti rpmb -ti rpm
exec --tl rpmb -tl rpm exec --ta rpmb -ta rpm exec --tb rpmb
-tb rpm exec --ts rpmb -ts rpm exec --rebuild rpmb --rebuild
rpm exec --recompile rpmb --recompile rpm exec --clean rpmb
--clean rpm exec --rmsource rpmb --rmsource rpm exec
--rmspec rpmb --rmspec rpm exec --target rpmb --target rpm
exec --short-circuit rpmb --short-circuit</p>

<p>FILES rpmrc Configuration /usr/lib/rpm/rpmrc
/usr/lib/rpm/redhat/rpmrc /etc/rpmrc ~/.rpmrc</p>

<p>Macro Configuration /usr/lib/rpm/macros
/usr/lib/rpm/redhat/macros /etc/rpm/macros ~/.rpmmacros</p>

<p>Database /var/lib/rpm/Basenames
/var/lib/rpm/Conflictname /var/lib/rpm/Dirnames
/var/lib/rpm/Filemd5s /var/lib/rpm/Group
/var/lib/rpm/Installtid /var/lib/rpm/Name
/var/lib/rpm/Packages /var/lib/rpm/Providename
/var/lib/rpm/Provideversion /var/lib/rpm/Pubkeys
/var/lib/rpm/Removed /var/lib/rpm/Requirename
/var/lib/rpm/Requireversion /var/lib/rpm/Sha1header
/var/lib/rpm/Sigmd5 /var/lib/rpm/Triggername</p>

<p>Temporary /var/tmp/rpm*</p>

<p>SEE ALSO popt(3), rpm2cpio(8), rpmbuild(8),</p>

<p>rpm --help - as rpm supports customizing the options via
popt aliases its impossible to guarantee that whats
described in the manual matches whats available.</p>

<p>http://www.rpm.org/ &lt;URL:http://www.rpm.org/&gt;</p>

<p>AUTHORS Marc Ewing &lt;marc@redhat.com&gt; Jeff Johnson
&lt;jbj@redhat.com&gt; Erik Troan &lt;ewt@redhat.com&gt;</p>

<p>Red Hat, Inc. 09 June 2002 RPM(8) TCPDUMP(8)
TCPDUMP(8)</p>

<p>NAME tcpdump - dump traffic on a network</p>

<p>SYNOPSIS tcpdump [ -AdDeflLnNOpqRStuUvxX ] [ -c count ]
[ -C file_size ] [ -F file ] [ -i interface ] [ -m module ]
[ -M secret ] [ -r file ] [ -s snaplen ] [ -T type ] [ -w
file ] [ -W filecount ] [ -E spi@ipaddr algo:secret,... ] [
-y datalinktype ] [ -Z user ] [ expression ]</p>

<p>DESCRIPTION Tcpdump prints out the headers of packets on
a network interface that match the boolean expression. It
can also be run with the -w flag, which causes it to save
the packet data to a file for later analysis, and/or with
the -r flag, which causes it to read from a saved packet
file rather than to read packets from a network interface.
In all cases, only packets that match expression will be
processed by tcpdump.</p>

<p>Tcpdump will, if not run with the -c flag, continue
capturing packets until it is interrupted by a SIGINT signal
(generated, for example, by typing your interrupt character,
typically control-C) or a SIGTERM sig- nal (typically
generated with the kill(1) command); if run with the -c
flag, it will capture packets until it is interrupted by a
SIGINT or SIGTERM signal or the specified number of packets
have been processed.</p>

<p>When tcpdump finishes capturing packets, it will report
counts of:</p>

<p>packets captured (this is the number of packets that
tcpdump has received and processed);</p>

<p>packets received by filter (the meaning of this depends
on the OS on which you re running tcpdump, and possibly on
the way the OS was configured - if a filter was specified on
the command line, on some OSes it counts packets regardless
of whether they were matched by the filter expression and,
even if they were matched by the filter expression,
regardless of whether tcpdump has read and processed them
yet, on other OSes it counts only packets that were matched
by the filter expression regardless of whether tcpdump has
read and processed them yet, and on other OSes it counts
only packets that were matched by the filter expression and
were processed by tcpdump);</p>

<p>packets dropped by kernel (this is the number of packets
that were dropped, due to a lack of buffer space, by the
packet capture mechanism in the OS on which tcpdump is
running, if the OS reports that information to applications;
if not, it will be reported as 0).</p>

<p>On platforms that support the SIGINFO signal, such as
most BSDs (including Mac OS X) and Digital/Tru64 UNIX, it
will report those counts when it receives a SIGINFO signal
(generated, for example, by typing your status character,
typically control-T, although on some platforms, such as Mac
OS X, the status character is not set by default, so you
must set it with stty(1) in order to use it) and will
continue capturing packets.</p>

<p>Reading packets from a network interface may require
that you have spe- cial privileges:</p>

<p>Under SunOS 3.x or 4.x with NIT or BPF: You must have
read access to /dev/nit or /dev/bpf*.</p>

<p>Under Solaris with DLPI: You must have read/write access
to the network pseudo device, e.g. /dev/le. On at least some
versions of Solaris, however, this is not sufficient to
allow tcpdump to capture in promiscu- ous mode; on those
versions of Solaris, you must be root, or tcpdump must be
installed setuid to root, in order to capture in promiscuous
mode. Note that, on many (perhaps all) interfaces, if you
dont capture in promiscuous mode, you will not see any
outgoing packets, so a capture not done in promiscuous mode
may not be very useful.</p>

<p>Under HP-UX with DLPI: You must be root or tcpdump must
be installed setuid to root.</p>

<p>Under IRIX with snoop: You must be root or tcpdump must
be installed setuid to root.</p>

<p>Under Linux: You must be root or tcpdump must be
installed setuid to root (unless your distribution has a
kernel that supports capability bits such as CAP_NET_RAW and
code to allow those capability bits to be given to
particular accounts and to cause those bits to be set on a
users initial processes when they log in, in which case you
must have CAP_NET_RAW in order to capture and CAP_NET_ADMIN
to enumerate network devices with, for example, the -D
flag).</p>

<p>Under ULTRIX and Digital UNIX/Tru64 UNIX: Any user may
capture network traffic with tcpdump. However, no user (not
even the super-user) can capture in promiscuous mode on an
interface unless the super-user has enabled promiscuous-
mode operation on that interface using pfconfig(8), and no
user (not even the super-user) can capture unicast traffic
received by or sent by the machine on an interface unless
the super-user has enabled copy-all-mode operation on that
interface using pfconfig, so useful packet capture on an
interface probably requires that either promiscuous-mode or
copy-all-mode opera- tion, or both modes of operation, be
enabled on that interface.</p>

<p>Under BSD (this includes Mac OS X): You must have read
access to /dev/bpf*. On BSDs with a devfs (this includes Mac
OS X), this might involve more than just hav- ing somebody
with super-user access setting the ownership or permissions
on the BPF devices - it might involve configuring devfs to
set the ownership or permissions every time the system is
booted, if the system even supports that; if it doesnt sup-
port that, you might have to find some other way to make
that happen at boot time.</p>

<p>Reading a saved packet file doesn t require special
privileges.</p>

<p>OPTIONS -A Print each packet (minus its link level
header) in ASCII. Handy for capturing web pages.</p>

<p>-c Exit after receiving count packets.</p>

<p>-C Before writing a raw packet to a savefile, check
whether the file is currently larger than file_size and, if
so, close the current savefile and open a new one. Savefiles
after the first savefile will have the name specified with
the -w flag, with a number after it, starting at 1 and
continuing upward. The units of file_size are millions of
bytes (1,000,000 bytes, not 1,048,576 bytes).</p>

<p>Note that when used with -Z option (enabled by default),
privi- leges are dropped before opening first savefile.</p>

<p>-d Dump the compiled packet-matching code in a human
readable form to standard output and stop.</p>

<p>-dd Dump packet-matching code as a C program
fragment.</p>

<p>-ddd Dump packet-matching code as decimal numbers
(preceded with a count).</p>

<p>-D Print the list of the network interfaces available on
the system and on which tcpdump can capture packets. For
each network interface, a number and an interface name,
possibly followed by a text description of the interface, is
printed. The interface name or the number can be supplied to
the -i flag to specify an interface on which to capture.</p>

<p>This can be useful on systems that don t have a command
to list them (e.g., Windows systems, or UNIX systems lacking
ifconfig -a); the number can be useful on Windows 2000 and
later systems, where the interface name is a somewhat
complex string.</p>

<p>The -D flag will not be supported if tcpdump was built
with an older version of libpcap that lacks the
pcap_findalldevs() func- tion.</p>

<p>-e Print the link-level header on each dump line.</p>

<p>-E Use spi@ipaddr algo:secret for decrypting IPsec ESP
packets that are addressed to addr and contain Security
Parameter Index value spi. This combination may be repeated
with comma or newline seperation.</p>

<p>Note that setting the secret for IPv4 ESP packets is
supported at this time.</p>

<p>Algorithms may be des-cbc, 3des-cbc, blowfish-cbc,
rc3-cbc, cast128-cbc, or none. The default is des-cbc. The
ability to decrypt packets is only present if tcpdump was
compiled with cryptography enabled.</p>

<p>secret is the ASCII text for ESP secret key. If
preceeded by 0x, then a hex value will be read.</p>

<p>The option assumes RFC2406 ESP, not RFC1827 ESP. The
option is only for debugging purposes, and the use of this
option with a true secret key is discouraged. By presenting
IPsec secret key onto command line you make it visible to
others, via ps(1) and other occasions.</p>

<p>In addition to the above syntax, the syntax file name
may be used to have tcpdump read the provided file in. The
file is opened upon receiving the first ESP packet, so any
special per- missions that tcpdump may have been given
should already have been given up.</p>

<p>-f Print foreign IPv4 addresses numerically rather than
symboli- cally (this option is intended to get around
serious brain dam- age in Suns NIS server usually it hangs
forever translating non-local internet numbers).</p>

<p>The test for foreign IPv4 addresses is done using the
IPv4 address and netmask of the interface on which capture
is being done. If that address or netmask are not available,
available, either because the interface on which capture is
being done has no address or netmask or because the capture
is being done on the Linux &quot;any&quot; interface, which
can capture on more than one interface, this option will not
work correctly.</p>

<p>-F Use file as input for the filter expression. An
additional expression given on the command line is
ignored.</p>

<p>-i Listen on interface. If unspecified, tcpdump searches
the sys- tem interface list for the lowest numbered,
configured up inter- face (excluding loopback). Ties are
broken by choosing the ear- liest match.</p>

<p>On Linux systems with 2.2 or later kernels, an interface
argu- ment of any can be used to capture packets from all
inter- faces. Note that captures on the any device will not
be done in promiscuous mode.</p>

<p>If the -D flag is supported, an interface number as
printed by that flag can be used as the interface
argument.</p>

<p>-l Make stdout line buffered. Useful if you want to see
the data while capturing it. E.g., tcpdump -l | tee dat or
tcpdump -l &gt; dat &amp; tail -f dat.</p>

<p>-L List the known data link types for the interface and
exit.</p>

<p>-m Load SMI MIB module definitions from file module.
This option can be used several times to load several MIB
modules into tcp- dump.</p>

<p>-M Use secret as a shared secret for validating the
digests found in TCP segments with the TCP-MD5 option (RFC
2385), if present.</p>

<p>-n Dont convert host addresses to names. This can be
used to avoid DNS lookups.</p>

<p>-nn Don t convert protocol and port numbers etc. to
names either.</p>

<p>-N Dont print domain name qualification of host names.
E.g., if you give this flag then tcpdump will print nic
instead of nic.ddn.mil.</p>

<p>-O Do not run the packet-matching code optimizer. This
is useful only if you suspect a bug in the optimizer.</p>

<p>-p Don_t put the interface into promiscuous mode. Note
that the interface might be in promiscuous mode for some
other reason; hence, -p cannot be used as an abbreviation
for ether host {local-hw-addr} or ether broadcast.</p>

<p>-q Quick (quiet?) output. Print less protocol
information so out- put lines are shorter.</p>

<p>-R Assume ESP/AH packets to be based on old
specification (RFC1825 to RFC1829). If specified, tcpdump
will not print replay pre- vention field. Since there is no
protocol version field in ESP/AH specification, tcpdump
cannot deduce the version of ESP/AH protocol.</p>

<p>-r Read packets from file (which was created with the -w
option). Standard input is used if file is -.</p>

<p>-S Print absolute, rather than relative, TCP sequence
numbers.</p>

<p>-s Snarf snaplen bytes of data from each packet rather
than the default of 68 (with SunOSs NIT, the minimum is
actually 96). 68 bytes is adequate for IP, ICMP, TCP and UDP
but may truncate protocol information from name server and
NFS packets (see below). Packets truncated because of a
limited snapshot are indicated in the output with [|proto],
where proto is the name of the protocol level at which the
truncation has occurred. Note that taking larger snapshots
both increases the amount of time it takes to process
packets and, effectively, decreases the amount of packet
buffering. This may cause packets to be lost. You should
limit snaplen to the smallest number that will cap- ture the
protocol information you re interested in. Setting snaplen
to 0 means use the required length to catch whole pack-
ets.</p>

<p>-T Force packets selected by &quot;expression&quot; to
be interpreted the specified type. Currently known types are
aodv (Ad-hoc On- demand Distance Vector protocol), cnfp
(Cisco NetFlow protocol), rpc (Remote Procedure Call), rtp
(Real-Time Applications proto- col), rtcp (Real-Time
Applications control protocol), snmp (Sim- ple Network
Management Protocol), tftp (Trivial File Transfer Protocol),
vat (Visual Audio Tool), and wb (distributed White
Board).</p>

<p>-t Dont print a timestamp on each dump line.</p>

<p>-tt Print an unformatted timestamp on each dump
line.</p>

<p>-ttt Print a delta (in micro-seconds) between current
and previous line on each dump line.</p>

<p>-tttt Print a timestamp in default format proceeded by
date on each dump line.</p>

<p>-u Print undecoded NFS handles.</p>

<p>-U Make output saved via the -w option packet-buffered;
i.e., as each packet is saved, it will be written to the
output file, rather than being written only when the output
buffer fills.</p>

<p>The -U flag will not be supported if tcpdump was built
with an older version of libpcap that lacks the
pcap_dump_flush() func- tion.</p>

<p>-v When parsing and printing, produce (slightly more)
verbose out- put. For example, the time to live,
identification, total length and options in an IP packet are
printed. Also enables additional packet integrity checks
such as verifying the IP and ICMP header checksum.</p>

<p>When writing to a file with the -w option, report, every
10 sec- onds, the number of packets captured.</p>

<p>-vv Even more verbose output. For example, additional
fields are printed from NFS reply packets, and SMB packets
are fully decoded.</p>

<p>-vvv Even more verbose output. For example, telnet SB
... SE options are printed in full. With -X Telnet options
are printed in hex as well.</p>

<p>-w Write the raw packets to file rather than parsing and
printing them out. They can later be printed with the -r
option. Stan- dard output is used if file is -.</p>

<p>-W Used in conjunction with the -C option, this will
limit the num- ber of files created to the specified number,
and begin overwriting files from the beginning, thus
creating a rotating buffer. In addition, it will name the
files with enough leading 0s to support the maximum number
of files, allowing them to sort correctly.</p>

<p>-x Print each packet (minus its link level header) in
hex. The smaller of the entire packet or snaplen bytes will
be printed. Note that this is the entire link-layer packet,
so for link lay- ers that pad (e.g. Ethernet), the padding
bytes will also be printed when the higher layer packet is
shorter than the required padding.</p>

<p>-xx Print each packet, including its link level header,
in hex.</p>

<p>-X Print each packet (minus its link level header) in
hex and ASCII. This is very handy for analysing new
protocols.</p>

<p>-XX Print each packet, including its link level header,
in hex and ASCII.</p>

<p>-y Set the data link type to use while capturing packets
to datalinktype.</p>

<p>-Z Drops privileges (if root) and changes user ID to
user and the group ID to the primary group of user.</p>

<p>This behavior is enabled by default (-Z pcap), and can
be dis- abled by -Z root.</p>

<p>expression selects which packets will be dumped. If no
expression is given, all packets on the net will be dumped.
Otherwise, only packets for which expression is true will be
dumped.</p>

<p>The expression consists of one or more primitives.
Primitives usually consist of an id (name or number)
preceded by one or more qualifiers. There are three
different kinds of qualifier:</p>

<p>type qualifiers say what kind of thing the id name or
number refers to. Possible types are host, net , port and
por- trange. E.g., host foo, net 128.3, port 20 , por-
trange 6000-6008 . If there is no type qualifier, host is
assumed.</p>

<p>dir qualifiers specify a particular transfer direction
to and/or from id. Possible directions are src, dst, src or
dst and src and dst. E.g., src foo, dst net 128.3, src or
dst port ftp-data. If there is no dir quali- fier, src or
dst is assumed. For some link layers, such as SLIP and the
cooked Linux capture mode used for the any device and for
some other device types, the inbound and outbound qualifiers
can be used to specify a desired direction.</p>

<p>proto qualifiers restrict the match to a particular
protocol. Possible protos are: ether, fddi, tr, wlan, ip,
ip6, arp, rarp, decnet, tcp and udp. E.g., ether src foo,
arp net 128.3 , tcp port 21 , udp portrange 7000-7009. If
there is no proto qualifier, all protocols consistent with
the type are assumed. E.g., src foo means (ip or arp or
rarp) src foo (except the latter is not legal syntax), net
bar means (ip or arp or rarp) net bar and port 53 means (tcp
or udp) port 53.</p>

<p>[fddi is actually an alias for ether ; the parser treats
them identically as meaning the data link level used on the
specified network interface. FDDI headers contain Ethernet-
like source and destination addresses, and often contain
Ether- net-like packet types, so you can filter on these
FDDI fields just as with the analogous Ethernet fields. FDDI
headers also contain other fields, but you cannot name them
explicitly in a filter expression.</p>

<p>Similarly, tr and wlan are aliases for ether; the
previous paragraphs statements about FDDI headers also apply
to Token Ring and 802.11 wireless LAN headers. For 802.11
headers, the destination address is the DA field and the
source address is the SA field; the BSSID, RA, and TA fields
arent tested.]</p>

<p>In addition to the above, there are some special
primitive keywords that don t follow the pattern: gateway,
broadcast, less, greater and arithmetic expressions. All of
these are described below.</p>

<p>More complex filter expressions are built up by using
the words and, or and not to combine primitives. E.g., host
foo and not port ftp and not port ftp-data . To save typing,
identical qualifier lists can be omitted. E.g., tcp dst port
ftp or ftp- data or domain is exactly the same as tcp dst
port ftp or tcp dst port ftp-data or tcp dst port
domain.</p>

<p>Allowable primitives are:</p>

<p>dst host host True if the IPv4/v6 destination field of
the packet is host, which may be either an address or a
name.</p>

<p>src host host True if the IPv4/v6 source field of the
packet is host.</p>

<p>host host True if either the IPv4/v6 source or
destination of the packet is host.</p>

<p>Any of the above host expressions can be prepended with
the keywords, ip, arp, rarp, or ip6 as in: ip host host
which is equivalent to: ether proto ip and host host If host
is a name with multiple IP addresses, each address will be
checked for a match.</p>

<p>ether dst ehost True if the Ethernet destination address
is ehost. Ehost may be either a name from /etc/ethers or a
number (see ethers(3N) for numeric format).</p>

<p>ether src ehost True if the Ethernet source address is
ehost.</p>

<p>ether host ehost True if either the Ethernet source or
destination address is ehost.</p>

<p>gateway host True if the packet used host as a gateway.
I.e., the Ethernet source or destination address was host
but nei- ther the IP source nor the IP destination was host.
Host must be a name and must be found both by the machines
host-name-to-IP-address resolution mechanisms (host name
file, DNS, NIS, etc.) and by the machines host-name-to-
Ethernet-address resolution mechanism (/etc/ethers, etc.).
(An equivalent expression is ether host ehost and not host
host which can be used with either names or numbers for host
/ ehost.) This syntax does not work in IPv6-enabled con-
figuration at this moment.</p>

<p>dst net net True if the IPv4/v6 destination address of
the packet has a network number of net. Net may be either a
name from /etc/networks or a network number (see networks(4)
for details).</p>

<p>src net net True if the IPv4/v6 source address of the
packet has a network number of net.</p>

<p>net net True if either the IPv4/v6 source or destination
address of the packet has a network number of net.</p>

<p>net net mask netmask True if the IPv4 address matches
net with the specific netmask. May be qualified with src or
dst. Note that this syntax is not valid for IPv6 net.</p>

<p>net net/len True if the IPv4/v6 address matches net with
a netmask len bits wide. May be qualified with src or
dst.</p>

<p>dst port port True if the packet is ip/tcp, ip/udp,
ip6/tcp or ip6/udp and has a destination port value of port.
The port can be a number or a name used in /etc/services
(see tcp(4P) and udp(4P)). If a name is used, both the port
number and protocol are checked. If a number or ambiguous
name is used, only the port number is checked (e.g., dst
port 513 will print both tcp/login traffic and udp/who traf-
fic, and port domain will print both tcp/domain and
udp/domain traffic).</p>

<p>src port port True if the packet has a source port value
of port.</p>

<p>port port True if either the source or destination port
of the packet is port.</p>

<p>dst portrange port1-port2 True if the packet is ip/tcp,
ip/udp, ip6/tcp or ip6/udp and has a destination port value
between port1 and port2. port1 and port2 are interpreted in
the same fashion as the port parameter for port.</p>

<p>src portrange port1-port2 True if the packet has a
source port value between port1 and port2.</p>

<p>portrange port1-port2 True if either the source or
destination port of the packet is between port1 and
port2.</p>

<p>Any of the above port or port range expressions can be
prepended with the keywords, tcp or udp, as in: tcp src port
port which matches only tcp packets whose source port is
port.</p>

<p>less length True if the packet has a length less than or
equal to length. This is equivalent to: len &lt;=
length.</p>

<p>greater length True if the packet has a length greater
than or equal to length. This is equivalent to: len &gt;=
length.</p>

<p>ip proto protocol True if the packet is an IPv4 packet
(see ip(4P)) of pro- tocol type protocol. Protocol can be a
number or one of the names icmp, icmp6, igmp, igrp, pim, ah,
esp, vrrp, udp, or tcp. Note that the identifiers tcp, udp,
and icmp are also keywords and must be escaped via backslash
(, which is \ in the C-shell. Note that this primi- tive
does not chase the protocol header chain.</p>

<p>ip6 proto protocol True if the packet is an IPv6 packet
of protocol type protocol. Note that this primitive does not
chase the protocol header chain.</p>

<p>ip6 protochain protocol True if the packet is IPv6
packet, and contains protocol header with type protocol in
its protocol header chain. For example, ip6 protochain 6
matches any IPv6 packet with TCP protocol header in the
protocol header chain. The packet may contain, for exam-
ple, authentication header, routing header, or hop-by-hop
option header, between IPv6 header and TCP header. The BPF
code emitted by this primitive is complex and cannot be
optimized by BPF optimizer code in tcpdump, so this can be
somewhat slow.</p>

<p>ip protochain protocol Equivalent to ip6 protochain
protocol, but this is for IPv4.</p>

<p>ether broadcast True if the packet is an Ethernet
broadcast packet. The ether keyword is optional.</p>

<p>ip broadcast True if the packet is an IPv4 broadcast
packet. It checks for both the all-zeroes and all-ones
broadcast conventions, and looks up the subnet mask on the
inter- face on which the capture is being done.</p>

<p>If the subnet mask of the interface on which the capture
is being done is not available, either because the inter-
face on which capture is being done has no netmask or
because the capture is being done on the Linux
&quot;any&quot; interface, which can capture on more than
one interface, this check will not work correctly.</p>

<p>ether multicast True if the packet is an Ethernet
multicast packet. The ether keyword is optional. This is
shorthand for ether[0] &amp; 1 != 0.</p>

<p>ip multicast True if the packet is an IPv4 multicast
packet.</p>

<p>ip6 multicast True if the packet is an IPv6 multicast
packet.</p>

<p>ether proto protocol True if the packet is of ether type
protocol. Protocol can be a number or one of the names ip,
ip6, arp, rarp, atalk, aarp, decnet, sca, lat, mopdl, moprc,
iso, stp, ipx, or netbeui. Note these identifiers are also
key- words and must be escaped via backslash (.</p>

<p>[In the case of FDDI (e.g., fddi protocol arp), Token
Ring (e.g., tr protocol arp ), and IEEE 802.11 wireless LANS
(e.g., wlan protocol arp), for most of those pro- tocols,
the protocol identification comes from the 802.2 Logical
Link Control (LLC) header, which is usually lay- ered on top
of the FDDI, Token Ring, or 802.11 header.</p>

<p>When filtering for most protocol identifiers on FDDI,
Token Ring, or 802.11, tcpdump checks only the protocol ID
field of an LLC header in so-called SNAP format with an
Organizational Unit Identifier (OUI) of 0x000000, for
encapsulated Ethernet; it doesnt check whether the packet is
in SNAP format with an OUI of 0x000000. The exceptions
are:</p>

<p>iso tcpdump checks the DSAP (Destination Service Access
Point) and SSAP (Source Service Access Point) fields of the
LLC header;</p>

<p>stp and netbeui tcpdump checks the DSAP of the LLC
header;</p>

<p>atalk tcpdump checks for a SNAP-format packet with an
OUI of 0x080007 and the AppleTalk etype.</p>

<p>In the case of Ethernet, tcpdump checks the Ethernet
type field for most of those protocols. The exceptions
are:</p>

<p>iso, stp, and netbeui tcpdump checks for an 802.3 frame
and then checks the LLC header as it does for FDDI, Token
Ring, and 802.11;</p>

<p>atalk tcpdump checks both for the AppleTalk etype in an
Ethernet frame and for a SNAP-format packet as it does for
FDDI, Token Ring, and 802.11;</p>

<p>aarp tcpdump checks for the AppleTalk ARP etype in
either an Ethernet frame or an 802.2 SNAP frame with an OUI
of 0x000000;</p>

<p>ipx tcpdump checks for the IPX etype in an Ethernet
frame, the IPX DSAP in the LLC header, the
802.3-with-no-LLC-header encapsulation of IPX, and the IPX
etype in a SNAP frame.</p>

<p>decnet src host True if the DECNET source address is
host, which may be an address of the form 10.123, or a
DECNET host name. [DECNET host name support is only
available on ULTRIX systems that are configured to run
DECNET.]</p>

<p>decnet dst host True if the DECNET destination address
is host.</p>

<p>decnet host host True if either the DECNET source or
destination address is host.</p>

<p>ifname interface True if the packet was logged as coming
from the speci- fied interface (applies only to packets
logged by OpenBSDs pf(4)).</p>

<p>on interface Synonymous with the ifname modifier.</p>

<p>rnr num True if the packet was logged as matching the
specified PF rule number (applies only to packets logged by
OpenBSDs pf(4)).</p>

<p>rulenum num Synonomous with the rnr modifier.</p>

<p>reason code True if the packet was logged with the
specified PF rea- son code. The known codes are: match,
bad-offset, frag- ment, short, normalize, and memory
(applies only to pack- ets logged by OpenBSDs pf(4)).</p>

<p>rset name True if the packet was logged as matching the
specified PF ruleset name of an anchored ruleset (applies
only to packets logged by pf(4)).</p>

<p>ruleset name Synonomous with the rset modifier.</p>

<p>srnr num True if the packet was logged as matching the
specified PF rule number of an anchored ruleset (applies
only to packets logged by pf(4)).</p>

<p>subrulenum num Synonomous with the srnr modifier.</p>

<p>action act True if PF took the specified action when the
packet was logged. Known actions are: pass and block
(applies only to packets logged by OpenBSDs pf(4)).</p>

<p>ip, ip6, arp, rarp, atalk, aarp, decnet, iso, stp, ipx,
netbeui Abbreviations for: ether proto p where p is one of
the above protocols.</p>

<p>lat, moprc, mopdl Abbreviations for: ether proto p where
p is one of the above protocols. Note that tcpdump does not
currently know how to parse these protocols.</p>

<p>vlan [vlan_id] True if the packet is an IEEE 802.1Q VLAN
packet. If [vlan_id] is specified, only true if the packet
has the specified vlan_id. Note that the first vlan keyword
encountered in expression changes the decoding offsets for
the remainder of expression on the assumption that the
packet is a VLAN packet. The vlan [vlan_id] expres- sion may
be used more than once, to filter on VLAN hier- archies.
Each use of that expression increments the fil- ter offsets
by 4.</p>

<p>For example: vlan 100 &amp;&amp; vlan 200 filters on
VLAN 200 encapsulated within VLAN 100, and vlan &amp;&amp;
vlan 300 &amp;&amp; ip filters IPv4 protocols encapsulated
in VLAN 300 encapsu- lated within any higher order VLAN.</p>

<p>mpls [label_num] True if the packet is an MPLS packet.
If [label_num] is specified, only true is the packet has the
specified label_num. Note that the first mpls keyword
encountered in expression changes the decoding offsets for
the remainder of expression on the assumption that the
packet is a MPLS-encapsulated IP packet. The mpls
[label_num] expression may be used more than once, to filter
on MPLS hierarchies. Each use of that expression increments
the filter offsets by 4.</p>

<p>For example: mpls 100000 &amp;&amp; mpls 1024 filters
packets with an outer label of 100000 and an inner label of
1024, and mpls &amp;&amp; mpls 1024 &amp;&amp; host
192.9.200.1 filters packets to or from 192.9.200.1 with an
inner label of 1024 and any outer label.</p>

<p>pppoed True if the packet is a PPP-over-Ethernet
Discovery packet (Ethernet type 0x8863).</p>

<p>pppoes True if the packet is a PPP-over-Ethernet Session
packet (Ethernet type 0x8864). Note that the first pppoes
key- word encountered in expression changes the decoding
off- sets for the remainder of expression on the assumption
that the packet is a PPPoE session packet.</p>

<p>For example: pppoes &amp;&amp; ip filters IPv4 protocols
encapsulated in PPPoE.</p>

<p>tcp, udp, icmp Abbreviations for: ip proto p or ip6
proto p where p is one of the above protocols.</p>

<p>iso proto protocol True if the packet is an OSI packet
of protocol type pro- tocol. Protocol can be a number or one
of the names clnp, esis, or isis.</p>

<p>clnp, esis, isis Abbreviations for: iso proto p where p
is one of the above protocols.</p>

<p>l1, l2, iih, lsp, snp, csnp, psnp Abbreviations for
IS-IS PDU types.</p>

<p>vpi n True if the packet is an ATM packet, for SunATM on
Solaris, with a virtual path identifier of n.</p>

<p>vci n True if the packet is an ATM packet, for SunATM on
Solaris, with a virtual channel identifier of n.</p>

<p>lane True if the packet is an ATM packet, for SunATM on
Solaris, and is an ATM LANE packet. Note that the first lane
keyword encountered in expression changes the tests done in
the remainder of expression on the assumption that the
packet is either a LANE emulated Ethernet packet or a LANE
LE Control packet. If lane isn t specified, the tests are
done under the assumption that the packet is an
LLC-encapsulated packet.</p>

<p>llc True if the packet is an ATM packet, for SunATM on
Solaris, and is an LLC-encapsulated packet.</p>

<p>oamf4s True if the packet is an ATM packet, for SunATM
on Solaris, and is a segment OAM F4 flow cell (VPI=0 &amp;
VCI=3).</p>

<p>oamf4e True if the packet is an ATM packet, for SunATM
on Solaris, and is an end-to-end OAM F4 flow cell (VPI=0
&amp; VCI=4).</p>

<p>oamf4 True if the packet is an ATM packet, for SunATM on
Solaris, and is a segment or end-to-end OAM F4 flow cell
(VPI=0 &amp; (VCI=3 | VCI=4)).</p>

<p>oam True if the packet is an ATM packet, for SunATM on
Solaris, and is a segment or end-to-end OAM F4 flow cell
(VPI=0 &amp; (VCI=3 | VCI=4)).</p>

<p>metac True if the packet is an ATM packet, for SunATM on
Solaris, and is on a meta signaling circuit (VPI=0 &amp;
VCI=1).</p>

<p>bcc True if the packet is an ATM packet, for SunATM on
Solaris, and is on a broadcast signaling circuit (VPI=0
&amp; VCI=2).</p>

<p>sc True if the packet is an ATM packet, for SunATM on
Solaris, and is on a signaling circuit (VPI=0 &amp;
VCI=5).</p>

<p>ilmic True if the packet is an ATM packet, for SunATM on
Solaris, and is on an ILMI circuit (VPI=0 &amp; VCI=16).</p>

<p>connectmsg True if the packet is an ATM packet, for
SunATM on Solaris, and is on a signaling circuit and is a
Q.2931 Setup, Call Proceeding, Connect, Connect Ack,
Release, or Release Done message.</p>

<p>metaconnect True if the packet is an ATM packet, for
SunATM on Solaris, and is on a meta signaling circuit and is
a Q.2931 Setup, Call Proceeding, Connect, Release, or
Release Done message.</p>

<p>expr relop expr True if the relation holds, where relop
is one of &gt;, &lt;, &gt;=, &lt;=, =, !=, and expr is an
arithmetic expression com- posed of integer constants
(expressed in standard C syn- tax), the normal binary
operators [+, -, *, /, &amp;, |, &lt;&lt;, &gt;&gt;], a
length operator, and special packet data acces- sors. Note
that all comparisons are unsigned, so that, for example,
0x80000000 and 0xffffffff are &gt; 0. To access data inside
the packet, use the following syntax: proto [ expr : size ]
Proto is one of ether, fddi, tr, wlan, ppp, slip, link, ip,
arp, rarp, tcp, udp, icmp, ip6 or radio, and indi- cates the
protocol layer for the index operation. (ether, fddi, wlan,
tr, ppp, slip and link all refer to the link layer. radio
refers to the &quot;radio header&quot; added to some 802.11
captures.) Note that tcp, udp and other upper-layer protocol
types only apply to IPv4, not IPv6 (this will be fixed in
the future). The byte offset, relative to the indicated
protocol layer, is given by expr. Size is optional and
indicates the number of bytes in the field of interest; it
can be either one, two, or four, and defaults to one. The
length operator, indi- cated by the keyword len, gives the
length of the packet.</p>

<p>For example, ether[0] &amp; 1 != 0 catches all multicast
traffic. The expression ip[0] &amp; 0xf != 5 catches all
IPv4 packets with options. The expression ip[6:2] &amp;
0x1fff = 0 catches only unfragmented IPv4 datagrams and frag
zero of fragmented IPv4 datagrams. This check is implicitly
applied to the tcp and udp index operations. For instance,
tcp[0] always means the first byte of the TCP header, and
never means the first byte of an inter- vening fragment.</p>

<p>Some offsets and field values may be expressed as names
rather than as numeric values. The following protocol header
field offsets are available: icmptype (ICMP type field),
icmpcode (ICMP code field), and tcpflags (TCP flags
field).</p>

<p>The following ICMP type field values are available:
icmp- echoreply, icmp-unreach, icmp-sourcequench, icmp-redi-
rect, icmp-echo, icmp-routeradvert, icmp-routersolicit,
icmp-timxceed, icmp-paramprob, icmp-tstamp, icmp-tstam-
preply, icmp-ireq, icmp-ireqreply, icmp-maskreq, icmp-
maskreply.</p>

<p>The following TCP flags field values are available: tcp-
fin, tcp-syn, tcp-rst, tcp-push, tcp-ack, tcp-urg.</p>

<p>Primitives may be combined using:</p>

<p>A parenthesized group of primitives and operators
(paren- theses are special to the Shell and must be
escaped).</p>

<p>Negation (! or not).</p>

<p>Concatenation (&amp;&amp; or and).</p>

<p>Alternation (|| or or).</p>

<p>Negation has highest precedence. Alternation and
concatenation have equal precedence and associate left to
right. Note that explicit and tokens, not juxtaposition, are
now required for concatenation.</p>

<p>If an identifier is given without a keyword, the most
recent keyword is assumed. For example, not host vs and ace
is short for not host vs and host ace which should not be
confused with not ( host vs or ace )</p>

<p>Expression arguments can be passed to tcpdump as either
a single argument or as multiple arguments, whichever is
more convenient. Generally, if the expression contains Shell
metacharacters, it is easier to pass it as a single, quoted
argument. Multiple arguments are concatenated with spaces
before being parsed.</p>

<p>EXAMPLES To print all packets arriving at or departing
from sundown: tcpdump host sundown</p>

<p>To print traffic between helios and either hot or ace:
tcpdump host helios and( hot or ac)</p>

<p>To print all IP packets between ace and any host except
helios: tcpdump ip host ace and not helios</p>

<p>To print all traffic between local hosts and hosts at
Berkeley: tcpdump net ucb-ether</p>

<p>To print all ftp traffic through internet gateway snup:
(note that the expression is quoted to prevent the shell
from (mis-)interpreting the parentheses): tcpdumpgateway
snup and (port ftp or ftp-data)</p>

<p>To print traffic neither sourced from nor destined for
local hosts (if you gateway to one other net, this stuff
should never make it onto your local net). tcpdump ip and
not net localnet</p>

<p>To print the start and end packets (the SYN and FIN
packets) of each TCP conversation that involves a non-local
host. tcpdumptcp[tcpflags] &amp; (tcp-syn|tcp-fin) != 0 and
not src and dst net localnet</p>

<p>To print all IPv4 HTTP packets to and from port 80, i.e.
print only packets that contain data, not, for example, SYN
and FIN packets and ACK-only packets. (IPv6 is left as an
exercise for the reader.) tcpdump tcp port 80 and (((ip[2:2]
- ((ip[0]&amp;0xf)&lt;&lt;2)) -
((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)</p>

<p>To print IP packets longer than 576 bytes sent through
gateway snup: tcpdumpgateway snup and ip[2:2] &gt; 576</p>

<p>To print IP broadcast or multicast packets that were not
sent via Eth- ernet broadcast or multicast: tcpdumpether[0]
&amp; 1 = 0 and ip[16] &gt;= 224</p>

<p>To print all ICMP packets that are not echo
requests/replies (i.e., not ping packets): tcpdump
icmp[icmptype] != icmp-echo and icmp[icmptype] !=
icmp-echoreply</p>

<p>OUTPUT FORMAT The output of tcpdump is protocol
dependent. The following gives a brief description and
examples of most of the formats.</p>

<p>Link Level Headers</p>

<p>If the -e option is given, the link level header is
printed out. On Ethernets, the source and destination
addresses, protocol, and packet length are printed.</p>

<p>On FDDI networks, the -e option causes tcpdump to print
the frame control field, the source and destination
addresses, and the packet length. (The frame control field
governs the interpretation of the rest of the packet. Normal
packets (such as those containing IP data- grams) are async
packets, with a priority value between 0 and 7; for example,
async4. Such packets are assumed to contain an 802.2 Logi-
cal Link Control (LLC) packet; the LLC header is printed if
it is not an ISO datagram or a so-called SNAP packet.</p>

<p>On Token Ring networks, the -e option causes tcpdump to
print the access control and frame control fields, the
source and destination addresses, and the packet length. As
on FDDI networks, packets are assumed to contain an LLC
packet. Regardless of whether the -e option is specified or
not, the source routing information is printed for
source-routed packets.</p>

<p>On 802.11 networks, the -e option causes tcpdump to
print the frame control fields, all of the addresses in the
802.11 header, and the packet length. As on FDDI networks,
packets are assumed to contain an LLC packet.</p>

<p>(N.B.: The following description assumes familiarity
with the SLIP com- pression algorithm described in
RFC-1144.)</p>

<p>On SLIP links, a direction indicator (I for inbound, O
for out- bound), packet type, and compression information
are printed out. The packet type is printed first. The three
types are ip, utcp, and ctcp. No further link information is
printed for ip packets. For TCP pack- ets, the connection
identifier is printed following the type. If the packet is
compressed, its encoded header is printed out. The special
cases are printed out as *S+n and *SA+n, where n is the
amount by which the sequence number (or sequence number and
ack) has changed. If it is not a special case, zero or more
changes are printed. A change is indicated by U (urgent
pointer), W (window), A (ack), S (sequence num- ber), and I
(packet ID), followed by a delta (+n or -n), or a new value
(=n). Finally, the amount of data in the packet and
compressed header length are printed.</p>

<p>For example, the following line shows an outbound
compressed TCP packet, with an implicit connection
identifier; the ack has changed by 6, the sequence number by
49, and the packet ID by 6; there are 3 bytes of data and 6
bytes of compressed header: O ctcp * A+6 S+49 I+6 3 (6)</p>

<p>ARP/RARP Packets</p>

<p>Arp/rarp output shows the type of request and its
arguments. The for- mat is intended to be self explanatory.
Here is a short sample taken from the start of an rlogin
from host rtsg to host csam: arp who-has csam tell rtsg arp
reply csam is-at CSAM The first line says that rtsg sent an
arp packet asking for the Ether- net address of internet
host csam. Csam replies with its Ethernet address (in this
example, Ethernet addresses are in caps and internet
addresses in lower case).</p>

<p>This would look less redundant if we had done tcpdump
-n: arp who-has 128.3.254.6 tell 128.3.254.68 arp reply
128.3.254.6 is-at 02:07:01:00:01:c4</p>

<p>If we had done tcpdump -e, the fact that the first
packet is broadcast and the second is point-to-point would
be visible: RTSG Broadcast 0806 64: arp who-has csam tell
rtsg CSAM RTSG 0806 64: arp reply csam is-at CSAM For the
first packet this says the Ethernet source address is RTSG,
the destination is the Ethernet broadcast address, the type
field contained hex 0806 (type ETHER_ARP) and the total
length was 64 bytes.</p>

<p>TCP Packets</p>

<p>(N.B.:The following description assumes familiarity with
the TCP proto- col described in RFC-793. If you are not
familiar with the protocol, neither this description nor
tcpdump will be of much use to you.)</p>

<p>The general format of a tcp protocol line is: src &gt;
dst: flags data-seqno ack window urgent options Src and dst
are the source and destination IP addresses and ports. Flags
are some combination of S (SYN), F (FIN), P (PUSH), R (RST),
W (ECN CWR) or E (ECN-Echo), or a single . (no flags).
Data-seqno describes the portion of sequence space covered
by the data in this packet (see example below). Ack is
sequence number of the next data expected the other
direction on this connection. Window is the number of bytes
of receive buffer space available the other direction on
this connection. Urg indicates there is urgent data in the
packet. Options are tcp options enclosed in angle brackets
(e.g., &lt;mss 1024&gt;).</p>

<p>Src, dst and flags are always present. The other fields
depend on the contents of the packet s tcp protocol header
and are output only if appropriate.</p>

<p>Here is the opening portion of an rlogin from host rtsg
to host csam. rtsg.1023 &gt; csam.login: S 768512:768512(0)
win 4096 &lt;mss 1024&gt; csam.login &gt; rtsg.1023: S
947648:947648(0) ack 768513 win 4096 &lt;mss 1024&gt;
rtsg.1023 &gt; csam.login: . ack 1 win 4096 rtsg.1023 &gt;
csam.login: P 1:2(1) ack 1 win 4096 csam.login &gt;
rtsg.1023: . ack 2 win 4096 rtsg.1023 &gt; csam.login: P
2:21(19) ack 1 win 4096 csam.login &gt; rtsg.1023: P 1:2(1)
ack 21 win 4077 csam.login &gt; rtsg.1023: P 2:3(1) ack 21
win 4077 urg 1 csam.login &gt; rtsg.1023: P 3:4(1) ack 21
win 4077 urg 1 The first line says that tcp port 1023 on
rtsg sent a packet to port login on csam. The S indicates
that the SYN flag was set. The packet sequence number was
768512 and it contained no data. (The notation is
first:last(nbytes) which means sequence numbers first up to
but not including last which is nbytes bytes of user data.)
There was no piggy-backed ack, the available receive window
was 4096 bytes and there was a max-segment-size option
requesting an mss of 1024 bytes.</p>

<p>Csam replies with a similar packet except it includes a
piggy-backed ack for rtsgs SYN. Rtsg then acks csams SYN.
The . means no flags were set. The packet contained no data
so there is no data sequence number. Note that the ack
sequence number is a small integer (1). The first time
tcpdump sees a tcp conversation, it prints the sequence
number from the packet. On subsequent packets of the
conversation, the difference between the current packets
sequence number and this ini- tial sequence number is
printed. This means that sequence numbers after the first
can be interpreted as relative byte positions in the
conversation s data stream (with the first data byte each
direction being 1). -S will override this feature, causing
the original sequence numbers to be output.</p>

<p>On the 6th line, rtsg sends csam 19 bytes of data (bytes
2 through 20 in the rtsg csam side of the conversation). The
PUSH flag is set in the packet. On the 7th line, csam says
its received data sent by rtsg up to but not including byte
21. Most of this data is apparently sit- ting in the socket
buffer since csams receive window has gotten 19 bytes
smaller. Csam also sends one byte of data to rtsg in this
packet. On the 8th and 9th lines, csam sends two bytes of
urgent, pushed data to rtsg.</p>

<p>If the snapshot was small enough that tcpdump didn t
capture the full TCP header, it interprets as much of the
header as it can and then reports [|tcp] to indicate the
remainder could not be interpreted. If the header contains a
bogus option (one with a length thats either too small or
beyond the end of the header), tcpdump reports it as [bad
opt] and does not interpret any further options (since its
impossible to tell where they start). If the header length
indicates options are present but the IP datagram length is
not long enough for the options to actually be there,
tcpdump reports it as [bad hdr length].</p>

<p>Capturing TCP packets with particular flag combinations
(SYN-ACK, URG- ACK, etc.)</p>

<p>There are 8 bits in the control bits section of the TCP
header:</p>

<p>CWR | ECE | URG | ACK | PSH | RST | SYN | FIN</p>

<p>Let s assume that we want to watch packets used in
establishing a TCP connection. Recall that TCP uses a 3-way
handshake protocol when it initializes a new connection; the
connection sequence with regard to the TCP control bits
is</p>

<p>1) Caller sends SYN 2) Recipient responds with SYN, ACK
3) Caller sends ACK</p>

<p>Now were interested in capturing packets that have only
the SYN bit set (Step 1). Note that we dont want packets
from step 2 (SYN-ACK), just a plain initial SYN. What we
need is a correct filter expression for tcpdump.</p>

<p>Recall the structure of a TCP header without
options:</p>

<p>0 15 31
-----------------------------------------------------------------
| source port | destination port |
-----------------------------------------------------------------
| sequence number |
-----------------------------------------------------------------
| acknowledgment number |
-----------------------------------------------------------------
| HL | rsvd |C|E|U|A|P|R|S|F| window size |
-----------------------------------------------------------------
| TCP checksum | urgent pointer |
-----------------------------------------------------------------</p>

<p>A TCP header usually holds 20 octets of data, unless
options are present. The first line of the graph contains
octets 0 - 3, the second line shows octets 4 - 7 etc.</p>

<p>Starting to count with 0, the relevant TCP control bits
are contained in octet 13:</p>

<p>0 7| 15| 23| 31
----------------|---------------|---------------|----------------
| HL | rsvd |C|E|U|A|P|R|S|F| window size |
----------------|---------------|---------------|----------------
| | 13th octet | | |</p>

<p>Lets have a closer look at octet no. 13:</p>

<p>| | |---------------| |C|E|U|A|P|R|S|F|
|---------------| |7 5 3 0|</p>

<p>These are the TCP control bits we are interested in. We
have numbered the bits in this octet from 0 to 7, right to
left, so the PSH bit is bit number 3, while the URG bit is
number 5.</p>

<p>Recall that we want to capture packets with only SYN
set. Lets see what happens to octet 13 if a TCP datagram
arrives with the SYN bit set in its header:</p>

<p>|C|E|U|A|P|R|S|F| |---------------| |0 0 0 0 0 0 1 0|
|---------------| |7 6 5 4 3 2 1 0|</p>

<p>Looking at the control bits section we see that only bit
number 1 (SYN) is set.</p>

<p>Assuming that octet number 13 is an 8-bit unsigned
integer in network byte order, the binary value of this
octet is</p>

<p>00000010</p>

<p>and its decimal representation is</p>

<p>7 6 5 4 3 2 1 0 0*2 + 0*2 + 0*2 + 0*2 + 0*2 + 0*2 + 1*2
+ 0*2 = 2</p>

<p>We re almost done, because now we know that if only SYN
is set, the value of the 13th octet in the TCP header, when
interpreted as a 8-bit unsigned integer in network byte
order, must be exactly 2.</p>

<p>This relationship can be expressed as tcp[13] == 2</p>

<p>We can use this expression as the filter for tcpdump in
order to watch packets which have only SYN set: tcpdump -i
xl0 tcp[13] == 2</p>

<p>The expression says &quot;let the 13th octet of a TCP
datagram have the dec- imal value 2&quot;, which is exactly
what we want.</p>

<p>Now, lets assume that we need to capture SYN packets,
but we dont care if ACK or any other TCP control bit is set
at the same time. Lets see what happens to octet 13 when a
TCP datagram with SYN-ACK set arrives:</p>

<p>|C|E|U|A|P|R|S|F| |---------------| |0 0 0 1 0 0 1 0|
|---------------| |7 6 5 4 3 2 1 0|</p>

<p>Now bits 1 and 4 are set in the 13th octet. The binary
value of octet 13 is</p>

<p>00010010</p>

<p>which translates to decimal</p>

<p>7 6 5 4 3 2 1 0 0*2 + 0*2 + 0*2 + 1*2 + 0*2 + 0*2 + 1*2
+ 0*2 = 18</p>

<p>Now we cant just use tcp[13] == 18 in the tcpdump filter
expression, because that would select only those packets
that have SYN-ACK set, but not those with only SYN set.
Remember that we don t care if ACK or any other control bit
is set as long as SYN is set.</p>

<p>In order to achieve our goal, we need to logically AND
the binary value of octet 13 with some other value to
preserve the SYN bit. We know that we want SYN to be set in
any case, so well logically AND the value in the 13th octet
with the binary value of a SYN:</p>

<p>00010010 SYN-ACK 00000010 SYN AND 00000010 (we want SYN)
AND 00000010 (we want SYN) -------- -------- = 00000010 =
00000010</p>

<p>We see that this AND operation delivers the same result
regardless whether ACK or another TCP control bit is set.
The decimal representa- tion of the AND value as well as the
result of this operation is 2 (binary 00000010), so we know
that for packets with SYN set the follow- ing relation must
hold true:</p>

<p>( ( value of octet 13 ) AND ( 2 ) ) == ( 2 )</p>

<p>This points us to the tcpdump filter expression tcpdump
-i xl0tcp[13] &amp; 2 == 2</p>

<p>Note that you should use single quotes or a backslash in
the expression to hide the AND (&amp;) special character
from the shell.</p>

<p>UDP Packets</p>

<p>UDP format is illustrated by this rwho packet:
actinide.who &gt; broadcast.who: udp 84 This says that port
who on host actinide sent a udp datagram to port who on host
broadcast, the Internet broadcast address. The packet con-
tained 84 bytes of user data.</p>

<p>Some UDP services are recognized (from the source or
destination port number) and the higher level protocol
information printed. In particu- lar, Domain Name service
requests (RFC-1034/1035) and Sun RPC calls (RFC-1050) to
NFS.</p>

<p>UDP Name Server Requests</p>

<p>(N.B.:The following description assumes familiarity with
the Domain Service protocol described in RFC-1035. If you
are not familiar with the protocol, the following
description will appear to be written in greek.)</p>

<p>Name server requests are formatted as src &gt; dst: id
op? flags qtype qclass name (len) h2opolo.1538 &gt;
helios.domain: 3+ A? ucbvax.berkeley.edu. (37) Host h2opolo
asked the domain server on helios for an address record
(qtype=A) associated with the name ucbvax.berkeley.edu. The
query id was 3. The + indicates the recursion desired flag
was set. The query length was 37 bytes, not including the
UDP and IP protocol head- ers. The query operation was the
normal one, Query, so the op field was omitted. If the op
had been anything else, it would have been printed between
the 3 and the +. Similarly, the qclass was the normal one,
C_IN, and omitted. Any other qclass would have been printed
immediately after the A.</p>

<p>A few anomalies are checked and may result in extra
fields enclosed in square brackets: If a query contains an
answer, authority records or additional records section,
ancount, nscount, or arcount are printed as [na], [nn] or
[nau] where n is the appropriate count. If any of the
response bits are set (AA, RA or rcode) or any of the must
be zero bits are set in bytes two and three, [b2&amp;3=x] is
printed, where x is the hex value of header bytes two and
three.</p>

<p>UDP Name Server Responses</p>

<p>Name server responses are formatted as src &gt; dst: id
op rcode flags a/n/au type class data (len) helios.domain
&gt; h2opolo.1538: 3 3/3/7 A 128.32.137.3 (273)
helios.domain &gt; h2opolo.1537: 2 NXDomain* 0/1/0 (97) In
the first example, helios responds to query id 3 from
h2opolo with 3 answer records, 3 name server records and 7
additional records. The first answer record is type A
(address) and its data is internet address 128.32.137.3. The
total size of the response was 273 bytes, excluding UDP and
IP headers. The op (Query) and response code (NoEr- ror)
were omitted, as was the class (C_IN) of the A record.</p>

<p>In the second example, helios responds to query 2 with a
response code of non-existent domain (NXDomain) with no
answers, one name server and no authority records. The *
indicates that the authoritative answer bit was set. Since
there were no answers, no type, class or data were
printed.</p>

<p>Other flag characters that might appear are - (recursion
available, RA, not set) and | (truncated message, TC, set).
If the question section doesnt contain exactly one entry,
[nq] is printed.</p>

<p>Note that name server requests and responses tend to be
large and the default snaplen of 68 bytes may not capture
enough of the packet to print. Use the -s flag to increase
the snaplen if you need to seri- ously investigate name
server traffic. -s 128 has worked well for me.</p>

<p>SMB/CIFS decoding</p>

<p>tcpdump now includes fairly extensive SMB/CIFS/NBT
decoding for data on UDP/137, UDP/138 and TCP/139. Some
primitive decoding of IPX and Net- BEUI SMB data is also
done.</p>

<p>By default a fairly minimal decode is done, with a much
more detailed decode done if -v is used. Be warned that with
-v a single SMB packet may take up a page or more, so only
use -v if you really want all the gory details.</p>

<p>For information on SMB packet formats and what all te
fields mean see www.cifs.org or the pub/samba/specs/
directory on your favorite samba.org mirror site. The SMB
patches were written by Andrew Tridgell
(tridge@samba.org).</p>

<p>NFS Requests and Replies</p>

<p>Sun NFS (Network File System) requests and replies are
printed as: src.xid &gt; dst.nfs: len op args src.nfs &gt;
dst.xid: reply stat len op results</p>

<p>sushi.6709 &gt; wrl.nfs: 112 readlink fh 21,24/10.73165
wrl.nfs &gt; sushi.6709: reply ok 40 readlink
&quot;../var&quot; sushi.201b &gt; wrl.nfs: 144 lookup fh
9,74/4096.6878 &quot;xcolors&quot; wrl.nfs &gt; sushi.201b:
reply ok 128 lookup fh 9,74/4134.3150 In the first line,
host sushi sends a transaction with id 6709 to wrl (note
that the number following the src host is a transaction id,
not the source port). The request was 112 bytes, excluding
the UDP and IP headers. The operation was a readlink (read
symbolic link) on file handle (fh) 21,24/10.731657119. (If
one is lucky, as in this case, the file handle can be
interpreted as a major,minor device number pair, followed by
the inode number and generation number.) Wrl replies ok with
the contents of the link.</p>

<p>In the third line, sushi asks wrl to lookup the name
xcolors in directory file 9,74/4096.6878. Note that the data
printed depends on the operation type. The format is
intended to be self explanatory if read in conjunction with
an NFS protocol spec.</p>

<p>If the -v (verbose) flag is given, additional
information is printed. For example:</p>

<p>sushi.1372a &gt; wrl.nfs: 148 read fh 21,11/12.195 8192
bytes @ 24576 wrl.nfs &gt; sushi.1372a: reply ok 1472 read
REG 100664 ids 417/0 sz 29388 (-v also prints the IP header
TTL, ID, length, and fragmentation fields, which have been
omitted from this example.) In the first line, sushi asks
wrl to read 8192 bytes from file 21,11/12.195, at byte off-
set 24576. Wrl replies ok ; the packet shown on the second
line is the first fragment of the reply, and hence is only
1472 bytes long (the other bytes will follow in subsequent
fragments, but these fragments do not have NFS or even UDP
headers and so might not be printed, depending on the filter
expression used). Because the -v flag is given, some of the
file attributes (which are returned in addition to the file
data) are printed: the file type (REG, for regular file),
the file mode (in octal), the uid and gid, and the file
size.</p>

<p>If the -v flag is given more than once, even more
details are printed.</p>

<p>Note that NFS requests are very large and much of the
detail wont be printed unless snaplen is increased. Try
using -s 192 to watch NFS traffic.</p>

<p>NFS reply packets do not explicitly identify the RPC
operation. Instead, tcpdump keeps track of recent requests,
and matches them to the replies using the transaction ID. If
a reply does not closely follow the corresponding request,
it might not be parsable.</p>

<p>AFS Requests and Replies</p>

<p>Transarc AFS (Andrew File System) requests and replies
are printed as:</p>

<p>src.sport &gt; dst.dport: rx packet-type src.sport &gt;
dst.dport: rx packet-type service call call-name args
src.sport &gt; dst.dport: rx packet-type service reply
call-name args</p>

<p>elvis.7001 &gt; pike.afsfs: rx data fs call rename old
fid 536876964/1/1 &quot;.newsrc.new&quot; new fid
536876964/1/1 &quot;.newsrc&quot; pike.afsfs &gt;
elvis.7001: rx data fs reply rename In the first line, host
elvis sends a RX packet to pike. This was a RX data packet
to the fs (fileserver) service, and is the start of an RPC
call. The RPC call was a rename, with the old directory file
id of 536876964/1/1 and an old filename of .newsrc.new , and
a new directory file id of 536876964/1/1 and a new filename
of .newsrc . The host pike responds with a RPC reply to the
rename call (which was success- ful, because it was a data
packet and not an abort packet).</p>

<p>In general, all AFS RPCs are decoded at least by RPC
call name. Most AFS RPCs have at least some of the arguments
decoded (generally only the interesting arguments, for some
definition of interesting).</p>

<p>The format is intended to be self-describing, but it
will probably not be useful to people who are not familiar
with the workings of AFS and RX.</p>

<p>If the -v (verbose) flag is given twice, acknowledgement
packets and additional header information is printed, such
as the the RX call ID, call number, sequence number, serial
number, and the RX packet flags.</p>

<p>If the -v flag is given twice, additional information is
printed, such as the the RX call ID, serial number, and the
RX packet flags. The MTU negotiation information is also
printed from RX ack packets.</p>

<p>If the -v flag is given three times, the security index
and service id are printed.</p>

<p>Error codes are printed for abort packets, with the
exception of Ubik beacon packets (because abort packets are
used to signify a yes vote for the Ubik protocol).</p>

<p>Note that AFS requests are very large and many of the
arguments wont be printed unless snaplen is increased. Try
using -s 256 to watch AFS traffic.</p>

<p>AFS reply packets do not explicitly identify the RPC
operation. Instead, tcpdump keeps track of recent requests,
and matches them to the replies using the call number and
service ID. If a reply does not closely follow the
corresponding request, it might not be parsable.</p>

<p>KIP AppleTalk (DDP in UDP)</p>

<p>AppleTalk DDP packets encapsulated in UDP datagrams are
de-encapsulated and dumped as DDP packets (i.e., all the UDP
header information is dis- carded). The file
/etc/atalk.names is used to translate AppleTalk net and node
numbers to names. Lines in this file have the form number
name</p>

<p>1.254 ether 16.1 icsd-net 1.254.110 ace The first two
lines give the names of AppleTalk networks. The third line
gives the name of a particular host (a host is distinguished
from a net by the 3rd octet in the number - a net number
must have two octets and a host number must have three
octets.) The number and name should be separated by
whitespace (blanks or tabs). The /etc/atalk.names file may
contain blank lines or comment lines (lines starting with a
#).</p>

<p>AppleTalk addresses are printed in the form
net.host.port</p>

<p>144.1.209.2 &gt; icsd-net.112.220 office.2 &gt;
icsd-net.112.220 jssmag.149.235 &gt; icsd-net.2 (If the
/etc/atalk.names doesnt exist or doesn t contain an entry
for some AppleTalk host/net number, addresses are printed in
numeric form.) In the first example, NBP (DDP port 2) on net
144.1 node 209 is sending to whatever is listening on port
220 of net icsd node 112. The second line is the same except
the full name of the source node is known ( office ). The
third line is a send from port 235 on net jssmag node 149 to
broadcast on the icsd-net NBP port (note that the broadcast
address (255) is indicated by a net name with no host number
- for this reason its a good idea to keep node names and net
names distinct in /etc/atalk.names).</p>

<p>NBP (name binding protocol) and ATP (AppleTalk
transaction protocol) packets have their contents
interpreted. Other protocols just dump the protocol name (or
number if no name is registered for the protocol) and packet
size.</p>

<p>NBP packets are formatted like the following examples:
icsd-net.112.220 &gt; jssmag.2: nbp-lkup 190:
&quot;=:LaserWriter@*&quot; jssmag.209.2 &gt;
icsd-net.112.220: nbp-reply 190:
&quot;RM1140:LaserWriter@*&quot; 250 techpit.2 &gt;
icsd-net.112.220: nbp-reply 190:
&quot;techpit:LaserWriter@*&quot; 186 The first line is a
name lookup request for laserwriters sent by net icsd host
112 and broadcast on net jssmag. The nbp id for the lookup
is 190. The second line shows a reply for this request (note
that it has the same id) from host jssmag.209 saying that it
has a laserwriter resource named &quot;RM1140&quot;
registered on port 250. The third line is another reply to
the same request saying host techpit has laserwriter
&quot;techpit&quot; registered on port 186.</p>

<p>ATP packet formatting is demonstrated by the following
example: jssmag.209.165 &gt; helios.132: atp-req
12266&lt;0-7&gt; 0xae030001 helios.132 &gt; jssmag.209.165:
atp-resp 12266:0 (512) 0xae040000 helios.132 &gt;
jssmag.209.165: atp-resp 12266:1 (512) 0xae040000 helios.132
&gt; jssmag.209.165: atp-resp 12266:2 (512) 0xae040000
helios.132 &gt; jssmag.209.165: atp-resp 12266:3 (512)
0xae040000 helios.132 &gt; jssmag.209.165: atp-resp 12266:4
(512) 0xae040000 helios.132 &gt; jssmag.209.165: atp-resp
12266:5 (512) 0xae040000 helios.132 &gt; jssmag.209.165:
atp-resp 12266:6 (512) 0xae040000 helios.132 &gt;
jssmag.209.165: atp-resp*12266:7 (512) 0xae040000
jssmag.209.165 &gt; helios.132: atp-req 12266&lt;3,5&gt;
0xae030001 helios.132 &gt; jssmag.209.165: atp-resp 12266:3
(512) 0xae040000 helios.132 &gt; jssmag.209.165: atp-resp
12266:5 (512) 0xae040000 jssmag.209.165 &gt; helios.132:
atp-rel 12266&lt;0-7&gt; 0xae030001 jssmag.209.133 &gt;
helios.132: atp-req* 12267&lt;0-7&gt; 0xae030002 Jssmag.209
initiates transaction id 12266 with host helios by request-
ing up to 8 packets (the &lt;0-7&gt;). The hex number at the
end of the line is the value of the userdata field in the
request.</p>

<p>Helios responds with 8 512-byte packets. The :digit
following the transaction id gives the packet sequence
number in the transaction and the number in parens is the
amount of data in the packet, excluding the atp header. The
* on packet 7 indicates that the EOM bit was set.</p>

<p>Jssmag.209 then requests that packets 3 &amp; 5 be
retransmitted. Helios resends them then jssmag.209 releases
the transaction. Finally, jss- mag.209 initiates the next
request. The * on the request indicates that XO (exactly
once) was not set.</p>

<p>IP Fragmentation</p>

<p>Fragmented Internet datagrams are printed as (frag
id:size@offset+) (frag id:size@offset) (The first form
indicates there are more fragments. The second indi- cates
this is the last fragment.)</p>

<p>Id is the fragment id. Size is the fragment size (in
bytes) excluding the IP header. Offset is this fragments
offset (in bytes) in the original datagram.</p>

<p>The fragment information is output for each fragment.
The first frag- ment contains the higher level protocol
header and the frag info is printed after the protocol info.
Fragments after the first contain no higher level protocol
header and the frag info is printed after the source and
destination addresses. For example, here is part of an ftp
from arizona.edu to lbl-rtsg.arpa over a CSNET connection
that doesnt appear to handle 576 byte datagrams:
arizona.ftp-data &gt; rtsg.1170: . 1024:1332(308) ack 1 win
4096 (frag 595a:328@0+) arizona &gt; rtsg: (frag
595a:204@328) rtsg.1170 &gt; arizona.ftp-data: . ack 1536
win 2560 There are a couple of things to note here: First,
addresses in the 2nd line dont include port numbers. This is
because the TCP protocol information is all in the first
fragment and we have no idea what the port or sequence
numbers are when we print the later fragments. Sec- ond, the
tcp sequence information in the first line is printed as if
there were 308 bytes of user data when, in fact, there are
512 bytes (308 in the first frag and 204 in the second). If
you are looking for holes in the sequence space or trying to
match up acks with packets, this can fool you.</p>

<p>A packet with the IP dont fragment flag is marked with a
trailing (DF).</p>

<p>Timestamps</p>

<p>By default, all output lines are preceded by a
timestamp. The times- tamp is the current clock time in the
form hh:mm:ss.frac and is as accurate as the kernels clock.
The timestamp reflects the time the kernel first saw the
packet. No attempt is made to account for the time lag
between when the Ethernet interface removed the packet from
the wire and when the kernel serviced the new packet
interrupt.</p>

<p>SEE ALSO stty(1), pcap(3), bpf(4), nit(4P),
pfconfig(8)</p>

<p>AUTHORS The original authors are:</p>

<p>Van Jacobson, Craig Leres and Steven McCanne, all of the
Lawrence Berkeley National Laboratory, University of
California, Berkeley, CA.</p>

<p>It is currently being maintained by tcpdump.org.</p>

<p>The current version is available via http:</p>

<p>http://www.tcpdump.org/</p>

<p>The original distribution is available via anonymous
ftp:</p>

<p>ftp://ftp.ee.lbl.gov/tcpdump.tar.Z</p>

<p>IPv6/IPsec support is added by WIDE/KAME project. This
program uses Eric Youngs SSLeay library, under specific
configuration.</p>

<p>BUGS Please send problems, bugs, questions, desirable
enhancements, etc. to:</p>

<p>tcpdump-workers@tcpdump.org</p>

<p>Please send source code contributions, etc. to:</p>

<p>patches@tcpdump.org</p>

<p>NIT doesnt let you watch your own outbound traffic, BPF
will. We rec- ommend that you use the latter.</p>

<p>On Linux systems with 2.0[.x] kernels:</p>

<p>packets on the loopback device will be seen twice;</p>

<p>packet filtering cannot be done in the kernel, so that
all pack- ets must be copied from the kernel in order to be
filtered in user mode;</p>

<p>all of a packet, not just the part thats within the
snapshot length, will be copied from the kernel (the 2.0[.x]
packet cap- ture mechanism, if asked to copy only part of a
packet to user- land, will not report the true length of the
packet; this would cause most IP packets to get an error
from tcpdump);</p>

<p>capturing on some PPP devices wont work correctly.</p>

<p>We recommend that you upgrade to a 2.2 or later
kernel.</p>

<p>Some attempt should be made to reassemble IP fragments
or, at least to compute the right length for the higher
level protocol.</p>

<p>Name server inverse queries are not dumped correctly:
the (empty) ques- tion section is printed rather than real
query in the answer section. Some believe that inverse
queries are themselves a bug and prefer to fix the program
generating them rather than tcpdump.</p>

<p>A packet trace that crosses a daylight savings time
change will give skewed time stamps (the time change is
ignored).</p>

<p>Filter expressions on fields other than those in Token
Ring headers will not correctly handle source-routed Token
Ring packets.</p>

<p>Filter expressions on fields other than those in 802.11
headers will not correctly handle 802.11 data packets with
both To DS and From DS set.</p>

<p>ip6 proto should chase header chain, but at this moment
it does not. ip6 protochain is supplied for this
behavior.</p>

<p>Arithmetic expression against transport layer headers,
like tcp[0], does not work against IPv6 packets. It only
looks at IPv4 packets.</p>

<p>18 April 2005 TCPDUMP(8)</p>
<hr>
</body>
</html>
