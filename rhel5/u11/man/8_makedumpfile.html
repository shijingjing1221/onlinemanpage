<!-- Creator     : groff version 1.18.1.1 -->
<!-- CreationDate: Sat Nov 12 05:15:51 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>MAKEDUMPFILE(8) Linux System Administrator s Manual
MAKEDUMPFILE(8)</p>

<p>NAME makedumpfile - make a small dumpfile of kdump</p>

<p>SYNOPSIS makedumpfile [OPTION] [-x VMLINUX|-i
VMCOREINFO] VMCORE DUMPFILE makedumpfile -F [OPTION] [-x
VMLINUX|-i VMCOREINFO] VMCORE makedumpfile -R DUMPFILE
makedumpfile -g VMCOREINFO -x VMLINUX makedumpfile -E
[--xen-syms XEN-SYMS|--xen-vmcoreinfo VMCOREINFO] VMCORE
DUMPFILE makedumpfile -h makedumpfile -v</p>

<p>DESCRIPTION With kdump, the memory image of the first
kernel (called &quot;panicked ker- nel&quot;) can be taken
as /proc/vmcore while the second kernel (called &quot;kdump
kernel&quot; or &quot;capture kernel&quot;) is running. This
document repre- sents /proc/vmcore as VMCORE. makedumpfile
makes a small DUMPFILE by compressing dump data or by
excluding unnecessary pages for analysis, or both.
makedumpfile needs the first kernel s VMLINUX with debug
information, so that it can distinguish unnecessary pages by
analyzing how the first kernel uses the memory.</p>

<p>makedumpfile can exclude the following types of pages
while copying VMCORE to DUMPFILE, and a user can choose
which type of pages will be excluded. - Pages filled with
zero - Cache pages - User process data pages - Free
pages</p>

<p>makedumpfile provides two DUMPFILE formats (the ELF
format and the kdump-compressed format). By default,
makedumpfile makes a DUMPFILE in the kdump-compressed
format. The kdump-compressed format is readable only with
the crash utility, and it can be smaller than the ELF format
because of the compression support. The ELF format is
readable with GDB and the crash utility. If a user wants to
use GDB, DUMPFILE format has to be explicitly specified to
be the ELF format.</p>

<p>To analyze the first kernels memory usage, makedumpfile
can refer to VMCOREINFO instead of VMLINUX. VMCOREINFO
contains the first kernels information (structure size,
field offset, etc.), and VMCOREINFO is small enough to be
included into the second kernels initrd. If the second
kernel is running on its initrd without mounting a root file
system, makedumpfile cannot refer to VMLINUX because the
second kernels initrd cannot include a large file like
VMLINUX. To solve the problem, makedumpfile makes VMCOREINFO
beforehand, and it refers to VMCOREINFO instead of VMLINUX
while the second kernel is running.</p>

<p>If the second kernel is running on its initrd without
mounting any file system, a user needs to transport the dump
data to a remote host. To transport the dump data by SSH,
makedumpfile outputs the dump data in the intermediate
format (the flattened format) to the standard output. By
piping the output data to SSH, a user can transport the dump
data to a remote host. Note that analysis tools cannot read
the flattened for- mat directly, so on a remote host the
received data in the flattened format needs to be rearranged
to a readable DUMPFILE format by make- dumpfile (or
makedumpfile-R.pl).</p>

<p>OPTIONS -c Compress dump data by each page. A user
cannot specify this option with -E option, because the ELF
format does not support compressed data. Example: #
makedumpfile -c -d 31 -x vmlinux /proc/vmcore dumpfile</p>

<p>-d dump_level Specify the type of unnecessary page for
analysis. Pages of the specified type are not copied to
DUMPFILE. The page type marked in the following table is
excluded. A user can spec- ify multiple page types by
setting the sum of each page type for dump_level. The
maximum of dump_level is 31. Note that dump_level for Xen
dump filtering is 0 or 1. Example: # makedumpfile -d 11 -x
vmlinux /proc/vmcore dumpfile</p>

<p>dump | zero | cache|cache | user | free level | page |
page |private| data | page
-------+------+------+-------+------+------ 0 | | | | | 1 |
X | | | | 2 | | X | | | 3 | X | X | | | 4 | | X | X | | 5 |
X | X | X | | 6 | | X | X | | 7 | X | X | X | | 8 | | | | X
| 9 | X | | | X | 10 | | X | | X | 11 | X | X | | X | 12 | |
X | X | X | 13 | X | X | X | X | 14 | | X | X | X | 15 | X |
X | X | X | 16 | | | | | X 17 | X | | | | X 18 | | X | | | X
19 | X | X | | | X 20 | | X | X | | X 21 | X | X | X | | X
22 | | X | X | | X 23 | X | X | X | | X 24 | | | | X | X 25
| X | | | X | X 26 | | X | | X | X 27 | X | X | | X | X 28 |
| X | X | X | X 29 | X | X | X | X | X 30 | | X | X | X | X
31 | X | X | X | X | X</p>

<p>--dump-dmesg This option overrides the normal behavior
of makedumpfile. Instead of compressing and filtering a
vmcore to make it smaller, it simply extracts the dmesg log
from the core and writes it to the specified output file.
This option assumes that a vmcoreinfo section is present in
the vmcore file and con- tains the symbols for the location
of the dmesg log</p>

<p>-E Create DUMPFILE in the ELF format. This option cannot
be specified with -c option, because the ELF format does not
support compressed data. Example: # makedumpfile -E -d 31 -x
vmlinux /proc/vmcore dumpfile</p>

<p>-f Force existing DUMPFILE to be overwritten. Example: #
makedumpfile -f -d 31 -x vmlinux /proc/vmcore dumpfile This
command overwrites DUMPFILE even if it already exists.</p>

<p>-x VMLINUX Specify the first kernels VMLINUX with debug
information to analyze the first kernels memory usage. The
page size of the first kernel and the second kernel should
match. Example: # makedumpfile -d 31 -x vmlinux /proc/vmcore
dumpfile</p>

<p>-i VMCOREINFO Specify VMCOREINFO instead of VMLINUX for
analyzing the first kernels memory usage. VMCOREINFO should
be made beforehand by makedumpfile with -g option, and it
contains the first kernel s information. If dump_level is 2
or more and [-x VMLINUX] is not specified, this option is
necessary. Example: # makedumpfile -d 31 -i vmcoreinfo
/proc/vmcore dumpfile</p>

<p>-g VMCOREINFO Generate VMCOREINFO from the first kernel
s VMLINUX with debug information. VMCOREINFO must be
generated on the system that is running the first kernel.
With -i option, a user can specify VMCOREINFO gen- erated on
the other system that is running the same first ker- nel.
[-x VMLINUX] must be specified. Example: # makedumpfile -g
vmcoreinfo -x vmlinux</p>

<p>-F Output the dump data in the flattened format to the
standard output for transporting the dump data by SSH.
Analysis tools cannot read the flattened format directly.
For analysis, the dump data in the flattened format should
be rear- ranged to a normal DUMPFILE (readable with analysis
tools) by -R option. By which option is specified with -F
option, the format of the rearranged DUMPFILE is fixed. In
other words, it is impossible to specify the DUMPFILE format
when the dump data is rearranged with -R option. If
specifying -E option with -F option, the format of the
rearranged DUMPFILE is the ELF format. Otherwise, it is the
kdump-compressed format. Example: # makedumpfile -F -c -d 31
-x vmlinux /proc/vmcore | ssh user@host &quot;cat &gt;
dumpfile.tmp&quot; # makedumpfile -F -c -d 31 -x vmlinux
/proc/vmcore | ssh user@host &quot;makedumpfile -R
dumpfile&quot; # makedumpfile -F -E -d 31 -i vmcoreinfo
/proc/vmcore | ssh user@host &quot;makedumpfile -R
dumpfile&quot;</p>

<p>-R Rearrange the dump data in the flattened format from
the stan- dard input to a normal DUMPFILE (readable with
analysis tools). Example: # makedumpfile -R dumpfile &lt;
dumpfile.tmp # makedumpfile -F -d 31 -x vmlinux /proc/vmcore
| ssh user@host &quot;makedumpfile -R dumpfile&quot;</p>

<p>Instead of using -R option, a perl script
&quot;makedumpfile-R.pl&quot; rearranges the dump data in
the flattened format to a normal DUMPFILE, too. The perl
script does not depend on architecture, and most systems
have perl command. Even if a remote host does not have
makedumpfile, it is possible to rearrange the dump data in
the flattened format to a readable DUMPFILE on a remote host
by running this script. Example: # makedumpfile -F -d 31 -x
vmlinux /proc/vmcore | ssh user@host &quot;makedumpfile-R.pl
dumpfile&quot;</p>

<p>--xen-syms XEN-SYMS Specify the XEN-SYMS with debug
information to analyze the xens memory usage. This option
extracts the part of xen and domain-0. -E option must be
specified with this option. Example: # makedumpfile -E
--xen-syms xen-syms /proc/vmcore dumpfile</p>

<p>--xen-vmcoreinfo VMCOREINFO Specify VMCOREINFO instead
of XEN-SYMS for analyzing the xens memory usage. VMCOREINFO
should be made beforehand by makedumpfile with -g option,
and it contains the xens information. -E option must be
specified with this option. Example: # makedumpfile -E
--xen-vmcoreinfo VMCOREINFO /proc/vmcore dump- file</p>

<p>--message-level message_level Specify the message types.
Users can restrict outputs printed by specifying
message_level with this option. The message type marked with
an X in the fol- lowing table is printed to standard error
output. For example, according to the table, specifying 7 as
message_level means progress indicator, common message, and
error message are printed, and this is a default value. Note
that the maximum value of message_level is 15.</p>

<p>message | progress | common | error | debug level |
indicator| message | message | message
---------+----------+---------+---------+--------- 0 | | | |
1 | X | | | 2 | | X | | 3 | X | X | | 4 | | | X | 5 | X | |
X | 6 | | X | X | * 7 | X | X | X | 8 | | | | X 9 | X | | |
X 10 | | X | | X 11 | X | X | | X 12 | | | X | X 13 | X | |
X | X 14 | | X | X | X 15 | X | X | X | X</p>

<p>-D Print debugging message.</p>

<p>-h Show help message.</p>

<p>-v Show the version of makedumpfile.</p>

<p>DIAGNOSTICS makedumpfile exits with the following
value.</p>

<p>0 : makedumpfile succeeded.</p>

<p>1 : makedumpfile failed without the following
reasons.</p>

<p>2 : makedumpfile failed due to the different version
between VMLINUX and VMCORE.</p>

<p>3 : makedumpfile failed due to the analysis error of the
memory.</p>

<p>AUTHORS Written by Masaki Tachibana, and Kenichi
Ohmichi.</p>

<p>SEE ALSO crash(8), gdb(1), kexec(8)</p>

<p>makedumpfile v1.2.0 September 2007 MAKEDUMPFILE(8)</p>
<hr>
</body>
</html>
