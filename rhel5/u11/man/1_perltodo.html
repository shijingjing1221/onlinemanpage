<!-- Creator     : groff version 1.18.1.1 -->
<!-- CreationDate: Sat Nov 12 05:18:48 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>PERLTODO(1) Perl Programmers Reference Guide
PERLTODO(1)</p>

<p>NAME perltodo - Perl TO-DO List</p>

<p>DESCRIPTION This is a list of wishes for Perl. The tasks
we think are smaller or easier are listed first. Anyone is
welcome to work on any of these, but its a good idea to
first contact perl5-porters@perl.org to avoid duplication of
effort. By all means contact a pumpking privately first if
you prefer.</p>

<p>Whilst patches to make the list shorter are most
welcome, ideas to add to the list are also encouraged. Check
the perl5-porters archives for past ideas, and any
discussion about them. One set of archives may be found
at:</p>


<p>http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/</p>

<p>What can we offer you in return? Fame, fortune, and
everlasting glory? Maybe not, but if your patch is
incorporated, then well add your name to the AUTHORS file,
which ships in the official distribution. How many other
programming languages offer you 1 line of immortality?</p>

<p>The roadmap to 5.10 The roadmap to 5.10 envisages
feature based releases, as various items in this TODO are
completed.</p>

<p>Needed for a 5.9.4 release</p>

<p>&middot; Review assertions. Review syntax to combine
assertions. Assertions could take advantage of the lexical
pragmas work. &quot;What hooks would assertions
need?&quot;</p>

<p>Needed for a 5.9.5 release</p>

<p>* Implement &quot;_ prototype character&quot; *
Implement &quot;state variables&quot;</p>

<p>Needed for a 5.9.6 release</p>

<p>Stabilisation. If all goes well, this will be the
equivalent of a 5.10-beta.</p>

<p>Tasks that only need Perl knowledge common test code for
timed bail out</p>

<p>Write portable self destruct code for tests to stop them
burning CPU in infinite loops. This needs to avoid using
alarm, as some of the tests are testing alarm/sleep or
timers.</p>

<p>POD -&gt; HTML conversion in the core still sucks</p>

<p>Which is crazy given just how simple POD purports to be,
and how simple HTML can be. It s not actually as simple as
it sounds, particularly with the flexibility POD allows for
&quot;=item&quot;, but it would be good to improve the
visual appeal of the HTML generated, and to avoid it having
any validation errors. See also &quot;make HTML install
work&quot;, as the layout of installation tree is needed to
improve the cross-linking.</p>

<p>The addition of &quot;Pod::Simple&quot; and its related
modules may make this task easier to complete.</p>

<p>Parallel testing</p>

<p>The core regression test suite is getting ever more
comprehensive, which has the side effect that it takes
longer to run. This isnt so good. Investigate whether it
would be feasible to give the harness script the option of
running sets of tests in parallel. This would be useful for
tests in t/op/*.t and t/uni/*.t and maybe some sets of tests
in lib/.</p>

<p>Questions to answer</p>

<p>1 How does screen layout work when you re running more
than one test?</p>

<p>2 How does the caller of test specify how many tests to
run in paral- lel?</p>

<p>3 How do setup/teardown tests identify themselves?</p>

<p>Pugs already does parallel testing - can their approach
be re-used?</p>

<p>Make Schwern poorer</p>

<p>We should have for everything. When all the cores
modules are tested, Schwern has promised to donate to $500
to TPF. We may need volunteers to hold him upside down and
shake vigorously in order to actually extract the cash.</p>

<p>See t/lib/1_compile.t for the 3 remaining modules that
need tests.</p>

<p>Improve the coverage of the core tests</p>

<p>Use Devel::Cover to ascertain the cores test coverage,
then add tests that are currently missing.</p>

<p>test B</p>

<p>A full test suite for the B module would be nice.</p>

<p>A decent benchmark</p>

<p>&quot;perlbench&quot; seems impervious to any recent
changes made to the perl core. It would be useful to have a
reasonable general benchmarking suite that roughly
represented what current perl programs do, and mea- surably
reported whether tweaks to the core improve, degrade or dont
really affect performance, to guide people attempting to
optimise the guts of perl. Gisle would welcome new tests for
perlbench.</p>

<p>fix tainting bugs</p>

<p>Fix the bugs revealed by running the test suite with the
&quot;-t&quot; switch (via &quot;make
test.taintwarn&quot;).</p>

<p>Dual life everything</p>

<p>As part of the &quot;dists&quot; plan, anything that
doesnt belong in the small- est perl distribution needs to
be dual lifed. Anything else can be too. Figure out what
changes would be needed to package that module and its tests
up for CPAN, and do so. Test it with older perl releases,
and fix the problems you find.</p>

<p>Improving &quot;threads::shared&quot;</p>

<p>Investigate whether &quot;threads::shared&quot; could
share aggregates properly with only Perl level changes to
shared.pm</p>

<p>POSIX memory footprint</p>

<p>Ilya observed that use POSIX; eats memory like there s
no tomorrow, and at various times worked to cut it down.
There is probably still fat to cut out - for example POSIX
passes Exporter some very memory hungry data structures.</p>

<p>Tasks that need a little sysadmin-type knowledge Or if
you prefer, tasks that you would learn from, and broaden
your skills base...</p>

<p>Relocatable perl</p>

<p>The C level patches needed to create a relocatable perl
binary are done, as is the work on Config.pm. All thats left
to do is the &quot;Con- figure&quot; tweaking to let people
specify how they want to do the install.</p>

<p>make HTML install work</p>

<p>There is an &quot;installhtml&quot; target in the
Makefile. Its marked as &quot;experimental&quot;. It would
be good to get this tested, make it work reli- ably, and
remove the &quot;experimental&quot; tag. This would
include</p>

<p>1 Checking that cross linking between various parts of
the documenta- tion works. In particular that links work
between the modules (files with POD in lib/) and the core
documentation (files in pod/)</p>

<p>2 Work out how to split &quot;perlfunc&quot; into
chunks, preferably one per function group, preferably with
general case code that could be used elsewhere. Challenges
here are correctly identifying the groups of functions that
go together, and making the right named external cross-links
point to the right page. Things to be aware of are
&quot;-X&quot;, groups such as &quot;getpwnam&quot; to
&quot;endservent&quot;, two or more &quot;=items&quot;
giving the different parameter lists, such as</p>

<p>=item substr EXPR,OFFSET,LENGTH,REPLACEMENT</p>

<p>=item substr EXPR,OFFSET,LENGTH</p>

<p>=item substr EXPR,OFFSET</p>

<p>and different parameter lists having different meanings.
(eg &quot;select&quot;)</p>

<p>compressed man pages</p>

<p>Be able to install them. This would probably need a
configure test to see how the system does compressed man
pages (same directory/different directory? same
filename/different filename), as well as tweaking the
installman script to compress as necessary.</p>

<p>Add a code coverage target to the Makefile</p>

<p>Make it easy for anyone to run Devel::Cover on the core
s tests. The steps to do this manually are roughly</p>

<p>&middot; do a normal &quot;Configure&quot;, but include
Devel::Cover as a module to install (see INSTALL for how to
do this)</p>

<p>&middot; make perl</p>

<p>&middot; cd t; HARNESS_PERL_SWITCHES=-MDevel::Cover
./perl -I../lib harness</p>

<p>&middot; Process the resulting Devel::Cover database</p>

<p>This just give you the coverage of the .pms. To also get
the C level coverage you need to</p>

<p>&middot; Additionally tell &quot;Configure&quot; to use
the appropriate C compiler flags for &quot;gcov&quot;</p>

<p>&middot; make perl.gcov</p>

<p>(instead of &quot;make perl&quot;)</p>

<p>&middot; After running the tests run &quot;gcov&quot; to
generate all the .gcov files. (Including down in the
subdirectories of ext/</p>

<p>&middot; (From the top level perl directory) run
&quot;gcov2perl&quot; on all the &quot;.gcov&quot; files to
get their stats into the cover_db directory.</p>

<p>&middot; Then process the Devel::Cover database</p>

<p>It would be good to add a single switch to
&quot;Configure&quot; to specify that you wanted to perform
perl level coverage, and another to specify C level
coverage, and have &quot;Configure&quot; and the Makefile do
all the right things automatically.</p>

<p>Make Config.pm cope with differences between build and
installed perl</p>

<p>Quite often vendors ship a perl binary compiled with
their (pay-for) compilers. People install a free compiler,
such as gcc. To work out how to build extensions, Perl
interrogates %Config, so in this situa- tion %Config
describes compilers that arent there, and extension building
fails. This forces people into choosing between re-compiling
perl themselves using the compiler they have, or only using
modules that the vendor ships.</p>

<p>It would be good to find a way teach
&quot;Config.pm&quot; about the installation setup, possibly
involving probing at install time or later, so that the
%Config in a binary distribution better describes the
installed machine, when the installed machine differs from
the build machine in some significant way.</p>

<p>make parallel builds work</p>

<p>Currently parallel builds (such as &quot;make -j3&quot;)
don t work reliably. We believe that this is due to
incomplete dependency specification in the Makefile. It
would be good if someone were able to track down the causes
of these problems, so that parallel builds worked
properly.</p>

<p>linker specification files</p>

<p>Some platforms mandate that you provide a list of a
shared librarys external symbols to the linker, so the core
already has the infrastruc- ture in place to do this for
generating shared perl libraries. My understanding is that
the GNU toolchain can accept an optional linker
specification file, and restrict visibility just to symbols
declared in that file. It would be good to extend makedef.pl
to support this for- mat, and to provide a means within
&quot;Configure&quot; to enable it. This would allow Unix
users to test that the export list is correct, and to build
a perl that does not pollute the global namespace with
private symbols.</p>

<p>Tasks that need a little C knowledge These tasks would
need a little C knowledge, but dont need any spe- cific
background or experience with XS, or how the Perl
interpreter works</p>

<p>Make it clear from -v if this is the exact official
release</p>

<p>Currently perl from &quot;p4&quot;/&quot;rsync&quot;
ships with a patchlevel.h file that usually defines one
local patch, of the form &quot;MAINT12345&quot; or
&quot;RC1&quot;. The output of perl -v doesnt report that a
perl isn t an official release, and this information can get
lost in bugs reports. Because of this, the minor version
isnt bumped up until RC time, to minimise the possibil- ity
of versions of perl escaping that believe themselves to be
newer than they actually are.</p>

<p>It would be useful to find an elegant way to have the
&quot;this is an interim maintenance release&quot; or
&quot;this is a release candidate&quot; in the terse -v
output, and have it so that it s easy for the pumpking to
remove this just as the release tarball is rolled up. This
way the ver- sion pulled out of rsync would always say
&quot;I m a development release&quot; and it would be safe
to bump the reported minor version as soon as a release
ships, which would aid perl developers.</p>

<p>This task is really about thinking of an elegant way to
arrange the C source such that it s trivial for the Pumpking
to flag &quot;this is an official release&quot; when making
a tarball, yet leave the default source saying &quot;Im not
the official release&quot;.</p>

<p>Tidy up global variables</p>

<p>Theres a note in intrpvar.h</p>

<p>/* These two variables are needed to preserve 5.8.x
bincompat because we cant change function prototypes of two
exported functions. Probably should be taken out of blead
soon, and relevant prototypes changed. */</p>

<p>So doing this, and removing any of the unused variables
still present would be good.</p>

<p>Ordering of &quot;global&quot; variables.</p>

<p>thrdvar.h and intrpvarh define the &quot;global&quot;
variables that need to be per-thread under ithreads, where
the variables are actually elements in a structure. As C
dictates, the variables must be laid out in order of
declaration. There is a comment &quot;/* Important ones in
the first cache line (if alignment is done right) */&quot;
which implies that at some point in the past the ordering
was carefully chosen (at least in part). How- ever, its
clear that the ordering is less than perfect, as currently
there are things such as 7 &quot;bool&quot;s in a row, then
something typically requiring 4 byte alignment, and then an
odd &quot;bool&quot; later on. (&quot;bool&quot;s are
typically defined as &quot;char&quot;s). So it would be good
for someone to review the ordering of the variables, to see
how much alignment padding can be removed.</p>

<p>bincompat functions</p>

<p>There are lots of functions which are retained for
binary compatibil- ity. Clean these up. Move them to
mathom.c, and dont compile for blead?</p>

<p>am I hot or not?</p>

<p>The idea of pp_hot.c is that it contains the hot ops,
the ops that are most commonly used. The idea is that by
grouping them, their object code will be adjacent in the
executable, so they have a greater chance of already being
in the CPU cache (or swapped in) due to being near another
op already in use.</p>

<p>Except that its not clear if these really are the most
commonly used ops. So anyone feeling like exercising their
skill with coverage and profiling tools might want to
determine what ops really are the most commonly used. And in
turn suggest evictions and promotions to achieve a better
pp_hot.c.</p>

<p>emulate the per-thread memory pool on Unix</p>

<p>For Windows, ithreads allocates memory for each thread
from a separate pool, which it discards at thread exit. It
also checks that memory is free()d to the correct pool.
Neither check is done on Unix, so code developed there wont
be subject to such strictures, so can harbour bugs that only
show up when the code reaches Windows.</p>

<p>It would be good to be able to optionally emulate the
Window pool sys- tem on Unix, to let developers who only
have access to Unix, or want to use Unix-specific debugging
tools, check for these problems. To do this would involve
figuring out how the &quot;PerlMem_*&quot; macros wrap
&quot;malloc()&quot; access, and providing a layer that
records/checks the identity of the thread making the call,
and recording all the memory allocated by each thread via
this API so that it can be summarily free()d at thread exit.
One implementation idea would be to increase the size of
allocation, and store the &quot;my_perl&quot; pointer (to
identify the thread) at the start, along with pointers to
make a linked list of blocks for this thread. To avoid
alignment problems it would be necessary to do something
like</p>

<p>union memory_header_padded { struct memory_header { void
*thread_id; /* For my_perl */ void *next; /* Pointer to next
block for this thread */ } data; long double padding; /*
whatever type has maximal alignment constraint */ };</p>

<p>although &quot;long double&quot; might not be the only
type to add to the padding union.</p>

<p>reduce duplication in sv_setsv_flags</p>

<p>&quot;Perl_sv_setsv_flags&quot; has a comment &quot;/*
There&rsquo;s a lot of redundancy below but we&rsquo;re
going for speed here */&quot;</p>

<p>Whilst this was true 10 years ago, the growing disparity
between RAM and CPU speeds mean that the trade offs have
changed. In addition, the duplicate code adds to the
maintenance burden. It would be good to see how much of the
redundancy can be pruned, particular in the less common
paths. (Profiling tools at the ready...). For example, why
does the test for &quot;Cant redefine active sort
subroutine&quot; need to occur in two places?</p>

<p>Tasks that need a knowledge of XS These tasks would need
C knowledge, and roughly the level of knowledge of the perl
API that comes from writing modules that use XS to inter-
face to C.</p>

<p>IPv6</p>

<p>Clean this up. Check everything in core works</p>

<p>shrink &quot;GV&quot;s, &quot;CV&quot;s</p>

<p>By removing unused elements and careful re-ordering, the
structures for &quot;AV&quot;s and &quot;HV&quot;s have
recently been shrunk considerably. It s probable that the
same approach would find savings in &quot;GV&quot;s and
&quot;CV&quot;s, if not all the other
larger-than-&quot;PVMG&quot; types.</p>

<p>merge Perl_sv_2[inpu]v</p>

<p>Theres a lot of code shared between
&quot;Perl_sv_2iv_flags&quot;,
&quot;Perl_sv_2uv_flags&quot;, &quot;Perl_sv_2nv&quot;, and
&quot;Perl_sv_2pv_flags&quot;. It would be interesting to
see if some of it can be merged into common shared static
functions. In particular, &quot;Perl_sv_2uv_flags&quot;
started out as a cut&amp;paste from
&quot;Perl_sv_2iv_flags&quot; around 5.005_50 time, and it
may be possible to replace both with a single function that
returns a value or union which is split out by the macros in
sv.h</p>

<p>UTF8 caching code</p>

<p>The string position/offset cache is not optional. It
should be.</p>

<p>Implicit Latin 1 =&gt; Unicode translation</p>

<p>Conversions from byte strings to UTF-8 currently map
high bit charac- ters to Unicode without translation (or,
depending on how you look at it, by implicitly assuming that
the byte strings are in Latin-1). As perl assumes the C
locale by default, upgrading a string to UTF-8 may change
the meaning of its contents regarding character classes,
case mapping, etc. This should probably emit a warning (at
least).</p>

<p>This task is incremental - even a little bit of work on
it will help.</p>

<p>autovivification</p>

<p>Make all autovivification consistent w.r.t LVALUE/RVALUE
and strict/no strict;</p>

<p>This task is incremental - even a little bit of work on
it will help.</p>

<p>Unicode in Filenames</p>

<p>chdir, chmod, chown, chroot, exec, glob, link, lstat,
mkdir, open, opendir, qx, readdir, readlink, rename, rmdir,
stat, symlink, sysopen, system, truncate, unlink, utime, -X.
All these could potentially accept Unicode filenames either
as input or output (and in the case of system and qx Unicode
in general, as input or output to/from the shell). Whether a
filesystem - an operating system pair understands Unicode in
filenames varies.</p>

<p>Known combinations that have some level of understanding
include Microsoft NTFS, Apple HFS+ (In Mac OS 9 and X) and
Apple UFS (in Mac OS X), NFS v4 is rumored to be Unicode,
and of course Plan 9. How to cre- ate Unicode filenames,
what forms of Unicode are accepted and used (UCS-2, UTF-16,
UTF-8), what (if any) is the normalization form used, and so
on, varies. Finding the right level of interfacing to Perl
requires some thought. Remember that an OS does not
implicate a filesystem.</p>

<p>(The Windows -C command flag &quot;wide API
support&quot; has been at least tem- porarily retired in
5.8.1, and the -C has been repurposed, see perl- run.)</p>

<p>Unicode in %ENV</p>

<p>Currently the %ENV entries are always byte strings.</p>

<p>use lessmemory</p>

<p>Investigate trade offs to switch out perl s choices on
memory usage. Particularly perl should be able to give
memory back.</p>

<p>This task is incremental - even a little bit of work on
it will help.</p>

<p>Re-implement &quot;:unique&quot; in a way that is
actually thread-safe</p>

<p>The old implementation made bad assumptions on several
levels. A good 90% solution might be just to make
&quot;:unique&quot; work to share the string buffer of
SvPVs. That way large constant strings can be shared between
ithreads, such as the configuration information in
Config.</p>

<p>Make tainting consistent</p>

<p>Tainting would be easier to use if it didn t take
documented shortcuts and allow taint to &quot;leak&quot;
everywhere within an expression.</p>

<p>readpipe(LIST)</p>

<p>system() accepts a LIST syntax (and a PROGRAM LIST
syntax) to avoid running a shell. readpipe() (the function
behind qx//) could be simi- larly extended.</p>

<p>Tasks that need a knowledge of the interpreter These
tasks would need C knowledge, and knowledge of how the
inter- preter works, or a willingness to learn.</p>

<p>lexical pragmas</p>

<p>Document the new support for lexical pragmas in 5.9.3
and how %^H works. Maybe &quot;re&quot;,
&quot;encoding&quot;, maybe other pragmas could be made
lexi- cal.</p>

<p>Attach/detach debugger from running program</p>

<p>The old perltodo notes &quot;With &quot;gdb&quot;, you
can attach the debugger to a running program if you pass the
process ID. It would be good to do this with the Perl
debugger on a running Perl program, although Im not sure how
it would be done.&quot; ssh and screen do this with named
pipes in /tmp. Maybe we can too.</p>

<p>Constant folding</p>

<p>The peephole optimiser should trap errors during
constant folding, and give up on the folding, rather than
bailing out at compile time. It is quite possible that the
unfoldable constant is in unreachable code, eg something
akin to &quot;$a = 0/0 if 0;&quot;</p>

<p>LVALUE functions for lists</p>

<p>The old perltodo notes that lvalue functions dont work
for list or hash slices. This would be good to fix.</p>

<p>LVALUE functions in the debugger</p>

<p>The old perltodo notes that lvalue functions dont work
in the debug- ger. This would be good to fix.</p>

<p>_ prototype character</p>

<p>Study the possibility of adding a new prototype
character, &quot;_&quot;, meaning &quot;this argument
defaults to $_&quot;.</p>

<p>state variables</p>

<p>&quot;my $foo if 0;&quot; is deprecated, and should be
replaced with &quot;state $x = &quot;initial value0;&quot;
the syntax from Perl 6.</p>

<p>@INC source filter to Filter::Simple</p>

<p>The second return value from a sub in @INC can be a
source filter. This isn t documented. It should be changed
to use Filter::Simple, tested and documented.</p>

<p>regexp optimiser optional</p>

<p>The regexp optimiser is not optional. It should
configurable to be, to allow its performance to be measured,
and its bugs to be easily demon- strated.</p>

<p>UNITCHECK</p>

<p>Introduce a new special block, UNITCHECK, which is run
at the end of a compilation unit (module, file, eval(STRING)
block). This will corre- spond to the Perl 6 CHECK. Perl 5s
CHECK cannot be changed or removed because the O.pm/B.pm
backend framework depends on it.</p>

<p>optional optimizer</p>

<p>Make the peephole optimizer optional. Currently it
performs two tasks as it walks the optree - genuine peephole
optimisations, and necessary fixups of ops. It would be good
to find an efficient way to switch out the optimisations
whilst keeping the fixups.</p>

<p>You WANT *how* many</p>

<p>Currently contexts are void, scalar and list. split has
a special mech- anism in place to pass in the number of
return values wanted. It would be useful to have a general
mechanism for this, backwards compatible and little speed
hit. This would allow proposals such as short cir- cuiting
sort to be implemented as a module on CPAN.</p>

<p>lexical aliases</p>

<p>Allow lexical aliases (maybe via the syntax &quot;my
lias = oo&quot;.</p>

<p>entersub XS vs Perl</p>

<p>At the moment pp_entersub is huge, and has code to deal
with entering both perl and XS subroutines. Subroutine
implementations rarely change between perl and XS at run
time, so investigate using 2 ops to enter subs (one for XS,
one for perl) and swap between if a sub is redefined.</p>

<p>Self ties</p>

<p>self ties are currently illegal because they caused too
many segfaults. Maybe the causes of these could be tracked
down and self-ties on all types re- instated.</p>

<p>Optimize away @_</p>

<p>The old perltodo notes &quot;Look at the
&quot;reification&quot; code in &quot;av.c&quot;&quot;.</p>

<p>What hooks would assertions need?</p>

<p>Assertions are in the core, and work. However,
assertions needed to be added as a core patch, rather than
an XS module in ext, or a CPAN mod- ule, because the core
has no hooks in the necessary places. It would be useful to
investigate what hooks would need to be added to make it
pos- sible to provide the full assertion support from a CPAN
module, so that we arent constraining the imagination of
future CPAN authors.</p>

<p>Big projects Tasks that will get your name mentioned in
the description of the &quot;Highlights of 5.10&quot;</p>

<p>make ithreads more robust</p>

<p>Generally make ithreads more robust. See also
&quot;iCOW&quot;</p>

<p>This task is incremental - even a little bit of work on
it will help, and will be greatly appreciated.</p>

<p>iCOW</p>

<p>Sarathy and Arthur have a proposal for an improved Copy
On Write which specifically will be able to COW new
ithreads. If this can be implemented it would be a good
thing.</p>

<p>(?{...}) closures in regexps</p>

<p>Fix (or rewrite) the implementation of the
&quot;/(?{...})/&quot; closures.</p>

<p>A re-entrant regexp engine</p>

<p>This will allow the use of a regex from inside (?{ }),
(??{ }) and (?(?{ })) constructs.</p>

<p>perl v5.8.8 2014-02-11 PERLTODO(1)</p>
<hr>
</body>
</html>
